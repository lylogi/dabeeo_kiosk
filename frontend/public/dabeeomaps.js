/*! For license information please see dabeeomaps-04.36.01.js.LICENSE.txt */
(()=>{var t={6194:(t,e,i)=>{"use strict";i.r(e),i.d(e,{Easing:()=>n,Group:()=>s,Interpolation:()=>o,Sequence:()=>a,Tween:()=>c,VERSION:()=>h,add:()=>m,default:()=>y,getAll:()=>p,nextId:()=>u,now:()=>r,remove:()=>g,removeAll:()=>f,update:()=>v});var n={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-n.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*n.Bounce.In(2*t):.5*n.Bounce.Out(2*t-1)+.5}}},r="undefined"==typeof self&&"undefined"!=typeof process&&process.hrtime?function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()},s=function(){function t(){this._tweens={},this._tweensAddedDuringUpdate={}}return t.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map((function(e){return t._tweens[e]}))},t.prototype.removeAll=function(){this._tweens={}},t.prototype.add=function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},t.prototype.remove=function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},t.prototype.update=function(t,e){void 0===t&&(t=r()),void 0===e&&(e=!1);var i=Object.keys(this._tweens);if(0===i.length)return!1;for(;i.length>0;){this._tweensAddedDuringUpdate={};for(var n=0;n<i.length;n++){var s=this._tweens[i[n]],o=!e;s&&!1===s.update(t,o)&&!e&&delete this._tweens[i[n]]}i=Object.keys(this._tweensAddedDuringUpdate)}return!0},t}(),o={Linear:function(t,e){var i=t.length-1,n=i*e,r=Math.floor(n),s=o.Utils.Linear;return e<0?s(t[0],t[1],n):e>1?s(t[i],t[i-1],i-n):s(t[r],t[r+1>i?i:r+1],n-r)},Bezier:function(t,e){for(var i=0,n=t.length-1,r=Math.pow,s=o.Utils.Bernstein,a=0;a<=n;a++)i+=r(1-e,n-a)*r(e,a)*t[a]*s(n,a);return i},CatmullRom:function(t,e){var i=t.length-1,n=i*e,r=Math.floor(n),s=o.Utils.CatmullRom;return t[0]===t[i]?(e<0&&(r=Math.floor(n=i*(1+e))),s(t[(r-1+i)%i],t[r],t[(r+1)%i],t[(r+2)%i],n-r)):e<0?t[0]-(s(t[0],t[0],t[1],t[1],-n)-t[0]):e>1?t[i]-(s(t[i],t[i],t[i-1],t[i-1],n-i)-t[i]):s(t[r?r-1:0],t[r],t[i<r+1?i:r+1],t[i<r+2?i:r+2],n-r)},Utils:{Linear:function(t,e,i){return(e-t)*i+t},Bernstein:function(t,e){var i=o.Utils.Factorial;return i(t)/i(e)/i(t-e)},Factorial:function(){var t=[1];return function(e){var i=1;if(t[e])return t[e];for(var n=e;n>1;n--)i*=n;return t[e]=i,i}}(),CatmullRom:function(t,e,i,n,r){var s=.5*(i-t),o=.5*(n-e),a=r*r;return(2*e-2*i+s+o)*(r*a)+(-3*e+3*i-2*s-o)*a+s*r+e}}},a=function(){function t(){}return t.nextId=function(){return t._nextId++},t._nextId=0,t}(),l=new s,c=function(){function t(t,e){void 0===e&&(e=l),this._object=t,this._group=e,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=n.Linear.None,this._interpolationFunction=o.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=a.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return t.prototype.getId=function(){return this._id},t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.isPaused=function(){return this._isPaused},t.prototype.to=function(t,e){return this._valuesEnd=Object.create(t),void 0!==e&&(this._duration=e),this},t.prototype.duration=function(t){return this._duration=t,this},t.prototype.start=function(t){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var e in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(e),this._valuesStart[e]=this._valuesStartRepeat[e];return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=void 0!==t?"string"==typeof t?r()+parseFloat(t):t:r(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},t.prototype._setupProperties=function(t,e,i,n){for(var r in i){var s=t[r],o=Array.isArray(s),a=o?"array":typeof s,l=!o&&Array.isArray(i[r]);if("undefined"!==a&&"function"!==a){if(l){var c=i[r];if(0===c.length)continue;c=c.map(this._handleRelativeValue.bind(this,s)),i[r]=[s].concat(c)}if("object"!==a&&!o||!s||l)void 0===e[r]&&(e[r]=s),o||(e[r]*=1),n[r]=l?i[r].slice().reverse():e[r]||0;else{for(var h in e[r]=o?[]:{},s)e[r][h]=s[h];n[r]=o?[]:{},this._setupProperties(s,e[r],i[r],n[r])}}}},t.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},t.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},t.prototype.pause=function(t){return void 0===t&&(t=r()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=t,this._group&&this._group.remove(this)),this},t.prototype.resume=function(t){return void 0===t&&(t=r()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this):this},t.prototype.stopChainedTweens=function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this},t.prototype.group=function(t){return this._group=t,this},t.prototype.delay=function(t){return this._delayTime=t,this},t.prototype.repeat=function(t){return this._initialRepeat=t,this._repeat=t,this},t.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},t.prototype.yoyo=function(t){return this._yoyo=t,this},t.prototype.easing=function(t){return this._easingFunction=t,this},t.prototype.interpolation=function(t){return this._interpolationFunction=t,this},t.prototype.chain=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._chainedTweens=t,this},t.prototype.onStart=function(t){return this._onStartCallback=t,this},t.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},t.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},t.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},t.prototype.onStop=function(t){return this._onStopCallback=t,this},t.prototype.update=function(t,e){if(void 0===t&&(t=r()),void 0===e&&(e=!0),this._isPaused)return!0;var i,n,s=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(t>s)return!1;e&&this.start(t)}if(this._goToEnd=!1,t<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),n=(t-this._startTime)/this._duration,n=0===this._duration||n>1?1:n;var o=this._easingFunction(n);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,o),this._onUpdateCallback&&this._onUpdateCallback(this._object,n),1===n){if(this._repeat>0){for(i in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[i]||(this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(this._valuesEnd[i])),this._yoyo&&this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i];return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var a=0,l=this._chainedTweens.length;a<l;a++)this._chainedTweens[a].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},t.prototype._updateProperties=function(t,e,i,n){for(var r in i)if(void 0!==e[r]){var s=e[r]||0,o=i[r],a=Array.isArray(t[r]),l=Array.isArray(o);!a&&l?t[r]=this._interpolationFunction(o,n):"object"==typeof o&&o?this._updateProperties(t[r],s,o,n):"number"==typeof(o=this._handleRelativeValue(s,o))&&(t[r]=s+(o-s)*n)}},t.prototype._handleRelativeValue=function(t,e){return"string"!=typeof e?e:"+"===e.charAt(0)||"-"===e.charAt(0)?t+parseFloat(e):parseFloat(e)},t.prototype._swapEndStartRepeatValues=function(t){var e=this._valuesStartRepeat[t],i=this._valuesEnd[t];this._valuesStartRepeat[t]="string"==typeof i?this._valuesStartRepeat[t]+parseFloat(i):this._valuesEnd[t],this._valuesEnd[t]=e},t}(),h="18.6.4",u=a.nextId,d=l,p=d.getAll.bind(d),f=d.removeAll.bind(d),m=d.add.bind(d),g=d.remove.bind(d),v=d.update.bind(d);const y={Easing:n,Group:s,Interpolation:o,now:r,Sequence:a,nextId:u,Tween:c,VERSION:h,getAll:p,removeAll:f,add:m,remove:g,update:v}},2820:t=>{var e;self,e=()=>(()=>{var t={987:t=>{"use strict";var e={single_source_shortest_paths:function(t,i,n){var r={},s={};s[i]=0;var o,a,l,c,h,u,d,p=e.PriorityQueue.make();for(p.push(i,0);!p.empty();)for(l in a=(o=p.pop()).value,c=o.cost,h=t[a]||{})h.hasOwnProperty(l)&&(u=c+h[l],d=s[l],(void 0===s[l]||d>u)&&(s[l]=u,p.push(l,u),r[l]=a));if(void 0!==n&&void 0===s[n]){var f=["Could not find a path from ",i," to ",n,"."].join("");throw new Error(f)}return r},extract_shortest_path_from_predecessor_list:function(t,e){for(var i=[],n=e;n;)i.push(n),t[n],n=t[n];return i.reverse(),i},find_path:function(t,i,n){var r=e.single_source_shortest_paths(t,i,n);return e.extract_shortest_path_from_predecessor_list(r,n)},PriorityQueue:{make:function(t){var i,n=e.PriorityQueue,r={};for(i in t=t||{},n)n.hasOwnProperty(i)&&(r[i]=n[i]);return r.queue=[],r.sorter=t.sorter||n.default_sorter,r},default_sorter:function(t,e){return t.cost-e.cost},push:function(t,e){var i={value:t,cost:e};this.queue.push(i),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return 0===this.queue.length}}};t.exports=e},486:function(t,e,i){var n;t=i.nmd(t),function(){var r,s="Expected a function",o="__lodash_hash_undefined__",a="__lodash_placeholder__",l=32,c=128,h=1/0,u=9007199254740991,d=NaN,p=4294967295,f=[["ary",c],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",l],["partialRight",64],["rearg",256]],m="[object Arguments]",g="[object Array]",v="[object Boolean]",y="[object Date]",_="[object Error]",x="[object Function]",M="[object GeneratorFunction]",b="[object Map]",w="[object Number]",S="[object Object]",T="[object Promise]",A="[object RegExp]",E="[object Set]",C="[object String]",O="[object Symbol]",P="[object WeakMap]",I="[object ArrayBuffer]",D="[object DataView]",L="[object Float32Array]",R="[object Float64Array]",B="[object Int8Array]",N="[object Int16Array]",F="[object Int32Array]",U="[object Uint8Array]",G="[object Uint8ClampedArray]",z="[object Uint16Array]",k="[object Uint32Array]",j=/\b__p \+= '';/g,H=/\b(__p \+=) '' \+/g,V=/(__e\(.*?\)|\b__t\)) \+\n'';/g,W=/&(?:amp|lt|gt|quot|#39);/g,q=/[&<>"']/g,J=RegExp(W.source),X=RegExp(q.source),Y=/<%-([\s\S]+?)%>/g,Z=/<%([\s\S]+?)%>/g,K=/<%=([\s\S]+?)%>/g,Q=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,$=/^\w*$/,tt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,et=/[\\^$.*+?()[\]{}|]/g,it=RegExp(et.source),nt=/^\s+/,rt=/\s/,st=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ot=/\{\n\/\* \[wrapped with (.+)\] \*/,at=/,? & /,lt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ct=/[()=,{}\[\]\/\s]/,ht=/\\(\\)?/g,ut=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,dt=/\w*$/,pt=/^[-+]0x[0-9a-f]+$/i,ft=/^0b[01]+$/i,mt=/^\[object .+?Constructor\]$/,gt=/^0o[0-7]+$/i,vt=/^(?:0|[1-9]\d*)$/,yt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,_t=/($^)/,xt=/['\n\r\u2028\u2029\\]/g,Mt="\\ud800-\\udfff",bt="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",wt="\\u2700-\\u27bf",St="a-z\\xdf-\\xf6\\xf8-\\xff",Tt="A-Z\\xc0-\\xd6\\xd8-\\xde",At="\\ufe0e\\ufe0f",Et="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ct="["+Mt+"]",Ot="["+Et+"]",Pt="["+bt+"]",It="\\d+",Dt="["+wt+"]",Lt="["+St+"]",Rt="[^"+Mt+Et+It+wt+St+Tt+"]",Bt="\\ud83c[\\udffb-\\udfff]",Nt="[^"+Mt+"]",Ft="(?:\\ud83c[\\udde6-\\uddff]){2}",Ut="[\\ud800-\\udbff][\\udc00-\\udfff]",Gt="["+Tt+"]",zt="\\u200d",kt="(?:"+Lt+"|"+Rt+")",jt="(?:"+Gt+"|"+Rt+")",Ht="(?:['’](?:d|ll|m|re|s|t|ve))?",Vt="(?:['’](?:D|LL|M|RE|S|T|VE))?",Wt="(?:"+Pt+"|"+Bt+")?",qt="["+At+"]?",Jt=qt+Wt+"(?:\\u200d(?:"+[Nt,Ft,Ut].join("|")+")"+qt+Wt+")*",Xt="(?:"+[Dt,Ft,Ut].join("|")+")"+Jt,Yt="(?:"+[Nt+Pt+"?",Pt,Ft,Ut,Ct].join("|")+")",Zt=RegExp("['’]","g"),Kt=RegExp(Pt,"g"),Qt=RegExp(Bt+"(?="+Bt+")|"+Yt+Jt,"g"),$t=RegExp([Gt+"?"+Lt+"+"+Ht+"(?="+[Ot,Gt,"$"].join("|")+")",jt+"+"+Vt+"(?="+[Ot,Gt+kt,"$"].join("|")+")",Gt+"?"+kt+"+"+Ht,Gt+"+"+Vt,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",It,Xt].join("|"),"g"),te=RegExp("["+zt+Mt+bt+At+"]"),ee=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ie=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ne=-1,re={};re[L]=re[R]=re[B]=re[N]=re[F]=re[U]=re[G]=re[z]=re[k]=!0,re[m]=re[g]=re[I]=re[v]=re[D]=re[y]=re[_]=re[x]=re[b]=re[w]=re[S]=re[A]=re[E]=re[C]=re[P]=!1;var se={};se[m]=se[g]=se[I]=se[D]=se[v]=se[y]=se[L]=se[R]=se[B]=se[N]=se[F]=se[b]=se[w]=se[S]=se[A]=se[E]=se[C]=se[O]=se[U]=se[G]=se[z]=se[k]=!0,se[_]=se[x]=se[P]=!1;var oe={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ae=parseFloat,le=parseInt,ce="object"==typeof i.g&&i.g&&i.g.Object===Object&&i.g,he="object"==typeof self&&self&&self.Object===Object&&self,ue=ce||he||Function("return this")(),de=e&&!e.nodeType&&e,pe=de&&t&&!t.nodeType&&t,fe=pe&&pe.exports===de,me=fe&&ce.process,ge=function(){try{return pe&&pe.require&&pe.require("util").types||me&&me.binding&&me.binding("util")}catch(t){}}(),ve=ge&&ge.isArrayBuffer,ye=ge&&ge.isDate,_e=ge&&ge.isMap,xe=ge&&ge.isRegExp,Me=ge&&ge.isSet,be=ge&&ge.isTypedArray;function we(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}function Se(t,e,i,n){for(var r=-1,s=null==t?0:t.length;++r<s;){var o=t[r];e(n,o,i(o),t)}return n}function Te(t,e){for(var i=-1,n=null==t?0:t.length;++i<n&&!1!==e(t[i],i,t););return t}function Ae(t,e){for(var i=null==t?0:t.length;i--&&!1!==e(t[i],i,t););return t}function Ee(t,e){for(var i=-1,n=null==t?0:t.length;++i<n;)if(!e(t[i],i,t))return!1;return!0}function Ce(t,e){for(var i=-1,n=null==t?0:t.length,r=0,s=[];++i<n;){var o=t[i];e(o,i,t)&&(s[r++]=o)}return s}function Oe(t,e){return!(null==t||!t.length)&&Ge(t,e,0)>-1}function Pe(t,e,i){for(var n=-1,r=null==t?0:t.length;++n<r;)if(i(e,t[n]))return!0;return!1}function Ie(t,e){for(var i=-1,n=null==t?0:t.length,r=Array(n);++i<n;)r[i]=e(t[i],i,t);return r}function De(t,e){for(var i=-1,n=e.length,r=t.length;++i<n;)t[r+i]=e[i];return t}function Le(t,e,i,n){var r=-1,s=null==t?0:t.length;for(n&&s&&(i=t[++r]);++r<s;)i=e(i,t[r],r,t);return i}function Re(t,e,i,n){var r=null==t?0:t.length;for(n&&r&&(i=t[--r]);r--;)i=e(i,t[r],r,t);return i}function Be(t,e){for(var i=-1,n=null==t?0:t.length;++i<n;)if(e(t[i],i,t))return!0;return!1}var Ne=He("length");function Fe(t,e,i){var n;return i(t,(function(t,i,r){if(e(t,i,r))return n=i,!1})),n}function Ue(t,e,i,n){for(var r=t.length,s=i+(n?1:-1);n?s--:++s<r;)if(e(t[s],s,t))return s;return-1}function Ge(t,e,i){return e==e?function(t,e,i){for(var n=i-1,r=t.length;++n<r;)if(t[n]===e)return n;return-1}(t,e,i):Ue(t,ke,i)}function ze(t,e,i,n){for(var r=i-1,s=t.length;++r<s;)if(n(t[r],e))return r;return-1}function ke(t){return t!=t}function je(t,e){var i=null==t?0:t.length;return i?qe(t,e)/i:d}function He(t){return function(e){return null==e?r:e[t]}}function Ve(t){return function(e){return null==t?r:t[e]}}function We(t,e,i,n,r){return r(t,(function(t,r,s){i=n?(n=!1,t):e(i,t,r,s)})),i}function qe(t,e){for(var i,n=-1,s=t.length;++n<s;){var o=e(t[n]);o!==r&&(i=i===r?o:i+o)}return i}function Je(t,e){for(var i=-1,n=Array(t);++i<t;)n[i]=e(i);return n}function Xe(t){return t?t.slice(0,hi(t)+1).replace(nt,""):t}function Ye(t){return function(e){return t(e)}}function Ze(t,e){return Ie(e,(function(e){return t[e]}))}function Ke(t,e){return t.has(e)}function Qe(t,e){for(var i=-1,n=t.length;++i<n&&Ge(e,t[i],0)>-1;);return i}function $e(t,e){for(var i=t.length;i--&&Ge(e,t[i],0)>-1;);return i}var ti=Ve({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"}),ei=Ve({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function ii(t){return"\\"+oe[t]}function ni(t){return te.test(t)}function ri(t){var e=-1,i=Array(t.size);return t.forEach((function(t,n){i[++e]=[n,t]})),i}function si(t,e){return function(i){return t(e(i))}}function oi(t,e){for(var i=-1,n=t.length,r=0,s=[];++i<n;){var o=t[i];o!==e&&o!==a||(t[i]=a,s[r++]=i)}return s}function ai(t){var e=-1,i=Array(t.size);return t.forEach((function(t){i[++e]=t})),i}function li(t){return ni(t)?function(t){for(var e=Qt.lastIndex=0;Qt.test(t);)++e;return e}(t):Ne(t)}function ci(t){return ni(t)?function(t){return t.match(Qt)||[]}(t):function(t){return t.split("")}(t)}function hi(t){for(var e=t.length;e--&&rt.test(t.charAt(e)););return e}var ui=Ve({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),di=function t(e){var i,n=(e=null==e?ue:di.defaults(ue.Object(),e,di.pick(ue,ie))).Array,rt=e.Date,Mt=e.Error,bt=e.Function,wt=e.Math,St=e.Object,Tt=e.RegExp,At=e.String,Et=e.TypeError,Ct=n.prototype,Ot=bt.prototype,Pt=St.prototype,It=e["__core-js_shared__"],Dt=Ot.toString,Lt=Pt.hasOwnProperty,Rt=0,Bt=(i=/[^.]+$/.exec(It&&It.keys&&It.keys.IE_PROTO||""))?"Symbol(src)_1."+i:"",Nt=Pt.toString,Ft=Dt.call(St),Ut=ue._,Gt=Tt("^"+Dt.call(Lt).replace(et,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),zt=fe?e.Buffer:r,kt=e.Symbol,jt=e.Uint8Array,Ht=zt?zt.allocUnsafe:r,Vt=si(St.getPrototypeOf,St),Wt=St.create,qt=Pt.propertyIsEnumerable,Jt=Ct.splice,Xt=kt?kt.isConcatSpreadable:r,Yt=kt?kt.iterator:r,Qt=kt?kt.toStringTag:r,te=function(){try{var t=as(St,"defineProperty");return t({},"",{}),t}catch(t){}}(),oe=e.clearTimeout!==ue.clearTimeout&&e.clearTimeout,ce=rt&&rt.now!==ue.Date.now&&rt.now,he=e.setTimeout!==ue.setTimeout&&e.setTimeout,de=wt.ceil,pe=wt.floor,me=St.getOwnPropertySymbols,ge=zt?zt.isBuffer:r,Ne=e.isFinite,Ve=Ct.join,pi=si(St.keys,St),fi=wt.max,mi=wt.min,gi=rt.now,vi=e.parseInt,yi=wt.random,_i=Ct.reverse,xi=as(e,"DataView"),Mi=as(e,"Map"),bi=as(e,"Promise"),wi=as(e,"Set"),Si=as(e,"WeakMap"),Ti=as(St,"create"),Ai=Si&&new Si,Ei={},Ci=Ls(xi),Oi=Ls(Mi),Pi=Ls(bi),Ii=Ls(wi),Di=Ls(Si),Li=kt?kt.prototype:r,Ri=Li?Li.valueOf:r,Bi=Li?Li.toString:r;function Ni(t){if(Ko(t)&&!zo(t)&&!(t instanceof zi)){if(t instanceof Gi)return t;if(Lt.call(t,"__wrapped__"))return Rs(t)}return new Gi(t)}var Fi=function(){function t(){}return function(e){if(!Zo(e))return{};if(Wt)return Wt(e);t.prototype=e;var i=new t;return t.prototype=r,i}}();function Ui(){}function Gi(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=r}function zi(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=p,this.__views__=[]}function ki(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function ji(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function Hi(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function Vi(t){var e=-1,i=null==t?0:t.length;for(this.__data__=new Hi;++e<i;)this.add(t[e])}function Wi(t){var e=this.__data__=new ji(t);this.size=e.size}function qi(t,e){var i=zo(t),n=!i&&Go(t),r=!i&&!n&&Vo(t),s=!i&&!n&&!r&&sa(t),o=i||n||r||s,a=o?Je(t.length,At):[],l=a.length;for(var c in t)!e&&!Lt.call(t,c)||o&&("length"==c||r&&("offset"==c||"parent"==c)||s&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||fs(c,l))||a.push(c);return a}function Ji(t){var e=t.length;return e?t[Vn(0,e-1)]:r}function Xi(t,e){return Ps(Tr(t),rn(e,0,t.length))}function Yi(t){return Ps(Tr(t))}function Zi(t,e,i){(i!==r&&!No(t[e],i)||i===r&&!(e in t))&&en(t,e,i)}function Ki(t,e,i){var n=t[e];Lt.call(t,e)&&No(n,i)&&(i!==r||e in t)||en(t,e,i)}function Qi(t,e){for(var i=t.length;i--;)if(No(t[i][0],e))return i;return-1}function $i(t,e,i,n){return cn(t,(function(t,r,s){e(n,t,i(t),s)})),n}function tn(t,e){return t&&Ar(e,Ea(e),t)}function en(t,e,i){"__proto__"==e&&te?te(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}function nn(t,e){for(var i=-1,s=e.length,o=n(s),a=null==t;++i<s;)o[i]=a?r:ba(t,e[i]);return o}function rn(t,e,i){return t==t&&(i!==r&&(t=t<=i?t:i),e!==r&&(t=t>=e?t:e)),t}function sn(t,e,i,n,s,o){var a,l=1&e,c=2&e,h=4&e;if(i&&(a=s?i(t,n,s,o):i(t)),a!==r)return a;if(!Zo(t))return t;var u=zo(t);if(u){if(a=function(t){var e=t.length,i=new t.constructor(e);return e&&"string"==typeof t[0]&&Lt.call(t,"index")&&(i.index=t.index,i.input=t.input),i}(t),!l)return Tr(t,a)}else{var d=hs(t),p=d==x||d==M;if(Vo(t))return _r(t,l);if(d==S||d==m||p&&!s){if(a=c||p?{}:ds(t),!l)return c?function(t,e){return Ar(t,cs(t),e)}(t,function(t,e){return t&&Ar(e,Ca(e),t)}(a,t)):function(t,e){return Ar(t,ls(t),e)}(t,tn(a,t))}else{if(!se[d])return s?t:{};a=function(t,e,i){var n,r=t.constructor;switch(e){case I:return xr(t);case v:case y:return new r(+t);case D:return function(t,e){var i=e?xr(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}(t,i);case L:case R:case B:case N:case F:case U:case G:case z:case k:return Mr(t,i);case b:return new r;case w:case C:return new r(t);case A:return function(t){var e=new t.constructor(t.source,dt.exec(t));return e.lastIndex=t.lastIndex,e}(t);case E:return new r;case O:return n=t,Ri?St(Ri.call(n)):{}}}(t,d,l)}}o||(o=new Wi);var f=o.get(t);if(f)return f;o.set(t,a),ia(t)?t.forEach((function(n){a.add(sn(n,e,i,n,t,o))})):Qo(t)&&t.forEach((function(n,r){a.set(r,sn(n,e,i,r,t,o))}));var g=u?r:(h?c?ts:$r:c?Ca:Ea)(t);return Te(g||t,(function(n,r){g&&(n=t[r=n]),Ki(a,r,sn(n,e,i,r,t,o))})),a}function on(t,e,i){var n=i.length;if(null==t)return!n;for(t=St(t);n--;){var s=i[n],o=e[s],a=t[s];if(a===r&&!(s in t)||!o(a))return!1}return!0}function an(t,e,i){if("function"!=typeof t)throw new Et(s);return As((function(){t.apply(r,i)}),e)}function ln(t,e,i,n){var r=-1,s=Oe,o=!0,a=t.length,l=[],c=e.length;if(!a)return l;i&&(e=Ie(e,Ye(i))),n?(s=Pe,o=!1):e.length>=200&&(s=Ke,o=!1,e=new Vi(e));t:for(;++r<a;){var h=t[r],u=null==i?h:i(h);if(h=n||0!==h?h:0,o&&u==u){for(var d=c;d--;)if(e[d]===u)continue t;l.push(h)}else s(e,u,n)||l.push(h)}return l}Ni.templateSettings={escape:Y,evaluate:Z,interpolate:K,variable:"",imports:{_:Ni}},Ni.prototype=Ui.prototype,Ni.prototype.constructor=Ni,Gi.prototype=Fi(Ui.prototype),Gi.prototype.constructor=Gi,zi.prototype=Fi(Ui.prototype),zi.prototype.constructor=zi,ki.prototype.clear=function(){this.__data__=Ti?Ti(null):{},this.size=0},ki.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},ki.prototype.get=function(t){var e=this.__data__;if(Ti){var i=e[t];return i===o?r:i}return Lt.call(e,t)?e[t]:r},ki.prototype.has=function(t){var e=this.__data__;return Ti?e[t]!==r:Lt.call(e,t)},ki.prototype.set=function(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=Ti&&e===r?o:e,this},ji.prototype.clear=function(){this.__data__=[],this.size=0},ji.prototype.delete=function(t){var e=this.__data__,i=Qi(e,t);return!(i<0||(i==e.length-1?e.pop():Jt.call(e,i,1),--this.size,0))},ji.prototype.get=function(t){var e=this.__data__,i=Qi(e,t);return i<0?r:e[i][1]},ji.prototype.has=function(t){return Qi(this.__data__,t)>-1},ji.prototype.set=function(t,e){var i=this.__data__,n=Qi(i,t);return n<0?(++this.size,i.push([t,e])):i[n][1]=e,this},Hi.prototype.clear=function(){this.size=0,this.__data__={hash:new ki,map:new(Mi||ji),string:new ki}},Hi.prototype.delete=function(t){var e=ss(this,t).delete(t);return this.size-=e?1:0,e},Hi.prototype.get=function(t){return ss(this,t).get(t)},Hi.prototype.has=function(t){return ss(this,t).has(t)},Hi.prototype.set=function(t,e){var i=ss(this,t),n=i.size;return i.set(t,e),this.size+=i.size==n?0:1,this},Vi.prototype.add=Vi.prototype.push=function(t){return this.__data__.set(t,o),this},Vi.prototype.has=function(t){return this.__data__.has(t)},Wi.prototype.clear=function(){this.__data__=new ji,this.size=0},Wi.prototype.delete=function(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i},Wi.prototype.get=function(t){return this.__data__.get(t)},Wi.prototype.has=function(t){return this.__data__.has(t)},Wi.prototype.set=function(t,e){var i=this.__data__;if(i instanceof ji){var n=i.__data__;if(!Mi||n.length<199)return n.push([t,e]),this.size=++i.size,this;i=this.__data__=new Hi(n)}return i.set(t,e),this.size=i.size,this};var cn=Or(vn),hn=Or(yn,!0);function un(t,e){var i=!0;return cn(t,(function(t,n,r){return i=!!e(t,n,r)})),i}function dn(t,e,i){for(var n=-1,s=t.length;++n<s;){var o=t[n],a=e(o);if(null!=a&&(l===r?a==a&&!ra(a):i(a,l)))var l=a,c=o}return c}function pn(t,e){var i=[];return cn(t,(function(t,n,r){e(t,n,r)&&i.push(t)})),i}function fn(t,e,i,n,r){var s=-1,o=t.length;for(i||(i=ps),r||(r=[]);++s<o;){var a=t[s];e>0&&i(a)?e>1?fn(a,e-1,i,n,r):De(r,a):n||(r[r.length]=a)}return r}var mn=Pr(),gn=Pr(!0);function vn(t,e){return t&&mn(t,e,Ea)}function yn(t,e){return t&&gn(t,e,Ea)}function _n(t,e){return Ce(e,(function(e){return Jo(t[e])}))}function xn(t,e){for(var i=0,n=(e=mr(e,t)).length;null!=t&&i<n;)t=t[Ds(e[i++])];return i&&i==n?t:r}function Mn(t,e,i){var n=e(t);return zo(t)?n:De(n,i(t))}function bn(t){return null==t?t===r?"[object Undefined]":"[object Null]":Qt&&Qt in St(t)?function(t){var e=Lt.call(t,Qt),i=t[Qt];try{t[Qt]=r;var n=!0}catch(t){}var s=Nt.call(t);return n&&(e?t[Qt]=i:delete t[Qt]),s}(t):function(t){return Nt.call(t)}(t)}function wn(t,e){return t>e}function Sn(t,e){return null!=t&&Lt.call(t,e)}function Tn(t,e){return null!=t&&e in St(t)}function An(t,e,i){for(var s=i?Pe:Oe,o=t[0].length,a=t.length,l=a,c=n(a),h=1/0,u=[];l--;){var d=t[l];l&&e&&(d=Ie(d,Ye(e))),h=mi(d.length,h),c[l]=!i&&(e||o>=120&&d.length>=120)?new Vi(l&&d):r}d=t[0];var p=-1,f=c[0];t:for(;++p<o&&u.length<h;){var m=d[p],g=e?e(m):m;if(m=i||0!==m?m:0,!(f?Ke(f,g):s(u,g,i))){for(l=a;--l;){var v=c[l];if(!(v?Ke(v,g):s(t[l],g,i)))continue t}f&&f.push(g),u.push(m)}}return u}function En(t,e,i){var n=null==(t=ws(t,e=mr(e,t)))?t:t[Ds(Ws(e))];return null==n?r:we(n,t,i)}function Cn(t){return Ko(t)&&bn(t)==m}function On(t,e,i,n,s){return t===e||(null==t||null==e||!Ko(t)&&!Ko(e)?t!=t&&e!=e:function(t,e,i,n,s,o){var a=zo(t),l=zo(e),c=a?g:hs(t),h=l?g:hs(e),u=(c=c==m?S:c)==S,d=(h=h==m?S:h)==S,p=c==h;if(p&&Vo(t)){if(!Vo(e))return!1;a=!0,u=!1}if(p&&!u)return o||(o=new Wi),a||sa(t)?Kr(t,e,i,n,s,o):function(t,e,i,n,r,s,o){switch(i){case D:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case I:return!(t.byteLength!=e.byteLength||!s(new jt(t),new jt(e)));case v:case y:case w:return No(+t,+e);case _:return t.name==e.name&&t.message==e.message;case A:case C:return t==e+"";case b:var a=ri;case E:var l=1&n;if(a||(a=ai),t.size!=e.size&&!l)return!1;var c=o.get(t);if(c)return c==e;n|=2,o.set(t,e);var h=Kr(a(t),a(e),n,r,s,o);return o.delete(t),h;case O:if(Ri)return Ri.call(t)==Ri.call(e)}return!1}(t,e,c,i,n,s,o);if(!(1&i)){var f=u&&Lt.call(t,"__wrapped__"),x=d&&Lt.call(e,"__wrapped__");if(f||x){var M=f?t.value():t,T=x?e.value():e;return o||(o=new Wi),s(M,T,i,n,o)}}return!!p&&(o||(o=new Wi),function(t,e,i,n,s,o){var a=1&i,l=$r(t),c=l.length;if(c!=$r(e).length&&!a)return!1;for(var h=c;h--;){var u=l[h];if(!(a?u in e:Lt.call(e,u)))return!1}var d=o.get(t),p=o.get(e);if(d&&p)return d==e&&p==t;var f=!0;o.set(t,e),o.set(e,t);for(var m=a;++h<c;){var g=t[u=l[h]],v=e[u];if(n)var y=a?n(v,g,u,e,t,o):n(g,v,u,t,e,o);if(!(y===r?g===v||s(g,v,i,n,o):y)){f=!1;break}m||(m="constructor"==u)}if(f&&!m){var _=t.constructor,x=e.constructor;_==x||!("constructor"in t)||!("constructor"in e)||"function"==typeof _&&_ instanceof _&&"function"==typeof x&&x instanceof x||(f=!1)}return o.delete(t),o.delete(e),f}(t,e,i,n,s,o))}(t,e,i,n,On,s))}function Pn(t,e,i,n){var s=i.length,o=s,a=!n;if(null==t)return!o;for(t=St(t);s--;){var l=i[s];if(a&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++s<o;){var c=(l=i[s])[0],h=t[c],u=l[1];if(a&&l[2]){if(h===r&&!(c in t))return!1}else{var d=new Wi;if(n)var p=n(h,u,c,t,e,d);if(!(p===r?On(u,h,3,n,d):p))return!1}}return!0}function In(t){return!(!Zo(t)||(e=t,Bt&&Bt in e))&&(Jo(t)?Gt:mt).test(Ls(t));var e}function Dn(t){return"function"==typeof t?t:null==t?$a:"object"==typeof t?zo(t)?Fn(t[0],t[1]):Nn(t):ll(t)}function Ln(t){if(!_s(t))return pi(t);var e=[];for(var i in St(t))Lt.call(t,i)&&"constructor"!=i&&e.push(i);return e}function Rn(t,e){return t<e}function Bn(t,e){var i=-1,r=jo(t)?n(t.length):[];return cn(t,(function(t,n,s){r[++i]=e(t,n,s)})),r}function Nn(t){var e=os(t);return 1==e.length&&e[0][2]?Ms(e[0][0],e[0][1]):function(i){return i===t||Pn(i,t,e)}}function Fn(t,e){return gs(t)&&xs(e)?Ms(Ds(t),e):function(i){var n=ba(i,t);return n===r&&n===e?wa(i,t):On(e,n,3)}}function Un(t,e,i,n,s){t!==e&&mn(e,(function(o,a){if(s||(s=new Wi),Zo(o))!function(t,e,i,n,s,o,a){var l=Ss(t,i),c=Ss(e,i),h=a.get(c);if(h)Zi(t,i,h);else{var u=o?o(l,c,i+"",t,e,a):r,d=u===r;if(d){var p=zo(c),f=!p&&Vo(c),m=!p&&!f&&sa(c);u=c,p||f||m?zo(l)?u=l:Ho(l)?u=Tr(l):f?(d=!1,u=_r(c,!0)):m?(d=!1,u=Mr(c,!0)):u=[]:ta(c)||Go(c)?(u=l,Go(l)?u=pa(l):Zo(l)&&!Jo(l)||(u=ds(c))):d=!1}d&&(a.set(c,u),s(u,c,n,o,a),a.delete(c)),Zi(t,i,u)}}(t,e,a,i,Un,n,s);else{var l=n?n(Ss(t,a),o,a+"",t,e,s):r;l===r&&(l=o),Zi(t,a,l)}}),Ca)}function Gn(t,e){var i=t.length;if(i)return fs(e+=e<0?i:0,i)?t[e]:r}function zn(t,e,i){e=e.length?Ie(e,(function(t){return zo(t)?function(e){return xn(e,1===t.length?t[0]:t)}:t})):[$a];var n=-1;e=Ie(e,Ye(rs()));var r=Bn(t,(function(t,i,r){var s=Ie(e,(function(e){return e(t)}));return{criteria:s,index:++n,value:t}}));return function(t,e){var i=t.length;for(t.sort(e);i--;)t[i]=t[i].value;return t}(r,(function(t,e){return function(t,e,i){for(var n=-1,r=t.criteria,s=e.criteria,o=r.length,a=i.length;++n<o;){var l=br(r[n],s[n]);if(l)return n>=a?l:l*("desc"==i[n]?-1:1)}return t.index-e.index}(t,e,i)}))}function kn(t,e,i){for(var n=-1,r=e.length,s={};++n<r;){var o=e[n],a=xn(t,o);i(a,o)&&Yn(s,mr(o,t),a)}return s}function jn(t,e,i,n){var r=n?ze:Ge,s=-1,o=e.length,a=t;for(t===e&&(e=Tr(e)),i&&(a=Ie(t,Ye(i)));++s<o;)for(var l=0,c=e[s],h=i?i(c):c;(l=r(a,h,l,n))>-1;)a!==t&&Jt.call(a,l,1),Jt.call(t,l,1);return t}function Hn(t,e){for(var i=t?e.length:0,n=i-1;i--;){var r=e[i];if(i==n||r!==s){var s=r;fs(r)?Jt.call(t,r,1):ar(t,r)}}return t}function Vn(t,e){return t+pe(yi()*(e-t+1))}function Wn(t,e){var i="";if(!t||e<1||e>u)return i;do{e%2&&(i+=t),(e=pe(e/2))&&(t+=t)}while(e);return i}function qn(t,e){return Es(bs(t,e,$a),t+"")}function Jn(t){return Ji(Na(t))}function Xn(t,e){var i=Na(t);return Ps(i,rn(e,0,i.length))}function Yn(t,e,i,n){if(!Zo(t))return t;for(var s=-1,o=(e=mr(e,t)).length,a=o-1,l=t;null!=l&&++s<o;){var c=Ds(e[s]),h=i;if("__proto__"===c||"constructor"===c||"prototype"===c)return t;if(s!=a){var u=l[c];(h=n?n(u,c,l):r)===r&&(h=Zo(u)?u:fs(e[s+1])?[]:{})}Ki(l,c,h),l=l[c]}return t}var Zn=Ai?function(t,e){return Ai.set(t,e),t}:$a,Kn=te?function(t,e){return te(t,"toString",{configurable:!0,enumerable:!1,value:Za(e),writable:!0})}:$a;function Qn(t){return Ps(Na(t))}function $n(t,e,i){var r=-1,s=t.length;e<0&&(e=-e>s?0:s+e),(i=i>s?s:i)<0&&(i+=s),s=e>i?0:i-e>>>0,e>>>=0;for(var o=n(s);++r<s;)o[r]=t[r+e];return o}function tr(t,e){var i;return cn(t,(function(t,n,r){return!(i=e(t,n,r))})),!!i}function er(t,e,i){var n=0,r=null==t?n:t.length;if("number"==typeof e&&e==e&&r<=2147483647){for(;n<r;){var s=n+r>>>1,o=t[s];null!==o&&!ra(o)&&(i?o<=e:o<e)?n=s+1:r=s}return r}return ir(t,e,$a,i)}function ir(t,e,i,n){var s=0,o=null==t?0:t.length;if(0===o)return 0;for(var a=(e=i(e))!=e,l=null===e,c=ra(e),h=e===r;s<o;){var u=pe((s+o)/2),d=i(t[u]),p=d!==r,f=null===d,m=d==d,g=ra(d);if(a)var v=n||m;else v=h?m&&(n||p):l?m&&p&&(n||!f):c?m&&p&&!f&&(n||!g):!f&&!g&&(n?d<=e:d<e);v?s=u+1:o=u}return mi(o,4294967294)}function nr(t,e){for(var i=-1,n=t.length,r=0,s=[];++i<n;){var o=t[i],a=e?e(o):o;if(!i||!No(a,l)){var l=a;s[r++]=0===o?0:o}}return s}function rr(t){return"number"==typeof t?t:ra(t)?d:+t}function sr(t){if("string"==typeof t)return t;if(zo(t))return Ie(t,sr)+"";if(ra(t))return Bi?Bi.call(t):"";var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function or(t,e,i){var n=-1,r=Oe,s=t.length,o=!0,a=[],l=a;if(i)o=!1,r=Pe;else if(s>=200){var c=e?null:Wr(t);if(c)return ai(c);o=!1,r=Ke,l=new Vi}else l=e?[]:a;t:for(;++n<s;){var h=t[n],u=e?e(h):h;if(h=i||0!==h?h:0,o&&u==u){for(var d=l.length;d--;)if(l[d]===u)continue t;e&&l.push(u),a.push(h)}else r(l,u,i)||(l!==a&&l.push(u),a.push(h))}return a}function ar(t,e){return null==(t=ws(t,e=mr(e,t)))||delete t[Ds(Ws(e))]}function lr(t,e,i,n){return Yn(t,e,i(xn(t,e)),n)}function cr(t,e,i,n){for(var r=t.length,s=n?r:-1;(n?s--:++s<r)&&e(t[s],s,t););return i?$n(t,n?0:s,n?s+1:r):$n(t,n?s+1:0,n?r:s)}function hr(t,e){var i=t;return i instanceof zi&&(i=i.value()),Le(e,(function(t,e){return e.func.apply(e.thisArg,De([t],e.args))}),i)}function ur(t,e,i){var r=t.length;if(r<2)return r?or(t[0]):[];for(var s=-1,o=n(r);++s<r;)for(var a=t[s],l=-1;++l<r;)l!=s&&(o[s]=ln(o[s]||a,t[l],e,i));return or(fn(o,1),e,i)}function dr(t,e,i){for(var n=-1,s=t.length,o=e.length,a={};++n<s;){var l=n<o?e[n]:r;i(a,t[n],l)}return a}function pr(t){return Ho(t)?t:[]}function fr(t){return"function"==typeof t?t:$a}function mr(t,e){return zo(t)?t:gs(t,e)?[t]:Is(fa(t))}var gr=qn;function vr(t,e,i){var n=t.length;return i=i===r?n:i,!e&&i>=n?t:$n(t,e,i)}var yr=oe||function(t){return ue.clearTimeout(t)};function _r(t,e){if(e)return t.slice();var i=t.length,n=Ht?Ht(i):new t.constructor(i);return t.copy(n),n}function xr(t){var e=new t.constructor(t.byteLength);return new jt(e).set(new jt(t)),e}function Mr(t,e){var i=e?xr(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}function br(t,e){if(t!==e){var i=t!==r,n=null===t,s=t==t,o=ra(t),a=e!==r,l=null===e,c=e==e,h=ra(e);if(!l&&!h&&!o&&t>e||o&&a&&c&&!l&&!h||n&&a&&c||!i&&c||!s)return 1;if(!n&&!o&&!h&&t<e||h&&i&&s&&!n&&!o||l&&i&&s||!a&&s||!c)return-1}return 0}function wr(t,e,i,r){for(var s=-1,o=t.length,a=i.length,l=-1,c=e.length,h=fi(o-a,0),u=n(c+h),d=!r;++l<c;)u[l]=e[l];for(;++s<a;)(d||s<o)&&(u[i[s]]=t[s]);for(;h--;)u[l++]=t[s++];return u}function Sr(t,e,i,r){for(var s=-1,o=t.length,a=-1,l=i.length,c=-1,h=e.length,u=fi(o-l,0),d=n(u+h),p=!r;++s<u;)d[s]=t[s];for(var f=s;++c<h;)d[f+c]=e[c];for(;++a<l;)(p||s<o)&&(d[f+i[a]]=t[s++]);return d}function Tr(t,e){var i=-1,r=t.length;for(e||(e=n(r));++i<r;)e[i]=t[i];return e}function Ar(t,e,i,n){var s=!i;i||(i={});for(var o=-1,a=e.length;++o<a;){var l=e[o],c=n?n(i[l],t[l],l,i,t):r;c===r&&(c=t[l]),s?en(i,l,c):Ki(i,l,c)}return i}function Er(t,e){return function(i,n){var r=zo(i)?Se:$i,s=e?e():{};return r(i,t,rs(n,2),s)}}function Cr(t){return qn((function(e,i){var n=-1,s=i.length,o=s>1?i[s-1]:r,a=s>2?i[2]:r;for(o=t.length>3&&"function"==typeof o?(s--,o):r,a&&ms(i[0],i[1],a)&&(o=s<3?r:o,s=1),e=St(e);++n<s;){var l=i[n];l&&t(e,l,n,o)}return e}))}function Or(t,e){return function(i,n){if(null==i)return i;if(!jo(i))return t(i,n);for(var r=i.length,s=e?r:-1,o=St(i);(e?s--:++s<r)&&!1!==n(o[s],s,o););return i}}function Pr(t){return function(e,i,n){for(var r=-1,s=St(e),o=n(e),a=o.length;a--;){var l=o[t?a:++r];if(!1===i(s[l],l,s))break}return e}}function Ir(t){return function(e){var i=ni(e=fa(e))?ci(e):r,n=i?i[0]:e.charAt(0),s=i?vr(i,1).join(""):e.slice(1);return n[t]()+s}}function Dr(t){return function(e){return Le(Ja(Ga(e).replace(Zt,"")),t,"")}}function Lr(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var i=Fi(t.prototype),n=t.apply(i,e);return Zo(n)?n:i}}function Rr(t){return function(e,i,n){var s=St(e);if(!jo(e)){var o=rs(i,3);e=Ea(e),i=function(t){return o(s[t],t,s)}}var a=t(e,i,n);return a>-1?s[o?e[a]:a]:r}}function Br(t){return Qr((function(e){var i=e.length,n=i,o=Gi.prototype.thru;for(t&&e.reverse();n--;){var a=e[n];if("function"!=typeof a)throw new Et(s);if(o&&!l&&"wrapper"==is(a))var l=new Gi([],!0)}for(n=l?n:i;++n<i;){var c=is(a=e[n]),h="wrapper"==c?es(a):r;l=h&&vs(h[0])&&424==h[1]&&!h[4].length&&1==h[9]?l[is(h[0])].apply(l,h[3]):1==a.length&&vs(a)?l[c]():l.thru(a)}return function(){var t=arguments,n=t[0];if(l&&1==t.length&&zo(n))return l.plant(n).value();for(var r=0,s=i?e[r].apply(this,t):n;++r<i;)s=e[r].call(this,s);return s}}))}function Nr(t,e,i,s,o,a,l,h,u,d){var p=e&c,f=1&e,m=2&e,g=24&e,v=512&e,y=m?r:Lr(t);return function c(){for(var _=arguments.length,x=n(_),M=_;M--;)x[M]=arguments[M];if(g)var b=ns(c),w=function(t,e){for(var i=t.length,n=0;i--;)t[i]===e&&++n;return n}(x,b);if(s&&(x=wr(x,s,o,g)),a&&(x=Sr(x,a,l,g)),_-=w,g&&_<d){var S=oi(x,b);return Hr(t,e,Nr,c.placeholder,i,x,S,h,u,d-_)}var T=f?i:this,A=m?T[t]:t;return _=x.length,h?x=function(t,e){for(var i=t.length,n=mi(e.length,i),s=Tr(t);n--;){var o=e[n];t[n]=fs(o,i)?s[o]:r}return t}(x,h):v&&_>1&&x.reverse(),p&&u<_&&(x.length=u),this&&this!==ue&&this instanceof c&&(A=y||Lr(A)),A.apply(T,x)}}function Fr(t,e){return function(i,n){return function(t,e,i,n){return vn(t,(function(t,r,s){e(n,i(t),r,s)})),n}(i,t,e(n),{})}}function Ur(t,e){return function(i,n){var s;if(i===r&&n===r)return e;if(i!==r&&(s=i),n!==r){if(s===r)return n;"string"==typeof i||"string"==typeof n?(i=sr(i),n=sr(n)):(i=rr(i),n=rr(n)),s=t(i,n)}return s}}function Gr(t){return Qr((function(e){return e=Ie(e,Ye(rs())),qn((function(i){var n=this;return t(e,(function(t){return we(t,n,i)}))}))}))}function zr(t,e){var i=(e=e===r?" ":sr(e)).length;if(i<2)return i?Wn(e,t):e;var n=Wn(e,de(t/li(e)));return ni(e)?vr(ci(n),0,t).join(""):n.slice(0,t)}function kr(t){return function(e,i,s){return s&&"number"!=typeof s&&ms(e,i,s)&&(i=s=r),e=ca(e),i===r?(i=e,e=0):i=ca(i),function(t,e,i,r){for(var s=-1,o=fi(de((e-t)/(i||1)),0),a=n(o);o--;)a[r?o:++s]=t,t+=i;return a}(e,i,s=s===r?e<i?1:-1:ca(s),t)}}function jr(t){return function(e,i){return"string"==typeof e&&"string"==typeof i||(e=da(e),i=da(i)),t(e,i)}}function Hr(t,e,i,n,s,o,a,c,h,u){var d=8&e;e|=d?l:64,4&(e&=~(d?64:l))||(e&=-4);var p=[t,e,s,d?o:r,d?a:r,d?r:o,d?r:a,c,h,u],f=i.apply(r,p);return vs(t)&&Ts(f,p),f.placeholder=n,Cs(f,t,e)}function Vr(t){var e=wt[t];return function(t,i){if(t=da(t),(i=null==i?0:mi(ha(i),292))&&Ne(t)){var n=(fa(t)+"e").split("e");return+((n=(fa(e(n[0]+"e"+(+n[1]+i)))+"e").split("e"))[0]+"e"+(+n[1]-i))}return e(t)}}var Wr=wi&&1/ai(new wi([,-0]))[1]==h?function(t){return new wi(t)}:rl;function qr(t){return function(e){var i=hs(e);return i==b?ri(e):i==E?function(t){var e=-1,i=Array(t.size);return t.forEach((function(t){i[++e]=[t,t]})),i}(e):function(t,e){return Ie(e,(function(e){return[e,t[e]]}))}(e,t(e))}}function Jr(t,e,i,o,h,u,d,p){var f=2&e;if(!f&&"function"!=typeof t)throw new Et(s);var m=o?o.length:0;if(m||(e&=-97,o=h=r),d=d===r?d:fi(ha(d),0),p=p===r?p:ha(p),m-=h?h.length:0,64&e){var g=o,v=h;o=h=r}var y=f?r:es(t),_=[t,e,i,o,h,g,v,u,d,p];if(y&&function(t,e){var i=t[1],n=e[1],r=i|n,s=r<131,o=n==c&&8==i||n==c&&256==i&&t[7].length<=e[8]||384==n&&e[7].length<=e[8]&&8==i;if(!s&&!o)return t;1&n&&(t[2]=e[2],r|=1&i?0:4);var l=e[3];if(l){var h=t[3];t[3]=h?wr(h,l,e[4]):l,t[4]=h?oi(t[3],a):e[4]}(l=e[5])&&(h=t[5],t[5]=h?Sr(h,l,e[6]):l,t[6]=h?oi(t[5],a):e[6]),(l=e[7])&&(t[7]=l),n&c&&(t[8]=null==t[8]?e[8]:mi(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=r}(_,y),t=_[0],e=_[1],i=_[2],o=_[3],h=_[4],!(p=_[9]=_[9]===r?f?0:t.length:fi(_[9]-m,0))&&24&e&&(e&=-25),e&&1!=e)x=8==e||16==e?function(t,e,i){var s=Lr(t);return function o(){for(var a=arguments.length,l=n(a),c=a,h=ns(o);c--;)l[c]=arguments[c];var u=a<3&&l[0]!==h&&l[a-1]!==h?[]:oi(l,h);return(a-=u.length)<i?Hr(t,e,Nr,o.placeholder,r,l,u,r,r,i-a):we(this&&this!==ue&&this instanceof o?s:t,this,l)}}(t,e,p):e!=l&&33!=e||h.length?Nr.apply(r,_):function(t,e,i,r){var s=1&e,o=Lr(t);return function e(){for(var a=-1,l=arguments.length,c=-1,h=r.length,u=n(h+l),d=this&&this!==ue&&this instanceof e?o:t;++c<h;)u[c]=r[c];for(;l--;)u[c++]=arguments[++a];return we(d,s?i:this,u)}}(t,e,i,o);else var x=function(t,e,i){var n=1&e,r=Lr(t);return function e(){return(this&&this!==ue&&this instanceof e?r:t).apply(n?i:this,arguments)}}(t,e,i);return Cs((y?Zn:Ts)(x,_),t,e)}function Xr(t,e,i,n){return t===r||No(t,Pt[i])&&!Lt.call(n,i)?e:t}function Yr(t,e,i,n,s,o){return Zo(t)&&Zo(e)&&(o.set(e,t),Un(t,e,r,Yr,o),o.delete(e)),t}function Zr(t){return ta(t)?r:t}function Kr(t,e,i,n,s,o){var a=1&i,l=t.length,c=e.length;if(l!=c&&!(a&&c>l))return!1;var h=o.get(t),u=o.get(e);if(h&&u)return h==e&&u==t;var d=-1,p=!0,f=2&i?new Vi:r;for(o.set(t,e),o.set(e,t);++d<l;){var m=t[d],g=e[d];if(n)var v=a?n(g,m,d,e,t,o):n(m,g,d,t,e,o);if(v!==r){if(v)continue;p=!1;break}if(f){if(!Be(e,(function(t,e){if(!Ke(f,e)&&(m===t||s(m,t,i,n,o)))return f.push(e)}))){p=!1;break}}else if(m!==g&&!s(m,g,i,n,o)){p=!1;break}}return o.delete(t),o.delete(e),p}function Qr(t){return Es(bs(t,r,zs),t+"")}function $r(t){return Mn(t,Ea,ls)}function ts(t){return Mn(t,Ca,cs)}var es=Ai?function(t){return Ai.get(t)}:rl;function is(t){for(var e=t.name+"",i=Ei[e],n=Lt.call(Ei,e)?i.length:0;n--;){var r=i[n],s=r.func;if(null==s||s==t)return r.name}return e}function ns(t){return(Lt.call(Ni,"placeholder")?Ni:t).placeholder}function rs(){var t=Ni.iteratee||tl;return t=t===tl?Dn:t,arguments.length?t(arguments[0],arguments[1]):t}function ss(t,e){var i,n,r=t.__data__;return("string"==(n=typeof(i=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==i:null===i)?r["string"==typeof e?"string":"hash"]:r.map}function os(t){for(var e=Ea(t),i=e.length;i--;){var n=e[i],r=t[n];e[i]=[n,r,xs(r)]}return e}function as(t,e){var i=function(t,e){return null==t?r:t[e]}(t,e);return In(i)?i:r}var ls=me?function(t){return null==t?[]:(t=St(t),Ce(me(t),(function(e){return qt.call(t,e)})))}:ul,cs=me?function(t){for(var e=[];t;)De(e,ls(t)),t=Vt(t);return e}:ul,hs=bn;function us(t,e,i){for(var n=-1,r=(e=mr(e,t)).length,s=!1;++n<r;){var o=Ds(e[n]);if(!(s=null!=t&&i(t,o)))break;t=t[o]}return s||++n!=r?s:!!(r=null==t?0:t.length)&&Yo(r)&&fs(o,r)&&(zo(t)||Go(t))}function ds(t){return"function"!=typeof t.constructor||_s(t)?{}:Fi(Vt(t))}function ps(t){return zo(t)||Go(t)||!!(Xt&&t&&t[Xt])}function fs(t,e){var i=typeof t;return!!(e=null==e?u:e)&&("number"==i||"symbol"!=i&&vt.test(t))&&t>-1&&t%1==0&&t<e}function ms(t,e,i){if(!Zo(i))return!1;var n=typeof e;return!!("number"==n?jo(i)&&fs(e,i.length):"string"==n&&e in i)&&No(i[e],t)}function gs(t,e){if(zo(t))return!1;var i=typeof t;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=t&&!ra(t))||$.test(t)||!Q.test(t)||null!=e&&t in St(e)}function vs(t){var e=is(t),i=Ni[e];if("function"!=typeof i||!(e in zi.prototype))return!1;if(t===i)return!0;var n=es(i);return!!n&&t===n[0]}(xi&&hs(new xi(new ArrayBuffer(1)))!=D||Mi&&hs(new Mi)!=b||bi&&hs(bi.resolve())!=T||wi&&hs(new wi)!=E||Si&&hs(new Si)!=P)&&(hs=function(t){var e=bn(t),i=e==S?t.constructor:r,n=i?Ls(i):"";if(n)switch(n){case Ci:return D;case Oi:return b;case Pi:return T;case Ii:return E;case Di:return P}return e});var ys=It?Jo:dl;function _s(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Pt)}function xs(t){return t==t&&!Zo(t)}function Ms(t,e){return function(i){return null!=i&&i[t]===e&&(e!==r||t in St(i))}}function bs(t,e,i){return e=fi(e===r?t.length-1:e,0),function(){for(var r=arguments,s=-1,o=fi(r.length-e,0),a=n(o);++s<o;)a[s]=r[e+s];s=-1;for(var l=n(e+1);++s<e;)l[s]=r[s];return l[e]=i(a),we(t,this,l)}}function ws(t,e){return e.length<2?t:xn(t,$n(e,0,-1))}function Ss(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var Ts=Os(Zn),As=he||function(t,e){return ue.setTimeout(t,e)},Es=Os(Kn);function Cs(t,e,i){var n=e+"";return Es(t,function(t,e){var i=e.length;if(!i)return t;var n=i-1;return e[n]=(i>1?"& ":"")+e[n],e=e.join(i>2?", ":" "),t.replace(st,"{\n/* [wrapped with "+e+"] */\n")}(n,function(t,e){return Te(f,(function(i){var n="_."+i[0];e&i[1]&&!Oe(t,n)&&t.push(n)})),t.sort()}(function(t){var e=t.match(ot);return e?e[1].split(at):[]}(n),i)))}function Os(t){var e=0,i=0;return function(){var n=gi(),s=16-(n-i);if(i=n,s>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(r,arguments)}}function Ps(t,e){var i=-1,n=t.length,s=n-1;for(e=e===r?n:e;++i<e;){var o=Vn(i,s),a=t[o];t[o]=t[i],t[i]=a}return t.length=e,t}var Is=function(t){var e=Po((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(tt,(function(t,i,n,r){e.push(n?r.replace(ht,"$1"):i||t)})),e}),(function(t){return 500===i.size&&i.clear(),t})),i=e.cache;return e}();function Ds(t){if("string"==typeof t||ra(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function Ls(t){if(null!=t){try{return Dt.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Rs(t){if(t instanceof zi)return t.clone();var e=new Gi(t.__wrapped__,t.__chain__);return e.__actions__=Tr(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var Bs=qn((function(t,e){return Ho(t)?ln(t,fn(e,1,Ho,!0)):[]})),Ns=qn((function(t,e){var i=Ws(e);return Ho(i)&&(i=r),Ho(t)?ln(t,fn(e,1,Ho,!0),rs(i,2)):[]})),Fs=qn((function(t,e){var i=Ws(e);return Ho(i)&&(i=r),Ho(t)?ln(t,fn(e,1,Ho,!0),r,i):[]}));function Us(t,e,i){var n=null==t?0:t.length;if(!n)return-1;var r=null==i?0:ha(i);return r<0&&(r=fi(n+r,0)),Ue(t,rs(e,3),r)}function Gs(t,e,i){var n=null==t?0:t.length;if(!n)return-1;var s=n-1;return i!==r&&(s=ha(i),s=i<0?fi(n+s,0):mi(s,n-1)),Ue(t,rs(e,3),s,!0)}function zs(t){return null!=t&&t.length?fn(t,1):[]}function ks(t){return t&&t.length?t[0]:r}var js=qn((function(t){var e=Ie(t,pr);return e.length&&e[0]===t[0]?An(e):[]})),Hs=qn((function(t){var e=Ws(t),i=Ie(t,pr);return e===Ws(i)?e=r:i.pop(),i.length&&i[0]===t[0]?An(i,rs(e,2)):[]})),Vs=qn((function(t){var e=Ws(t),i=Ie(t,pr);return(e="function"==typeof e?e:r)&&i.pop(),i.length&&i[0]===t[0]?An(i,r,e):[]}));function Ws(t){var e=null==t?0:t.length;return e?t[e-1]:r}var qs=qn(Js);function Js(t,e){return t&&t.length&&e&&e.length?jn(t,e):t}var Xs=Qr((function(t,e){var i=null==t?0:t.length,n=nn(t,e);return Hn(t,Ie(e,(function(t){return fs(t,i)?+t:t})).sort(br)),n}));function Ys(t){return null==t?t:_i.call(t)}var Zs=qn((function(t){return or(fn(t,1,Ho,!0))})),Ks=qn((function(t){var e=Ws(t);return Ho(e)&&(e=r),or(fn(t,1,Ho,!0),rs(e,2))})),Qs=qn((function(t){var e=Ws(t);return e="function"==typeof e?e:r,or(fn(t,1,Ho,!0),r,e)}));function $s(t){if(!t||!t.length)return[];var e=0;return t=Ce(t,(function(t){if(Ho(t))return e=fi(t.length,e),!0})),Je(e,(function(e){return Ie(t,He(e))}))}function to(t,e){if(!t||!t.length)return[];var i=$s(t);return null==e?i:Ie(i,(function(t){return we(e,r,t)}))}var eo=qn((function(t,e){return Ho(t)?ln(t,e):[]})),io=qn((function(t){return ur(Ce(t,Ho))})),no=qn((function(t){var e=Ws(t);return Ho(e)&&(e=r),ur(Ce(t,Ho),rs(e,2))})),ro=qn((function(t){var e=Ws(t);return e="function"==typeof e?e:r,ur(Ce(t,Ho),r,e)})),so=qn($s),oo=qn((function(t){var e=t.length,i=e>1?t[e-1]:r;return i="function"==typeof i?(t.pop(),i):r,to(t,i)}));function ao(t){var e=Ni(t);return e.__chain__=!0,e}function lo(t,e){return e(t)}var co=Qr((function(t){var e=t.length,i=e?t[0]:0,n=this.__wrapped__,s=function(e){return nn(e,t)};return!(e>1||this.__actions__.length)&&n instanceof zi&&fs(i)?((n=n.slice(i,+i+(e?1:0))).__actions__.push({func:lo,args:[s],thisArg:r}),new Gi(n,this.__chain__).thru((function(t){return e&&!t.length&&t.push(r),t}))):this.thru(s)})),ho=Er((function(t,e,i){Lt.call(t,i)?++t[i]:en(t,i,1)})),uo=Rr(Us),po=Rr(Gs);function fo(t,e){return(zo(t)?Te:cn)(t,rs(e,3))}function mo(t,e){return(zo(t)?Ae:hn)(t,rs(e,3))}var go=Er((function(t,e,i){Lt.call(t,i)?t[i].push(e):en(t,i,[e])})),vo=qn((function(t,e,i){var r=-1,s="function"==typeof e,o=jo(t)?n(t.length):[];return cn(t,(function(t){o[++r]=s?we(e,t,i):En(t,e,i)})),o})),yo=Er((function(t,e,i){en(t,i,e)}));function _o(t,e){return(zo(t)?Ie:Bn)(t,rs(e,3))}var xo=Er((function(t,e,i){t[i?0:1].push(e)}),(function(){return[[],[]]})),Mo=qn((function(t,e){if(null==t)return[];var i=e.length;return i>1&&ms(t,e[0],e[1])?e=[]:i>2&&ms(e[0],e[1],e[2])&&(e=[e[0]]),zn(t,fn(e,1),[])})),bo=ce||function(){return ue.Date.now()};function wo(t,e,i){return e=i?r:e,e=t&&null==e?t.length:e,Jr(t,c,r,r,r,r,e)}function So(t,e){var i;if("function"!=typeof e)throw new Et(s);return t=ha(t),function(){return--t>0&&(i=e.apply(this,arguments)),t<=1&&(e=r),i}}var To=qn((function(t,e,i){var n=1;if(i.length){var r=oi(i,ns(To));n|=l}return Jr(t,n,e,i,r)})),Ao=qn((function(t,e,i){var n=3;if(i.length){var r=oi(i,ns(Ao));n|=l}return Jr(e,n,t,i,r)}));function Eo(t,e,i){var n,o,a,l,c,h,u=0,d=!1,p=!1,f=!0;if("function"!=typeof t)throw new Et(s);function m(e){var i=n,s=o;return n=o=r,u=e,l=t.apply(s,i)}function g(t){var i=t-h;return h===r||i>=e||i<0||p&&t-u>=a}function v(){var t=bo();if(g(t))return y(t);c=As(v,function(t){var i=e-(t-h);return p?mi(i,a-(t-u)):i}(t))}function y(t){return c=r,f&&n?m(t):(n=o=r,l)}function _(){var t=bo(),i=g(t);if(n=arguments,o=this,h=t,i){if(c===r)return function(t){return u=t,c=As(v,e),d?m(t):l}(h);if(p)return yr(c),c=As(v,e),m(h)}return c===r&&(c=As(v,e)),l}return e=da(e)||0,Zo(i)&&(d=!!i.leading,a=(p="maxWait"in i)?fi(da(i.maxWait)||0,e):a,f="trailing"in i?!!i.trailing:f),_.cancel=function(){c!==r&&yr(c),u=0,n=h=o=c=r},_.flush=function(){return c===r?l:y(bo())},_}var Co=qn((function(t,e){return an(t,1,e)})),Oo=qn((function(t,e,i){return an(t,da(e)||0,i)}));function Po(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new Et(s);var i=function(){var n=arguments,r=e?e.apply(this,n):n[0],s=i.cache;if(s.has(r))return s.get(r);var o=t.apply(this,n);return i.cache=s.set(r,o)||s,o};return i.cache=new(Po.Cache||Hi),i}function Io(t){if("function"!=typeof t)throw new Et(s);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}Po.Cache=Hi;var Do=gr((function(t,e){var i=(e=1==e.length&&zo(e[0])?Ie(e[0],Ye(rs())):Ie(fn(e,1),Ye(rs()))).length;return qn((function(n){for(var r=-1,s=mi(n.length,i);++r<s;)n[r]=e[r].call(this,n[r]);return we(t,this,n)}))})),Lo=qn((function(t,e){var i=oi(e,ns(Lo));return Jr(t,l,r,e,i)})),Ro=qn((function(t,e){var i=oi(e,ns(Ro));return Jr(t,64,r,e,i)})),Bo=Qr((function(t,e){return Jr(t,256,r,r,r,e)}));function No(t,e){return t===e||t!=t&&e!=e}var Fo=jr(wn),Uo=jr((function(t,e){return t>=e})),Go=Cn(function(){return arguments}())?Cn:function(t){return Ko(t)&&Lt.call(t,"callee")&&!qt.call(t,"callee")},zo=n.isArray,ko=ve?Ye(ve):function(t){return Ko(t)&&bn(t)==I};function jo(t){return null!=t&&Yo(t.length)&&!Jo(t)}function Ho(t){return Ko(t)&&jo(t)}var Vo=ge||dl,Wo=ye?Ye(ye):function(t){return Ko(t)&&bn(t)==y};function qo(t){if(!Ko(t))return!1;var e=bn(t);return e==_||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!ta(t)}function Jo(t){if(!Zo(t))return!1;var e=bn(t);return e==x||e==M||"[object AsyncFunction]"==e||"[object Proxy]"==e}function Xo(t){return"number"==typeof t&&t==ha(t)}function Yo(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=u}function Zo(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function Ko(t){return null!=t&&"object"==typeof t}var Qo=_e?Ye(_e):function(t){return Ko(t)&&hs(t)==b};function $o(t){return"number"==typeof t||Ko(t)&&bn(t)==w}function ta(t){if(!Ko(t)||bn(t)!=S)return!1;var e=Vt(t);if(null===e)return!0;var i=Lt.call(e,"constructor")&&e.constructor;return"function"==typeof i&&i instanceof i&&Dt.call(i)==Ft}var ea=xe?Ye(xe):function(t){return Ko(t)&&bn(t)==A},ia=Me?Ye(Me):function(t){return Ko(t)&&hs(t)==E};function na(t){return"string"==typeof t||!zo(t)&&Ko(t)&&bn(t)==C}function ra(t){return"symbol"==typeof t||Ko(t)&&bn(t)==O}var sa=be?Ye(be):function(t){return Ko(t)&&Yo(t.length)&&!!re[bn(t)]},oa=jr(Rn),aa=jr((function(t,e){return t<=e}));function la(t){if(!t)return[];if(jo(t))return na(t)?ci(t):Tr(t);if(Yt&&t[Yt])return function(t){for(var e,i=[];!(e=t.next()).done;)i.push(e.value);return i}(t[Yt]());var e=hs(t);return(e==b?ri:e==E?ai:Na)(t)}function ca(t){return t?(t=da(t))===h||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}function ha(t){var e=ca(t),i=e%1;return e==e?i?e-i:e:0}function ua(t){return t?rn(ha(t),0,p):0}function da(t){if("number"==typeof t)return t;if(ra(t))return d;if(Zo(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=Zo(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Xe(t);var i=ft.test(t);return i||gt.test(t)?le(t.slice(2),i?2:8):pt.test(t)?d:+t}function pa(t){return Ar(t,Ca(t))}function fa(t){return null==t?"":sr(t)}var ma=Cr((function(t,e){if(_s(e)||jo(e))Ar(e,Ea(e),t);else for(var i in e)Lt.call(e,i)&&Ki(t,i,e[i])})),ga=Cr((function(t,e){Ar(e,Ca(e),t)})),va=Cr((function(t,e,i,n){Ar(e,Ca(e),t,n)})),ya=Cr((function(t,e,i,n){Ar(e,Ea(e),t,n)})),_a=Qr(nn),xa=qn((function(t,e){t=St(t);var i=-1,n=e.length,s=n>2?e[2]:r;for(s&&ms(e[0],e[1],s)&&(n=1);++i<n;)for(var o=e[i],a=Ca(o),l=-1,c=a.length;++l<c;){var h=a[l],u=t[h];(u===r||No(u,Pt[h])&&!Lt.call(t,h))&&(t[h]=o[h])}return t})),Ma=qn((function(t){return t.push(r,Yr),we(Pa,r,t)}));function ba(t,e,i){var n=null==t?r:xn(t,e);return n===r?i:n}function wa(t,e){return null!=t&&us(t,e,Tn)}var Sa=Fr((function(t,e,i){null!=e&&"function"!=typeof e.toString&&(e=Nt.call(e)),t[e]=i}),Za($a)),Ta=Fr((function(t,e,i){null!=e&&"function"!=typeof e.toString&&(e=Nt.call(e)),Lt.call(t,e)?t[e].push(i):t[e]=[i]}),rs),Aa=qn(En);function Ea(t){return jo(t)?qi(t):Ln(t)}function Ca(t){return jo(t)?qi(t,!0):function(t){if(!Zo(t))return function(t){var e=[];if(null!=t)for(var i in St(t))e.push(i);return e}(t);var e=_s(t),i=[];for(var n in t)("constructor"!=n||!e&&Lt.call(t,n))&&i.push(n);return i}(t)}var Oa=Cr((function(t,e,i){Un(t,e,i)})),Pa=Cr((function(t,e,i,n){Un(t,e,i,n)})),Ia=Qr((function(t,e){var i={};if(null==t)return i;var n=!1;e=Ie(e,(function(e){return e=mr(e,t),n||(n=e.length>1),e})),Ar(t,ts(t),i),n&&(i=sn(i,7,Zr));for(var r=e.length;r--;)ar(i,e[r]);return i})),Da=Qr((function(t,e){return null==t?{}:function(t,e){return kn(t,e,(function(e,i){return wa(t,i)}))}(t,e)}));function La(t,e){if(null==t)return{};var i=Ie(ts(t),(function(t){return[t]}));return e=rs(e),kn(t,i,(function(t,i){return e(t,i[0])}))}var Ra=qr(Ea),Ba=qr(Ca);function Na(t){return null==t?[]:Ze(t,Ea(t))}var Fa=Dr((function(t,e,i){return e=e.toLowerCase(),t+(i?Ua(e):e)}));function Ua(t){return qa(fa(t).toLowerCase())}function Ga(t){return(t=fa(t))&&t.replace(yt,ti).replace(Kt,"")}var za=Dr((function(t,e,i){return t+(i?"-":"")+e.toLowerCase()})),ka=Dr((function(t,e,i){return t+(i?" ":"")+e.toLowerCase()})),ja=Ir("toLowerCase"),Ha=Dr((function(t,e,i){return t+(i?"_":"")+e.toLowerCase()})),Va=Dr((function(t,e,i){return t+(i?" ":"")+qa(e)})),Wa=Dr((function(t,e,i){return t+(i?" ":"")+e.toUpperCase()})),qa=Ir("toUpperCase");function Ja(t,e,i){return t=fa(t),(e=i?r:e)===r?function(t){return ee.test(t)}(t)?function(t){return t.match($t)||[]}(t):function(t){return t.match(lt)||[]}(t):t.match(e)||[]}var Xa=qn((function(t,e){try{return we(t,r,e)}catch(t){return qo(t)?t:new Mt(t)}})),Ya=Qr((function(t,e){return Te(e,(function(e){e=Ds(e),en(t,e,To(t[e],t))})),t}));function Za(t){return function(){return t}}var Ka=Br(),Qa=Br(!0);function $a(t){return t}function tl(t){return Dn("function"==typeof t?t:sn(t,1))}var el=qn((function(t,e){return function(i){return En(i,t,e)}})),il=qn((function(t,e){return function(i){return En(t,i,e)}}));function nl(t,e,i){var n=Ea(e),r=_n(e,n);null!=i||Zo(e)&&(r.length||!n.length)||(i=e,e=t,t=this,r=_n(e,Ea(e)));var s=!(Zo(i)&&"chain"in i&&!i.chain),o=Jo(t);return Te(r,(function(i){var n=e[i];t[i]=n,o&&(t.prototype[i]=function(){var e=this.__chain__;if(s||e){var i=t(this.__wrapped__);return(i.__actions__=Tr(this.__actions__)).push({func:n,args:arguments,thisArg:t}),i.__chain__=e,i}return n.apply(t,De([this.value()],arguments))})})),t}function rl(){}var sl=Gr(Ie),ol=Gr(Ee),al=Gr(Be);function ll(t){return gs(t)?He(Ds(t)):function(t){return function(e){return xn(e,t)}}(t)}var cl=kr(),hl=kr(!0);function ul(){return[]}function dl(){return!1}var pl,fl=Ur((function(t,e){return t+e}),0),ml=Vr("ceil"),gl=Ur((function(t,e){return t/e}),1),vl=Vr("floor"),yl=Ur((function(t,e){return t*e}),1),_l=Vr("round"),xl=Ur((function(t,e){return t-e}),0);return Ni.after=function(t,e){if("function"!=typeof e)throw new Et(s);return t=ha(t),function(){if(--t<1)return e.apply(this,arguments)}},Ni.ary=wo,Ni.assign=ma,Ni.assignIn=ga,Ni.assignInWith=va,Ni.assignWith=ya,Ni.at=_a,Ni.before=So,Ni.bind=To,Ni.bindAll=Ya,Ni.bindKey=Ao,Ni.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return zo(t)?t:[t]},Ni.chain=ao,Ni.chunk=function(t,e,i){e=(i?ms(t,e,i):e===r)?1:fi(ha(e),0);var s=null==t?0:t.length;if(!s||e<1)return[];for(var o=0,a=0,l=n(de(s/e));o<s;)l[a++]=$n(t,o,o+=e);return l},Ni.compact=function(t){for(var e=-1,i=null==t?0:t.length,n=0,r=[];++e<i;){var s=t[e];s&&(r[n++]=s)}return r},Ni.concat=function(){var t=arguments.length;if(!t)return[];for(var e=n(t-1),i=arguments[0],r=t;r--;)e[r-1]=arguments[r];return De(zo(i)?Tr(i):[i],fn(e,1))},Ni.cond=function(t){var e=null==t?0:t.length,i=rs();return t=e?Ie(t,(function(t){if("function"!=typeof t[1])throw new Et(s);return[i(t[0]),t[1]]})):[],qn((function(i){for(var n=-1;++n<e;){var r=t[n];if(we(r[0],this,i))return we(r[1],this,i)}}))},Ni.conforms=function(t){return function(t){var e=Ea(t);return function(i){return on(i,t,e)}}(sn(t,1))},Ni.constant=Za,Ni.countBy=ho,Ni.create=function(t,e){var i=Fi(t);return null==e?i:tn(i,e)},Ni.curry=function t(e,i,n){var s=Jr(e,8,r,r,r,r,r,i=n?r:i);return s.placeholder=t.placeholder,s},Ni.curryRight=function t(e,i,n){var s=Jr(e,16,r,r,r,r,r,i=n?r:i);return s.placeholder=t.placeholder,s},Ni.debounce=Eo,Ni.defaults=xa,Ni.defaultsDeep=Ma,Ni.defer=Co,Ni.delay=Oo,Ni.difference=Bs,Ni.differenceBy=Ns,Ni.differenceWith=Fs,Ni.drop=function(t,e,i){var n=null==t?0:t.length;return n?$n(t,(e=i||e===r?1:ha(e))<0?0:e,n):[]},Ni.dropRight=function(t,e,i){var n=null==t?0:t.length;return n?$n(t,0,(e=n-(e=i||e===r?1:ha(e)))<0?0:e):[]},Ni.dropRightWhile=function(t,e){return t&&t.length?cr(t,rs(e,3),!0,!0):[]},Ni.dropWhile=function(t,e){return t&&t.length?cr(t,rs(e,3),!0):[]},Ni.fill=function(t,e,i,n){var s=null==t?0:t.length;return s?(i&&"number"!=typeof i&&ms(t,e,i)&&(i=0,n=s),function(t,e,i,n){var s=t.length;for((i=ha(i))<0&&(i=-i>s?0:s+i),(n=n===r||n>s?s:ha(n))<0&&(n+=s),n=i>n?0:ua(n);i<n;)t[i++]=e;return t}(t,e,i,n)):[]},Ni.filter=function(t,e){return(zo(t)?Ce:pn)(t,rs(e,3))},Ni.flatMap=function(t,e){return fn(_o(t,e),1)},Ni.flatMapDeep=function(t,e){return fn(_o(t,e),h)},Ni.flatMapDepth=function(t,e,i){return i=i===r?1:ha(i),fn(_o(t,e),i)},Ni.flatten=zs,Ni.flattenDeep=function(t){return null!=t&&t.length?fn(t,h):[]},Ni.flattenDepth=function(t,e){return null!=t&&t.length?fn(t,e=e===r?1:ha(e)):[]},Ni.flip=function(t){return Jr(t,512)},Ni.flow=Ka,Ni.flowRight=Qa,Ni.fromPairs=function(t){for(var e=-1,i=null==t?0:t.length,n={};++e<i;){var r=t[e];n[r[0]]=r[1]}return n},Ni.functions=function(t){return null==t?[]:_n(t,Ea(t))},Ni.functionsIn=function(t){return null==t?[]:_n(t,Ca(t))},Ni.groupBy=go,Ni.initial=function(t){return null!=t&&t.length?$n(t,0,-1):[]},Ni.intersection=js,Ni.intersectionBy=Hs,Ni.intersectionWith=Vs,Ni.invert=Sa,Ni.invertBy=Ta,Ni.invokeMap=vo,Ni.iteratee=tl,Ni.keyBy=yo,Ni.keys=Ea,Ni.keysIn=Ca,Ni.map=_o,Ni.mapKeys=function(t,e){var i={};return e=rs(e,3),vn(t,(function(t,n,r){en(i,e(t,n,r),t)})),i},Ni.mapValues=function(t,e){var i={};return e=rs(e,3),vn(t,(function(t,n,r){en(i,n,e(t,n,r))})),i},Ni.matches=function(t){return Nn(sn(t,1))},Ni.matchesProperty=function(t,e){return Fn(t,sn(e,1))},Ni.memoize=Po,Ni.merge=Oa,Ni.mergeWith=Pa,Ni.method=el,Ni.methodOf=il,Ni.mixin=nl,Ni.negate=Io,Ni.nthArg=function(t){return t=ha(t),qn((function(e){return Gn(e,t)}))},Ni.omit=Ia,Ni.omitBy=function(t,e){return La(t,Io(rs(e)))},Ni.once=function(t){return So(2,t)},Ni.orderBy=function(t,e,i,n){return null==t?[]:(zo(e)||(e=null==e?[]:[e]),zo(i=n?r:i)||(i=null==i?[]:[i]),zn(t,e,i))},Ni.over=sl,Ni.overArgs=Do,Ni.overEvery=ol,Ni.overSome=al,Ni.partial=Lo,Ni.partialRight=Ro,Ni.partition=xo,Ni.pick=Da,Ni.pickBy=La,Ni.property=ll,Ni.propertyOf=function(t){return function(e){return null==t?r:xn(t,e)}},Ni.pull=qs,Ni.pullAll=Js,Ni.pullAllBy=function(t,e,i){return t&&t.length&&e&&e.length?jn(t,e,rs(i,2)):t},Ni.pullAllWith=function(t,e,i){return t&&t.length&&e&&e.length?jn(t,e,r,i):t},Ni.pullAt=Xs,Ni.range=cl,Ni.rangeRight=hl,Ni.rearg=Bo,Ni.reject=function(t,e){return(zo(t)?Ce:pn)(t,Io(rs(e,3)))},Ni.remove=function(t,e){var i=[];if(!t||!t.length)return i;var n=-1,r=[],s=t.length;for(e=rs(e,3);++n<s;){var o=t[n];e(o,n,t)&&(i.push(o),r.push(n))}return Hn(t,r),i},Ni.rest=function(t,e){if("function"!=typeof t)throw new Et(s);return qn(t,e=e===r?e:ha(e))},Ni.reverse=Ys,Ni.sampleSize=function(t,e,i){return e=(i?ms(t,e,i):e===r)?1:ha(e),(zo(t)?Xi:Xn)(t,e)},Ni.set=function(t,e,i){return null==t?t:Yn(t,e,i)},Ni.setWith=function(t,e,i,n){return n="function"==typeof n?n:r,null==t?t:Yn(t,e,i,n)},Ni.shuffle=function(t){return(zo(t)?Yi:Qn)(t)},Ni.slice=function(t,e,i){var n=null==t?0:t.length;return n?(i&&"number"!=typeof i&&ms(t,e,i)?(e=0,i=n):(e=null==e?0:ha(e),i=i===r?n:ha(i)),$n(t,e,i)):[]},Ni.sortBy=Mo,Ni.sortedUniq=function(t){return t&&t.length?nr(t):[]},Ni.sortedUniqBy=function(t,e){return t&&t.length?nr(t,rs(e,2)):[]},Ni.split=function(t,e,i){return i&&"number"!=typeof i&&ms(t,e,i)&&(e=i=r),(i=i===r?p:i>>>0)?(t=fa(t))&&("string"==typeof e||null!=e&&!ea(e))&&!(e=sr(e))&&ni(t)?vr(ci(t),0,i):t.split(e,i):[]},Ni.spread=function(t,e){if("function"!=typeof t)throw new Et(s);return e=null==e?0:fi(ha(e),0),qn((function(i){var n=i[e],r=vr(i,0,e);return n&&De(r,n),we(t,this,r)}))},Ni.tail=function(t){var e=null==t?0:t.length;return e?$n(t,1,e):[]},Ni.take=function(t,e,i){return t&&t.length?$n(t,0,(e=i||e===r?1:ha(e))<0?0:e):[]},Ni.takeRight=function(t,e,i){var n=null==t?0:t.length;return n?$n(t,(e=n-(e=i||e===r?1:ha(e)))<0?0:e,n):[]},Ni.takeRightWhile=function(t,e){return t&&t.length?cr(t,rs(e,3),!1,!0):[]},Ni.takeWhile=function(t,e){return t&&t.length?cr(t,rs(e,3)):[]},Ni.tap=function(t,e){return e(t),t},Ni.throttle=function(t,e,i){var n=!0,r=!0;if("function"!=typeof t)throw new Et(s);return Zo(i)&&(n="leading"in i?!!i.leading:n,r="trailing"in i?!!i.trailing:r),Eo(t,e,{leading:n,maxWait:e,trailing:r})},Ni.thru=lo,Ni.toArray=la,Ni.toPairs=Ra,Ni.toPairsIn=Ba,Ni.toPath=function(t){return zo(t)?Ie(t,Ds):ra(t)?[t]:Tr(Is(fa(t)))},Ni.toPlainObject=pa,Ni.transform=function(t,e,i){var n=zo(t),r=n||Vo(t)||sa(t);if(e=rs(e,4),null==i){var s=t&&t.constructor;i=r?n?new s:[]:Zo(t)&&Jo(s)?Fi(Vt(t)):{}}return(r?Te:vn)(t,(function(t,n,r){return e(i,t,n,r)})),i},Ni.unary=function(t){return wo(t,1)},Ni.union=Zs,Ni.unionBy=Ks,Ni.unionWith=Qs,Ni.uniq=function(t){return t&&t.length?or(t):[]},Ni.uniqBy=function(t,e){return t&&t.length?or(t,rs(e,2)):[]},Ni.uniqWith=function(t,e){return e="function"==typeof e?e:r,t&&t.length?or(t,r,e):[]},Ni.unset=function(t,e){return null==t||ar(t,e)},Ni.unzip=$s,Ni.unzipWith=to,Ni.update=function(t,e,i){return null==t?t:lr(t,e,fr(i))},Ni.updateWith=function(t,e,i,n){return n="function"==typeof n?n:r,null==t?t:lr(t,e,fr(i),n)},Ni.values=Na,Ni.valuesIn=function(t){return null==t?[]:Ze(t,Ca(t))},Ni.without=eo,Ni.words=Ja,Ni.wrap=function(t,e){return Lo(fr(e),t)},Ni.xor=io,Ni.xorBy=no,Ni.xorWith=ro,Ni.zip=so,Ni.zipObject=function(t,e){return dr(t||[],e||[],Ki)},Ni.zipObjectDeep=function(t,e){return dr(t||[],e||[],Yn)},Ni.zipWith=oo,Ni.entries=Ra,Ni.entriesIn=Ba,Ni.extend=ga,Ni.extendWith=va,nl(Ni,Ni),Ni.add=fl,Ni.attempt=Xa,Ni.camelCase=Fa,Ni.capitalize=Ua,Ni.ceil=ml,Ni.clamp=function(t,e,i){return i===r&&(i=e,e=r),i!==r&&(i=(i=da(i))==i?i:0),e!==r&&(e=(e=da(e))==e?e:0),rn(da(t),e,i)},Ni.clone=function(t){return sn(t,4)},Ni.cloneDeep=function(t){return sn(t,5)},Ni.cloneDeepWith=function(t,e){return sn(t,5,e="function"==typeof e?e:r)},Ni.cloneWith=function(t,e){return sn(t,4,e="function"==typeof e?e:r)},Ni.conformsTo=function(t,e){return null==e||on(t,e,Ea(e))},Ni.deburr=Ga,Ni.defaultTo=function(t,e){return null==t||t!=t?e:t},Ni.divide=gl,Ni.endsWith=function(t,e,i){t=fa(t),e=sr(e);var n=t.length,s=i=i===r?n:rn(ha(i),0,n);return(i-=e.length)>=0&&t.slice(i,s)==e},Ni.eq=No,Ni.escape=function(t){return(t=fa(t))&&X.test(t)?t.replace(q,ei):t},Ni.escapeRegExp=function(t){return(t=fa(t))&&it.test(t)?t.replace(et,"\\$&"):t},Ni.every=function(t,e,i){var n=zo(t)?Ee:un;return i&&ms(t,e,i)&&(e=r),n(t,rs(e,3))},Ni.find=uo,Ni.findIndex=Us,Ni.findKey=function(t,e){return Fe(t,rs(e,3),vn)},Ni.findLast=po,Ni.findLastIndex=Gs,Ni.findLastKey=function(t,e){return Fe(t,rs(e,3),yn)},Ni.floor=vl,Ni.forEach=fo,Ni.forEachRight=mo,Ni.forIn=function(t,e){return null==t?t:mn(t,rs(e,3),Ca)},Ni.forInRight=function(t,e){return null==t?t:gn(t,rs(e,3),Ca)},Ni.forOwn=function(t,e){return t&&vn(t,rs(e,3))},Ni.forOwnRight=function(t,e){return t&&yn(t,rs(e,3))},Ni.get=ba,Ni.gt=Fo,Ni.gte=Uo,Ni.has=function(t,e){return null!=t&&us(t,e,Sn)},Ni.hasIn=wa,Ni.head=ks,Ni.identity=$a,Ni.includes=function(t,e,i,n){t=jo(t)?t:Na(t),i=i&&!n?ha(i):0;var r=t.length;return i<0&&(i=fi(r+i,0)),na(t)?i<=r&&t.indexOf(e,i)>-1:!!r&&Ge(t,e,i)>-1},Ni.indexOf=function(t,e,i){var n=null==t?0:t.length;if(!n)return-1;var r=null==i?0:ha(i);return r<0&&(r=fi(n+r,0)),Ge(t,e,r)},Ni.inRange=function(t,e,i){return e=ca(e),i===r?(i=e,e=0):i=ca(i),function(t,e,i){return t>=mi(e,i)&&t<fi(e,i)}(t=da(t),e,i)},Ni.invoke=Aa,Ni.isArguments=Go,Ni.isArray=zo,Ni.isArrayBuffer=ko,Ni.isArrayLike=jo,Ni.isArrayLikeObject=Ho,Ni.isBoolean=function(t){return!0===t||!1===t||Ko(t)&&bn(t)==v},Ni.isBuffer=Vo,Ni.isDate=Wo,Ni.isElement=function(t){return Ko(t)&&1===t.nodeType&&!ta(t)},Ni.isEmpty=function(t){if(null==t)return!0;if(jo(t)&&(zo(t)||"string"==typeof t||"function"==typeof t.splice||Vo(t)||sa(t)||Go(t)))return!t.length;var e=hs(t);if(e==b||e==E)return!t.size;if(_s(t))return!Ln(t).length;for(var i in t)if(Lt.call(t,i))return!1;return!0},Ni.isEqual=function(t,e){return On(t,e)},Ni.isEqualWith=function(t,e,i){var n=(i="function"==typeof i?i:r)?i(t,e):r;return n===r?On(t,e,r,i):!!n},Ni.isError=qo,Ni.isFinite=function(t){return"number"==typeof t&&Ne(t)},Ni.isFunction=Jo,Ni.isInteger=Xo,Ni.isLength=Yo,Ni.isMap=Qo,Ni.isMatch=function(t,e){return t===e||Pn(t,e,os(e))},Ni.isMatchWith=function(t,e,i){return i="function"==typeof i?i:r,Pn(t,e,os(e),i)},Ni.isNaN=function(t){return $o(t)&&t!=+t},Ni.isNative=function(t){if(ys(t))throw new Mt("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return In(t)},Ni.isNil=function(t){return null==t},Ni.isNull=function(t){return null===t},Ni.isNumber=$o,Ni.isObject=Zo,Ni.isObjectLike=Ko,Ni.isPlainObject=ta,Ni.isRegExp=ea,Ni.isSafeInteger=function(t){return Xo(t)&&t>=-9007199254740991&&t<=u},Ni.isSet=ia,Ni.isString=na,Ni.isSymbol=ra,Ni.isTypedArray=sa,Ni.isUndefined=function(t){return t===r},Ni.isWeakMap=function(t){return Ko(t)&&hs(t)==P},Ni.isWeakSet=function(t){return Ko(t)&&"[object WeakSet]"==bn(t)},Ni.join=function(t,e){return null==t?"":Ve.call(t,e)},Ni.kebabCase=za,Ni.last=Ws,Ni.lastIndexOf=function(t,e,i){var n=null==t?0:t.length;if(!n)return-1;var s=n;return i!==r&&(s=(s=ha(i))<0?fi(n+s,0):mi(s,n-1)),e==e?function(t,e,i){for(var n=i+1;n--;)if(t[n]===e)return n;return n}(t,e,s):Ue(t,ke,s,!0)},Ni.lowerCase=ka,Ni.lowerFirst=ja,Ni.lt=oa,Ni.lte=aa,Ni.max=function(t){return t&&t.length?dn(t,$a,wn):r},Ni.maxBy=function(t,e){return t&&t.length?dn(t,rs(e,2),wn):r},Ni.mean=function(t){return je(t,$a)},Ni.meanBy=function(t,e){return je(t,rs(e,2))},Ni.min=function(t){return t&&t.length?dn(t,$a,Rn):r},Ni.minBy=function(t,e){return t&&t.length?dn(t,rs(e,2),Rn):r},Ni.stubArray=ul,Ni.stubFalse=dl,Ni.stubObject=function(){return{}},Ni.stubString=function(){return""},Ni.stubTrue=function(){return!0},Ni.multiply=yl,Ni.nth=function(t,e){return t&&t.length?Gn(t,ha(e)):r},Ni.noConflict=function(){return ue._===this&&(ue._=Ut),this},Ni.noop=rl,Ni.now=bo,Ni.pad=function(t,e,i){t=fa(t);var n=(e=ha(e))?li(t):0;if(!e||n>=e)return t;var r=(e-n)/2;return zr(pe(r),i)+t+zr(de(r),i)},Ni.padEnd=function(t,e,i){t=fa(t);var n=(e=ha(e))?li(t):0;return e&&n<e?t+zr(e-n,i):t},Ni.padStart=function(t,e,i){t=fa(t);var n=(e=ha(e))?li(t):0;return e&&n<e?zr(e-n,i)+t:t},Ni.parseInt=function(t,e,i){return i||null==e?e=0:e&&(e=+e),vi(fa(t).replace(nt,""),e||0)},Ni.random=function(t,e,i){if(i&&"boolean"!=typeof i&&ms(t,e,i)&&(e=i=r),i===r&&("boolean"==typeof e?(i=e,e=r):"boolean"==typeof t&&(i=t,t=r)),t===r&&e===r?(t=0,e=1):(t=ca(t),e===r?(e=t,t=0):e=ca(e)),t>e){var n=t;t=e,e=n}if(i||t%1||e%1){var s=yi();return mi(t+s*(e-t+ae("1e-"+((s+"").length-1))),e)}return Vn(t,e)},Ni.reduce=function(t,e,i){var n=zo(t)?Le:We,r=arguments.length<3;return n(t,rs(e,4),i,r,cn)},Ni.reduceRight=function(t,e,i){var n=zo(t)?Re:We,r=arguments.length<3;return n(t,rs(e,4),i,r,hn)},Ni.repeat=function(t,e,i){return e=(i?ms(t,e,i):e===r)?1:ha(e),Wn(fa(t),e)},Ni.replace=function(){var t=arguments,e=fa(t[0]);return t.length<3?e:e.replace(t[1],t[2])},Ni.result=function(t,e,i){var n=-1,s=(e=mr(e,t)).length;for(s||(s=1,t=r);++n<s;){var o=null==t?r:t[Ds(e[n])];o===r&&(n=s,o=i),t=Jo(o)?o.call(t):o}return t},Ni.round=_l,Ni.runInContext=t,Ni.sample=function(t){return(zo(t)?Ji:Jn)(t)},Ni.size=function(t){if(null==t)return 0;if(jo(t))return na(t)?li(t):t.length;var e=hs(t);return e==b||e==E?t.size:Ln(t).length},Ni.snakeCase=Ha,Ni.some=function(t,e,i){var n=zo(t)?Be:tr;return i&&ms(t,e,i)&&(e=r),n(t,rs(e,3))},Ni.sortedIndex=function(t,e){return er(t,e)},Ni.sortedIndexBy=function(t,e,i){return ir(t,e,rs(i,2))},Ni.sortedIndexOf=function(t,e){var i=null==t?0:t.length;if(i){var n=er(t,e);if(n<i&&No(t[n],e))return n}return-1},Ni.sortedLastIndex=function(t,e){return er(t,e,!0)},Ni.sortedLastIndexBy=function(t,e,i){return ir(t,e,rs(i,2),!0)},Ni.sortedLastIndexOf=function(t,e){if(null!=t&&t.length){var i=er(t,e,!0)-1;if(No(t[i],e))return i}return-1},Ni.startCase=Va,Ni.startsWith=function(t,e,i){return t=fa(t),i=null==i?0:rn(ha(i),0,t.length),e=sr(e),t.slice(i,i+e.length)==e},Ni.subtract=xl,Ni.sum=function(t){return t&&t.length?qe(t,$a):0},Ni.sumBy=function(t,e){return t&&t.length?qe(t,rs(e,2)):0},Ni.template=function(t,e,i){var n=Ni.templateSettings;i&&ms(t,e,i)&&(e=r),t=fa(t),e=va({},e,n,Xr);var s,o,a=va({},e.imports,n.imports,Xr),l=Ea(a),c=Ze(a,l),h=0,u=e.interpolate||_t,d="__p += '",p=Tt((e.escape||_t).source+"|"+u.source+"|"+(u===K?ut:_t).source+"|"+(e.evaluate||_t).source+"|$","g"),f="//# sourceURL="+(Lt.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ne+"]")+"\n";t.replace(p,(function(e,i,n,r,a,l){return n||(n=r),d+=t.slice(h,l).replace(xt,ii),i&&(s=!0,d+="' +\n__e("+i+") +\n'"),a&&(o=!0,d+="';\n"+a+";\n__p += '"),n&&(d+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),h=l+e.length,e})),d+="';\n";var m=Lt.call(e,"variable")&&e.variable;if(m){if(ct.test(m))throw new Mt("Invalid `variable` option passed into `_.template`")}else d="with (obj) {\n"+d+"\n}\n";d=(o?d.replace(j,""):d).replace(H,"$1").replace(V,"$1;"),d="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(s?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var g=Xa((function(){return bt(l,f+"return "+d).apply(r,c)}));if(g.source=d,qo(g))throw g;return g},Ni.times=function(t,e){if((t=ha(t))<1||t>u)return[];var i=p,n=mi(t,p);e=rs(e),t-=p;for(var r=Je(n,e);++i<t;)e(i);return r},Ni.toFinite=ca,Ni.toInteger=ha,Ni.toLength=ua,Ni.toLower=function(t){return fa(t).toLowerCase()},Ni.toNumber=da,Ni.toSafeInteger=function(t){return t?rn(ha(t),-9007199254740991,u):0===t?t:0},Ni.toString=fa,Ni.toUpper=function(t){return fa(t).toUpperCase()},Ni.trim=function(t,e,i){if((t=fa(t))&&(i||e===r))return Xe(t);if(!t||!(e=sr(e)))return t;var n=ci(t),s=ci(e);return vr(n,Qe(n,s),$e(n,s)+1).join("")},Ni.trimEnd=function(t,e,i){if((t=fa(t))&&(i||e===r))return t.slice(0,hi(t)+1);if(!t||!(e=sr(e)))return t;var n=ci(t);return vr(n,0,$e(n,ci(e))+1).join("")},Ni.trimStart=function(t,e,i){if((t=fa(t))&&(i||e===r))return t.replace(nt,"");if(!t||!(e=sr(e)))return t;var n=ci(t);return vr(n,Qe(n,ci(e))).join("")},Ni.truncate=function(t,e){var i=30,n="...";if(Zo(e)){var s="separator"in e?e.separator:s;i="length"in e?ha(e.length):i,n="omission"in e?sr(e.omission):n}var o=(t=fa(t)).length;if(ni(t)){var a=ci(t);o=a.length}if(i>=o)return t;var l=i-li(n);if(l<1)return n;var c=a?vr(a,0,l).join(""):t.slice(0,l);if(s===r)return c+n;if(a&&(l+=c.length-l),ea(s)){if(t.slice(l).search(s)){var h,u=c;for(s.global||(s=Tt(s.source,fa(dt.exec(s))+"g")),s.lastIndex=0;h=s.exec(u);)var d=h.index;c=c.slice(0,d===r?l:d)}}else if(t.indexOf(sr(s),l)!=l){var p=c.lastIndexOf(s);p>-1&&(c=c.slice(0,p))}return c+n},Ni.unescape=function(t){return(t=fa(t))&&J.test(t)?t.replace(W,ui):t},Ni.uniqueId=function(t){var e=++Rt;return fa(t)+e},Ni.upperCase=Wa,Ni.upperFirst=qa,Ni.each=fo,Ni.eachRight=mo,Ni.first=ks,nl(Ni,(pl={},vn(Ni,(function(t,e){Lt.call(Ni.prototype,e)||(pl[e]=t)})),pl),{chain:!1}),Ni.VERSION="4.17.21",Te(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(t){Ni[t].placeholder=Ni})),Te(["drop","take"],(function(t,e){zi.prototype[t]=function(i){i=i===r?1:fi(ha(i),0);var n=this.__filtered__&&!e?new zi(this):this.clone();return n.__filtered__?n.__takeCount__=mi(i,n.__takeCount__):n.__views__.push({size:mi(i,p),type:t+(n.__dir__<0?"Right":"")}),n},zi.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}})),Te(["filter","map","takeWhile"],(function(t,e){var i=e+1,n=1==i||3==i;zi.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:rs(t,3),type:i}),e.__filtered__=e.__filtered__||n,e}})),Te(["head","last"],(function(t,e){var i="take"+(e?"Right":"");zi.prototype[t]=function(){return this[i](1).value()[0]}})),Te(["initial","tail"],(function(t,e){var i="drop"+(e?"":"Right");zi.prototype[t]=function(){return this.__filtered__?new zi(this):this[i](1)}})),zi.prototype.compact=function(){return this.filter($a)},zi.prototype.find=function(t){return this.filter(t).head()},zi.prototype.findLast=function(t){return this.reverse().find(t)},zi.prototype.invokeMap=qn((function(t,e){return"function"==typeof t?new zi(this):this.map((function(i){return En(i,t,e)}))})),zi.prototype.reject=function(t){return this.filter(Io(rs(t)))},zi.prototype.slice=function(t,e){t=ha(t);var i=this;return i.__filtered__&&(t>0||e<0)?new zi(i):(t<0?i=i.takeRight(-t):t&&(i=i.drop(t)),e!==r&&(i=(e=ha(e))<0?i.dropRight(-e):i.take(e-t)),i)},zi.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},zi.prototype.toArray=function(){return this.take(p)},vn(zi.prototype,(function(t,e){var i=/^(?:filter|find|map|reject)|While$/.test(e),n=/^(?:head|last)$/.test(e),s=Ni[n?"take"+("last"==e?"Right":""):e],o=n||/^find/.test(e);s&&(Ni.prototype[e]=function(){var e=this.__wrapped__,a=n?[1]:arguments,l=e instanceof zi,c=a[0],h=l||zo(e),u=function(t){var e=s.apply(Ni,De([t],a));return n&&d?e[0]:e};h&&i&&"function"==typeof c&&1!=c.length&&(l=h=!1);var d=this.__chain__,p=!!this.__actions__.length,f=o&&!d,m=l&&!p;if(!o&&h){e=m?e:new zi(this);var g=t.apply(e,a);return g.__actions__.push({func:lo,args:[u],thisArg:r}),new Gi(g,d)}return f&&m?t.apply(this,a):(g=this.thru(u),f?n?g.value()[0]:g.value():g)})})),Te(["pop","push","shift","sort","splice","unshift"],(function(t){var e=Ct[t],i=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",n=/^(?:pop|shift)$/.test(t);Ni.prototype[t]=function(){var t=arguments;if(n&&!this.__chain__){var r=this.value();return e.apply(zo(r)?r:[],t)}return this[i]((function(i){return e.apply(zo(i)?i:[],t)}))}})),vn(zi.prototype,(function(t,e){var i=Ni[e];if(i){var n=i.name+"";Lt.call(Ei,n)||(Ei[n]=[]),Ei[n].push({name:e,func:i})}})),Ei[Nr(r,2).name]=[{name:"wrapper",func:r}],zi.prototype.clone=function(){var t=new zi(this.__wrapped__);return t.__actions__=Tr(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=Tr(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=Tr(this.__views__),t},zi.prototype.reverse=function(){if(this.__filtered__){var t=new zi(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},zi.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,i=zo(t),n=e<0,r=i?t.length:0,s=function(t,e,i){for(var n=-1,r=i.length;++n<r;){var s=i[n],o=s.size;switch(s.type){case"drop":t+=o;break;case"dropRight":e-=o;break;case"take":e=mi(e,t+o);break;case"takeRight":t=fi(t,e-o)}}return{start:t,end:e}}(0,r,this.__views__),o=s.start,a=s.end,l=a-o,c=n?a:o-1,h=this.__iteratees__,u=h.length,d=0,p=mi(l,this.__takeCount__);if(!i||!n&&r==l&&p==l)return hr(t,this.__actions__);var f=[];t:for(;l--&&d<p;){for(var m=-1,g=t[c+=e];++m<u;){var v=h[m],y=v.iteratee,_=v.type,x=y(g);if(2==_)g=x;else if(!x){if(1==_)continue t;break t}}f[d++]=g}return f},Ni.prototype.at=co,Ni.prototype.chain=function(){return ao(this)},Ni.prototype.commit=function(){return new Gi(this.value(),this.__chain__)},Ni.prototype.next=function(){this.__values__===r&&(this.__values__=la(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?r:this.__values__[this.__index__++]}},Ni.prototype.plant=function(t){for(var e,i=this;i instanceof Ui;){var n=Rs(i);n.__index__=0,n.__values__=r,e?s.__wrapped__=n:e=n;var s=n;i=i.__wrapped__}return s.__wrapped__=t,e},Ni.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof zi){var e=t;return this.__actions__.length&&(e=new zi(this)),(e=e.reverse()).__actions__.push({func:lo,args:[Ys],thisArg:r}),new Gi(e,this.__chain__)}return this.thru(Ys)},Ni.prototype.toJSON=Ni.prototype.valueOf=Ni.prototype.value=function(){return hr(this.__wrapped__,this.__actions__)},Ni.prototype.first=Ni.prototype.head,Yt&&(Ni.prototype[Yt]=function(){return this}),Ni}();ue._=di,(n=function(){return di}.call(e,i,e,t))===r||(t.exports=n)}.call(this)},133:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Constants=void 0,e.Constants={WALKING_DISTANCE_PER_HOUR:35e4,DIFF_DEGREE:15,UTURN_DEGREE:169,PATH_SIMPLIFY_DISTANCE:50,TRANSCODE:{ELEVATOR:"OB-ELEVATOR",ESCALATOR:"OB-ESCALATOR",ESCALATOR_UP:"OB-ESCALATOR_UP",ESCALATOR_DOWN:"OB-ESCALATOR_DOWN",STAIRS:"OB-STAIRS",OTHER:"OB-OTHER_TRANSPORT"}}},162:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ComputingType=void 0,function(t){t.RECOMMENDATION_TYPE="RECOMMENDATION",t.SAFETY_TYPE="SAFETY",t.STAIRS_TYPE="STAIRS",t.ESCALATOR_TYPE="ESCALATOR",t.ELEVATOR_TYPE="ELEVATOR",t.OTHER_TYPE="OTHER"}(e.ComputingType||(e.ComputingType={}))},520:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DirectionType=void 0,function(t){t.LEFT="LEFT",t.RIGHT="RIGHT",t.STRAIGHT="STRAIGHT",t.UTURN="UTURN"}(e.DirectionType||(e.DirectionType={}))},338:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Vector2=void 0;class i{constructor(t=0,e=0){Object.defineProperty(this,"isVector2",{value:!0}),this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error(`index is out of range: ${t}`)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error(`index is out of range: ${t}`)}}clone(){return new i(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?this.addVectors(t,e):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?this.subVectors(t,e):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this}toArray(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t}rotateAround(t,e){const i=Math.cos(e),n=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*i-s*n+t.x,this.y=r*n+s*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}e.Vector2=i},577:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Vector3=void 0;const i={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,clamp:(t,e,i)=>Math.max(e,Math.min(i,t)),euclideanModulo:(t,e)=>(t%e+e)%e,mapLinear:(t,e,i,n,r)=>n+(t-e)*(r-n)/(i-e),lerp:(t,e,i)=>(1-i)*t+i*e,smoothstep:(t,e,i)=>t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*(3-2*t),smootherstep:(t,e,i)=>t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10),randInt:(t,e)=>t+Math.floor(Math.random()*(e-t+1)),randFloat:(t,e)=>t+Math.random()*(e-t),randFloatSpread:t=>t*(.5-Math.random()),degToRad:t=>t*i.DEG2RAD,radToDeg:t=>t*i.RAD2DEG,isPowerOfTwo:t=>0==(t&t-1)&&0!==t,ceilPowerOfTwo:t=>Math.pow(2,Math.ceil(Math.log(t)/Math.LN2)),floorPowerOfTwo:t=>Math.pow(2,Math.floor(Math.log(t)/Math.LN2))};class n{constructor(t=0,e=0,i=0){Object.defineProperty(this,"isVector3",{value:!0}),this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error(`index is out of range: ${t}`)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error(`index is out of range: ${t}`)}}clone(){return new n(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?this.addVectors(t,e):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?this.subVectors(t,e):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?this.multiplyVectors(t,e):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t,e){return void 0!==e?this.crossVectors(t,e):this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,n=t.y,r=t.z,s=e.x,o=e.y,a=e.z;return this.x=n*a-r*o,this.y=r*s-i*a,this.z=i*o-n*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(i.clamp(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}e.Vector3=n},547:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DijkstraNavigationManager=void 0;const n=i(344),r=i(133),s=i(162),o=i(338),a=i(520),l=i(933),c=i(577),h=i(987),u=i(486);e.DijkstraNavigationManager=class{constructor(t){this.nodeMap=new Map,this.request=t,this.nodeData=u.groupBy(this.request.getNodes(),"includedFloorId"),this.request.getNodes().forEach((t=>{this.nodeMap.set(t.id,t)})),this.graph=this.buildNodeGraph(t.getComputingType())}getPath(t,e=0){t.forEach((t=>this.request.syncLocationAndPoi(t)));const i=[],r=[];let s=[],o=[];try{for(let n=0;n<t.length-1;n++){const a=t[n],c=t[n+1],h=this.getOptimalNode(a),u=this.getOptimalNode(c),d=this.findPath(h.id,u.id);if(d.length>0){if(this.setPoiId(d,a,c),this.mergeResponse(r,d),this.resetDistance(r,e),this.handleLastNode(r),o=this.simplifyPathinfo(r,3),s=this.simplifyPathinfo(r),s.length>2)for(let t=1;t<s.length;t++){const e=s[t-1],i=s[t];e.transCode&&i.transCode&&e.transCode===i.transCode&&e.floorId!==i.floorId&&(i.transCode=null)}this.mergeResponse(i,l.VectorUtils.simplifyLocationTranslate(d))}}}catch(t){return new n.NavigationResponse([])}const a=new n.NavigationResponse([]);a.setSimplifiedLocationList(o),a.setPathInfo(s),this.resetDistance(a.getPathInfo(),e);const c=this.request.getScaleCm();return a.getPathInfo().forEach((t=>{t.distance&&(t.distance*=c)})),a.setLocations(i),a.getLocations().forEach((t=>{t.distance&&(t.distance*=c)})),a.getLocations().forEach((t=>this.request.setPoiRelatedObjectAndPOI(t))),a.setCalculateTotalDistanceAndTime(),a.setWaypoints(),a}setPoiId(t,e,i){e.poiId&&(t[0].poiId=e.poiId),i.poiId&&(t[t.length-1].poiId=i.poiId)}simplifyPathinfo(t,e){const i=u.cloneDeep(t),n=this.simplify(i,e);return l.VectorUtils.simplifyLocationTranslate(n)}simplify(t,e){const i=e||r.Constants.DIFF_DEGREE;let n="",s=0,o=null,h=null,u=null;const d=[];return t.forEach((t=>{t.angle=0,t.transCode||t.destination||null!==t.direction||(t.direction=a.DirectionType.STRAIGHT)})),t.forEach(((e,p)=>{var f,m,g,v,y,_,x,M,b;n!==e.floorId&&(n=e.floorId,s=0,e.direction=a.DirectionType.STRAIGHT,e.angle=0),h=e,s>0&&(o=t[p-1]),u=p<t.length-1?t[p+1]:null;let w=a.DirectionType.STRAIGHT,S=0,T=0;if(null!==o&&null!==u){let t=new c.Vector3(null===(f=o.position)||void 0===f?void 0:f.x,null===(m=o.position)||void 0===m?void 0:m.y,null===(g=o.position)||void 0===g?void 0:g.z);const i=new c.Vector3(null===(v=h.position)||void 0===v?void 0:v.x,null===(y=h.position)||void 0===y?void 0:y.y,null===(_=h.position)||void 0===_?void 0:_.z);let n=new c.Vector3(null===(x=u.position)||void 0===x?void 0:x.x,null===(M=u.position)||void 0===M?void 0:M.y,null===(b=u.position)||void 0===b?void 0:b.z);o.floorId!==h.floorId&&h.nodeId&&this.request.getFloorManager().getObjectsByNodeId(h.floorId,h.nodeId).forEach((e=>{l.VectorUtils.isTransObject(e)&&(t=new c.Vector3(e.position.x,e.position.y,e.position.z))})),u.floorId!==h.floorId&&h.nodeId&&this.request.getFloorManager().getObjectsByNodeId(h.floorId,h.nodeId).forEach((t=>{l.VectorUtils.isTransObject(t)&&(n=new c.Vector3(t.position.x,t.position.y,t.position.z))})),T=l.VectorUtils.diffAngle(t,i,n),e.angle=T,w=l.VectorUtils.detectDirection(t,i,n),w=T>r.Constants.DIFF_DEGREE?w:a.DirectionType.STRAIGHT,S=n.distanceTo(i)}e.destination||0===s?(T>r.Constants.UTURN_DEGREE&&(w=a.DirectionType.UTURN),e.direction=w,d.push(e)):(null==u?void 0:u.floorId)!==(null==h?void 0:h.floorId)?(e.direction=null,d.push(e)):S>1&&T>i&&(e.direction=w,d.push(e)),s+=1})),d}findPath(t,e){const i=new h.find_path(this.graph,t,e);return this.convertRouteToLocations(i)}getOptimalNode(t){let e=[];if(t.poiId){const i=this.request.getFloorManager().getPoiById(t.floorId,t.poiId);if(i&&i.objectId&&(e=this.request.getFloorManager().getNodesByObjectId(t.floorId,i.objectId),e&&e.length>0))return e[0]}return this.request.getNodeByLocation(t.floorId,t)[0]}resetDistance(t,e=0){if(t.length>2)for(let i=0;i<t.length-1;i++){const n=t[i];if(n.transCode&&n.floorId&&n.floorId!==t[i+1].floorId)n.distance=e;else{const e=t[i+1],r=n.position,s=e.position,a=new o.Vector2(null==r?void 0:r.x,null==r?void 0:r.y),l=new o.Vector2(null==s?void 0:s.x,null==s?void 0:s.y).distanceTo(a);n.distance=l}}}handleLastNode(t){t.length>2&&(t[t.length-1].distance=0,t[t.length-1].transCode=null,t[t.length-1].angle=0,t[t.length-1].direction=null)}distinctNodeArray(t){const e=new Array,i={};for(const n of t)i[n.id]||(i[n.id]=!0,e.push({id:n.id,title:n.title,objectIds:n.objectIds,position:n.position,edges:n.edges,linkedYn:n.linkedYn,includedFloorId:n.includedFloorId,transCode:n.transCode}));return e}mergeResponse(t,e){0===t.length?t.push(...e):t[t.length-1].nodeId===e[0].nodeId&&t.push(...e.slice(1)),t.forEach(((t,e)=>{t.idx=e}))}convertRouteToLocations(t){const e=this.nodeMap,i=new Array;let n=t?e.get(t[0]):void 0,r=n?n.includedFloorId:"";for(let s=0;s<t.length;s++){const o=t[s],a=e.get(o);let l=0;s<t.length-1&&(n=e.get(t[s+1]),r=n.includedFloorId,l=this.graph[a.id][n.id]),a&&(i.push({position:a.position,floorId:a.includedFloorId,nodeId:a.id,poiId:null,idx:s,transCode:a.transCode,distance:l,direction:null,angle:0,destination:0===s||s===t.length-1}),r=a.includedFloorId)}return i}buildNodeGraph(t){const e={},i=this.nodeData;for(const n in i)i[n].forEach((i=>{const n=this.checkTransTypePath(i,t),r={};i.edges.forEach((t=>{(n||!n&&!t.linkedFloorId)&&t.distance>0&&(r[t.nodeId]=t.distance)})),e[i.id]=r}));return e}isSafetyPath(t){return!t.transCode||t.transCode===r.Constants.TRANSCODE.ELEVATOR||t.transCode===r.Constants.TRANSCODE.OTHER}checkTransTypePath(t,e=s.ComputingType.RECOMMENDATION_TYPE){return e===s.ComputingType.SAFETY_TYPE?this.isSafetyPath(t):e===s.ComputingType.ELEVATOR_TYPE||t.transCode===r.Constants.TRANSCODE.OTHER?t.transCode===r.Constants.TRANSCODE.ELEVATOR||t.transCode===r.Constants.TRANSCODE.OTHER:e===s.ComputingType.ESCALATOR_TYPE||t.transCode===r.Constants.TRANSCODE.OTHER?t.transCode===r.Constants.TRANSCODE.ESCALATOR||t.transCode===r.Constants.TRANSCODE.ESCALATOR_UP||t.transCode===r.Constants.TRANSCODE.ESCALATOR_DOWN||t.transCode===r.Constants.TRANSCODE.OTHER:e!==s.ComputingType.STAIRS_TYPE&&t.transCode!==r.Constants.TRANSCODE.OTHER||t.transCode===r.Constants.TRANSCODE.STAIRS}}},272:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FloorDataManger=void 0,e.FloorDataManger=class{constructor(t){this.floors=t}addFloors(t){this.floors=[...this.floors,...t]}getFloorsById(t){return this.floors.filter((e=>e.id===t))}getObjectById(t,e){return this.getFloorsById(t)[0].objects.filter((t=>t.id===e))[0]}getPoiById(t,e){return this.getFloorsById(t)[0].pois.filter((t=>t.id===e))[0]}getNodesByObjectId(t,e){return this.getFloorsById(t)[0].nodes.filter((t=>t.objectIds.findIndex((t=>t===e))>-1))}getObjectsByNodeId(t,e){const i=this.getFloorsById(t)[0],n=[],r=i.nodes.findIndex((t=>t.id===e));return i.nodes[r].objectIds.forEach((t=>{const e=i.objects.findIndex((e=>e.id===t));e>0&&n.push(i.objects[e])})),n}getPoisByObjectId(t,e){const i=this.getFloorsById(t)[0],n=i.pois.findIndex((t=>t.objectId===e));return n>=0?i.pois[n]:null}}},273:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NavigationRequest=void 0;const n=i(933),r=i(272),s={"ND-Qx0jzqI3g9118":"ND-g6vKy-n-U2579","ND-Lp8YaLVep8185":"ND-lRuQwP2qR1315","ND-jCbgvw3mW7922":"ND-YH6qcp_Xx5199","ND-Ppo4zey3_0741":"ND-Pdx7MoM_B5222","ND-Zbsv2vRp35452":"ND-r0jayXXP78549","ND-VhbR_YrTF3377":"ND-4k6wdHqUW1394","ND-0SyU9cslD3144":"ND-tOig6TzX-7246","ND-ptJNRWnU72469":"ND-k4i6yMRLz0365","ND-Uf98cUgFG3399":"ND-fJA8MGwmk2733","ND-Tds1RZgC47761":"ND-KLjKGgjxd4588","ND-KykzIGtvA1517":"ND-aeaNEGFiB2909","ND-g6vKy-n-U2579":"ND-Qx0jzqI3g9118","ND-lRuQwP2qR1315":"ND-Lp8YaLVep8185","ND-YH6qcp_Xx5199":"ND-jCbgvw3mW7922","ND-Pdx7MoM_B5222":"ND-Ppo4zey3_0741","ND-r0jayXXP78549":"ND-Zbsv2vRp35452","ND-4k6wdHqUW1394":"ND-VhbR_YrTF3377","ND-tOig6TzX-7246":"ND-0SyU9cslD3144","ND-k4i6yMRLz0365":"ND-ptJNRWnU72469","ND-fJA8MGwmk2733":"ND-Uf98cUgFG3399","ND-KLjKGgjxd4588":"ND-Tds1RZgC47761","ND-aeaNEGFiB2909":"ND-KykzIGtvA1517"};e.NavigationRequest=class{constructor(t,e,i){this.scaleCm=1,this.scaleCm2=1,this.nodes=[],this.scaleCm=t.scaleCm,this.computingType=e,t.floors.forEach((t=>this.nodes.push(...t.nodes))),this.floorManager=new r.FloorDataManger(t.floors),i&&(this.scaleCm2=i.scaleCm,i.floors.forEach((t=>{this.nodes.push(...t.nodes)})),this.floorManager.addFloors(i.floors)),this.nodes.forEach((t=>{if(Object.keys(s).includes(t.id)){const e={id:"NE-created",nodeId:s[t.id],distance:10};t.edges.push(e)}}))}getFloorManager(){return this.floorManager}getComputingType(){return this.computingType}getNodes(){return this.nodes}getScaleCm(){return this.scaleCm}getScaleCm2(){return this.scaleCm2}setPoiRelatedObjectAndPOI(t){!t.poiId&&t.nodeId&&this.floorManager.getObjectsByNodeId(t.floorId,t.nodeId).forEach((e=>{const i=this.floorManager.getPoisByObjectId(t.floorId,e.id);i&&(t.poiId=i.id)}))}syncLocationAndPoi(t){if(!t.poiId&&t.position&&t.floorId){const e=this.floorManager.getFloorsById(t.floorId)[0];if(!e)return;const i=e.pois.findIndex((e=>e.position.x===t.position.x&&e.position.y===t.position.y)),n=e.pois[i];n&&(t.poiId=n.id)}}getNodeByLocation(t,e){if(!e.position&&!e.poiId)throw console.error("poi도 없고 position도 없어서 길찾기가 불가능합니다"),new Error("길찾기할 poi나 Position이 없습니다!");!e.position&&e.poiId&&(e.position=this.floorManager.getPoiById(t,e.poiId).position);const i=[];return i.push(this.getClosestNode(e)),i}getClosestNode(t){const e=this.nodes,i=n.VectorUtils.sortNodesFromPosition(e.filter((e=>e.includedFloorId===t.floorId)),t.position);return i.length<0?null:i[0].node}}},344:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NavigationResponse=void 0;const n=i(486),r=i(933);e.NavigationResponse=class{constructor(t){this.locations=[],this.pathInfo=[],this.totalDistance=0,this.totalTime=0,this.origin=null,this.wayPoints=[],this.finalDestination=null,this.setLocations(t),this.simplifiedLocationList=[]}setLocations(t){this.locations=t,this.origin=t.length>0?this.locations[0]:null,this.finalDestination=t.length>0?this.locations[this.locations.length-1]:null,this.wayPoints=this.locations.filter((t=>t.destination))}setPathInfo(t){this.pathInfo=t}setSimplifiedLocationList(t){this.simplifiedLocationList=t}setOrigin(){this.origin=this.locations.length>0?this.locations[0]:null,this.origin=(0,n.cloneDeep)(this.origin)}setWaypoints(){this.wayPoints=this.locations.filter((t=>t.destination)),this.wayPoints=(0,n.cloneDeep)(this.wayPoints)}setFinalDestination(){this.finalDestination=this.locations.length>0?this.locations[this.locations.length-1]:null,this.finalDestination=(0,n.cloneDeep)(this.finalDestination)}setCalculateTotalDistanceAndTime(){this.totalDistance=r.VectorUtils.calcRouteDistance(this.pathInfo),this.totalTime=r.VectorUtils.calcRouteTime(this.totalDistance)}getLocations(){return this.locations}getPathInfo(){return this.pathInfo}getOrigin(){return this.origin}getFinalDestination(){return this.finalDestination}getWayPoints(){return this.wayPoints}getTotalTime(){return this.totalTime}getTotalDistance(){return this.totalDistance}getSimplifiedLocationList(){return this.simplifiedLocationList}}},717:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NetworkResponse=void 0,e.NetworkResponse=class{constructor(t,e){this.code=t,this.message=e,this.payload={}}addResponse(t,e){this.payload[t.toLowerCase()]=e}setPayLoad(t){this.payload=t}}},933:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VectorUtils=void 0;const n=i(133),r=i(577),s=i(338),o=i(520);class a{static calcRouteDistance(t){let e=0;return t.forEach((t=>{t.distance&&(e+=t.distance)})),e}static calcRouteTime(t=0){return t/n.Constants.WALKING_DISTANCE_PER_HOUR*36e5}static calcDistance(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}static isTransObject(t){return t.attributeCode===n.Constants.TRANSCODE.ELEVATOR||t.attributeCode===n.Constants.TRANSCODE.ESCALATOR||t.attributeCode===n.Constants.TRANSCODE.ESCALATOR_UP||t.attributeCode===n.Constants.TRANSCODE.ESCALATOR_DOWN||t.attributeCode===n.Constants.TRANSCODE.STAIRS}static sortNodesFromPosition(t,e){return t.map((t=>({distance:a.calcDistance(e,t.position),node:t}))).sort(((t,e)=>t.distance-e.distance))}static isContain(t,e){const i=e.x,n=e.y,r=t.coordinates.length;if(r<3)return!1;let s=r-1,o=!1;for(let e=0;e<r;e++){const r=t.coordinates[e],a=t.coordinates[s];(r.y<n&&a.y>=n||a.y<n&&r.y>=n)&&r.x+(n-r.y)/(a.y-r.y)*(a.x-r.x)<i&&(o=!o),s=e}return o}static diffAngle(t,e,i){const n=new r.Vector3;n.subVectors(e,t).normalize();const s=new r.Vector3;return s.subVectors(i,e).normalize(),180*s.angleTo(n)/Math.PI}static detectDirection(t,e,i){const n=new r.Vector3;n.subVectors(t,e).normalize();const a=new s.Vector2(n.x,n.y);n.subVectors(i,e).normalize();const l=new s.Vector2(n.x,n.y).cross(a);let c=o.DirectionType.STRAIGHT;return l>0?c=o.DirectionType.RIGHT:l<0&&(c=o.DirectionType.LEFT),c}static simplifyLocationTranslate(t){const e=[];for(let i=0;i<t.length;i++){const n=t[i];if(n.transCode&&i>0&&i<t.length-1){const e=t[i-1],r=t[i+1];if(null!=e.transCode&&null!=n.transCode&&null!=r.transCode&&e.transCode===n.transCode&&r.transCode===n.transCode)continue}e.push(n)}return e}}e.VectorUtils=a}},e={};function i(n){var r=e[n];if(void 0!==r)return r.exports;var s=e[n]={id:n,loaded:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.loaded=!0,s.exports}i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.nmd=t=>(t.paths=[],t.children||(t.children=[]),t);var n={};return(()=>{"use strict";var t=n;Object.defineProperty(t,"__esModule",{value:!0}),t.NavigationResponse=t.NetworkResponse=t.DirectionType=t.ComputingType=t.NavigationRequest=t.DijkstraNavigationManager=void 0;const e=i(547);Object.defineProperty(t,"DijkstraNavigationManager",{enumerable:!0,get:function(){return e.DijkstraNavigationManager}});const r=i(273);Object.defineProperty(t,"NavigationRequest",{enumerable:!0,get:function(){return r.NavigationRequest}});const s=i(162);Object.defineProperty(t,"ComputingType",{enumerable:!0,get:function(){return s.ComputingType}});const o=i(520);Object.defineProperty(t,"DirectionType",{enumerable:!0,get:function(){return o.DirectionType}});const a=i(717);Object.defineProperty(t,"NetworkResponse",{enumerable:!0,get:function(){return a.NetworkResponse}});const l=i(344);Object.defineProperty(t,"NavigationResponse",{enumerable:!0,get:function(){return l.NavigationResponse}})})(),n})(),t.exports=e()},9783:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>n});const n="#define GLSLIFY 1\n/**\n* 프래그먼트 쉐이더 정의\n*\n* 각 오브젝트의 윗면은 'color' attribute 에 저장된 색상을 적용하고,\n* 오브젝트의 옆면은 'sideCol' attribute 에 저장된 색상을 적용한다.\n*\n* 이때, 옆면은 lambertian 라이팅을 적용하여\n* 조명의 방향과 면의 각도에 따라 조명값이 달라지도록 연산한다.\n*\n* 또한, 윗면은 조명값이 달라져도 일정하게 원색상을 유지할 수 있도록,\n* 별도의 조명 연산을 하지 않고, vCol 변수에 지정된 색상만을 사용한다.\n* vCol 보간 변수는 버텍스 쉐이더의 attribute color 변수로부터 넘어온 변수이다.\n*/\n//\n#define BRIGHTNESS_CORRECTION 1.25 // 밝기 보정값 (옆면이 어두워지지 않게 임의의 값만큼 곱해줌)\n\nvarying float vSideOpacity;\nvarying float vTopOpacity;\nvarying vec3 vNormal;\nvarying vec3 vSideCol;\nvarying vec3 vTopCol;\n\nuniform vec3 dirLightColor;\nuniform vec3 dirLightDirection;\nuniform vec3 ambientColor;\nuniform float ambientIntensity;\n\nvoid main() {\n  vec3 norm = normalize(vNormal);\n  vec3 objectColor = vSideCol;\n  vec4 finalCol;\n  if (abs(norm.z) != 1.0) {\n    objectColor = vSideCol;\n  } \n  float nDotL = max(dot(dirLightDirection, norm), 0.0); // 직사광을 내적\n\n  vec3 diffuseCol = dirLightColor * nDotL * objectColor;\n  vec3 ambientCol = ambientColor * ambientIntensity;\n\n  // finalCol = diffuseCol + ambientCol; // 원래의 lambert 공식\n\n  // 물체의 원색상을 65:35 비율로 더 섞고, ambient 제거하고, 밝기 보정값을 곱해줌.\n  // ambient 를 더하면 밝아지기는 하지만 옆면의 색상이 탁해짐. \n  finalCol = vec4(((objectColor * 0.65) + (diffuseCol * 0.35)) * BRIGHTNESS_CORRECTION, vSideOpacity); \n\n  if (abs(norm.z) == 1.0) {\n    // 윗면 색상 (ambientCol 미포함 -> 사실상 meshBasicMaterial)\n    \n    finalCol = vec4(vTopCol * dirLightColor, vTopOpacity);\n    \n  }\n\n  gl_FragColor = finalCol;\n}"},7161:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>n});const n="#define GLSLIFY 1\n/**\n* 버텍스 쉐이더 정의\n*\n* attribute 변수로 전달받은 정점 데이터들(opacity, sideCol, color 등)을\n* 보간 변수 (vOpacity, vSideCol, vCol)에 할당해서 프래그먼트 쉐이더로 전송하는 작업을 한다.\n*/\nattribute float sideOpacity;\nattribute float topOpacity;\nattribute vec3 sideCol;\nattribute vec3 topCol;\n\nvarying float vSideOpacity;\nvarying float vTopOpacity;\nvarying vec3 vNormal;\nvarying vec3 vSideCol;\nvarying vec3 vTopCol;\n\nvoid main() {\n    vSideCol = sideCol;\n    vTopCol = topCol;\n    vNormal = normal;\n    vSideOpacity = sideOpacity / 100.0;\n    vTopOpacity = topOpacity / 100.0;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"},9487:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>n});const n="#define GLSLIFY 1\nuniform vec3 dirLightColor;\n\nvarying float vLineOpacity;\nvarying vec3 vLineCol;\n\nvoid main() {\n  float lineOpacity = vLineOpacity - 0.1;\n  vec3 lineCol = vLineCol;\n\n  gl_FragColor = vec4(lineCol * dirLightColor, lineOpacity);\n}"},8783:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>n});const n="#define GLSLIFY 1\nattribute float lineOpacity;\nattribute vec3 lineCol;\n\nvarying float vLineOpacity;\nvarying vec3 vLineCol;\n\nvoid main() {\n    vLineCol = lineCol;\n    vLineOpacity = lineOpacity / 100.0;\n    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n    gl_Position = projectionMatrix * mvPosition;\n\n}"},1468:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>n});const n="precision highp float;\n#define GLSLIFY 1\n // float 타입 변수 정밀도 지정\n\n// 사용자 정의 uniform 변수\nuniform sampler2D texture; // 렌더타겟 텍스쳐\nuniform float blurSize; // 렌더타겟 텍스쳐에 그려지는 PointMesh 들의 반경 크기값 -> 이거로 Blur 의 반경을 계산함.\nuniform vec2 resolution; // 히트맵 평면 사이즈 만큼의 해상도\nuniform float planeOpacity; // 히트맵 평면 전체에 적용되는 투명도\nuniform vec3 colorList[4]; // 정규화된 히트맵 컬러값 배열 (4색 밀도 내림차순)\nuniform float densityList[4]; // 히트맵 컬러 밀도값 배열 (4색 밀도 내림차순)\n\n// 보간변수\nvarying vec2 vUv;\n\n// GAUSSIAN BLUR SETTINGS {{{\nconst float PI2 = 6.28318530718; // Pi*2\nconst float directions = 16.0; // BLUR DIRECTIONS (Default 16.0 - More is better but slower)\nconst float quality = 4.0; // BLUR QUALITY (Default 4.0 - More is better but slower)\n// GAUSSIAN BLUR SETTINGS }}}\n\nvec4 gaussianBlur(sampler2D texture, vec2 uv, float size, vec2 resolution) {\n  // Blur 반경 계산\n  vec2 radius = size / resolution.xy;\n    \n  // Pixel colour\n  vec4 color = texture2D(texture, uv);\n    \n  // Blur calculations\n  for (float d = 0.0; d < PI2; d += PI2 / directions) { // 바깥쪽 for loop 는 directions 크기만큼 (16회) 돌거임. (현재 uv 좌표를 중심으로 몇바퀴를 회전하며 주변 픽셀을 샘플링할 것인지)\n\t  for(float i = 1.0 / quality; i <= 1.0; i += 1.0 / quality) { // 안쪽 for loop 는 quality 크기만큼 (4회) 돌거임. (현재 uv 좌표에서 radius 까지 몇 단계로 쪼개서 주변 픽셀을 샘플링할 것인지)\n\t  \tcolor += texture2D( texture, uv + vec2(cos(d),sin(d)) * radius * i);\t\t\n    }\n  }\n    \n  // Output to screen\n  color /= quality * directions - 15.0;\n  return color;\n}\n\nvec3 hsvToRgb(vec3 c) {\n  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nvoid main(){\n  vec4 blurColor = gaussianBlur(texture, vUv, blurSize, resolution); // 렌더타겟 텍스쳐를 blur 처리한 색생값\n  float blurOpacity = blurColor.a; // blur 처리된 색상값 중에서 alpha(투명도)값만 별도 저장\n\n  // 밀도(density) 내림차순으로 정렬된 색상 데이터 (color1 일수록 안쪽, color4 일수록 바깥쪽 색상)\n  vec3 color1 = colorList[0];\n  vec3 color2 = colorList[1];\n  vec3 color3 = colorList[2];\n  vec3 color4 = colorList[3];\n\n  // 내림차순으로 정렬된 밀도 데이터 (density1 일수록 밀도가 크고(blur 처리 상에서 진한 영역), density4 일수록 밀도가 낮음(blur 처리 상에서 연한 영역))\n  float density1 = densityList[0];\n  float density2 = densityList[1];\n  float density3 = densityList[2];\n  float density4 = densityList[3];\n\n  float colorGap; // 보간된 색상이 아닌 순수한 색상 칠해지는 영역의 gap\n  float colorGapRatio = 0.01; // colorGap 사이즈를 전체 gap 대비 어느 정도로 지정할 것인지의 비율값 (값이 클수록 보간영역이 줄어듦.)\n  float gradientStart; // 보간 시작 구간\n  float gradientEnd; // 보간 끝 구간\n  vec3 gradientCol; // 보간된 색상\n\n  // color4 ~ color3 보간 영역 색상 계산 \n  colorGap = (density3 - density4) * colorGapRatio; // 실제 순수한 color4 만 칠해지는 영역의 gap (정확히는 절반만큼의 gap)\n  gradientStart = density4 + colorGap; // color4 의 끝 & color4 ~ color3 보간 시작 영역\n  gradientEnd = density3 - colorGap; // color4 ~ color3 보간 끝 영역 & color3 의 시작\n  gradientCol = mix(color4, color3, smoothstep(gradientStart, gradientEnd, blurOpacity)); // blurOpacity 값을 smoothstep 형태의 분포로 변환 > color4 와 color3 섞어주기\n\n  // color3 ~ color2 보간 영역 색상 계산\n  // 이 구간의 mix()에 사용되는 gradientCol 은 이전까지의 보간(즉, color4 ~ color3 까지의 보간)을 포함하고 있는 색상\n  colorGap = (density2 - density3) * colorGapRatio;\n  gradientStart = density3 + colorGap;\n  gradientEnd = density2 - colorGap;\n  gradientCol = mix(gradientCol, color2, smoothstep(gradientStart, gradientEnd, blurOpacity));\n\n  // color2 ~ color1 보간 영역 색상 계산\n  // 이 구간의 mix()에 사용되는 gradientCol 은 이전까지의 보간(즉, color4 ~ color3 ~ color2 까지의 보간)을 포함하고 있는 색상\n  colorGap = (density1 - density2) * colorGapRatio;\n  gradientStart = density2 + colorGap;\n  gradientEnd = density1 - colorGap;\n  gradientCol = mix(gradientCol, color1, smoothstep(gradientStart, gradientEnd, blurOpacity));\n\n  float opacity; // 최종 색상의 투명도 값\n  opacity = smoothstep(0.0, 0.185, blurOpacity); // smoothstep 으로 blurOpacity 가 0 ~ 0.185 사이인 구간만 투명도를 보간하고, 0.185 보다 안쪽 영역은 모두 투명도를 1로 처리\n  opacity *= planeOpacity; // 보간된 투명도에 Plane 의 전체 투명도 곱해서 적용\n\n  vec4 finalCol = vec4(gradientCol, opacity); // 최종 색상 계산\n  // vec4 tex = texture2D(texture, vUv); // 원본 텍스쳐\n  gl_FragColor = finalCol;\n}"},5909:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>n});const n="#define GLSLIFY 1\n// built-in attribute 변수\nattribute vec3 position;\nattribute vec2 uv;\n\n// built-in uniform 변수\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 modelMatrix;\n\n// 보간변수\nvarying vec2 vUv;\n\nvoid main() {\n  vec4 mPosition = modelMatrix * vec4(position, 1.0); // 모델행렬만 곱해서 월드좌표로 변환\n\n  vUv = uv;\n\n  gl_Position = projectionMatrix * viewMatrix * mPosition; // 나머지 변환행렬을 곱해서 클립좌표로 저장됨\n}"},1416:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>n});const n="precision highp float;\n#define GLSLIFY 1\n\n// 사용자 정의 uniform\nuniform float radius;\n\n// 보간변수\nvarying vec3 vPosition; // 각 프래그먼트에서 오브젝트공간 원점까지의 거리와 동일\n\nvoid main(){\n  float opacity = 0.5;\n  if (length(vPosition) > radius) {\n    // 각 프래그먼트에서 오브젝트공간 원점까지의 거리가 일정 radius 를 벗어나면, 투명도를 0으로 변경\n    // > radius 만큼의 반경을 갖는 원 형태로 MapPointMesh 가 렌더링 될 것임.\n    opacity = 0.0;\n  }\n  vec3 finalCol = vec3(0.0, 0.0, 0.0);\n  gl_FragColor = vec4(finalCol, opacity);\n}"},1916:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>n});const n="#define GLSLIFY 1\n// built-in attribute 변수\nattribute vec3 position;\n\n// built-in uniform 변수\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 modelMatrix;\n\n// 보간변수\nvarying vec3 vPosition;\n\nvoid main() {\n  vPosition = position; // 오브젝트공간 좌표를 프래그먼트 셰이더로 보간하여 넘김 -> 각 프래그먼트에서 원점과의 거리 계산\n  vec4 mPosition = modelMatrix * vec4(position, 1.0); // 모델행렬만 곱해서 월드좌표로 변환\n\n  gl_Position = projectionMatrix * viewMatrix * mPosition; // 나머지 변환행렬을 곱해서 클립좌표로 저장됨\n}"},700:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>n});const n="precision highp float;\n#define GLSLIFY 1\n\nuniform vec3 color;\n\nvoid main(){\n    vec4 finalColor = vec4(color, 1.0);\n    gl_FragColor = finalColor;\n}"},8750:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>n});const n="#define GLSLIFY 1\n// built-in attribute 변수\nattribute vec3 position;\n\n// built-in uniform 변수\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 modelMatrix;\n\n// 사용자 정의 uniform 변수\nuniform float pixelRatio; // window.devicePixelRatio (css 픽셀 1개당 사용되는 장치 픽셀 개수)\nuniform float size; // 사용자 입력 점선 사이즈\nuniform float zoom; // 카메라 현재 zoom 값 (zoomLevel 로부터 계산)\n\nvoid main() {\n    gl_PointSize = size * pixelRatio * zoom; // 2D / 3D 카메라 모두 zoom 값을 기준으로 점선 사이즈 계산\n    gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.0); // 모델행렬, 뷰행렬, 투영행렬을 순차로 곱해서 최종 클립좌표 저장\n}"},6486:function(t,e,i){var n;t=i.nmd(t),function(){var r,s="Expected a function",o="__lodash_hash_undefined__",a="__lodash_placeholder__",l=16,c=32,h=64,u=128,d=256,p=1/0,f=9007199254740991,m=NaN,g=4294967295,v=[["ary",u],["bind",1],["bindKey",2],["curry",8],["curryRight",l],["flip",512],["partial",c],["partialRight",h],["rearg",d]],y="[object Arguments]",_="[object Array]",x="[object Boolean]",M="[object Date]",b="[object Error]",w="[object Function]",S="[object GeneratorFunction]",T="[object Map]",A="[object Number]",E="[object Object]",C="[object Promise]",O="[object RegExp]",P="[object Set]",I="[object String]",D="[object Symbol]",L="[object WeakMap]",R="[object ArrayBuffer]",B="[object DataView]",N="[object Float32Array]",F="[object Float64Array]",U="[object Int8Array]",G="[object Int16Array]",z="[object Int32Array]",k="[object Uint8Array]",j="[object Uint8ClampedArray]",H="[object Uint16Array]",V="[object Uint32Array]",W=/\b__p \+= '';/g,q=/\b(__p \+=) '' \+/g,J=/(__e\(.*?\)|\b__t\)) \+\n'';/g,X=/&(?:amp|lt|gt|quot|#39);/g,Y=/[&<>"']/g,Z=RegExp(X.source),K=RegExp(Y.source),Q=/<%-([\s\S]+?)%>/g,$=/<%([\s\S]+?)%>/g,tt=/<%=([\s\S]+?)%>/g,et=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,it=/^\w*$/,nt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,rt=/[\\^$.*+?()[\]{}|]/g,st=RegExp(rt.source),ot=/^\s+/,at=/\s/,lt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ct=/\{\n\/\* \[wrapped with (.+)\] \*/,ht=/,? & /,ut=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,dt=/[()=,{}\[\]\/\s]/,pt=/\\(\\)?/g,ft=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,mt=/\w*$/,gt=/^[-+]0x[0-9a-f]+$/i,vt=/^0b[01]+$/i,yt=/^\[object .+?Constructor\]$/,_t=/^0o[0-7]+$/i,xt=/^(?:0|[1-9]\d*)$/,Mt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,bt=/($^)/,wt=/['\n\r\u2028\u2029\\]/g,St="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Tt="\\u2700-\\u27bf",At="a-z\\xdf-\\xf6\\xf8-\\xff",Et="A-Z\\xc0-\\xd6\\xd8-\\xde",Ct="\\ufe0e\\ufe0f",Ot="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Pt="['’]",It="[\\ud800-\\udfff]",Dt="["+Ot+"]",Lt="["+St+"]",Rt="\\d+",Bt="[\\u2700-\\u27bf]",Nt="["+At+"]",Ft="[^\\ud800-\\udfff"+Ot+Rt+Tt+At+Et+"]",Ut="\\ud83c[\\udffb-\\udfff]",Gt="[^\\ud800-\\udfff]",zt="(?:\\ud83c[\\udde6-\\uddff]){2}",kt="[\\ud800-\\udbff][\\udc00-\\udfff]",jt="["+Et+"]",Ht="(?:"+Nt+"|"+Ft+")",Vt="(?:"+jt+"|"+Ft+")",Wt="(?:['’](?:d|ll|m|re|s|t|ve))?",qt="(?:['’](?:D|LL|M|RE|S|T|VE))?",Jt="(?:"+Lt+"|"+Ut+")"+"?",Xt="[\\ufe0e\\ufe0f]?",Yt=Xt+Jt+("(?:\\u200d(?:"+[Gt,zt,kt].join("|")+")"+Xt+Jt+")*"),Zt="(?:"+[Bt,zt,kt].join("|")+")"+Yt,Kt="(?:"+[Gt+Lt+"?",Lt,zt,kt,It].join("|")+")",Qt=RegExp(Pt,"g"),$t=RegExp(Lt,"g"),te=RegExp(Ut+"(?="+Ut+")|"+Kt+Yt,"g"),ee=RegExp([jt+"?"+Nt+"+"+Wt+"(?="+[Dt,jt,"$"].join("|")+")",Vt+"+"+qt+"(?="+[Dt,jt+Ht,"$"].join("|")+")",jt+"?"+Ht+"+"+Wt,jt+"+"+qt,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Rt,Zt].join("|"),"g"),ie=RegExp("[\\u200d\\ud800-\\udfff"+St+Ct+"]"),ne=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,re=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],se=-1,oe={};oe[N]=oe[F]=oe[U]=oe[G]=oe[z]=oe[k]=oe[j]=oe[H]=oe[V]=!0,oe[y]=oe[_]=oe[R]=oe[x]=oe[B]=oe[M]=oe[b]=oe[w]=oe[T]=oe[A]=oe[E]=oe[O]=oe[P]=oe[I]=oe[L]=!1;var ae={};ae[y]=ae[_]=ae[R]=ae[B]=ae[x]=ae[M]=ae[N]=ae[F]=ae[U]=ae[G]=ae[z]=ae[T]=ae[A]=ae[E]=ae[O]=ae[P]=ae[I]=ae[D]=ae[k]=ae[j]=ae[H]=ae[V]=!0,ae[b]=ae[w]=ae[L]=!1;var le={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ce=parseFloat,he=parseInt,ue="object"==typeof i.g&&i.g&&i.g.Object===Object&&i.g,de="object"==typeof self&&self&&self.Object===Object&&self,pe=ue||de||Function("return this")(),fe=e&&!e.nodeType&&e,me=fe&&t&&!t.nodeType&&t,ge=me&&me.exports===fe,ve=ge&&ue.process,ye=function(){try{var t=me&&me.require&&me.require("util").types;return t||ve&&ve.binding&&ve.binding("util")}catch(t){}}(),_e=ye&&ye.isArrayBuffer,xe=ye&&ye.isDate,Me=ye&&ye.isMap,be=ye&&ye.isRegExp,we=ye&&ye.isSet,Se=ye&&ye.isTypedArray;function Te(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}function Ae(t,e,i,n){for(var r=-1,s=null==t?0:t.length;++r<s;){var o=t[r];e(n,o,i(o),t)}return n}function Ee(t,e){for(var i=-1,n=null==t?0:t.length;++i<n&&!1!==e(t[i],i,t););return t}function Ce(t,e){for(var i=null==t?0:t.length;i--&&!1!==e(t[i],i,t););return t}function Oe(t,e){for(var i=-1,n=null==t?0:t.length;++i<n;)if(!e(t[i],i,t))return!1;return!0}function Pe(t,e){for(var i=-1,n=null==t?0:t.length,r=0,s=[];++i<n;){var o=t[i];e(o,i,t)&&(s[r++]=o)}return s}function Ie(t,e){return!!(null==t?0:t.length)&&ke(t,e,0)>-1}function De(t,e,i){for(var n=-1,r=null==t?0:t.length;++n<r;)if(i(e,t[n]))return!0;return!1}function Le(t,e){for(var i=-1,n=null==t?0:t.length,r=Array(n);++i<n;)r[i]=e(t[i],i,t);return r}function Re(t,e){for(var i=-1,n=e.length,r=t.length;++i<n;)t[r+i]=e[i];return t}function Be(t,e,i,n){var r=-1,s=null==t?0:t.length;for(n&&s&&(i=t[++r]);++r<s;)i=e(i,t[r],r,t);return i}function Ne(t,e,i,n){var r=null==t?0:t.length;for(n&&r&&(i=t[--r]);r--;)i=e(i,t[r],r,t);return i}function Fe(t,e){for(var i=-1,n=null==t?0:t.length;++i<n;)if(e(t[i],i,t))return!0;return!1}var Ue=We("length");function Ge(t,e,i){var n;return i(t,(function(t,i,r){if(e(t,i,r))return n=i,!1})),n}function ze(t,e,i,n){for(var r=t.length,s=i+(n?1:-1);n?s--:++s<r;)if(e(t[s],s,t))return s;return-1}function ke(t,e,i){return e==e?function(t,e,i){var n=i-1,r=t.length;for(;++n<r;)if(t[n]===e)return n;return-1}(t,e,i):ze(t,He,i)}function je(t,e,i,n){for(var r=i-1,s=t.length;++r<s;)if(n(t[r],e))return r;return-1}function He(t){return t!=t}function Ve(t,e){var i=null==t?0:t.length;return i?Xe(t,e)/i:m}function We(t){return function(e){return null==e?r:e[t]}}function qe(t){return function(e){return null==t?r:t[e]}}function Je(t,e,i,n,r){return r(t,(function(t,r,s){i=n?(n=!1,t):e(i,t,r,s)})),i}function Xe(t,e){for(var i,n=-1,s=t.length;++n<s;){var o=e(t[n]);o!==r&&(i=i===r?o:i+o)}return i}function Ye(t,e){for(var i=-1,n=Array(t);++i<t;)n[i]=e(i);return n}function Ze(t){return t?t.slice(0,fi(t)+1).replace(ot,""):t}function Ke(t){return function(e){return t(e)}}function Qe(t,e){return Le(e,(function(e){return t[e]}))}function $e(t,e){return t.has(e)}function ti(t,e){for(var i=-1,n=t.length;++i<n&&ke(e,t[i],0)>-1;);return i}function ei(t,e){for(var i=t.length;i--&&ke(e,t[i],0)>-1;);return i}function ii(t,e){for(var i=t.length,n=0;i--;)t[i]===e&&++n;return n}var ni=qe({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"}),ri=qe({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function si(t){return"\\"+le[t]}function oi(t){return ie.test(t)}function ai(t){var e=-1,i=Array(t.size);return t.forEach((function(t,n){i[++e]=[n,t]})),i}function li(t,e){return function(i){return t(e(i))}}function ci(t,e){for(var i=-1,n=t.length,r=0,s=[];++i<n;){var o=t[i];o!==e&&o!==a||(t[i]=a,s[r++]=i)}return s}function hi(t){var e=-1,i=Array(t.size);return t.forEach((function(t){i[++e]=t})),i}function ui(t){var e=-1,i=Array(t.size);return t.forEach((function(t){i[++e]=[t,t]})),i}function di(t){return oi(t)?function(t){var e=te.lastIndex=0;for(;te.test(t);)++e;return e}(t):Ue(t)}function pi(t){return oi(t)?function(t){return t.match(te)||[]}(t):function(t){return t.split("")}(t)}function fi(t){for(var e=t.length;e--&&at.test(t.charAt(e)););return e}var mi=qe({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var gi=function t(e){var i,n=(e=null==e?pe:gi.defaults(pe.Object(),e,gi.pick(pe,re))).Array,at=e.Date,St=e.Error,Tt=e.Function,At=e.Math,Et=e.Object,Ct=e.RegExp,Ot=e.String,Pt=e.TypeError,It=n.prototype,Dt=Tt.prototype,Lt=Et.prototype,Rt=e["__core-js_shared__"],Bt=Dt.toString,Nt=Lt.hasOwnProperty,Ft=0,Ut=(i=/[^.]+$/.exec(Rt&&Rt.keys&&Rt.keys.IE_PROTO||""))?"Symbol(src)_1."+i:"",Gt=Lt.toString,zt=Bt.call(Et),kt=pe._,jt=Ct("^"+Bt.call(Nt).replace(rt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ht=ge?e.Buffer:r,Vt=e.Symbol,Wt=e.Uint8Array,qt=Ht?Ht.allocUnsafe:r,Jt=li(Et.getPrototypeOf,Et),Xt=Et.create,Yt=Lt.propertyIsEnumerable,Zt=It.splice,Kt=Vt?Vt.isConcatSpreadable:r,te=Vt?Vt.iterator:r,ie=Vt?Vt.toStringTag:r,le=function(){try{var t=ps(Et,"defineProperty");return t({},"",{}),t}catch(t){}}(),ue=e.clearTimeout!==pe.clearTimeout&&e.clearTimeout,de=at&&at.now!==pe.Date.now&&at.now,fe=e.setTimeout!==pe.setTimeout&&e.setTimeout,me=At.ceil,ve=At.floor,ye=Et.getOwnPropertySymbols,Ue=Ht?Ht.isBuffer:r,qe=e.isFinite,vi=It.join,yi=li(Et.keys,Et),_i=At.max,xi=At.min,Mi=at.now,bi=e.parseInt,wi=At.random,Si=It.reverse,Ti=ps(e,"DataView"),Ai=ps(e,"Map"),Ei=ps(e,"Promise"),Ci=ps(e,"Set"),Oi=ps(e,"WeakMap"),Pi=ps(Et,"create"),Ii=Oi&&new Oi,Di={},Li=zs(Ti),Ri=zs(Ai),Bi=zs(Ei),Ni=zs(Ci),Fi=zs(Oi),Ui=Vt?Vt.prototype:r,Gi=Ui?Ui.valueOf:r,zi=Ui?Ui.toString:r;function ki(t){if(ra(t)&&!Jo(t)&&!(t instanceof Wi)){if(t instanceof Vi)return t;if(Nt.call(t,"__wrapped__"))return ks(t)}return new Vi(t)}var ji=function(){function t(){}return function(e){if(!na(e))return{};if(Xt)return Xt(e);t.prototype=e;var i=new t;return t.prototype=r,i}}();function Hi(){}function Vi(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=r}function Wi(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=g,this.__views__=[]}function qi(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function Ji(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function Xi(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function Yi(t){var e=-1,i=null==t?0:t.length;for(this.__data__=new Xi;++e<i;)this.add(t[e])}function Zi(t){var e=this.__data__=new Ji(t);this.size=e.size}function Ki(t,e){var i=Jo(t),n=!i&&qo(t),r=!i&&!n&&Ko(t),s=!i&&!n&&!r&&da(t),o=i||n||r||s,a=o?Ye(t.length,Ot):[],l=a.length;for(var c in t)!e&&!Nt.call(t,c)||o&&("length"==c||r&&("offset"==c||"parent"==c)||s&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||xs(c,l))||a.push(c);return a}function Qi(t){var e=t.length;return e?t[Zn(0,e-1)]:r}function $i(t,e){return Fs(Ir(t),cn(e,0,t.length))}function tn(t){return Fs(Ir(t))}function en(t,e,i){(i!==r&&!Ho(t[e],i)||i===r&&!(e in t))&&an(t,e,i)}function nn(t,e,i){var n=t[e];Nt.call(t,e)&&Ho(n,i)&&(i!==r||e in t)||an(t,e,i)}function rn(t,e){for(var i=t.length;i--;)if(Ho(t[i][0],e))return i;return-1}function sn(t,e,i,n){return fn(t,(function(t,r,s){e(n,t,i(t),s)})),n}function on(t,e){return t&&Dr(e,Ra(e),t)}function an(t,e,i){"__proto__"==e&&le?le(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}function ln(t,e){for(var i=-1,s=e.length,o=n(s),a=null==t;++i<s;)o[i]=a?r:Oa(t,e[i]);return o}function cn(t,e,i){return t==t&&(i!==r&&(t=t<=i?t:i),e!==r&&(t=t>=e?t:e)),t}function hn(t,e,i,n,s,o){var a,l=1&e,c=2&e,h=4&e;if(i&&(a=s?i(t,n,s,o):i(t)),a!==r)return a;if(!na(t))return t;var u=Jo(t);if(u){if(a=function(t){var e=t.length,i=new t.constructor(e);e&&"string"==typeof t[0]&&Nt.call(t,"index")&&(i.index=t.index,i.input=t.input);return i}(t),!l)return Ir(t,a)}else{var d=gs(t),p=d==w||d==S;if(Ko(t))return Tr(t,l);if(d==E||d==y||p&&!s){if(a=c||p?{}:ys(t),!l)return c?function(t,e){return Dr(t,ms(t),e)}(t,function(t,e){return t&&Dr(e,Ba(e),t)}(a,t)):function(t,e){return Dr(t,fs(t),e)}(t,on(a,t))}else{if(!ae[d])return s?t:{};a=function(t,e,i){var n=t.constructor;switch(e){case R:return Ar(t);case x:case M:return new n(+t);case B:return function(t,e){var i=e?Ar(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}(t,i);case N:case F:case U:case G:case z:case k:case j:case H:case V:return Er(t,i);case T:return new n;case A:case I:return new n(t);case O:return function(t){var e=new t.constructor(t.source,mt.exec(t));return e.lastIndex=t.lastIndex,e}(t);case P:return new n;case D:return r=t,Gi?Et(Gi.call(r)):{}}var r}(t,d,l)}}o||(o=new Zi);var f=o.get(t);if(f)return f;o.set(t,a),ca(t)?t.forEach((function(n){a.add(hn(n,e,i,n,t,o))})):sa(t)&&t.forEach((function(n,r){a.set(r,hn(n,e,i,r,t,o))}));var m=u?r:(h?c?os:ss:c?Ba:Ra)(t);return Ee(m||t,(function(n,r){m&&(n=t[r=n]),nn(a,r,hn(n,e,i,r,t,o))})),a}function un(t,e,i){var n=i.length;if(null==t)return!n;for(t=Et(t);n--;){var s=i[n],o=e[s],a=t[s];if(a===r&&!(s in t)||!o(a))return!1}return!0}function dn(t,e,i){if("function"!=typeof t)throw new Pt(s);return Ls((function(){t.apply(r,i)}),e)}function pn(t,e,i,n){var r=-1,s=Ie,o=!0,a=t.length,l=[],c=e.length;if(!a)return l;i&&(e=Le(e,Ke(i))),n?(s=De,o=!1):e.length>=200&&(s=$e,o=!1,e=new Yi(e));t:for(;++r<a;){var h=t[r],u=null==i?h:i(h);if(h=n||0!==h?h:0,o&&u==u){for(var d=c;d--;)if(e[d]===u)continue t;l.push(h)}else s(e,u,n)||l.push(h)}return l}ki.templateSettings={escape:Q,evaluate:$,interpolate:tt,variable:"",imports:{_:ki}},ki.prototype=Hi.prototype,ki.prototype.constructor=ki,Vi.prototype=ji(Hi.prototype),Vi.prototype.constructor=Vi,Wi.prototype=ji(Hi.prototype),Wi.prototype.constructor=Wi,qi.prototype.clear=function(){this.__data__=Pi?Pi(null):{},this.size=0},qi.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},qi.prototype.get=function(t){var e=this.__data__;if(Pi){var i=e[t];return i===o?r:i}return Nt.call(e,t)?e[t]:r},qi.prototype.has=function(t){var e=this.__data__;return Pi?e[t]!==r:Nt.call(e,t)},qi.prototype.set=function(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=Pi&&e===r?o:e,this},Ji.prototype.clear=function(){this.__data__=[],this.size=0},Ji.prototype.delete=function(t){var e=this.__data__,i=rn(e,t);return!(i<0)&&(i==e.length-1?e.pop():Zt.call(e,i,1),--this.size,!0)},Ji.prototype.get=function(t){var e=this.__data__,i=rn(e,t);return i<0?r:e[i][1]},Ji.prototype.has=function(t){return rn(this.__data__,t)>-1},Ji.prototype.set=function(t,e){var i=this.__data__,n=rn(i,t);return n<0?(++this.size,i.push([t,e])):i[n][1]=e,this},Xi.prototype.clear=function(){this.size=0,this.__data__={hash:new qi,map:new(Ai||Ji),string:new qi}},Xi.prototype.delete=function(t){var e=us(this,t).delete(t);return this.size-=e?1:0,e},Xi.prototype.get=function(t){return us(this,t).get(t)},Xi.prototype.has=function(t){return us(this,t).has(t)},Xi.prototype.set=function(t,e){var i=us(this,t),n=i.size;return i.set(t,e),this.size+=i.size==n?0:1,this},Yi.prototype.add=Yi.prototype.push=function(t){return this.__data__.set(t,o),this},Yi.prototype.has=function(t){return this.__data__.has(t)},Zi.prototype.clear=function(){this.__data__=new Ji,this.size=0},Zi.prototype.delete=function(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i},Zi.prototype.get=function(t){return this.__data__.get(t)},Zi.prototype.has=function(t){return this.__data__.has(t)},Zi.prototype.set=function(t,e){var i=this.__data__;if(i instanceof Ji){var n=i.__data__;if(!Ai||n.length<199)return n.push([t,e]),this.size=++i.size,this;i=this.__data__=new Xi(n)}return i.set(t,e),this.size=i.size,this};var fn=Br(bn),mn=Br(wn,!0);function gn(t,e){var i=!0;return fn(t,(function(t,n,r){return i=!!e(t,n,r)})),i}function vn(t,e,i){for(var n=-1,s=t.length;++n<s;){var o=t[n],a=e(o);if(null!=a&&(l===r?a==a&&!ua(a):i(a,l)))var l=a,c=o}return c}function yn(t,e){var i=[];return fn(t,(function(t,n,r){e(t,n,r)&&i.push(t)})),i}function _n(t,e,i,n,r){var s=-1,o=t.length;for(i||(i=_s),r||(r=[]);++s<o;){var a=t[s];e>0&&i(a)?e>1?_n(a,e-1,i,n,r):Re(r,a):n||(r[r.length]=a)}return r}var xn=Nr(),Mn=Nr(!0);function bn(t,e){return t&&xn(t,e,Ra)}function wn(t,e){return t&&Mn(t,e,Ra)}function Sn(t,e){return Pe(e,(function(e){return ta(t[e])}))}function Tn(t,e){for(var i=0,n=(e=Mr(e,t)).length;null!=t&&i<n;)t=t[Gs(e[i++])];return i&&i==n?t:r}function An(t,e,i){var n=e(t);return Jo(t)?n:Re(n,i(t))}function En(t){return null==t?t===r?"[object Undefined]":"[object Null]":ie&&ie in Et(t)?function(t){var e=Nt.call(t,ie),i=t[ie];try{t[ie]=r;var n=!0}catch(t){}var s=Gt.call(t);n&&(e?t[ie]=i:delete t[ie]);return s}(t):function(t){return Gt.call(t)}(t)}function Cn(t,e){return t>e}function On(t,e){return null!=t&&Nt.call(t,e)}function Pn(t,e){return null!=t&&e in Et(t)}function In(t,e,i){for(var s=i?De:Ie,o=t[0].length,a=t.length,l=a,c=n(a),h=1/0,u=[];l--;){var d=t[l];l&&e&&(d=Le(d,Ke(e))),h=xi(d.length,h),c[l]=!i&&(e||o>=120&&d.length>=120)?new Yi(l&&d):r}d=t[0];var p=-1,f=c[0];t:for(;++p<o&&u.length<h;){var m=d[p],g=e?e(m):m;if(m=i||0!==m?m:0,!(f?$e(f,g):s(u,g,i))){for(l=a;--l;){var v=c[l];if(!(v?$e(v,g):s(t[l],g,i)))continue t}f&&f.push(g),u.push(m)}}return u}function Dn(t,e,i){var n=null==(t=Os(t,e=Mr(e,t)))?t:t[Gs(Qs(e))];return null==n?r:Te(n,t,i)}function Ln(t){return ra(t)&&En(t)==y}function Rn(t,e,i,n,s){return t===e||(null==t||null==e||!ra(t)&&!ra(e)?t!=t&&e!=e:function(t,e,i,n,s,o){var a=Jo(t),l=Jo(e),c=a?_:gs(t),h=l?_:gs(e),u=(c=c==y?E:c)==E,d=(h=h==y?E:h)==E,p=c==h;if(p&&Ko(t)){if(!Ko(e))return!1;a=!0,u=!1}if(p&&!u)return o||(o=new Zi),a||da(t)?ns(t,e,i,n,s,o):function(t,e,i,n,r,s,o){switch(i){case B:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case R:return!(t.byteLength!=e.byteLength||!s(new Wt(t),new Wt(e)));case x:case M:case A:return Ho(+t,+e);case b:return t.name==e.name&&t.message==e.message;case O:case I:return t==e+"";case T:var a=ai;case P:var l=1&n;if(a||(a=hi),t.size!=e.size&&!l)return!1;var c=o.get(t);if(c)return c==e;n|=2,o.set(t,e);var h=ns(a(t),a(e),n,r,s,o);return o.delete(t),h;case D:if(Gi)return Gi.call(t)==Gi.call(e)}return!1}(t,e,c,i,n,s,o);if(!(1&i)){var f=u&&Nt.call(t,"__wrapped__"),m=d&&Nt.call(e,"__wrapped__");if(f||m){var g=f?t.value():t,v=m?e.value():e;return o||(o=new Zi),s(g,v,i,n,o)}}if(!p)return!1;return o||(o=new Zi),function(t,e,i,n,s,o){var a=1&i,l=ss(t),c=l.length,h=ss(e).length;if(c!=h&&!a)return!1;var u=c;for(;u--;){var d=l[u];if(!(a?d in e:Nt.call(e,d)))return!1}var p=o.get(t),f=o.get(e);if(p&&f)return p==e&&f==t;var m=!0;o.set(t,e),o.set(e,t);var g=a;for(;++u<c;){var v=t[d=l[u]],y=e[d];if(n)var _=a?n(y,v,d,e,t,o):n(v,y,d,t,e,o);if(!(_===r?v===y||s(v,y,i,n,o):_)){m=!1;break}g||(g="constructor"==d)}if(m&&!g){var x=t.constructor,M=e.constructor;x==M||!("constructor"in t)||!("constructor"in e)||"function"==typeof x&&x instanceof x&&"function"==typeof M&&M instanceof M||(m=!1)}return o.delete(t),o.delete(e),m}(t,e,i,n,s,o)}(t,e,i,n,Rn,s))}function Bn(t,e,i,n){var s=i.length,o=s,a=!n;if(null==t)return!o;for(t=Et(t);s--;){var l=i[s];if(a&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++s<o;){var c=(l=i[s])[0],h=t[c],u=l[1];if(a&&l[2]){if(h===r&&!(c in t))return!1}else{var d=new Zi;if(n)var p=n(h,u,c,t,e,d);if(!(p===r?Rn(u,h,3,n,d):p))return!1}}return!0}function Nn(t){return!(!na(t)||(e=t,Ut&&Ut in e))&&(ta(t)?jt:yt).test(zs(t));var e}function Fn(t){return"function"==typeof t?t:null==t?ol:"object"==typeof t?Jo(t)?Hn(t[0],t[1]):jn(t):ml(t)}function Un(t){if(!Ts(t))return yi(t);var e=[];for(var i in Et(t))Nt.call(t,i)&&"constructor"!=i&&e.push(i);return e}function Gn(t){if(!na(t))return function(t){var e=[];if(null!=t)for(var i in Et(t))e.push(i);return e}(t);var e=Ts(t),i=[];for(var n in t)("constructor"!=n||!e&&Nt.call(t,n))&&i.push(n);return i}function zn(t,e){return t<e}function kn(t,e){var i=-1,r=Yo(t)?n(t.length):[];return fn(t,(function(t,n,s){r[++i]=e(t,n,s)})),r}function jn(t){var e=ds(t);return 1==e.length&&e[0][2]?Es(e[0][0],e[0][1]):function(i){return i===t||Bn(i,t,e)}}function Hn(t,e){return bs(t)&&As(e)?Es(Gs(t),e):function(i){var n=Oa(i,t);return n===r&&n===e?Pa(i,t):Rn(e,n,3)}}function Vn(t,e,i,n,s){t!==e&&xn(e,(function(o,a){if(s||(s=new Zi),na(o))!function(t,e,i,n,s,o,a){var l=Is(t,i),c=Is(e,i),h=a.get(c);if(h)return void en(t,i,h);var u=o?o(l,c,i+"",t,e,a):r,d=u===r;if(d){var p=Jo(c),f=!p&&Ko(c),m=!p&&!f&&da(c);u=c,p||f||m?Jo(l)?u=l:Zo(l)?u=Ir(l):f?(d=!1,u=Tr(c,!0)):m?(d=!1,u=Er(c,!0)):u=[]:aa(c)||qo(c)?(u=l,qo(l)?u=xa(l):na(l)&&!ta(l)||(u=ys(c))):d=!1}d&&(a.set(c,u),s(u,c,n,o,a),a.delete(c));en(t,i,u)}(t,e,a,i,Vn,n,s);else{var l=n?n(Is(t,a),o,a+"",t,e,s):r;l===r&&(l=o),en(t,a,l)}}),Ba)}function Wn(t,e){var i=t.length;if(i)return xs(e+=e<0?i:0,i)?t[e]:r}function qn(t,e,i){e=e.length?Le(e,(function(t){return Jo(t)?function(e){return Tn(e,1===t.length?t[0]:t)}:t})):[ol];var n=-1;e=Le(e,Ke(hs()));var r=kn(t,(function(t,i,r){var s=Le(e,(function(e){return e(t)}));return{criteria:s,index:++n,value:t}}));return function(t,e){var i=t.length;for(t.sort(e);i--;)t[i]=t[i].value;return t}(r,(function(t,e){return function(t,e,i){var n=-1,r=t.criteria,s=e.criteria,o=r.length,a=i.length;for(;++n<o;){var l=Cr(r[n],s[n]);if(l)return n>=a?l:l*("desc"==i[n]?-1:1)}return t.index-e.index}(t,e,i)}))}function Jn(t,e,i){for(var n=-1,r=e.length,s={};++n<r;){var o=e[n],a=Tn(t,o);i(a,o)&&er(s,Mr(o,t),a)}return s}function Xn(t,e,i,n){var r=n?je:ke,s=-1,o=e.length,a=t;for(t===e&&(e=Ir(e)),i&&(a=Le(t,Ke(i)));++s<o;)for(var l=0,c=e[s],h=i?i(c):c;(l=r(a,h,l,n))>-1;)a!==t&&Zt.call(a,l,1),Zt.call(t,l,1);return t}function Yn(t,e){for(var i=t?e.length:0,n=i-1;i--;){var r=e[i];if(i==n||r!==s){var s=r;xs(r)?Zt.call(t,r,1):pr(t,r)}}return t}function Zn(t,e){return t+ve(wi()*(e-t+1))}function Kn(t,e){var i="";if(!t||e<1||e>f)return i;do{e%2&&(i+=t),(e=ve(e/2))&&(t+=t)}while(e);return i}function Qn(t,e){return Rs(Cs(t,e,ol),t+"")}function $n(t){return Qi(Ha(t))}function tr(t,e){var i=Ha(t);return Fs(i,cn(e,0,i.length))}function er(t,e,i,n){if(!na(t))return t;for(var s=-1,o=(e=Mr(e,t)).length,a=o-1,l=t;null!=l&&++s<o;){var c=Gs(e[s]),h=i;if("__proto__"===c||"constructor"===c||"prototype"===c)return t;if(s!=a){var u=l[c];(h=n?n(u,c,l):r)===r&&(h=na(u)?u:xs(e[s+1])?[]:{})}nn(l,c,h),l=l[c]}return t}var ir=Ii?function(t,e){return Ii.set(t,e),t}:ol,nr=le?function(t,e){return le(t,"toString",{configurable:!0,enumerable:!1,value:nl(e),writable:!0})}:ol;function rr(t){return Fs(Ha(t))}function sr(t,e,i){var r=-1,s=t.length;e<0&&(e=-e>s?0:s+e),(i=i>s?s:i)<0&&(i+=s),s=e>i?0:i-e>>>0,e>>>=0;for(var o=n(s);++r<s;)o[r]=t[r+e];return o}function or(t,e){var i;return fn(t,(function(t,n,r){return!(i=e(t,n,r))})),!!i}function ar(t,e,i){var n=0,r=null==t?n:t.length;if("number"==typeof e&&e==e&&r<=2147483647){for(;n<r;){var s=n+r>>>1,o=t[s];null!==o&&!ua(o)&&(i?o<=e:o<e)?n=s+1:r=s}return r}return lr(t,e,ol,i)}function lr(t,e,i,n){var s=0,o=null==t?0:t.length;if(0===o)return 0;for(var a=(e=i(e))!=e,l=null===e,c=ua(e),h=e===r;s<o;){var u=ve((s+o)/2),d=i(t[u]),p=d!==r,f=null===d,m=d==d,g=ua(d);if(a)var v=n||m;else v=h?m&&(n||p):l?m&&p&&(n||!f):c?m&&p&&!f&&(n||!g):!f&&!g&&(n?d<=e:d<e);v?s=u+1:o=u}return xi(o,4294967294)}function cr(t,e){for(var i=-1,n=t.length,r=0,s=[];++i<n;){var o=t[i],a=e?e(o):o;if(!i||!Ho(a,l)){var l=a;s[r++]=0===o?0:o}}return s}function hr(t){return"number"==typeof t?t:ua(t)?m:+t}function ur(t){if("string"==typeof t)return t;if(Jo(t))return Le(t,ur)+"";if(ua(t))return zi?zi.call(t):"";var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function dr(t,e,i){var n=-1,r=Ie,s=t.length,o=!0,a=[],l=a;if(i)o=!1,r=De;else if(s>=200){var c=e?null:Kr(t);if(c)return hi(c);o=!1,r=$e,l=new Yi}else l=e?[]:a;t:for(;++n<s;){var h=t[n],u=e?e(h):h;if(h=i||0!==h?h:0,o&&u==u){for(var d=l.length;d--;)if(l[d]===u)continue t;e&&l.push(u),a.push(h)}else r(l,u,i)||(l!==a&&l.push(u),a.push(h))}return a}function pr(t,e){return null==(t=Os(t,e=Mr(e,t)))||delete t[Gs(Qs(e))]}function fr(t,e,i,n){return er(t,e,i(Tn(t,e)),n)}function mr(t,e,i,n){for(var r=t.length,s=n?r:-1;(n?s--:++s<r)&&e(t[s],s,t););return i?sr(t,n?0:s,n?s+1:r):sr(t,n?s+1:0,n?r:s)}function gr(t,e){var i=t;return i instanceof Wi&&(i=i.value()),Be(e,(function(t,e){return e.func.apply(e.thisArg,Re([t],e.args))}),i)}function vr(t,e,i){var r=t.length;if(r<2)return r?dr(t[0]):[];for(var s=-1,o=n(r);++s<r;)for(var a=t[s],l=-1;++l<r;)l!=s&&(o[s]=pn(o[s]||a,t[l],e,i));return dr(_n(o,1),e,i)}function yr(t,e,i){for(var n=-1,s=t.length,o=e.length,a={};++n<s;){var l=n<o?e[n]:r;i(a,t[n],l)}return a}function _r(t){return Zo(t)?t:[]}function xr(t){return"function"==typeof t?t:ol}function Mr(t,e){return Jo(t)?t:bs(t,e)?[t]:Us(Ma(t))}var br=Qn;function wr(t,e,i){var n=t.length;return i=i===r?n:i,!e&&i>=n?t:sr(t,e,i)}var Sr=ue||function(t){return pe.clearTimeout(t)};function Tr(t,e){if(e)return t.slice();var i=t.length,n=qt?qt(i):new t.constructor(i);return t.copy(n),n}function Ar(t){var e=new t.constructor(t.byteLength);return new Wt(e).set(new Wt(t)),e}function Er(t,e){var i=e?Ar(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}function Cr(t,e){if(t!==e){var i=t!==r,n=null===t,s=t==t,o=ua(t),a=e!==r,l=null===e,c=e==e,h=ua(e);if(!l&&!h&&!o&&t>e||o&&a&&c&&!l&&!h||n&&a&&c||!i&&c||!s)return 1;if(!n&&!o&&!h&&t<e||h&&i&&s&&!n&&!o||l&&i&&s||!a&&s||!c)return-1}return 0}function Or(t,e,i,r){for(var s=-1,o=t.length,a=i.length,l=-1,c=e.length,h=_i(o-a,0),u=n(c+h),d=!r;++l<c;)u[l]=e[l];for(;++s<a;)(d||s<o)&&(u[i[s]]=t[s]);for(;h--;)u[l++]=t[s++];return u}function Pr(t,e,i,r){for(var s=-1,o=t.length,a=-1,l=i.length,c=-1,h=e.length,u=_i(o-l,0),d=n(u+h),p=!r;++s<u;)d[s]=t[s];for(var f=s;++c<h;)d[f+c]=e[c];for(;++a<l;)(p||s<o)&&(d[f+i[a]]=t[s++]);return d}function Ir(t,e){var i=-1,r=t.length;for(e||(e=n(r));++i<r;)e[i]=t[i];return e}function Dr(t,e,i,n){var s=!i;i||(i={});for(var o=-1,a=e.length;++o<a;){var l=e[o],c=n?n(i[l],t[l],l,i,t):r;c===r&&(c=t[l]),s?an(i,l,c):nn(i,l,c)}return i}function Lr(t,e){return function(i,n){var r=Jo(i)?Ae:sn,s=e?e():{};return r(i,t,hs(n,2),s)}}function Rr(t){return Qn((function(e,i){var n=-1,s=i.length,o=s>1?i[s-1]:r,a=s>2?i[2]:r;for(o=t.length>3&&"function"==typeof o?(s--,o):r,a&&Ms(i[0],i[1],a)&&(o=s<3?r:o,s=1),e=Et(e);++n<s;){var l=i[n];l&&t(e,l,n,o)}return e}))}function Br(t,e){return function(i,n){if(null==i)return i;if(!Yo(i))return t(i,n);for(var r=i.length,s=e?r:-1,o=Et(i);(e?s--:++s<r)&&!1!==n(o[s],s,o););return i}}function Nr(t){return function(e,i,n){for(var r=-1,s=Et(e),o=n(e),a=o.length;a--;){var l=o[t?a:++r];if(!1===i(s[l],l,s))break}return e}}function Fr(t){return function(e){var i=oi(e=Ma(e))?pi(e):r,n=i?i[0]:e.charAt(0),s=i?wr(i,1).join(""):e.slice(1);return n[t]()+s}}function Ur(t){return function(e){return Be(tl(qa(e).replace(Qt,"")),t,"")}}function Gr(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var i=ji(t.prototype),n=t.apply(i,e);return na(n)?n:i}}function zr(t){return function(e,i,n){var s=Et(e);if(!Yo(e)){var o=hs(i,3);e=Ra(e),i=function(t){return o(s[t],t,s)}}var a=t(e,i,n);return a>-1?s[o?e[a]:a]:r}}function kr(t){return rs((function(e){var i=e.length,n=i,o=Vi.prototype.thru;for(t&&e.reverse();n--;){var a=e[n];if("function"!=typeof a)throw new Pt(s);if(o&&!l&&"wrapper"==ls(a))var l=new Vi([],!0)}for(n=l?n:i;++n<i;){var c=ls(a=e[n]),h="wrapper"==c?as(a):r;l=h&&ws(h[0])&&424==h[1]&&!h[4].length&&1==h[9]?l[ls(h[0])].apply(l,h[3]):1==a.length&&ws(a)?l[c]():l.thru(a)}return function(){var t=arguments,n=t[0];if(l&&1==t.length&&Jo(n))return l.plant(n).value();for(var r=0,s=i?e[r].apply(this,t):n;++r<i;)s=e[r].call(this,s);return s}}))}function jr(t,e,i,s,o,a,l,c,h,d){var p=e&u,f=1&e,m=2&e,g=24&e,v=512&e,y=m?r:Gr(t);return function r(){for(var u=arguments.length,_=n(u),x=u;x--;)_[x]=arguments[x];if(g)var M=cs(r),b=ii(_,M);if(s&&(_=Or(_,s,o,g)),a&&(_=Pr(_,a,l,g)),u-=b,g&&u<d){var w=ci(_,M);return Yr(t,e,jr,r.placeholder,i,_,w,c,h,d-u)}var S=f?i:this,T=m?S[t]:t;return u=_.length,c?_=Ps(_,c):v&&u>1&&_.reverse(),p&&h<u&&(_.length=h),this&&this!==pe&&this instanceof r&&(T=y||Gr(T)),T.apply(S,_)}}function Hr(t,e){return function(i,n){return function(t,e,i,n){return bn(t,(function(t,r,s){e(n,i(t),r,s)})),n}(i,t,e(n),{})}}function Vr(t,e){return function(i,n){var s;if(i===r&&n===r)return e;if(i!==r&&(s=i),n!==r){if(s===r)return n;"string"==typeof i||"string"==typeof n?(i=ur(i),n=ur(n)):(i=hr(i),n=hr(n)),s=t(i,n)}return s}}function Wr(t){return rs((function(e){return e=Le(e,Ke(hs())),Qn((function(i){var n=this;return t(e,(function(t){return Te(t,n,i)}))}))}))}function qr(t,e){var i=(e=e===r?" ":ur(e)).length;if(i<2)return i?Kn(e,t):e;var n=Kn(e,me(t/di(e)));return oi(e)?wr(pi(n),0,t).join(""):n.slice(0,t)}function Jr(t){return function(e,i,s){return s&&"number"!=typeof s&&Ms(e,i,s)&&(i=s=r),e=ga(e),i===r?(i=e,e=0):i=ga(i),function(t,e,i,r){for(var s=-1,o=_i(me((e-t)/(i||1)),0),a=n(o);o--;)a[r?o:++s]=t,t+=i;return a}(e,i,s=s===r?e<i?1:-1:ga(s),t)}}function Xr(t){return function(e,i){return"string"==typeof e&&"string"==typeof i||(e=_a(e),i=_a(i)),t(e,i)}}function Yr(t,e,i,n,s,o,a,l,u,d){var p=8&e;e|=p?c:h,4&(e&=~(p?h:c))||(e&=-4);var f=[t,e,s,p?o:r,p?a:r,p?r:o,p?r:a,l,u,d],m=i.apply(r,f);return ws(t)&&Ds(m,f),m.placeholder=n,Bs(m,t,e)}function Zr(t){var e=At[t];return function(t,i){if(t=_a(t),(i=null==i?0:xi(va(i),292))&&qe(t)){var n=(Ma(t)+"e").split("e");return+((n=(Ma(e(n[0]+"e"+(+n[1]+i)))+"e").split("e"))[0]+"e"+(+n[1]-i))}return e(t)}}var Kr=Ci&&1/hi(new Ci([,-0]))[1]==p?function(t){return new Ci(t)}:ul;function Qr(t){return function(e){var i=gs(e);return i==T?ai(e):i==P?ui(e):function(t,e){return Le(e,(function(e){return[e,t[e]]}))}(e,t(e))}}function $r(t,e,i,o,p,f,m,g){var v=2&e;if(!v&&"function"!=typeof t)throw new Pt(s);var y=o?o.length:0;if(y||(e&=-97,o=p=r),m=m===r?m:_i(va(m),0),g=g===r?g:va(g),y-=p?p.length:0,e&h){var _=o,x=p;o=p=r}var M=v?r:as(t),b=[t,e,i,o,p,_,x,f,m,g];if(M&&function(t,e){var i=t[1],n=e[1],r=i|n,s=r<131,o=n==u&&8==i||n==u&&i==d&&t[7].length<=e[8]||384==n&&e[7].length<=e[8]&&8==i;if(!s&&!o)return t;1&n&&(t[2]=e[2],r|=1&i?0:4);var l=e[3];if(l){var c=t[3];t[3]=c?Or(c,l,e[4]):l,t[4]=c?ci(t[3],a):e[4]}(l=e[5])&&(c=t[5],t[5]=c?Pr(c,l,e[6]):l,t[6]=c?ci(t[5],a):e[6]);(l=e[7])&&(t[7]=l);n&u&&(t[8]=null==t[8]?e[8]:xi(t[8],e[8]));null==t[9]&&(t[9]=e[9]);t[0]=e[0],t[1]=r}(b,M),t=b[0],e=b[1],i=b[2],o=b[3],p=b[4],!(g=b[9]=b[9]===r?v?0:t.length:_i(b[9]-y,0))&&24&e&&(e&=-25),e&&1!=e)w=8==e||e==l?function(t,e,i){var s=Gr(t);return function o(){for(var a=arguments.length,l=n(a),c=a,h=cs(o);c--;)l[c]=arguments[c];var u=a<3&&l[0]!==h&&l[a-1]!==h?[]:ci(l,h);return(a-=u.length)<i?Yr(t,e,jr,o.placeholder,r,l,u,r,r,i-a):Te(this&&this!==pe&&this instanceof o?s:t,this,l)}}(t,e,g):e!=c&&33!=e||p.length?jr.apply(r,b):function(t,e,i,r){var s=1&e,o=Gr(t);return function e(){for(var a=-1,l=arguments.length,c=-1,h=r.length,u=n(h+l),d=this&&this!==pe&&this instanceof e?o:t;++c<h;)u[c]=r[c];for(;l--;)u[c++]=arguments[++a];return Te(d,s?i:this,u)}}(t,e,i,o);else var w=function(t,e,i){var n=1&e,r=Gr(t);return function e(){return(this&&this!==pe&&this instanceof e?r:t).apply(n?i:this,arguments)}}(t,e,i);return Bs((M?ir:Ds)(w,b),t,e)}function ts(t,e,i,n){return t===r||Ho(t,Lt[i])&&!Nt.call(n,i)?e:t}function es(t,e,i,n,s,o){return na(t)&&na(e)&&(o.set(e,t),Vn(t,e,r,es,o),o.delete(e)),t}function is(t){return aa(t)?r:t}function ns(t,e,i,n,s,o){var a=1&i,l=t.length,c=e.length;if(l!=c&&!(a&&c>l))return!1;var h=o.get(t),u=o.get(e);if(h&&u)return h==e&&u==t;var d=-1,p=!0,f=2&i?new Yi:r;for(o.set(t,e),o.set(e,t);++d<l;){var m=t[d],g=e[d];if(n)var v=a?n(g,m,d,e,t,o):n(m,g,d,t,e,o);if(v!==r){if(v)continue;p=!1;break}if(f){if(!Fe(e,(function(t,e){if(!$e(f,e)&&(m===t||s(m,t,i,n,o)))return f.push(e)}))){p=!1;break}}else if(m!==g&&!s(m,g,i,n,o)){p=!1;break}}return o.delete(t),o.delete(e),p}function rs(t){return Rs(Cs(t,r,Js),t+"")}function ss(t){return An(t,Ra,fs)}function os(t){return An(t,Ba,ms)}var as=Ii?function(t){return Ii.get(t)}:ul;function ls(t){for(var e=t.name+"",i=Di[e],n=Nt.call(Di,e)?i.length:0;n--;){var r=i[n],s=r.func;if(null==s||s==t)return r.name}return e}function cs(t){return(Nt.call(ki,"placeholder")?ki:t).placeholder}function hs(){var t=ki.iteratee||al;return t=t===al?Fn:t,arguments.length?t(arguments[0],arguments[1]):t}function us(t,e){var i,n,r=t.__data__;return("string"==(n=typeof(i=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==i:null===i)?r["string"==typeof e?"string":"hash"]:r.map}function ds(t){for(var e=Ra(t),i=e.length;i--;){var n=e[i],r=t[n];e[i]=[n,r,As(r)]}return e}function ps(t,e){var i=function(t,e){return null==t?r:t[e]}(t,e);return Nn(i)?i:r}var fs=ye?function(t){return null==t?[]:(t=Et(t),Pe(ye(t),(function(e){return Yt.call(t,e)})))}:yl,ms=ye?function(t){for(var e=[];t;)Re(e,fs(t)),t=Jt(t);return e}:yl,gs=En;function vs(t,e,i){for(var n=-1,r=(e=Mr(e,t)).length,s=!1;++n<r;){var o=Gs(e[n]);if(!(s=null!=t&&i(t,o)))break;t=t[o]}return s||++n!=r?s:!!(r=null==t?0:t.length)&&ia(r)&&xs(o,r)&&(Jo(t)||qo(t))}function ys(t){return"function"!=typeof t.constructor||Ts(t)?{}:ji(Jt(t))}function _s(t){return Jo(t)||qo(t)||!!(Kt&&t&&t[Kt])}function xs(t,e){var i=typeof t;return!!(e=null==e?f:e)&&("number"==i||"symbol"!=i&&xt.test(t))&&t>-1&&t%1==0&&t<e}function Ms(t,e,i){if(!na(i))return!1;var n=typeof e;return!!("number"==n?Yo(i)&&xs(e,i.length):"string"==n&&e in i)&&Ho(i[e],t)}function bs(t,e){if(Jo(t))return!1;var i=typeof t;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=t&&!ua(t))||(it.test(t)||!et.test(t)||null!=e&&t in Et(e))}function ws(t){var e=ls(t),i=ki[e];if("function"!=typeof i||!(e in Wi.prototype))return!1;if(t===i)return!0;var n=as(i);return!!n&&t===n[0]}(Ti&&gs(new Ti(new ArrayBuffer(1)))!=B||Ai&&gs(new Ai)!=T||Ei&&gs(Ei.resolve())!=C||Ci&&gs(new Ci)!=P||Oi&&gs(new Oi)!=L)&&(gs=function(t){var e=En(t),i=e==E?t.constructor:r,n=i?zs(i):"";if(n)switch(n){case Li:return B;case Ri:return T;case Bi:return C;case Ni:return P;case Fi:return L}return e});var Ss=Rt?ta:_l;function Ts(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Lt)}function As(t){return t==t&&!na(t)}function Es(t,e){return function(i){return null!=i&&(i[t]===e&&(e!==r||t in Et(i)))}}function Cs(t,e,i){return e=_i(e===r?t.length-1:e,0),function(){for(var r=arguments,s=-1,o=_i(r.length-e,0),a=n(o);++s<o;)a[s]=r[e+s];s=-1;for(var l=n(e+1);++s<e;)l[s]=r[s];return l[e]=i(a),Te(t,this,l)}}function Os(t,e){return e.length<2?t:Tn(t,sr(e,0,-1))}function Ps(t,e){for(var i=t.length,n=xi(e.length,i),s=Ir(t);n--;){var o=e[n];t[n]=xs(o,i)?s[o]:r}return t}function Is(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var Ds=Ns(ir),Ls=fe||function(t,e){return pe.setTimeout(t,e)},Rs=Ns(nr);function Bs(t,e,i){var n=e+"";return Rs(t,function(t,e){var i=e.length;if(!i)return t;var n=i-1;return e[n]=(i>1?"& ":"")+e[n],e=e.join(i>2?", ":" "),t.replace(lt,"{\n/* [wrapped with "+e+"] */\n")}(n,function(t,e){return Ee(v,(function(i){var n="_."+i[0];e&i[1]&&!Ie(t,n)&&t.push(n)})),t.sort()}(function(t){var e=t.match(ct);return e?e[1].split(ht):[]}(n),i)))}function Ns(t){var e=0,i=0;return function(){var n=Mi(),s=16-(n-i);if(i=n,s>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(r,arguments)}}function Fs(t,e){var i=-1,n=t.length,s=n-1;for(e=e===r?n:e;++i<e;){var o=Zn(i,s),a=t[o];t[o]=t[i],t[i]=a}return t.length=e,t}var Us=function(t){var e=Fo(t,(function(t){return 500===i.size&&i.clear(),t})),i=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(nt,(function(t,i,n,r){e.push(n?r.replace(pt,"$1"):i||t)})),e}));function Gs(t){if("string"==typeof t||ua(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function zs(t){if(null!=t){try{return Bt.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function ks(t){if(t instanceof Wi)return t.clone();var e=new Vi(t.__wrapped__,t.__chain__);return e.__actions__=Ir(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var js=Qn((function(t,e){return Zo(t)?pn(t,_n(e,1,Zo,!0)):[]})),Hs=Qn((function(t,e){var i=Qs(e);return Zo(i)&&(i=r),Zo(t)?pn(t,_n(e,1,Zo,!0),hs(i,2)):[]})),Vs=Qn((function(t,e){var i=Qs(e);return Zo(i)&&(i=r),Zo(t)?pn(t,_n(e,1,Zo,!0),r,i):[]}));function Ws(t,e,i){var n=null==t?0:t.length;if(!n)return-1;var r=null==i?0:va(i);return r<0&&(r=_i(n+r,0)),ze(t,hs(e,3),r)}function qs(t,e,i){var n=null==t?0:t.length;if(!n)return-1;var s=n-1;return i!==r&&(s=va(i),s=i<0?_i(n+s,0):xi(s,n-1)),ze(t,hs(e,3),s,!0)}function Js(t){return(null==t?0:t.length)?_n(t,1):[]}function Xs(t){return t&&t.length?t[0]:r}var Ys=Qn((function(t){var e=Le(t,_r);return e.length&&e[0]===t[0]?In(e):[]})),Zs=Qn((function(t){var e=Qs(t),i=Le(t,_r);return e===Qs(i)?e=r:i.pop(),i.length&&i[0]===t[0]?In(i,hs(e,2)):[]})),Ks=Qn((function(t){var e=Qs(t),i=Le(t,_r);return(e="function"==typeof e?e:r)&&i.pop(),i.length&&i[0]===t[0]?In(i,r,e):[]}));function Qs(t){var e=null==t?0:t.length;return e?t[e-1]:r}var $s=Qn(to);function to(t,e){return t&&t.length&&e&&e.length?Xn(t,e):t}var eo=rs((function(t,e){var i=null==t?0:t.length,n=ln(t,e);return Yn(t,Le(e,(function(t){return xs(t,i)?+t:t})).sort(Cr)),n}));function io(t){return null==t?t:Si.call(t)}var no=Qn((function(t){return dr(_n(t,1,Zo,!0))})),ro=Qn((function(t){var e=Qs(t);return Zo(e)&&(e=r),dr(_n(t,1,Zo,!0),hs(e,2))})),so=Qn((function(t){var e=Qs(t);return e="function"==typeof e?e:r,dr(_n(t,1,Zo,!0),r,e)}));function oo(t){if(!t||!t.length)return[];var e=0;return t=Pe(t,(function(t){if(Zo(t))return e=_i(t.length,e),!0})),Ye(e,(function(e){return Le(t,We(e))}))}function ao(t,e){if(!t||!t.length)return[];var i=oo(t);return null==e?i:Le(i,(function(t){return Te(e,r,t)}))}var lo=Qn((function(t,e){return Zo(t)?pn(t,e):[]})),co=Qn((function(t){return vr(Pe(t,Zo))})),ho=Qn((function(t){var e=Qs(t);return Zo(e)&&(e=r),vr(Pe(t,Zo),hs(e,2))})),uo=Qn((function(t){var e=Qs(t);return e="function"==typeof e?e:r,vr(Pe(t,Zo),r,e)})),po=Qn(oo);var fo=Qn((function(t){var e=t.length,i=e>1?t[e-1]:r;return i="function"==typeof i?(t.pop(),i):r,ao(t,i)}));function mo(t){var e=ki(t);return e.__chain__=!0,e}function go(t,e){return e(t)}var vo=rs((function(t){var e=t.length,i=e?t[0]:0,n=this.__wrapped__,s=function(e){return ln(e,t)};return!(e>1||this.__actions__.length)&&n instanceof Wi&&xs(i)?((n=n.slice(i,+i+(e?1:0))).__actions__.push({func:go,args:[s],thisArg:r}),new Vi(n,this.__chain__).thru((function(t){return e&&!t.length&&t.push(r),t}))):this.thru(s)}));var yo=Lr((function(t,e,i){Nt.call(t,i)?++t[i]:an(t,i,1)}));var _o=zr(Ws),xo=zr(qs);function Mo(t,e){return(Jo(t)?Ee:fn)(t,hs(e,3))}function bo(t,e){return(Jo(t)?Ce:mn)(t,hs(e,3))}var wo=Lr((function(t,e,i){Nt.call(t,i)?t[i].push(e):an(t,i,[e])}));var So=Qn((function(t,e,i){var r=-1,s="function"==typeof e,o=Yo(t)?n(t.length):[];return fn(t,(function(t){o[++r]=s?Te(e,t,i):Dn(t,e,i)})),o})),To=Lr((function(t,e,i){an(t,i,e)}));function Ao(t,e){return(Jo(t)?Le:kn)(t,hs(e,3))}var Eo=Lr((function(t,e,i){t[i?0:1].push(e)}),(function(){return[[],[]]}));var Co=Qn((function(t,e){if(null==t)return[];var i=e.length;return i>1&&Ms(t,e[0],e[1])?e=[]:i>2&&Ms(e[0],e[1],e[2])&&(e=[e[0]]),qn(t,_n(e,1),[])})),Oo=de||function(){return pe.Date.now()};function Po(t,e,i){return e=i?r:e,e=t&&null==e?t.length:e,$r(t,u,r,r,r,r,e)}function Io(t,e){var i;if("function"!=typeof e)throw new Pt(s);return t=va(t),function(){return--t>0&&(i=e.apply(this,arguments)),t<=1&&(e=r),i}}var Do=Qn((function(t,e,i){var n=1;if(i.length){var r=ci(i,cs(Do));n|=c}return $r(t,n,e,i,r)})),Lo=Qn((function(t,e,i){var n=3;if(i.length){var r=ci(i,cs(Lo));n|=c}return $r(e,n,t,i,r)}));function Ro(t,e,i){var n,o,a,l,c,h,u=0,d=!1,p=!1,f=!0;if("function"!=typeof t)throw new Pt(s);function m(e){var i=n,s=o;return n=o=r,u=e,l=t.apply(s,i)}function g(t){return u=t,c=Ls(y,e),d?m(t):l}function v(t){var i=t-h;return h===r||i>=e||i<0||p&&t-u>=a}function y(){var t=Oo();if(v(t))return _(t);c=Ls(y,function(t){var i=e-(t-h);return p?xi(i,a-(t-u)):i}(t))}function _(t){return c=r,f&&n?m(t):(n=o=r,l)}function x(){var t=Oo(),i=v(t);if(n=arguments,o=this,h=t,i){if(c===r)return g(h);if(p)return Sr(c),c=Ls(y,e),m(h)}return c===r&&(c=Ls(y,e)),l}return e=_a(e)||0,na(i)&&(d=!!i.leading,a=(p="maxWait"in i)?_i(_a(i.maxWait)||0,e):a,f="trailing"in i?!!i.trailing:f),x.cancel=function(){c!==r&&Sr(c),u=0,n=h=o=c=r},x.flush=function(){return c===r?l:_(Oo())},x}var Bo=Qn((function(t,e){return dn(t,1,e)})),No=Qn((function(t,e,i){return dn(t,_a(e)||0,i)}));function Fo(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new Pt(s);var i=function(){var n=arguments,r=e?e.apply(this,n):n[0],s=i.cache;if(s.has(r))return s.get(r);var o=t.apply(this,n);return i.cache=s.set(r,o)||s,o};return i.cache=new(Fo.Cache||Xi),i}function Uo(t){if("function"!=typeof t)throw new Pt(s);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}Fo.Cache=Xi;var Go=br((function(t,e){var i=(e=1==e.length&&Jo(e[0])?Le(e[0],Ke(hs())):Le(_n(e,1),Ke(hs()))).length;return Qn((function(n){for(var r=-1,s=xi(n.length,i);++r<s;)n[r]=e[r].call(this,n[r]);return Te(t,this,n)}))})),zo=Qn((function(t,e){var i=ci(e,cs(zo));return $r(t,c,r,e,i)})),ko=Qn((function(t,e){var i=ci(e,cs(ko));return $r(t,h,r,e,i)})),jo=rs((function(t,e){return $r(t,d,r,r,r,e)}));function Ho(t,e){return t===e||t!=t&&e!=e}var Vo=Xr(Cn),Wo=Xr((function(t,e){return t>=e})),qo=Ln(function(){return arguments}())?Ln:function(t){return ra(t)&&Nt.call(t,"callee")&&!Yt.call(t,"callee")},Jo=n.isArray,Xo=_e?Ke(_e):function(t){return ra(t)&&En(t)==R};function Yo(t){return null!=t&&ia(t.length)&&!ta(t)}function Zo(t){return ra(t)&&Yo(t)}var Ko=Ue||_l,Qo=xe?Ke(xe):function(t){return ra(t)&&En(t)==M};function $o(t){if(!ra(t))return!1;var e=En(t);return e==b||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!aa(t)}function ta(t){if(!na(t))return!1;var e=En(t);return e==w||e==S||"[object AsyncFunction]"==e||"[object Proxy]"==e}function ea(t){return"number"==typeof t&&t==va(t)}function ia(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=f}function na(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function ra(t){return null!=t&&"object"==typeof t}var sa=Me?Ke(Me):function(t){return ra(t)&&gs(t)==T};function oa(t){return"number"==typeof t||ra(t)&&En(t)==A}function aa(t){if(!ra(t)||En(t)!=E)return!1;var e=Jt(t);if(null===e)return!0;var i=Nt.call(e,"constructor")&&e.constructor;return"function"==typeof i&&i instanceof i&&Bt.call(i)==zt}var la=be?Ke(be):function(t){return ra(t)&&En(t)==O};var ca=we?Ke(we):function(t){return ra(t)&&gs(t)==P};function ha(t){return"string"==typeof t||!Jo(t)&&ra(t)&&En(t)==I}function ua(t){return"symbol"==typeof t||ra(t)&&En(t)==D}var da=Se?Ke(Se):function(t){return ra(t)&&ia(t.length)&&!!oe[En(t)]};var pa=Xr(zn),fa=Xr((function(t,e){return t<=e}));function ma(t){if(!t)return[];if(Yo(t))return ha(t)?pi(t):Ir(t);if(te&&t[te])return function(t){for(var e,i=[];!(e=t.next()).done;)i.push(e.value);return i}(t[te]());var e=gs(t);return(e==T?ai:e==P?hi:Ha)(t)}function ga(t){return t?(t=_a(t))===p||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}function va(t){var e=ga(t),i=e%1;return e==e?i?e-i:e:0}function ya(t){return t?cn(va(t),0,g):0}function _a(t){if("number"==typeof t)return t;if(ua(t))return m;if(na(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=na(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Ze(t);var i=vt.test(t);return i||_t.test(t)?he(t.slice(2),i?2:8):gt.test(t)?m:+t}function xa(t){return Dr(t,Ba(t))}function Ma(t){return null==t?"":ur(t)}var ba=Rr((function(t,e){if(Ts(e)||Yo(e))Dr(e,Ra(e),t);else for(var i in e)Nt.call(e,i)&&nn(t,i,e[i])})),wa=Rr((function(t,e){Dr(e,Ba(e),t)})),Sa=Rr((function(t,e,i,n){Dr(e,Ba(e),t,n)})),Ta=Rr((function(t,e,i,n){Dr(e,Ra(e),t,n)})),Aa=rs(ln);var Ea=Qn((function(t,e){t=Et(t);var i=-1,n=e.length,s=n>2?e[2]:r;for(s&&Ms(e[0],e[1],s)&&(n=1);++i<n;)for(var o=e[i],a=Ba(o),l=-1,c=a.length;++l<c;){var h=a[l],u=t[h];(u===r||Ho(u,Lt[h])&&!Nt.call(t,h))&&(t[h]=o[h])}return t})),Ca=Qn((function(t){return t.push(r,es),Te(Fa,r,t)}));function Oa(t,e,i){var n=null==t?r:Tn(t,e);return n===r?i:n}function Pa(t,e){return null!=t&&vs(t,e,Pn)}var Ia=Hr((function(t,e,i){null!=e&&"function"!=typeof e.toString&&(e=Gt.call(e)),t[e]=i}),nl(ol)),Da=Hr((function(t,e,i){null!=e&&"function"!=typeof e.toString&&(e=Gt.call(e)),Nt.call(t,e)?t[e].push(i):t[e]=[i]}),hs),La=Qn(Dn);function Ra(t){return Yo(t)?Ki(t):Un(t)}function Ba(t){return Yo(t)?Ki(t,!0):Gn(t)}var Na=Rr((function(t,e,i){Vn(t,e,i)})),Fa=Rr((function(t,e,i,n){Vn(t,e,i,n)})),Ua=rs((function(t,e){var i={};if(null==t)return i;var n=!1;e=Le(e,(function(e){return e=Mr(e,t),n||(n=e.length>1),e})),Dr(t,os(t),i),n&&(i=hn(i,7,is));for(var r=e.length;r--;)pr(i,e[r]);return i}));var Ga=rs((function(t,e){return null==t?{}:function(t,e){return Jn(t,e,(function(e,i){return Pa(t,i)}))}(t,e)}));function za(t,e){if(null==t)return{};var i=Le(os(t),(function(t){return[t]}));return e=hs(e),Jn(t,i,(function(t,i){return e(t,i[0])}))}var ka=Qr(Ra),ja=Qr(Ba);function Ha(t){return null==t?[]:Qe(t,Ra(t))}var Va=Ur((function(t,e,i){return e=e.toLowerCase(),t+(i?Wa(e):e)}));function Wa(t){return $a(Ma(t).toLowerCase())}function qa(t){return(t=Ma(t))&&t.replace(Mt,ni).replace($t,"")}var Ja=Ur((function(t,e,i){return t+(i?"-":"")+e.toLowerCase()})),Xa=Ur((function(t,e,i){return t+(i?" ":"")+e.toLowerCase()})),Ya=Fr("toLowerCase");var Za=Ur((function(t,e,i){return t+(i?"_":"")+e.toLowerCase()}));var Ka=Ur((function(t,e,i){return t+(i?" ":"")+$a(e)}));var Qa=Ur((function(t,e,i){return t+(i?" ":"")+e.toUpperCase()})),$a=Fr("toUpperCase");function tl(t,e,i){return t=Ma(t),(e=i?r:e)===r?function(t){return ne.test(t)}(t)?function(t){return t.match(ee)||[]}(t):function(t){return t.match(ut)||[]}(t):t.match(e)||[]}var el=Qn((function(t,e){try{return Te(t,r,e)}catch(t){return $o(t)?t:new St(t)}})),il=rs((function(t,e){return Ee(e,(function(e){e=Gs(e),an(t,e,Do(t[e],t))})),t}));function nl(t){return function(){return t}}var rl=kr(),sl=kr(!0);function ol(t){return t}function al(t){return Fn("function"==typeof t?t:hn(t,1))}var ll=Qn((function(t,e){return function(i){return Dn(i,t,e)}})),cl=Qn((function(t,e){return function(i){return Dn(t,i,e)}}));function hl(t,e,i){var n=Ra(e),r=Sn(e,n);null!=i||na(e)&&(r.length||!n.length)||(i=e,e=t,t=this,r=Sn(e,Ra(e)));var s=!(na(i)&&"chain"in i&&!i.chain),o=ta(t);return Ee(r,(function(i){var n=e[i];t[i]=n,o&&(t.prototype[i]=function(){var e=this.__chain__;if(s||e){var i=t(this.__wrapped__),r=i.__actions__=Ir(this.__actions__);return r.push({func:n,args:arguments,thisArg:t}),i.__chain__=e,i}return n.apply(t,Re([this.value()],arguments))})})),t}function ul(){}var dl=Wr(Le),pl=Wr(Oe),fl=Wr(Fe);function ml(t){return bs(t)?We(Gs(t)):function(t){return function(e){return Tn(e,t)}}(t)}var gl=Jr(),vl=Jr(!0);function yl(){return[]}function _l(){return!1}var xl=Vr((function(t,e){return t+e}),0),Ml=Zr("ceil"),bl=Vr((function(t,e){return t/e}),1),wl=Zr("floor");var Sl,Tl=Vr((function(t,e){return t*e}),1),Al=Zr("round"),El=Vr((function(t,e){return t-e}),0);return ki.after=function(t,e){if("function"!=typeof e)throw new Pt(s);return t=va(t),function(){if(--t<1)return e.apply(this,arguments)}},ki.ary=Po,ki.assign=ba,ki.assignIn=wa,ki.assignInWith=Sa,ki.assignWith=Ta,ki.at=Aa,ki.before=Io,ki.bind=Do,ki.bindAll=il,ki.bindKey=Lo,ki.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return Jo(t)?t:[t]},ki.chain=mo,ki.chunk=function(t,e,i){e=(i?Ms(t,e,i):e===r)?1:_i(va(e),0);var s=null==t?0:t.length;if(!s||e<1)return[];for(var o=0,a=0,l=n(me(s/e));o<s;)l[a++]=sr(t,o,o+=e);return l},ki.compact=function(t){for(var e=-1,i=null==t?0:t.length,n=0,r=[];++e<i;){var s=t[e];s&&(r[n++]=s)}return r},ki.concat=function(){var t=arguments.length;if(!t)return[];for(var e=n(t-1),i=arguments[0],r=t;r--;)e[r-1]=arguments[r];return Re(Jo(i)?Ir(i):[i],_n(e,1))},ki.cond=function(t){var e=null==t?0:t.length,i=hs();return t=e?Le(t,(function(t){if("function"!=typeof t[1])throw new Pt(s);return[i(t[0]),t[1]]})):[],Qn((function(i){for(var n=-1;++n<e;){var r=t[n];if(Te(r[0],this,i))return Te(r[1],this,i)}}))},ki.conforms=function(t){return function(t){var e=Ra(t);return function(i){return un(i,t,e)}}(hn(t,1))},ki.constant=nl,ki.countBy=yo,ki.create=function(t,e){var i=ji(t);return null==e?i:on(i,e)},ki.curry=function t(e,i,n){var s=$r(e,8,r,r,r,r,r,i=n?r:i);return s.placeholder=t.placeholder,s},ki.curryRight=function t(e,i,n){var s=$r(e,l,r,r,r,r,r,i=n?r:i);return s.placeholder=t.placeholder,s},ki.debounce=Ro,ki.defaults=Ea,ki.defaultsDeep=Ca,ki.defer=Bo,ki.delay=No,ki.difference=js,ki.differenceBy=Hs,ki.differenceWith=Vs,ki.drop=function(t,e,i){var n=null==t?0:t.length;return n?sr(t,(e=i||e===r?1:va(e))<0?0:e,n):[]},ki.dropRight=function(t,e,i){var n=null==t?0:t.length;return n?sr(t,0,(e=n-(e=i||e===r?1:va(e)))<0?0:e):[]},ki.dropRightWhile=function(t,e){return t&&t.length?mr(t,hs(e,3),!0,!0):[]},ki.dropWhile=function(t,e){return t&&t.length?mr(t,hs(e,3),!0):[]},ki.fill=function(t,e,i,n){var s=null==t?0:t.length;return s?(i&&"number"!=typeof i&&Ms(t,e,i)&&(i=0,n=s),function(t,e,i,n){var s=t.length;for((i=va(i))<0&&(i=-i>s?0:s+i),(n=n===r||n>s?s:va(n))<0&&(n+=s),n=i>n?0:ya(n);i<n;)t[i++]=e;return t}(t,e,i,n)):[]},ki.filter=function(t,e){return(Jo(t)?Pe:yn)(t,hs(e,3))},ki.flatMap=function(t,e){return _n(Ao(t,e),1)},ki.flatMapDeep=function(t,e){return _n(Ao(t,e),p)},ki.flatMapDepth=function(t,e,i){return i=i===r?1:va(i),_n(Ao(t,e),i)},ki.flatten=Js,ki.flattenDeep=function(t){return(null==t?0:t.length)?_n(t,p):[]},ki.flattenDepth=function(t,e){return(null==t?0:t.length)?_n(t,e=e===r?1:va(e)):[]},ki.flip=function(t){return $r(t,512)},ki.flow=rl,ki.flowRight=sl,ki.fromPairs=function(t){for(var e=-1,i=null==t?0:t.length,n={};++e<i;){var r=t[e];n[r[0]]=r[1]}return n},ki.functions=function(t){return null==t?[]:Sn(t,Ra(t))},ki.functionsIn=function(t){return null==t?[]:Sn(t,Ba(t))},ki.groupBy=wo,ki.initial=function(t){return(null==t?0:t.length)?sr(t,0,-1):[]},ki.intersection=Ys,ki.intersectionBy=Zs,ki.intersectionWith=Ks,ki.invert=Ia,ki.invertBy=Da,ki.invokeMap=So,ki.iteratee=al,ki.keyBy=To,ki.keys=Ra,ki.keysIn=Ba,ki.map=Ao,ki.mapKeys=function(t,e){var i={};return e=hs(e,3),bn(t,(function(t,n,r){an(i,e(t,n,r),t)})),i},ki.mapValues=function(t,e){var i={};return e=hs(e,3),bn(t,(function(t,n,r){an(i,n,e(t,n,r))})),i},ki.matches=function(t){return jn(hn(t,1))},ki.matchesProperty=function(t,e){return Hn(t,hn(e,1))},ki.memoize=Fo,ki.merge=Na,ki.mergeWith=Fa,ki.method=ll,ki.methodOf=cl,ki.mixin=hl,ki.negate=Uo,ki.nthArg=function(t){return t=va(t),Qn((function(e){return Wn(e,t)}))},ki.omit=Ua,ki.omitBy=function(t,e){return za(t,Uo(hs(e)))},ki.once=function(t){return Io(2,t)},ki.orderBy=function(t,e,i,n){return null==t?[]:(Jo(e)||(e=null==e?[]:[e]),Jo(i=n?r:i)||(i=null==i?[]:[i]),qn(t,e,i))},ki.over=dl,ki.overArgs=Go,ki.overEvery=pl,ki.overSome=fl,ki.partial=zo,ki.partialRight=ko,ki.partition=Eo,ki.pick=Ga,ki.pickBy=za,ki.property=ml,ki.propertyOf=function(t){return function(e){return null==t?r:Tn(t,e)}},ki.pull=$s,ki.pullAll=to,ki.pullAllBy=function(t,e,i){return t&&t.length&&e&&e.length?Xn(t,e,hs(i,2)):t},ki.pullAllWith=function(t,e,i){return t&&t.length&&e&&e.length?Xn(t,e,r,i):t},ki.pullAt=eo,ki.range=gl,ki.rangeRight=vl,ki.rearg=jo,ki.reject=function(t,e){return(Jo(t)?Pe:yn)(t,Uo(hs(e,3)))},ki.remove=function(t,e){var i=[];if(!t||!t.length)return i;var n=-1,r=[],s=t.length;for(e=hs(e,3);++n<s;){var o=t[n];e(o,n,t)&&(i.push(o),r.push(n))}return Yn(t,r),i},ki.rest=function(t,e){if("function"!=typeof t)throw new Pt(s);return Qn(t,e=e===r?e:va(e))},ki.reverse=io,ki.sampleSize=function(t,e,i){return e=(i?Ms(t,e,i):e===r)?1:va(e),(Jo(t)?$i:tr)(t,e)},ki.set=function(t,e,i){return null==t?t:er(t,e,i)},ki.setWith=function(t,e,i,n){return n="function"==typeof n?n:r,null==t?t:er(t,e,i,n)},ki.shuffle=function(t){return(Jo(t)?tn:rr)(t)},ki.slice=function(t,e,i){var n=null==t?0:t.length;return n?(i&&"number"!=typeof i&&Ms(t,e,i)?(e=0,i=n):(e=null==e?0:va(e),i=i===r?n:va(i)),sr(t,e,i)):[]},ki.sortBy=Co,ki.sortedUniq=function(t){return t&&t.length?cr(t):[]},ki.sortedUniqBy=function(t,e){return t&&t.length?cr(t,hs(e,2)):[]},ki.split=function(t,e,i){return i&&"number"!=typeof i&&Ms(t,e,i)&&(e=i=r),(i=i===r?g:i>>>0)?(t=Ma(t))&&("string"==typeof e||null!=e&&!la(e))&&!(e=ur(e))&&oi(t)?wr(pi(t),0,i):t.split(e,i):[]},ki.spread=function(t,e){if("function"!=typeof t)throw new Pt(s);return e=null==e?0:_i(va(e),0),Qn((function(i){var n=i[e],r=wr(i,0,e);return n&&Re(r,n),Te(t,this,r)}))},ki.tail=function(t){var e=null==t?0:t.length;return e?sr(t,1,e):[]},ki.take=function(t,e,i){return t&&t.length?sr(t,0,(e=i||e===r?1:va(e))<0?0:e):[]},ki.takeRight=function(t,e,i){var n=null==t?0:t.length;return n?sr(t,(e=n-(e=i||e===r?1:va(e)))<0?0:e,n):[]},ki.takeRightWhile=function(t,e){return t&&t.length?mr(t,hs(e,3),!1,!0):[]},ki.takeWhile=function(t,e){return t&&t.length?mr(t,hs(e,3)):[]},ki.tap=function(t,e){return e(t),t},ki.throttle=function(t,e,i){var n=!0,r=!0;if("function"!=typeof t)throw new Pt(s);return na(i)&&(n="leading"in i?!!i.leading:n,r="trailing"in i?!!i.trailing:r),Ro(t,e,{leading:n,maxWait:e,trailing:r})},ki.thru=go,ki.toArray=ma,ki.toPairs=ka,ki.toPairsIn=ja,ki.toPath=function(t){return Jo(t)?Le(t,Gs):ua(t)?[t]:Ir(Us(Ma(t)))},ki.toPlainObject=xa,ki.transform=function(t,e,i){var n=Jo(t),r=n||Ko(t)||da(t);if(e=hs(e,4),null==i){var s=t&&t.constructor;i=r?n?new s:[]:na(t)&&ta(s)?ji(Jt(t)):{}}return(r?Ee:bn)(t,(function(t,n,r){return e(i,t,n,r)})),i},ki.unary=function(t){return Po(t,1)},ki.union=no,ki.unionBy=ro,ki.unionWith=so,ki.uniq=function(t){return t&&t.length?dr(t):[]},ki.uniqBy=function(t,e){return t&&t.length?dr(t,hs(e,2)):[]},ki.uniqWith=function(t,e){return e="function"==typeof e?e:r,t&&t.length?dr(t,r,e):[]},ki.unset=function(t,e){return null==t||pr(t,e)},ki.unzip=oo,ki.unzipWith=ao,ki.update=function(t,e,i){return null==t?t:fr(t,e,xr(i))},ki.updateWith=function(t,e,i,n){return n="function"==typeof n?n:r,null==t?t:fr(t,e,xr(i),n)},ki.values=Ha,ki.valuesIn=function(t){return null==t?[]:Qe(t,Ba(t))},ki.without=lo,ki.words=tl,ki.wrap=function(t,e){return zo(xr(e),t)},ki.xor=co,ki.xorBy=ho,ki.xorWith=uo,ki.zip=po,ki.zipObject=function(t,e){return yr(t||[],e||[],nn)},ki.zipObjectDeep=function(t,e){return yr(t||[],e||[],er)},ki.zipWith=fo,ki.entries=ka,ki.entriesIn=ja,ki.extend=wa,ki.extendWith=Sa,hl(ki,ki),ki.add=xl,ki.attempt=el,ki.camelCase=Va,ki.capitalize=Wa,ki.ceil=Ml,ki.clamp=function(t,e,i){return i===r&&(i=e,e=r),i!==r&&(i=(i=_a(i))==i?i:0),e!==r&&(e=(e=_a(e))==e?e:0),cn(_a(t),e,i)},ki.clone=function(t){return hn(t,4)},ki.cloneDeep=function(t){return hn(t,5)},ki.cloneDeepWith=function(t,e){return hn(t,5,e="function"==typeof e?e:r)},ki.cloneWith=function(t,e){return hn(t,4,e="function"==typeof e?e:r)},ki.conformsTo=function(t,e){return null==e||un(t,e,Ra(e))},ki.deburr=qa,ki.defaultTo=function(t,e){return null==t||t!=t?e:t},ki.divide=bl,ki.endsWith=function(t,e,i){t=Ma(t),e=ur(e);var n=t.length,s=i=i===r?n:cn(va(i),0,n);return(i-=e.length)>=0&&t.slice(i,s)==e},ki.eq=Ho,ki.escape=function(t){return(t=Ma(t))&&K.test(t)?t.replace(Y,ri):t},ki.escapeRegExp=function(t){return(t=Ma(t))&&st.test(t)?t.replace(rt,"\\$&"):t},ki.every=function(t,e,i){var n=Jo(t)?Oe:gn;return i&&Ms(t,e,i)&&(e=r),n(t,hs(e,3))},ki.find=_o,ki.findIndex=Ws,ki.findKey=function(t,e){return Ge(t,hs(e,3),bn)},ki.findLast=xo,ki.findLastIndex=qs,ki.findLastKey=function(t,e){return Ge(t,hs(e,3),wn)},ki.floor=wl,ki.forEach=Mo,ki.forEachRight=bo,ki.forIn=function(t,e){return null==t?t:xn(t,hs(e,3),Ba)},ki.forInRight=function(t,e){return null==t?t:Mn(t,hs(e,3),Ba)},ki.forOwn=function(t,e){return t&&bn(t,hs(e,3))},ki.forOwnRight=function(t,e){return t&&wn(t,hs(e,3))},ki.get=Oa,ki.gt=Vo,ki.gte=Wo,ki.has=function(t,e){return null!=t&&vs(t,e,On)},ki.hasIn=Pa,ki.head=Xs,ki.identity=ol,ki.includes=function(t,e,i,n){t=Yo(t)?t:Ha(t),i=i&&!n?va(i):0;var r=t.length;return i<0&&(i=_i(r+i,0)),ha(t)?i<=r&&t.indexOf(e,i)>-1:!!r&&ke(t,e,i)>-1},ki.indexOf=function(t,e,i){var n=null==t?0:t.length;if(!n)return-1;var r=null==i?0:va(i);return r<0&&(r=_i(n+r,0)),ke(t,e,r)},ki.inRange=function(t,e,i){return e=ga(e),i===r?(i=e,e=0):i=ga(i),function(t,e,i){return t>=xi(e,i)&&t<_i(e,i)}(t=_a(t),e,i)},ki.invoke=La,ki.isArguments=qo,ki.isArray=Jo,ki.isArrayBuffer=Xo,ki.isArrayLike=Yo,ki.isArrayLikeObject=Zo,ki.isBoolean=function(t){return!0===t||!1===t||ra(t)&&En(t)==x},ki.isBuffer=Ko,ki.isDate=Qo,ki.isElement=function(t){return ra(t)&&1===t.nodeType&&!aa(t)},ki.isEmpty=function(t){if(null==t)return!0;if(Yo(t)&&(Jo(t)||"string"==typeof t||"function"==typeof t.splice||Ko(t)||da(t)||qo(t)))return!t.length;var e=gs(t);if(e==T||e==P)return!t.size;if(Ts(t))return!Un(t).length;for(var i in t)if(Nt.call(t,i))return!1;return!0},ki.isEqual=function(t,e){return Rn(t,e)},ki.isEqualWith=function(t,e,i){var n=(i="function"==typeof i?i:r)?i(t,e):r;return n===r?Rn(t,e,r,i):!!n},ki.isError=$o,ki.isFinite=function(t){return"number"==typeof t&&qe(t)},ki.isFunction=ta,ki.isInteger=ea,ki.isLength=ia,ki.isMap=sa,ki.isMatch=function(t,e){return t===e||Bn(t,e,ds(e))},ki.isMatchWith=function(t,e,i){return i="function"==typeof i?i:r,Bn(t,e,ds(e),i)},ki.isNaN=function(t){return oa(t)&&t!=+t},ki.isNative=function(t){if(Ss(t))throw new St("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Nn(t)},ki.isNil=function(t){return null==t},ki.isNull=function(t){return null===t},ki.isNumber=oa,ki.isObject=na,ki.isObjectLike=ra,ki.isPlainObject=aa,ki.isRegExp=la,ki.isSafeInteger=function(t){return ea(t)&&t>=-9007199254740991&&t<=f},ki.isSet=ca,ki.isString=ha,ki.isSymbol=ua,ki.isTypedArray=da,ki.isUndefined=function(t){return t===r},ki.isWeakMap=function(t){return ra(t)&&gs(t)==L},ki.isWeakSet=function(t){return ra(t)&&"[object WeakSet]"==En(t)},ki.join=function(t,e){return null==t?"":vi.call(t,e)},ki.kebabCase=Ja,ki.last=Qs,ki.lastIndexOf=function(t,e,i){var n=null==t?0:t.length;if(!n)return-1;var s=n;return i!==r&&(s=(s=va(i))<0?_i(n+s,0):xi(s,n-1)),e==e?function(t,e,i){for(var n=i+1;n--;)if(t[n]===e)return n;return n}(t,e,s):ze(t,He,s,!0)},ki.lowerCase=Xa,ki.lowerFirst=Ya,ki.lt=pa,ki.lte=fa,ki.max=function(t){return t&&t.length?vn(t,ol,Cn):r},ki.maxBy=function(t,e){return t&&t.length?vn(t,hs(e,2),Cn):r},ki.mean=function(t){return Ve(t,ol)},ki.meanBy=function(t,e){return Ve(t,hs(e,2))},ki.min=function(t){return t&&t.length?vn(t,ol,zn):r},ki.minBy=function(t,e){return t&&t.length?vn(t,hs(e,2),zn):r},ki.stubArray=yl,ki.stubFalse=_l,ki.stubObject=function(){return{}},ki.stubString=function(){return""},ki.stubTrue=function(){return!0},ki.multiply=Tl,ki.nth=function(t,e){return t&&t.length?Wn(t,va(e)):r},ki.noConflict=function(){return pe._===this&&(pe._=kt),this},ki.noop=ul,ki.now=Oo,ki.pad=function(t,e,i){t=Ma(t);var n=(e=va(e))?di(t):0;if(!e||n>=e)return t;var r=(e-n)/2;return qr(ve(r),i)+t+qr(me(r),i)},ki.padEnd=function(t,e,i){t=Ma(t);var n=(e=va(e))?di(t):0;return e&&n<e?t+qr(e-n,i):t},ki.padStart=function(t,e,i){t=Ma(t);var n=(e=va(e))?di(t):0;return e&&n<e?qr(e-n,i)+t:t},ki.parseInt=function(t,e,i){return i||null==e?e=0:e&&(e=+e),bi(Ma(t).replace(ot,""),e||0)},ki.random=function(t,e,i){if(i&&"boolean"!=typeof i&&Ms(t,e,i)&&(e=i=r),i===r&&("boolean"==typeof e?(i=e,e=r):"boolean"==typeof t&&(i=t,t=r)),t===r&&e===r?(t=0,e=1):(t=ga(t),e===r?(e=t,t=0):e=ga(e)),t>e){var n=t;t=e,e=n}if(i||t%1||e%1){var s=wi();return xi(t+s*(e-t+ce("1e-"+((s+"").length-1))),e)}return Zn(t,e)},ki.reduce=function(t,e,i){var n=Jo(t)?Be:Je,r=arguments.length<3;return n(t,hs(e,4),i,r,fn)},ki.reduceRight=function(t,e,i){var n=Jo(t)?Ne:Je,r=arguments.length<3;return n(t,hs(e,4),i,r,mn)},ki.repeat=function(t,e,i){return e=(i?Ms(t,e,i):e===r)?1:va(e),Kn(Ma(t),e)},ki.replace=function(){var t=arguments,e=Ma(t[0]);return t.length<3?e:e.replace(t[1],t[2])},ki.result=function(t,e,i){var n=-1,s=(e=Mr(e,t)).length;for(s||(s=1,t=r);++n<s;){var o=null==t?r:t[Gs(e[n])];o===r&&(n=s,o=i),t=ta(o)?o.call(t):o}return t},ki.round=Al,ki.runInContext=t,ki.sample=function(t){return(Jo(t)?Qi:$n)(t)},ki.size=function(t){if(null==t)return 0;if(Yo(t))return ha(t)?di(t):t.length;var e=gs(t);return e==T||e==P?t.size:Un(t).length},ki.snakeCase=Za,ki.some=function(t,e,i){var n=Jo(t)?Fe:or;return i&&Ms(t,e,i)&&(e=r),n(t,hs(e,3))},ki.sortedIndex=function(t,e){return ar(t,e)},ki.sortedIndexBy=function(t,e,i){return lr(t,e,hs(i,2))},ki.sortedIndexOf=function(t,e){var i=null==t?0:t.length;if(i){var n=ar(t,e);if(n<i&&Ho(t[n],e))return n}return-1},ki.sortedLastIndex=function(t,e){return ar(t,e,!0)},ki.sortedLastIndexBy=function(t,e,i){return lr(t,e,hs(i,2),!0)},ki.sortedLastIndexOf=function(t,e){if(null==t?0:t.length){var i=ar(t,e,!0)-1;if(Ho(t[i],e))return i}return-1},ki.startCase=Ka,ki.startsWith=function(t,e,i){return t=Ma(t),i=null==i?0:cn(va(i),0,t.length),e=ur(e),t.slice(i,i+e.length)==e},ki.subtract=El,ki.sum=function(t){return t&&t.length?Xe(t,ol):0},ki.sumBy=function(t,e){return t&&t.length?Xe(t,hs(e,2)):0},ki.template=function(t,e,i){var n=ki.templateSettings;i&&Ms(t,e,i)&&(e=r),t=Ma(t),e=Sa({},e,n,ts);var s,o,a=Sa({},e.imports,n.imports,ts),l=Ra(a),c=Qe(a,l),h=0,u=e.interpolate||bt,d="__p += '",p=Ct((e.escape||bt).source+"|"+u.source+"|"+(u===tt?ft:bt).source+"|"+(e.evaluate||bt).source+"|$","g"),f="//# sourceURL="+(Nt.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++se+"]")+"\n";t.replace(p,(function(e,i,n,r,a,l){return n||(n=r),d+=t.slice(h,l).replace(wt,si),i&&(s=!0,d+="' +\n__e("+i+") +\n'"),a&&(o=!0,d+="';\n"+a+";\n__p += '"),n&&(d+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),h=l+e.length,e})),d+="';\n";var m=Nt.call(e,"variable")&&e.variable;if(m){if(dt.test(m))throw new St("Invalid `variable` option passed into `_.template`")}else d="with (obj) {\n"+d+"\n}\n";d=(o?d.replace(W,""):d).replace(q,"$1").replace(J,"$1;"),d="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(s?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var g=el((function(){return Tt(l,f+"return "+d).apply(r,c)}));if(g.source=d,$o(g))throw g;return g},ki.times=function(t,e){if((t=va(t))<1||t>f)return[];var i=g,n=xi(t,g);e=hs(e),t-=g;for(var r=Ye(n,e);++i<t;)e(i);return r},ki.toFinite=ga,ki.toInteger=va,ki.toLength=ya,ki.toLower=function(t){return Ma(t).toLowerCase()},ki.toNumber=_a,ki.toSafeInteger=function(t){return t?cn(va(t),-9007199254740991,f):0===t?t:0},ki.toString=Ma,ki.toUpper=function(t){return Ma(t).toUpperCase()},ki.trim=function(t,e,i){if((t=Ma(t))&&(i||e===r))return Ze(t);if(!t||!(e=ur(e)))return t;var n=pi(t),s=pi(e);return wr(n,ti(n,s),ei(n,s)+1).join("")},ki.trimEnd=function(t,e,i){if((t=Ma(t))&&(i||e===r))return t.slice(0,fi(t)+1);if(!t||!(e=ur(e)))return t;var n=pi(t);return wr(n,0,ei(n,pi(e))+1).join("")},ki.trimStart=function(t,e,i){if((t=Ma(t))&&(i||e===r))return t.replace(ot,"");if(!t||!(e=ur(e)))return t;var n=pi(t);return wr(n,ti(n,pi(e))).join("")},ki.truncate=function(t,e){var i=30,n="...";if(na(e)){var s="separator"in e?e.separator:s;i="length"in e?va(e.length):i,n="omission"in e?ur(e.omission):n}var o=(t=Ma(t)).length;if(oi(t)){var a=pi(t);o=a.length}if(i>=o)return t;var l=i-di(n);if(l<1)return n;var c=a?wr(a,0,l).join(""):t.slice(0,l);if(s===r)return c+n;if(a&&(l+=c.length-l),la(s)){if(t.slice(l).search(s)){var h,u=c;for(s.global||(s=Ct(s.source,Ma(mt.exec(s))+"g")),s.lastIndex=0;h=s.exec(u);)var d=h.index;c=c.slice(0,d===r?l:d)}}else if(t.indexOf(ur(s),l)!=l){var p=c.lastIndexOf(s);p>-1&&(c=c.slice(0,p))}return c+n},ki.unescape=function(t){return(t=Ma(t))&&Z.test(t)?t.replace(X,mi):t},ki.uniqueId=function(t){var e=++Ft;return Ma(t)+e},ki.upperCase=Qa,ki.upperFirst=$a,ki.each=Mo,ki.eachRight=bo,ki.first=Xs,hl(ki,(Sl={},bn(ki,(function(t,e){Nt.call(ki.prototype,e)||(Sl[e]=t)})),Sl),{chain:!1}),ki.VERSION="4.17.21",Ee(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(t){ki[t].placeholder=ki})),Ee(["drop","take"],(function(t,e){Wi.prototype[t]=function(i){i=i===r?1:_i(va(i),0);var n=this.__filtered__&&!e?new Wi(this):this.clone();return n.__filtered__?n.__takeCount__=xi(i,n.__takeCount__):n.__views__.push({size:xi(i,g),type:t+(n.__dir__<0?"Right":"")}),n},Wi.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}})),Ee(["filter","map","takeWhile"],(function(t,e){var i=e+1,n=1==i||3==i;Wi.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:hs(t,3),type:i}),e.__filtered__=e.__filtered__||n,e}})),Ee(["head","last"],(function(t,e){var i="take"+(e?"Right":"");Wi.prototype[t]=function(){return this[i](1).value()[0]}})),Ee(["initial","tail"],(function(t,e){var i="drop"+(e?"":"Right");Wi.prototype[t]=function(){return this.__filtered__?new Wi(this):this[i](1)}})),Wi.prototype.compact=function(){return this.filter(ol)},Wi.prototype.find=function(t){return this.filter(t).head()},Wi.prototype.findLast=function(t){return this.reverse().find(t)},Wi.prototype.invokeMap=Qn((function(t,e){return"function"==typeof t?new Wi(this):this.map((function(i){return Dn(i,t,e)}))})),Wi.prototype.reject=function(t){return this.filter(Uo(hs(t)))},Wi.prototype.slice=function(t,e){t=va(t);var i=this;return i.__filtered__&&(t>0||e<0)?new Wi(i):(t<0?i=i.takeRight(-t):t&&(i=i.drop(t)),e!==r&&(i=(e=va(e))<0?i.dropRight(-e):i.take(e-t)),i)},Wi.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},Wi.prototype.toArray=function(){return this.take(g)},bn(Wi.prototype,(function(t,e){var i=/^(?:filter|find|map|reject)|While$/.test(e),n=/^(?:head|last)$/.test(e),s=ki[n?"take"+("last"==e?"Right":""):e],o=n||/^find/.test(e);s&&(ki.prototype[e]=function(){var e=this.__wrapped__,a=n?[1]:arguments,l=e instanceof Wi,c=a[0],h=l||Jo(e),u=function(t){var e=s.apply(ki,Re([t],a));return n&&d?e[0]:e};h&&i&&"function"==typeof c&&1!=c.length&&(l=h=!1);var d=this.__chain__,p=!!this.__actions__.length,f=o&&!d,m=l&&!p;if(!o&&h){e=m?e:new Wi(this);var g=t.apply(e,a);return g.__actions__.push({func:go,args:[u],thisArg:r}),new Vi(g,d)}return f&&m?t.apply(this,a):(g=this.thru(u),f?n?g.value()[0]:g.value():g)})})),Ee(["pop","push","shift","sort","splice","unshift"],(function(t){var e=It[t],i=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",n=/^(?:pop|shift)$/.test(t);ki.prototype[t]=function(){var t=arguments;if(n&&!this.__chain__){var r=this.value();return e.apply(Jo(r)?r:[],t)}return this[i]((function(i){return e.apply(Jo(i)?i:[],t)}))}})),bn(Wi.prototype,(function(t,e){var i=ki[e];if(i){var n=i.name+"";Nt.call(Di,n)||(Di[n]=[]),Di[n].push({name:e,func:i})}})),Di[jr(r,2).name]=[{name:"wrapper",func:r}],Wi.prototype.clone=function(){var t=new Wi(this.__wrapped__);return t.__actions__=Ir(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=Ir(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=Ir(this.__views__),t},Wi.prototype.reverse=function(){if(this.__filtered__){var t=new Wi(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},Wi.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,i=Jo(t),n=e<0,r=i?t.length:0,s=function(t,e,i){var n=-1,r=i.length;for(;++n<r;){var s=i[n],o=s.size;switch(s.type){case"drop":t+=o;break;case"dropRight":e-=o;break;case"take":e=xi(e,t+o);break;case"takeRight":t=_i(t,e-o)}}return{start:t,end:e}}(0,r,this.__views__),o=s.start,a=s.end,l=a-o,c=n?a:o-1,h=this.__iteratees__,u=h.length,d=0,p=xi(l,this.__takeCount__);if(!i||!n&&r==l&&p==l)return gr(t,this.__actions__);var f=[];t:for(;l--&&d<p;){for(var m=-1,g=t[c+=e];++m<u;){var v=h[m],y=v.iteratee,_=v.type,x=y(g);if(2==_)g=x;else if(!x){if(1==_)continue t;break t}}f[d++]=g}return f},ki.prototype.at=vo,ki.prototype.chain=function(){return mo(this)},ki.prototype.commit=function(){return new Vi(this.value(),this.__chain__)},ki.prototype.next=function(){this.__values__===r&&(this.__values__=ma(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?r:this.__values__[this.__index__++]}},ki.prototype.plant=function(t){for(var e,i=this;i instanceof Hi;){var n=ks(i);n.__index__=0,n.__values__=r,e?s.__wrapped__=n:e=n;var s=n;i=i.__wrapped__}return s.__wrapped__=t,e},ki.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof Wi){var e=t;return this.__actions__.length&&(e=new Wi(this)),(e=e.reverse()).__actions__.push({func:go,args:[io],thisArg:r}),new Vi(e,this.__chain__)}return this.thru(io)},ki.prototype.toJSON=ki.prototype.valueOf=ki.prototype.value=function(){return gr(this.__wrapped__,this.__actions__)},ki.prototype.first=ki.prototype.head,te&&(ki.prototype[te]=function(){return this}),ki}();pe._=gi,(n=function(){return gi}.call(e,i,e,t))===r||(t.exports=n)}.call(this)},1494:(t,e)=>{"use strict";function i(t,e,i,n){for(var r=t[e++],s=1<<r,o=s+1,a=o+1,l=r+1,c=(1<<l)-1,h=0,u=0,d=0,p=t[e++],f=new Int32Array(4096),m=null;;){for(;h<16&&0!==p;)u|=t[e++]<<h,h+=8,1===p?p=t[e++]:--p;if(h<l)break;var g=u&c;if(u>>=l,h-=l,g!==s){if(g===o)break;for(var v=g<a?g:m,y=0,_=v;_>s;)_=f[_]>>8,++y;var x=_;if(d+y+(v!==g?1:0)>n)return;i[d++]=x;var M=d+=y;for(v!==g&&(i[d++]=x),_=v;y--;)_=f[_],i[--M]=255&_,_>>=8;null!==m&&a<4096&&(f[a++]=m<<8|x,a>=c+1&&l<12&&(++l,c=c<<1|1)),m=g}else a=o+1,c=(1<<(l=r+1))-1,m=null}return i}try{(function(t,e,i,n){var r=0,s=void 0===(n=void 0===n?{}:n).loop?null:n.loop,o=void 0===n.palette?null:n.palette;if(e<=0||i<=0||e>65535||i>65535)throw new Error("Width/Height invalid.");function a(t){var e=t.length;if(e<2||e>256||e&e-1)throw new Error("Invalid code/color length, must be power of 2 and 2 .. 256.");return e}t[r++]=71,t[r++]=73,t[r++]=70,t[r++]=56,t[r++]=57,t[r++]=97;var l=0,c=0;if(null!==o){for(var h=a(o);h>>=1;)++l;if(h=1<<l,--l,void 0!==n.background){if((c=n.background)>=h)throw new Error("Background index out of range.");if(0===c)throw new Error("Background index explicitly passed as 0.")}}if(t[r++]=255&e,t[r++]=e>>8&255,t[r++]=255&i,t[r++]=i>>8&255,t[r++]=(null!==o?128:0)|l,t[r++]=c,t[r++]=0,null!==o)for(var u=0,d=o.length;u<d;++u){var p=o[u];t[r++]=p>>16&255,t[r++]=p>>8&255,t[r++]=255&p}if(null!==s){if(s<0||s>65535)throw new Error("Loop count invalid.");t[r++]=33,t[r++]=255,t[r++]=11,t[r++]=78,t[r++]=69,t[r++]=84,t[r++]=83,t[r++]=67,t[r++]=65,t[r++]=80,t[r++]=69,t[r++]=50,t[r++]=46,t[r++]=48,t[r++]=3,t[r++]=1,t[r++]=255&s,t[r++]=s>>8&255,t[r++]=0}var f=!1;this.addFrame=function(e,i,n,s,l,c){if(!0===f&&(--r,f=!1),c=void 0===c?{}:c,e<0||i<0||e>65535||i>65535)throw new Error("x/y invalid.");if(n<=0||s<=0||n>65535||s>65535)throw new Error("Width/Height invalid.");if(l.length<n*s)throw new Error("Not enough pixels for the frame size.");var h=!0,u=c.palette;if(null==u&&(h=!1,u=o),null==u)throw new Error("Must supply either a local or global palette.");for(var d=a(u),p=0;d>>=1;)++p;d=1<<p;var m=void 0===c.delay?0:c.delay,g=void 0===c.disposal?0:c.disposal;if(g<0||g>3)throw new Error("Disposal out of range.");var v=!1,y=0;if(void 0!==c.transparent&&null!==c.transparent&&(v=!0,(y=c.transparent)<0||y>=d))throw new Error("Transparent color index.");if((0!==g||v||0!==m)&&(t[r++]=33,t[r++]=249,t[r++]=4,t[r++]=g<<2|(!0===v?1:0),t[r++]=255&m,t[r++]=m>>8&255,t[r++]=y,t[r++]=0),t[r++]=44,t[r++]=255&e,t[r++]=e>>8&255,t[r++]=255&i,t[r++]=i>>8&255,t[r++]=255&n,t[r++]=n>>8&255,t[r++]=255&s,t[r++]=s>>8&255,t[r++]=!0===h?128|p-1:0,!0===h)for(var _=0,x=u.length;_<x;++_){var M=u[_];t[r++]=M>>16&255,t[r++]=M>>8&255,t[r++]=255&M}return r=function(t,e,i,n){t[e++]=i;var r=e++,s=1<<i,o=s-1,a=s+1,l=a+1,c=i+1,h=0,u=0;function d(i){for(;h>=i;)t[e++]=255&u,u>>=8,h-=8,e===r+256&&(t[r]=255,r=e++)}function p(t){u|=t<<h,h+=c,d(8)}var f=n[0]&o,m={};p(s);for(var g=1,v=n.length;g<v;++g){var y=n[g]&o,_=f<<8|y,x=m[_];if(void 0===x){for(u|=f<<h,h+=c;h>=8;)t[e++]=255&u,u>>=8,h-=8,e===r+256&&(t[r]=255,r=e++);4096===l?(p(s),l=a+1,c=i+1,m={}):(l>=1<<c&&++c,m[_]=l++),f=y}else f=x}return p(f),p(a),d(1),r+1===e?t[r]=0:(t[r]=e-r-1,t[e++]=0),e}(t,r,p<2?2:p,l),r},this.end=function(){return!1===f&&(t[r++]=59,f=!0),r},this.getOutputBuffer=function(){return t},this.setOutputBuffer=function(e){t=e},this.getOutputBufferPosition=function(){return r},this.setOutputBufferPosition=function(t){r=t}}),e.N=function(t){var e=0;if(71!==t[e++]||73!==t[e++]||70!==t[e++]||56!==t[e++]||56!=(t[e++]+1&253)||97!==t[e++])throw new Error("Invalid GIF 87a/89a header.");var n=t[e++]|t[e++]<<8,r=t[e++]|t[e++]<<8,s=t[e++],o=s>>7,a=1<<1+(7&s);t[e++],t[e++];var l=null,c=null;o&&(l=e,c=a,e+=3*a);var h=!0,u=[],d=0,p=null,f=0,m=null;for(this.width=n,this.height=r;h&&e<t.length;)switch(t[e++]){case 33:switch(t[e++]){case 255:if(11!==t[e]||78==t[e+1]&&69==t[e+2]&&84==t[e+3]&&83==t[e+4]&&67==t[e+5]&&65==t[e+6]&&80==t[e+7]&&69==t[e+8]&&50==t[e+9]&&46==t[e+10]&&48==t[e+11]&&3==t[e+12]&&1==t[e+13]&&0==t[e+16])e+=14,m=t[e++]|t[e++]<<8,e++;else for(e+=12;;){if(!((C=t[e++])>=0))throw Error("Invalid block size");if(0===C)break;e+=C}break;case 249:if(4!==t[e++]||0!==t[e+4])throw new Error("Invalid graphics extension block.");var g=t[e++];d=t[e++]|t[e++]<<8,p=t[e++],0==(1&g)&&(p=null),f=g>>2&7,e++;break;case 254:for(;;){if(!((C=t[e++])>=0))throw Error("Invalid block size");if(0===C)break;e+=C}break;default:throw new Error("Unknown graphic control label: 0x"+t[e-1].toString(16))}break;case 44:var v=t[e++]|t[e++]<<8,y=t[e++]|t[e++]<<8,_=t[e++]|t[e++]<<8,x=t[e++]|t[e++]<<8,M=t[e++],b=M>>6&1,w=1<<1+(7&M),S=l,T=c,A=!1;M>>7&&(A=!0,S=e,T=w,e+=3*w);var E=e;for(e++;;){var C;if(!((C=t[e++])>=0))throw Error("Invalid block size");if(0===C)break;e+=C}u.push({x:v,y,width:_,height:x,has_local_palette:A,palette_offset:S,palette_size:T,data_offset:E,data_length:e-E,transparent_index:p,interlaced:!!b,delay:d,disposal:f});break;case 59:h=!1;break;default:throw new Error("Unknown gif block: 0x"+t[e-1].toString(16))}this.numFrames=function(){return u.length},this.loopCount=function(){return m},this.frameInfo=function(t){if(t<0||t>=u.length)throw new Error("Frame index out of range.");return u[t]},this.decodeAndBlitFrameBGRA=function(e,r){var s=this.frameInfo(e),o=s.width*s.height,a=new Uint8Array(o);i(t,s.data_offset,a,o);var l=s.palette_offset,c=s.transparent_index;null===c&&(c=256);var h=s.width,u=n-h,d=h,p=4*(s.y*n+s.x),f=4*((s.y+s.height)*n+s.x),m=p,g=4*u;!0===s.interlaced&&(g+=4*n*7);for(var v=8,y=0,_=a.length;y<_;++y){var x=a[y];if(0===d&&(d=h,(m+=g)>=f&&(g=4*u+4*n*(v-1),m=p+(h+u)*(v<<1),v>>=1)),x===c)m+=4;else{var M=t[l+3*x],b=t[l+3*x+1],w=t[l+3*x+2];r[m++]=w,r[m++]=b,r[m++]=M,r[m++]=255}--d}},this.decodeAndBlitFrameRGBA=function(e,r){var s=this.frameInfo(e),o=s.width*s.height,a=new Uint8Array(o);i(t,s.data_offset,a,o);var l=s.palette_offset,c=s.transparent_index;null===c&&(c=256);var h=s.width,u=n-h,d=h,p=4*(s.y*n+s.x),f=4*((s.y+s.height)*n+s.x),m=p,g=4*u;!0===s.interlaced&&(g+=4*n*7);for(var v=8,y=0,_=a.length;y<_;++y){var x=a[y];if(0===d&&(d=h,(m+=g)>=f&&(g=4*u+4*n*(v-1),m=p+(h+u)*(v<<1),v>>=1)),x===c)m+=4;else{var M=t[l+3*x],b=t[l+3*x+1],w=t[l+3*x+2];r[m++]=M,r[m++]=b,r[m++]=w,r[m++]=255}--d}}}}catch(t){}},9718:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DabeeoMap=void 0;const n=i(4807),r=i(6794),s=i(8474),o=i(3715),a=i(368),l=i(423),c=i(6386),h=i(777),u=i(3312),d=i(3575),p=i(7451),f=i(6627);e.DabeeoMap=class{constructor(t,e){this.mapId=t,this.dabeemapsManager=new n.DabeeoMapsManager(e),this.markers=new o.Markers(this.dabeemapsManager),this.objects=new s.Objects(this.dabeemapsManager),this.control=new r.Control(this.dabeemapsManager),this.mylocation=new a.Mylocation(this.dabeemapsManager),this.routeSimulation=new l.RouteSimulation(this.dabeemapsManager),this.context=new c.MapContext(this.dabeemapsManager),this.tag=new h.Tag(this.dabeemapsManager),this.pois=new u.Pois(this.dabeemapsManager),this.overlay=new d.Overlay(this.dabeemapsManager),this.testModel=new p.TestModel(this.dabeemapsManager),this.recon=new f.Recon(this.dabeemapsManager)}async showMap(t,e,i){await this.dabeemapsManager.showMap(t,e,i)}}},9720:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DabeeoMapData=void 0;const n=i(861),r=i(7194),s=i(7310),o=i(2624),a=i(606),l=i(8900),c=i(2082),h=i(304),u=i(838);e.DabeeoMapData=class{constructor(t){this.networkClient=new c.NetworkClient(t),this.floorData=new u.FloorData(this.networkClient),this.dataMapInfo=new h.DataMapInfo(this.networkClient),this.dataGroupCode=new n.DataGroupCode(this.networkClient),this.dataPoi=new s.DataPoi(this.networkClient),this.dataObject=new r.DataObject(this.floorData),this.dataFloor=new a.DataFloor,this.dataNode=new o.DataNode(this.dataPoi,this.dataFloor),this.dataLanguage=new l.DataLanguage}async getFloorData(t){return this.floorData.getFloorData(t)}async init(){await this.dataMapInfo.init(),this.dataFloor.init(this.dataMapInfo),this.dataLanguage.init(this.dataMapInfo),await Promise.all([this.dataPoi.init(),this.dataGroupCode.init()])}async getRoute(t,e){const{origin:i,destination:n}=t,r=t.waypoints?t.waypoints:[];return this.isValidRouteOption(i,e)&&this.isValidRouteOption(n,e)&&r.every((t=>this.isValidRouteOption(t,e)))?await this.dataNode.getRoute(t,this.networkClient,null==e?void 0:e.networkClient):{}}async getCategoryDistance(t,e){return this.dataNode.getCategoryDistance(t,e,this.networkClient)}isValidRouteOption(t,e){return!t.poiId||this.dataPoi.find({id:t.poiId})||(null==e?void 0:e.dataPoi.find({id:t.poiId}))?!(!this.dataFloor.find({id:t.floorId})&&!(null==e?void 0:e.dataFloor.find({id:t.floorId})))||(console.error(`요청한 길찾기 데이터 층 ${t.floorId} 정보가 존재하지 않습니다.`),!1):(console.error(`요청한 길찾기 포인트 ${t.poiId} 정보가 존재하지 않습니다.`),!1)}}},13:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DabeeoMaps=void 0;const n=i(9718),r=i(9720);e.DabeeoMaps=class{constructor(){this.dabeeomapObject=new Map}async getMapData(t){const e=new r.DabeeoMapData(t);return await e.init(),e}async showMap(t,e,i){const r=i.dataMapInfo.getId(),s=new n.DabeeoMap(r,i.dataMapInfo);return this.dabeeomapObject.set(r,s),await s.showMap(t,e,i),s}}},6163:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_ICON_URLS=void 0,e.DEFAULT_ICON_URLS={origin:"https://assets.dabeeomaps.com/image/ico/img_start-3x.png",destination:"https://assets.dabeeomaps.com/image/ico/img_end-3x.png",wayPoint:"https://assets.dabeeomaps.com/image/poi/waypoint_g.png",poweredBy01:"https://assets.dabeeomaps.com/upload/library/assets/powered_dabeeo01.png",poweredBy02:"https://assets.dabeeomaps.com/upload/library/assets/powered_dabeeo02.png",pointTexture:"https://assets.dabeeomaps.com/upload/library/assets/disc.png",myLocation:"https://assets.dabeeomaps.com/image/ico/img_mylocation.png",marker:"https://assets.dabeeomaps.com/image/ico/img_marker-3x.png",myLocationAnimateTexture:"https://assets.dabeeomaps.com/image/ico/alpha.jpg",naviSimulation:"https://assets.dabeeomaps.com/image/ico/img_person-3x.png"}},3198:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.defaultConstMarkerIcon=void 0;const n=i(6163);e.defaultConstMarkerIcon={iconUrl:n.DEFAULT_ICON_URLS.marker,width:30,height:40,positionZ:0,visibleIcon:!0,anchor:{x:.5,y:0}}},9843:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.defaultConstMyLocInfo=e.defaultConstMyLocAnimate=void 0,e.defaultConstMyLocAnimate={opacity:.8,color:"#96c4e1",desireScale:3,duration:1e3},e.defaultConstMyLocInfo={floorId:"",location:{x:0,y:0,z:1},isActive:!1,marker:void 0,gpsOption:{leftCourseDistance:25,willArriveRadius:50,arrivedRadius:25}}},5123:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.defaultNaviAnimOption=e.DEFAULT_TWO_FLOORS_NAVIGATION_DEST=e.DEFAULT_TWO_FLOORS_NAVIGATION_ORIGIN=e.DEFAULT_TWO_FLOORS_NAVIGATION_DURATION=e.DEFAULT_FLOOR_MOTION_DURATION=e.defaultNaviOptions=void 0;const n=i(9377);e.defaultNaviOptions={lineZ:2,lineDivide:!1,defaultLineOption:{lineColor:"#0060b4",lineSpotSize:5,lineSpotInterval:30,lineSpotAnimate:!1,lineSpotAnimateSpeed:.02,solidLineEnabled:!1,solidLineWidth:20,solidLineJoin:n.SOLID_LINE_JOIN_TYPE.MITER,solidLineCap:n.SOLID_LINE_CAP_TYPE.BUTT},destination:{showTag:!0}},e.DEFAULT_FLOOR_MOTION_DURATION=3e3,e.DEFAULT_TWO_FLOORS_NAVIGATION_DURATION=6e3,e.DEFAULT_TWO_FLOORS_NAVIGATION_ORIGIN="top: 0; left: 0; opacity: 0; position: absolute;",e.DEFAULT_TWO_FLOORS_NAVIGATION_DEST="bottom: 0; right: 0; opacity: 0; position: absolute;",e.defaultNaviAnimOption={enableTwoFloorsNavigation:!1,twoFloorsNavigationDuration:e.DEFAULT_TWO_FLOORS_NAVIGATION_DURATION,twoFloorsNavigationOriginCss:e.DEFAULT_TWO_FLOORS_NAVIGATION_ORIGIN,twoFloorsNavigationDestCss:e.DEFAULT_TWO_FLOORS_NAVIGATION_DEST,enableFloorMotionCSS:!1,floorMotionDuration:e.DEFAULT_FLOOR_MOTION_DURATION,speedRate:10,removeIcon:!0}},2626:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EVENT_TYPE=void 0,function(t){t.OBJECT_CLICK="object-click",t.POI_CLICK="poi-click",t.POI_MOUSE_OVER="poi-mouse-over",t.POI_MOUSE_ENTER="poi-mouse-enter",t.POI_MOUSE_LEAVE="poi-mouse-leave",t.VOID_CLICK="void-click",t.MARKER_CLICK="marker-click",t.FLOOR_CHANGED="floor-changed",t.FLOOR_CHANGING="floor-changing",t.FLOOR_CHANGE_ANIMATION_END="floor-change-animation-end",t.NAVI_COMPLETE="navi-complete",t.RENDER_COMPLETE="render-complete",t.ZOOM_POSSIBLE="zoom-possible",t.ZOOM_CHANGED="zoom-changed",t.TILT_CHANGED="tilt-changed",t.ROTATION_CHANGED="rotation-changed",t.CONTROL_START="control-start",t.CONTROL_END="control-end",t.ZOOM_END="zoom-end",t.ON_MOUSE_CLICK="on-mouse-click",t.ON_MOUSE_MOVE="on-mouse-move",t.OBJECT_MOUSE_OVER="object-mouse-over",t.OBEJECT_MOUSE_ENTER="object-mouse-enter",t.OBJECT_MOUSE_LEAVE="object-mouse-leave",t.DRAG_START="drag-start",t.DRAG_MOVE="drag-move",t.DRAG_END="drag-end",t.TRACKING_COMPLETE="tracking-complete",t.TRACKING_MOVE="tracking-move",t.MYLOCATION_MAP_OUT="mylocation-map-out",t.MYLOCATION_MAP_IN="mylocation-map-in",t.MODEL_LOAD_COMPLETE="model-load-complete"}(e.EVENT_TYPE||(e.EVENT_TYPE={}))},3551:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.mapDefaultOptions=void 0;const n=i(9570);e.mapDefaultOptions={floor:"default",theme:"default",camera:n.CAMERA_TYPE.D3,controlOption:{zoom:void 0,rotate:0,tilt:0,pan:{x:void 0,y:void 0,z:void 0}},language:n.LANG_TYPE.KO,showPoi:!0,spriteEnable:!0,spriteKeepRotation:!1,enablePoiCollisionTest:!0,mergeMesh:!1,showWaterMarker:!0,waterMarkPosition:n.WATERMARK_TYPE.LEFT_BOTTOM,enableTiling:!1,tilingOption:{treeDepth:6,thresholdLevel:3},enableSleepMode:!1,sleepModeOption:{sleepModeTimeout:1e4,mergedMesh:{object:!0}},framerate:24,backgroundImage:"",svgFormatOptions:{url:"",depth:50,drawFillShapes:!0,drawStrokes:!0,fillShapesWireframe:!1,strokesWireframe:!1},dragDistance:20,poiTextPadding:{vertical:0,horizontal:0}}},1236:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NETWORK_URL=void 0,e.NETWORK_URL={STAGE:{MAP:"https://ims-api-stage3.dabeeomaps.com/v2/map-info?t=JS",OAUTH:"https://ims-oauth-stage3.dabeeomaps.com/oauth/token",POI:"https://ims-api-stage3.dabeeomaps.com/v2/poi",FLOOR:"https://ims-api-stage3.dabeeomaps.com/v2/floors?t=JS&",DISTANCE:"https://ims-api-stage3.dabeeomaps.com/v2/navigation/get-distance?t=JS&",NAVI:"https://ims-api-stage3.dabeeomaps.com/v2/navigation/find-path?t=JS&",GROUP:"https://ims-api-stage3.dabeeomaps.com/v2/layer-group?t=JS",VERSION:"https://ims-api-stage3.dabeeomaps.com/v2/check/latest-version"},PRODUCTION:{MAP:"https://api.dabeeomaps.com/v2/map-info?t=JS",OAUTH:"https://oauth.dabeeomaps.com/oauth/token",POI:"https://api.dabeeomaps.com/v2/poi",FLOOR:"https://api.dabeeomaps.com/v2/floors?t=JS&",DISTANCE:"https://ims-api-stage3.dabeeomaps.com/v2/navigation/get-distance?t=JS&",NAVI:"https://ims-api-stage3.dabeeomaps.com/v2/navigation/find-path?t=JS&",GROUP:"https://api.dabeeomaps.com/v2/layer-group?t=JS",VERSION:"https://api.dabeeomaps.com/v2/check/latest-version"}}},3100:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.Map3DReconGroup=void 0;const o=s(i(5232)),a=i(3306),l=i(2676);class c extends l.Group{constructor(t,e){super("3DReconModelGroup"),this.model=null,this.runtime=null,this.clock=new o.Clock,this.rendererClass=t,this.cameraController=e}async load3DRecon(t,e){try{const i=await a.Loader3DTiles.load({url:t,renderer:this.rendererClass.getRenderer(),options:{dracoDecoderPath:"three/examples/js/libs/draco",basisTranscoderPath:"three/examples/js/libs/basis",shading:a.Shading.FlatTexture,maximumScreenSpaceError:32}}),{model:n,runtime:r}=i;this.model=n,this.runtime=r,this.add(this.model),this.transform3DRecon(e)}catch(t){console.error("3D Recon Model 을 가져오지 못했습니다.")}}update3DRecon(){var t,e;null===(t=this.runtime)||void 0===t||t.update(this.clock.getDelta(),this.rendererClass.getRenderer(),this.cameraController.getCamera()),null===(e=this.model)||void 0===e||e.traverse((t=>{var e,i;if("Mesh"===t.type){const{material:n}=t;if(!Array.isArray(n)&&"MeshBasicMaterial"===n.type){const r=new o.MeshStandardMaterial({emissiveMap:null===(e=n.map)||void 0===e?void 0:e.clone(),emissive:new o.Color(1.25,1.25,1.25),color:new o.Color(.1,.1,.1)});null===(i=n.map)||void 0===i||i.dispose(),n.dispose(),t.material=r}}}))}transform3DRecon(t){this.model&&(this.model.scale.set(t.scale.x,t.scale.y,t.scale.z),this.model.rotateX(o.MathUtils.degToRad(t.rotate.x)),this.model.rotateY(o.MathUtils.degToRad(t.rotate.y)),this.model.rotateZ(o.MathUtils.degToRad(t.rotate.z)),this.model.translateX(t.translate.x),this.model.translateZ(t.translate.y),this.model.translateY(t.translate.z))}}e.Map3DReconGroup=c},4807:function(t,e,i){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.DabeeoMapsManager=void 0;const r=i(6486),s=i(5232),o=n(i(7651)),a=i(3462),l=i(3720),c=n(i(1938)),h=n(i(5380)),u=i(1342),d=i(2972),p=i(3149),f=i(1722),m=i(1858),g=i(9851),v=i(1179),y=i(3551),_=i(7167),x=n(i(1288)),M=i(7449),b=i(4319),w=i(6202),S=i(9083),T=i(5289);e.DabeeoMapsManager=class{constructor(t){this.mapInfo=t,this.mapOptions=(0,r.cloneDeep)(y.mapDefaultOptions),this.scene=null,this.container=null,this.painter=null,this.eventDispatcher=null,this.markerManager=null,this.myLocationManager=null,this.routeSimulationManager=null,this.geoJsonManager=null,this.overlayManager=null,this.testModelDataManager=null,this.textureManager=new f.TextureManager(t),this.quadTileManager=null,this.dabeeoMapData=null,this.captureManager=null,this.floorManager=null,this.svgLoaderManager=null}async showMap(t,e,i){var n,r,s;t.clientHeight||(t.style.width="100%",t.style.height="100%"),this.mapInfo=i.dataMapInfo,this.dabeeoMapData=i,this.setMapOptions(e),(null===(n=e.svgFormatOptions)||void 0===n?void 0:n.url)||(e.floor?i.dataFloor.find({id:e.floor})?this.mapOptions.floor=e.floor:(console.error(`요청하신 ${e.floor}는 존재하지 않는 층입니다. 지도의 default층으로 이동합니다`),this.mapOptions.floor=this.mapInfo.getDefaultFloorId()):this.mapOptions.floor=this.mapInfo.getDefaultFloorId()),await i.getFloorData(this.mapOptions.floor),e.language?i.dataLanguage.find(e.language)?this.mapOptions.language=e.language:(console.error(`요청하신 ${e.language}는 지도에서 제공하지 않는 언어입니다. 지도의 default 언어로 제공합니다`),this.mapOptions.language=this.dabeeoMapData.dataLanguage.getDefaultLanguage().lang):this.mapOptions.language=this.dabeeoMapData.dataLanguage.getDefaultLanguage().lang,this.dabeeoMapData.dataMapInfo.setFloors(i?[...i.floorData.getConvertFloorDataAll()]:[]),this.preprocessing=new a.Preprocessing(this.getMapInfo(),this.mapOptions),await this.textureManager.loadTextureArray(this.getMapInfo());const f=this.preprocessing.getDefaultFloor();if(this.container=t,!this.dabeeoMapData.dataFloor)return;this.store=new c.default(this.preprocessing.getSvgObjectList(),this.preprocessing.getStyleList(),this.mapOptions,this.preprocessing.getData(),f,this.dabeeoMapData.dataFloor.getFloors(),this.preprocessing.getMaxObjectVolume(),this.preprocessing.getMaxObjectVolume(),t),this.eventDispatcher=new h.default(this.store.getContainer()),this.cameraController=new l.CameraController(this.store.getMapOptions().camera.toUpperCase(),this.store,this.eventDispatcher,this.preprocessing),this.myLocationManager=new d.MyLocationManager(this.store),this.routeSimulationManager=new p.RouteSimulationManager(this.store,this.cameraController,this.eventDispatcher,this.dabeeoMapData),this.geoJsonManager=new v.GeoJsonManager(this.preprocessing),this.overlayManager=new m.OverlayManager(this.store,this.geoJsonManager),this.testModelDataManager=new g.TestModelDataManager,this.quadTileManager=new _.QuadTileManager(this.cameraController,this.preprocessing,this.store,this.getMapInfo()),this.captureManager=new b.CaptureManager(this.store,this.cameraController),this.floorManager=new M.FloorManager(this.store,this.preprocessing,this.cameraController,this.dabeeoMapData,this.mapOptions,this.myLocationManager,this.routeSimulationManager,this.textureManager),this.indoorMapsManager=new S.IndoorMapsManager(this.store,this.preprocessing,this.textureManager),this.markerManager=new u.MarkerManager(this.store,this.preprocessing,this.indoorMapsManager),this.svgLoaderManager=new T.SvgLoaderManager(this.store,this.preprocessing,this.textureManager),(null===(r=e.svgFormatOptions)||void 0===r?void 0:r.url)&&await this.showSvgMap(e.svgFormatOptions);const y={store:this.store,preprocessing:this.preprocessing,cameraController:this.cameraController,eventDispatcher:this.eventDispatcher,textureManager:this.textureManager,markerManager:this.markerManager,myLocationManager:this.myLocationManager,routeSimulationManager:this.routeSimulationManager,overlayManager:this.overlayManager,quadTileManager:this.quadTileManager,floorManager:this.floorManager,indoorMapsManager:this.indoorMapsManager,svgLoaderManager:this.svgLoaderManager};this.painter=new o.default(y),this.scene=this.painter.getScene(),this.captureManager.setPainter(this.painter),this.captureManager.setScene(this.scene),await this.painter.init(),this.eventManager=new x.default(this.store,this.painter,this.scene,this.preprocessing,this.cameraController,this.eventDispatcher),null===(s=this.eventManager)||void 0===s||s.setCanvasEvent(),this.painter.setResizeObserver(t),this.painter.update()}getCurrentMapId(){var t;return null===(t=this.store)||void 0===t?void 0:t.getCurMapId()}changeCurrentMap(t){var e;null===(e=this.store)||void 0===e||e.setCurMapId(t)}removeIndoorMap(t){var e;null===(e=this.painter)||void 0===e||e.removeIndoorMap(t)}async addIndoorMap(t){var e;await(null===(e=this.painter)||void 0===e?void 0:e.addIndoorMap(t))}async changeIndoorMapFloor(t,e){var i;await(null===(i=this.painter)||void 0===i?void 0:i.changeIndoorMapFloor(t,e))}getContainer(){return this.container}getMapInfo(){return this.mapInfo}getMapOptions(){return this.mapOptions}setMapOptions(t){var e,i;(null===(e=null==t?void 0:t.sleepModeOption)||void 0===e?void 0:e.sleepModeTimeout)&&(null===(i=null==t?void 0:t.sleepModeOption)||void 0===i?void 0:i.sleepModeTimeout)<5e3&&(t.sleepModeOption.sleepModeTimeout=5e3,console.error("sleepModeTimeout은 최소 5000 이상이어야 합니다..")),this.mapOptions=this.deepMergeOption(this.mapOptions,t)}changeMapLanguage(t){this.mapOptions=this.deepMergeOption(this.mapOptions,{language:t})}async setMarker(t){var e,i,n;const s=(0,r.cloneDeep)(t);s.marker.forEach((t=>{var e,i;const n=w.DabeeoUtils.changeVectorMinus({x:t.x,y:t.y,z:(null===(e=t.iconOption)||void 0===e?void 0:e.positionZ)?null===(i=t.iconOption)||void 0===i?void 0:i.positionZ:0});t.x=n.x,t.y=n.y})),null===(e=this.markerManager)||void 0===e||e.setMarkerOptions(s);const o=await(null===(n=null===(i=this.painter)||void 0===i?void 0:i.getMapMarkerGroup())||void 0===n?void 0:n.setMarker(s));return null==o?void 0:o.map((t=>null==t?void 0:t.userData.id))}removeMarker(t){var e,i,n,r,s;Array.isArray(t)?t.forEach((t=>{var e,i,n,r,s;null===(i=null===(e=this.painter)||void 0===e?void 0:e.getMapTagListGroup())||void 0===i||i.removeToParent(t),null===(n=this.markerManager)||void 0===n||n.removeMarkerOption(t),null===(s=null===(r=this.painter)||void 0===r?void 0:r.getMapMarkerGroup())||void 0===s||s.removeMarker(t)})):(null===(i=null===(e=this.painter)||void 0===e?void 0:e.getMapTagListGroup())||void 0===i||i.removeToParent(t),null===(n=this.markerManager)||void 0===n||n.removeMarkerOption(t),null===(s=null===(r=this.painter)||void 0===r?void 0:r.getMapMarkerGroup())||void 0===s||s.removeMarker(t))}clearMarker(){var t,e,i;null===(t=this.markerManager)||void 0===t||t.markerOptions.forEach((t=>{var e,i;t.id&&(null===(i=null===(e=this.painter)||void 0===e?void 0:e.getMapTagListGroup())||void 0===i||i.removeToParent(t.id))})),null===(e=this.markerManager)||void 0===e||e.clearMarkerOptions(),null===(i=this.painter.getMapMarkerGroup())||void 0===i||i.clearMarker()}getCameraType(){return this.cameraController.getCameraType()}async changeCamera(t){var e,i;await(null===(e=this.cameraController)||void 0===e?void 0:e.changeCamera(t,!1)),null===(i=this.store)||void 0===i||i.setRenderDirty(!0)}changeZoom(t){var e;return null===(e=this.cameraController)||void 0===e?void 0:e.zoomControl(t)}zoomIn(t){var e;return null===(e=this.cameraController)||void 0===e?void 0:e.zoomIn(t)}getCurrentZoomLevel(){return this.cameraController.getCurrentZoomLevel()}zoomOut(t){var e;return null===(e=this.cameraController)||void 0===e?void 0:e.zoomOut(t)}cameraReset(t){var e;null===(e=this.cameraController)||void 0===e||e.cameraReset(t)}cameraMoveTo(t){var e;return null===(e=this.cameraController)||void 0===e?void 0:e.cameraMoveTo(t)}cameraSet(t){var e;return null===(e=this.cameraController)||void 0===e?void 0:e.cameraSet(t)}focusTo(t){var e;return null===(e=this.cameraController)||void 0===e?void 0:e.cameraFocusTo(t)}setOption(t){var e;return null===(e=this.cameraController)||void 0===e?void 0:e.setOption(t)}async myLocationOn(t){var e,i,n,r,s;null===(e=this.myLocationManager)||void 0===e||e.setMyLocationInfo(t);const o=null===(i=this.myLocationManager)||void 0===i?void 0:i.getMyLocationInfo();return(null==o?void 0:o.marker)&&(await(null===(r=null===(n=this.painter)||void 0===n?void 0:n.getMapMyLocGroup())||void 0===r?void 0:r.drawMyLocationMarker(o.marker,o.location)),null===(s=this.store)||void 0===s||s.setRenderDirty(!0)),t}myLocationSetPosition(t){var e,i,n,r,s;null===(e=this.myLocationManager)||void 0===e||e.setPosition(t);const o=null===(i=this.myLocationManager)||void 0===i?void 0:i.getMyLocationInfo();(null==o?void 0:o.marker)&&(null===(r=null===(n=this.painter)||void 0===n?void 0:n.getMapMyLocGroup())||void 0===r||r.setPositionMyLocationMarker(o.location),null===(s=this.store)||void 0===s||s.setRenderDirty(!0))}myLocationMovePosition(t){var e,i,n,r;null===(e=this.myLocationManager)||void 0===e||e.setPosition(t);const s=null===(i=this.myLocationManager)||void 0===i?void 0:i.getMyLocationInfo();(null==s?void 0:s.marker)&&(null===(r=null===(n=this.painter)||void 0===n?void 0:n.getMapMyLocGroup())||void 0===r||r.movePositionMyLocationMarker(s.location))}myLocationSetRotation(t){var e,i,n,r;const s=null===(e=this.myLocationManager)||void 0===e?void 0:e.getMyLocationInfo();(null==s?void 0:s.marker)&&(null===(n=null===(i=this.painter)||void 0===i?void 0:i.getMapMyLocGroup())||void 0===n||n.setRocationMyLocationMarker(t),null===(r=this.store)||void 0===r||r.setRenderDirty(!0))}myLocationOff(){var t,e;null===(t=this.myLocationManager)||void 0===t||t.clearMyLocationInfo(),null===(e=this.painter.getMapMyLocGroup())||void 0===e||e.myLocationOff()}myLocationStart(){var t,e;null===(e=null===(t=this.painter)||void 0===t?void 0:t.getMapMyLocGroup())||void 0===e||e.setGeolocation()}myLocationStop(){var t,e;null===(e=null===(t=this.painter)||void 0===t?void 0:t.getMapMyLocGroup())||void 0===e||e.stopGeolocation()}myLocationGetCurrentPosition(){var t,e;return null===(e=null===(t=this.painter)||void 0===t?void 0:t.getMapMyLocGroup())||void 0===e?void 0:e.getCurrentPosition()}myLocationTrackingOn(t){var e,i;null===(i=null===(e=this.painter)||void 0===e?void 0:e.getMapMyLocGroup())||void 0===i||i.setGPSTrackingOn(t)}myLocationTrackingOff(){var t,e;null===(e=null===(t=this.painter)||void 0===t?void 0:t.getMapMyLocGroup())||void 0===e||e.setGPSTrackingOff()}myLocationShow(){var t,e;null===(e=null===(t=this.painter)||void 0===t?void 0:t.getMapMyLocGroup())||void 0===e||e.showMyLocation()}myLocationHide(){var t,e;null===(e=null===(t=this.painter)||void 0===t?void 0:t.getMapMyLocGroup())||void 0===e||e.hideMyLocation()}myLocationGifAnimationOn(){var t,e,i,n,r;(null===(e=null===(t=this.painter)||void 0===t?void 0:t.getMapMyLocGroup())||void 0===e?void 0:e.getIsUsingGifTexture())&&(null===(i=this.store)||void 0===i||i.setRenderGifAnimation(!0)),null===(r=null===(n=this.painter)||void 0===n?void 0:n.getMapMyLocGroup())||void 0===r||r.gifTextureOn()}myLocationGifAnimationOff(){var t,e,i;null===(t=this.store)||void 0===t||t.setRenderGifAnimation(!1),null===(i=null===(e=this.painter)||void 0===e?void 0:e.getMapMyLocGroup())||void 0===i||i.gifTextureOff()}async getRouteOn(t,e){var i,n,r,s,o,a,l,c,h,u;let d;if(t)return this.routeSimulationManager&&((null===(i=this.store)||void 0===i?void 0:i.getIsDefaultMapNow())||(await(null===(n=this.painter)||void 0===n?void 0:n.resetIndoorMapToOriginFloor(t.originFloorId)),null===(r=this.preprocessing)||void 0===r||r.convertIndoorMapNaviResponse(null===(s=this.indoorMapsManager)||void 0===s?void 0:s.getIndoorMapDataOption(this.store.getCurMapId()),t)),this.routeSimulationManager.getIsNavigationMode()&&this.getRouteOff(),d=this.routeSimulationManager.getRouteOn(t,e),(null===(o=this.store)||void 0===o?void 0:o.getIsDefaultMapNow())&&await(null===(a=this.painter)||void 0===a?void 0:a.resetDefaultMapToOriginFloor()),null===(c=null===(l=this.painter)||void 0===l?void 0:l.getMapRouteSimulationGroup())||void 0===c||c.draw(),this.routeSimulationManager.shouldShowDestinationTag()&&(null===(u=null===(h=this.painter)||void 0===h?void 0:h.getMapTagListGroup())||void 0===u||u.drawDestinationTag(this.routeSimulationManager.getDestPoiId()))),d;console.error("경로에 정보가 없어서 지도에 모의주행 경로를 그릴 수 없습니다")}cleanup(){var t;null===(t=this.painter)||void 0===t||t.cleanup()}getRouteOff(){var t,e,i,n,r,s,o,a,l,c,h,u,d;!1!==(null===(t=this.routeSimulationManager)||void 0===t?void 0:t.getIsNavigationMode())?(null===(e=this.routeSimulationManager)||void 0===e||e.getRouteOff(),null===(n=null===(i=this.painter)||void 0===i?void 0:i.getMapRouteSimulationGroup())||void 0===n||n.removeCourse(),null===(s=null===(r=this.painter)||void 0===r?void 0:r.getMapRouteSimulationGroup())||void 0===s||s.removeParticle(),null===(o=this.painter)||void 0===o||o.setSleepMode(!1),(null===(a=this.routeSimulationManager)||void 0===a?void 0:a.destFloorId)===(null===(c=null===(l=this.store)||void 0===l?void 0:l.getDefaultFloor())||void 0===c?void 0:c.id)&&this.resetObject(null===(h=this.routeSimulationManager)||void 0===h?void 0:h.destPoiId),null===(d=null===(u=this.painter)||void 0===u?void 0:u.getMapTagListGroup())||void 0===d||d.removeToParent(this.routeSimulationManager.destPoiId)):console.error("제거할 모의주행 경로가 존재하지 않습니다.")}async startRouteAnimation(t=null){var e,i,n,r,o,a,l,c,h,u,d,p,f,m,g,v,y,_,x,M;if(null===(e=this.routeSimulationManager)||void 0===e?void 0:e.getIsNaviAnimation())return void console.error("이미 모의주행 애니메이션을 실행중입니다.");if(!(null===(i=this.routeSimulationManager)||void 0===i?void 0:i.getIsNavigationMode()))return void console.error("모의주행 경로가 없습니다.");if((null===(n=this.store)||void 0===n?void 0:n.getIsDefaultMapNow())?(null===(r=this.painter)||void 0===r||r.setSleepMode(!0),await(null===(o=this.floorManager)||void 0===o?void 0:o.getRouteFloorData()),await(null===(a=this.painter)||void 0===a?void 0:a.resetDefaultMapToOriginFloor())):((null===(l=this.routeSimulationManager)||void 0===l?void 0:l.response)&&await(null===(c=this.indoorMapsManager)||void 0===c?void 0:c.getIndoorMapRouteFloorData(this.routeSimulationManager.response)),await(null===(h=this.painter)||void 0===h?void 0:h.resetIndoorMapToOriginFloor(this.routeSimulationManager.originFloorId))),(null==t?void 0:t.zoom)&&(null===(u=this.cameraController)||void 0===u||u.zoomControl({zoom:t.zoom})),null===(d=this.routeSimulationManager)||void 0===d?void 0:d.response){const{locations:t}=this.routeSimulationManager.response;if(t&&t.length>0&&(null===(p=t[0])||void 0===p?void 0:p.position)){const{x:e,y:i}=t[0].position,n=null===(f=this.painter)||void 0===f?void 0:f.getMapRouteSimulationGroup(),r=new s.Group;null==n||n.add(r),r.position.x=e,r.position.y=i,r.position.z=0;const o=new s.Vector3;r.getWorldPosition(o),null===(m=this.cameraController)||void 0===m||m.moveTo(o.x||0,0,o.z||0,!1),null==n||n.remove(r)}}null===(g=this.routeSimulationManager)||void 0===g||g.captureFloorImage(),(null==t?void 0:t.floorMotionDuration)&&await new Promise((t=>{var e;setTimeout(t,null===(e=this.routeSimulationManager)||void 0===e?void 0:e.getNaviStartDelay())}));const b=null===(v=this.routeSimulationManager)||void 0===v?void 0:v.startRouteAnimation(t);return null===(_=null===(y=this.painter)||void 0===y?void 0:y.getMapRouteSimulationGroup())||void 0===_||_.removeParticle(),null===(M=null===(x=this.painter)||void 0===x?void 0:x.getMapRouteSimulationGroup())||void 0===M||M.draw(),b}stopRouteAnimation(){var t,e,i,n,r;!1!==(null===(t=this.routeSimulationManager)||void 0===t?void 0:t.getIsNaviAnimation())?(null===(e=this.routeSimulationManager)||void 0===e||e.stopRouteAnimation(),(null===(i=this.routeSimulationManager)||void 0===i?void 0:i.naviAnimOption.removeIcon)&&(null===(r=null===(n=this.painter)||void 0===n?void 0:n.getMapRouteSimulationGroup())||void 0===r||r.draw())):console.error("현재 모의주행 애니메이션을 실행하지 않고 있습니다.")}async changeFloor(t){var e,i,n;await(null===(e=this.floorManager)||void 0===e?void 0:e.changeFloor(t)),!1===(null===(i=this.floorManager)||void 0===i?void 0:i.shouldAnimateFloorChange())&&await(null===(n=this.painter)||void 0===n?void 0:n.drawNewFloor())}async changeLanguage(t){var e,i,n,r,s;(null===(e=this.dabeeoMapData)||void 0===e?void 0:e.dataLanguage.find(t))?(this.changeMapLanguage(t),(null===(i=this.store)||void 0===i?void 0:i.getDefaultFloor())&&(null===(n=this.store)||void 0===n||n.updateMapViewModel(this.store.getSvgObjectList(),this.preprocessing.getStyleList(),this.mapOptions,this.preprocessing.getData(),this.store.getDefaultFloor(),null===(s=null===(r=this.dabeeoMapData)||void 0===r?void 0:r.dataFloor)||void 0===s?void 0:s.getFloors(),this.preprocessing.getMaxObjectVolume(),this.preprocessing.getMaxSectionVolume()),this.clearAll("poi"),await this.setAll("poi"))):console.error(`요청하신 언어 ${t}는 지도에서 제공하지 않는 언어입니다`)}show(t,e){var i,n,r,s,o,a;null===(i=this.painter)||void 0===i||i.setSleepMode(!1),"poi"===e&&(null===(r=null===(n=this.painter)||void 0===n?void 0:n.getMapPoiGroup())||void 0===r||r.showPoi(t)),"obj"===e&&(null===(o=null===(s=this.painter)||void 0===s?void 0:s.getMapObjectGroup())||void 0===o||o.showObject(t)),null===(a=this.store)||void 0===a||a.setRenderDirty(!0)}hide(t,e){var i,n,r,s,o,a;null===(i=this.painter)||void 0===i||i.setSleepMode(!1),"poi"===e&&(null===(r=null===(n=this.painter)||void 0===n?void 0:n.getMapPoiGroup())||void 0===r||r.hidePoi(t)),"obj"===e&&(null===(o=null===(s=this.painter)||void 0===s?void 0:s.getMapObjectGroup())||void 0===o||o.hideObject(t)),null===(a=this.store)||void 0===a||a.setRenderDirty(!0)}showAll(t){var e,i,n,r,s,o;null===(e=this.painter)||void 0===e||e.setSleepMode(!1),"poi"===t&&(null===(n=null===(i=this.painter)||void 0===i?void 0:i.getMapPoiGroup())||void 0===n||n.showAllPoi()),"obj"===t&&(null===(s=null===(r=this.painter)||void 0===r?void 0:r.getMapObjectGroup())||void 0===s||s.showAllObject()),null===(o=this.store)||void 0===o||o.setRenderDirty(!0)}hideAll(t){var e,i,n,r,s,o;null===(e=this.painter)||void 0===e||e.setSleepMode(!1),"poi"===t&&(null===(n=null===(i=this.painter)||void 0===i?void 0:i.getMapPoiGroup())||void 0===n||n.hideAllPoi()),"obj"===t&&(null===(s=null===(r=this.painter)||void 0===r?void 0:r.getMapObjectGroup())||void 0===s||s.hideAllObject()),null===(o=this.store)||void 0===o||o.setRenderDirty(!0)}getCurrentPois(t){var e,i;return null===(i=null===(e=this.painter)||void 0===e?void 0:e.getMapPoiGroup())||void 0===i?void 0:i.getCurrentPois(t)}updatePoi(t){var e,i,n;const r=null===(i=null===(e=this.painter)||void 0===e?void 0:e.getMapPoiGroup())||void 0===i?void 0:i.updatePoi(t);return null===(n=this.store)||void 0===n||n.setRenderDirty(!0),r}async resetPoi(t){var e,i,n;null===(i=null===(e=this.painter)||void 0===e?void 0:e.getMapPoiGroup())||void 0===i||i.resetPoi(t),null===(n=this.store)||void 0===n||n.setRenderDirty(!0)}async setAll(t){var e,i,n;"poi"===t&&(null===(e=this.painter)||void 0===e||e.initPois()),"obj"===t&&await(null===(i=this.painter)||void 0===i?void 0:i.initObjects()),null===(n=this.store)||void 0===n||n.setRenderDirty(!0)}clearAll(t){var e,i,n,r,s;"poi"===t&&(null===(i=null===(e=this.painter)||void 0===e?void 0:e.getMapPoiGroup())||void 0===i||i.poiGroup.children.forEach((t=>{var e,i;t.userData.id&&(null===(i=null===(e=this.painter)||void 0===e?void 0:e.getMapTagListGroup())||void 0===i||i.removeToParent(t.userData.id))})),null===(n=this.painter)||void 0===n||n.clearAllPoi()),"obj"===t&&(null===(r=this.painter)||void 0===r||r.clearAllObject()),null===(s=this.store)||void 0===s||s.setRenderDirty(!0)}addTag(t){var e,i;return null===(i=null===(e=this.painter)||void 0===e?void 0:e.getMapTagListGroup())||void 0===i?void 0:i.addTag(t)}addItemTag(t){var e,i,n,r,s,o;let a=null;return a="POI"===t.type?null===(i=null===(e=this.painter)||void 0===e?void 0:e.getMapPoiGroup())||void 0===i?void 0:i.poiGroup.children.find((e=>e.userData.id===t.parentId)):null===(r=null===(n=this.painter)||void 0===n?void 0:n.getMapMarkerGroup())||void 0===r?void 0:r.children[0].children.find((e=>e.userData.id===t.parentId)),null===(o=null===(s=this.painter)||void 0===s?void 0:s.getMapTagListGroup())||void 0===o?void 0:o.addItemTag(a,t)}findTag(t){var e,i;return null===(i=null===(e=this.painter)||void 0===e?void 0:e.getMapTagListGroup())||void 0===i?void 0:i.findTag(t)}removeTag(t){var e,i;null===(i=null===(e=this.painter)||void 0===e?void 0:e.getMapTagListGroup())||void 0===i||i.removeTag(t)}removeAllTag(){var t,e;null===(e=null===(t=this.painter)||void 0===t?void 0:t.getMapTagListGroup())||void 0===e||e.removeAllTag()}updateObject(t){var e,i,n;return null===(e=this.painter)||void 0===e||e.setSleepMode(!1),null===(n=null===(i=this.painter)||void 0===i?void 0:i.getMapObjectGroup())||void 0===n?void 0:n.updateObjectStateByIds(t)}resetObject(t){var e,i,n;null===(e=this.painter)||void 0===e||e.setSleepMode(!1),null===(n=null===(i=this.painter)||void 0===i?void 0:i.getMapObjectGroup())||void 0===n||n.reset(t)}showByCode(t){var e,i,n,r,s,o,a,l;const c=null===(e=this.dabeeoMapData)||void 0===e?void 0:e.dataGroupCode.findAllChild(t);null===(i=this.painter)||void 0===i||i.setSleepMode(!1),null===(r=null===(n=this.painter)||void 0===n?void 0:n.getMapObjectGroup())||void 0===r||r.showObjectByCode(t,c),null===(o=null===(s=this.painter)||void 0===s?void 0:s.getMapPoiGroup())||void 0===o||o.showPoiByCode(t,c),null===(a=this.store)||void 0===a||a.setRenderDirty(!0),null===(l=this.store)||void 0===l||l.setDirtyIfNotCommit()}hideByCode(t){var e,i,n,r,s,o,a,l;const c=null===(e=this.dabeeoMapData)||void 0===e?void 0:e.dataGroupCode.findAllChild(t);null===(i=this.painter)||void 0===i||i.setSleepMode(!1),null===(r=null===(n=this.painter)||void 0===n?void 0:n.getMapObjectGroup())||void 0===r||r.hideObjectByCode(t,c),null===(o=null===(s=this.painter)||void 0===s?void 0:s.getMapPoiGroup())||void 0===o||o.hidePoiByCode(t,c),null===(a=this.store)||void 0===a||a.setRenderDirty(!0),null===(l=this.store)||void 0===l||l.setDirtyIfNotCommit()}getCurrentFloor(){var t;if(this.store)return null===(t=this.floorManager)||void 0===t?void 0:t.convertFloorData(this.store.getDefaultFloor())}convertToImg(t){var e;null===(e=this.captureManager)||void 0===e||e.convertToImg(t)}async addOverlaySource(t,e){var i;await(null===(i=this.overlayManager)||void 0===i?void 0:i.setSourceData(t,e))}async addOverlayLayer(t){var e,i;null===(i=null===(e=this.painter)||void 0===e?void 0:e.getMapOverlayGroup())||void 0===i||i.addLayer(t)}removeOverlaySource(t){var e;null===(e=this.overlayManager)||void 0===e||e.removeSourceData(t)}removeOverlayLayer(t){var e,i;null===(i=null===(e=this.painter)||void 0===e?void 0:e.getMapOverlayGroup())||void 0===i||i.removeLayer(t)}async addTestModel(t){var e,i,n,r,s;null===(e=this.testModelDataManager)||void 0===e||e.setModelData(t);const o=null===(i=this.testModelDataManager)||void 0===i?void 0:i.getModelData(t.modelName);o&&await(null===(s=null===(r=null===(n=this.painter)||void 0===n?void 0:n.getMapOverlayGroup())||void 0===r?void 0:r.getModelLayer())||void 0===s?void 0:s.addModel(o))}removeTestModel(t){var e,i,n,r;null===(e=this.testModelDataManager)||void 0===e||e.deleteModelData(t),null===(r=null===(n=null===(i=this.painter)||void 0===i?void 0:i.getMapOverlayGroup())||void 0===n?void 0:n.getModelLayer())||void 0===r||r.removeModel(t)}updateTestModel(t){var e,i,n,r,s;null===(e=this.testModelDataManager)||void 0===e||e.setModelData(t);const o=null===(i=this.testModelDataManager)||void 0===i?void 0:i.getModelData(t.modelName);o&&(null===(s=null===(r=null===(n=this.painter)||void 0===n?void 0:n.getMapOverlayGroup())||void 0===r?void 0:r.getModelLayer())||void 0===s||s.updateModel(o))}getAllModelData(){var t;return null===(t=this.testModelDataManager)||void 0===t?void 0:t.getAllModelData()}async showSvgMap(t){var e;return await(null===(e=this.svgLoaderManager)||void 0===e?void 0:e.loadSvgData(t))}async show3DRecon(t,e){var i,n;await(null===(n=null===(i=this.painter)||void 0===i?void 0:i.getMap3DReconGroup())||void 0===n?void 0:n.load3DRecon(t,e))}deepMergeOption(t,e){const i=Object.keys(t);return Object.keys(e).forEach((n=>{i.includes(n)||(console.error(`'${n}' is not correct mapOption!`),delete e[n]),e[n]instanceof Object&&(t[n]?Object.assign(e[n],this.deepMergeOption(t[n],e[n])):Object.assign(t,e[n]))})),Object.assign(t||{},e),t}}},7651:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i(5232)),l=o(i(5079)),c=i(4114),h=o(i(7171)),u=i(9428),d=i(3544),p=i(5895),f=i(9623),m=i(7850),g=i(326),v=i(2676),y=i(9570),_=o(i(614)),x=i(3478),M=i(6163),b=i(9922),w=i(1475),S=i(260),T=i(3100);e.default=class{constructor(t){var e;if(this.customStats=[],this.backgroundTexture=null,this.frames=0,this.lastUserActionFrameNumber=0,this.onCameraChangeEnd=t=>{var e,i;null===(e=this.map3DReconGroup)||void 0===e||e.update3DRecon(),this.quadTileManager.updateQuadTreeInFrustum(),this.quadTileManager.updateQuadTreeInZoomLevelRange(),this.quadTileManager.updateQuadTreeInMaxDistanceFromCamera(),this.quadTileManager.updateQuadTreeShouldRender(),this.quadTileManager.sortRenderDataList(),null===(i=this.mapQuadTileBoxGroup)||void 0===i||i.updateBoxHelper(),this.redrawObjects(),this.redrawPois(),this.store.setRenderDirty(!0)},this.markerManager=t.markerManager,this.myLocationManager=t.myLocationManager,this.routeSimulationManager=t.routeSimulationManager,this.overlayManager=t.overlayManager,this.quadTileManager=t.quadTileManager,this.store=t.store,this.preprocessing=t.preprocessing,this.cameraController=t.cameraController,this.textureManager=t.textureManager,this.floorManager=t.floorManager,this.indoorMapsManager=t.indoorMapsManager,this.svgLoaderManager=t.svgLoaderManager,this.mapOptions=this.store.getMapOptions(),this.scene=new c.Scene("#fff"),this.rendererClass=new h.default(this.scene,this.cameraController,this.store),this.clock=new a.Clock,this.fpsClock=new a.Clock,this.accumulatedTime=0,this.fpsTime=1/this.mapOptions.framerate,this.container=this.store.getContainer(),this.mapOptions.showWaterMarker){const t=document.createElement("img");t.src=window.innerHeight>window.innerWidth?M.DEFAULT_ICON_URLS.poweredBy01:M.DEFAULT_ICON_URLS.poweredBy02,t.style.height=window.innerHeight>window.innerWidth?"30px":"20px",t.style.objectFit="contain",t.style.position="absolute",t.style.zIndex="10000",this.mapOptions.waterMarkPosition===y.WATERMARK_TYPE.LEFT_BOTTOM&&(t.style.bottom="10px",t.style.left="10px"),this.mapOptions.waterMarkPosition===y.WATERMARK_TYPE.LEFT_TOP&&(t.style.top="10px",t.style.left="10px"),this.mapOptions.waterMarkPosition===y.WATERMARK_TYPE.RIGHT_BOTTOM&&(t.style.bottom="10px",t.style.right="10px"),this.mapOptions.waterMarkPosition===y.WATERMARK_TYPE.RIGHT_TOP&&(t.style.top="10px",t.style.right="10px");this.rendererClass.getCSS2DRendererDomElem().appendChild(t)}this.debugMode=!1,this.debugUtils=new g.ThreeDebugUtils(this.scene),this.debugMode&&(this.stats=new l.default,null===(e=this.stats)||void 0===e||e.showPanel(1),this.customStats.push(this.stats.addPanel(new l.default.Panel("drawCalls","#4f8","#421"))),this.customStats.push(this.stats.addPanel(new l.default.Panel("triangles","#6f8","#621"))),this.customStats.push(this.stats.addPanel(new l.default.Panel("geometry","#8f8","#821"))),this.customStats.push(this.stats.addPanel(new l.default.Panel("texture","#2f8","#221"))),this.customStats.push(this.stats.addPanel(new l.default.Panel("material","#af8","#021"))),this.stats.dom.className="stats",document.body.appendChild(this.stats.dom)),this.debugMode?(this.debugScene=new c.Scene,this.debugCamera=new a.OrthographicCamera(-window.innerWidth/2,window.innerWidth/2,window.innerHeight/2,-window.innerHeight/2,1,1e5),this.debugScene.add(this.debugCamera),this.debugCamera.position.set(0,0,100),this.debugCamera.lookAt(new a.Vector3),this.rendererClass.setDebugSceneNCamera(this.debugScene,this.debugCamera),this.addDebugUtils(),this.scene.add(this.cameraController.getCamera2dHelper())):(this.debugScene=null,this.debugCamera=null),this.debugTiles=!1,this.mapObjectGroup=null,this.mapPoiGroup=null,this.mapSvgLoaderObjectGroup=null,this.mapSvgLoaderPoiGroup=null,this.mapMarkerGroup=null,this.mapMyLocGroup=null,this.mapRouteSimulationGroup=null,this.mapOverlayGroup=null,this.mapQuadTileBoxGroup=null,this.map3DReconGroup=null,this.rootGroup=new v.Group("root"),this.mapTagListGroup=new _.default(this.cameraController,this.store,this.container,this.preprocessing),this.rootGroup.add(this.mapTagListGroup),this.scene.add(this.rootGroup);const i=new a.DirectionalLight(16777215,.25);this.scene.add(i);const n=new a.AmbientLight(16777215,.8);this.scene.add(n),this.eventDispatcher=t.eventDispatcher,this.onWindowResize(),window.addEventListener("resize",(()=>{this.onWindowResize()}))}getMapObjectGroup(){return this.mapObjectGroup}getMapPoiGroup(){return this.mapPoiGroup}getMapSvgLoaderObjectGroup(){return this.mapSvgLoaderObjectGroup}getMapSvgLoaderPoiGroup(){return this.mapSvgLoaderPoiGroup}getMapMarkerGroup(){return this.mapMarkerGroup}getMapMyLocGroup(){return this.mapMyLocGroup}getMapRouteSimulationGroup(){return this.mapRouteSimulationGroup}getMapOverlayGroup(){return this.mapOverlayGroup}getMapTagListGroup(){return this.mapTagListGroup}getMap3DReconGroup(){return this.map3DReconGroup}getScene(){return this.scene}getCameraController(){return this.cameraController}getRootGroup(){return this.rootGroup}getRendererClass(){return this.rendererClass}update(){this.accumulatedTime+=this.fpsClock.getDelta(),this.accumulatedTime>this.fpsTime&&(this.render(),this.accumulatedTime%=this.fpsTime),requestAnimationFrame((()=>{this.update()}))}render(){var t,e,i,n;if(this.frames++,null===(t=this.scene)||void 0===t||t.Update(),null===(e=this.cameraController)||void 0===e||e.Update(),this.store.getIsFloorChanged()&&(null===(i=this.floorManager)||void 0===i||i.onFloorChangeDetected(),this.drawNewFloor()),this.store.getIsIndoorMapFloorChanged()){const t=this.store.getCurMapId(),e=this.store.getNextIndoorMapFloorIdByMapId(t);e&&this.changeIndoorMapFloor(t,e),this.store.setIsIndoorMapFloorChanged(!1)}this.mapOptions.enableSleepMode&&(this.store.getIsSleepMode()&&this.updateLastUserActionFrameNumber(),this.checkSleepModeTimeout()&&this.setSleepMode(!0)),(this.store.getRenderDirty()||this.store.getCommit()||this.store.getRenderRouteAnimation()||this.store.getRenderMyLocAnimation()||this.store.getRenderObjectAnimation()||this.store.getRenderGifAnimation()||this.store.getRenderNaviIconAnimation())&&(this.rendererClass.requestRender(!0),this.debugMode&&(null===(n=this.stats)||void 0===n||n.update(),this.customStats[0].update(this.rendererClass.getRenderer().info.render.calls,1e3),this.customStats[1].update(this.rendererClass.getRenderer().info.render.triangles,5e3),this.customStats[2].update(this.rendererClass.getRenderer().info.memory.geometries,1e3),this.customStats[3].update(this.rendererClass.getRenderer().info.memory.textures,1e3),this.customStats[4].update(this.rendererClass.getSceneMaterial(),1e3)));const r=Math.round(1e3*this.clock.getDelta())/1e3;let s=Math.round(r/.0167*1e3)/1e3;s=Math.max(.4,s),s=Math.min(1.3,s),this.routeSimulationManager&&(this.routeSimulationManager.fpsRateRatio=s)}cleanupScene(){var t,e;null===(t=this.mapPoiGroup)||void 0===t||t.disposeCanvasContext2D(),this.scene.cleanup(),null===(e=this.debugScene)||void 0===e||e.cleanup(),this.rendererClass.requestRender(!0)}cleanup(){var t;this.textureManager.cleanup(),this.cleanupScene();null===(t=this.rendererClass.getRenderer().getContext().getExtension("WEBGL_lose_context"))||void 0===t||t.loseContext()}clearAllObject(){var t,e;null===(t=this.mapObjectGroup)||void 0===t||t.cleanup(),null===(e=this.mapObjectGroup)||void 0===e||e.removeFromParent(),this.mapObjectGroup=null}clearAllPoi(){var t,e,i;null===(t=this.mapPoiGroup)||void 0===t||t.disposeCanvasContext2D(),null===(e=this.mapPoiGroup)||void 0===e||e.cleanup(),null===(i=this.mapPoiGroup)||void 0===i||i.removeFromParent(),this.mapPoiGroup=null}async init(){this.setScene(),await this.draw(),this.cameraController.setControlBoundary()}async redraw(){const t=Boolean(this.routeSimulationManager.naviAnimOption.zoom);this.cleanupScene(),this.rootGroup=new v.Group("root"),this.rootGroup.add(this.mapTagListGroup),this.mapTagListGroup.redraw(this.store.getDefaultFloorId()),this.scene.add(this.rootGroup),await this.draw(t),this.eventDispatcher.dispatchRenderComplete(this.floorManager.convertFloorData(this.store.getDefaultFloor()))}async drawNewFloor(){var t,e,i;const n=this.floorManager.getNewFloorData();if(n){await this.redraw(),this.store.setRenderGifAnimation(!1),this.mapTagListGroup.removeToParent(this.routeSimulationManager.destPoiId),this.mapTagListGroup.shouldRedrawTag(this.routeSimulationManager.destPoiId)&&this.routeSimulationManager.shouldShowDestinationTag()&&this.mapTagListGroup.drawDestinationTag(this.routeSimulationManager.destPoiId),null===(t=this.mapMarkerGroup)||void 0===t||t.setMarker();const r=this.myLocationManager.getMyLocationInfo();this.myLocationManager.shouldRedrawMyLocation(n)&&(null===(e=this.mapMyLocGroup)||void 0===e||e.drawMyLocationMarker(null==r?void 0:r.marker,null==r?void 0:r.location)),this.routeSimulationManager.shouldRedrawRoute()&&(null===(i=this.mapRouteSimulationGroup)||void 0===i||i.draw()),this.routeSimulationManager.shouldFadeInAnim()&&this.routeSimulationManager.startFadeIn(),this.eventDispatcher.dispatchFloorChange(this.floorManager.convertFloorData(n))}}removeIndoorMap(t){this.indoorMapsManager.getIndoorMapDataOption(t)?(this.removeRenderedIndoorMap(t),this.indoorMapsManager.removeIndoorMapDataOption(t)):console.error(`제거하려는 실내지도 ${t} 가 존재하지 않습니다.`)}removeRenderedIndoorMap(t){var e,i,n;const r=null===(e=this.indoorMapsManager)||void 0===e?void 0:e.getIndoorMapRenderDataToRemove(t),{indoorSvgObjectData:s,indoorPoiData:o}=r;s&&o&&(this.mapOptions.enableTiling?(this.quadTileManager.updateObjectDataList(),this.quadTileManager.updatePoiDataList(),this.quadTileManager.removeQuadTreeDataListByMapId(t),this.eventDispatcher.dispatchCameraControlEnd()):(null===(i=this.mapObjectGroup)||void 0===i||i.removeObjects(s),null===(n=this.mapPoiGroup)||void 0===n||n.removePois(o),this.store.setRenderDirty(!0)))}async addIndoorMap(t){var e;const i=t.mapData.dataMapInfo.getId();if(this.indoorMapsManager.getIndoorMapDataOption(i))return void console.error(`추가하려는 실내지도 ${i} 가 이미 존재합니다.`);const n=await(null===(e=this.indoorMapsManager)||void 0===e?void 0:e.getIndoorMapRenderDataToAdd(t));n&&this.drawIndoorMap(n)}async changeIndoorMapFloor(t,e){var i,n,r;this.removeRenderedIndoorMap(t);const s=null===(i=this.indoorMapsManager)||void 0===i?void 0:i.getIndoorMapDataOption(t);if(s){const t=await(null===(n=this.indoorMapsManager)||void 0===n?void 0:n.getIndoorMapRenderData(s,e));t&&this.drawIndoorMap(t)}this.mapTagListGroup.removeToParent(this.routeSimulationManager.destPoiId),this.mapTagListGroup.shouldRedrawTag(this.routeSimulationManager.destPoiId)&&this.routeSimulationManager.shouldShowDestinationTag()&&this.mapTagListGroup.drawDestinationTag(this.routeSimulationManager.destPoiId),this.routeSimulationManager.shouldRedrawRoute()&&(null===(r=this.mapRouteSimulationGroup)||void 0===r||r.draw()),this.routeSimulationManager.shouldFadeInAnim()&&this.routeSimulationManager.startFadeIn()}async resetDefaultMapToOriginFloor(){this.floorManager.shouldResetToOriginFloor()&&(await this.floorManager.resetToOriginFloor(),await this.drawNewFloor())}async resetIndoorMapToOriginFloor(t){const e=this.indoorMapsManager.getIndoorMapDataOption(this.store.getCurMapId());e&&await this.changeIndoorMapFloor(e.mapData.dataMapInfo.getId(),t)}async showSvgMap(t){return await this.svgLoaderManager.loadSvgData(t)}initMergeMesh(t=!1){var e,i;t?null===(e=this.mapObjectGroup)||void 0===e||e.mergedObjectOn():null===(i=this.mapObjectGroup)||void 0===i||i.mergedObjectOff()}setSleepMode(t){this.mapOptions.enableSleepMode&&!this.routeSimulationManager.getIsNaviAnimation()&&(this.store.setIsSleepMode(t),this.initMergeMesh(t),this.store.setRenderDirty(!0))}setBackground(){var t;if(!this.mapOptions.backgroundImage)return;const e=new a.TextureLoader;if(this.backgroundTexture){const e=new a.PlaneGeometry(this.store.getMapInfo().getSize().width,this.store.getMapInfo().getSize().height),i=new a.MeshBasicMaterial({map:this.backgroundTexture,side:a.DoubleSide}),n=new a.Mesh(e,i),r=new a.Vector3(this.store.getCenter().x,-this.store.getCenter().y,0);n.position.add(r),null===(t=this.mapObjectGroup)||void 0===t||t.add(n)}else e.load(this.mapOptions.backgroundImage,(t=>{var e;this.backgroundTexture=t;const i=new a.PlaneGeometry(this.store.getMapInfo().getSize().width,this.store.getMapInfo().getSize().height),n=new a.MeshBasicMaterial({map:t,side:a.DoubleSide}),r=new a.Mesh(i,n),s=new a.Vector3(this.store.getCenter().x,-this.store.getCenter().y,0);r.position.add(s),null===(e=this.mapObjectGroup)||void 0===e||e.add(r)}))}async initObjects(){const t=this.mapOptions.enableTiling?this.quadTileManager.getRenderObjectDataList():this.store.getAllSvgObjectData();this.mapObjectGroup=new u.MapObjectGroup(t,this.textureManager,this.store,this.indoorMapsManager),(this.mapOptions.mergeMesh||this.mapOptions.enableSleepMode)&&await this.mapObjectGroup.initMerge(),await this.mapObjectGroup.init(),this.store.setCurObjectGroup(this.mapObjectGroup.getObjectGroup()),this.store.updateObjectUserDataList(),this.setBackground(),this.rootGroup.add(this.mapObjectGroup)}initPois(){var t,e;const i=this.mapOptions.enableTiling?this.quadTileManager.getRenderPoiDataList():this.store.getAllPoiData();this.mapPoiGroup=new d.MapPoiGroup(i,this.store,this.textureManager,this.rendererClass,this.cameraController,this.preprocessing),this.mapOptions.showPoi&&this.mapPoiGroup.init(),this.store.setCurPoiGroup(this.mapPoiGroup.getPoiGroup()),this.store.updatePoiUserDataList(),this.rootGroup.add(this.mapPoiGroup),this.debugMode&&(null===(t=this.debugScene)||void 0===t||t.add(this.mapPoiGroup.getDebugBoxGroup()),null===(e=this.scene)||void 0===e||e.add(this.mapPoiGroup.getDebugDotGroup())),this.mapPoiGroup.setDefaultPosition()}setResizeObserver(t){this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeObserver=new ResizeObserver((()=>{this.resizeMapCallback()})),this.resizeObserver.observe(t),this.resizeObserver.observe(this.rendererClass.getCSS2DRendererDomElem()),this.resizeObserver.observe(this.rendererClass.getRenderer().domElement)}updateLastUserActionFrameNumber(){this.lastUserActionFrameNumber=this.frames}getLastUserActionFrameNumber(){return this.lastUserActionFrameNumber}getDebugMode(){return this.debugMode}async draw(t){this.setRootGroup(),this.mapOptions.enableTiling&&this.initQuadTile(),await this.initObjects(),this.cameraController.setControlBoundingBox(this.rootGroup),this.mapOptions.enableFloorMotionOnChangeFloor||this.mapOptions.enableFloorMotionOnRouteSimulation||this.cameraController.setControlBoundary(),this.mapOptions.showPoi&&this.initPois(),this.initSvgLoader(),this.initRouteSimulation(),this.initOverlay(),this.initMyLocs(),this.initMarkers(),this.init3DReconGroup(),(this.mapOptions.mergeMesh||this.mapOptions.enableSleepMode&&this.routeSimulationManager.getIsNaviAnimation())&&this.initMergeMesh(!0),t||this.rendererClass.requestRender(!0)}initQuadTile(){this.quadTileManager.init(),this.debugTiles&&(this.mapQuadTileBoxGroup=new b.MapQuadTileBoxGroup(this.quadTileManager),this.mapQuadTileBoxGroup.init(),this.scene.add(this.mapQuadTileBoxGroup)),this.container.addEventListener("zoom-end",this.onCameraChangeEnd),this.container.addEventListener("control-end",this.onCameraChangeEnd)}initMarkers(){this.mapMarkerGroup=new p.MapMarkerGroup(this.store,this.cameraController,this.markerManager),this.rootGroup.add(this.mapMarkerGroup)}initMyLocs(){this.mapMyLocGroup=new f.MapMyLocGroup(this.store,this.cameraController,this.preprocessing,this.eventDispatcher,this.textureManager,this.myLocationManager),this.rootGroup.add(this.mapMyLocGroup)}initRouteSimulation(){this.mapObjectGroup&&(this.mapRouteSimulationGroup=new m.MapRouteSimulationGroup(this.store,this.cameraController,this.textureManager,this.routeSimulationManager,this.mapObjectGroup),this.rootGroup.add(this.mapRouteSimulationGroup),this.store.setCurRouteSimulationGroup(this.mapRouteSimulationGroup))}initOverlay(){this.mapOverlayGroup=new x.MapOverlayGroup(this.store,this.cameraController,this.rendererClass,this.preprocessing,this.eventDispatcher,this.overlayManager),this.rootGroup.add(this.mapOverlayGroup)}initSvgLoader(){this.mapSvgLoaderPoiGroup=new S.MapSvgLoaderPoiGroup(this.svgLoaderManager,this.textureManager,this.store),this.mapSvgLoaderObjectGroup=new w.MapSvgLoaderObjectGroup(this.svgLoaderManager,this.textureManager,this.store),this.mapSvgLoaderPoiGroup.init(),this.mapSvgLoaderObjectGroup.init(),this.rootGroup.add(this.mapSvgLoaderPoiGroup),this.rootGroup.add(this.mapSvgLoaderObjectGroup)}init3DReconGroup(){this.map3DReconGroup=new T.Map3DReconGroup(this.rendererClass,this.cameraController),this.rootGroup.add(this.map3DReconGroup)}setScene(){const t=this.store.getMapInfo().getThemes().find((t=>t.defaultYn));this.scene.background=new a.Color(null==t?void 0:t.canvasColor)}setRootGroup(){this.preprocessing.transformRootGroup(this.rootGroup)}addDebugUtils(){this.debugUtils.setHelper()}onWindowResize(){var t;this.cameraController.setCameraSize(),this.debugCamera&&(this.debugCamera.left=-window.innerWidth/2,this.debugCamera.right=window.innerWidth/2,this.debugCamera.top=window.innerHeight/2,this.debugCamera.bottom=-window.innerHeight/2,this.debugCamera.updateProjectionMatrix()),this.container&&this.rendererClass.setSize({width:this.container.clientWidth||window.innerWidth,height:this.container.clientHeight||window.innerHeight}),null===(t=this.mapPoiGroup)||void 0===t||t.setDefaultPosition(),this.store.setRenderDirty(!0)}redrawObjects(){var t,e,i;null===(t=this.mapObjectGroup)||void 0===t||t.removeObjects(this.quadTileManager.getRemoveObjectDataList()),null===(e=this.mapObjectGroup)||void 0===e||e.addObjects(this.quadTileManager.getRenderObjectDataList());const n=this.quadTileManager.getPrevRenderedObjectDataList();null===(i=this.mapObjectGroup)||void 0===i||i.updateSvgObjectList(n)}redrawPois(){var t,e,i,n;null===(t=this.mapPoiGroup)||void 0===t||t.removePois(this.quadTileManager.getRemovePoiDataList()),null===(e=this.mapPoiGroup)||void 0===e||e.addPois(this.quadTileManager.getRenderPoiDataList()),null===(i=this.mapPoiGroup)||void 0===i||i.setDefaultPosition();const r=this.quadTileManager.getPrevRenderedPoiDataList();null===(n=this.mapPoiGroup)||void 0===n||n.updatePoiDataList(r)}drawIndoorMap(t){var e,i,n;const{indoorSvgObjectData:r,indoorPoiData:s}=t;r&&s&&(this.mapOptions.enableTiling?(this.quadTileManager.updateObjectDataList(),this.quadTileManager.updatePoiDataList(),this.quadTileManager.setQuadTreeDataList(r,s),this.eventDispatcher.dispatchCameraControlEnd()):(null===(e=this.mapObjectGroup)||void 0===e||e.addObjects(r),null===(i=this.mapPoiGroup)||void 0===i||i.addPois(s),null===(n=this.mapPoiGroup)||void 0===n||n.setDefaultPosition(),this.store.setRenderDirty(!0)))}checkSleepModeTimeout(){const t=this.store.getMapOptions();if(t.enableSleepMode){if((this.frames-this.lastUserActionFrameNumber)/t.framerate*1e3>t.sleepModeOption.sleepModeTimeout)return!0}return!1}resizeMapCallback(){if(this.container){const t=this.container.clientWidth,e=this.container.clientHeight;this.rendererClass.setSize({width:t,height:e}),this.cameraController.setCameraSize()}}}},4319:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.CaptureManager=void 0;const o=s(i(5232));e.CaptureManager=class{constructor(t,e){this.store=t,this.container=t.getContainer(),this.cameraController=e}setPainter(t){this.painter=t}setScene(t){this.scene=t}convertToImg(t){var e;if(this.container){const i=null===(e=this.cameraController)||void 0===e?void 0:e.getCamera(),n=document.createElement("div"),r=document.createElement("canvas");let s=0,a=0;const l=new o.WebGLRenderer({canvas:r,antialias:!0,preserveDrawingBuffer:!0,alpha:!0}),c=l.domElement;let{ratio:h}=t;(h<0||Number.isNaN(h))&&(h=1),h>5&&(h=5),n.style.visibility="hidden",n.style.zIndex="-999999",n.style.position="absolute",n.appendChild(r),this.container.insertAdjacentElement("afterbegin",n),s=this.container.getBoundingClientRect().width*h,a=this.container.getBoundingClientRect().height*h;const u=s/a;"PerspectiveCamera"===(null==i?void 0:i.type)&&(i.aspect=u),null==i||i.updateProjectionMatrix(),l.setPixelRatio(window.devicePixelRatio),l.setSize(s,a),this.scene&&i&&l.render(this.scene,i),c.toBlob((t=>{var e,i,s;this.saveBlob()(t,"test.png"),r.width=0,r.height=0,n.removeChild(r),"remove"in n?(null===(e=n.parentNode)||void 0===e||e.removeChild(n),n.remove()):null===(i=n.parentNode)||void 0===i||i.removeChild(n),l.clear(),l.dispose(),null===(s=this.painter)||void 0===s||s.redraw()}))}}saveBlob(){const t=document.createElement("a");return document.body.appendChild(t),t.style.display="none",function(e,i){var n;if(e){const n=window.URL.createObjectURL(e);t.href=n,t.download=i,t.click()}null===(n=t.parentNode)||void 0===n||n.removeChild(t)}}}},3720:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.CameraController=void 0;const a=s(i(5232)),l=i(6486),c=o(i(5514)),h=i(9935),u=i(6202),d=i(1949);c.default.install({THREE:a});e.CameraController=class{constructor(t,e,i,n){this.controlDefaultOptions=(0,l.cloneDeep)(h.controlDefaultOption),this.zoomToDistanceRatio=.01,this.zoomScale=()=>.98,this.nowScale=1,this.rotateSpeedOnChangeFloor=null,this.fadeSpeedOnChangeFloor=null,this.rotateSpeedOnRouteSimulation=null,this.fadeSpeedOnRouteSimulation=null,this.controlstart=t=>{this.eventDispatcher.dispatchCameraControlStart()},this.controlend=t=>{!this.store.getDirty()&&this.store.getPlaced()&&(this.store.setDirtyIfNotCommit(),this.timeoutID&&clearTimeout(this.timeoutID)),this.eventDispatcher.dispatchCameraControlEnd()},this.control=t=>{},this.isInitialized=!1,this.eventDispatcher=i,this.preprocessing=n,this.store=e,this.clock=new a.Clock,this.boundingBox=new a.Box3,this.mapInfo=this.store.getMapInfo(),this.center=this.store.getCenter(),this.mapOptions=this.store.getMapOptions(),this.controlOptions=Object.assign({},this.controlDefaultOptions),this.initDollyDistance=0,this.initZoom=0,this.isCamRot=!1,this.curCamRot={azimuth:0,polar:0},this.targetCamRot={azimuth:0,polar:0},this.mapOptions.enableFloorMotionOnChangeFloor&&(this.rotateSpeedOnChangeFloor=a.MathUtils.clamp(this.mapOptions.floorMotionSpeedOnChangeFloor.rotateSpeed,.01,.9),this.fadeSpeedOnChangeFloor=a.MathUtils.clamp(this.mapOptions.floorMotionSpeedOnChangeFloor.fadeSpeed,.01,.9)),this.mapOptions.enableFloorMotionOnRouteSimulation&&(this.rotateSpeedOnRouteSimulation=a.MathUtils.clamp(this.mapOptions.floorMotionSpeedOnRouteSimulation.rotateSpeed,.01,.9),this.fadeSpeedOnRouteSimulation=a.MathUtils.clamp(this.mapOptions.floorMotionSpeedOnRouteSimulation.fadeSpeed,.01,.9)),this.isNaviAnimationOn=!1,this.isFadeOut=!1,this.isFadeIn=!1,this.startCamPos=0,this.curCamPos=0,this.targetCamPos=0,this.accelAbs=Math.abs(4.5),this.velocity=0,this.isCameraAnimatingBeforeLastRotation=!1,this.isCameraAnimating=!1,this.beforeZoom=0,this.beforeTilt=0,this.beforeRotation=0,this.beforeClientSize={x:0,y:0},this.lastZoomTime=0,this.zoomDirty=!1,this.container=this.store.getContainer(),this.canvasSize={width:this.container.clientWidth||window.innerWidth,height:this.container.clientHeight||window.innerHeight},this.frustumSize=Math.max(this.mapInfo.getSize().width,this.mapInfo.getSize().height),this.type=t,this.camera2d=new a.OrthographicCamera(-this.frustumSize*this.canvasSize.width/1e3,this.frustumSize*this.canvasSize.width/1e3,this.frustumSize*this.canvasSize.height/1e3,-this.frustumSize*this.canvasSize.height/1e3,-1*this.mapInfo.getScaleCm()*this.mapInfo.getScaleCm(),1e4*Math.sqrt(this.mapInfo.getScaleCm())),this.camera2d.up.set(0,1,0),this.camera2d.position.setY(this.mapInfo.getSize().width+this.store.getMaxObjZ()*this.mapInfo.getScaleCm()),this.camera2dHelper=new a.CameraHelper(this.camera2d);const r=this.canvasSize.width/this.canvasSize.height;this.camera3d=new a.PerspectiveCamera(45,r,1,1e7),this.camera3d.up.set(0,1,0),this.camera3d.updateProjectionMatrix(),this.rtCamera=new a.OrthographicCamera(-this.store.getMapInfo().getSize().width/2,this.store.getMapInfo().getSize().width/2,this.store.getMapInfo().getSize().height/2,-this.store.getMapInfo().getSize().height/2,0,1e7),this.camera2dHelper=new a.CameraHelper(this.camera2d),this.updateEventListener=this.update.bind(this),this.wakeEventListener=this.wake.bind(this),this.restEventListener=this.rest.bind(this),this.sleepEventListener=this.sleep.bind(this),this.controlEventListener=this.control.bind(this),this.controlstartEventListener=this.controlstart.bind(this),this.controlendEventListener=this.controlend.bind(this),this.setControls(this.container),this.changeCamera(this.type,!0)}getCamera2dHelper(){return this.camera2dHelper}getCamera(){return this.camera}get2DCamera(){return this.camera2d}get3DCamera(){return this.camera3d}getFrustumSize(){return this.frustumSize}getAspect(){return this.canvasSize.width/this.canvasSize.height}getControls(){return this.controls}getInitZoom(){return this.initZoom}getCameraType(){let t="";return this.camera instanceof a.PerspectiveCamera?t="3D":this.camera instanceof a.OrthographicCamera&&(t="2D"),t}getNowZoom(){const{camera:t}=this,e=(100*t.zoom).toFixed(0);return Number(e)}getIsCameraAnimating(){return this.isCameraAnimating}setIsNaviAnimationOn(t){this.isNaviAnimationOn=t}zoomControl(t){return this.zoomLevelControl(this.camera,t.zoom,0,t.transition)}rotateTo(t,e,i){this.controls.rotateTo(t,e,i)}moveTo(t,e,i,n){this.controls.moveTo(t,e,i,n)}callThreeWorldMoveCamera(t){this.threeWorldMoveCamera(this.camera2d,t.position,t.transition),this.threeWorldMoveCamera(this.camera3d,t.position,t.transition)}getCurrentZoomRatio(){let t=1;return t=this.camera instanceof a.OrthographicCamera?this.initZoom/this.camera.zoom:this.controls.distance/this.initDollyDistance,t}camera3dDistanceTo(t){return this.camera3d.position.distanceTo(t)}cameraSet(t){return"number"==typeof t.rotation&&this.controls.rotateAzimuthTo(t.rotation*a.MathUtils.DEG2RAD,t.transition),"number"==typeof t.tilt&&this.controls.rotatePolarTo(t.tilt*a.MathUtils.DEG2RAD,t.transition),"number"==typeof t.zoom&&this.zoomControl({zoom:t.zoom,transition:t.transition}),t}cameraReset(t){this.controls.reset(null==t?void 0:t.transition)}zoomIn(t){const e=this.getCurrentZoomLevel()/this.zoomScale();return this.zoomLevelControl(this.camera,e,0,null==t?void 0:t.transition)}zoomOut(t){const e=this.getCurrentZoomLevel()*this.zoomScale();return this.zoomLevelControl(this.camera,e,0,null==t?void 0:t.transition)}initCameraAnimation(){this.clearControlBoundary(),this.isCameraAnimatingBeforeLastRotation=!0,this.isCameraAnimating=!0;const{store:t}=this,e=t.getCurFloorIndex()>t.getPrevFloorIndex()?"up":"down";t.setFloorChangeDirection(e),"3D"===this.type&&this.enableRotate(0,1),"2D"===this.type&&(this.setCurCamRot(0,0),this.enableFadeOut())}focusTo(t){const e=t.object.getSize(new a.Vector3),i=t.padding?e.z*(t.padding.top/100):void 0,n=t.padding?e.x*(t.padding.left/100):void 0,r=t.padding?e.z*(t.padding.bottom/100):void 0,s=t.padding?e.x*(t.padding.right/100):void 0;this.controls.fitToBox(t.object,t.transition,{paddingTop:i,paddingLeft:n,paddingBottom:r,paddingRight:s})}setOption(t){return this.controlOptions=(0,l.merge)(this.controlOptions,t),this.setControlOptions(!1)}setCameraSize(){const{container:t}=this;this.canvasSize={width:(null==t?void 0:t.clientWidth)||window.innerWidth,height:(null==t?void 0:t.clientHeight)||window.innerHeight};const e=this.getAspect(),i=this.getFrustumSize(),n=this.get2DCamera(),r=this.get3DCamera();if(r.aspect=e,this.beforeClientSize.y>0){const t=this.canvasSize.height*r.fov/this.beforeClientSize.y%180;r.fov=t}this.beforeClientSize={x:this.canvasSize.width,y:this.canvasSize.height},r.updateProjectionMatrix(),n.left=-i*this.canvasSize.width/1e3,n.right=i*this.canvasSize.width/1e3,n.top=i*this.canvasSize.height/1e3,n.bottom=-i*this.canvasSize.height/1e3,n.updateProjectionMatrix(),this.store.setRenderDirty(!0)}Update(){const t=this.clock.getDelta();this.controls.update(t)&&(this.store.setRenderDirty(!0),!this.store.getDirty()&&this.store.getPlaced()&&this.store.setDirtyIfNotCommit()),this.checkCameraZoomEnd(),this.rotate(),this.fadeOut(),this.fadeIn()}cameraMoveTo(t){var e;const i=null===(e=this.preprocessing)||void 0===e?void 0:e.userMapCoordToWorldCoord(t.position);if(i){const e={position:{x:i.x,y:i.y,z:i.z},transition:t.transition};this.callThreeWorldMoveCamera(e)}return t.position}cameraFocusTo(t){var e,i,n,r;let s=null;const o=t.focus.type;if(o===d.FOCUS_TYPE.OBJECT){if(t.focus.ids){const i=this.getObjectsFromId(t.focus.ids);if(i.length){const t=new a.Group;i.forEach((e=>{t.add(e)})),null===(e=this.preprocessing)||void 0===e||e.transformRootGroup(t),s=new a.Box3,s.setFromObject(t),t.children.forEach((t=>{t.children.forEach((t=>{t instanceof a.Mesh&&t.geometry.dispose()}))}))}else console.error(`focus할 object ${t.focus.ids}가 현재층에 존재하지 않습니다.`)}}else if(o===d.FOCUS_TYPE.OBJECT_ALL){const t=null===(i=this.store)||void 0===i?void 0:i.getCurObjectGroup();t&&t.children.length?(s=new a.Box3,s.setFromObject(t)):console.error("focus할 object가 없습니다.")}else if(o===d.FOCUS_TYPE.POI){if(t.focus.ids){const e=this.getPoisFromId(t.focus.ids);if(e.length){const t=new a.Group;e.forEach((e=>{t.add(e)})),s=new a.Box3,s.setFromObject(t),t.children.forEach((t=>{t.children.forEach((t=>{(t instanceof a.Sprite||t instanceof a.Mesh)&&t.geometry.dispose()}))}))}else console.error(`focus할 poi ${t.focus.ids}가 현재층에 존재하지 않습니다.`)}}else if(o===d.FOCUS_TYPE.POI_ALL){const t=null===(n=this.store)||void 0===n?void 0:n.getCurPoiGroup();t&&t.children.length?(s=new a.Box3,s.setFromObject(t)):console.error("focus할 poi가 없습니다.")}else if(o===d.FOCUS_TYPE.NAVIGATION){const t=null===(r=this.store)||void 0===r?void 0:r.getCurRouteSimulationGroup();t&&t.children.length?(s=new a.Box3,s.setFromObject(t)):console.error("focus할 route가 없습니다.")}else console.error(`요청한 focus option ${t.focus.type}은 제공하지 않는 옵션입니다.`);if(s){const e=Object.assign({object:s},t);return this.focusTo(e),t}}getPoisFromId(t){var e;const i=null===(e=this.store)||void 0===e?void 0:e.getCurPoiGroup(),n=[];return t.forEach((t=>{let e=!1;null==i||i.children.forEach((i=>{if(i.userData.id===t){const t=new a.Group,r=new a.Sprite,s=new a.Sprite;r.applyMatrix4(i.children[0].matrixWorld),t.add(r),i.children.length>1&&(s.applyMatrix4(i.children[1].matrixWorld),t.add(s)),n.push(t),e=!0}})),e||console.error(`요청한 poi ${t}는 현재층에 존재하지 않는 poi입니다.`)})),n}getObjectsFromId(t){var e;t.length;const i=[],n=null===(e=this.store)||void 0===e?void 0:e.getCurObjectGroup();return t.forEach((t=>{let e=!1;null==n||n.children.forEach((n=>{n.userData.id===t&&(i.push(n.clone()),e=!0)})),e||console.error(`focus할 object ${t}가 현재층에 존재하지 않습니다.`)})),i}checkCameraZoomEnd(){this.shouldDispatchCameraZoomEnd()&&(this.eventDispatcher.dispatchCameraZoomEnd({changedValue:this.beforeZoom}),this.lastZoomTime=0,this.zoomDirty=!1)}shouldDispatchCameraZoomEnd(){const t=this.clock.getElapsedTime()-this.lastZoomTime;return this.zoomDirty&&t>.15&&t<.25}getResoultionToZoomLevel(t){const e=156543.0339/t;return Math.log(e)/Math.log(2)}getZoomLevelToResoultion(t){if(t<0||t>24)return 1;let e=156543.0339/2**t;return e*=100,e}getZoomLevelToDistance(t){let e=0;const i=this.getZoomLevelToResoultion(t),n=new a.Vector3(i*this.canvasSize.width,i*this.canvasSize.height,0),r=this.camera3d.fov*(Math.PI/180);return e=Math.abs(n.y/2/Math.tan(r/2)),e}getZoomLevelToZoom(t){let e=0;const i=this.getZoomLevelToResoultion(t),n=new a.Vector3(i*this.canvasSize.width,i*this.canvasSize.height,0),r=this.camera2d.right-this.camera2d.left,s=this.camera2d.top-this.camera2d.bottom;return e=Math.min(r/n.x,s/n.y),e}getMeterToCentimeter(t){return.01*t}getCentimeterToMeter(t){return 100*t}getCurrentCmFromPixel(t){let e=0;if(this.camera instanceof a.PerspectiveCamera){const t=this.camera3d.fov*Math.PI/180,i=2*Math.tan(t/2)*this.controls.distance,n={x:i*(this.canvasSize.width/this.canvasSize.height),y:i};e=Math.max(n.x/this.canvasSize.width,n.y/this.canvasSize.height),e=this.getMeterToCentimeter(e)}else if(this.camera instanceof a.OrthographicCamera){const t=this.camera2d.right-this.camera2d.left,i=this.camera2d.top-this.camera2d.bottom,{zoom:n}=this.camera2d,r={x:t/n,y:i/n};e=Math.max(r.x/this.canvasSize.width,r.y/this.canvasSize.height),e=this.getMeterToCentimeter(e)}return this.preprocessing.divideScaleCm(t*e*100)}getCurrentZoomLevel(){let t=0;if(this.camera instanceof a.PerspectiveCamera){const e=this.camera3d.fov*Math.PI/180,i=2*Math.tan(e/2)*this.controls.distance,n={x:i*(this.canvasSize.width/this.canvasSize.height),y:i};let r=Math.max(n.x/this.canvasSize.width,n.y/this.canvasSize.height);r=this.getMeterToCentimeter(r),t=this.getResoultionToZoomLevel(r)}else if(this.camera instanceof a.OrthographicCamera){const e=this.camera2d.right-this.camera2d.left,i=this.camera2d.top-this.camera2d.bottom,{zoom:n}=this.camera2d,r={x:e/n,y:i/n};let s=Math.max(r.x/this.canvasSize.width,r.y/this.canvasSize.height);s=this.getMeterToCentimeter(s),t=this.getResoultionToZoomLevel(s)}return t}zoomLevelControl(t,e,i,n){if(t instanceof a.PerspectiveCamera){let r=this.getZoomLevelToDistance(e);void 0!==i&&0!==i&&(r*=i),this.controls3d.dollyTo(r,n),t.updateProjectionMatrix(),0===this.initDollyDistance&&(this.initDollyDistance=r)}else if(t instanceof a.OrthographicCamera){const t=this.getZoomLevelToZoom(e);this.controls2d.zoomTo(t,n),0===this.initZoom&&(this.initZoom=t)}return e}setControlBoundingBox(t){this.boundingBox.setFromObject(t);const e=this.boundingBox.getCenter(new a.Vector3),i=this.preprocessing.multiplyScaleCm(this.store.getMapInfo().getSize().width),n=this.preprocessing.multiplyScaleCm(this.store.getMaxObjZ()),r=this.preprocessing.multiplyScaleCm(this.store.getMapInfo().getSize().height),s=new a.Vector3(i,n,r);this.boundingBox.setFromCenterAndSize(e,s)}setControlBoundary(){this.controls2d.setBoundary(this.boundingBox),this.controls3d.setBoundary(this.boundingBox)}clearControlBoundary(){this.controls2d.setBoundary(void 0),this.controls3d.setBoundary(void 0)}getFrustum(){this.camera.updateMatrix(),this.camera.updateMatrixWorld();return(new a.Frustum).setFromProjectionMatrix((new a.Matrix4).multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse))}getZoomLevelByResolution(){const t=this.store.getMapInfo();let e=0,i=0,n=0;this.canvasSize.width>=this.canvasSize.height?(e=t.getSize().width,i=this.canvasSize.width):(e=t.getSize().height,i=this.canvasSize.height),e=this.preprocessing.multiplyScaleCm(e),e*=.01,n=e/i;return this.getResoultionToZoomLevel(n)}syncCamera(t){let e=this.controls3d,i=this.controls2d,n=this.camera2d;"3D"===t.toUpperCase()&&(e=this.controls2d,i=this.controls3d,n=this.camera3d);const r=this.getCurrentZoomLevel(),s=new a.Vector3;e.getPosition(s);const{polarAngle:o}=e,{azimuthAngle:l}=e;this.zoomLevelControl(n,r,0,!1),i.moveTo(s.x,0,s.z,!1),i.rotatePolarTo(o,!1),i.rotateAzimuthTo(l,!1),i.update(1)}async changeCamera(t,e){this.type=t.toUpperCase(),"2D"===this.type?(e||this.syncCamera(this.type),this.camera=this.camera2d,this.controls=this.controls2d):"3D"===this.type&&(e||this.syncCamera(this.type),this.camera=this.camera3d,this.controls=this.controls3d),this.controls3d.update(1),this.controls2d.update(1),this.setControlEvents()}getControlAction(t,e){if("ZOOM"===t){if("2D"===(null==e?void 0:e.toUpperCase()))return c.default.ACTION.ZOOM;if("3D"===(null==e?void 0:e.toUpperCase()))return c.default.ACTION.DOLLY}else{if("ROTATE"===t)return c.default.ACTION.ROTATE;if("PAN"===t)return c.default.ACTION.TRUCK}return c.default.ACTION.NONE}setControlOptions(t){const e=this.controlOptions.mouseOption?this.controlOptions.mouseOption:this.controlDefaultOptions.mouseOption,i=this.controlOptions.touchOption?this.controlOptions.touchOption:this.controlDefaultOptions.touchOption,n=this.controlOptions.controlRangeOption?this.controlOptions.controlRangeOption:this.controlDefaultOptions.controlRangeOption,r=e.buttonOption?e.buttonOption:this.controlDefaultOptions.mouseOption.buttonOption;let s,o,l,h,d=0,p=0;const f=this.getCameraType();if(s=this.getControlAction(r.left.toUpperCase(),f),o=this.getControlAction(r.right.toUpperCase(),f),l=this.getControlAction(r.middle.toUpperCase(),"2D"),h=this.getControlAction(r.middle.toUpperCase(),"3D"),e&&(!1===e.enablePan&&(s=c.default.ACTION.NONE),!1===e.enableRotate&&!1===e.enableTilt&&(o=c.default.ACTION.NONE),!1===e.enableZoom&&(l=c.default.ACTION.NONE,h=c.default.ACTION.NONE)),this.controls3d.mouseButtons={left:s,right:o,middle:h,wheel:h},this.controls2d.mouseButtons={left:s,right:o,middle:l,wheel:l},this.controls3d.touches={one:c.default.ACTION.TOUCH_TRUCK,two:c.default.ACTION.TOUCH_DOLLY_ROTATE,three:c.default.ACTION.NONE},this.controls2d.touches={one:c.default.ACTION.TOUCH_TRUCK,two:c.default.ACTION.TOUCH_ZOOM_ROTATE,three:c.default.ACTION.NONE},!1===i.enablePan&&(this.controls3d.touches.one=c.default.ACTION.NONE,this.controls2d.touches.one=c.default.ACTION.NONE),i.enableZoom?!1===i.enableTilt&&!1===i.enableRotate&&(this.controls3d.touches.two=c.default.ACTION.TOUCH_DOLLY,this.controls2d.touches.two=c.default.ACTION.TOUCH_ZOOM):!1===i.enableTilt&&!1===i.enableRotate?(this.controls3d.touches.two=c.default.ACTION.NONE,this.controls2d.touches.two=c.default.ACTION.NONE):(this.controls3d.touches.two=c.default.ACTION.TOUCH_ROTATE,this.controls2d.touches.two=c.default.ACTION.TOUCH_ROTATE),n){let t=this.controlDefaultOptions.controlRangeOption.zoom.max,e=this.controlDefaultOptions.controlRangeOption.zoom.min;if(n.zoom){const i=n.zoom.max,r=n.zoom.min;i<=this.controlDefaultOptions.controlRangeOption.zoom.max&&i>=this.controlDefaultOptions.controlRangeOption.zoom.min&&(t=i),r<=this.controlDefaultOptions.controlRangeOption.zoom.max&&r>=this.controlDefaultOptions.controlRangeOption.zoom.min&&r<i&&(e=r)}const i=this.getZoomLevelToDistance(e),r=this.getZoomLevelToDistance(t),s=this.getZoomLevelToZoom(t),o=this.getZoomLevelToZoom(e);this.controls3d.maxDistance=i,this.controls3d.minDistance=r,this.controls2d.maxZoom=s,this.controls2d.minZoom=o,d=t,p=e}const m=u.DabeeoUtils.isMobileDevice();let{enableRotate:g}=e;m&&(g=i.enableRotate),!1===g?(this.controls3d.maxAzimuthAngle=this.controls3d.azimuthAngle,this.controls3d.minAzimuthAngle=this.controls3d.azimuthAngle,this.controls2d.maxAzimuthAngle=this.controls3d.azimuthAngle,this.controls2d.minAzimuthAngle=this.controls3d.azimuthAngle):n.rotate?(n.rotate.max!==1/0?(this.controls3d.maxAzimuthAngle=n.rotate.max*a.MathUtils.DEG2RAD,this.controls2d.maxAzimuthAngle=n.rotate.max*a.MathUtils.DEG2RAD):(this.controls3d.maxAzimuthAngle=1/0,this.controls2d.maxAzimuthAngle=1/0),n.rotate.min!==-1/0?(this.controls3d.minAzimuthAngle=n.rotate.min*a.MathUtils.DEG2RAD,this.controls2d.minAzimuthAngle=n.rotate.min*a.MathUtils.DEG2RAD):(this.controls3d.minAzimuthAngle=-1/0,this.controls2d.minAzimuthAngle=-1/0)):(this.controls3d.maxAzimuthAngle=1/0,this.controls3d.minAzimuthAngle=-1/0,this.controls2d.maxAzimuthAngle=1/0,this.controls2d.minAzimuthAngle=-1/0);let{enableTilt:v}=e;if(m&&(v=i.enableTilt),!1===v)this.controls3d.maxPolarAngle=this.controls3d.polarAngle,this.controls3d.minPolarAngle=this.controls3d.polarAngle;else{let t=this.controlDefaultOptions.controlRangeOption.tilt.min,e=this.controlDefaultOptions.controlRangeOption.tilt.max;if(n.tilt){const i=n.tilt.max,r=n.tilt.min;i<=this.controlDefaultOptions.controlRangeOption.tilt.max&&i>=this.controlDefaultOptions.controlRangeOption.tilt.min&&(e=i),r<=this.controlDefaultOptions.controlRangeOption.tilt.max&&r>=this.controlDefaultOptions.controlRangeOption.tilt.min&&r<i&&(t=r)}this.controls3d.maxPolarAngle=e*a.MathUtils.DEG2RAD,this.controls3d.minPolarAngle=t*a.MathUtils.DEG2RAD}this.controls2d.maxPolarAngle=-Math.PI/180,this.controls2d.dollyToCursor=!0,this.controls3d.dollyToCursor=!0,this.controls2d.restThreshold=this.preprocessing.multiplyScaleCm(1),this.controls3d.restThreshold=this.preprocessing.multiplyScaleCm(1),t&&this.setDefaultCameraControlOptions();return{controls2d:{maxZoom:d,minZoom:p,maxRotate:Math.round(this.controls2d.maxAzimuthAngle/a.MathUtils.DEG2RAD),minRotate:Math.round(this.controls2d.minAzimuthAngle/a.MathUtils.DEG2RAD)},controls3d:{maxZoom:d,minZoom:p,maxTilt:this.controls3d.maxPolarAngle/a.MathUtils.DEG2RAD,minTilt:Math.round(this.controls3d.minPolarAngle/a.MathUtils.DEG2RAD),maxRotate:Math.round(this.controls3d.maxAzimuthAngle/a.MathUtils.DEG2RAD),minRotate:Math.round(this.controls3d.minAzimuthAngle/a.MathUtils.DEG2RAD)}}}setControlEvents(){this.controls3d.removeEventListener("update",this.updateEventListener),this.controls3d.removeEventListener("wake",this.wakeEventListener),this.controls3d.removeEventListener("rest",this.restEventListener),this.controls3d.removeEventListener("sleep",this.sleepEventListener),this.controls3d.removeEventListener("control",this.controlEventListener),this.controls3d.removeEventListener("controlstart",this.controlstartEventListener),this.controls3d.removeEventListener("controlend",this.controlendEventListener),this.controls2d.removeEventListener("update",this.updateEventListener),this.controls2d.removeEventListener("wake",this.wakeEventListener),this.controls2d.removeEventListener("rest",this.restEventListener),this.controls2d.removeEventListener("sleep",this.sleepEventListener),this.controls2d.removeEventListener("control",this.controlEventListener),this.controls2d.removeEventListener("controlstart",this.controlstartEventListener),this.controls2d.removeEventListener("controlend",this.controlendEventListener);let t=this.controls2d||this.controls3d;t=this.camera instanceof a.OrthographicCamera?this.controls2d:this.controls3d,t.addEventListener("controlstart",this.controlstartEventListener),t.addEventListener("controlend",this.controlendEventListener),t.addEventListener("control",this.controlEventListener),t.addEventListener("update",this.updateEventListener),t.addEventListener("wake",this.wakeEventListener),t.addEventListener("rest",this.restEventListener),t.addEventListener("sleep",this.sleepEventListener)}setControls(t){return this.controls2d=new c.default(this.camera2d,t),this.controls3d=new c.default(this.camera3d,t),this.setControlEvents(),this.setControlOptions(!0)}wake(t){}rest(t){!this.store.getDirty()&&this.store.getPlaced()&&(this.store.setDirtyIfNotCommit(),this.timeoutID&&clearTimeout(this.timeoutID))}sleep(t){!this.store.getDirty()&&this.store.getPlaced()?(this.store.setDirtyIfNotCommit(),this.timeoutID&&clearTimeout(this.timeoutID)):this.timeoutID=setTimeout((()=>{!this.store.getDirty()&&this.store.getPlaced()&&this.store.setDirtyIfNotCommit()}),1e3)}update(t){if(this.isInitialized){const t=this.getCurrentZoomLevel(),e=a.MathUtils.radToDeg(this.controls.polarAngle),i=a.MathUtils.radToDeg(this.controls.azimuthAngle),n=this.center.x+this.camera.position.x,r=this.center.y+this.camera.position.z;Number(n),Number(r);t!==this.beforeZoom&&(this.eventDispatcher.dispatchCameraZoomChanged({changedValue:t}),this.lastZoomTime=this.clock.getElapsedTime(),this.zoomDirty=!0),e!==this.beforeTilt&&this.eventDispatcher.dispatchCameraTiltChanged({changedValue:e}),i!==this.beforeRotation&&this.eventDispatcher.dispatchCameraRotationChanged({changedValue:i}),this.beforeZoom=t,this.beforeTilt=e,this.beforeRotation=i}}async setDefaultCameraControlOptions(){await this.setZoom(),await this.setPan(),await this.setRotate(),this.controls2d.saveState(),this.controls3d.saveState(),this.isInitialized=!0}setZoom(t=!1){if(this.mapOptions.controlOption.zoom)this.zoomLevelControl(this.camera2d,this.mapOptions.controlOption.zoom,0,t),this.zoomLevelControl(this.camera3d,this.mapOptions.controlOption.zoom,0,t);else{const e=this.getZoomLevelByResolution();this.zoomLevelControl(this.camera2d,e,0,t),this.zoomLevelControl(this.camera3d,e,0,t)}}setPan(t=!1){var e,i;let n=new a.Vector3,r={x:0,y:0,z:0};this.mapOptions.controlOption.pan,void 0!==(null===(e=this.mapOptions.controlOption.pan)||void 0===e?void 0:e.x)&&void 0!==(null===(i=this.mapOptions.controlOption.pan)||void 0===i?void 0:i.y)&&(r=this.preprocessing.userMapCoordToWorldCoord({x:this.mapOptions.controlOption.pan.x,y:this.mapOptions.controlOption.pan.y})),void 0!==r.x&&void 0!==r.y&&void 0!==r.z&&(this.mapOptions.controlOption.pan,n=new a.Vector3(r.x,r.y,r.z)),this.threeWorldMoveCamera(this.camera2d,n,t),this.threeWorldMoveCamera(this.camera3d,n,t)}setRotate(t=!1){(this.mapOptions.controlOption.rotate||this.mapOptions.controlOption.tilt)&&(this.controls.rotateTo(0,0,t),this.controls.update(0),"number"==typeof this.mapOptions.controlOption.rotate&&(this.controls2d.rotate(this.mapOptions.controlOption.rotate*a.MathUtils.DEG2RAD,0,t),this.controls3d.rotate(this.mapOptions.controlOption.rotate*a.MathUtils.DEG2RAD,0,t)),this.camera instanceof a.PerspectiveCamera&&"number"==typeof this.mapOptions.controlOption.tilt&&(this.controls2d.rotate(0,this.mapOptions.controlOption.tilt*a.MathUtils.DEG2RAD,t),this.controls3d.rotate(0,this.mapOptions.controlOption.tilt*a.MathUtils.DEG2RAD,t)),this.controls.update(1),this.controlRotate3d())}controlRotate3d(){this.mapOptions.angle&&"boolean"==typeof this.mapOptions.angle.fixed&&(this.mapOptions.angle.fixed?(Object.values(this.controls3d.mouseButtons).forEach(((t,e)=>{if(t===c.default.ACTION.ROTATE){const t=Object.keys(this.controls3d.mouseButtons)[e];Object.assign(this.controls3d.mouseButtons,{[t]:null})}})),Object.assign(this.controls3d.touches,{two:c.default.ACTION.TOUCH_DOLLY})):(Object.values(this.controls3d.mouseButtons).forEach(((t,e)=>{if(t===c.default.ACTION.TRUCK){const t="left"===Object.keys(this.controls3d.mouseButtons)[e]?"right":"left";Object.assign(this.controls3d.mouseButtons,{[t]:c.default.ACTION.ROTATE})}})),Object.assign(this.controls3d.touches,{two:c.default.ACTION.TOUCH_DOLLY_ROTATE})))}threeWorldMoveCamera(t,e,i=!1){t instanceof a.PerspectiveCamera?(this.controls3d.update(0),this.controls3d.moveTo(e.x,e.y,e.z,i),this.controls3d.update(0)):t instanceof a.OrthographicCamera&&(this.controls2d.update(0),this.controls2d.moveTo(e.x,e.y,e.z,i),this.controls2d.update(0))}zoomToDistance(t,e){return t/(e*this.zoomToDistanceRatio)*.95}distanceToZoom(t){return this.mapOptions.controlOption.zoom?Math.round(this.mapOptions.controlOption.zoom*this.initDollyDistance/t*.95):Math.round(100*this.initDollyDistance/t*.95)}getCurCamPos(){return this.controls.getPosition(new a.Vector3)}saveStartCamPos(t){"3D"===this.type&&(this.startCamPos=t.y),"2D"===this.type&&(this.startCamPos=t.z)}initCurCamPos(t){const e=this.controls.getTarget(new a.Vector3);"3D"===this.type&&(this.moveTo(e.x,t,e.z,!1),this.curCamPos=t),"2D"===this.type&&(this.moveTo(e.x,e.y,-t,!1),this.curCamPos=-t)}initTargetCamPos(t){"3D"===this.type&&(this.targetCamPos=t),"2D"===this.type&&(this.targetCamPos=-t)}initTargetCamRot(t,e){this.targetCamRot.azimuth=t,this.targetCamRot.polar=e}setCurCamPos(t){const e=this.controls.getTarget(new a.Vector3);"3D"===this.type&&this.moveTo(e.x,t,-t,!1),"2D"===this.type&&this.moveTo(e.x,e.y,t,!1),this.curCamPos=t}setCurCamRot(t,e){this.controls.rotateTo(t,e,!1),this.curCamRot.azimuth=t,this.curCamRot.polar=e}setVelocity(t){this.velocity=t}enableRotate(t,e){this.isCamRot=!0,this.setCurCamRot(this.controls.azimuthAngle,this.controls.polarAngle),this.initTargetCamRot(t,e)}enableFadeOut(){let t;const{store:e}=this,i=this.frustumSize*this.mapOptions.fadeDistanceRatio,n=e.getFloorChangeDirection();"down"===n&&(t=this.preprocessing.multiplyScaleCm(-i)),"up"===n&&(t=this.preprocessing.multiplyScaleCm(i)),t&&this.initTargetCamPos(t),this.saveStartCamPos(this.controls.getTarget(new a.Vector3)),this.setCurCamPos(this.startCamPos),this.isFadeOut=!0}enableFadeIn(){let t;const{store:e}=this,i=this.frustumSize*this.mapOptions.fadeDistanceRatio,n=e.getFloorChangeDirection();"down"===n&&(t=this.preprocessing.multiplyScaleCm(-i)),"up"===n&&(t=this.preprocessing.multiplyScaleCm(i)),t&&this.initCurCamPos(t),"3D"===this.type&&this.initTargetCamPos(0),"2D"===this.type&&this.initTargetCamPos(-this.startCamPos),this.isFadeIn=!0}isRotateEnd(){return this.targetCamRot.azimuth-.005<this.curCamRot.azimuth&&this.targetCamRot.azimuth+.005>this.curCamRot.azimuth&&this.targetCamRot.polar-.005<this.curCamRot.polar&&this.targetCamRot.polar+.005>this.curCamRot.polar}rotate(){if(this.isCamRot){const t=this.isNaviAnimationOn?this.rotateSpeedOnRouteSimulation:this.rotateSpeedOnChangeFloor;this.setCurCamRot(u.DabeeoUtils.easeOut(this.curCamRot.azimuth,this.targetCamRot.azimuth,t),u.DabeeoUtils.easeOut(this.curCamRot.polar,this.targetCamRot.polar,t)),this.isRotateEnd()&&(this.setCurCamRot(this.targetCamRot.azimuth,this.targetCamRot.polar),this.isCamRot=!1,this.isCameraAnimatingBeforeLastRotation?this.enableFadeOut():(this.isCameraAnimating=!1,this.eventDispatcher.dispatchFloorChangeAnimationEnd()))}}getAccel(){let t=this.accelAbs;const{store:e}=this,i=e.getFloorChangeDirection();return"3D"===this.type&&"up"===i&&(t*=-1),"2D"===this.type&&"down"===i&&(t*=-1),t}isFadeOutEnd(){return Math.abs(this.targetCamPos)<Math.abs(this.curCamPos)}fadeOut(){if(this.isFadeOut){const{curVal:t,velocity:e}=u.DabeeoUtils.easeIn(this.curCamPos,this.getAccel(),this.velocity);if(this.setCurCamPos(t),this.setVelocity(e),this.isFadeOutEnd()){this.setCurCamPos(this.targetCamPos),this.setVelocity(0),this.isFadeOut=!1;const{store:t}=this;t.setIsFloorChanged(!0),this.enableFadeIn()}}}isFadeInEnd(){return this.targetCamPos-.05<this.curCamPos&&this.targetCamPos+.05>this.curCamPos}fadeIn(){if(this.isFadeIn){const t=this.isNaviAnimationOn?this.fadeSpeedOnRouteSimulation:this.fadeSpeedOnChangeFloor;this.setCurCamPos(u.DabeeoUtils.easeOut(this.curCamPos,this.targetCamPos,t)),this.isFadeInEnd()&&(this.setCurCamPos(this.targetCamPos),this.setControlBoundary(),this.isCameraAnimatingBeforeLastRotation=!1,this.isFadeIn=!1,"3D"===this.type&&"number"==typeof this.mapOptions.controlOption.rotate&&"number"==typeof this.mapOptions.controlOption.tilt&&this.enableRotate(this.mapOptions.controlOption.rotate*a.MathUtils.DEG2RAD,this.mapOptions.controlOption.tilt*a.MathUtils.DEG2RAD))}}updateRTCameraZoom(t){let e=0;const i=this.rtCamera.right-this.rtCamera.left,n=this.rtCamera.top-this.rtCamera.bottom;e=Math.min(i/t.x,n/t.y),this.rtCamera.zoom=e,this.rtCamera.updateProjectionMatrix()}}},1097:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.GeoJson=void 0;const o=s(i(5232)),a=i(1367),l=s(i(140)),c=i(6163),h=i(9377);e.GeoJson=class{constructor(){this.geoMethods={Polygon:t=>this.getPolygonGeometry(t.coordinates),MultiPolygon:t=>this.getMultiPolyGeometry(t.coordinates),LineString:t=>this.getLineGeometry(t.coordinates,t.properties),MultiLineString:t=>this.getMultiLineGeometry(t.coordinates,t.properties),Point:t=>this.getPointsGeometry(t.coordinates),MultiPoint:t=>this.getPointsGeometry(t.coordinates)}}getJsonGeometry(t,e){return this.geoMethods[t](e)}getJsonMaterial(t,e,i){const n=(new o.TextureLoader).load(c.DEFAULT_ICON_URLS.pointTexture);switch(t){case"Polygon":case"MultiPolygon":return i?new o.MeshBasicMaterial({map:i,depthWrite:!1}):new o.MeshBasicMaterial({color:(null==e?void 0:e.color)||0,depthWrite:!1});case"LineString":case"MultiLineString":return new o.MeshBasicMaterial({color:new o.Color((null==e?void 0:e.color)||"#000000"),depthWrite:!1});case"Point":case"MultiPoint":return new o.PointsMaterial({size:e.size?e.size:100,sizeAttenuation:!1,alphaTest:.5,transparent:!0,color:e.color?e.color:"black",map:n});default:return console.error("Geo JSON Type Error!"),new o.MeshBasicMaterial({depthWrite:!1})}}async makeJsonData(t){try{const e=await fetch(t).then((t=>t.json()));return e.features.forEach((t=>{switch(t.geometry.type){case"Point":t.geometry.coordinates=[t.geometry.coordinates[0],-t.geometry.coordinates[1]];break;case"MultiPolygon":t.geometry.coordinates=this.multiPolygonConvert(t.geometry.coordinates);break;case"GeometryCollection":this.collectionConvert(t.geometry.geometries);break;default:t.geometry.coordinates=[...this.coordConvert(t.geometry.coordinates)]}})),e.features}catch(e){return console.error(`파일 ${t}을 가져오는 동안 network error가 발생하였습니다`),console.error(e),null}}convertToVector(t){return{x:t[0],y:t[1]}}getLineGeometry(t,e){const i=[];t.forEach((t=>{const e=this.convertToVector(t);i.push(new o.Vector3(e.x,e.y,0))}));const n={strokeColor:e.color||"#000000",strokeLineCap:h.SOLID_LINE_CAP_TYPE.BUTT,strokeLineJoin:h.SOLID_LINE_JOIN_TYPE.MITER,strokeMiterLimit:4,strokeWidth:e.lineWidth||1};return a.SVGLoader.pointsToStroke(i,n)}getMultiLineGeometry(t,e){const i=[];return t.forEach((t=>{i.push(this.getLineGeometry(t,e))})),l.mergeBufferGeometries(i)}getPolygonLine(t,e){e.forEach((e=>{const i=this.convertToVector(e.position);"M"===e.type?t.moveTo(i.x,i.y):t.lineTo(i.x,i.y)}))}getPolygonGeometry(t){const e=new o.ShapePath;let i=[];t.forEach((t=>{i=[...i,...t.map(((t,e)=>0===e?{type:"M",position:t}:{type:"L",position:t}))]})),this.getPolygonLine(e,i);const n=e.toShapes(!1);return new o.ShapeGeometry(n[0])}getMultiPolyGeometry(t){const e=[];return t.forEach((t=>{const i=this.getPolygonGeometry(t);e.push(i)})),l.mergeBufferGeometries(e)}getPointsGeometry(t){const e=[];"number"==typeof t[0]?(e.push(t[0]),e.push(t[1]),e.push(0)):t.forEach((t=>{e.push(t[0]),e.push(t[1]),e.push(0)}));const i=new o.BufferGeometry;return i.setAttribute("position",new o.Float32BufferAttribute(e,3)),i}coordConvert(t){return t.map((t=>{if(Array.isArray(t)){return t.map(((t,e)=>Array.isArray(t)?[t[0],-t[1]]:1===e?-t:t))}return t}))}collectionConvert(t){t.map((t=>{switch(t.type){case"Point":return Object.assign(Object.assign({},t),{coordinates:[t.coordinates[0],-t.coordinates[1]]});case"MultiPolygon":return Object.assign(Object.assign({},t),{coordinates:this.multiPolygonConvert(t.coordinates)});default:return Object.assign(Object.assign({},t),{coordinates:this.coordConvert(t.coordinates)})}}))}multiPolygonConvert(t){return t.map((t=>t.map((t=>t.map((t=>[t[0],-t[1]]))))))}}},7171:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0});const o=s(i(5232)),a=i(1764);e.default=class{constructor(t,e,i){this.renderSize={width:0,height:0},this.renderStartTime=0,this.renderFrames=0,this.container=i.getContainer(),this.scene=t,this.cameraController=e,this.debugScene=null,this.debugCamera=null,this.css2dRenderer=new a.CSS2DRenderer,this.css2dRenderer.domElement.className="css2dRenderer",this.css2dRenderer.domElement.style.position="absolute",this.container.appendChild(this.css2dRenderer.domElement),this.renderer=new o.WebGLRenderer({antialias:!0,alpha:!0,logarithmicDepthBuffer:!0}),this.renderer.autoClear=!1,this.renderer.setClearColor(0,0),this.renderer.sortObjects=!1,this.container.appendChild(this.renderer.domElement),this.store=i,this.store.setRenderer(this),this.renderDirty=!1,this.rendering=!1}getScale(){return this.scene.scale}setDebugSceneNCamera(t,e){this.debugScene=t,this.debugCamera=e}setSize(t){this.renderSize=t,this.renderer.setSize(t.width,t.height),this.css2dRenderer.setSize(t.width,t.height),this.renderer.setPixelRatio(window.devicePixelRatio)}getSize(){return this.renderSize}getImageData(){return this.imageData}render(){if(this.css2dRenderer.render(this.scene,this.cameraController.camera),this.renderDirty)this.renderFrames++,this.rendering=!0,this.renderDirty=!1,this.store.setRenderDirty(!1),this.renderer.clear(),this.renderer.render(this.scene,this.cameraController.camera),this.store.getCaptureRouteSimulationScreen()&&(this.store.setCaptureRouteSimulationScreen(!1),this.imageData=this.renderer.domElement.toDataURL("image/png")),this.debugScene&&this.debugCamera&&(this.renderer.clearDepth(),this.renderer.render(this.debugScene,this.debugCamera));else{this.rendering=!1;const t=(new Date).getTime()-this.renderStartTime;(this.renderFrames/(t/1e3)).toFixed(2)}}requestRender(t=!1){this.renderDirty=!0,t?this.render():this.rendering||(this.renderStartTime=(new Date).getTime(),this.renderFrames=0,this.render())}getSceneMaterial(){const t=[];return this.scene.traverse((e=>{e.isMesh&&e.material&&(Array.isArray(e.material)?e.material.forEach((e=>t.push(e))):t.push(e.material))})),t.length}renderToRenderTarget(t,e,i){this.renderer.autoClear=!0,this.renderer.setRenderTarget(t),this.renderer.render(e,i),this.renderer.setRenderTarget(null),this.renderer.autoClear=!1}initTexture(t){this.renderer.initTexture(t)}getCanvas(){return this.renderer.domElement}getRenderer(){return this.renderer}getCSS2DRendererDomElem(){return this.css2dRenderer.domElement}getCSS2DRenderer(){return this.css2dRenderer}getScene(){return this.scene}getConianer(){return this.container}}},4114:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.Scene=void 0;const o=s(i(5232)),a=i(2676);class l extends o.Scene{constructor(t){super(),this.children=[],this.background=t?new o.Color(t):null}setArrowHelper(t,e,i,n){t.normalize();const r=new o.ArrowHelper(t,e,i,n);return super.add(r),r}add(...t){for(let e=0;e<t.length;e++)super.add(t[e])}Update(){for(let t=0;t<this.children.length;t++)void 0!==this.children[t].Update&&this.children[t].Update()}cleanup(){this.children.filter((t=>t instanceof a.Group)).forEach((t=>{t.cleanup(),this.remove(t)}))}}e.Scene=l},1938:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0});const o=s(i(5232));e.default=class{constructor(t,e,i,n,r,s,a,l,c){var h;this.renderer=null,this.captureNow=!1,this.renderDirty=!0,this.renderRouteAnimation=!1,this.renderMyLocAnimation=!1,this.renderObjectAnimation=!1,this.renderNaviIconAnimation=!1,this.renderGifAnimation=!1,this.clock=new o.Clock,this.placed=!1,this.commit=!1,this.dirty=!0,this.canvasStacks=[],this.floorList=[],this.prevFloorIndex=null,this.floorChangeDirection="",this.nextFloorId="",this.isFloorChanged=!1,this.curIndoorMapFloorList=new Map,this.nextIndoorMapFloorIdList=new Map,this.isIndoorMapFloorChanged=!1,this.isSleepMode=!1,this.mapOptions=i,this.mapInfo=n,this.defaultFloor=r,this.floorList=s,this.svgObjectList=t,this.maxObjectVolume=a,this.maxSectionVolume=l,this.styleMap=e,this.center={x:n.getSize().width/2,y:n.getSize().height/2},this.loadingmanager=new o.LoadingManager,this.container=c,this.curFloorIndex=this.floorList.findIndex((t=>t.defaultYn)),this.allPoiData=(null===(h=this.defaultFloor)||void 0===h?void 0:h.pois)?[...this.defaultFloor.pois]:[],this.allSvgObjectData=this.svgObjectList?[...this.svgObjectList]:[],this.allSvgLoaderPoiData=[],this.allSvgLoaderObjectData=[],this.curMapId=n.getId()}updateMapViewModel(t,e,i,n,r,s,o,a){this.mapOptions=i,this.mapInfo=n,this.defaultFloor=r,this.floorList=s,this.svgObjectList=t,this.maxObjectVolume=o,this.maxSectionVolume=a,this.center={x:n.getSize().width/2,y:n.getSize().height/2}}getSvgObjectList(){return this.svgObjectList}getRenderDirty(){return this.renderDirty}getRenderRouteAnimation(){return this.renderRouteAnimation}getRenderMyLocAnimation(){return this.renderMyLocAnimation}getRenderNaviIconAnimation(){return this.renderNaviIconAnimation}setRenderNaviIconAnimation(t){this.renderNaviIconAnimation=t}getRenderObjectAnimation(){return this.renderObjectAnimation}getRenderGifAnimation(){return this.renderGifAnimation}getDirty(){return this.dirty}getPlaced(){return this.placed}getCommit(){return this.commit}getClock(){return this.clock}getMapInfo(){return this.mapInfo}setRenderer(t){this.renderer=t}getRenderer(){return this.renderer}setCaptureRouteSimulationScreen(t){this.captureNow=t,this.setRenderDirty(!0)}getCaptureRouteSimulationScreen(){return this.captureNow}getDefaultFloor(){let t;return this.mapInfo.getId()!==this.curMapId&&(t=this.getCurIndoorMapFloorByMapId(this.curMapId)),t||(t=this.defaultFloor),t}getDefaultFloorId(){let t;return this.mapInfo.getId()!==this.curMapId&&(t=this.getCurIndoorMapFloorByMapId(this.curMapId)),t||(t=this.defaultFloor),null==t?void 0:t.id}getMaxObjZ(){return this.maxObjectVolume}getCanvasStacks(){return this.canvasStacks}getFloorChangeDirection(){return this.floorChangeDirection}getCurFloorIndex(){return this.curFloorIndex}getFloorIndex(t){return this.floorList.findIndex((e=>e.id===t))}getPrevFloorIndex(){return this.prevFloorIndex}getNextFloorId(){return this.nextFloorId}getIsFloorChanged(){return this.isFloorChanged}getContainer(){return this.container}getStyleMap(){return this.styleMap}getMapOptions(){return this.mapOptions}getCenter(){return this.center}getLoadingManager(){return this.loadingmanager}getCurRouteSimulationGroup(){return this.curRouteSimulationGroup}getCurPoiGroup(){return this.curPoiGroup}getCurObjectGroup(){return this.curObjectGroup}findPoiById(t){var e;const i=null===(e=this.curPoiGroup)||void 0===e?void 0:e.children.find((e=>e.userData.id===t));return i||null}getPoiUserDataList(){return this.poiUserDataList}getObjectUserDataList(){return this.objectUserDataList}getCurIndoorMapFloorByMapId(t){return this.curIndoorMapFloorList.get(t)}getNextIndoorMapFloorIdByMapId(t){return this.nextIndoorMapFloorIdList.get(t)}getIsIndoorMapFloorChanged(){return this.isIndoorMapFloorChanged}getCurMapId(){return this.curMapId}getIsDefaultMapNow(){let t=!1;return this.getCurMapId()===this.mapInfo.getId()&&(t=!0),t}getAllPoiData(){return this.allPoiData}getAllSvgLoaderPoiData(){return this.allSvgLoaderPoiData}getAllSvgObjectData(){return this.allSvgObjectData}getAllSvgLoaderObjectData(){return this.allSvgLoaderObjectData}getIsSleepMode(){return this.isSleepMode}setRenderRouteAnimation(t){this.renderRouteAnimation=t}setRenderDirty(t){this.renderDirty=t}setRenderMyLocAnimation(t){this.renderMyLocAnimation=t}setRenderObjectAnimation(t){this.renderObjectAnimation=t}setRenderGifAnimation(t){this.renderGifAnimation=t}setDirty(t){this.dirty=t}setPlaced(t){this.placed=t}setDirtyIfNotCommit(){this.commit||(this.setDirty(!0),this.getClock().start(),this.setPlaced(!1))}setCommit(t){this.commit=t}pushCanvasStacks(t){this.canvasStacks.push(t)}setFloorChangeDirection(t){this.floorChangeDirection=t}setPrevFloorIndex(){this.prevFloorIndex=this.curFloorIndex}setCurFloorIndex(t){const e=this.floorList.findIndex((e=>e.id===t));if(-1===e)throw console.error(`요청한 층 ${t} 은 존재하지 않습니다.`),new Error("wrong request from client");this.curFloorIndex=e}setNextFloorId(t){this.nextFloorId=t}setIsFloorChanged(t){this.isFloorChanged=t}addFloorDataToMapData(t){this.mapInfo.addFloors(t)}setCurRouteSimulationGroup(t){this.curRouteSimulationGroup=t}setCurPoiGroup(t){this.curPoiGroup=t}setCurObjectGroup(t){this.curObjectGroup=t}setCurIndoorMapFloorByMapId(t,e){this.curIndoorMapFloorList.set(t,e)}setNextIndoorMapFloorIdByMapId(t,e){this.nextIndoorMapFloorIdList.set(t,e)}setIsIndoorMapFloorChanged(t){this.isIndoorMapFloorChanged=t}setCurMapId(t){this.curMapId=t}setIsSleepMode(t){this.isSleepMode=t}addToAllPoiData(t){this.allPoiData=this.allPoiData.concat(t)}addToAllSvgLoaderPoiData(t){this.allSvgLoaderPoiData=this.allSvgLoaderPoiData.concat(t)}addToAllSvgObjectData(t){this.allSvgObjectData=this.allSvgObjectData.concat(t)}addToAllSvgLoaderObjectData(t){this.allSvgLoaderObjectData=this.allSvgLoaderObjectData.concat(t)}removeFromAllPoiData(t){this.allPoiData=this.allPoiData.filter((e=>e.mapId!==t))}removeFromAllSvgLoaderPoiData(t){this.allSvgLoaderPoiData=this.allSvgLoaderPoiData.filter((e=>e.mapId!==t))}removeFromAllObjectData(t){this.allSvgObjectData=this.allSvgObjectData.filter((e=>e.getMapId()!==t))}removeFromAllSvgLoaderObjectData(t){this.allSvgLoaderObjectData=this.allSvgLoaderObjectData.filter((e=>e.mapId!==t))}updatePoiUserDataList(){var t;this.poiUserDataList=null===(t=this.curPoiGroup)||void 0===t?void 0:t.children.map((t=>t.userData))}updateObjectUserDataList(){var t;this.objectUserDataList=null===(t=this.curObjectGroup)||void 0===t?void 0:t.children.filter((t=>"MergedMesh"!==t.name)).map((t=>t.children[0].userData))}}},606:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DataFloor=void 0;e.DataFloor=class{constructor(){this.floors=[]}init(t){t.getFloors().forEach((t=>{this.floors.push({id:t.id,name:t.name,defaultYn:t.defaultYn})}))}getFloors(){return this.floors}getDefaultFloor(){return this.floors.find((t=>t.defaultYn))}find(t){let e=[...this.floors];if(t.title&&void 0!==t.title&&""!==t.title){const i=t.title.toUpperCase(),n=[];e.forEach((t=>{t.name.find((t=>t.text.toUpperCase().includes(i)))&&n.push(t)})),e=[...n]}if(t.id){const i=e.find((e=>e.id===t.id));e=i}return Array.isArray(e)&&0===e.length&&(e=void 0),e}}},861:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DataGroupCode=void 0;e.DataGroupCode=class{constructor(t){this.networkClient=t,this.codes=[]}async init(){const t=await this.networkClient.getGroupCode();this.codes=t}getCodes(){return this.codes}findChild(t,e){const i=e||this.codes;if(0!==i.length)for(let e=0;e<i.length;e++){const n=i[e];if(n.code===t)return n.child.map((t=>t.code));const r=this.findChild(t,n.child);if(r)return r}}findAllChild(t,e){const i=e||this.codes,n=this.findChild(t,i);if(n&&"object"==typeof n){let t=[...n];return n.length>0&&n.forEach((e=>{const n=this.findAllChild(e,i);n&&"object"==typeof n&&(t=[...t,...n])})),t}}findParent(t,e,i){const n=i||this.codes,r=e||"root";if(0!==n.length)for(let e=0;e<n.length;e++){const i=n[e];if(i.code===t)return r.code?r.code:"root";const s=this.findParent(t,i,i.child);if(s)return s}}findRootParentCode(t,e,i){if(0===e.length)return!1;for(let n=0;n<e.length;n++){const r=e[n];if(r.code===i)return t.code;const s=this.findRootParentCode(t,r.child,i);if(s)return s}return!1}findRootParent(t){var e;let i;return 0===this.codes.length?"":(null===(e=this.codes)||void 0===e||e.forEach((e=>{e.code===t&&(i=e.code);const n=this.findRootParentCode(e,e.child,t);n&&(i=n)})),i)}findAllRoot(){const t=[];return this.codes.forEach((e=>{t.push(e.code)})),t}findAll(){const t=[];return this.findAllSub(this.codes,t),t}findAllSub(t,e){t.forEach((t=>{e.push(t.code),t.child.length>0&&this.findAllSub(t.child,e)}))}}},8900:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DataLanguage=void 0;e.DataLanguage=class{constructor(){this.language=[]}init(t){this.language=t.getLanguageSets()}getLanguage(){return this.language}getDefaultLanguage(){return this.language.find((t=>t.defaultYn))}find(t){return this.language.find((e=>e.lang===t))}}},304:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DataMapInfo=void 0;e.DataMapInfo=class{constructor(t){t&&(this.network=t),this.mapInfo=null}async init(){var t;this.mapInfo=await(null===(t=this.network)||void 0===t?void 0:t.getMapInfo())||null}setMapInfo(t){this.mapInfo=t}getMapInfo(){if(!this.mapInfo)throw new Error("MapInfo is not available");return this.mapInfo}getThemes(){if(!this.mapInfo)throw new Error("MapInfo is not available");return this.mapInfo.themes}getSize(){if(!this.mapInfo)throw new Error("MapInfo is not available");return this.mapInfo.size}getLanguageSets(){if(!this.mapInfo)throw new Error("MapInfo is not available");return this.mapInfo.languageSets}getNorthReference(){if(!this.mapInfo)throw new Error("MapInfo is not available");return this.mapInfo.northReference}getId(){if(!this.mapInfo)throw new Error("MapInfo is not available");return this.mapInfo.id}getDefaultFloorId(){if(!this.mapInfo)throw new Error("MapInfo is not available");return this.mapInfo.defaultFloorId}getFloors(){if(!this.mapInfo)throw new Error("MapInfo is not available");return this.mapInfo.floors}getScaleCm(){if(!this.mapInfo)throw new Error("MapInfo is not available");return this.mapInfo.scaleCm}getGeoreferencingNorth(){if(!this.mapInfo)throw new Error("MapInfo is not available");return this.mapInfo.georeferencingNorth}getGeoreferencingWest(){if(!this.mapInfo)throw new Error("MapInfo is not available");return this.mapInfo.georeferencingWest}setFloors(t){if(!this.mapInfo)throw new Error("MapInfo is not available");this.mapInfo.floors=t}addFloors(t){if(!this.mapInfo)throw new Error("MapInfo is not available");this.mapInfo.floors.push(t)}getAddress(){if(!this.mapInfo)throw new Error("MapInfo is not available");return this.mapInfo.address}}},2624:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DataNode=void 0;const n=i(6486),r=i(6509),s=i(6731),o=i(6202);e.DataNode=class{constructor(t,e){this.dataPoi=t,this.dataFloor=e}convertRoutePosition(t){return t.position&&(t.position=o.DabeeoUtils.changeVectorMinus(t.position)),t}getTransCode(t){let e=s.TRANSPORTATION_RESULT_TYPE.WALK;switch(t){case"OB-STAIRS":e=s.TRANSPORTATION_RESULT_TYPE.STAIRS;break;case"OB-ELEVATOR":e=s.TRANSPORTATION_RESULT_TYPE.ELEVATOR;break;case"OB-ESCALATOR":e=s.TRANSPORTATION_RESULT_TYPE.ESCALATOR_BOTH;break;case"OB-ESCALATOR_UP":e=s.TRANSPORTATION_RESULT_TYPE.ESCALATOR_UP;break;case"OB-ESCALATOR_DOWN":e=s.TRANSPORTATION_RESULT_TYPE.ESCALAOR_DOWN;break;default:e=s.TRANSPORTATION_RESULT_TYPE.WALK}return e}getTransDirectionCode(t){let e=s.DIRECTION_TYPE.NONE;switch(t){case"STRAIGHT":e=s.DIRECTION_TYPE.STRAIGHT;break;case"LEFT":e=s.DIRECTION_TYPE.LEFT;break;case"RIGHT":e=s.DIRECTION_TYPE.RIGHT;break;case"UTURN":e=s.DIRECTION_TYPE.UTURN;break;default:e=s.DIRECTION_TYPE.NONE}return e}getMeterDistance(t){let e;return"object"==typeof t&&(e=void 0),"number"==typeof t&&(t/=100,e=Math.floor(100*t)/100),e}addNavigationList(t){const e=[];for(let i=0;i<t.length;i++)e.push({poi:t[i].poi,floorId:t[i].floorId,position:t[i].position,distance:this.getMeterDistance(t[i].distance),transportation:this.getTransCode(t[i].transCode),direction:this.getTransDirectionCode(t[i].direction),move:t[i].move});return e}getNavigation(t){let e=[];const i=[],r=[];if(null==t?void 0:t.pathInfo){null==t||t.pathInfo,e=(0,n.cloneDeep)(t.pathInfo);const s=t=>this.dataPoi.getPois().find((e=>{if(t.poiId)return t.floorId===e.floorId&&t.poiId===e.id;const i=o.DabeeoUtils.changeVector2Minus(t.position);return t.floorId===e.floorId&&i.x===e.position.x&&i.y===e.position.y}));e.forEach(((t,e)=>{i[e]=s(t)})),e.forEach(((t,e)=>{t.destination?r.push({poi:i[e],floorId:t.floorId,isDestination:t.destination,distance:t.distance,direction:t.direction,position:t.position,move:async n=>{var r,s;const o=i[e]?i[e].floorId:t.floorId,{x:a,y:l}=i[e]?i[e].position:{x:null===(r=t.position)||void 0===r?void 0:r.x,y:null===(s=t.position)||void 0===s?void 0:s.y};await n.context.changeFloor(o),n.control.moveTo({position:{x:a,y:l}})}}):r.push({poi:i[e],floorId:t.floorId,transCode:t.transCode,isDestination:t.destination,distance:t.distance,direction:t.direction,position:t.position,move:async e=>{await e.context.changeFloor(t.floorId),e.control.moveTo({position:{x:t.position.x,y:t.position.y}})}})}))}return this.addNavigationList(r)}async getCategoryDistance(t,e,i){let n=this.dataPoi.find({categoryCode:e});if(!n)return console.error("지정한 카테고리에 해당하는 poi가 존재하지 않습니다."),[];Array.isArray(n)||(n=[n]);const r=[t,...n.map((t=>({poiId:t.id,floorId:t.floorId})))],s=await(null==i?void 0:i.getRouteDistance(r));if(!s)return[];const o=[];return s.forEach((t=>{if(!t.finalDestination.poiId)return;const e=this.dataPoi.find({id:t.finalDestination.poiId});e&&!Array.isArray(e)&&o.push({poi:e,totalDistance:t.totalDistance})})),o.sort(((t,e)=>t.totalDistance-e.totalDistance))}async getRoute(t,e,i){const{origin:n,destination:s}=t,o=(t.type?t.type:[r.TRANSPORTATION_REQUEST_TYPE.RECOMMENDATION]).map((t=>t.toUpperCase())),a=t.waypoints?t.waypoints:[],l=[n,...a,s],c={};try{const t=await(null==e?void 0:e.getRoute(l,o,i));if(!t)return{};return Object.keys(t).forEach((e=>{var i;const r=t[e];if(0===r.pathInfo.length)return;let s=r.simplifiedLocationList.map((t=>this.convertRoutePosition(t)));const o=r.pathInfo.map((t=>t)),a=r.wayPoints.map((t=>this.convertRoutePosition(t))),l=[];s.forEach((t=>{l.includes(t.floorId)||l.push(t.floorId)})),n.position&&(s=this.getFixedLocations(s,n.position));const h={wayPoints:a,locations:s,pathInfo:o,totalDistance:r.totalDistance,totalTime:r.totalTime,originFloorId:r.origin.floorId,destFloorId:null===(i=r.finalDestination)||void 0===i?void 0:i.floorId,floorIdList:l};h.navigationList=this.getNavigation(h),c[e]=h})),c}catch(t){return{}}}getFixedLocations(t,e){const i=(0,n.cloneDeep)(t),r=t[0].position?(0,n.cloneDeep)(t[0].position):null,s=t[1].position?(0,n.cloneDeep)(t[1].position):null,a=Object.assign(Object.assign({},o.DabeeoUtils.changeVector2Minus((0,n.cloneDeep)(e))),{z:0});let l=null;if(r&&s&&(l=this.getNearestPointToLink(a,r,s)),l){i[0].position=l;const t=(0,n.cloneDeep)(i[0]);t.position=a,i.unshift(t)}return i}getNearestPointToLink(t,e,i){if(!i)return e;const n=i.x-e.x,r=i.y-e.y,s=t.x-e.x,a=t.y-e.y,l=n*n+r*r;if(0===l)return e;const c=(s*n+a*r)/l;if(c>=0&&c<=1){return{x:e.x+c*n,y:e.y+c*r,z:0}}return o.DabeeoUtils.getDistance(t,e)<o.DabeeoUtils.getDistance(t,i)?e:i}}},7194:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DataObject=void 0;const n=i(6202);e.DataObject=class{constructor(t){this.floorData=t}getObjects(t){return this.floorData.getObjects(t)}getNodes(){return this.floorData.getNodes()}find(t){return this.floorData.find(t)}getObjectsCenter(t){const e=[];let i={x:0,y:0,z:0};return t.forEach((t=>{const i=this.find({id:t});i&&!Array.isArray(i)&&e.push({x:i.position.x,y:i.position.y})})),0===e.length?console.error("Object not found!"):(1===e.length&&(i={x:e[0].x,y:e[0].y,z:0}),2===e.length&&(i=n.DabeeoUtils.getMidPoint(e)),e.length>2&&(i=n.DabeeoUtils.getCentroid(e)),i)}}},7310:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DataPoi=void 0;e.DataPoi=class{constructor(t){this.network=t,this.pois=[]}async init(){this.pois=await this.network.getPois()}getPois(){return this.pois}find(t){this.pois;let e=[...this.pois];if(t.title&&""!==t.title){const i=t.title.toUpperCase();e=[...e.filter((t=>t.title.toUpperCase().includes(i)))]}if(t.floorId){const i=t.floorId.toUpperCase();e=[...e.filter((t=>t.floorId.toUpperCase()===i))]}if(t.groupCode){const i=t.groupCode.toUpperCase();e=[...e.filter((t=>{var e;return(null===(e=t.layerGroupCode)||void 0===e?void 0:e.toUpperCase())===i}))]}if(t.categoryCode){const i=t.categoryCode.toUpperCase();e=[...e.filter((t=>{var e;return(null===(e=t.categoryCode)||void 0===e?void 0:e.toUpperCase())===i}))]}if(t.id){const i=t.id.toUpperCase();e=e.find((t=>t.id.toUpperCase()===i))}return Array.isArray(e)&&0===e.length&&(e=void 0),e}}},838:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FloorData=void 0;const n=i(6486);e.FloorData=class{constructor(t){this.networkClient=t,this.floorData=[],this.convertFloorData=[]}getObjects(t){if(t){const e=this.floorData.find((e=>e.id===t));return e?e.objects:(console.error(`요청한 층 ${t}에 대하여 저장된 object가 없습니다. getFloorData() 먼저 호출하세요.`),[])}let e=[];return this.floorData.forEach((t=>{e=[...e,...t.objects]})),e}getNodes(){let t=[];return this.floorData.forEach((e=>{t=[...t,...e.nodes]})),t}find(t){let e=[];if(this.floorData.forEach((t=>{const i=t.objects.map((e=>Object.assign(Object.assign({},e),{floorId:t.id})));e=[...e,...i]})),t.title){const i=t.title.toUpperCase();e=[...e.filter((t=>t.title.toUpperCase().includes(i)))]}if(t.groupCode){const i=t.groupCode.toUpperCase();e=[...e.filter((t=>{var e;return(null===(e=t.layerGroupCode)||void 0===e?void 0:e.toUpperCase())===i}))]}if(t.floorId){const i=t.floorId.toUpperCase();e=[...e.filter((t=>{var e;return(null===(e=t.floorId)||void 0===e?void 0:e.toUpperCase())===i}))]}if(t.id){const i=t.id.toUpperCase();e=e.find((t=>t.id.toUpperCase()===i))}return Array.isArray(e)&&0===e.length&&(e=void 0),e}async getFloorData(t){const e=this.floorData.find((e=>e.id===t));if(e)return e;const i=await this.networkClient.getFloorData(t);return i?(Array.isArray(i)?i.forEach((t=>{this.saveFloorData(t,!1)})):await this.saveFloorData(i,!1),i):null}getConvertFloorDataAll(){return this.convertFloorData}async getConvertFloorData(t){const e=this.floorData.find((e=>e.id===t));if(e)return e;const i=await this.networkClient.getFloorData(t);if(i){if(Array.isArray(i)){const t=[];return i.forEach((e=>{this.saveFloorDataArray(t,e)})),t}return this.saveFloorData(i,!0)}return null}saveFloorDataArray(t,e){t.push(this.changeFloorMinus((0,n.cloneDeep)(e))),this.floorData.push(e),this.convertFloorData.push(t)}saveFloorData(t,e=!1){const i=this.changeFloorMinus((0,n.cloneDeep)(t));return this.floorData.push(t),this.convertFloorData.push(i),e?i:null}getSavedFloorData(t){return this.convertFloorData.find((e=>e.id===t))}changeFloorMinus(t){return this.changeYPosToMinus(t.nodes),this.changeYPosToMinus(t.objects),this.changeYPosToMinus(t.pois),this.changeYPosToMinus(t.sections),this.changeYCoordToMinus(t.nodes),this.changeYCoordToMinus(t.objects),this.changeYCoordToMinus(t.sections),t}changeYPosToMinus(t){t.forEach((t=>{t.position.y=-t.position.y}))}changeYCoordToMinus(t){t.forEach((t=>{t.coordinates.forEach((t=>{t.y=-t.y}))}))}}},5380:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(6486),r=i(2626);e.default=class{constructor(t){this.container=t}dispatchPoiClick(t){var e;let i;if(t){i=(0,n.cloneDeep)(t).map((t=>this.changeYPosToMinus(t)))}else i=null;null===(e=this.container)||void 0===e||e.dispatchEvent(new CustomEvent(r.EVENT_TYPE.POI_CLICK,{detail:i}))}dispatchPoiHover(t){var e;let i;if(t){i=(0,n.cloneDeep)(t).map((t=>this.changeYPosToMinus(t)))}else i=null;null===(e=this.container)||void 0===e||e.dispatchEvent(new CustomEvent(r.EVENT_TYPE.POI_MOUSE_OVER,{detail:i}))}dispatchPoiMouseEnter(t){var e;const i=(0,n.cloneDeep)(t),s=this.changeYPosToMinus(i);null===(e=this.container)||void 0===e||e.dispatchEvent(new CustomEvent(r.EVENT_TYPE.POI_MOUSE_ENTER,{detail:s}))}dispatchPoiMouseLeave(t){var e;const i=(0,n.cloneDeep)(t),s=this.changeYPosToMinus(i);null===(e=this.container)||void 0===e||e.dispatchEvent(new CustomEvent(r.EVENT_TYPE.POI_MOUSE_LEAVE,{detail:s}))}changeYPosToMinus(t){const e=t;return e.position.y*=-1,Array.isArray(e.poiDataArr)&&e.poiDataArr.forEach((t=>{t.position.y&&(t.position.y*=-1)})),e}dispatchVoidClick(t){var e;null===(e=this.container)||void 0===e||e.dispatchEvent(new CustomEvent(r.EVENT_TYPE.VOID_CLICK,{detail:t}))}dispatchObjectClick(t){var e;let i;if(t){i=(0,n.cloneDeep)(t).map((t=>this.changeYPosToMinus(t)))}else i=null;null===(e=this.container)||void 0===e||e.dispatchEvent(new CustomEvent(r.EVENT_TYPE.OBJECT_CLICK,{detail:i}))}dispatchMarkerClick(t){var e;null===(e=this.container)||void 0===e||e.dispatchEvent(new CustomEvent(r.EVENT_TYPE.MARKER_CLICK,{detail:t}))}dispatchFloorChange(t){var e;null===(e=this.container)||void 0===e||e.dispatchEvent(new CustomEvent(r.EVENT_TYPE.FLOOR_CHANGED,{detail:t}))}dispatchFloorChanging(t,e,i){var n;null===(n=this.container)||void 0===n||n.dispatchEvent(new CustomEvent(r.EVENT_TYPE.FLOOR_CHANGING,{detail:{floor:{current:t,next:e},transCode:i}}))}dispatchFloorChangeAnimationEnd(){var t;null===(t=this.container)||void 0===t||t.dispatchEvent(new CustomEvent(r.EVENT_TYPE.FLOOR_CHANGE_ANIMATION_END,{detail:"floor-change-animation-end"}))}dispatchNaviComplete(){var t;null===(t=this.container)||void 0===t||t.dispatchEvent(new CustomEvent(r.EVENT_TYPE.NAVI_COMPLETE,{detail:"OK"}))}dispatchRenderComplete(t){var e;null===(e=this.container)||void 0===e||e.dispatchEvent(new CustomEvent(r.EVENT_TYPE.RENDER_COMPLETE,{detail:t}))}dispatchZoomPossible(t,e){var i;null===(i=this.container)||void 0===i||i.dispatchEvent(new CustomEvent(r.EVENT_TYPE.ZOOM_POSSIBLE,{detail:{zoomInPossible:t,zoomOutPossible:e}}))}dispatchCameraZoomChanged(t){var e;null===(e=this.container)||void 0===e||e.dispatchEvent(new CustomEvent(r.EVENT_TYPE.ZOOM_CHANGED,{detail:t}))}dispatchCameraTiltChanged(t){var e;null===(e=this.container)||void 0===e||e.dispatchEvent(new CustomEvent(r.EVENT_TYPE.TILT_CHANGED,{detail:t}))}dispatchCameraRotationChanged(t){var e;null===(e=this.container)||void 0===e||e.dispatchEvent(new CustomEvent(r.EVENT_TYPE.ROTATION_CHANGED,{detail:t}))}dispatchCameraControlStart(){var t;null===(t=this.container)||void 0===t||t.dispatchEvent(new CustomEvent(r.EVENT_TYPE.CONTROL_START,{detail:"control start"}))}dispatchCameraControlEnd(){var t;null===(t=this.container)||void 0===t||t.dispatchEvent(new CustomEvent(r.EVENT_TYPE.CONTROL_END,{detail:"control end"}))}dispatchCameraZoomEnd(t){var e;null===(e=this.container)||void 0===e||e.dispatchEvent(new CustomEvent(r.EVENT_TYPE.ZOOM_END,{detail:t}))}dispatchMouseClick(t){var e;null===(e=this.container)||void 0===e||e.dispatchEvent(new CustomEvent(r.EVENT_TYPE.ON_MOUSE_CLICK,{detail:t}))}dispatchMouseMove(t){var e;null===(e=this.container)||void 0===e||e.dispatchEvent(new CustomEvent(r.EVENT_TYPE.ON_MOUSE_MOVE,{detail:t}))}dispatchMouseHoverObject(t){var e;null===(e=this.container)||void 0===e||e.dispatchEvent(new CustomEvent(r.EVENT_TYPE.OBJECT_MOUSE_OVER,{detail:t}))}dispatchObjectMouseEnter(t){var e;null===(e=this.container)||void 0===e||e.dispatchEvent(new CustomEvent(r.EVENT_TYPE.OBEJECT_MOUSE_ENTER,{detail:t}))}dispatchObjectMouseLeave(t){var e;null===(e=this.container)||void 0===e||e.dispatchEvent(new CustomEvent(r.EVENT_TYPE.OBJECT_MOUSE_LEAVE,{detail:t}))}dispatchDragStart(t){var e;null===(e=this.container)||void 0===e||e.dispatchEvent(new CustomEvent(r.EVENT_TYPE.DRAG_START,{detail:t}))}dispatchDragMove(t){var e;null===(e=this.container)||void 0===e||e.dispatchEvent(new CustomEvent(r.EVENT_TYPE.DRAG_MOVE,{detail:t}))}dispatchDragEnd(t){var e;null===(e=this.container)||void 0===e||e.dispatchEvent(new CustomEvent(r.EVENT_TYPE.DRAG_END,{detail:t}))}dispatchTrackingComplete(){var t;null===(t=this.container)||void 0===t||t.dispatchEvent(new CustomEvent(r.EVENT_TYPE.TRACKING_COMPLETE,{detail:"tracking-complete"}))}dispatchTrackingMove(t){var e;null===(e=this.container)||void 0===e||e.dispatchEvent(new CustomEvent(r.EVENT_TYPE.TRACKING_MOVE,{detail:t}))}dispatchMylocationMapOut(){var t;null===(t=this.container)||void 0===t||t.dispatchEvent(new CustomEvent(r.EVENT_TYPE.MYLOCATION_MAP_OUT,{detail:"mylocation-map-out"}))}dispatchMylocationMapIn(){var t;null===(t=this.container)||void 0===t||t.dispatchEvent(new CustomEvent(r.EVENT_TYPE.MYLOCATION_MAP_IN,{detail:"mylocation-map-in"}))}dispatchModelLoadComplete(){var t;null===(t=this.container)||void 0===t||t.dispatchEvent(new CustomEvent(r.EVENT_TYPE.MODEL_LOAD_COMPLETE,{detail:"model-load-complete"}))}}},1288:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0});const o=s(i(5232)),a=i(3970),l=i(6202);e.default=class{constructor(t,e,i,n,r,s){this.touchStartCallback=t=>{t.preventDefault(),this.painter.setSleepMode(!1),this.painter.updateLastUserActionFrameNumber(),this.onDown(t);const e=t.changedTouches[0];this.touchStartCoords=e,this.touchStartPt={x:e.clientX,y:e.clientY},this.isTwoTouch+=1,this.isTouchStart=!0,this.isTouchMove=!1},this.touchMoveCallback=t=>{t.preventDefault(),this.painter.updateLastUserActionFrameNumber();const e=this.getUserMapCoordFromEvent(t);this.onMove(e),this.isTouchStart&&(this.isTouchMove=!0)},this.touchEndCallback=t=>e=>{e.preventDefault(),this.isTwoTouch-=1,this.painter.updateLastUserActionFrameNumber();const i=this.getUserMapCoordFromEvent(e);if(this.onUp(e,i),!this.touchStartPt)return;if(!this.touchStartPt.x||!this.touchStartPt.y)return;let n=this.touchStartPt.x-e.changedTouches[0].clientX,r=this.touchStartPt.y-e.changedTouches[0].clientY;if(n*=Math.sign(n),r*=Math.sign(r),n>this.store.getMapOptions().dragDistance||r>this.store.getMapOptions().dragDistance)this.initTouchFlag();else if(this.isTwoTouch>0)this.isTwoTouch;else if(this.isTouchStart&&n<this.store.getMapOptions().dragDistance&&r<this.store.getMapOptions().dragDistance&&t){this.isTwoTouch;const i=this.cameraController.getCamera();t.setFromCamera(this.getEventCoords(e),i),this.makeArrowHelper();const n=t.intersectObjects(this.scene.children,!0);this.getSelectPois(n),this.getSelectObjects(n,"OB"),this.getSelectMarker(n),this.isTouchNotMove=!0,this.initTouchFlag()}},this.onMouseUp=t=>{t.preventDefault(),this.painter.updateLastUserActionFrameNumber();const e=this.getUserMapCoordFromEvent(t);if(this.onUp(t,e),this.isClick()){const i=this.getIntersections(t);this.makeArrowHelper();const n=this.findSelectedItemType(i[0]);this.getVoidSpace(i,e),"poi"===n&&this.getSelectPois(i),"marker"===n&&this.getSelectMarker(i),"object"===n&&this.getSelectObjects(i,"OB"),this.eventDispatcher.dispatchMouseClick(e)}},this.onMouseMove=t=>{t.preventDefault();const e=this.getUserMapCoordFromEvent(t);this.onMove(e),this.eventDispatcher.dispatchMouseMove(e);const i=this.getIntersections(t);this.painter.updateLastUserActionFrameNumber(),this.painter.setSleepMode(!1),this.onObjectHover(i),this.onPoiHover(i)},this.onMouseDown=t=>{this.painter.updateLastUserActionFrameNumber(),this.painter.setSleepMode(!1),t.preventDefault(),this.onDown(t)},this.getHoverObjUserDataList=t=>{const e=[];return[...t.sort(((t,e)=>t.distance-e.distance))].forEach((t=>{var i;"OB"===(null===(i=null==t?void 0:t.object.userData.type)||void 0===i?void 0:i.slice(0,2))&&e.push(t.object.userData)})),e},this.getHoverPoiUserDataList=t=>this.selectPois(t),this.store=t,this.container=t.getContainer(),this.painter=e,this.rendererClass=e.getRendererClass(),this.scene=i,this.preprocessing=n,this.cameraController=r,this.eventDispatcher=s,this.raycaster=new a.Raycaster,this.setTouchEndCallback=null,this.touchStartCoords=null,this.touchStartPt=null,this.isTouchStart=!1,this.isTwoTouch=0,this.isTouchMove=!1,this.isTouchNotMove=!0,this.isDown=!1,this.isDragStartChecked=!1,this.dragStartData={time:void 0,coord:{x:void 0,y:void 0}},this.dragMoveData={time:void 0,coord:{x:void 0,y:void 0}},this.dragEndData={time:void 0,coord:{x:void 0,y:void 0}}}setCanvasEvent(){this.removeAllEvent(),this.addTouchEvent(),this.addMouseEvent()}addTouchEvent(){this.addTouchStartEvent(),this.addTouchMoveEvent(),this.addTouchEndEvent()}addTouchStartEvent(){const t=this.rendererClass.getCSS2DRendererDomElem();null==t||t.addEventListener("touchstart",this.touchStartCallback,!1)}addTouchMoveEvent(){const t=this.rendererClass.getCSS2DRendererDomElem();null==t||t.addEventListener("touchmove",this.touchMoveCallback,!1)}addTouchEndEvent(){this.setTouchEndCallback=this.touchEndCallback(this.raycaster);const t=this.rendererClass.getCSS2DRendererDomElem();null==t||t.addEventListener("touchend",this.setTouchEndCallback.bind(this),!1)}getEventCoords(t){const e=new o.Vector2,i=this.rendererClass.getCSS2DRendererDomElem().getBoundingClientRect(),n=t instanceof MouseEvent?t.clientX:t.changedTouches[0].clientX,r=t instanceof MouseEvent?t.clientY:t.changedTouches[0].clientY;if(l.DabeeoUtils.isMobile())e.x=(n-i.left)/i.width*2-1,e.y=-(r-i.top)/i.height*2+1;else{const t=this.rendererClass.getRenderer();e.x=(n-i.left)*window.devicePixelRatio/t.domElement.width*2-1,e.y=-(r-i.top)*window.devicePixelRatio/t.domElement.height*2+1}return e}getVoidSpace(t,e){let i=!1;t.length>0&&t.forEach((t=>{var e,n;"SC"!==(null===(n=null===(e=t.object.userData)||void 0===e?void 0:e.id)||void 0===n?void 0:n.slice(0,2))&&(i=!0),"overlay"===t.object.userData.type&&(i=!1)})),i&&0!==t.length||this.eventDispatcher.dispatchVoidClick(e)}selectPois(t){var e;const i=null===(e=this.store)||void 0===e?void 0:e.getCurPoiGroup();if(null===i)return[];let n=[];return t.length>0?t.forEach((t=>{if((t.object instanceof o.Mesh||t.object instanceof o.Sprite)&&t.object.userData){const e=null==i?void 0:i.children.find((e=>e.userData.id===t.object.userData.id));if(!(null==e?void 0:e.userData.id))return;if(e){if(!n.find((t=>t.id===(null==e?void 0:e.userData.id)))){const t=e.userData;n.push(t)}}}})):n=[],n}getSelectPois(t){const e=this.selectPois(t);e.length>0?this.eventDispatcher.dispatchPoiClick(e):this.eventDispatcher.dispatchPoiClick(null)}getSelectObjects(t,e){const i=[];if(t.forEach((t=>{if(t.object instanceof o.Mesh&&t.object.userData){if(!t.object.userData.id)return!1;const n=t.object.userData.id.substring(0,2),r=this.validateIsDup(i,t.object);n!==e||r||i.push(t.object)}})),i.length>0){const t=[];let e=[];this.store.getMapInfo().getFloors().forEach((t=>{e=e.concat(t.objects)})),i.forEach((i=>{const n=e.find((t=>t.id===i.userData.id));if(n){const e=n.coordinates.map((t=>({x:t.x,y:-t.y})));n.coordinates=e,n.poiDataArr=this.getConnPoiMetaDataOfSelectedObj(n.id),t.push(n)}})),this.eventDispatcher.dispatchObjectClick(t)}}getConnPoiMetaDataOfSelectedObj(t){if(l.DabeeoUtils.isEmpty(t))return console.error("Invalid objectId."),[];const e=this.store.getDefaultFloor();if(e){const i=e.pois.filter((e=>e.objectId===t));if(i.length>0)return i}return[]}validateIsDup(t,e){if(0===t.length)return!1;const i=t.find((t=>t.id===e.id));return Boolean(i)}getSelectMarker(t){const e=[];if(t.forEach((t=>{if(t.object.userData&&"marker"===t.object.userData.type){this.validateIsDup(e,t.object.userData)||e.push(t.object)}})),e.length>0){const t=e.map((t=>{const e=t.position,i=t.userData;return{position:{x:e.x,y:-e.y,z:e.z},userData:i}}));this.eventDispatcher.dispatchMarkerClick(t)}}initTouchFlag(){this.isTouchMove=!1,this.isTouchStart=!1,this.touchStartPt=null}addMouseEvent(){const t=this.rendererClass.getCSS2DRendererDomElem();t.addEventListener("mouseup",this.onMouseUp,!1),t.addEventListener("mousemove",this.onMouseMove,!1),t.addEventListener("mousedown",this.onMouseDown,!1)}sortByDistance(t){return t.sort(((t,e)=>t.distance-e.distance))}sortByType(t){const e=[],i=[],n=[];t.forEach((t=>{switch(t.object.userData.type){case"poi":i.push(t);break;case"marker":e.push(t);break;default:n.push(t)}}));return[...this.sortByDistance(e),...this.sortByDistance(i),...this.sortByDistance(n)]}sortIntersections(t){return this.sortByType(t)}getIntersections(t){const e=this.cameraController.getCamera();this.raycaster.setFromCamera(this.getEventCoords(t),e);let i=this.raycaster.intersectObjects(this.scene.children,!0);return i=this.sortIntersections(i),i}getUserMapCoordFromEvent(t){const e=this.getEventCoords(t),i=this.cameraController.getCamera(),n=this.preprocessing.eventCoordToWorldCoord(e,i);return this.preprocessing.worldCoordToUserMapCoord(n)}findSelectedItemType(t){let e;if(t)switch(t.object.userData.type){case"poi":e="poi";break;case"marker":e="marker";break;default:e="object"}return e}getDragDistance(t,e){const i=e.x-t.x,n=e.y-t.y;return Math.sqrt(i*i+n*n)}isClick(){let t=!1;return this.getDragDistance(this.dragStartData.coord,this.dragEndData.coord)<20&&(t=!0),t}isDragStart(){if(!this.isDown)return!1;if(this.isDragStartChecked)return!1;let t=!1;const e=(this.dragMoveData.time-this.dragStartData.time)/1e3;return e>0&&e<.5&&(t=!0,this.isDragStartChecked=!0),t}onUp(t,e){this.isDown=!1,this.dragEndData.time=+new Date;const i=t instanceof MouseEvent?t.clientX:t.changedTouches[0].clientX,n=t instanceof MouseEvent?t.clientY:t.changedTouches[0].clientY;this.dragEndData.coord.x=i,this.dragEndData.coord.y=n,this.isClick()||(this.eventDispatcher.dispatchDragEnd(e),this.isDragStartChecked=!1)}onMove(t){this.dragMoveData.time=+new Date,this.isDragStart()&&this.eventDispatcher.dispatchDragStart(t),this.isDown&&this.eventDispatcher.dispatchDragMove(t)}onDown(t){this.isDown=!0,this.dragStartData.time=+new Date;const e=t instanceof MouseEvent?t.clientX:t.changedTouches[0].clientX,i=t instanceof MouseEvent?t.clientY:t.changedTouches[0].clientY;this.dragStartData.coord.x=e,this.dragStartData.coord.y=i}onObjectHover(t){const e=this.getHoverObjUserDataList(t);e.length>0&&this.eventDispatcher.dispatchMouseHoverObject(e);const i=this.store.getObjectUserDataList();null==i||i.forEach((t=>{!0!==t.mouseover||e.includes(t)||(t.mouseover=!1,this.eventDispatcher.dispatchObjectMouseLeave(t))})),e.forEach((t=>{!1===t.mouseover&&(t.mouseover=!0,this.eventDispatcher.dispatchObjectMouseEnter(t))}))}onPoiHover(t){const e=this.getHoverPoiUserDataList(t);e.length>0&&this.eventDispatcher.dispatchPoiHover(e);const i=this.store.getPoiUserDataList();null==i||i.forEach((t=>{!0!==t.mouseover||e.includes(t)||(t.mouseover=!1,this.eventDispatcher.dispatchPoiMouseLeave(t))})),e.forEach((t=>{!1===t.mouseover&&(t.mouseover=!0,this.eventDispatcher.dispatchPoiMouseEnter(t))}))}removeTouchEvent(){var t;const e=this.rendererClass.getCSS2DRendererDomElem();e.removeEventListener("touchstart",this.touchStartCallback),e.removeEventListener("touchmove",this.touchMoveCallback),e.removeEventListener("touchend",null===(t=this.setTouchEndCallback)||void 0===t?void 0:t.bind(this),!1)}removeAllEvent(){this.removeTouchEvent();const t=this.rendererClass.getCSS2DRendererDomElem();t.removeEventListener("mouseup",this.onMouseUp,!1),t.removeEventListener("mousemove",this.onMouseMove,!1),t.removeEventListener("mousedown",this.onMouseDown,!1)}makeArrowHelper(){this.painter.getDebugMode()&&(this.arrowHelper&&this.painter.getScene().remove(this.arrowHelper),this.arrowHelper=this.painter.getScene().add(new o.ArrowHelper(this.raycaster.ray.direction,this.raycaster.ray.origin,100,16777215*Math.random())))}}},7449:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FloorManager=void 0;e.FloorManager=class{constructor(t,e,i,n,r,s,o,a){this.store=t,this.mapInfo=this.store.getMapInfo(),this.preprocessing=e,this.cameraController=i,this.dabeeoMapData=n,this.mapOptions=r,this.myLocationManager=s,this.routeSimulationManager=o,this.textureManager=a}getNewFloorData(){return this.newFloorData}async changeFloor(t){var e,i;this.store.setNextFloorId(t),this.store.setPrevFloorIndex(),this.store.setCurFloorIndex(this.store.getNextFloorId()),this.store.setRenderObjectAnimation(!1),this.store.setRenderNaviIconAnimation(!1);const n=await this.findNewFloorData(this.store.getNextFloorId());this.newFloorData=this.preprocessing.preventConvertingError(n);const r=null===(e=this.myLocationManager)||void 0===e?void 0:e.getMyLocationInfo();(null==r?void 0:r.isActive)||null===(i=this.myLocationManager)||void 0===i||i.setMyLocationInfo({x:null==r?void 0:r.location.x,y:null==r?void 0:r.location.y,animate:!1}),this.shouldAnimateFloorChange()?this.cameraController.initCameraAnimation():this.updateFloorData()}async resetToOriginFloor(){const{originFloorId:t}=this.routeSimulationManager;this.store.setCurFloorIndex(t);const e=await this.findNewFloorData(t);this.newFloorData=this.preprocessing.preventConvertingError(e),this.updateFloorData()}onFloorChangeDetected(){const t=this.store.getNextFloorId(),e=this.dabeeoMapData.floorData.getSavedFloorData(t);this.newFloorData=this.preprocessing.preventConvertingError(e),this.updateFloorData(),this.store.setIsFloorChanged(!1)}async getRouteFloorData(){const t=this.routeSimulationManager.response,e=(null==t?void 0:t.floorIdList).map((async t=>await this.findNewFloorData(t)));await Promise.all(e)}shouldResetToOriginFloor(){var t,e;let i=!1;const{originFloorId:n}=this.routeSimulationManager;return n!==(null===(e=null===(t=this.store)||void 0===t?void 0:t.getDefaultFloor())||void 0===e?void 0:e.id)&&(i=!0),i}shouldAnimateFloorChange(){let t=!1;return this.store.getMapOptions().enableFloorMotionOnChangeFloor&&(t=!0),t}convertFloorData(t){if(t){return{id:t.id,name:t.name,defaultYn:t.defaultYn}}}async findNewFloorData(t){var e,i,n;const r=null===(e=this.dabeeoMapData)||void 0===e?void 0:e.floorData.getSavedFloorData(t);let s;return r?s=r:(s=await(null===(i=this.dabeeoMapData)||void 0===i?void 0:i.floorData.getConvertFloorData(t)),await this.textureManager.loadNewFloorTexture(this.mapInfo,s),null===(n=this.store)||void 0===n||n.addFloorDataToMapData(s)),s}updateFloorData(){if(this.newFloorData){const t=[],e=this.getMaxVolume(this.newFloorData.objects),i=this.getMaxVolume(this.newFloorData.sections);this.preprocessing.makeThemeList(this.mapInfo,this.newFloorData),this.preprocessing.setObj(t,[...this.newFloorData.objects],"object"),this.preprocessing.setObj(t,[...this.newFloorData.sections],"section"),this.preprocessing.addMapIdToPoiData(this.mapInfo.getId(),this.newFloorData.pois),this.preprocessing.addMapIdToSvgObjectData(this.mapInfo.getId(),t),this.store.updateMapViewModel(t,this.preprocessing.getStyleList(),this.mapOptions,this.preprocessing.getData(),this.newFloorData,this.dabeeoMapData.dataFloor.getFloors(),e,i),this.updateObjectDataByFloorChange(t),this.updatePoiDataByFloorChange(this.newFloorData.pois)}}updatePoiDataByFloorChange(t){this.store.removeFromAllPoiData(this.mapInfo.getId()),this.store.addToAllPoiData(t)}updateObjectDataByFloorChange(t){this.store.removeFromAllObjectData(this.mapInfo.getId()),this.store.addToAllSvgObjectData(t)}getMaxVolume(t){if(t&&t.length>0){const e=t.reduce(((t,e)=>t.volume>e.volume?e:t));return e?e.volume:0}return 0}}},1179:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GeoJsonManager=void 0;const n=i(1097);e.GeoJsonManager=class{constructor(t){this.jsonList=[],this.preprocessing=t,this.geoJson=new n.GeoJson}async makeGeoJsonData(t){const e=this.jsonList.find((e=>e.url===t));if(e)return e.features;const i=await this.geoJson.makeJsonData(t);return i&&this.jsonList.push({url:t,features:i}),i}}},9083:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.IndoorMapsManager=void 0;e.IndoorMapsManager=class{constructor(t,e,i){this.store=t,this.preprocessing=e,this.textureManager=i,this.indoorMapDataOptionList=new Map,this.indoorPoiDataList=new Map,this.indoorSvgObjectDataList=new Map}getIndoorMapDataOption(t){return this.indoorMapDataOptionList.get(t)}removeIndoorMapDataOption(t){this.indoorMapDataOptionList.delete(t)}getIndoorMapGap(t){var e;return null===(e=this.indoorMapDataOptionList.get(t))||void 0===e?void 0:e.gap}async getIndoorMapRenderDataToAdd(t){const e=t.mapData.dataMapInfo,i=e.getId();t.floor?t.mapData.dataFloor.find({id:t.floor})||(console.error(`요청하신 ${t.floor}는 존재하지 않는 층입니다. 지도의 default층으로 이동합니다`),t.floor=e.getDefaultFloorId()):t.floor=e.getDefaultFloorId(),this.indoorMapDataOptionList.set(i,t);const n=t.floor;return await this.getIndoorMapRenderData(t,n)}getIndoorMapRenderDataToRemove(t){var e,i,n,r;const s={indoorSvgObjectData:void 0,indoorPoiData:void 0},o=null===(e=this.store.getCurIndoorMapFloorByMapId(t))||void 0===e?void 0:e.id;return o&&(s.indoorSvgObjectData=null===(i=this.indoorSvgObjectDataList.get(t))||void 0===i?void 0:i.get(o),s.indoorPoiData=null===(n=this.indoorPoiDataList.get(t))||void 0===n?void 0:n.get(o)),this.indoorSvgObjectDataList.delete(t),this.indoorPoiDataList.delete(t),this.store.removeFromAllObjectData(t),this.store.removeFromAllPoiData(t),this.textureManager.removeTextureByMapId(t),null===(r=this.preprocessing)||void 0===r||r.removeIndoorMapStyles(t),s}async getIndoorMapRenderData(t,e){var i;const n=t.mapData.dataMapInfo,r=await t.mapData.getFloorData(e);if(null===r)return null;let s;Array.isArray(r)?[s]=r:s=r,n.setFloors([...t.mapData.floorData.getConvertFloorDataAll()]),await this.textureManager.loadTextureArray(n);const o=n.getId();null===(i=this.preprocessing)||void 0===i||i.makeThemeList(n,s);const a=this.preprocessing.getConvertedIndoorMapSvgObjectData(t,e),l=this.preprocessing.getConvertedIndoorMapPoiData(t,e);this.setIndoorSvgObjectData(o,e,a),this.setIndoorPoiData(o,e,l),this.store.setCurIndoorMapFloorByMapId(o,s),this.store.addToAllSvgObjectData(a),this.store.addToAllPoiData(l);return{indoorSvgObjectData:a,indoorPoiData:l}}async getIndoorMapRouteFloorData(t){const e=t.floorIdList;if(e){const t=e.map((async t=>{var e;const i=null===(e=this.indoorMapDataOptionList.get(this.store.getCurMapId()))||void 0===e?void 0:e.mapData;let n=null==i?void 0:i.floorData.getSavedFloorData(t);n||(n=await(null==i?void 0:i.floorData.getConvertFloorData(t)),i&&await this.textureManager.loadNewFloorTexture(i.dataMapInfo,n))}));await Promise.all(t)}}setIndoorPoiData(t,e,i){const n=this.indoorPoiDataList.get(t);n?n.set(e,i):this.indoorPoiDataList.set(t,(new Map).set(e,i))}setIndoorSvgObjectData(t,e,i){const n=this.indoorSvgObjectDataList.get(t);n?n.set(e,i):this.indoorSvgObjectDataList.set(t,(new Map).set(e,i))}}},6794:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Control=void 0;e.Control=class{constructor(t){this.dabeeoMapsManager=t}getCurrentZoomLevel(){return this.dabeeoMapsManager.getCurrentZoomLevel()}getCameraType(){return this.dabeeoMapsManager.getCameraType()}changeCamera(t){this.dabeeoMapsManager.changeCamera(t)}changeZoom(t){return this.dabeeoMapsManager.changeZoom(t)}zoomIn(t){return this.dabeeoMapsManager.zoomIn(t)}zoomOut(t){return this.dabeeoMapsManager.zoomOut(t)}moveTo(t){return this.dabeeoMapsManager.cameraMoveTo(t)}set(t){return this.dabeeoMapsManager.cameraSet(t)}reset(t){this.dabeeoMapsManager.cameraReset(t)}focusTo(t){return this.dabeeoMapsManager.focusTo(t)}setOption(t){return this.dabeeoMapsManager.setOption(t)}}},6386:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MapContext=void 0;e.MapContext=class{constructor(t){this.dabeeoMapsManager=t}async changeFloor(t){await this.dabeeoMapsManager.changeFloor(t)}cleanup(){this.dabeeoMapsManager.cleanup();const t=this.dabeeoMapsManager.getContainer();for(;null==t?void 0:t.lastElementChild;)t.removeChild(t.lastElementChild)}getMapOptions(){return this.dabeeoMapsManager.getMapOptions()}showByCode(t){return this.dabeeoMapsManager.showByCode(t)}hideByCode(t){return this.dabeeoMapsManager.hideByCode(t)}changeLanguage(t){this.dabeeoMapsManager.changeLanguage(t)}getCurrentFloor(){return this.dabeeoMapsManager.getCurrentFloor()}convertToImg(t){this.dabeeoMapsManager.convertToImg(t)}async addIndoorMap(t){await this.dabeeoMapsManager.addIndoorMap(t)}removeIndoorMap(t){this.dabeeoMapsManager.removeIndoorMap(t)}async changeIndoorMapFloor(t,e){await this.dabeeoMapsManager.changeIndoorMapFloor(t,e)}changeCurrentMap(t){this.dabeeoMapsManager.changeCurrentMap(t)}getCurrentMapId(){return this.dabeeoMapsManager.getCurrentMapId()}}},3715:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Markers=void 0;e.Markers=class{constructor(t){this.dabeeoMapsManager=t}async set(t){return await this.dabeeoMapsManager.setMarker(t)}clear(t){this.dabeeoMapsManager.removeMarker(t)}clearAll(){this.dabeeoMapsManager.clearMarker()}}},368:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Mylocation=void 0;e.Mylocation=class{constructor(t){this.dabeeoMapsManager=t}async set(t){return await this.dabeeoMapsManager.myLocationOn(t)}setPosition(t){this.dabeeoMapsManager.myLocationSetPosition(t)}movePosition(t){this.dabeeoMapsManager.myLocationMovePosition(t)}setRotation(t){this.dabeeoMapsManager.myLocationSetRotation(t)}clear(){this.dabeeoMapsManager.myLocationOff()}start(){this.dabeeoMapsManager.myLocationStart()}stop(){this.dabeeoMapsManager.myLocationStop()}getCurrentPosition(){return this.dabeeoMapsManager.myLocationGetCurrentPosition()}trackingOn(t){this.dabeeoMapsManager.myLocationTrackingOn(t)}trackingOff(){this.dabeeoMapsManager.myLocationTrackingOff()}show(){this.dabeeoMapsManager.myLocationShow()}hide(){this.dabeeoMapsManager.myLocationHide()}gifOn(){this.dabeeoMapsManager.myLocationGifAnimationOn()}gifOff(){this.dabeeoMapsManager.myLocationGifAnimationOff()}}},8474:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Objects=void 0;e.Objects=class{constructor(t){this.dabeeoMapsManager=t}hide(t){"string"==typeof t&&this.dabeeoMapsManager.hide(t,"obj"),Array.isArray(t)&&t.forEach((t=>this.dabeeoMapsManager.hide(t,"obj"))),void 0===t&&this.dabeeoMapsManager.hideAll("obj")}show(t){"string"==typeof t&&this.dabeeoMapsManager.show(t,"obj"),Array.isArray(t)&&t.forEach((t=>this.dabeeoMapsManager.show(t,"obj"))),void 0===t&&this.dabeeoMapsManager.showAll("obj")}set(t){return this.dabeeoMapsManager.updateObject(t)}reset(t){this.dabeeoMapsManager.resetObject(t)}}},3575:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Overlay=void 0;e.Overlay=class{constructor(t){this.dabeeoMapsManager=t}async addSource(t,e){await this.dabeeoMapsManager.addOverlaySource(t,e)}async addLayer(t){this.dabeeoMapsManager.addOverlayLayer(t)}removeSource(t){this.dabeeoMapsManager.removeOverlaySource(t)}removeLayer(t){this.dabeeoMapsManager.removeOverlayLayer(t)}}},3312:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Pois=void 0;e.Pois=class{constructor(t){this.dabeeoMapsManager=t}show(t){t?this.dabeeoMapsManager.show(t,"poi"):this.dabeeoMapsManager.showAll("poi")}hide(t){t?this.dabeeoMapsManager.hide(t,"poi"):this.dabeeoMapsManager.hideAll("poi")}set(t){return this.dabeeoMapsManager.updatePoi(t)}getCurrentPois(t){return this.dabeeoMapsManager.getCurrentPois(t)}async reset(t){t?this.dabeeoMapsManager.resetPoi(t):(await this.dabeeoMapsManager.clearAll("poi"),await this.dabeeoMapsManager.setAll("poi"))}}},6627:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Recon=void 0;e.Recon=class{constructor(t){this.dabeeoMapsManager=t}async show(t,e){await this.dabeeoMapsManager.show3DRecon(t,e)}}},423:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RouteSimulation=void 0;e.RouteSimulation=class{constructor(t){this.dabeeoMapsManager=t}async set(t,e={}){return await this.dabeeoMapsManager.getRouteOn(t,e)}async start(t=null){return await this.dabeeoMapsManager.startRouteAnimation(t)}stop(){this.dabeeoMapsManager.stopRouteAnimation()}clear(){this.dabeeoMapsManager.getRouteOff()}}},777:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Tag=void 0;e.Tag=class{constructor(t){this.dabeeoMapsManager=t}set(t){return this.dabeeoMapsManager.addTag(t)}setPOITag(t){const e=Object.assign(Object.assign({},t),{type:"POI"});return this.dabeeoMapsManager.addItemTag(e)}setMarkerTag(t){const e=Object.assign(Object.assign({},t),{type:"MARKER"});return this.dabeeoMapsManager.addItemTag(e)}clear(t){this.dabeeoMapsManager.removeTag(t)}find(t){return this.dabeeoMapsManager.findTag(t)}clearAll(){this.dabeeoMapsManager.removeAllTag()}}},7451:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TestModel=void 0;e.TestModel=class{constructor(t){this.dabeeoMapsManager=t}async addTestModel(t){await this.dabeeoMapsManager.addTestModel(t)}getAllModelData(){return this.dabeeoMapsManager.getAllModelData()}updateTestModel(t){this.dabeeoMapsManager.updateTestModel(t)}removeTestModel(t){this.dabeeoMapsManager.removeTestModel(t)}}},5895:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.MapMarkerGroup=void 0;const o=s(i(5232)),a=i(2676),l=i(5814),c=i(9391),h=i(1722),u=i(3198);class d extends a.Group{constructor(t,e,i){super("mapMarkerGroup"),this.children=[],this.store=t,this.cameraController=e,this.markerManager=i,this.myMarkerGroup=null,this.myMarker=[],this.textureManager=new h.TextureManager(this.store.getMapInfo())}async setMarker(t){let e=null;if(e=t?t.marker:this.markerManager.markerOptions,this.markerManager&&(null==e?void 0:e.length)){const t=await Promise.all(e.map((async t=>{var e,i,n,r,s,a,c,h;const{x:d,y:p}=t,f=t.iconOption&&"positionZ"in t.iconOption?null===(e=t.iconOption)||void 0===e?void 0:e.positionZ:this.store.getMaxObjZ()+3,m=(null===(i=t.iconOption)||void 0===i?void 0:i.iconUrl)?null===(n=t.iconOption)||void 0===n?void 0:n.iconUrl:u.defaultConstMarkerIcon.iconUrl,g=(null===(r=t.iconOption)||void 0===r?void 0:r.width)||u.defaultConstMarkerIcon.width,v=(null===(s=t.iconOption)||void 0===s?void 0:s.height)||u.defaultConstMarkerIcon.height,y=this.cameraController.getCurrentCmFromPixel(g),_=this.cameraController.getCurrentCmFromPixel(v),x=await this.textureManager.asyncGetTexture(m),M={marker:(new l.MapMarkerSprite).drawSpriteMarker(t,y,_),floor:t.floorId};if(M.marker.position.x=Number(d),M.marker.position.y=Number(p),M.marker.position.z=Number(f),M.marker.rotateZ(o.MathUtils.degToRad(this.store.getMapInfo().getNorthReference())),M.marker.userData=Object.assign(Object.assign({id:t.id,floorId:t.floorId,data:t.data?t.data:{}},M.marker.userData?M.marker.userData:{}),{type:"marker",size:{width:(null===(a=t.iconOption)||void 0===a?void 0:a.width)?t.iconOption.width:u.defaultConstMarkerIcon.width,height:(null===(c=t.iconOption)||void 0===c?void 0:c.height)?t.iconOption.height:u.defaultConstMarkerIcon.height}}),M.marker=M.marker.addSpriteMarker(x,t),void 0!==(null===(h=t.iconOption)||void 0===h?void 0:h.visibleIcon)&&(M.marker.visible=t.iconOption.visibleIcon),t.floorId===this.store.getDefaultFloorId())this.myMarker.push(M);else if((null==t?void 0:t.indoorMapId)&&t.floorId){const e=this.store.getCurIndoorMapFloorByMapId(t.indoorMapId);(null==e?void 0:e.id)===t.floorId?(this.markerManager.convertToIndoorMarkerPos(t.indoorMapId,M.marker.position),this.myMarker.push(M)):console.error(`현재 ${null==t?void 0:t.indoorMapId}맵의 ${t.floorId}층은 화면에 표시되어 있지 않습니다.`)}return M.marker})));return this.drawMarker(),this.store.setRenderDirty(!0),t}return null}drawMarker(){this.myMarkerGroup&&this.remove(this.myMarkerGroup),this.myMarkerGroup=null,this.myMarkerGroup||(this.myMarkerGroup=new c.MyMarkerGroup),this.myMarker.forEach((t=>{t.marker&&t.marker.userData&&(t.marker.userData.type="marker"),this.myMarkerGroup&&t.marker&&this.myMarkerGroup.add(t.marker)})),this.myMarkerGroup.userData.type="markerGroup",this.add(this.myMarkerGroup)}removeMarker(t){var e,i,n,r;const s=null===(e=this.myMarkerGroup)||void 0===e?void 0:e.children.find((e=>e.userData.id===t));null===(i=this.myMarkerGroup)||void 0===i||i.remove(s);const a=this.myMarker.find((e=>{var i;return(null===(i=e.marker)||void 0===i?void 0:i.userData.id)===t}));this.myMarker=[...this.myMarker.filter((e=>{var i;return(null===(i=e.marker)||void 0===i?void 0:i.userData.id)!==t}))],a&&(null===(n=a.marker)||void 0===n||n.geometry.dispose(),(null===(r=a.marker)||void 0===r?void 0:r.material)instanceof o.SpriteMaterial&&(a.marker.material.map&&(a.marker.material.map.dispose(),a.marker.material.map=null),a.marker.material.dispose(),a.marker=null,this.store.setRenderDirty(!0)))}clearMarker(){this.myMarkerGroup&&this.remove(this.myMarkerGroup),this.myMarker.forEach((t=>{t.marker&&(t.marker.geometry.dispose(),t.marker.material instanceof o.SpriteMaterial&&(t.marker.material.map&&(t.marker.material.map.dispose(),t.marker.material.map=null),t.marker.material.dispose(),t.marker=null))})),this.myMarkerGroup=null,this.myMarker=[],this.store.setRenderDirty(!0)}updateMarkerScaleByMapScale(){this.myMarkerGroup&&this.myMarkerGroup.children.length>0&&this.myMarkerGroup.children.forEach((t=>{const e=this.cameraController.getCurrentCmFromPixel(t.userData.size.width),i=this.cameraController.getCurrentCmFromPixel(t.userData.size.height);t.scale.set(e,i,1)}))}Update(){for(let t=0;t<this.children.length;t++)void 0!==this.children[t].Update&&this.children[t].Update();this.updateMarkerScaleByMapScale()}}e.MapMarkerGroup=d},5814:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.MapMarkerSprite=void 0;const o=s(i(5232)),a=i(3198),l=i(6969);class c extends l.Sprite{constructor(){super(new o.SpriteMaterial),this.children=[],this.counter=0}drawSpriteMarker(t,e,i){return this.material.depthTest=!1,this.scale.set(e,i,1),this}addSpriteMarker(t,e){var i,n,r,s,o;return this.material.map=t,this.material.needsUpdate=!0,(null===(i=e.iconOption)||void 0===i?void 0:i.width)||(null===(n=e.iconOption)||void 0===n?void 0:n.height)||this.scale.set(t.image.width,t.image.height,1),(null===(r=e.iconOption)||void 0===r?void 0:r.anchor)?this.center.set(null===(s=e.iconOption)||void 0===s?void 0:s.anchor.x,null===(o=e.iconOption)||void 0===o?void 0:o.anchor.y):this.center.set(a.defaultConstMarkerIcon.anchor.x,a.defaultConstMarkerIcon.anchor.y),this}Update(){for(let t=0;t<this.children.length;t++)void 0!==this.children[t].Update&&this.children[t].Update()}}e.MapMarkerSprite=c},1342:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MarkerManager=void 0;const n=i(3198);e.MarkerManager=class{constructor(t,e,i){this.markerOptions=[],this.store=t,this.preprocessing=e,this.indoorMapsManager=i}setMarkerOptions(t){t.marker.forEach((t=>{var e,i;t.floorId||(t.floorId=this.store.getDefaultFloorId(),t.iconOption?(t.iconOption.width=(null===(e=t.iconOption)||void 0===e?void 0:e.width)?t.iconOption.width:n.defaultConstMarkerIcon.width,t.iconOption.height=(null===(i=t.iconOption)||void 0===i?void 0:i.height)?t.iconOption.height:n.defaultConstMarkerIcon.height):t.iconOption={width:n.defaultConstMarkerIcon.width,height:n.defaultConstMarkerIcon.height}),t.id=this.makeNewID()})),this.markerOptions.push(...t.marker)}makeNewID(){return String((new Date).getTime())+Math.random().toString(36).substr(2,16)}removeMarkerOption(t){this.markerOptions=[...this.markerOptions.filter((e=>e.id!==t))]}clearMarkerOptions(){this.markerOptions=[]}convertToIndoorMarkerPos(t,e){var i,n;const r=this.indoorMapsManager.getIndoorMapDataOption(t);if(r){const t=null===(i=this.preprocessing)||void 0===i?void 0:i.getIndoorMapCoordsTransformMatrix3(r);null===(n=this.preprocessing)||void 0===n||n.transformIndoorMapCoords(e,t)}return e}}},9391:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MyMarkerGroup=void 0;const n=i(2676);class r extends n.Group{constructor(){super("myMarkerGroup"),this.children=[]}Update(){for(let t=0;t<this.children.length;t++)void 0!==this.children[t].Update&&this.children[t].Update()}}e.MyMarkerGroup=r},8667:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.MapMyLoc=void 0;const o=s(i(5232)),a=i(6969);class l extends o.Object3D{constructor(t){super(),this.children=[],this.mapOptions=t.getMapOptions()}draw(t,e){const i=new o.SpriteMaterial({map:e,side:o.DoubleSide,transparent:!0});i.depthTest=!1;const n=new a.Sprite(i);n.scale.set(t.icon.size.width,t.icon.size.height,1);const r=n;return r.name="mypos",r.Update=this.Update,r.userData.size=t.icon.size,r}Update(){for(let t=0;t<this.children.length;t++)void 0!==this.children[t].Update&&this.children[t].Update()}cleanup(){}}e.MapMyLoc=l},0:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.MapMyLocEffect=void 0;const o=s(i(5232)),a=i(6969),l=i(6202);class c extends o.Object3D{constructor(t){super(),this.children=[],this.mapOptions=t.getMapOptions(),this.effect=null,this.clock=new o.Clock,this.time=0}draw(t,e){const i=new o.SpriteMaterial({color:t.animate.color,alphaMap:e,opacity:t.animate.opacity,transparent:!0,side:o.DoubleSide}),n=new a.Sprite(i);return n.scale.set(t.animate.radius,t.animate.radius,1),this.effect=n,Array.isArray(this.effect.material)||(this.effect.material.depthTest=!1),this.effect.position.z-=.01,this.effect.userData.originScale=1,this.effect.userData.desireScale=t.animate.desireScale,this.effect.userData.originOpacity=t.animate.opacity,this.effect.userData.desireOpacity=.1*t.animate.opacity,this.effect.userData.duration=t.animate.duration,this.effect.userData.on=t.animate.on,this.effect.Update=this.Update.bind(this),this.effect}cleanup(){}Update(){for(let t=0;t<this.children.length;t++)void 0!==this.children[t].Update&&this.children[t].Update();this.shouldResetEffect()&&this.resetEffect(),this.time+=1e3*this.clock.getDelta(),this.setCurrentScale(),this.setCurrentOpacity()}shouldResetEffect(){let t=!1;return this.effect&&this.effect.scale.x>this.effect.userData.desireScale&&(t=!0),t}resetEffect(){this.effect&&(this.effect.scale.x=this.effect.userData.originScale,this.effect.scale.y=this.effect.userData.originScale,this.effect.material.opacity=this.effect.userData.originOpacity,this.time=0)}setCurrentScale(){if(this.effect){const{time:t}=this,e=this.effect.userData.originScale,i=this.effect.userData.desireScale,{duration:n}=this.effect.userData,r=l.DabeeoUtils.easeInQuad(t,e,i,n);this.effect.scale.x=r,this.effect.scale.y=r}}setCurrentOpacity(){if(this.effect){const{time:t}=this,e=this.effect.userData.originOpacity,i=this.effect.userData.desireOpacity,{duration:n}=this.effect.userData,r=l.DabeeoUtils.easeInQuad(t,e,i,n);this.effect.material.opacity=r}}}e.MapMyLocEffect=c},9623:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.MapMyLocGroup=void 0;const o=s(i(5232)),a=i(6486),l=i(8667),c=i(0),h=i(2676),u=i(6969),d=i(9220),p=i(6163),f=i(6202);class m extends h.Group{constructor(t,e,i,n,r,s){super("mapMyLocation"),this.children=[],this.prevUserMapCoordList=[],this.gifTexture=null,this.onGeolocationSuccess=t=>{const e=this.store.getMapInfo().getGeoreferencingNorth(),i=this.store.getMapInfo().getGeoreferencingWest(),n=this.preprocessing.geolocationCoordToUserMapCoord(e,i,t.coords.latitude,t.coords.longitude);this.shouldUpdateCoordData(n)&&this.updateCoordData(n),this.gpsTrackingOn&&this.updateTrackingInfo(n),this.isWatchingPosition=!0},this.onGeolocationError=t=>{},this.myPos=null,this.textureManager=r,this.myLocationManager=s,this.store=t,this.cameraController=e,this.preprocessing=i,this.eventDispatcher=n,this.clock=new o.Clock,this.isMovingPosition=!1,this.mapCoordData={prevMapCoord:{x:0,y:0},targetMapCoord:{x:0,y:0},alpha:0},this.mapCoordData={prevMapCoord:{x:0,y:0},targetMapCoord:{x:0,y:0},alpha:0},this.gpsTrackingOn=!1,this.isWatchingPosition=!1,this.isOutOfMap=!1,this.isUsingGifTexture=!1}gifTextureOn(){var t;null===(t=this.gifTexture)||void 0===t||t.draw()}gifTextureOff(){var t;null===(t=this.gifTexture)||void 0===t||t.stop()}getIsUsingGifTexture(){return this.isUsingGifTexture}setPositionMyLocationMarker(t){this.myPos?(this.position.x=t.x,this.position.y=t.y,this.mapCoordData.prevMapCoord.x=this.position.x,this.mapCoordData.prevMapCoord.y=this.position.y):console.error("현재 MyLocation 마커가 없습니다")}movePositionMyLocationMarker(t){this.myPos?this.updateCoordData(t):console.error("현재 MyLocation 마커가 없습니다")}updateMovePosition(){const t=2*this.clock.getDelta();if(this.mapCoordData.alpha+=t,this.isMovingPosition){if(this.mapCoordData.alpha<1){const t=this.mapCoordData.prevMapCoord.x*(1-this.mapCoordData.alpha)+this.mapCoordData.targetMapCoord.x*this.mapCoordData.alpha,e=this.mapCoordData.prevMapCoord.y*(1-this.mapCoordData.alpha)+this.mapCoordData.targetMapCoord.y*this.mapCoordData.alpha;this.position.x=t,this.position.y=e}else this.position.x=this.mapCoordData.targetMapCoord.x,this.position.y=this.mapCoordData.targetMapCoord.y,this.isMovingPosition=!1;this.store.setRenderDirty(!0)}}setRocationMyLocationMarker(t){this.myPos?this.myPos.material.rotation=t:console.error("현재 MyLocation 마커가 없습니다")}async drawMyLocationMarker(t,e={x:0,y:0,z:1}){var i;const n=e.x,r=e.y;let s;if(this.myLocationOff(),this.textureManager.isGifTexture(t.icon.image)?(s=await this.textureManager.asyncGetGifTexture(t.icon.image),this.isUsingGifTexture=!0,this.gifTexture=s,null===(i=this.gifTexture)||void 0===i||i.stop()):s=await this.textureManager.asyncGetTexture(t.icon.image),this.children.forEach((t=>{"mypos"===t.name&&this.remove(t)})),this.myPos=new l.MapMyLoc(this.store).draw(t,s),this.add(this.myPos),this.position.x=n,this.position.y=r,this.position.z=Number(e.z),this.myPos.rotateZ(o.MathUtils.degToRad(this.store.getMapInfo().getNorthReference())),t.icon.anchor&&this.myPos instanceof u.Sprite){const e=this.cameraController.getCurrentCmFromPixel(this.myPos.userData.size.width),i=this.cameraController.getCurrentCmFromPixel(this.myPos.userData.size.height),n=-e*(t.icon.anchor.x-.5),r=-i*(t.icon.anchor.y-.5);this.myPos.position.x+=n,this.myPos.position.y+=r}t.animate.on?this.textureManager.asyncGetTexture(p.DEFAULT_ICON_URLS.myLocationAnimateTexture).then((e=>{var i;const n=new c.MapMyLocEffect(this.store).draw(t,e);this.myLocationEffectOff(),null===(i=this.myPos)||void 0===i||i.add(n),this.store.setRenderMyLocAnimation(!0)})):this.store.setRenderMyLocAnimation(!1)}myLocationEffectOff(){var t;(null===(t=this.myPos)||void 0===t?void 0:t.children)&&this.myPos.children.forEach((t=>{var e;t.material.alphaMap&&t.material.alphaMap.dispose(),t.material.dispose(),t.geometry.dispose(),null===(e=this.myPos)||void 0===e||e.remove(t)}))}disposeMats(t){t instanceof o.SpriteMaterial&&(t.map&&(t.map.dispose(),t.map=null),t.dispose())}myLocationOff(){this.myPos&&(this.remove(this.myPos),this.myPos.geometry.dispose(),Array.isArray(this.myPos.material)?this.myPos.material.forEach((t=>{this.disposeMats(t)})):this.disposeMats(this.myPos.material),this.myPos.children.forEach((t=>{var e;t.material.alphaMap&&t.material.alphaMap.dispose(),t.material.dispose(),t.geometry.dispose(),null===(e=this.myPos)||void 0===e||e.remove(t)})),this.myPos=null,this.position.x=0,this.position.y=0,this.position.z=1,this.isUsingGifTexture=!1,this.store.setRenderGifAnimation(!1),this.store.setRenderDirty(!0))}setGeolocation(){this.watchId=navigator.geolocation.watchPosition(this.onGeolocationSuccess,this.onGeolocationError,{enableHighAccuracy:!0,maximumAge:1e4,timeout:5e3})}stopGeolocation(){this.watchId&&navigator.geolocation.clearWatch(this.watchId),this.isWatchingPosition=!1}getCurrentPosition(){if(this.isWatchingPosition){return f.DabeeoUtils.changeVector2Minus(this.mapCoordData.targetMapCoord)}console.error("GPS coordinates not available!")}setGPSTrackingOn(t){var e;this.naviPathList=t;const{locations:i}=this.naviPathList;this.nodesNotInCourses=null===(e=this.store.getDefaultFloor())||void 0===e?void 0:e.nodes.filter((t=>-1===i.map((t=>t.nodeId)).indexOf(t.id))),this.gpsTrackingOn=!0}setGPSTrackingOff(){this.naviPathList=void 0,this.nodesNotInCourses=void 0,this.gpsTrackingOn=!1}showMyLocation(){this.visible=!0}hideMyLocation(){this.visible=!1}Update(){for(let t=0;t<this.children.length;t++)void 0!==this.children[t].Update&&this.children[t].Update();const{floorId:t,marker:e,isActive:i}=this.myLocationManager.getMyLocationInfo();t===this.store.getDefaultFloorId()&&(null==e?void 0:e.animate.on)?this.store.setRenderMyLocAnimation(!0):this.store.setRenderMyLocAnimation(!1),this.updatePosition(),this.updateMovePosition(),this.updateMyLocationScaleByMapScale(),this.shouldDispatchMapOut()&&this.eventDispatcher.dispatchMylocationMapOut(),this.shouldDispatchMapIn()&&this.eventDispatcher.dispatchMylocationMapIn()}shouldDispatchMapOut(){let t=!1;return!this.isOutOfMap&&this.isMylocationMapOut()&&(this.isOutOfMap=!0,t=!0),t}shouldDispatchMapIn(){let t=!1;return this.isOutOfMap&&!this.isMylocationMapOut()&&(this.isOutOfMap=!1,t=!0),t}isMylocationMapOut(){let t=!1;const e=this.store.getMapInfo().getSize().width,i=this.store.getMapInfo().getSize().height,n=f.DabeeoUtils.changeVectorMinus(this.position.clone());return(0>n.x||e<n.x||0>n.y||i<n.y)&&(t=!0),t}shouldUpdateCoordData(t){let e=!0;return this.prevUserMapCoordList.length>6&&this.prevUserMapCoordList.splice(0,1),this.prevUserMapCoordList.forEach((i=>{f.DabeeoUtils.getDistance(i,t)>500&&(e=!1)})),this.prevUserMapCoordList.push(t),e}updateCoordData(t){this.mapCoordData.prevMapCoord.x=this.position.x,this.mapCoordData.prevMapCoord.y=this.position.y,this.mapCoordData.targetMapCoord.x=t.x,this.mapCoordData.targetMapCoord.y=t.y,this.mapCoordData.alpha=0,this.isMovingPosition=!0}updateTrackingInfo(t){const e=this.getTrackingInfo({x:t.x,y:t.y,z:0});this.eventDispatcher.dispatchTrackingMove(e),(null==e?void 0:e.current_state)===d.CURRENT_STATE.ARRIVED&&this.eventDispatcher.dispatchTrackingComplete()}getTrackingInfo(t={x:0,y:0,z:0}){var e,i,n,r,s,l,c,h,u,p,f,m,g;const{gpsOption:v}=this.myLocationManager.getMyLocationInfo(),y=this.preprocessing.divideScaleCm(100*v.leftCourseDistance),_=this.preprocessing.divideScaleCm(100*v.willArriveRadius),x=this.preprocessing.divideScaleCm(100*v.arrivedRadius),M=new o.Vector3(t.x,t.y,t.z);let b={current_position:M,current_path:[],next_step:null,current_state:d.CURRENT_STATE.OUT_OF_PATH,current_angle:0,closestPoint:"NONE",distance_from_origin:0,distance_to_destination:0,distance_to_closest_path:0,cpath:[],closeP:""},w=0;if(this.naviPathList&&this.naviPathList.pathInfo){const t=this.naviPathList.locations,{totalDistance:v}=this.naviPathList,S=t[t.length-1].position,T=new o.Vector3(null==S?void 0:S.x,null==S?void 0:S.y,null==S?void 0:S.z);let A,E,C=0;for(let p=0;p<t.length-1;p++){const f=t[p],m=t[p+1],g=m.direction,y=new o.Vector3(null===(e=f.position)||void 0===e?void 0:e.x,null===(i=f.position)||void 0===i?void 0:i.y,null===(n=f.position)||void 0===n?void 0:n.z),_=new o.Vector3(null===(r=m.position)||void 0===r?void 0:r.x,null===(s=m.position)||void 0===s?void 0:s.y,null===(l=m.position)||void 0===l?void 0:l.z),x=new o.Vector3,S=new o.Line3(y,_);S.closestPointToPoint(M,!0,x);const T=x.distanceTo(M),O=y.distanceTo(x),P=new o.Vector3(0,1,0),I=y.clone().sub(_);let D=Math.atan2(P.x*I.y-P.y*I.x,P.x*I.x+P.y*I.y);if(D>0&&(D=o.MathUtils.degToRad(360)-D),D<0&&(D*=-1),D*=180/Math.PI,0===p||w>T){const e=(0,a.cloneDeep)(f),i=(0,a.cloneDeep)(m);b.current_path[0]=e,b.current_path[1]=i,b.cpath[0]=`B : ${p}`,b.cpath[1]=`C : ${p+1}`,b.next_step=g,b.current_angle=D,b.current_state=d.CURRENT_STATE.ON_PATH,b.closestPoint=x,b.distance_from_origin=this.preprocessing.multiplyScaleCm(C+O+T)/100,b.distance_to_destination=(v-this.preprocessing.multiplyScaleCm(C+O)+this.preprocessing.multiplyScaleCm(T))/100,b.distance_to_closest_path=this.preprocessing.multiplyScaleCm(T)/100,b.closeP=`A_ON_BC : ${p} ~ ${p+1}`,w=T,p<t.length-2&&(A=t[p+2],E=new o.Vector3(null===(c=A.position)||void 0===c?void 0:c.x,null===(h=A.position)||void 0===h?void 0:h.y,null===(u=A.position)||void 0===u?void 0:u.z))}C+=S.distance()}const O=new o.Vector3(null===(p=b.current_path[1].position)||void 0===p?void 0:p.x,null===(f=b.current_path[1].position)||void 0===f?void 0:f.y,null===(m=b.current_path[1].position)||void 0===m?void 0:m.z);if(O.equals(T)){let t;b.closestPoint instanceof o.Vector3&&(t=b.closestPoint.distanceTo(T)),b.next_step="DESTNATION",b.current_state=d.CURRENT_STATE.ON_LAST_PATH,t&&t<_&&(b.current_state=d.CURRENT_STATE.WILL_ARRIVE,x<_&&t<x&&(b.current_state=d.CURRENT_STATE.ARRIVED,b.closestPoint=T,b.closeP="next destPoint"),b.next_step=null)}else if(b.closestPoint instanceof o.Vector3&&b.closestPoint.distanceTo(O)<100&&E){const t=new o.Vector3(0,1,0),e=M.clone().sub(E);let i=Math.atan2(t.x*e.y-t.y*e.x,t.x*e.x+t.y*e.y);i>0&&(i=o.MathUtils.degToRad(360)-i),i<0&&(i*=-1),i*=180/Math.PI,b.current_angle=i}w>y&&(b.closestPoint="NONE",b.closeP="left course",b.current_state=d.CURRENT_STATE.OUT_OF_PATH,null===(g=this.nodesNotInCourses)||void 0===g||g.forEach((t=>{const e=new o.Vector3(t.position.x,t.position.y,t.position.z).distanceTo(M);w>e&&(b.closestPoint="NEW")})))}return b=this.convertTrackingInfos(b),b}convertTrackingInfos(t){return t.closestPoint instanceof Object&&(t.closestPoint=f.DabeeoUtils.changeVectorMinus(t.closestPoint)),t.current_position=f.DabeeoUtils.changeVectorMinus(t.current_position),t.current_path.forEach((t=>{t.position&&(t.position=f.DabeeoUtils.changeVector2Minus(t.position))})),t}updatePosition(){if(this.isWatchingPosition){const t=this.clock.getDelta();this.mapCoordData.alpha<1&&(this.mapCoordData.alpha+=t);const e=this.mapCoordData.prevMapCoord.x*(1-this.mapCoordData.alpha)+this.mapCoordData.targetMapCoord.x*this.mapCoordData.alpha,i=this.mapCoordData.prevMapCoord.y*(1-this.mapCoordData.alpha)+this.mapCoordData.targetMapCoord.y*this.mapCoordData.alpha;this.position.x=e,this.position.y=i}}updateMyLocationScaleByMapScale(){if(this.myPos){const t=this.cameraController.getCurrentCmFromPixel(this.myPos.userData.size.width),e=this.cameraController.getCurrentCmFromPixel(this.myPos.userData.size.height);this.myPos.scale.set(t,e,1)}}}e.MapMyLocGroup=m},2972:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MyLocationManager=void 0;const n=i(6486),r=i(9843),s=i(6163),o=i(6202);e.MyLocationManager=class{constructor(t){this.children=[],this.store=t,this.myLocAnimate=(0,n.cloneDeep)(r.defaultConstMyLocAnimate),this.myLocationInfo=(0,n.cloneDeep)(r.defaultConstMyLocInfo)}setMyLocationInfo(t){const e=(0,n.cloneDeep)(t);Object.assign(e,o.DabeeoUtils.changeVector2Minus({x:e.x,y:e.y}));const{x:i,y:r,onActive:a,iconOption:l,animate:c,gpsOption:h}=e,u=(null==l?void 0:l.positionZ)?null==l?void 0:l.positionZ:this.store.getMaxObjZ(),d={icon:{image:s.DEFAULT_ICON_URLS.myLocation,size:{width:30,height:30},anchor:null==l?void 0:l.anchor},animate:{on:!1,color:this.myLocAnimate.color,opacity:this.myLocAnimate.opacity,desireScale:this.myLocAnimate.desireScale,duration:this.myLocAnimate.duration}};e&&((null==l?void 0:l.iconUrl)&&(d.icon.image=(null==l?void 0:l.iconUrl)?null==l?void 0:l.iconUrl:d.icon.image),(null==l?void 0:l.width)&&(null==l?void 0:l.height)&&(d.icon.size.width=(null==l?void 0:l.width)?null==l?void 0:l.width:d.icon.size.width,d.icon.size.height=(null==l?void 0:l.height)?null==l?void 0:l.height:d.icon.size.height),c&&(d.animate.on=!0,d.animate.radius=d.icon.size.width>=d.icon.size.height?.5*d.icon.size.width:.5*d.icon.size.height,d.animate.color="boolean"!=typeof c&&c.color?c.color:d.animate.color,d.animate.opacity="boolean"!=typeof c&&c.opacity?c.opacity:d.animate.opacity,d.animate.desireScale="boolean"!=typeof c&&c.desireScale?c.desireScale:d.animate.desireScale,d.animate.duration="boolean"!=typeof c&&c.duration?c.duration:d.animate.duration)),this.myLocationInfo.floorId=this.store.getDefaultFloorId(),this.myLocationInfo.location.x=i,this.myLocationInfo.location.y=r,u&&(this.myLocationInfo.location.z=u),this.myLocationInfo.isActive=a||!1,this.myLocationInfo.marker=d,this.setGPSOption(h)}getMyLocationInfo(){return this.myLocationInfo}setPosition(t){const e=o.DabeeoUtils.changeVector2Minus({x:t.x,y:t.y});this.myLocationInfo.location.x=e.x,this.myLocationInfo.location.y=e.y}clearMyLocationInfo(){this.myLocationInfo.floorId="",this.myLocationInfo.location={x:0,y:0,z:1},this.myLocationInfo.isActive=!1,this.myLocationInfo.marker=void 0}shouldRedrawMyLocation(t){let e=!1;return this.myLocationInfo.isActive&&this.myLocationInfo.marker&&t.id===this.myLocationInfo.floorId&&(e=!0),e}setGPSOption(t){(null==t?void 0:t.leftCourseDistance)&&(this.myLocationInfo.gpsOption.leftCourseDistance=t.leftCourseDistance),(null==t?void 0:t.willArriveRadius)&&(this.myLocationInfo.gpsOption.willArriveRadius=t.willArriveRadius),(null==t?void 0:t.arrivedRadius)&&(this.myLocationInfo.gpsOption.arrivedRadius=t.arrivedRadius),this.myLocationInfo.gpsOption.arrivedRadius>=this.myLocationInfo.gpsOption.willArriveRadius&&(console.error("'willArriveRadius' should be bigger than 'arrivedRadius'!"),this.myLocationInfo.gpsOption.willArriveRadius=50,this.myLocationInfo.gpsOption.arrivedRadius=25)}}},4469:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HandleIndexedDB=void 0;e.HandleIndexedDB=class{constructor(t){this.indexedDB=window.indexedDB,this.mapId=null,this.indexedDB?(this.mapId=t,this.create()):this.indexedDB}async write(t,e){if(!this.mapId)return;const i=this.indexedDB.open(this.mapId);i.onerror=t=>{console.error("DataBase Error",t.target.errorCod)},i.onsuccess=i=>{i.target.result.transaction([t],"readwrite").objectStore(t).add(e,t)}}async writeFloor(t,e){if(!this.mapId)return;const i=this.indexedDB.open(this.mapId);i.onerror=t=>{console.error("DataBase Error",t.target.errorCod)},i.onsuccess=i=>{const n=i.target.result.transaction("floor","readwrite").objectStore("floor"),r=e.payload.find((e=>e.id===t));n.add(r,t)}}load(t){return this.mapId?new Promise(((e,i)=>{if(!this.mapId)return;const n=this.indexedDB.open(this.mapId);n.onerror=t=>{console.error("DataBase Error",t.target.error),i(t.target.error),this.mapId=null},n.onsuccess=async i=>{const n=i.target.result.transaction([t],"readwrite").objectStore(t),r=await n.get(t);r.onsuccess=()=>{e(r.result)}}})):null}async loadFloor(t){if(!this.mapId)return null;if(Array.isArray(t)){const e=await Promise.all(t.map((async t=>await this.loadFloorData(t)))),i=e.filter((t=>void 0!==t));return i}return await this.loadFloorData(t)}update(t,e){return this.mapId?new Promise(((i,n)=>{if(!this.mapId)return;const r=this.indexedDB.open(this.mapId);r.onerror=t=>{console.error("DataBase Error",t.target.errorCod),n(t.target.errorCod)},r.onsuccess=async r=>{const s=r.target.result.transaction([t],"readwrite").objectStore(t);(await s.get(t)).onsuccess=r=>{const o=r.target.result;o.payload=e;const a=s.put(o,t);a.onerror=t=>{n(t)},a.onsuccess=()=>{i(!0)}}}})):null}reset(){return this.mapId?new Promise(((t,e)=>{if(!this.mapId)return;const i=this.indexedDB.open(this.mapId);i.onerror=t=>{console.error("DataBase Error",t.target.errorCod),e(t.target.errorCod)},i.onsuccess=async e=>{const i=e.target.result,n=i.transaction(["mapInfo"],"readwrite"),r=i.transaction(["floor"],"readwrite"),s=i.transaction(["pois"],"readwrite"),o=n.objectStore("mapInfo"),a=r.objectStore("floor"),l=s.objectStore("pois"),c=o.clear(),h=a.clear(),u=l.clear();c.onsuccess=()=>{},h.onsuccess=()=>{},u.onsuccess=()=>{t(!0)}}})):null}create(){if(!this.mapId)return;this.indexedDB.open(this.mapId).onupgradeneeded=t=>{const e=t.target.result;e.createObjectStore("mapInfo"),e.createObjectStore("pois"),e.createObjectStore("floor"),e.createObjectStore("version")}}loadFloorData(t){return this.mapId?new Promise(((e,i)=>{if(!this.mapId)return;const n=this.indexedDB.open(this.mapId);n.onerror=t=>{console.error("DataBase Error",t.target.errorCod),i(t.target.errorCod)},n.onsuccess=async i=>{const n=i.target.result.transaction("floor","readwrite").objectStore("floor"),r=await n.get(t);r.onsuccess=()=>{e(r.result)}}})):null}}},2682:function(t,e,i){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.LocalServer=void 0;const r=i(6486),s=i(2820),o=n(i(7218));e.LocalServer=class{constructor(t){t.mapId&&t.baseUrl?(this.mapId=t.mapId,this.path=t.baseUrl):console.error("mapId가 없거나 path가 없습니다.")}async getGroupCode(){let t;try{const e=`${this.path}/${this.mapId}.groupCode.json`,i=await window.fetch(e);t=await i.json()}catch(t){console.error("group code is not available!")}return null==t?void 0:t.codes}getFloorData(t){const e=Array.isArray(t)?t:[t],i=[],n=(0,r.cloneDeep)(this.data);return null==n||n.floors.forEach((t=>{e.forEach((e=>{e===t.id&&i.push(t)}))})),i.length>1?i:i[0]}async getMapInfo(){if(await this.readDataFromFile(),this.data)return(0,r.cloneDeep)(this.data);throw new Error("파일이 없습니다")}async getRouteDistance(t){if(!this.data)return null;const e=(0,r.cloneDeep)(this.data),i=new s.NetworkResponse("00",""),n=new s.NavigationRequest(e,s.ComputingType.RECOMMENDATION_TYPE),o=new s.DijkstraNavigationManager(n),a=t.splice(0,1),l=t.map((t=>{const e=[a[0],t];return o.getPath(e,1e4)}));i.setPayLoad(l);const c=i;return this.data,c.payload}async getRoute(t,e){if(!this.data)return null;e=e||[s.ComputingType.RECOMMENDATION_TYPE];const i=new s.NetworkResponse("00",""),n=(0,r.cloneDeep)(this.data);e.forEach((e=>{const r=new s.NavigationRequest(n,e),o=new s.DijkstraNavigationManager(r).getPath(t);i.addResponse(e,o)}));const o=i;return this.data,o.payload}async getPois(){let t=[];const e=(0,r.cloneDeep)(this.data);return null==e||e.floors.forEach((e=>{t=[...t,...e.pois]})),this.data,(0,r.cloneDeep)(t)}async readDataFromFile(){if(this.data)return;if(!this.path||!this.mapId)throw console.error("baseUrl 또는 mapId가 없어 파일이 지정되지 않았습니다"),new Error("파일이 지정되지 않았습니다");const t=`${this.path}/${this.mapId}.json`,e=await(0,o.default)(t);this.data=e.data,this.data?(this.data.floors.forEach((t=>{t.pois.forEach((t=>{t.iconUrl=`${this.path}${t.iconUrl}`}))})),this.data.themes.forEach((t=>{t.objectStyles.forEach((t=>{t.topPattern.url=t.topPattern.url?`${this.path}${t.topPattern.url}`:null,t.sidePattern.url=t.sidePattern.url?`${this.path}${t.sidePattern.url}`:null})),t.sectionStyles.forEach((t=>{t.topPattern.url=t.topPattern.url?`${this.path}${t.topPattern.url}`:null,t.sidePattern.url=t.sidePattern.url?`${this.path}${t.sidePattern.url}`:null}))}))):console.error(t,"지정한 경로에 데이타가 없습니다")}}},2082:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NetworkClient=void 0;const n=i(5925),r=i(2682),s=i(7296);e.NetworkClient=class{constructor(t){this.serverType=t.serverType||n.SERVER_TYPE.PRODUCTION,this.server=this.serverType===n.SERVER_TYPE.LOCAL?new r.LocalServer(t):new s.NetworkServer(t)}async getFloorData(t){return this.server.getFloorData(t)}async getMapInfo(){return this.server.getMapInfo()}async getGroupCode(){return this.server.getGroupCode()}async getPois(){return this.server.getPois()}async getRoute(t,e,i){return this.server.getRoute(t,e,null==i?void 0:i.server)}async getRouteDistance(t){return this.server.getRouteDistance(t)}}},7296:function(t,e,i){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.NetworkServer=void 0;const r=n(i(7218)),s=i(5925),o=i(1236),a=i(4469);class l{constructor(t){this.txId="",this.serverType=t.serverType||s.SERVER_TYPE.PRODUCTION,this.clientId=t.clientId||"",this.clientSecret=t.clientSecret||"",this.token="",this.handleIndexedDB=null}async getFloorData(t){var e;const i=await(null===(e=this.handleIndexedDB)||void 0===e?void 0:e.loadFloor(t));if(i)return i.length?i[0]:i;this.token=await this.getToken();const n={method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Bearer ${this.token}`,txId:this.txId},redirect:"follow"},a=Array.isArray(t)?t.join():t,l=this.serverType===s.SERVER_TYPE.STAGE?o.NETWORK_URL.STAGE.FLOOR:o.NETWORK_URL.PRODUCTION.FLOOR,c=await(0,r.default)(`${l}floors=${a}`,n),{data:h}=c;return h.payload.forEach((t=>{var e;null===(e=this.handleIndexedDB)||void 0===e||e.writeFloor(t.id,h)})),h.payload.length>1?h.payload:h.payload[0]}async getMapInfo(){var t,e,i,n,r,s;this.token=await this.getToken();const o=await this.getVersion();try{const a=await(null===(t=this.handleIndexedDB)||void 0===t?void 0:t.load("version"));a||await(null===(e=this.handleIndexedDB)||void 0===e?void 0:e.write("version",o)),a&&o.payload!==a.payload&&(await(null===(i=this.handleIndexedDB)||void 0===i?void 0:i.update("version",o.payload)),await(null===(n=this.handleIndexedDB)||void 0===n?void 0:n.reset()));const l=await(null===(r=this.handleIndexedDB)||void 0===r?void 0:r.load("mapInfo"));if("00"===(null==l?void 0:l.code))return l.payload;const c=await this.callMapInfo();return await(null===(s=this.handleIndexedDB)||void 0===s?void 0:s.write("mapInfo",c)),c.payload}catch(t){return(await this.callMapInfo()).payload}}async getGroupCode(){const t={method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Bearer ${this.token}`,txId:this.txId},redirect:"follow"},e=this.serverType===s.SERVER_TYPE.STAGE?o.NETWORK_URL.STAGE.GROUP:o.NETWORK_URL.PRODUCTION.GROUP,i=await(0,r.default)(e,t),{data:n}=i;return n.payload.codes}async getPois(){var t,e;try{const e=await(null===(t=this.handleIndexedDB)||void 0===t?void 0:t.load("pois"));if(e)return e.payload;throw new Error("loadData is empty")}catch(t){this.token=await this.getToken();const i={method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Bearer ${this.token}`,txId:this.txId},redirect:"follow"},n=this.serverType===s.SERVER_TYPE.STAGE?o.NETWORK_URL.STAGE.POI:o.NETWORK_URL.PRODUCTION.POI,a=await(0,r.default)(n,i),{data:l}=a;return null===(e=this.handleIndexedDB)||void 0===e||e.write("pois",l),l.payload}}async getRouteDistance(t){this.token=await this.getToken();const e={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`,txId:this.txId},redirect:"follow",data:JSON.stringify({locations:t})},i=this.serverType===s.SERVER_TYPE.STAGE?o.NETWORK_URL.STAGE.DISTANCE:o.NETWORK_URL.PRODUCTION.DISTANCE,n=await(0,r.default)(i,e),{data:a}=n;return a.payload}async getRoute(t,e,i){let n;this.token=await this.getToken(),n={"Content-Type":"application/json",Authorization:`Bearer ${this.token}`,txId:this.txId},i&&i instanceof l&&(i.token=await i.getToken(),n=Object.assign(Object.assign({},n),{Authorization2:`Bearer ${null==i?void 0:i.token}`}));const a={method:"POST",headers:n,redirect:"follow",data:JSON.stringify({locations:t,computingTypeList:e})},c=this.serverType===s.SERVER_TYPE.STAGE?o.NETWORK_URL.STAGE.NAVI:o.NETWORK_URL.PRODUCTION.NAVI,h=await(0,r.default)(c,a),{data:u}=h;return u.payload}async getToken(){if(this.token)return this.token;const t={"Content-Type":"application/x-www-form-urlencoded",Authorization:`Basic ${btoa(`${this.clientId}:${this.clientSecret}`)}`},e=new URLSearchParams;e.append("grant_type","client_credentials");const i={method:"POST",headers:t,data:e},n=this.serverType===s.SERVER_TYPE.STAGE?o.NETWORK_URL.STAGE.OAUTH:o.NETWORK_URL.PRODUCTION.OAUTH,l=await(0,r.default)(n,i),c=l.data;if(this.handleIndexedDB=new a.HandleIndexedDB(null==c?void 0:c.map_id),this.handleIndexedDB,200!==l.status)throw console.error("지도 권한 에러"),new Error("지도 요청 권한에 오류가 발생하였습니다. clientId와 clientSecret를 확인해주세요");return c.access_token}async callMapInfo(){const t={method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Bearer ${this.token}`,txId:this.txId},redirect:"follow"},e=this.serverType===s.SERVER_TYPE.STAGE?o.NETWORK_URL.STAGE.MAP:o.NETWORK_URL.PRODUCTION.MAP,i=(await(0,r.default)(e,t)).data;if("00"===i.code)return this.txId=i.payload.txId,i;throw console.error(i),new Error("network response is not OK!")}async getVersion(){this.token=await this.getToken();const t={method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Bearer ${this.token}`},redirect:"follow"},e=await(0,r.default)(o.NETWORK_URL.PRODUCTION.VERSION,t),{data:i}=e;return i}}e.NetworkServer=l},8721:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.Line=void 0;const o=s(i(5232));class a extends o.Line{constructor(t,e){super(t,e)}init(){}Start(){}Update(){}cleanup(){this.geometry.dispose(),Array.isArray(this.material)?this.material.forEach((t=>{t.dispose()})):this.material.dispose()}}e.Line=a},9428:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.MapObjectGroup=void 0;const a=s(i(5232)),l=s(i(6194)),c=s(i(140)),h=i(6486),u=o(i(7696)),d=i(4976),p=i(2676),f=i(8721),m=i(6202),g=i(9421),v=i(9377);class y extends p.Group{constructor(t,e,i,n){super("mapobject"),this.children=[],this.$d3g={transformSVGPath:Object},this.mergedMesh=null,this.mergedOutlineMesh=null,this.materialStates=new Map,this.materialTweens=new Map,(0,u.default)(this.$d3g),this.isTween=!1,this.mapObject3D=new d.MapObject3D(e),this.svgObjectList=t,this.mergedObjectGroup=new p.Group("mergedObject"),this.objectGroup=new p.Group("object"),this.sectionGroup=new p.Group("section"),this.textureManager=e,this.store=i,this.updateOption=null,this.indoorMapsManager=n}findObjectIdx(t){let e=-1;for(let i=0;i<this.objectGroup.children.length;i+=1)t===this.objectGroup.children[i].userData.id&&(e=i);return e}setIsTween(t){this.isTween=t}updateTween(){this.isTween&&l.update()}updateObjectStateByIds(t,e=null){if(this.updateOption=(0,h.cloneDeep)(t),this.updateOption){if(e&&e.locations){const t=null==e?void 0:e.locations[e.locations.length-1];if(!t.poiId)return;this.updateOption.ids=t.poiId}else this.updateOption.ids||(this.updateOption.ids=this.objectGroup.children.map((t=>t.userData.id)));if(this.updateOption.ids)return"string"==typeof this.updateOption.ids&&(this.updateOption.ids=[this.updateOption.ids]),this.store.getRenderObjectAnimation()&&this.store.setRenderObjectAnimation(!1),this.updateOption.ids.forEach((t=>{if(!(t="PO"===t.substring(0,2)?this.getCnntObjByPoiId(t):t))return;const e=this.getObjectByIds(t);e&&(this.resetObject(t),this.updateObjectMaterialAttr(e,this.updateOption,t))})),this.updateOption.isAnimate&&this.getTweenList().length>0?(this.setIsTween(!0),this.store.setRenderObjectAnimation(!0)):this.store.setRenderObjectAnimation(!1),this.store.setRenderDirty(!0),this.updateOption}}getObjectByIds(t){var e;const i=null===(e=this.objectGroup)||void 0===e?void 0:e.children.find((e=>e.userData.id===t));return i||(console.error(`요청한 object ${t}가 현재층에 존재하지 않습니다`),null)}saveMaterialTween(t,e){const i=this.materialTweens.get(e);i?i.push(t):(this.materialTweens.set(e,[]),this.saveMaterialTween(t,e))}tweenObjectAttr(t,e){const i=e.duration?e.duration:1e3,n=!!e.isYoyo&&e.isYoyo;let r=1;r=!0===e.isRepeat?1/0:1,l.add(t.to({opacity:1},i).onComplete((()=>{})).repeat(r).yoyo(n).start())}updateObjectMaterialAttr(t,e,i){if(t&&e&&(e.opacity||(e.opacity=1),"string"==typeof e.opacity&&(e.opacity=parseFloat(e.opacity)),m.DabeeoUtils.isEmpty(e.color)&&(e.color="#ff0000"),t.children[0]instanceof a.Mesh)){const n=[...t.children[0].material];this.saveMaterialState(n,i,t.children[0],e.isAnimate&&e.isRepeat||!1),n.forEach((t=>{if(t.color=new a.Color(e.color),e.opacity&&(t.opacity=e.opacity),t.transparent=!0,t.needsUpdate=!0,e.isAnimate){const n=new l.Tween(t);this.saveMaterialTween(n,i),this.tweenObjectAttr(n,e)}}))}}saveMaterialState(t,e,i,n){this.materialStates.set(e,t.map((t=>({material:t,initialValues:{color:t.userData.color,opacity:t.userData.opacity,transparent:t.transparent,needsUpdate:t.needsUpdate,url:t.userData.url,mesh:i,isRepeat:n}}))))}getCnntObjByPoiId(t){const e=this.store.findPoiById(t);return e?e.userData.objectId:(console.error(`요청한 poi id ${t}에 해당하는 object가 존재하지 않습니다`),null)}reset(t){let e=(0,h.cloneDeep)(t);e?("string"==typeof e&&(e=[e]),e.forEach((t=>{if(!(t="PO"===t.substring(0,2)?this.getCnntObjByPoiId(t):t))return;this.getObjectByIds(t)&&this.resetObject(t)}))):this.resetAllObjects(),this.store.getRenderObjectAnimation()&&this.store.setRenderObjectAnimation(!1),this.store.setRenderDirty(!0)}resetAllObjects(){this.stopAnimateOfObjects(),this.materialStates.forEach((t=>{this.resetMaterialStates(t)})),this.materialStates.clear(),this.store.setRenderObjectAnimation(!1)}getTweenList(){return l.getAll()}stopAnimateOfObjects(){this.isTween=!1,l.removeAll(),this.store.setRenderObjectAnimation(!1)}resetMaterialTweens(t){null==t||t.forEach((t=>{l.remove(t)}))}resetMaterialStates(t){null==t||t.forEach((t=>{t.material.color.set(t.initialValues.color),t.material.opacity=t.initialValues.opacity,t.material.transparent=t.initialValues.transparent,t.material.needsUpdate=t.initialValues.needsUpdate}))}resetObject(t){this.resetMaterialTweens(this.materialTweens.get(t)),this.resetMaterialStates(this.materialStates.get(t)),this.materialTweens.delete(t),this.materialStates.delete(t),this.store.setRenderObjectAnimation(!1)}async initMerge(){const t=await this.drawMergedMesh(),e=await this.drawMergedMeshOutline();this.mergedObjectGroup.add(t),this.mergedObjectGroup.add(e),this.add(this.mergedObjectGroup)}async drawMergedMeshOutline(){const t=[];for(let e=0;e<this.svgObjectList.length-1;e+=1){const i=this.store.getStyleMap().get(this.svgObjectList[e].getStyle().groupCode),n=(null==i?void 0:i.lineWidth)||1,r=(null==i?void 0:i.lineColor)?i.lineColor.toString():"#000000";let s=this.svgObjectList[e].getVolume();"object"===this.svgObjectList[e].getObjectType()&&(s+=4);const o=this.getOutlineGeometry(this.svgObjectList[e].getPaths(),s+.01,n);if(!o)continue;const l=o.getAttribute("position").count,h=3,u=m.DabeeoUtils.hexToRgb(r);if(u){const t=this.convertToShaderBufferAttribute(u,l,h,"Uint8");t&&o.setAttribute("lineCol",t)}const d=1,p=0===(null==i?void 0:i.lineOpacity)?.1:null==i?void 0:i.lineOpacity;if(p){const t=this.convertToShaderBufferAttribute(p,l,d,"Float32");t&&o.setAttribute("lineOpacity",t)}c.toTrianglesDrawMode(o,a.TriangleStripDrawMode),t.push(o)}const e=c.mergeBufferGeometries(t,!0),i=this.mapObject3D.getMergedOutlineMesh(e);return i.name="ObjectOutlineMergedMesh",i.userData.floorId=this.store.getDefaultFloorId(),this.mergedOutlineMesh&&(this.mergedObjectGroup.remove(this.mergedOutlineMesh),this.mergedObjectGroup.cleanup(),this.mergedOutlineMesh.geometry.dispose(),this.mergedOutlineMesh.remove()),this.mergedOutlineMesh=i,this.mergedOutlineMesh}async drawMergedMesh(){var t,e,i,n,r,s;const o=[];for(let l=0;l<this.svgObjectList.length-1;l+=1){const h=this.mapObject3D.getGeoFromPath(this.svgObjectList[l].getPaths(),this.svgObjectList[l].getVolume()+1),u=h.getAttribute("position").count,d=3,p=m.DabeeoUtils.hexToRgb(this.svgObjectList[l].getStyle().color.toString());if(p){const t=this.convertToShaderBufferAttribute(p,u,d,"Uint8");t&&h.setAttribute("color",t)}const f=m.DabeeoUtils.hexToRgb(this.svgObjectList[l].getStyle().sideColor.toString());if(f){const t=this.convertToShaderBufferAttribute(f,u,d,"Uint8");t&&h.setAttribute("sideCol",t)}const g=m.DabeeoUtils.hexToRgb((null===(t=this.store.getStyleMap().get(this.svgObjectList[l].getStyle().groupCode))||void 0===t?void 0:t.color.toString())||"#ffffff");if(g){const t=this.convertToShaderBufferAttribute(g,u,d,"Uint8");t&&h.setAttribute("topCol",t)}const v=1;let y=(null===(i=null===(e=this.svgObjectList[l].getStyle())||void 0===e?void 0:e.sidePattern)||void 0===i?void 0:i.url)?null===(n=this.svgObjectList[l].getStyle().sidePattern)||void 0===n?void 0:n.opacity:this.svgObjectList[l].getStyle().sideOpacity;y=0===y?.1:y;let _=(null===(r=this.svgObjectList[l].getStyle().topPattern)||void 0===r?void 0:r.url)?null===(s=this.svgObjectList[l].getStyle().topPattern)||void 0===s?void 0:s.opacity:this.svgObjectList[l].getStyle().opacity;if(_=0===_?.1:_,y){const t=this.convertToShaderBufferAttribute(y,u,v,"Float32");t&&h.setAttribute("sideOpacity",t)}if(_){const t=this.convertToShaderBufferAttribute(_,u,v,"Float32");t&&h.setAttribute("topOpacity",t)}c.toTrianglesDrawMode(h,a.TriangleStripDrawMode),o.push(h)}o.length;const l=c.mergeBufferGeometries(o,!0),h=this.mapObject3D.getMergedMesh(l);return h.position.z+=1,h.name="ObjectMergedMesh",h.userData.floorId=this.store.getDefaultFloorId(),this.mergedMesh&&(this.mergedObjectGroup.remove(this.mergedMesh),this.mergedObjectGroup.cleanup(),this.mergedMesh.cleanup()),this.mergedMesh=h,h}getOutlineGeometry(t,e,i){const n=this.$d3g.transformSVGPath(t).toShapes(!0)[0],r={strokeLineCap:v.SOLID_LINE_CAP_TYPE.ROUND,strokeLineJoin:v.SOLID_LINE_JOIN_TYPE.ROUND,strokeMiterLimit:4,strokeWidth:i},s=g.SVGLoader.pointsToStroke(n.getPoints(),r);return null==s||s.translate(0,0,e+1),n.autoClose=!0,s}initOutline(t,e,i,n,r){const s=this.$d3g.transformSVGPath(t).toShapes(!0)[0],o=new a.Color(e),l=s.getPoints(),c=(new a.BufferGeometry).setFromPoints(l),h=new f.Line(c,new a.LineBasicMaterial({color:o}));s.autoClose=!0,h.translateZ(i+1),r.add(h)}async init(){this.drawObjects(this.svgObjectList),this.add(this.objectGroup)}async drawObjects(t){var e,i,n,r,s,o,a;for(let l=0;l<t.length-1;l+=1){const c=new p.Group("item");c.userData={id:t[l].getId(),layerGroupCode:t[l].getObject().layerGroupCode};const h=this.mapObject3D.getGeoFromPath(t[l].getPaths(),t[l].getVolume());let u=(null===(i=null===(e=t[l].getStyle())||void 0===e?void 0:e.sidePattern)||void 0===i?void 0:i.url)?null===(n=t[l].getStyle().sidePattern)||void 0===n?void 0:n.opacity:t[l].getStyle().sideOpacity;u=0===u?.1:u;let d=(null===(r=t[l].getStyle().topPattern)||void 0===r?void 0:r.url)?null===(s=t[l].getStyle().topPattern)||void 0===s?void 0:s.opacity:t[l].getStyle().opacity;d=0===d?.1:d;const f=[{url:null===(o=t[l].getStyle().topPattern)||void 0===o?void 0:o.url,color:t[l].getStyle().color,opacity:d,lambert:!1},{url:null===(a=t[l].getStyle().sidePattern)||void 0===a?void 0:a.url,color:t[l].getStyle().sideColor?t[l].getStyle().sideColor:t[l].getStyle().color,opacity:u,lambert:!0}],m=this.mapObject3D.getMesh(h,f);m.userData={id:t[l].getId(),title:t[l].getObject().title,type:t[l].getStyle().groupCode,layerGroupCode:t[l].getObject().layerGroupCode,mouseover:!1},m.position.z=t[l].getObject().position.z,"object"===t[l].getObjectType()&&(m.position.z+=1),c.add(m);const g=this.store.getStyleMap().get(t[l].getStyle().groupCode);let v=t[l].getVolume();"object"===t[l].getObjectType()&&(v+=1),this.initOutline(t[l].getPaths(),g?g.lineColor:"#000000",v,.4,c);const y=t[l].getMapId();if(y&&y!==this.store.getMapInfo().getId()){const t=this.indoorMapsManager.getIndoorMapGap(y);t&&(c.position.z+=t)}this.updateTexture(t[l],m,"top"),this.updateTexture(t[l],m,"side"),this.objectGroup.add(c)}}updateTexture(t,e,i){var n,r,s,o,l,c,h,u,d,p,f;let m=(null===(n=t.getStyle().topPattern)||void 0===n?void 0:n.url)||"",g=null===(r=t.getStyle().topPattern)||void 0===r?void 0:r.repeat,v=(null===(s=t.getStyle().topPattern)||void 0===s?void 0:s.scale)||0,y=(null===(o=t.getStyle().topPattern)||void 0===o?void 0:o.rotate)||0,_=(null===(l=t.getStyle().topPattern)||void 0===l?void 0:l.size)||{width:0,height:0};if("side"===i&&(m=(null===(c=t.getStyle().sidePattern)||void 0===c?void 0:c.url)||"",g=null===(h=t.getStyle().sidePattern)||void 0===h?void 0:h.repeat,v=(null===(u=t.getStyle().sidePattern)||void 0===u?void 0:u.scale)||0,y=(null===(d=t.getStyle().sidePattern)||void 0===d?void 0:d.rotate)||0,_=(null===(p=t.getStyle().sidePattern)||void 0===p?void 0:p.size)||{width:0,height:0}),""!==m){const t=this.textureManager.getTexture(m),n=null===(f=null==t?void 0:t.tex)||void 0===f?void 0:f.clone();if(n&&void 0!==n){if(n.needsUpdate=!0,g)n.wrapS=a.RepeatWrapping,n.wrapT=a.RepeatWrapping,n.repeat.set(v/15e3,v/15e3);else{n.wrapS=a.RepeatWrapping,n.wrapT=a.RepeatWrapping;const t=125/(_.width/5*130)*14,e=125/(_.height/5*130)*14;n.repeat.set(t,e)}n.rotation=a.MathUtils.degToRad(y),Array.isArray(e.material)&&("top"===i?e.material[0]instanceof a.MeshBasicMaterial&&(e.material[0].map=n,e.material[0].needsUpdate=!0):"side"===i&&e.material[1]instanceof a.MeshLambertMaterial&&(e.material[1].map=n,e.material[1].needsUpdate=!0))}}}getSectionGroup(){return this.sectionGroup}getObjectGroup(){return this.objectGroup}Start(){}mergedObjectOn(){this.objectGroup.visible&&(this.objectGroup.visible=!1),this.mergedObjectGroup.visible||(this.mergedObjectGroup.visible=!0)}mergedObjectOff(){this.objectGroup.visible||(this.objectGroup.visible=!0),this.mergedObjectGroup.visible&&(this.mergedObjectGroup.visible=!1)}checkRepeat(){this.materialStates&&this.materialStates.forEach((t=>{t[0].initialValues.isRepeat&&this.store.setRenderObjectAnimation(!0)}))}showObject(t){var e;const i=null===(e=this.store)||void 0===e?void 0:e.getCurObjectGroup();if(i){const e=[...i.children].find((e=>e.userData.id===t));e?e.visible=!0:console.error(`요청한 ${t}는 현재층에 존재하지 않습니다.`)}}hideObject(t){var e;const i=null===(e=this.store)||void 0===e?void 0:e.getCurObjectGroup();if(i){const e=[...i.children].find((e=>e.userData.id===t));e?e.visible=!1:console.error(`요청한 ${t}는 현재층에 존재하지 않습니다.`)}}showAllObject(){var t;const e=null===(t=this.store)||void 0===t?void 0:t.getCurObjectGroup();e&&e.children.forEach((t=>{t.visible=!0}))}hideAllObject(){var t;const e=null===(t=this.store)||void 0===t?void 0:t.getCurObjectGroup();e&&e.children.forEach((t=>{t.visible=!1}))}showObjectByCode(t,e){this.setVisibilityByCode(t,!0),e&&e.forEach((t=>this.setVisibilityByCode(t,!0)))}hideObjectByCode(t,e){this.setVisibilityByCode(t,!1),e&&e.forEach((t=>this.setVisibilityByCode(t,!1)))}addObjects(t){this.drawObjects(t)}removeObjects(t){t.map((t=>t.getId())).forEach((t=>{const e=this.findObjectItemGroup(t);e.cleanup(),e.removeFromParent()}))}updateSvgObjectList(t){this.svgObjectList=t}findObjectItemGroup(t){return this.objectGroup.children.find((e=>e.userData.id===t))}setVisibilityByCode(t,e){var i;const n=null===(i=this.store)||void 0===i?void 0:i.getCurObjectGroup();n&&n.children.forEach((i=>{i.userData.layerGroupCode===t&&(i.visible=e)}))}convertToShaderBufferAttribute(t,e,i,n){let r=null;if("Uint8"===n?r=new Uint8Array(i*e):"Float32"===n&&(r=new Float32Array(i*e)),!r)return null;Array.isArray(t)?r.forEach(((e,n)=>{r[n]=t[n%i]})):r.forEach(((e,i)=>{r[i]=t}));return new a.BufferAttribute(r,i,!0)}Update(){this.updateTween(),this.checkRepeat();for(let t=0;t<this.children.length;t++)void 0!==this.children[t].Update&&this.children[t].Update()}}e.MapObjectGroup=y},4976:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.MapObject3D=void 0;const a=s(i(5232)),l=i(5232),c=o(i(7696)),h=o(i(7161)),u=o(i(9783)),d=o(i(8783)),p=o(i(9487)),f=i(4925);class m extends a.Object3D{constructor(t){super(),this.children=[],this.$d3g={transformSVGPath:Object},(0,c.default)(this.$d3g),this.textureManager=t}getMergedMesh(t){const e=new a.ShaderMaterial({uniforms:{dirLightColor:{value:new a.Vector3(1,1,1)},dirLightDirection:{value:new a.Vector3(30,70,300).normalize()},ambientColor:{value:new a.Vector3(1,1,1)},ambientIntensity:{value:.05}},vertexColors:!0,vertexShader:h.default,fragmentShader:u.default,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1,transparent:!0}),i=new f.Mesh(t,e);return i.Update=this.Update,i}getMergedOutlineMesh(t){const e=new a.ShaderMaterial({uniforms:{dirLightColor:{value:new a.Vector3(1,1,1)}},vertexColors:!0,vertexShader:d.default,fragmentShader:p.default,transparent:!1});return new l.LineSegments(t,e)}getMesh(t,e){const i=[],n=[];e.forEach((t=>{const{opacity:e}=t,r=this.addMaterial(t);r.transparent=!(e/100>.99),i.push(r),t.pattern&&n.push(t.pattern)}));let r=new f.Mesh(t,i);return 0===i[0].opacity&&(r=new f.Mesh(t,i[1])),r.receiveShadow=!0,r.Update=this.Update,r}getGeoFromPath(t,e){const i=this.$d3g.transformSVGPath(t).toShapes(!0)[0];return new a.ExtrudeGeometry(i,{depth:e||1,bevelEnabled:!1})}addMaterial(t){var e;const i=t.lambert?new l.MeshLambertMaterial:new l.MeshBasicMaterial,{url:n,color:r}=t,s=Number(t.opacity)/100,o=n?null===(e=this.textureManager.getTexture(n))||void 0===e?void 0:e.tex:null;return i.color=new a.Color(r),i.map=o||null,i.opacity=s,i.userData={color:r,url:n,opacity:s},i}Start(){}Update(){}cleanup(){}}e.MapObject3D=m},2285:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.Points=void 0;const o=s(i(5232));class a extends o.Points{constructor(t,e){super(t,e)}init(){}Start(){}Update(){}cleanup(){var t;this.geometry.dispose(),Array.isArray(this.material)?this.material.forEach((t=>{var e;t instanceof o.PointsMaterial&&(null===(e=t.map)||void 0===e||e.dispose(),t.map=null),t.dispose()})):(this.material instanceof o.PointsMaterial&&(null===(t=this.material.map)||void 0===t||t.dispose(),this.material.map=null),this.material.dispose())}}e.Points=a},2676:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.Group=void 0;const o=s(i(5232));class a extends o.Group{constructor(t){super(),this.children=[],this.name=t}init(){}Start(){}Update(){for(let t=0;t<this.children.length;t++)void 0!==this.children[t].Update&&this.children[t].Update()}cleanup(){for(let t=0;t<this.children.length;t++)void 0!==this.children[t].cleanup&&this.children[t].cleanup();this.clear()}}e.Group=a},4925:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.Mesh=void 0;const o=s(i(5232));class a extends o.Mesh{constructor(t,e){super(t,e),this.children=[]}init(){}Start(){}Update(){}cleanup(){var t;this.children.length&&(this.children.forEach((t=>{t.cleanup()})),this.clear()),this.geometry.dispose(),Array.isArray(this.material)?this.material.forEach((t=>{var e;(t instanceof o.MeshBasicMaterial||t instanceof o.MeshLambertMaterial)&&(null===(e=t.map)||void 0===e||e.dispose(),t.map=null),t.dispose()})):((this.material instanceof o.MeshBasicMaterial||this.material instanceof o.MeshLambertMaterial)&&(null===(t=this.material.map)||void 0===t||t.dispose(),this.material.map=null),this.material.dispose())}}e.Mesh=a},6969:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.Sprite=void 0;const o=s(i(5232));class a extends o.Sprite{constructor(t){super(t)}init(){}Start(){}Update(){}cleanup(){this.children.length&&(this.children.forEach((t=>{t.cleanup()})),this.clear()),this.geometry.dispose(),Array.isArray(this.material)?this.material.forEach((t=>{t.map&&(t.map.dispose(),t.map=null),t.dispose()})):(this.material.map&&(this.material.map.dispose(),this.material.map=null),this.material.alphaMap&&(this.material.alphaMap.dispose(),this.material.alphaMap=null),this.material.dispose())}}e.Sprite=a},3478:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MapOverlayGroup=void 0;const n=i(2676),r=i(8939),s=i(932),o=i(3833);class a extends n.Group{constructor(t,e,i,n,r,s){super("overlayGroup"),this.children=[],this.store=t,this.cameraController=e,this.rendererClass=i,this.preprocessing=n,this.eventDispatcher=r,this.overlayManager=s}init(){}Update(){for(let t=0;t<this.children.length;t++)void 0!==this.children[t].Update&&this.children[t].Update()}async addLayer(t){const{type:e}=t;"heatmap"===e&&this.addHeatmapLayer(t),"model"===e&&await this.addModelLayer(t),"polygon"===e&&this.addPolygonLayer(t),this.store.setRenderDirty(!0)}removeLayer(t){this.children.find((e=>e.userData.sourceName===t)).removeLayer(),this.store.setRenderDirty(!0)}getHeatmapLayer(){return this.heatmapGroup}getModelLayer(){return this.modelGroup}getPolygonLayer(){return this.polygonGroup}addHeatmapLayer(t){const e=this.overlayManager.getSourceData(t.source);e&&(this.heatmapGroup=new r.MapHeatmapGroup(this.store,this.cameraController,this.rendererClass,this.preprocessing,e),this.heatmapGroup.userData.sourceName=t.source,this.heatmapGroup.setHeatmapOption(t.paint),this.heatmapGroup.addHeatmapPoints(),this.heatmapGroup.setHeatmapOpacity(),this.heatmapGroup.setHeatmapColors(),this.heatmapGroup.init(),this.add(this.heatmapGroup))}async addModelLayer(t){const e=this.overlayManager.getSourceData(t.source);e&&(this.modelGroup=new s.MapModelGroup(this.eventDispatcher,this.rendererClass,this.store,e),this.modelGroup.userData.sourceName=t.source,await this.modelGroup.addOverlayModels(),this.add(this.modelGroup))}addPolygonLayer(t){const e=this.overlayManager.getSourceData(t.source);e&&(this.polygonGroup=new o.MapPolygonGroup(this.store,e),this.polygonGroup.userData.sourceName=t.source,this.polygonGroup.setPolygonOption(t.paint),this.polygonGroup.addOverlayPolygons(),this.add(this.polygonGroup))}}e.MapOverlayGroup=a},1858:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.OverlayManager=void 0;const n=i(6486),r=i(6202);e.OverlayManager=class{constructor(t,e){this.store=t,this.geoJsonManager=e,this.source=new Map}async setSourceData(t,e){if(this.source.get(t))return;const{type:i}=e,n=e.data;let r;"geojson"===i&&(r=await this.geoJsonManager.makeGeoJsonData(n)),"json"===i&&(r=await this.makeJsonData(n)),r&&this.source.set(t,r)}getSourceData(t){const e=this.source.get(t);return(0,n.cloneDeep)(e)}removeSourceData(t){this.source.delete(t)}async makeJsonData(t){try{const e=await fetch(t).then((t=>t.json()));return e.models.forEach((t=>{t.transform.position=r.DabeeoUtils.changeVectorMinus(t.transform.position)})),e}catch(e){return console.error(`파일 ${t}을 가져오는 동안 network error가 발생하였습니다`),console.error(e),null}}}},1277:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.HeatmapColorDataManager=void 0;const o=s(i(5232));e.HeatmapColorDataManager=class{constructor(){this.heatmapColorDataList=[{density:0,color:{r:0,g:0,b:0}},{density:0,color:{r:0,g:0,b:0}},{density:0,color:{r:0,g:0,b:0}},{density:0,color:{r:0,g:0,b:0}}]}getHeatmapColorDataList(){return this.heatmapColorDataList}setHeatmapColorDataList(t){this.heatmapColorDataList=t}getColorList(){return this.heatmapColorDataList.map((t=>new o.Vector3(t.color.r,t.color.g,t.color.b)))}getDensityList(){return this.heatmapColorDataList.map((t=>t.density))}sortColorDataListByDensity(){return this.heatmapColorDataList.sort(((t,e)=>e.density-t.density))}normalizeColorData(){this.heatmapColorDataList.forEach((t=>{t.color.r/=255,t.color.g/=255,t.color.b/=255}))}}},8939:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.MapHeatmapGroup=void 0;const o=s(i(5232)),a=i(2676),l=i(5670),c=i(4456);class h extends a.Group{constructor(t,e,i,n,r){super("heatmapGroup"),this.children=[],this.store=t,this.cameraController=e,this.rendererClass=i,this.preprocessing=n,this.mapHeatmapPlane=new l.MapHeatmapPlane(t,e),this.mapPointMeshGroup=new c.MapPointMeshGroup(t,e);const s=this.store.getMapInfo().getSize().height/this.store.getMapInfo().getSize().width,a=this.rendererClass.getRenderer().capabilities.maxTextureSize/4,h=a*s;this.renderTarget=new o.WebGLRenderTarget(a,h),this.rtScene=new o.Scene,this.heatmapOption={heatmapRadius:8,heatmapOpacity:1,heatmapColor:[{density:.8,color:{r:255,g:0,b:0}},{density:.6,color:{r:255,g:254,b:0}},{density:.4,color:{r:62,g:255,b:3}},{density:0,color:{r:54,g:123,b:227}}]},this.data=r}init(){this.add(this.mapHeatmapPlane),this.rtScene.add(this.mapPointMeshGroup),this.mapHeatmapPlane.init(),this.mapPointMeshGroup.init(),this.mapHeatmapPlane.setTexture(this.renderTarget.texture)}Update(){for(let t=0;t<this.children.length;t++)void 0!==this.children[t].Update&&this.children[t].Update();this.cameraController.updateRTCameraZoom(this.mapHeatmapPlane.scale),this.mapPointMeshGroup.Update(),this.rendererClass.renderToRenderTarget(this.renderTarget,this.rtScene,this.cameraController.rtCamera);const t=this.cameraController.getCurrentCmFromPixel(2*this.heatmapOption.heatmapRadius)/2;this.mapHeatmapPlane.updateBlurSize(t)}setHeatmapOption(t){const e=this.filterSourceOption(t);this.heatmapOption=Object.assign(this.heatmapOption,e)}addHeatmapPoints(){if(this.data){const t=this.data[0].geometry.coordinates.map((t=>({x:t[0],y:t[1]})));this.mapPointMeshGroup.addHeatmapPoints(t,this.heatmapOption.heatmapRadius)}}setHeatmapOpacity(){this.mapHeatmapPlane.setOpacity(this.heatmapOption.heatmapOpacity)}setHeatmapColors(){this.mapHeatmapPlane.setColors(this.heatmapOption.heatmapColor)}removeLayer(){this.mapPointMeshGroup.cleanup(),this.cleanup(),this.rtScene.clear(),this.renderTarget.dispose(),this.removeFromParent()}filterSourceOption(t){const e=Object.assign({},t);return e.heatmapColor&&4!==e.heatmapColor.length&&delete e.heatmapColor,e}}e.MapHeatmapGroup=h},5670:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.MapHeatmapPlane=void 0;const a=s(i(5232)),l=i(4925),c=o(i(5909)),h=o(i(1468)),u=i(1277);class d extends l.Mesh{constructor(t,e){super(new a.PlaneGeometry(1,1,10,10),new a.RawShaderMaterial({uniforms:{texture:{value:null},blurSize:{value:0},resolution:{value:new a.Vector2(1,1)},planeOpacity:{value:1},colorList:{value:[new a.Vector3(0,0,0),new a.Vector3(0,0,0),new a.Vector3(0,0,0),new a.Vector3(0,0,0)]},densityList:{value:[0,0,0,0]}},vertexShader:c.default,fragmentShader:h.default,transparent:!0,depthTest:!1})),this.children=[],this.store=t,this.cameraController=e,this.userData.type="overlay"}init(){this.setPosition(),this.setScale()}setPosition(){const t=this.store.getMapInfo().getSize().width/2,e=-this.store.getMapInfo().getSize().height/2,i=this.store.getMaxObjZ();this.translateX(t),this.translateY(e),this.translateZ(i)}setScale(){const t=this.store.getMapInfo().getSize().width,e=this.store.getMapInfo().getSize().height;this.userData.size={width:t,height:e};const i=this.cameraController.getCurrentCmFromPixel(t),n=this.cameraController.getCurrentCmFromPixel(e);this.scale.set(i,n,1)}setTexture(t){this.material instanceof a.RawShaderMaterial&&(this.material.uniforms.texture.value=t)}setOpacity(t){this.material instanceof a.RawShaderMaterial&&(this.material.uniforms.planeOpacity.value=t)}setColors(t){if(this.material instanceof a.RawShaderMaterial){const e=new u.HeatmapColorDataManager;e.setHeatmapColorDataList(JSON.parse(JSON.stringify(t))),e.sortColorDataListByDensity(),e.normalizeColorData(),this.material.uniforms.colorList.value=e.getColorList(),this.material.uniforms.densityList.value=e.getDensityList()}}Update(){this.updatePlaneScaleByMapScale(),this.updateResolution()}updatePlaneScaleByMapScale(){const t=this.cameraController.getCurrentCmFromPixel(this.userData.size.width),e=this.cameraController.getCurrentCmFromPixel(this.userData.size.height);this.scale.set(t,e,1)}updateResolution(){this.material instanceof a.RawShaderMaterial&&this.material.uniforms.resolution.value.set(this.scale.x,this.scale.y)}updateBlurSize(t){this.material instanceof a.RawShaderMaterial&&(this.material.uniforms.blurSize.value=t)}}e.MapHeatmapPlane=d},2040:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.MapPointMesh=void 0;const a=s(i(5232)),l=i(4925),c=o(i(1916)),h=o(i(1416));class u extends l.Mesh{constructor(t,e){super(new a.PlaneGeometry(1,1,1,1),new a.RawShaderMaterial({uniforms:{radius:{value:.5}},vertexShader:c.default,fragmentShader:h.default,transparent:!0})),this.children=[],this.name="MapPointMesh",this.store=t,this.cameraController=e}setPosition(t,e,i){this.position.set(t,e,i)}setScale(t){this.userData.size={width:t,height:t};const e=this.cameraController.getCurrentCmFromPixel(t),i=this.cameraController.getCurrentCmFromPixel(t);this.scale.set(e,i,1)}Update(){this.updatePointMeshScaleByMapScale()}updatePointMeshScaleByMapScale(){const t=this.cameraController.getCurrentCmFromPixel(this.userData.size.width),e=this.cameraController.getCurrentCmFromPixel(this.userData.size.height);this.scale.set(t,e,1)}}e.MapPointMesh=u},4456:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MapPointMeshGroup=void 0;const n=i(2676),r=i(2040);class s extends n.Group{constructor(t,e){super("pointsMeshGroup"),this.children=[],this.store=t,this.cameraController=e}init(){this.setPosition()}setPosition(){const t=-this.store.getMapInfo().getSize().width/2,e=this.store.getMapInfo().getSize().height/2;this.translateX(t),this.translateY(e)}Update(){for(let t=0;t<this.children.length;t++)void 0!==this.children[t].Update&&this.children[t].Update()}addHeatmapPoints(t,e){t.forEach((t=>{const i=new r.MapPointMesh(this.store,this.cameraController);i.setPosition(t.x,t.y,0),i.setScale(2*e),this.add(i)}))}}e.MapPointMeshGroup=s},932:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.MapModelGroup=void 0;const o=s(i(5232)),a=i(7011),l=i(6023),c=i(1217),h=i(2676);class u extends h.Group{constructor(t,e,i,n){super("modelGroup"),this.eventDispatcher=t,this.rendererClass=e,this.store=i,this.data=n}init(){}Update(){}async addOverlayModels(){if(this.data){const t=this.data.models.map((async t=>{await this.addModel(t)}));await Promise.all(t)}this.eventDispatcher.dispatchModelLoadComplete(),this.store.setRenderDirty(!0)}async addModel(t){const e=await this.uploadModel(t);e&&(this.add(e),this.updateModel(t),this.store.setRenderDirty(!0))}removeModel(t){const e=this.findModel(t);this.disposeModel(e),this.store.setRenderDirty(!0)}updateModel(t){const e=this.findModel(t.modelName);if(e){const{position:i,rotation:n,scale:r}=t.transform;e.position.set(i.x,i.y,i.z),e.rotation.set(o.MathUtils.degToRad(n.x),o.MathUtils.degToRad(n.y),o.MathUtils.degToRad(n.z)),e.scale.set(r.x,r.y,r.z),this.store.setRenderDirty(!0)}}removeLayer(){this.removeAllModels(),this.cleanup(),this.removeFromParent()}findModel(t){return this.getObjectByName(t)}async uploadModel(t){let e;const{type:i,fileName:n,modelName:r}=t;if("obj"===i){const t=await this.loadMTL(`${n}.mtl`);e=await this.loadObj(`${n}.obj`,t)}return"gltf"===i&&(e=await this.loadGltf(`${n}.glb`),this.setGltfOptions(e)),e&&(e.name=r),e}setGltfOptions(t){t.traverse((t=>{if("Mesh"===t.type){const{material:e}=t;e.emissiveMap||(e.emissiveMap=e.map,e.emissive=new o.Color(1,1,1),e.color=new o.Color(.1,.1,.1),e.map=null),e.emissiveMap&&this.rendererClass.initTexture(e.emissiveMap)}}))}async loadObj(t,e){const i=new a.OBJLoader;return i.setMaterials(e),new Promise(((e,n)=>{i.load(t,(t=>{e(t)}),(()=>{}),(t=>{n(new Error(".obj file load failed")),console.error(t)}))}))}async loadMTL(t){const e=new l.MTLLoader;return new Promise(((i,n)=>{e.load(t,(t=>{t.preload(),i(t)}),(()=>{}),(e=>{n(new Error(".mtl file load failed")),console.error(`요청한 모델 파일 ${t}을 네트워트를 통해 가지고 오는 동안 에러가 발생하였습니다.`)}))}))}async loadGltf(t){const e=new c.GLTFLoader;return new Promise(((i,n)=>{e.load(t,(t=>{i(t.scene)}),(()=>{}),(e=>{n(new Error(".glb file load failed")),console.error(`요청한 모델 파일 ${t}을 네트워크를 통해 가지고 오는 동안 에러가 발생하였습니다.`)}))}))}disposeModel(t){t&&(t.traverse((t=>{"Mesh"===t.type&&(this.disposeMaterial(t.material),this.disposeGeometry(t.geometry))})),t.clear(),t.removeFromParent())}disposeMaterial(t){var e,i;Array.isArray(t)?t.forEach((t=>{this.disposeMaterial(t)})):(null===(e=t.map)||void 0===e||e.dispose(),null===(i=t.emissiveMap)||void 0===i||i.dispose(),t.dispose())}disposeGeometry(t){t.dispose()}removeAllModels(){this.children.forEach((t=>{this.disposeModel(t)}))}}e.MapModelGroup=u},9851:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TestModelDataManager=void 0;const n=i(6486),r=i(6202);e.TestModelDataManager=class{constructor(){this.modelDataList=new Map}getModelData(t){return(0,n.cloneDeep)(this.modelDataList.get(t))}getAllModelData(){const t=[];return this.modelDataList.forEach((e=>{const i=this.convertModelData(e);t.push(i)})),t}setModelData(t){const e=this.convertModelData(t);this.modelDataList.set(e.modelName,e)}deleteModelData(t){this.modelDataList.delete(t)}convertModelData(t){const e=(0,n.cloneDeep)(t);return e.transform.position=r.DabeeoUtils.changeVectorMinus(e.transform.position),e}}},3833:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MapPolygonGroup=void 0;const n=i(2676),r=i(8440),s=i(3379);class o extends n.Group{constructor(t,e){super("polygonGroup"),this.store=t,this.polygonOption={polygonPositionZ:this.store.getMaxObjZ()+10},this.data=e}init(){}Update(){}setPolygonOption(t){this.polygonOption=Object.assign(Object.assign({},this.polygonOption),t)}addOverlayPolygons(){this.data&&this.data.forEach((t=>{const e={type:t.geometry.type,coordinates:t.geometry.coordinates,properties:t.properties};this.addPolygon(e)}))}removeLayer(){this.cleanup(),this.removeFromParent()}addPolygon(t){if("Point"===t.type||"MultiPoint"===t.type){const e=new s.MapPolygonPoints(t);e.position.z=this.polygonOption.polygonPositionZ,this.add(e)}else{const e=new r.MapPolygonMesh(t);e.setPosition(0,0,this.polygonOption.polygonPositionZ),this.add(e)}}}e.MapPolygonGroup=o},8440:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MapPolygonMesh=void 0;const n=i(1097),r=i(4925);class s extends r.Mesh{constructor(t){const e=new n.GeoJson,{type:i,coordinates:r,properties:s}=t,o=e.getJsonGeometry(i,{coordinates:r,properties:s}),a=e.getJsonMaterial(i,s,s.texture);a.transparent=!0,super(o,a)}init(){}Update(){}setPosition(t,e,i){this.position.set(t,e,i)}}e.MapPolygonMesh=s},3379:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MapPolygonPoints=void 0;const n=i(1097),r=i(2285);class s extends r.Points{constructor(t){const e=new n.GeoJson,{type:i,coordinates:r,properties:s}=t;super(e.getJsonGeometry(i,{coordinates:r,properties:s}),e.getJsonMaterial(i,s,s.texture))}init(){}Update(){}}e.MapPolygonPoints=s},3544:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.MapPoiGroup=void 0;const o=s(i(5232)),a=i(6486),l=i(5013),c=i(2676),h=i(4925),u=i(2285),d=i(4598),p=i(6250),f=i(2129),m=i(7709),g=i(6202),v="x",y="y",_="z",x="";class M extends c.Group{constructor(t,e,i,n,r,s){super("mapPoiGroup"),this.isPoiLevel=null,this.poiDataList=t,this.store=e,this.textureManager=i,this.renderer=n,this.cameraController=r,this.preprocessing=s,this.zCordsObj=this.store.getMaxObjZ(),this.defaultFloor=this.store.getDefaultFloor(),this.mapOptions=this.store.getMapOptions(),this.mapInfo=this.store.getMapInfo(),this.scene=this.renderer.getScene(),this.container=this.renderer.getConianer(),this.poiGroup=new f.PoiGroup,this.canvasStacks=[],this.isPoiLevel=!!this.mapOptions.poiLevel,this.poiLevel={top:this.mapOptions.poiLevel?this.mapOptions.poiLevel[0]:100,middle:this.mapOptions.poiLevel?this.mapOptions.poiLevel[1]:150,bottom:this.mapOptions.poiLevel?this.mapOptions.poiLevel[2]:200},this.maxSection=0,this.center=e.getCenter(),this.frustumSize=Math.max(this.mapInfo.getSize().width,this.mapInfo.getSize().height)/1.2,this.mapOptions.isForCapture&&(this.frustumSize=Math.max(this.mapInfo.getSize().width,this.mapInfo.getSize().height)),this.poiSyncDefaultSizeRatio=this.frustumSize/350,this.overlayGroup=new c.Group("overlayGroup"),this.overlayBoxes=[],this.dotBuckets=[],this.dotBucketsGroup=new c.Group("dotBucketGroup"),this.poiLength=0,this.showPoiDebugingBox=!1,this.useCollisionTest=this.mapOptions.enablePoiCollisionTest,this.showGrid=!1,this.worldScale=new o.Vector3,this.mvPosition=new o.Vector3,this.alignedPosition=new o.Vector2,this.rotatedPosition=new o.Vector2,this.viewWorldMatrix=new o.Matrix4,this.p1=new o.Vector3,this.p2=new o.Vector3,this.p3=new o.Vector3,this.p4=new o.Vector3,this.pointArr=[this.p1,this.p2,this.p3,this.p4],this.pointValues=[[-.5,-.5,0],[.5,-.5,0],[.5,.5,0],[-.5,.5,0]],this.passTime=0,this.passTimeOver=.8,this.poiIdsOnNavi=[],this.gridDivide=25,this.gridClass=new l.GridClass(window.innerWidth+200,window.innerHeight+200,this.gridDivide),this.textAllowOverlap=!1,this.isSyncPOI=!0}setObjVolume(t){const e=new Map;return t.forEach((t=>{e.set(t.id,t.volume)})),e}initPoi(t,e,i){const n=t.objectId?e.get(t.objectId):this.maxSection,r=new m.PoiItemGroup,{x:s,y:o}=t.position,l=n||this.maxSection;if("NONE"!==t.displayType){switch(void 0!==t.face&&null!==t.face||(t.face="FLOATING"),t.displayType){case"ALL":this.drawPoiIcon(t,r,this.drawPoiTitle(t,r,i));break;case"ICON":this.drawPoiIcon(t,r,null);break;case"TITLE":r.add(this.drawPoiTitle(t,r,i))}Object.assign(r.userData,(0,a.cloneDeep)(t)),this.mapOptions.spriteEnable&&"FLOATING"===t.face||this.setRotateToPoi(r,t.rotate&&0!==t.rotate?t.rotate:-this.mapInfo.getNorthReference(),x)}r.position.set(s,o,l+3),r.userData.volume=l+3,r.userData.face=t.face,r.userData.show=!0,r.userData.mouseover=!1,r.userData.id=t.id,this.poiGroup.add(r),this.showGrid&&(this.resetGridClass(),this.showGridBox())}init(){this.drawPois(this.poiDataList),this.add(this.poiGroup)}drawPois(t){if(!this.defaultFloor)return;const e=this.setObjVolume(this.defaultFloor.objects);t.forEach((t=>{this.initPoi(t,e)})),this.isPoiLevel&&this.poiZoomToggle(),this.store.setDirtyIfNotCommit()}setRotateToPoi(t,e,i){if(t)switch(i){case v:t.rotation.x=-(e||0)*Math.PI/180;break;case y:t.rotation.y=-(e||0)*Math.PI/180;break;case _:t.rotation.z=-(e||0)*Math.PI/180;break;default:t.rotateZ(-(e||0)*Math.PI/180)}}disposeCanvasContext2D(){for(let t=0;t<this.store.getCanvasStacks().length;t++)this.store.getCanvasStacks()[t].width=0,this.store.getCanvasStacks()[t].height=0,delete this.store.getCanvasStacks()[t];this.store.getCanvasStacks().length=0}showPoi(t){var e,i;if(null===(e=this.store)||void 0===e?void 0:e.getCurPoiGroup())if(Array.isArray(t))t.forEach((t=>{var e;const i=null===(e=this.store.getCurPoiGroup())||void 0===e?void 0:e.children.find((e=>e.userData.id===t));i?i.visible=!0:console.error(`요청한 poi ${t}는 현재층에 존재하지 않습니다. `)}));else{const e=null===(i=this.store.getCurPoiGroup())||void 0===i?void 0:i.children.find((e=>e.userData.id===t));e?e.visible=!0:console.error(`요청한 poi ${t}는 현재층에 존재하지 않습니다. `)}}hidePoi(t){var e,i;if(null===(e=this.store)||void 0===e?void 0:e.getCurPoiGroup())if(Array.isArray(t))t.forEach((t=>{var e;const i=null===(e=this.store.getCurPoiGroup())||void 0===e?void 0:e.children.find((e=>e.userData.id===t));i?i.visible=!1:console.error(`요청한 poi ${t}는 현재층에 존재하지 않습니다. `)}));else{const e=null===(i=this.store.getCurPoiGroup())||void 0===i?void 0:i.children.find((e=>e.userData.id===t));e?e.visible=!1:console.error(`요청한 poi ${t}는 현재층에 존재하지 않습니다. `)}}showAllPoi(){var t;const e=null===(t=this.store)||void 0===t?void 0:t.getCurPoiGroup();e&&e.children.forEach((t=>{t.visible=!0}))}hideAllPoi(){var t;const e=null===(t=this.store)||void 0===t?void 0:t.getCurPoiGroup();e&&e.children.forEach((t=>{t.visible=!1}))}showPoiByCode(t,e){this.setVisibilityByCode(t,!0),e&&e.forEach((t=>this.setVisibilityByCode(t,!0)))}hidePoiByCode(t,e){this.setVisibilityByCode(t,!1),e&&e.forEach((t=>this.setVisibilityByCode(t,!1)))}addPois(t){this.drawPois(t)}removePois(t){t.map((t=>t.id)).forEach((t=>{const e=this.findPoiItemGroup(t);e.removeCanvas(),e.cleanup(),e.removeFromParent()}))}updatePoiDataList(t){this.poiDataList=t}findPoiItemGroup(t){return this.poiGroup.children.find((e=>e.userData.id===t))}getCurrentPois(t){var e;const i=(0,a.cloneDeep)(t);let n=new o.Vector3;if(t.sortOption&&t.sortOption.center){const i=null===(e=this.preprocessing)||void 0===e?void 0:e.userMapCoordToWorldCoord(t.sortOption.center);i&&(n=i)}const r=Object.assign({},this.poiGroup);r.children=r.children.filter((t=>t.userData.isInsideScreen)),i.isVisible&&(r.children=r.children.filter((t=>t.visible&&t.userData.isShow)));const s=new o.Vector3;let l=this.cameraController.camera.position;i.sortOption&&i.sortOption.center&&(l=new o.Vector3(n.x,n.y,n.z)),r.children=r.children.sort(((t,e)=>{var n;return!1===(null===(n=i.sortOption)||void 0===n?void 0:n.byAsc)?l.distanceTo(e.getWorldPosition(s))-l.distanceTo(t.getWorldPosition(s)):l.distanceTo(t.getWorldPosition(s))-l.distanceTo(e.getWorldPosition(s))}));const c=[];return r.children.forEach((t=>{const e=t.userData;e.position={x:e.position.x,y:-e.position.y,z:e.position.z},c.push(e)})),c}updatePoi(t){const e=t.ids;if(e&&(Array.isArray(e)&&e.forEach((e=>{const i=this.poiDataList.find((t=>t.id===e));i?this.updatePoiTitle(i,t):console.error(`요청한 poi ${e}는 현재층에 존재하지 않습니다. `)})),!Array.isArray(e))){const i=e,n=this.poiDataList.find((t=>t.id===i));n?this.updatePoiTitle(n,t):console.error(`요청한 poi ${i}는 현재층에 존재하지 않습니다. `)}return e||this.poiDataList.forEach((e=>{this.updatePoiTitle(e,t)})),this.store.setDirtyIfNotCommit(),this.store.setCurPoiGroup(this.getPoiGroup()),this.store.updatePoiUserDataList(),this.setDefaultPosition(),t}resetPoi(t){let e=(0,a.cloneDeep)(t);"string"==typeof e&&(e=[e]),e.forEach((t=>{const e=this.poiDataList.find((e=>e.id===t));e?this.updatePoiTitle(e):console.error(`요청한 poi ${t}는 현재층에 존재하지 않습니다. `)})),this.store.setDirtyIfNotCommit(),this.store.setCurPoiGroup(this.getPoiGroup()),this.store.updatePoiUserDataList(),this.setDefaultPosition()}updatePoiTitle(t,e){let i,n;const r=this.poiGroup.children.find((e=>e.userData.id===t.id)),s=t.titleByLanguages.find((t=>t.lang===this.mapOptions.language));r instanceof m.PoiItemGroup&&(i=null==r?void 0:r.children.find((t=>"TEXT"===t.userData.poiType)),s&&(n=this.createCanvasText(t,s.text,e),i instanceof p.MapPoiSprite&&i.updateSpriteTitle(r,n),i instanceof d.MapPoiMesh&&i.updateMeshTitle(r,n)))}drawPoiIcon(t,e,i){this.mapOptions.spriteEnable&&"FLOATING"===t.face?(this.addPoiDebugBox(),new p.MapPoiSprite(this.store,this.textureManager).drawSpriteIcon(t,e,i)):new d.MapPoiMesh(this.store).drawMeshIcon(t,e,i)}drawPoiTitle(t,e,i){const n=t.titleByLanguages.find((t=>t.lang===this.mapOptions.language)),r=n?n.text:t.title,s=this.createCanvasText(t,r,i);if(this.mapOptions.spriteEnable&&"FLOATING"===t.face){this.addPoiDebugBox();return new p.MapPoiSprite(this.store,this.textureManager).drawSpriteTitle(t,e,s)}return new d.MapPoiMesh(this.store).drawMeshTitle(t,e,s)}setFontStyle(t,e){let i=400;return t.style.boldYn&&(i="bold"),i.toString().concat(" ",e.toString(),"px/1 Noto Sans SC, Noto Sans JP, Noto Sans KR, sans-serif, 맑은 고딕, Apple SD Gothic Neo")}createCanvasText(t,e,i){var n;try{const r=g.DabeeoUtils.isMobile()?3:6;t.lineSpacing=null!==(n=t.lineSpacing)&&void 0!==n?n:0;const s=document.createElement("canvas").getContext("2d");let{horizontal:o,vertical:a}=this.mapOptions.poiTextPadding;const l=2*t.lineSpacing*r,c=t.style.fontSize*r,h=r;o*=r,a*=r;const u=this.setFontStyle(t,c),d=e.split("\n");let p=0,f=0;d.forEach((t=>{const{width:e,height:i}=this.measureText(t,u);p<e&&(p=e),f+=i+l})),f-=l;const m=.4*c;s.canvas.width=p+2*o,s.canvas.height=f+2*a+m,s.font=u,s.fillStyle=(null==i?void 0:i.innerColor)?null==i?void 0:i.innerColor:t.style.fontColor;const v=c+a;d.forEach(((e,n)=>{const{width:r,height:a}=this.measureText(e,u);let c=.5*p-.5*r+o;const d=v+a*n+l*n;"LEFT"===t.style.alignType?c=o:"RIGHT"===t.style.alignType&&(c=p-r+o),s.fillText(e,c,d),(null==i?void 0:i.outerColor)&&(s.strokeStyle=null==i?void 0:i.outerColor,s.lineWidth=h,s.strokeText(e,c,d))}));const y=s.canvas.width/r,_=s.canvas.height/r;return{text:s,geoW:(null==i?void 0:i.scale)?y*i.scale:y,geoH:(null==i?void 0:i.scale)?_*i.scale:_}}catch(t){return this.store.getCanvasStacks().length,t}}measureText(t,e){const i=document.createElement("p");i.appendChild(document.createTextNode(t)),Object.assign(i.style,{display:"inline-block",margin:"0",padding:"0",border:"0",whiteSpace:"pre"}),i.style.setProperty("font",e,"important");const n=document.querySelector("body");n.appendChild(i);let{width:r,height:s}=i.getBoundingClientRect();return"remove"in i?i.remove():n.removeChild(i),r||(r=1),s||(s=1),{width:r,height:s}}addPoiDebugBox(){const t=new h.Mesh(new o.PlaneGeometry(1,1),new o.MeshBasicMaterial({color:"blue",wireframe:!0}));if(this.overlayBoxes.push(t),this.showPoiDebugingBox&&this.overlayGroup.add(t),this.showPoiDebugingBox)for(let t=0;t<this.pointArr.length;t++){const t=new o.BufferGeometry;t.setAttribute("position",new o.Float32BufferAttribute([0,0,0],3));const e=new o.PointsMaterial({size:10,color:"green"}),i=new u.Points(t,e);this.dotBucketsGroup.add(i),this.dotBuckets.push(i)}}poiZoomToggle(){if(null===this.poiGroup)return;const t=this.cameraController.getNowZoom();this.isPoiLevel?this.poiGroup.children.forEach((e=>{e instanceof o.Group&&("number"==typeof this.poiLevel.top&&"number"==typeof this.poiLevel.middle&&"number"==typeof this.poiLevel.bottom?(e.visible=!1,this.poiLevel.top<=t&&1===e.userData.clusterLevel&&(e.visible=!0),this.poiLevel.middle<=t&&2===e.userData.clusterLevel&&(e.visible=!0),this.poiLevel.bottom<=t&&3===e.userData.clusterLevel&&(e.visible=!0)):e.visible=!0)})):this.poiGroup.children.forEach((t=>{t instanceof m.PoiItemGroup&&(t.visible=!0)}))}setDefaultPosition(){const t=this.getCollitionPois(),e=this.mapOptions.poiTextPadding;t.forEach((t=>{const i=new o.Vector3;if(t.getWorldPosition(i),t.userData.defaultDistanceFormCamera=this.cameraController.camera3dDistanceTo(i),2===t.children.length){let n=Number(t.userData.style.spacing);n>0&&(n*=2);const r=this.cameraController.camera3d.position.distanceTo(i),s=this.cameraController.camera3d.fov*Math.PI/180,o=2*Math.tan(s/2)*r,a=.5*t.children[0].scale.y/o,l=.5*(t.children[1].scale.y-2*e.vertical)/o,c=n/o*.5;t.userData.iconYUp3d=2*(l+c),t.userData.textYDown3d=2*(a+c);const h=this.cameraController.camera2d.top-this.cameraController.camera2d.bottom,u=.5*t.children[0].scale.y/h,d=.5*(t.children[1].scale.y-2*e.vertical)/h,p=n/h*.5;t.userData.iconYUp2d=2*(d+p),t.userData.textYDown2d=2*(u+p)}}))}occurrences(t,e,i=!1){if(t+="",(e+="").length<=0)return t.length+1;let n=0,r=0;const s=i?1:e.length;for(;r=t.indexOf(e,r),r>=0;)++n,r+=s;return n}updatePoiScaleByMapScale(){this.getCollitionPois().forEach((t=>{t.children.forEach((t=>{this.isSyncPOI&&(t.updateMatrixWorld(),t.userData.defaultScale)}))}))}repositionOfPOISpirteItems(){this.getCollitionPois().forEach((t=>{if(2===t.children.length){const e=new o.Vector3;t.getWorldPosition(e);const i=this.cameraController.camera3dDistanceTo(e);let n=t.userData.defaultDistanceFormCamera/i;const r=e.clone(),s=e.clone(),a=this.store.getMapInfo().getNorthReference();r.project(this.cameraController.camera),s.project(this.cameraController.camera),this.cameraController.camera instanceof o.PerspectiveCamera?(r.y+=t.userData.iconYUp3d*n,s.y+=-t.userData.textYDown3d*n):(n=this.cameraController.camera.zoom,r.y+=t.userData.iconYUp2d*n,s.y+=-t.userData.textYDown2d*n),r.unproject(this.cameraController.camera),r.sub(e),r.applyAxisAngle(new o.Vector3(1,0,0),.5*Math.PI),r.applyAxisAngle(new o.Vector3(0,0,1),o.MathUtils.degToRad(a)),s.unproject(this.cameraController.camera),s.sub(e),s.applyAxisAngle(new o.Vector3(1,0,0),.5*Math.PI),s.applyAxisAngle(new o.Vector3(0,0,1),o.MathUtils.degToRad(a)),t.children[0].position.set(r.x,r.y,r.z),t.children[1].position.set(s.x,s.y,s.z)}}))}showGridBox(){const t=window.innerWidth/this.gridClass.xCellCount,e=window.innerHeight/this.gridClass.yCellCount;for(let i=0;i<this.gridClass.xCellCount;i++)for(let n=0;n<this.gridClass.yCellCount;n++){const r=new o.Mesh(new o.PlaneGeometry(t,e),new o.MeshBasicMaterial({color:"blue",wireframe:!0})),s=-window.innerWidth/2+i*t+t/2,a=-window.innerHeight/2+n*e+e/2;r.position.set(s,a,0),this.overlayGroup.add(r)}}getCollitionPois(){return this.poiGroup&&this.poiGroup.children.length>0?this.poiGroup.children.filter((t=>!("FLOATING"!==t.userData.face||!t.visible)&&(this.poiLength+=t.children.length,!0))):[]}transformVertex(t,e,i,n,r,s){this.alignedPosition.subVectors(t,i).addScalar(.5).multiply(n),void 0!==r&&void 0!==s?(this.rotatedPosition.x=s*this.alignedPosition.x-r*this.alignedPosition.y,this.rotatedPosition.y=r*this.alignedPosition.x+s*this.alignedPosition.y):this.rotatedPosition.copy(this.alignedPosition),t.copy(e),t.x+=this.rotatedPosition.x,t.y+=this.rotatedPosition.y,t.applyMatrix4(this.viewWorldMatrix)}computePointBoundingBox(t,e,i,n,r){const s=[t,e,i,n],a=new o.Vector3(this.mapInfo.getSize().width,this.mapInfo.getSize().height,1),l=new o.Vector3(-this.mapInfo.getSize().width,-this.mapInfo.getSize().height,-1);for(let t=0;t<s.length;t++){const e=new o.Vector3(s[t].x,s[t].y,s[t].z).project(r);a.min(e),l.max(e)}return new o.Box2(a,l)}normalizedToPixels(t,e,i){const n=new o.Vector2(.5*e,.5*i);return t.clone().multiply(n)}resetGridClass(){this.gridClass=new l.GridClass(window.innerWidth+200,window.innerHeight+200,this.gridDivide)}collisionTest(){if(this.resetGridClass(),this.passTime=this.store.getClock().getElapsedTime(),this.mapOptions.spriteEnable&&this.poiGroup&&this.poiGroup.children&&this.poiGroup.children.length>0){this.poiLength=0;const t=this.getCollitionPois();if(this.store.getDirty()&&this.passTime>this.passTimeOver){const e=new o.Vector3,i=window.innerWidth,n=window.innerHeight,r=i/2,s=n/2;let a=0;const l=this;t.sort(((t,e)=>{let i=-1,n=-1;if(l.poiIdsOnNavi&&l.poiIdsOnNavi.length>0&&(i=l.poiIdsOnNavi.indexOf(t.userData.id),n=l.poiIdsOnNavi.indexOf(e.userData.id)),i===n){if(t.userData.clusterLevel===e.userData.clusterLevel){const i=new o.Vector3;t.getWorldPosition(i);const n=new o.Vector3;return e.getWorldPosition(n),l.cameraController.camera3dDistanceTo(i)-l.cameraController.camera3dDistanceTo(n)}return t.userData.clusterLevel-e.userData.clusterLevel}return n-i})),t.forEach(((t,l)=>{t.userData.resFalseLength=0,t.userData.resIsInsideScreenLength=0,t.children.forEach((c=>{if(c instanceof o.Sprite||c instanceof p.MapPoiSprite){this.worldScale.setFromMatrixScale(c.matrixWorld),this.viewWorldMatrix.copy(this.cameraController.camera.matrixWorld),c.modelViewMatrix.multiplyMatrices(this.cameraController.camera.matrixWorldInverse,c.matrixWorld),this.mvPosition.setFromMatrixPosition(c.modelViewMatrix);const{rotation:h}=c.material;let u,d;0!==h&&(d=Math.cos(h),u=Math.sin(h));const{center:p}=c;for(let t=0;t<this.pointArr.length;t++)this.transformVertex(this.pointArr[t].set(this.pointValues[t][0],this.pointValues[t][1],this.pointValues[t][2]),this.mvPosition,p,this.worldScale,u,d),this.showPoiDebugingBox&&(this.dotBuckets[a*this.pointArr.length+t].geometry.setAttribute("position",new o.Float32BufferAttribute(this.pointArr[t].toArray(),3)),this.dotBuckets[a*this.pointArr.length+t].updateMatrixWorld());const f=this.computePointBoundingBox(this.pointArr[0],this.pointArr[1],this.pointArr[2],this.pointArr[3],this.cameraController.camera),m=this.normalizedToPixels(f.getSize(e),i,n),g=this.normalizedToPixels(f.getCenter(e),i,n);this.overlayBoxes[a].scale.set(m.x,m.y,1),this.overlayBoxes[a].position.set(g.x,g.y,0),this.overlayBoxes[a].geometry.computeBoundingBox(),this.overlayBoxes[a].updateMatrixWorld();const v=this.overlayBoxes[a].position.clone(),y=(new o.Box3).setFromObject(this.overlayBoxes[a]).getSize(e),_=v.x-y.x/2+r,x=v.x+y.x/2+r,M=-(v.y+y.y/2)+s,b=-(v.y-y.y/2)+s,w=!this.gridClass.isInsideGrid(_,M,x,b)||!this.textAllowOverlap&&this.gridClass.hitTest(_,M,x,b,!1,l);if(x>=0&&_<window.innerWidth&&b>=0&&M<window.innerHeight&&t.userData.resIsInsideScreenLength++,w){if(c.userData.fadeout=!0,c.material.transparent=!0,this.overlayBoxes[a].material.color.set("red"),this.showPoiDebugingBox)for(let t=0;t<this.pointArr.length;t++)this.dotBuckets[a*this.pointArr.length+t].material.color.set("red")}else if(t.userData.resFalseLength++,c.userData.x1=_,c.userData.x2=x,c.userData.y1=M,c.userData.y2=b,c.userData.index=l,c.userData.fadein=!0,c.material.transparent=!0,this.overlayBoxes[a].material.color.set("green"),this.showPoiDebugingBox)for(let t=0;t<this.pointArr.length;t++)this.dotBuckets[a*this.pointArr.length+t].material.color.set("green");a===this.poiLength-1&&(this.store.setCommit(!0),this.passTimeOver=.2),a+=1}})),t.userData.isInsideScreen=!1,t.userData.isShow=!1,t.userData.resFalseLength===t.children.length?(t.userData.fadein=!0,t.children.forEach((t=>{this.gridClass.insert({bucketInstanceId:t.userData.index,featureIndex:t.userData.index,collisionGroupID:t.userData.index},t.userData.x1,t.userData.y1,t.userData.x2,t.userData.y2)})),t.userData.isShow=!0):t.userData.fadeout=!0,t.userData.resIsInsideScreenLength>0&&(t.userData.isInsideScreen=!0)}))}if(this.store.getCommit()){let e=0;t.forEach((t=>{t.userData.fadein?t.children.forEach((e=>{(e instanceof o.Sprite||e instanceof p.MapPoiSprite)&&(e.material.opacity<1?e.material.opacity+=.08:(t.userData.fadein=!1,e.userData.fadein=!1,e.material.opacity=1))})):t.userData.fadeout?t.children.forEach((e=>{(e instanceof o.Sprite||e instanceof p.MapPoiSprite)&&(e.material.opacity>0?e.material.opacity-=.08:(t.userData.fadeout=!1,e.userData.fadeout=!1,e.material.opacity=0))})):t.children.forEach((()=>{e++}))})),e===this.poiLength&&this.store.setPlaced(!0),this.store.setDirty(!1)}}}Update(){super.Update(),this.store.getRenderDirty()&&this.updatePoiScaleByMapScale(),this.mapOptions.spriteEnable&&this.repositionOfPOISpirteItems(),this.isPoiLevel&&this.poiZoomToggle(),this.useCollisionTest&&this.collisionTest(),this.store.getPlaced()&&this.store.setCommit(!1)}getPoiGroup(){return this.poiGroup}getDebugBoxGroup(){return this.overlayGroup}getDebugDotGroup(){return this.dotBucketsGroup}setVisibilityByCode(t,e){var i;const n=null===(i=this.store)||void 0===i?void 0:i.getCurPoiGroup();n&&n.children.forEach((i=>{i.userData.layerGroupCode===t&&(i.visible=e)}))}}e.MapPoiGroup=M},4598:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.MapPoiMesh=void 0;const o=s(i(5232)),a=i(6486),l=i(4925),c=i(6202);class h extends l.Mesh{constructor(t){super(new o.PlaneGeometry,new o.MeshBasicMaterial),this.store=t,this.mapOptions=this.store.getMapOptions(),this.mapData=this.store.getMapInfo(),this.loadingmanager=this.store.getLoadingManager(),this.userData.type="poi"}repositionOfPOIMeshItems(t,e,i){const n=2*this.mapOptions.poiTextPadding.vertical;i.translateY(-(.5*(t.iconSize.height+n)+2*parseFloat(t.style.spacing))+.5*n),e.translateY(.5*i.geometry.parameters.height)}drawMeshIcon(t,e,i){const n=t.iconSize.width,r=t.iconSize.height;new o.ImageLoader(this.loadingmanager).load(t.iconUrl,(s=>{s.anisotropy=4,this.material.transparent=!0,this.material.opacity=1,this.material.map=new o.CanvasTexture(s),this.geometry.dispose(),this.geometry=new o.PlaneGeometry(n,r),this.geometry.computeBoundingBox(),Object.assign(this.userData,(0,a.cloneDeep)(t)),this.material.depthWrite=!1,this.material.depthTest=!1,this.name=t.title,this.userData.poiType="ICON",e.add(this),this.store.setRenderDirty(!0),i&&(e.add(i),this.repositionOfPOIMeshItems(t,this,i))}))}drawSvgLoaderPoiMeshIcon(t,e,i){const n=c.DabeeoUtils.getElementAttributes(t.image),r=n["xlink:href"],{width:s,height:l}=n,h=+(s||0),u=+(l||0);new o.ImageLoader(this.loadingmanager).load(r||"",(i=>{var n;i.anisotropy=4,this.material.transparent=!0,this.material.opacity=1,this.material.map=new o.CanvasTexture(i),this.geometry.dispose(),this.geometry=new o.PlaneGeometry(h,u),this.geometry.computeBoundingBox(),Object.assign(this.userData,(0,a.cloneDeep)(t)),this.material.depthWrite=!1,this.material.depthTest=!1,this.name=(null===(n=t.text)||void 0===n?void 0:n.textContent)||"",this.userData.poiType="ICON",e.add(this)})),i&&e.add(i)}drawMeshTitle(t,e,i){this.store.pushCanvasStacks(i.text.canvas);const n=new o.CanvasTexture(i.text.canvas);return this.geometry.dispose(),this.geometry=new o.PlaneGeometry(parseFloat(i.geoW),parseFloat(i.geoH)),this.material.transparent=!0,this.material.opacity=1,this.material.side=o.DoubleSide,this.material.map=n,this.material.depthWrite=!1,this.material.depthTest=!1,this.geometry.center(),this.geometry.computeBoundingBox(),this.name=t.title,Object.assign(this.userData,(0,a.cloneDeep)(t)),this.userData.poiType="TEXT",e.userData.fontHeight=i.geoW>i.geoH?i.geoW:i.geoH,this}drawSvgLoaderPoiMeshTitle(t,e,i){var n;this.store.pushCanvasStacks(i.text.canvas);const r=new o.CanvasTexture(i.text.canvas);return this.geometry.dispose(),this.geometry=new o.PlaneGeometry(parseFloat(i.geoW),parseFloat(i.geoH)),this.material.transparent=!0,this.material.opacity=1,this.material.side=o.DoubleSide,this.material.map=r,this.material.depthWrite=!1,this.material.depthTest=!1,this.geometry.center(),this.geometry.computeBoundingBox(),this.name=(null===(n=t.text)||void 0===n?void 0:n.textContent)||"",Object.assign(this.userData,(0,a.cloneDeep)(t)),this.userData.poiType="TEXT",e.userData.fontHeight=i.geoW>i.geoH?i.geoW:i.geoH,this}updateMeshTitle(t,e){this.removeCurrentCanvas();const i=new o.CanvasTexture(e.text.canvas);this.material instanceof o.MeshBasicMaterial&&(this.material.map=i),this.geometry.dispose(),this.geometry=new o.PlaneGeometry(parseFloat(e.geoW),parseFloat(e.geoH)),this.geometry.center(),this.geometry.computeBoundingBox(),t.userData.fontHeight=e.geoW>e.geoH?e.geoW:e.geoH}removeCurrentCanvas(){var t;const e=null===(t=this.material.map)||void 0===t?void 0:t.source.data;if(e instanceof HTMLCanvasElement){e.width=0,e.height=0;const t=this.store.getCanvasStacks(),i=t.indexOf(e);t.splice(i,1)}}Update(){super.Update()}}e.MapPoiMesh=h},6250:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.MapPoiSprite=void 0;const o=s(i(5232)),a=i(6486),l=i(6969),c=i(6202);class h extends l.Sprite{constructor(t,e){super(new o.SpriteMaterial),this.mapOptions=t.getMapOptions(),this.mapData=t.getMapInfo(),this.textureManager=e,this.store=t,this.isSyncPOI=!0,this.counter=0,this.userData.type="poi"}drawSpriteIcon(t,e,i){const n=this.textureManager.getTexture(t.iconUrl),r=t.iconSize.width,s=t.iconSize.height;(null==n?void 0:n.tex)&&(this.material.map=n.tex),this.material.opacity=this.mapOptions.enablePoiCollisionTest?0:1,this.material.transparent=!0,this.material.depthTest=!1,this.mapOptions.spriteKeepRotation&&(this.material.rotation=-(t.rotate&&0!==t.rotate?t.rotate:-this.mapData.getNorthReference())*Math.PI/180),this.isSyncPOI,this.scale.set(r,s,1),this.userData.defaultScale=new o.Vector3(t.iconSize.width,t.iconSize.height,1),this.renderOrder=1,this.name=t.title,this.userData.poiType="ICON",Object.assign(this.userData,(0,a.cloneDeep)(t)),e.add(this),i&&e.add(i)}drawSvgLoaderPoiSpriteIcon(t,e,i){var n;const r=c.DabeeoUtils.getElementAttributes(t.image),s=r["xlink:href"],{width:l,height:h}=r,u=+(l||0),d=+(h||0),p=this.textureManager.getTexture(s||"");(null==p?void 0:p.tex)&&(this.material.map=p.tex),this.material.opacity=this.mapOptions.enablePoiCollisionTest?0:1,this.material.transparent=!0,this.material.depthTest=!1;const f=u;this.isSyncPOI?(this.scale.set(u,d,1),this.userData.defaultScale=new o.Vector3(u,u,1)):(this.scale.set(f,f,1),this.userData.defaultScale=new o.Vector3(f,f,1)),this.renderOrder=1,this.name=(null===(n=t.text)||void 0===n?void 0:n.textContent)||"",this.userData.poiType="ICON",Object.assign(this.userData,(0,a.cloneDeep)(t)),e.add(this),i&&e.add(i)}drawSpriteTitle(t,e,i){this.store.pushCanvasStacks(i.text.canvas);const n=new o.CanvasTexture(i.text.canvas);return n.needsUpdate=!0,this.material.map=n,this.material.opacity=this.mapOptions.enablePoiCollisionTest?0:1,this.material.depthTest=!1,this.mapOptions.spriteKeepRotation&&(this.material.rotation=-(t.rotate&&0!==t.rotate?t.rotate:-this.mapData.getNorthReference())*Math.PI/180),this.isSyncPOI?(this.userData.defaultScale=new o.Vector3(t.iconSize.width,t.iconSize.height,1),this.scale.set(parseFloat(i.geoW),parseFloat(i.geoH),1),this.userData.defaultScale=new o.Vector3(parseFloat(i.geoW),parseFloat(i.geoH),1)):(this.scale.set(parseFloat(i.geoW),parseFloat(i.geoH),1),this.userData.defaultScale=new o.Vector3(parseFloat(i.geoW),parseFloat(i.geoH),1)),this.renderOrder=1,this.name=t.title,Object.assign(this.userData,(0,a.cloneDeep)(t)),this.userData.poiType="TEXT",e.userData.fontHeight=i.geoW>i.geoH?i.geoW:i.geoH,this}drawSvgLoaderPoiSpriteTitle(t,e,i){var n;this.store.pushCanvasStacks(i.text.canvas);const r=new o.CanvasTexture(i.text.canvas);return r.needsUpdate=!0,this.material.map=r,this.material.opacity=this.mapOptions.enablePoiCollisionTest?0:1,this.material.depthTest=!1,this.scale.set(parseFloat(i.geoW),parseFloat(i.geoH),1),this.userData.defaultScale=new o.Vector3(parseFloat(i.geoW),parseFloat(i.geoH),1),this.renderOrder=1,this.name=(null===(n=t.text)||void 0===n?void 0:n.textContent)||"",Object.assign(this.userData,(0,a.cloneDeep)(t)),this.userData.poiType="TEXT",e.position.z=.1,e.userData.fontHeight=i.geoW>i.geoH?i.geoW:i.geoH,this}updateSpriteTitle(t,e){this.removeCurrentCanvas(),this.store.pushCanvasStacks(e.text.canvas);const i=new o.CanvasTexture(e.text.canvas);i.needsUpdate=!0,this.material.map=i,this.scale.set(parseFloat(e.geoW),parseFloat(e.geoH),1),this.userData.defaultScale=new o.Vector3(parseFloat(e.geoW),parseFloat(e.geoH),1),t.userData.fontHeight=e.geoW>e.geoH?e.geoW:e.geoH}removeCurrentCanvas(){var t;const e=null===(t=this.material.map)||void 0===t?void 0:t.source.data;if(e instanceof HTMLCanvasElement){e.width=0,e.height=0;const t=this.store.getCanvasStacks(),i=t.indexOf(e);t.splice(i,1)}}Update(){super.Update()}}e.MapPoiSprite=h},2129:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PoiGroup=void 0;const n=i(2676);class r extends n.Group{constructor(){super("poiGroup")}Update(){super.Update()}}e.PoiGroup=r},7709:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PoiItemGroup=void 0;const n=i(2676);class r extends n.Group{constructor(){super("poiItemGroup")}Update(){super.Update()}removeCanvas(){this.children.forEach((t=>{t.removeCurrentCanvas()}))}}e.PoiItemGroup=r},3462:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.Preprocessing=void 0;const o=s(i(5232)),a=i(6486),l=i(985),c=i(6202);e.Preprocessing=class{constructor(t,e){this.styleList=new Map,this.maxObjectVolume=0,this.maxSectionVolume=0;let i=[];this.svgObjectList=new Array,this.floorTheme=t.getThemes(),this.floorData=t.getFloors().map((t=>this.preventConvertingError(t))),this.mapOptions=e,this.styleCodesList=new Map;const n=this.floorData.find((t=>t.id===this.mapOptions.floor));this.makeThemeList(t,n),t.getFloors().forEach((t=>{if(t.objects.length>0){const e=t.objects.reduce(((t,e)=>t.volume>e.volume?e:t));e&&(this.maxObjectVolume=e.volume)}if(t.sections.length>0){const e=t.sections.reduce(((t,e)=>t.volume>e.volume?e:t));this.maxSectionVolume&&(this.maxSectionVolume=e.volume)}})),t.getThemes().forEach((t=>{t.defaultYn&&(i=[...t.objectStyles,...t.sectionStyles])})),this.mapInfo=t,this.defaultFloor=this.findDefaultFloor(this.mapOptions.floor),this.defaultTheme=this.findDefaultTheme(this.mapOptions.theme);const r=this.defaultFloor?(0,a.cloneDeep)(this.defaultFloor.objects):[],s=this.defaultFloor?(0,a.cloneDeep)(this.defaultFloor.sections):[];this.setObj(this.svgObjectList,r,"object"),this.setObj(this.svgObjectList,s,"section"),this.addMapIdToSvgObjectData(t.getId(),this.svgObjectList),this.defaultFloor&&this.addMapIdToPoiData(t.getId(),this.defaultFloor.pois)}getData(){return this.mapInfo,this.mapInfo}getDefaultFloor(){return this.defaultFloor,this.defaultFloor}getSvgObjectList(){return this.getSvgObjectList,this.svgObjectList}getStyleList(){return this.styleList}getMaxObjectVolume(){return this.maxObjectVolume}getMaxSectionVolume(){return this.maxSectionVolume}multiplyScaleCm(t){return t*this.mapInfo.getScaleCm()}divideScaleCm(t){return t/this.mapInfo.getScaleCm()}makeThemeList(t,e){let i=[],n=null;if(n=e||t.getFloors().find((e=>e.id===t.getDefaultFloorId())),n){const e=[...n.objects,...n.sections];t.getThemes().forEach((t=>{"default"===this.mapOptions.theme?t.defaultYn&&(i=[...t.objectStyles,...t.sectionStyles]):Number(t.id)===Number(this.mapOptions.theme)&&(i=[...t.objectStyles,...t.sectionStyles])}));const r=e.filter(((t,e,i)=>i.findIndex((e=>e.style.groupCode===t.style.groupCode))===e));this.extractedThemeList(r,i,t.getId())}}addMapIdToSvgObjectData(t,e){e.forEach((e=>{e.setMapId(t)}))}addMapIdToPoiData(t,e){e.forEach((e=>{e.mapId=t}))}setObj(t,e,i){e.forEach((e=>{let n="",r="M";e.coordinates.forEach((t=>{const e=t.x.toFixed(8).toString(),i=t.y.toFixed(8).toString();n+=`${r+e},${i}  `,r="L"})),n+="Z";const{volume:s}=e;let o=this.styleList.get(e.style.groupCode);void 0===o&&(o=this.styleList.get("OB-FIXED_FACILITY"));const a=new l.SvgObject(e,n,s,o,i);t.push(a)}))}removeIndoorMapStyles(t){const e=this.styleCodesList.get(t);e&&e.forEach((t=>{this.styleList.delete(t)}))}getConvertedIndoorMapSvgObjectData(t,e){const i=t.mapData.dataMapInfo,n=i.getFloors().find((t=>t.id===e)),r=n?(0,a.cloneDeep)(n.objects):[],s=n?(0,a.cloneDeep)(n.sections):[];this.convertIndoorMapObjectData(r,t),this.convertIndoorMapObjectData(s,t);const o=[];return this.setObj(o,r,"object"),this.setObj(o,s,"section"),this.addMapIdToSvgObjectData(i.getId(),o),o}getConvertedIndoorMapPoiData(t,e){const i=t.mapData.dataMapInfo,n=i.getFloors().find((t=>t.id===e)),r=(0,a.cloneDeep)(n.pois);return this.convertIndoorMapPoiData(r,t),this.addMapIdToPoiData(i.getId(),r),r}convertIndoorMapNaviResponse(t,e){var i,n,r;if(!t)return void console.error("데이터 변환에 사용할 indoorMapData 객체가 존재하지 않습니다.");const s=this.getIndoorMapCoordsTransformMatrix3(t);null===(i=e.locations)||void 0===i||i.forEach((t=>{t.position&&this.transformIndoorMapCoords(t.position,s)})),null===(n=e.pathInfo)||void 0===n||n.forEach((t=>{t.position&&this.transformIndoorMapCoords(t.position,s)})),null===(r=e.wayPoints)||void 0===r||r.forEach((t=>{t.position&&this.transformIndoorMapCoords(t.position,s)}))}transformRootGroup(t){const e=this.mapInfo.getScaleCm();t.scale.set(e,e,e);const i=this.mapInfo.getNorthReference();t.rotateX(.5*-Math.PI),t.rotateZ(o.MathUtils.degToRad(-i));const n=-this.mapInfo.getSize().width/2*e,r=this.mapInfo.getSize().height/2*e;t.translateX(n),t.translateY(r)}userMapCoordToWorldCoord(t){const e=c.DabeeoUtils.changeVectorMinus(new o.Vector3(t.x,t.y,0)),i=new o.Vector3(e.x,e.y,e.z);return this.localCoordToWorldCoord(i)}worldCoordToUserMapCoord(t){const e=this.worldCoordToLocalCoord(t),i=c.DabeeoUtils.changeVectorMinus(e);return{x:i.x,y:i.y}}worldCoordToLocalCoord(t){const e=t,i=this.mapInfo.getNorthReference();e.applyAxisAngle(new o.Vector3(1,0,0),.5*Math.PI),e.applyAxisAngle(new o.Vector3(0,0,1),o.MathUtils.degToRad(i));const n=this.mapInfo.getScaleCm(),r=-this.mapInfo.getSize().width/2*n,s=this.mapInfo.getSize().height/2*n;return e.x-=r,e.y-=s,e.x/=n,e.y/=n,e.z/=n,e}eventCoordToWorldCoord(t,e){const i=new o.Vector3;let n=new o.Vector3;if(e instanceof o.PerspectiveCamera){i.set(t.x,t.y,1),i.unproject(e),i.sub(e.position).normalize();const r=-e.position.y/i.y;n.copy(e.position).add(i.multiplyScalar(r))}return e instanceof o.OrthographicCamera&&(i.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)),i.unproject(e),n=i),n}geolocationCoordToUserMapCoord(t,e,i,n){const r={x:n,y:i},s=this.geolocationCoordToMeterCoord(t,e,r.y,r.x),a={position:{x:s.x,y:s.y},degree:0,zeroPoint:{x:0,y:0},xDirection:1,yDirection:-1},l=this.convertPosition(a),h=c.DabeeoUtils.changeVectorMinus(new o.Vector3(null==l?void 0:l.x,null==l?void 0:l.y,0));return{x:h.x,y:h.y}}preventConvertingError(t){const e=t;return e.objects.forEach((t=>{1===Math.sign(t.position.y)&&(t.position.y,t.position.y*=-1),t.coordinates.forEach((t=>{1===Math.sign(t.y)&&(t.y,t.y*=-1)}))})),e}getIndoorMapCoordsTransformMatrix3(t){const{translate:e,rotate:i,scale:n}=t.transform,r=(new o.Matrix3).scale(n,n),s=(new o.Matrix3).rotate(c.DabeeoUtils.degToRad(i)),a=(new o.Matrix3).translate(e.x,e.y);return(new o.Matrix3).multiply(r).multiply(s).multiply(a)}transformIndoorMapCoords(t,e){const i=new o.Vector2(t.x,t.y);i.applyMatrix3(e),t.x=i.x,t.y=i.y}geolocationCoordToMeterCoord(t,e,i,n){let r=this.measure(t,e,t,n);n<e&&(r*=-1);let s=this.measure(t,e,i,e);return i<t&&(s*=-1),{x:r,y:s}}measure(t,e,i,n){const r=i*Math.PI/180-t*Math.PI/180,s=n*Math.PI/180-e*Math.PI/180,o=Math.sin(r/2)*Math.sin(r/2)+Math.cos(t*Math.PI/180)*Math.cos(i*Math.PI/180)*Math.sin(s/2)*Math.sin(s/2);return 1e3*(6378.137*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))))}convertPosition(t){if(!t.position)return null;let e;return e=this.rotatePoint({x:0,y:0},t),e=this.convertMeterToPixel(e),e=this.fixZeroPoint(e,t),e}rotatePoint(t,e){const i=c.DabeeoUtils.degToRad(e.degree),n=Math.cos(i),r=Math.sin(i),s=t.x,o=t.y,a=e.position.x,l=e.position.y;return{x:n*(a-s)-(r*(l-o)+s),y:n*(l-o)+(r*(a-s)+o)}}convertMeterToPixel(t){let e=100*t.x,i=100*t.y;return e/=this.mapInfo.getScaleCm(),i/=this.mapInfo.getScaleCm(),{x:e,y:i}}fixZeroPoint(t,e){return{x:(t.x-e.zeroPoint.x)*e.xDirection,y:(t.y-e.zeroPoint.y)*e.yDirection}}extractedThemeList(t,e,i){const n=[];t.forEach((t=>{const i=e.filter((e=>e.groupCode===t.style.groupCode));i.length&&(this.styleList.set(t.style.groupCode,i[0]),n.push(t.style.groupCode))})),this.styleCodesList.set(i,n)}findDefaultFloor(t){let e=null;for(let t=0;t<this.floorData.length;t++)if(this.floorData[t].defaultYn){e=this.floorData[t];break}for(let i=0;i<this.floorData.length;i++)if(t===this.floorData[i].id){e=this.floorData[i];break}return e}findDefaultTheme(t){let e=null;for(let t=0;t<this.floorTheme.length;t++)if(!0===this.floorTheme[t].defaultYn){e=this.floorTheme[t];break}for(let i=0;i<this.floorTheme.length;i++)if(t===this.floorTheme[i].id){e=this.floorTheme[i];break}return e}localCoordToWorldCoord(t){const e=t,i=this.mapInfo.getScaleCm();e.x*=i,e.y*=i,e.z*=i;const n=-this.mapInfo.getSize().width/2*i,r=this.mapInfo.getSize().height/2*i;e.x+=n,e.y+=r;const s=this.mapInfo.getNorthReference();return e.applyAxisAngle(new o.Vector3(1,0,0),.5*-Math.PI),e.applyAxisAngle(new o.Vector3(0,1,0),o.MathUtils.degToRad(-s)),e}convertIndoorMapObjectData(t,e){const i=this.getIndoorMapCoordsTransformMatrix3(e);t.forEach((t=>{const{position:n,coordinates:r}=t;this.transformIndoorMapCoords(n,i),r.forEach((t=>{this.transformIndoorMapCoords(t,i)})),t.volume*=e.transform.scale}))}convertIndoorMapPoiData(t,e){const i=this.getIndoorMapCoordsTransformMatrix3(e);t.forEach((t=>{this.transformIndoorMapCoords(t.position,i)}))}}},9922:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.MapQuadTileBoxGroup=void 0;const o=s(i(5232)),a=i(2676),l=i(2829);class c extends a.Group{constructor(t){super("MapQuadTileBoxGroup"),this.quadTileManager=t,this.quadTileDataList=[]}init(){this.showQuadTileBox()}Update(){for(let t=0;t<this.children.length;t++)void 0!==this.children[t].Update&&this.children[t].Update()}showQuadTileBox(){const t=this.quadTileManager.getRootTile();t&&this.addBoxHelper(t)}addBoxHelper(t){const e=t.getBoundingBox();if(e){const i=new o.Color(this.getBoxColorCode(t)),n=new l.MapQuadTileBoxHelper(e,i);this.quadTileDataList.push({quadTile:t,boxHelper:n}),this.add(n)}t.getChildren().forEach((t=>{this.addBoxHelper(t)}))}updateBoxHelper(){this.quadTileDataList.forEach((t=>{const{quadTile:e,boxHelper:i}=t,n=new o.Color(this.getBoxColorCode(e));i.updateColor(n)}))}getBoxColorCode(t){let e=16711680;return t.getInFrustum()&&(e=65280),t.getShouldRender()&&(e=255),e}}e.MapQuadTileBoxGroup=c},2829:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.MapQuadTileBoxHelper=void 0;const o=s(i(5232));class a extends o.Box3Helper{constructor(t,e){super(t,e)}updateColor(t){this.material instanceof o.LineBasicMaterial&&(this.material.color=t)}cleanup(){this.geometry.dispose(),Array.isArray(this.material)?this.material.forEach((t=>{t.dispose()})):this.material.dispose(),this.removeFromParent()}}e.MapQuadTileBoxHelper=a},2261:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.QuadTile=void 0;const o=s(i(5232));class a{constructor(t){const{x:e,y:i,width:n,height:r,level:s,tileId:o,thresholdLevel:a}=t;this.coordinates={center:{x:e,y:i},nw:{x:e-.5*n,y:i-.5*r},ne:{x:e+.5*n,y:i-.5*r},sw:{x:e-.5*n,y:i+.5*r},se:{x:e+.5*n,y:i+.5*r}},this.size={width:n,height:r},this.area=n*r,this.level=s,this.thresholdLevel=a,this.boundingBox=void 0,this.tileId=o,this.parent=void 0,this.children=[],this.objectDataList=[],this.poiDataList=[],this.inFrustum=!1,this.minZoomLevel=0,this.maxZoomLevel=1/0,this.inZoomLevelRange=!1,this.shouldRender=this.level<=this.thresholdLevel,this.inMaxDistanceFromCamera=!1}getChildren(){return this.children}getLevel(){return this.level}getArea(){return this.area}getInFrustum(){return this.inFrustum}getInZoomLevelRange(){return this.inZoomLevelRange}getShouldRender(){return this.shouldRender}getBoundingBox(){return this.boundingBox}getCoordinates(){return this.coordinates}getObjectDataList(){return this.objectDataList}getPoiDataList(){return this.poiDataList}addChildren(){const t=this.coordinates.center.x,e=this.coordinates.center.y,{width:i,height:n}=this.size,r={A:{x:t-.25*i,y:e-.25*n},B:{x:t+.25*i,y:e-.25*n},C:{x:t-.25*i,y:e+.25*n},D:{x:t+.25*i,y:e+.25*n}};Object.entries(r).forEach((t=>{const e=t[0],r=t[1],s=new a({x:r.x,y:r.y,width:.5*i,height:.5*n,level:this.level+1,thresholdLevel:this.thresholdLevel,tileId:this.tileId+e});s.addParent(this),this.children.push(s)}))}addObjectData(t){this.objectDataList.push(t)}addPoiData(t){Array.isArray(t)?t.forEach((t=>{this.poiDataList.push(t)})):this.poiDataList.push(t)}removeObjectDataByMapId(t){this.objectDataList=this.objectDataList.filter((e=>e.getMapId()!==t))}removePoiDataByMapId(t){this.poiDataList=this.poiDataList.filter((e=>e.mapId!==t))}setBoundingBox(t,e){const i=t.multiplyScaleCm(e),n=t.userMapCoordToWorldCoord(this.coordinates.center);n.y=.5*i;const r=t.multiplyScaleCm(this.size.width),s=t.multiplyScaleCm(this.size.height),a=new o.Vector3(r,i,s);this.boundingBox=(new o.Box3).setFromCenterAndSize(n,a)}setInFrustum(t){var e;!1!==(null===(e=this.parent)||void 0===e?void 0:e.getInFrustum())?this.boundingBox&&(this.inFrustum=t.intersectsBox(this.boundingBox)):this.inFrustum=!1}setMinZoomLevel(t){this.minZoomLevel=t}setMaxZoomLevel(t){this.maxZoomLevel=t}setInZoomLevelRange(t){var e;!1!==(null===(e=this.parent)||void 0===e?void 0:e.getInFrustum())&&(t>this.minZoomLevel&&t<=this.maxZoomLevel?this.inZoomLevelRange=!0:this.inZoomLevelRange=!1)}setShouldRender(){this.level<=this.thresholdLevel||(this.inFrustum&&this.inZoomLevelRange&&this.inMaxDistanceFromCamera?this.shouldRender=!0:this.shouldRender=!1)}setInMaxDistanceFromCamera(t,e){var i;if(!1!==(null===(i=this.parent)||void 0===i?void 0:i.getInFrustum())&&this.boundingBox){const i=this.boundingBox.getCenter(new o.Vector3).clone().distanceTo(t);this.inMaxDistanceFromCamera=i<e}}inQuadTile(t){let e=!1;const{nw:i,se:n}=this.coordinates;return i.x<t.x&&n.x>t.x&&i.y<t.y&&n.y>t.y&&(e=!0),e}addParent(t){this.parent=t}}e.QuadTile=a},7167:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.QuadTileManager=void 0;const o=s(i(5232)),a=i(2261),l=i(6202);e.QuadTileManager=class{constructor(t,e,i,n){this.cameraController=t,this.preprocessing=e,this.store=i,this.objectDataList=[],this.poiDataList=[],this.renderObjectDataList=[],this.renderPoiDataList=[],this.removeObjectDataList=[],this.removePoiDataList=[],this.prevRenderedObjectDataList=[],this.prevRenderedPoiDataList=[],this.mapInfo=n,this.treeDepth=o.MathUtils.clamp(i.getMapOptions().tilingOption.treeDepth,5,10),this.thresholdLevel=o.MathUtils.clamp(i.getMapOptions().tilingOption.thresholdLevel,1,this.treeDepth),this.initialZoomLevel=this.cameraController.getZoomLevelByResolution(),this.sortedTileDataList=new Map,this.renderTiles=[]}init(){this.updateObjectDataList(),this.updatePoiDataList(),this.setRootTile(),this.setQuadTreeChildren(),this.setQuadTreeBoundingBox(),this.setQuadTreeInFrustum(),this.setQuadTreeZoomLevelRange(),this.setQuadTreeInZoomLevelRange(),this.setQuadTreeInMaxDistanceFromCamera(),this.setQuadTreeShouldRender(),this.setQuadTreeDataList(this.objectDataList,this.poiDataList),this.sortRenderDataList()}updateObjectDataList(){this.objectDataList=this.store.getAllSvgObjectData()}updatePoiDataList(){this.poiDataList=this.store.getAllPoiData()}updateQuadTreeInFrustum(){this.setQuadTreeInFrustum()}updateQuadTreeInZoomLevelRange(){this.setQuadTreeInZoomLevelRange()}updateQuadTreeShouldRender(){this.setQuadTreeShouldRender()}updateQuadTreeInMaxDistanceFromCamera(){this.setQuadTreeInMaxDistanceFromCamera()}sortRenderDataList(){this.sortRenderObjectDataList(),this.sortRenderPoiDataList()}removeQuadTreeDataListByMapId(t){this.rootTile&&this.removeTileDataListByMapId(this.rootTile,t)}getRenderObjectDataList(){return this.renderObjectDataList}getRenderPoiDataList(){return this.renderPoiDataList}getRemoveObjectDataList(){return this.removeObjectDataList}getRemovePoiDataList(){return this.removePoiDataList}getPrevRenderedObjectDataList(){return this.prevRenderedObjectDataList}getPrevRenderedPoiDataList(){return this.prevRenderedPoiDataList}setQuadTreeDataList(t,e){this.setConnectedDataList(t),this.setNotConnectedDataList(e)}sortRenderObjectDataList(){const t=this.getRenderTilesObjectDataList();this.renderObjectDataList=l.DabeeoUtils.getDifference(t,this.prevRenderedObjectDataList),this.removeObjectDataList=l.DabeeoUtils.getDifference(this.prevRenderedObjectDataList,t),this.prevRenderedObjectDataList=[...t]}sortRenderPoiDataList(){const t=this.getRenderTilesPoiDataList();this.renderPoiDataList=l.DabeeoUtils.getDifference(t,this.prevRenderedPoiDataList),this.removePoiDataList=l.DabeeoUtils.getDifference(this.prevRenderedPoiDataList,t),this.prevRenderedPoiDataList=[...t]}getRenderTilesObjectDataList(){const t=[];return this.renderTiles.forEach((e=>{const i=e.getObjectDataList();t.push(...i)})),t}getRenderTilesPoiDataList(){const t=[];return this.renderTiles.forEach((e=>{const i=e.getPoiDataList();t.push(...i)})),t}getRootTile(){return this.rootTile}setRootTile(){const{width:t,height:e}=this.mapInfo.getSize(),i=.5*t,n=.5*e;this.rootTile=new a.QuadTile({x:i,y:n,width:t,height:e,level:0,thresholdLevel:this.thresholdLevel,tileId:"A"})}setQuadTreeChildren(){this.rootTile&&(this.setTileChildren(this.rootTile),this.sortedTileDataList.clear(),this.sortQuadTileByLevel(this.rootTile))}setTileChildren(t){const e=this.treeDepth-1;t.getLevel()<e&&(t.addChildren(),t.getChildren().forEach((t=>{this.setTileChildren(t)})))}sortQuadTileByLevel(t){var e;const i=t.getLevel();if(this.sortedTileDataList.has(i))null===(e=this.sortedTileDataList.get(i))||void 0===e||e.quadTileList.push(t);else{const e=t.getArea(),n=i===this.treeDepth-1?0:.25*e;this.sortedTileDataList.set(i,{quadTileList:[t],inAreaRange:t=>n<t&&e>t})}t.getChildren().forEach((t=>{this.sortQuadTileByLevel(t)}))}setQuadTreeBoundingBox(){this.rootTile&&this.setTileBoundingBox(this.rootTile)}setTileBoundingBox(t){t.setBoundingBox(this.preprocessing,this.store.getMaxObjZ()),t.getChildren().forEach((t=>{this.setTileBoundingBox(t)}))}setQuadTreeInFrustum(){this.rootTile&&this.setTileInFrustom(this.rootTile)}setTileInFrustom(t){const e=this.cameraController.getFrustum();t.setInFrustum(e),t.getChildren().forEach((t=>{this.setTileInFrustom(t)}))}setQuadTreeZoomLevelRange(){this.rootTile&&this.setTileZoomLevelRange(this.rootTile)}setTileZoomLevelRange(t){const e=t.getLevel();if(0!==e){const i=Math.floor(this.initialZoomLevel)-1+.75*e;t.setMinZoomLevel(i)}t.getChildren().forEach((t=>{this.setTileZoomLevelRange(t)}))}setQuadTreeInZoomLevelRange(){this.rootTile&&this.setTileInZoomLevelRange(this.rootTile)}setTileInZoomLevelRange(t){const e=this.cameraController.getCurrentZoomLevel();t.setInZoomLevelRange(e),t.getChildren().forEach((t=>{this.setTileInZoomLevelRange(t)}))}setQuadTreeShouldRender(){this.renderTiles=[],this.rootTile&&this.setTileShouldRender(this.rootTile)}setTileShouldRender(t){t.setShouldRender(),t.getShouldRender()&&this.renderTiles.push(t),t.getChildren().forEach((t=>{this.setTileShouldRender(t)}))}setQuadTreeInMaxDistanceFromCamera(){const t=this.cameraController.getCamera(),e=t.position.clone(),i=this.getBaseDistanceFromCamera(t),n=this.getCameraTilt(),r=i*this.mapInfo.getScaleCm()*n;this.rootTile&&this.setTileInMaxDistanceFromCamera(this.rootTile,e,r)}getBaseDistanceFromCamera(t){const e=t.getWorldDirection(new o.Vector3);let i=Math.min(this.mapInfo.getSize().width,this.mapInfo.getSize().height);const n=Math.max(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z));return n===Math.abs(e.x)&&(i=this.mapInfo.getSize().width),n===Math.abs(e.z)&&(i=this.mapInfo.getSize().height),i}getCameraTilt(){const t=this.cameraController.getControls();return(.5*(1-parseFloat((t.polarAngle/t.maxPolarAngle).toFixed(2)))+.5)**3}setTileInMaxDistanceFromCamera(t,e,i){t.setInMaxDistanceFromCamera(e,i),t.getChildren().forEach((t=>{this.setTileInMaxDistanceFromCamera(t,e,i)}))}setConnectedDataList(t){t.forEach((t=>{var e;const{position:i,size:n}=t.getObject(),r=this.findQuadTileByBoundingData(n,i),s=this.findPoiDataByObjectId(t.getId());"section"===t.getObjectType()?null===(e=this.rootTile)||void 0===e||e.addObjectData(t):null==r||r.addObjectData(t),s&&(null==r||r.addPoiData(s))}))}setNotConnectedDataList(t){t.forEach((t=>{var e;t.objectId||null===(e=this.rootTile)||void 0===e||e.addPoiData(t)}))}removeTileDataListByMapId(t,e){t.removeObjectDataByMapId(e),t.removePoiDataByMapId(e),t.getChildren().forEach((t=>{this.removeTileDataListByMapId(t,e)}))}findPoiDataByObjectId(t){var e;return null===(e=this.poiDataList)||void 0===e?void 0:e.filter((e=>e.objectId===t))}findQuadTileByBoundingData(t,e){const i=t.width*t.height,n=l.DabeeoUtils.changeVectorMinus(e),r=Array.from(this.sortedTileDataList.values()).find((t=>t.inAreaRange(i)));return null==r?void 0:r.quadTileList.find((t=>t.inQuadTile(n)))}}},1034:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MapNaviLineGroup=void 0;const n=i(6486),r=i(2676),s=i(4607),o=i(5466),a=i(5449);class l extends r.Group{constructor(t,e,i,n){super("mapCourseGroup"),this.children=[],this.naviOptions=t,this.store=e,this.routeSimulationManager=i,this.cameraController=n,this.wayPointsInfoList=[],this.currentWayPointInfoIndex=-1}draw(t,e){this.wayPointsInfoList=(0,n.cloneDeep)(e);let i=0;const r=this.store.getDefaultFloorId();t[r].forEach(((e,n)=>{Object.entries(e).forEach((e=>{const s=e[1].map((t=>(t.location.z&&(i=Math.max(i,t.location.z)),t.location)));if(this.naviOptions.lineDivide){const e=n===t[r].length-1&&r===this.routeSimulationManager.destFloorId;this.drawDividedNaviLine(s,e)}else{const t={locations:s,lineOption:this.naviOptions.defaultLineOption};this.drawNaviLine(t)}}))})),this.position.z=i+this.naviOptions.lineZ,this.userData.name="courseGroup"}Update(){for(let t=0;t<this.children.length;t++)void 0!==this.children[t].Update&&this.children[t].Update()}drawDividedNaviLine(t,e){this.getdividedLineDataList(t,e).forEach((t=>{this.drawNaviLine(t)}))}drawNaviLine(t){if(t.locations.length<2)return;let e,i=this.naviOptions.defaultLineOption.solidLineEnabled;"boolean"==typeof t.lineOption.solidLineEnabled&&(i=t.lineOption.solidLineEnabled),e=i?new a.MapSolidLine(t,this.naviOptions):new o.MapPointLine(t,this.naviOptions,this.store,this.cameraController),this.add(e)}getdividedLineDataList(t,e){const i=this.getDivideDatumPointIndexList(t),n=[];for(let r=0;r<i.length&&r!==i.length-1;r++){const s=i[r],o=i[r+1],a=t.slice(s,o+1),l=t[o],c=this.findIndexOfMatchingWayPointIndex(l),h=this.getLastLocationType(c,r,i,e),u=this.getLineOptionByLastLocationType(h,c);n[r]={locations:a,lineOption:u}}return n}getDivideDatumPointIndexList(t){const e=[0];for(let i=0;i<this.wayPointsInfoList.length;i++)for(let n=0;n<t.length;n++){const r=this.wayPointsInfoList[i].position,s=t[n],o=r&&s.x===r.x&&s.y===r.y,a=e.includes(n);if(o&&!a){e.push(n);break}}return e.push(t.length-1),e}findIndexOfMatchingWayPointIndex(t){return this.wayPointsInfoList.findIndex((e=>{const i=e.position;return i&&t.x===i.x&&t.y===i.y}))}getLastLocationType(t,e,i,n){var r;let o;-1===t?(this.currentWayPointInfoIndex+1<=this.wayPointsInfoList.length-1&&(o=s.LAST_LOCATION_TYPE.BEFORE_WAYPOINT),this.currentWayPointInfoIndex===this.wayPointsInfoList.length-1&&(null===(r=this.naviOptions.destination)||void 0===r?void 0:r.lineOptions)&&(o=s.LAST_LOCATION_TYPE.BEFORE_DESTINATION)):o=s.LAST_LOCATION_TYPE.WAYPOINT;const a=e===i.length-2;return n&&a&&(o=s.LAST_LOCATION_TYPE.DESTINATION),o}getLineOptionByLastLocationType(t,e){var i,n;let r;t===s.LAST_LOCATION_TYPE.BEFORE_WAYPOINT&&(r=this.wayPointsInfoList[this.currentWayPointInfoIndex+1].lineOption),t===s.LAST_LOCATION_TYPE.BEFORE_DESTINATION&&(r=null===(i=this.naviOptions.destination)||void 0===i?void 0:i.lineOptions),t===s.LAST_LOCATION_TYPE.WAYPOINT&&(this.currentWayPointInfoIndex=e,r=this.wayPointsInfoList[this.currentWayPointInfoIndex].lineOption),t===s.LAST_LOCATION_TYPE.DESTINATION&&(r=null===(n=this.naviOptions.destination)||void 0===n?void 0:n.lineOptions),this.routeSimulationManager.setCurrentLineOption(r);return this.routeSimulationManager.getCurrentLineOption()}}e.MapNaviLineGroup=l},350:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.MapNaviMarkerGroup=void 0;const o=s(i(5232)),a=s(i(6194)),l=i(2676),c=i(6969),h=i(6163);class u extends l.Group{constructor(t,e,i,n){super("mapNaviMarkerGroup"),this.children=[],this.tween=null,this.naviOptions=t,this.store=e,this.mapOption=this.store.getMapOptions(),this.textureManager=i,this.cameraController=n}repositionCoursePoint(t){if(t.position){const e=this.store.getMapInfo(),{x:i}=t.position,{y:n}=t.position,r=o.MathUtils.degToRad(-e.getNorthReference());return{x:i*Math.cos(r)-n*Math.sin(r),y:i*Math.sin(r)+n*Math.cos(r),z:t.position.z}}}async drawNaviMarker(t,e,i){const n=this.getNaviIconUrl(t,e),r=this.getNaviMarkerSize(t),s=null==t?void 0:t.anchor,l=null==t?void 0:t.animate;this.userData.name="naviMarkerGroup";const h=this.store.getMapInfo(),u=new o.SpriteMaterial;await this.textureManager.asyncGetTexture(n).then((t=>{u.map=t})),u.depthTest=!1,this.mapOption.spriteKeepRotation&&(u.rotation=h.getNorthReference()*Math.PI/180);const d=new c.Sprite(u);if(l&&"destination"===e){const t=l.repeat?l.repeat:1/0,e=l.duration?l.duration:1e3,i=l.opacity?l.opacity:0;this.tween=new a.Tween(u),a.add(this.tween.to({opacity:i},e).onComplete((()=>{})).repeat(t).yoyo(!0).start()),this.store.setRenderNaviIconAnimation(!0)}return d.scale.set(r.width,r.height,0),i=this.repositionCoursePoint({position:i}),d.position.set(i.x,i.y,i.z),d.renderOrder=3,d.userData.type="marker",d.userData.size={width:r.width,height:r.height},s&&d.center.set(s.x,s.y),d}getDefaultIconUrl(t){let e="";switch(t){case"origin":e=h.DEFAULT_ICON_URLS.origin;break;case"destination":e=h.DEFAULT_ICON_URLS.destination;break;case"wayPoints":e=h.DEFAULT_ICON_URLS.wayPoint}return e}getNaviIconUrl(t,e){let i="";return i=(null==t?void 0:t.iconUrl)?t.iconUrl:this.getDefaultIconUrl(e),i}getNaviMarkerSize(t){const e={width:30,height:30};return(null==t?void 0:t.width)&&(e.width=t.width),(null==t?void 0:t.height)&&(e.height=t.height),e}visibleIcon(t){let e=!0;return t&&"visibleIcon"in t&&!1===t.visibleIcon&&(e=!1),e}async setStartEndMarker(t,e){var i,n,r,s,o,a;const l=this.store.getDefaultFloorId(),c=this.store.getMaxObjZ(),h=null===(i=this.naviOptions.origin)||void 0===i?void 0:i.markerOptions,u=null===(n=this.naviOptions.destination)||void 0===n?void 0:n.markerOptions,d=h&&"positionZ"in h?h.positionZ:c+2,p=u&&"positionZ"in u?u.positionZ:c+2,f={x:null===(r=null==t?void 0:t.position)||void 0===r?void 0:r.x,y:null===(s=null==t?void 0:t.position)||void 0===s?void 0:s.y,z:Number(d)},m={x:null===(o=null==e?void 0:e.position)||void 0===o?void 0:o.x,y:null===(a=null==e?void 0:e.position)||void 0===a?void 0:a.y,z:Number(p)};if((null==t?void 0:t.floorId)===l&&this.visibleIcon(h)){const t=await this.drawNaviMarker(h,"origin",f);t.userData.id=`${this.makeMarkerId()}START`,t.userData.floorId=l,this.add(t)}if((null==e?void 0:e.floorId)===l&&this.visibleIcon(u)){const t=await this.drawNaviMarker(u,"destination",m);t.userData.id=`${this.makeMarkerId()}END`,t.userData.floorId=l,this.add(t)}this.store.setRenderDirty(!0)}setWayPointMarkers(t){const e=this.store.getDefaultFloorId(),i=this.store.getMaxObjZ();t.forEach((async(t,n)=>{var r,s,o;const a=this.naviOptions.wayPoints?null===(r=this.naviOptions.wayPoints[n])||void 0===r?void 0:r.markerOptions:void 0;if(!this.visibleIcon(a))return;const l=a&&"positionZ"in a?a.positionZ:i+2,c={x:null===(s=t.position)||void 0===s?void 0:s.x,y:null===(o=t.position)||void 0===o?void 0:o.y,z:Number(l)};if(t.floorId===e){const t=await this.drawNaviMarker(a,"wayPoints",c);t.userData.id=this.makeMarkerId()+n,t.userData.floorId=e,this.add(t)}})),this.store.setRenderDirty(!0)}makeMarkerId(){return`MARKER${(new Date).getTime()}`}setNaviMarkers(t,e,i){this.setStartEndMarker(t,e),this.setWayPointMarkers(i)}updateNaviMarkerScaleByMapScale(){this.children.forEach((t=>{const e=this.cameraController.getCurrentCmFromPixel(t.userData.size.width),i=this.cameraController.getCurrentCmFromPixel(t.userData.size.height);t.scale.set(e,i,1)}))}Update(){for(let t=0;t<this.children.length;t++)void 0!==this.children[t].Update&&this.children[t].Update();this.tween&&a.update(),this.updateNaviMarkerScaleByMapScale()}removeTween(){this.tween&&(a.remove(this.tween),this.tween=null,this.store.setRenderNaviIconAnimation(!1))}}e.MapNaviMarkerGroup=u},3905:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.MapParticleLight=void 0;const o=s(i(5232)),a=i(6969),l=i(6163);class c extends o.Object3D{constructor(t,e,i,n){super(),this.children=[],this.store=e,this.mapOption=this.store.getMapOptions(),this.textureManager=i,this.naviAnimOption=t,this.particleLight=null,this.cameraController=n}getNaviIconUrl(){let t="";const{markerOptions:e}=this.naviAnimOption;return t=e&&e.iconUrl?e.iconUrl:l.DEFAULT_ICON_URLS.naviSimulation,t}getNaviMarkerSize(){const t={width:30,height:30},{markerOptions:e}=this.naviAnimOption;return(null==e?void 0:e.width)&&(t.width=e.width),(null==e?void 0:e.height)&&(t.height=e.height),t}async draw(){var t;const e=this.store.getMapInfo(),i=this.getNaviMarkerSize(),n=this.getNaviIconUrl(),r=null===(t=this.naviAnimOption.markerOptions)||void 0===t?void 0:t.anchor,s=new o.SpriteMaterial({});await this.textureManager.asyncGetTexture(n).then((t=>{s.map=t})),s.depthTest=!1,this.mapOption.spriteKeepRotation&&(s.rotation=e.getNorthReference()*Math.PI/180);const l=new a.Sprite(s);l.scale.set(i.width,i.height,0),l.userData.size={width:i.width,height:i.height},r&&l.center.set(r.x,r.y),this.particleLight=l;const{markerOptions:c}=this.naviAnimOption;return this.particleLight.renderOrder=3,this.particleLight.userData.size={width:i.width,height:i.height},this.particleLight.Update=this.Update.bind(this),this.particleLight}updateParticleLightScaleByMapScale(){if(this.particleLight){const t=this.cameraController.getCurrentCmFromPixel(this.particleLight.userData.size.width),e=this.cameraController.getCurrentCmFromPixel(this.particleLight.userData.size.height);this.particleLight.scale.set(t,e,1)}}Update(){for(let t=0;t<this.children.length;t++)void 0!==this.children[t].Update&&this.children[t].Update();this.updateParticleLightScaleByMapScale()}cleanup(){}}e.MapParticleLight=c},5466:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.MapPointLine=void 0;const a=s(i(5232)),l=i(2285),c=i(6202),h=o(i(8750)),u=o(i(700));class d extends l.Points{constructor(t,e,i,n){super(new a.BufferGeometry,new a.PointsMaterial),this.children=[],this.cleanup(),this.naviLineData=t,this.naviOptions=e,this.store=i,this.cameraController=n,this.geometry=this.getPointLineGeometry(),this.material=this.getPointLineMaterial(),this.renderOrder=2,this.isPointLineAnimationEnabled()&&this.setPointLineAnimationInfo()}Update(){for(let t=0;t<this.children.length;t++)void 0!==this.children[t].Update&&this.children[t].Update();this.pointLineAnimationInfo?(this.store.setRenderRouteAnimation(!0),this.pointLineAnimationInfo.alpha<=1?(this.animatePointLines(this.pointLineAnimationInfo),this.pointLineAnimationInfo.alpha+=this.pointLineAnimationInfo.speed):(this.resetPointLines(this.pointLineAnimationInfo),this.pointLineAnimationInfo.alpha=0)):this.store.setRenderRouteAnimation(!1),this.material instanceof a.RawShaderMaterial&&(this.material.uniforms.zoom.value=this.cameraController.getZoomLevelToZoom(this.cameraController.getCurrentZoomLevel()))}getPointLineMaterial(){var t;const{lineOption:e}=this.naviLineData,i=e.lineColor?e.lineColor:this.naviOptions.defaultLineOption.lineColor,n=null===(t=c.DabeeoUtils.hexToRgb(i))||void 0===t?void 0:t.map((t=>t/255)),r=e.lineSpotSize?e.lineSpotSize:this.naviOptions.defaultLineOption.lineSpotSize;return new a.RawShaderMaterial({uniforms:{pixelRatio:{value:window.devicePixelRatio},size:{value:r},zoom:{value:this.cameraController.getZoomLevelToZoom(this.cameraController.getCurrentZoomLevel())},color:{value:n?(new a.Vector3).fromArray(n):new a.Vector3(0,0,0)}},vertexShader:h.default,fragmentShader:u.default,depthTest:!1,transparent:!0})}getPointLineGeometry(){const t=this.getPointsData(),e=new a.Shape(t.vectors).getSpacedPoints(t.numPoints);return(new a.BufferGeometry).setFromPoints(e)}getPointsData(){let t=0;const{locations:e,lineOption:i}=this.naviLineData,n=e.map(((i,n)=>{if(n<e.length-1){const i=new a.Vector2(e[n].x,e[n].y),r=new a.Vector2(e[n+1].x,e[n+1].y);t+=i.distanceTo(r)}return new a.Vector2(i.x,i.y)})),r=i.lineSpotInterval?i.lineSpotInterval:this.naviOptions.defaultLineOption.lineSpotInterval;return{vectors:n,numPoints:Math.round(t/r)}}setPointLineAnimationInfo(){const t=Array.from(this.geometry.getAttribute("position").array),e=[...t];for(let t=0;t<3;t++){const t=e.length-1,i=e.splice(0,1);e.splice(t,0,i[0])}const{lineOption:i}=this.naviLineData;this.pointLineAnimationInfo={startPositions:t,targetPositions:e,alpha:0,speed:i.lineSpotAnimateSpeed?i.lineSpotAnimateSpeed:this.naviOptions.defaultLineOption.lineSpotAnimateSpeed}}isPointLineAnimationEnabled(){let t=!1;const{lineOption:e}=this.naviLineData;return t="boolean"==typeof e.lineSpotAnimate?e.lineSpotAnimate:this.naviOptions.defaultLineOption.lineSpotAnimate,t}resetPointLines(t){const{startPositions:e}=t;this.geometry.setAttribute("position",new a.BufferAttribute(new Float32Array(e),3))}animatePointLines(t){const{alpha:e,startPositions:i,targetPositions:n}=t,r=[];for(let t=0;t<i.length;t+=3){const s=new a.Vector3(i[t],i[t+1],i[t+2]),o=new a.Vector3(n[t],n[t+1],n[t+2]);let l=(new a.Vector3).lerpVectors(s,o,e);t===i.length-3&&(l=o),r.push(l.x,l.y,l.z)}this.geometry.setAttribute("position",new a.BufferAttribute(new Float32Array(r),3))}}e.MapPointLine=d},7850:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.MapRouteSimulationGroup=void 0;const o=s(i(5232)),a=i(6486),l=i(2676),c=i(1034),h=i(350),u=i(3905),d=i(6202);class p extends l.Group{constructor(t,e,i,n,r){super("routeSimulationGroup"),this.children=[],this.index=0,this.totalDistanceOfThisFloor=0,this.distance=0,this.curVal=0,this.velocity=0,this.store=t,this.cameraController=e,this.textureManager=i,this.routeSimulationManager=n,this.naviLineGroup=null,this.naviMarkerGroup=null,this.particleLight=null,this.objectGroup=r}validateIsEmptyCourse(){if(this.routeSimulationManager){const{navigation:t}=this.routeSimulationManager;return void 0===t[this.store.getDefaultFloorId()]}}drawNavigation(){if(this.routeSimulationManager){const{naviOptions:t,saveNaviLine:e,naviSPosition:i,naviEPosition:n,wayPointsInfoList:r}=this.routeSimulationManager;if(this.naviLineGroup&&(this.naviLineGroup.cleanup(),this.remove(this.naviLineGroup),this.particleLight&&(this.particleLight.cleanup(),this.remove(this.particleLight)),this.naviLineGroup=null),this.naviMarkerGroup&&(this.naviMarkerGroup.cleanup(),this.remove(this.naviMarkerGroup),this.naviMarkerGroup=null),this.validateIsEmptyCourse())return;this.naviLineGroup=new c.MapNaviLineGroup(t,this.store,this.routeSimulationManager,this.cameraController),this.naviMarkerGroup=new h.MapNaviMarkerGroup(t,this.store,this.textureManager,this.cameraController),this.routeSimulationManager.getIsNaviAnimation()||0!==Object.keys(e).length&&(this.routeSimulationManager.navigation=(0,a.cloneDeep)(e));const s=(0,a.cloneDeep)(e);this.naviLineGroup.draw(s,r),this.add(this.naviLineGroup),this.naviMarkerGroup.setNaviMarkers(i,n,r),this.add(this.naviMarkerGroup),this.store.setRenderDirty(!0)}}calculateFloorDistance(){if(this.totalDistanceOfThisFloor=0,this.distance=0,this.curVal=1,this.velocity=0,this.routeSimulationManager.moves)for(let t=0;t<this.routeSimulationManager.moves.length-1;t++)this.totalDistanceOfThisFloor+=d.DabeeoUtils.getDistance(this.routeSimulationManager.moves[t],this.routeSimulationManager.moves[t+1])}async drawRouteAnimation(){var t;if(this.routeSimulationManager){const{naviOptions:e,naviAnimOption:i,courseIdx:n}=this.routeSimulationManager;if(this.routeSimulationManager.routeIndex<=n){const e=Object.values(this.routeSimulationManager.navigation[this.store.getDefaultFloorId()])[0][this.routeSimulationManager.routeIndex];if(this.routeSimulationManager.moves=e.map((t=>t.location)),i.zoom&&this.routeSimulationManager.moves&&this.routeSimulationManager.moves.length>0){const t=this.getParticleWorldPosition(this.routeSimulationManager.moves[0]);this.cameraController.moveTo(t.x,0,t.z,!1)}this.calculateFloorDistance(),this.routeSimulationManager.transCode=null===(t=e[this.routeSimulationManager.routeIndex===n?0:e.length-1])||void 0===t?void 0:t.transCode}else this.routeSimulationManager.moves=void 0;if(void 0===this.routeSimulationManager.moves||null===this.routeSimulationManager.moves)return;this.routeSimulationManager.navigation[this.store.getDefaultFloorId()].splice(0,1),this.routeSimulationManager.routeIndex++,this.particleLight=await new u.MapParticleLight(i,this.store,this.textureManager,this.cameraController).draw(),this.add(this.particleLight),this.index=0;let r=e.lineZ;const{markerOptions:s}=i;s&&s.positionZ&&(r=s.positionZ),this.particleLight.position.x=this.routeSimulationManager.moves[0].x,this.particleLight.position.y=this.routeSimulationManager.moves[0].y,this.particleLight.position.z=r}}draw(){if(this.routeSimulationManager){const{navigation:t,naviAnimOption:e,naviPathList:i,destFloorId:n}=this.routeSimulationManager,r=this.store.getDefaultFloorId();this.routeSimulationManager.getIsNaviAnimation()&&!t[r]&&this.routeSimulationManager.stopRouteAnimation(),this.routeSimulationManager.getIsNavigationMode()&&this.drawNavigation(),this.routeSimulationManager.getIsNaviAnimation()&&this.drawRouteAnimation();(()=>{var t;return Object.values(e).includes(e.destOption)&&(null===(t=null==e?void 0:e.destOption)||void 0===t?void 0:t.activeDest)&&r===n})()&&this.objectGroup.updateObjectStateByIds(e.destOption,i)}}removeCourse(){this.naviLineGroup&&(this.naviLineGroup.cleanup(),this.remove(this.naviLineGroup),this.naviMarkerGroup&&(this.naviMarkerGroup.cleanup(),this.naviMarkerGroup.removeTween(),this.remove(this.naviMarkerGroup)),this.naviLineGroup=null,this.naviMarkerGroup=null)}removeParticle(){this.particleLight&&(this.particleLight.cleanup(),this.remove(this.particleLight),this.particleLight=null)}shouldRemoveParticle(){let t=!1;return!1===this.routeSimulationManager.getIsNaviAnimation()&&this.routeSimulationManager.naviAnimOption.removeIcon&&(t=!0),t}lowerSpeed(t){return this.velocity=5e-4*t*this.routeSimulationManager.naviAnimOption.speedRate,this.curVal+=this.velocity,this.curVal=this.curVal>=t?t:this.curVal,this.curVal}particleMove(){if(this.routeSimulationManager){const{mapInfo:t,naviAnimOption:e,moves:i,originFloorId:n}=this.routeSimulationManager;if(null==i){const{routeIndex:t,courseIdx:e}=this.routeSimulationManager;return void(t>e&&this.routeSimulationManager.setIsNaviAnimation(!1))}let r=.005*Math.sqrt(t.getSize().width)*e.speedRate*this.routeSimulationManager.fpsRateRatio;if(this.routeSimulationManager.originFloorId===this.store.getDefaultFloorId()&&this.distance<this.totalDistanceOfThisFloor/3&&(r=this.lowerSpeed(r)),this.index===i.length-1){const{crntFloor:t,nextFloor:e}=this.routeSimulationManager.detectFloorChange();return void(this.shouldRemoveParticle()&&this.removeParticle())}let s=-r,a=-r;const l=i[this.index+1].x-i[this.index].x,c=i[this.index+1].y-i[this.index].y;if(l>0&&(s=r),c>0&&(a=r),Math.abs(l)>Math.abs(c)?a*=Math.abs(c)/Math.abs(l):s*=Math.abs(l)/Math.abs(c),this.particleLight){const t=Math.abs(this.particleLight.position.x-i[this.index+1].x),n=Math.abs(this.particleLight.position.y-i[this.index+1].y);if(t>r||n>r?(t>r&&(this.particleLight.position.x+=s),n>r&&(this.particleLight.position.y+=a)):(this.index++,this.particleLight.position.x=i[this.index].x,this.particleLight.position.y=i[this.index].y),this.distance+=d.DabeeoUtils.getDistance({x:0,y:0},{x:s,y:a}),!e)return;if(e.zoom){const t=new o.Vector3;this.particleLight.getWorldPosition(t);const i=t.x,n=t.z;this.cameraController.zoomControl({zoom:e.zoom}),this.cameraController.moveTo(i,0,n,!1)}}}}Update(){var t;for(let t=0;t<this.children.length;t++)void 0!==this.children[t].Update&&this.children[t].Update();(null===(t=this.routeSimulationManager)||void 0===t?void 0:t.getIsNaviAnimation())&&!1===this.routeSimulationManager.getIsFloorChangeAnimating()&&!1===this.cameraController.getIsCameraAnimating()?(this.store.setRenderRouteAnimation(!0),this.particleMove()):this.store.setRenderRouteAnimation(!1)}getParticleWorldPosition(t){const e=new o.Group;this.add(e);const{x:i,y:n}=t;e.position.x=i,e.position.y=n,e.position.z=0;const r=new o.Vector3;return e.getWorldPosition(r),this.remove(e),r}}e.MapRouteSimulationGroup=p},5449:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.MapSolidLine=void 0;const o=s(i(5232)),a=i(1367),l=i(4925);class c extends l.Mesh{constructor(t,e){super(new o.BufferGeometry,new o.MeshBasicMaterial),this.children=[],this.cleanup(),this.naviLineData=t,this.naviOptions=e,this.geometry=this.getSolidLineGeometry(),this.material=this.getSolidLineMaterial(),this.renderOrder=2}getSolidLineMaterial(){const{lineOption:t}=this.naviLineData,e=t.lineColor?t.lineColor:this.naviOptions.defaultLineOption.lineColor,i=new o.MeshBasicMaterial({color:new o.Color(e),side:o.DoubleSide,depthWrite:!1});return i.depthTest=!1,i.transparent=!0,i}getSolidLineGeometry(){const{locations:t,lineOption:e}=this.naviLineData,i=t.map((t=>new o.Vector3(t.x,t.y,t.z))),n=e.solidLineWidth?e.solidLineWidth:this.naviOptions.defaultLineOption.solidLineWidth,r=e.solidLineJoin?e.solidLineJoin:this.naviOptions.defaultLineOption.solidLineJoin,s={strokeColor:"#000",strokeLineCap:e.solidLineCap?e.solidLineCap:this.naviOptions.defaultLineOption.solidLineCap,strokeLineJoin:r,strokeMiterLimit:4,strokeWidth:n};return a.SVGLoader.pointsToStroke(i,s)}}e.MapSolidLine=c},1716:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MapTwoMaps=void 0;const n=i(5123);e.MapTwoMaps=class{constructor(t,e){this.fadeOutStyle=null,this.fadeInStyle=null,this.splitContainer1=null,this.splitContainer2=null,this.wrapContainer=null,this.fadeOutTimer=null,this.store=t,this.mapContainer=e}getCanvas(){return this.mapContainer.querySelector("canvas")}getCss2dRenderer(){return this.mapContainer.querySelector(".css2dRenderer")}clearCaptureRouteSimulationScreen(){var t,e,i,n,r,s;const o=this.getCanvas(),a=this.getCss2dRenderer(),l=1e3;this.mapContainer.style.overflow="",null===(e=null===(t=this.wrapContainer)||void 0===t?void 0:t.parentNode)||void 0===e||e.removeChild(this.wrapContainer),null===(n=null===(i=this.splitContainer1)||void 0===i?void 0:i.parentNode)||void 0===n||n.removeChild(this.splitContainer1),null===(s=null===(r=this.splitContainer2)||void 0===r?void 0:r.parentNode)||void 0===s||s.removeChild(this.splitContainer2),a.style.display="",o.style.display="",o.style.animation="fadeIn 1000ms forwards",a.style.animation="fadeIn 1000ms forwards",this.fadeOutTimer&&clearTimeout(this.fadeOutTimer),setTimeout((()=>{var t,e;null===(t=this.fadeOutStyle)||void 0===t||t.remove(),null===(e=this.fadeInStyle)||void 0===e||e.remove(),o.style.animation="",a.style.animation=""}),l)}displayCaptureRouteSimulationScreen(t){this.store.setRenderNaviIconAnimation(!1);const e=t.twoFloorsNavigationDuration||n.DEFAULT_TWO_FLOORS_NAVIGATION_DURATION;this.fadeOutTimer=setTimeout((()=>{const i=this.getCanvas(),n=this.getCss2dRenderer();this.setCaptureRouteSimulationScreenDest(),this.fadeOutStyle=this.fadeOutFrame(),this.fadeInStyle=this.fadeInFrame(),this.mapContainer.style.overflow="hidden";const r=this.mapContainer.clientWidth||window.innerWidth,s=this.mapContainer.clientHeight||window.innerHeight,o=`width: ${r/2}px ; height: ${s/2}px ${t.twoFloorsNavigationOriginCss}`,a=`width: ${r/2}px ; height: ${s/2}px; ${t.twoFloorsNavigationDestCss}`;this.splitContainer1=this.makeSplitContainer(this.captureRouteSimulationScreenOrigin,t.twoFloorsNavigationOriginElement,o),this.splitContainer2=this.makeSplitContainer(this.captureRouteSimulationScreenDest,t.twoFloorsNavigationDestElement,a),i.style.display="none",n.style.display="none",this.splitContainer1&&this.splitContainer2&&(this.wrapContainer=document.createElement("div"),this.wrapContainer.style.position="relative",this.wrapContainer.style.width=`${r}px`,this.wrapContainer.style.height=`${s}px`,this.mapContainer.appendChild(this.wrapContainer),this.wrapContainer.appendChild(this.splitContainer1),this.wrapContainer.appendChild(this.splitContainer2),this.splitContainer2.style.animation=`fadeIn ${e}ms forwards`,this.splitContainer1.style.animation=`fadeIn ${e}ms forwards`)}),e/3)}setCaptureRouteSimulationScreenOrigin(){var t;this.captureRouteSimulationScreenOrigin=null===(t=this.store.getRenderer())||void 0===t?void 0:t.getImageData()}setCaptureRouteSimulationScreenDest(){var t;this.captureRouteSimulationScreenDest=null===(t=this.store.getRenderer())||void 0===t?void 0:t.getImageData()}fadeOutFrame(){const t=[{opacity:1},{opacity:0}],e=`@keyframes fadeOut {\n                0%   {opacity:${t[0].opacity};}\n                100% {opacity:${t[1].opacity};}\n            }`,i=document.createElement("style");return i.type="text/css",i.className="animation-opacity",i.appendChild(document.createTextNode(e)),document.head.appendChild(i),i}fadeInFrame(){const t=[{opacity:0},{opacity:1}],e=`@keyframes fadeIn {\n                0%   {opacity:${t[0].opacity};}\n                100% {opacity:${t[1].opacity};}\n            }`,i=document.createElement("style");return i.type="text/css",i.className="animation-opacity",i.appendChild(document.createTextNode(e)),document.head.appendChild(i),i}makeSplitContainer(t,e,i){const n=document.createElement("div"),r=new Image;return r.src=t,r.style.width="100%",r.style.height="100%",e&&n.appendChild(e),n.appendChild(r),n.style.cssText=i,n}}},3149:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RouteSimulationManager=void 0;const n=i(6486),r=i(5123),s=i(6202),o=i(1716);e.RouteSimulationManager=class{constructor(t,e,i,s){this.isFloorChangeAnimating=!1,this.style1=null,this.style2=null,this.canvas=null,this.css2dRenderer=null,this.fadeOutTimer=null,this.fadeInTimer=null,this.floorChangeDirection="up",this.cameraController=e,this.store=t,this.mapInfo=t.getMapInfo(),this.floorData=this.mapInfo.getFloors(),this.poiInfo=[],this.floorData.forEach((t=>{t.pois.forEach((t=>{this.poiInfo.push(t)}))})),this.dabeeoMapData=s,this.isNavigationMode=!1,this.isNaviAnimation=!1,this.naviAnimOption=(0,n.cloneDeep)(r.defaultNaviAnimOption),this.naviOptions=(0,n.cloneDeep)(r.defaultNaviOptions),this.nodes=[],this.floorData.forEach((t=>{this.nodes=this.nodes.concat(t.nodes)})),this.naviPathList=[],this.poiIdsOnNavi=[],this.naviSPosition=null,this.naviEPosition=null,this.navigation={},this.saveNaviLine={},this.routeIndex=0,this.courseIdx=0,this.moves=null,this.originFloorId="",this.destFloorId="",this.destPoiId="",this.wayPointsInfoList=[],this.eventDispatcher=i,this.fpsRateRatio=void 0,this.transCode="",this.currentLineOption=this.naviOptions.defaultLineOption,this.mapContainer=this.store.getContainer(),this.mapTwoMaps=new o.MapTwoMaps(this.store,this.mapContainer)}setWayPointsInfoList(t){this.wayPointsInfoList=[];t.slice(1,t.length-1).forEach(((t,e)=>{var i;let n,r;if(this.naviOptions.wayPoints&&(n=null===(i=this.naviOptions.wayPoints[e])||void 0===i?void 0:i.lineOptions),t.position){r={x:t.position.x,y:t.position.y,z:t.position.z?t.position.z:0};const e={position:r,floorId:t.floorId,lineOption:n};this.wayPointsInfoList.push(e)}else console.error("position is not available")}))}setCurrentLineOption(t){this.currentLineOption=t||this.naviOptions.defaultLineOption}getCurrentLineOption(){return this.currentLineOption}shouldShowDestinationTag(){var t,e,i;const n=null===(e=null===(t=this.store)||void 0===t?void 0:t.getDefaultFloor())||void 0===e?void 0:e.id;let r=!1;return this.destPoiId&&(null===(i=this.naviOptions.destination)||void 0===i?void 0:i.showTag)&&this.destFloorId===n&&this.isNavigationMode&&(r=!0),r}shouldRedrawRoute(){let t=!1;return(this.getIsNaviAnimation()||this.getIsNavigationMode())&&(t=!0),t}shouldFadeInAnim(){let t=!1;return this.naviAnimOption.enableFloorMotionCSS&&this.getIsFloorChangeAnimating()&&(t=!0),t}getDestPoiId(){return this.destPoiId}getIsNavigationMode(){return this.isNavigationMode}setIsNavigationMode(t){this.isNavigationMode=t}getIsFloorChangeAnimating(){return this.isFloorChangeAnimating}getIsNaviAnimation(){return this.isNaviAnimation}setIsNaviAnimation(t){this.isNaviAnimation=t}setPoiIdsOnNavi(t){t.forEach(((e,i)=>{i>0&&i<t.length-1&&e.poiId&&this.poiIdsOnNavi.push(e.poiId)})),t[0].poiId&&this.poiIdsOnNavi.push(t[0].poiId),t[t.length-1].poiId&&this.poiIdsOnNavi.push(t[t.length-1].poiId)}setNaviMarkerPosition(t){!t||t.length<1||(this.naviSPosition={},this.naviEPosition={},this.naviSPosition={floorId:t[0].floorId,position:t[0].position},this.naviEPosition={floorId:t[t.length-1].floorId,position:t[t.length-1].position,poiId:t[t.length-1].poiId})}setCourseIndex(t){let e=0,i="";t.forEach(((t,n)=>{0===n&&(i=t.floorId),i!==t.floorId&&e++,i=t.floorId,t.idx=e}))}repositionCoursePoint(t){let e;if(t.position){const{x:i}=t.position,{y:n}=t.position,r=s.DabeeoUtils.degToRad(-this.mapInfo.getNorthReference());e={x:i*Math.cos(r)-n*Math.sin(r),y:i*Math.sin(r)+n*Math.cos(r),z:t.position.z}}return e}addNaviCourseItem(t,e){this.navigation&&(this.navigation[t]||(this.navigation[t]=[]),this.navigation[t].push(e))}createNaviCourse(t){let e="",i={};const n=t.length-1;let r=0;t.forEach(((t,s)=>{0===s&&(e=t.floorId),e!==t.floorId&&s<=n&&(this.addNaviCourseItem(e,i),r++,e=t.floorId,i={}),Object.keys(i).filter((e=>e===t.idx.toString())).length<1&&(i[t.idx]=[]);const o=this.repositionCoursePoint(t);if(o){const e={x:o.x,y:o.y,z:o.z?o.z:0};i[t.idx].push({floorId:t.floorId,location:e,transCode:t.transCode})}s===n&&(this.addNaviCourseItem(e,i),this.courseIdx=r++)}))}setNaviLines(t){this.isNavigationMode=!0,this.navigation={},this.createNaviCourse(t),Object.entries(this.navigation).forEach((t=>{const[e,i]=t;Object.entries(i).forEach((t=>{const[i,n]=t;1===n.length&&delete this.navigation[e][parseInt(i,10)]}))})),0!==Object.keys(this.navigation).length?this.saveNaviLine=(0,n.cloneDeep)(this.navigation):this.isNavigationMode=!1}getRouteOn(t,e){var i,n,r,s,o,a,l,c;this.resetNaviAnimationOption();const h=this.setNavigationOption(e);if(this.response=t,this.originFloorId=null===(i=this.response)||void 0===i?void 0:i.originFloorId,this.destFloorId=null===(n=this.response)||void 0===n?void 0:n.destFloorId,this.destPoiId=null===(r=this.response)||void 0===r?void 0:r.pathInfo[this.response.pathInfo.length-1].poiId,this.setWayPointsInfoList(null===(s=this.response)||void 0===s?void 0:s.wayPoints),this.setCurrentLineOption(e.defaultLineOption),this.isNavigationMode=!0,!this.response||0!==this.response.totalDistance)return this.naviPathList=this.response,this.setPoiIdsOnNavi(null===(o=this.response)||void 0===o?void 0:o.locations),this.setNaviMarkerPosition(null===(a=this.response)||void 0===a?void 0:a.locations),this.setCourseIndex(null===(l=this.response)||void 0===l?void 0:l.locations),this.setNaviLines(null===(c=this.response)||void 0===c?void 0:c.locations),this.canvas=this.mapContainer.querySelector("canvas"),this.css2dRenderer=this.mapContainer.querySelector(".css2dRenderer"),h}getRouteOff(){!1!==this.isNavigationMode?(this.setIsNavigationMode(!1),this.setIsNaviAnimation(!1),this.cameraController.setIsNaviAnimationOn(!1),this.navigation={},this.saveNaviLine={},this.naviPathList=[],this.naviSPosition=null,this.naviEPosition=null,this.initNaviIndex(),this.poiIdsOnNavi=[],this.store.setRenderDirty(!0),this.clearAnimateChangeFloor(),this.mapTwoMaps.clearCaptureRouteSimulationScreen(),this.store.setRenderNaviIconAnimation(!1)):console.error("제거할 모의주행 경로가 존재하지 않습니다.")}initNaviIndex(){this.courseIdx=0,this.routeIndex=0}setNavigationOption(t){return this.naviOptions=(0,n.merge)(this.naviOptions,t),this.naviOptions}resetNaviAnimationOption(){this.naviAnimOption=(0,n.cloneDeep)(r.defaultNaviAnimOption)}setNaviAnimOption(t){return this.naviAnimOption=(0,n.merge)(this.naviAnimOption,t),this.naviAnimOption.twoFloorsNavigationOriginCss=r.DEFAULT_TWO_FLOORS_NAVIGATION_ORIGIN+this.naviAnimOption.twoFloorsNavigationOriginCss,this.naviAnimOption.twoFloorsNavigationDestCss=r.DEFAULT_TWO_FLOORS_NAVIGATION_DEST+this.naviAnimOption.twoFloorsNavigationDestCss,this.naviAnimOption}startRouteAnimation(t=null){let e;if(this.setIsNaviAnimation(!0),this.isNavigationMode){if(0!==Object.keys(this.navigation).length)return this.navigation=(0,n.cloneDeep)(this.saveNaviLine),this.cameraController.setIsNaviAnimationOn(!0),t&&"object"==typeof t&&Object.keys(t).length>0?e=this.setNaviAnimOption(t):this.naviAnimOption={speedRate:10},this.routeIndex=0,e;console.error("navigation is zero")}else console.error("모의주행할 경로가 존재하지 않습니다. ")}startFadeIn(){if(!this.getIsFloorChangeAnimating())return;const t="fadeIn",e=this.getAnimDuration();this.style2=this.createFadeStyle(t,this.floorChangeDirection),this.mapContainer.style.overflow="hidden",this.css2dRenderer&&this.canvas&&(this.canvas.style.animation=`fadeIn ${e}ms forwards`,this.css2dRenderer.style.animation=`fadeIn ${e}ms forwards`,this.fadeInTimer=setTimeout((()=>{this.clearAnimateChangeFloor()}),e))}stopRouteAnimation(){var t;this.setIsNaviAnimation(!1),this.cameraController.setIsNaviAnimationOn(!1),this.routeIndex=0,this.naviAnimOption.destOption&&(this.naviAnimOption.destOption.activeDest=!1),null===(t=this.eventDispatcher)||void 0===t||t.dispatchNaviComplete(),this.clearAnimateChangeFloor()}captureFloorImage(){this.store.setCaptureRouteSimulationScreen(!0)}setCaptureOriginFloor(){this.mapTwoMaps.setCaptureRouteSimulationScreenOrigin()}getNaviStartDelay(){return 1e3+.01*(this.naviAnimOption.floorMotionDuration||0)}getAnimDuration(){return(this.naviAnimOption.floorMotionDuration||r.DEFAULT_FLOOR_MOTION_DURATION)/2}moveToNextFloor(t){this.store.getIsDefaultMapNow()?this.triggerDefaultMapFloorChange(t):this.triggerIndoorMapFloorChange(t)}triggerDefaultMapFloorChange(t){null!==t&&(this.store.setNextFloorId(t),this.store.setPrevFloorIndex(),this.store.setCurFloorIndex(this.store.getNextFloorId()),this.store.setIsFloorChanged(!0))}triggerIndoorMapFloorChange(t){null!==t&&(this.store.setNextIndoorMapFloorIdByMapId(this.store.getCurMapId(),t),this.store.setIsIndoorMapFloorChanged(!0))}findFloorDataByFloorId(t){let e=null;const i=this.dabeeoMapData.dataFloor.getFloors().find((e=>e.id===t)),n=this.store.getCurIndoorMapFloorByMapId(this.store.getCurMapId());return n&&(e={id:n.id,name:n.name,defaultYn:n.defaultYn}),i&&(e={id:i.id,name:i.name,defaultYn:i.defaultYn}),e}setIsFloorChangeAnimating(t){this.isFloorChangeAnimating=t}clearAnimateChangeFloor(){var t,e,i;if(this.naviAnimOption.enableFloorMotionCSS){const n=this.getNaviStartDelay();if(this.fadeOutTimer&&clearTimeout(this.fadeOutTimer),this.fadeInTimer&&clearTimeout(this.fadeInTimer),this.cameraController.setIsNaviAnimationOn(!0),setTimeout((()=>{this.setIsFloorChangeAnimating(!1)}),n),null===(t=this.eventDispatcher)||void 0===t||t.dispatchFloorChangeAnimationEnd(),this.mapContainer.style.overflow="",null===(e=this.style1)||void 0===e||e.remove(),null===(i=this.style2)||void 0===i||i.remove(),!this.css2dRenderer||!this.canvas)return;this.canvas.style.animation="",this.css2dRenderer.style.animation=""}}createFadeStyle(t,e){let i;i="fadeIn"===t?"up"===e?[{transform:"translateY(-100%)"},{transform:"translateY(0%)"}]:[{transform:"translateY(150%)"},{transform:"translateY(0%)"}]:"up"===e?[{transform:"translateY(0%)"},{transform:"translateY(150%)"}]:[{transform:"translateY(0%)"},{transform:"translateY(-100%)"}];const n=document.createElement("style");n.className="animation",n.type="text/css";const r=`@keyframes ${t}  {\n            0%   {transform:${i[0].transform};}\n            100%  {transform:${i[1].transform};}\n          }`;return n.appendChild(document.createTextNode(r)),document.head.appendChild(n),n}startFadeOut(t,e,i){this.style1=this.createFadeStyle(t,e),this.mapContainer.style.overflow="hidden",this.css2dRenderer&&this.canvas&&(this.canvas.style.animation=`${t} ${i}ms forwards`,this.css2dRenderer.style.animation=`${t} ${i}ms forwards`)}floorMotionCSS(t){this.setIsFloorChangeAnimating(!0),this.floorChangeDirection=this.store.getCurFloorIndex()>this.store.getFloorIndex(t)?"up":"down";const e=this.getAnimDuration();this.startFadeOut("fadeOut",this.floorChangeDirection,e),this.fadeOutTimer=setTimeout((()=>{this.moveToNextFloor(t)}),e)}detectFloorChange(){var t,e;let i=null,n=null;if(this.routeIndex<=this.courseIdx&&Object.entries(this.saveNaviLine).forEach((t=>{const[e,n]=t;n.find((t=>Object.keys(t)[0]===(this.routeIndex-1).toString()))&&(i=e)})),Object.entries(this.navigation).forEach((t=>{const[e,i]=t;i.find((t=>Object.keys(t)[0]===this.routeIndex.toString()))&&(n=e)})),n)if(null===(t=this.eventDispatcher)||void 0===t||t.dispatchFloorChanging(this.findFloorDataByFloorId(i),this.findFloorDataByFloorId(n),this.transCode),this.setIsNaviAnimation(!0),this.naviAnimOption.changeFloorDelay){const t=this.naviAnimOption.changeFloorDelay;this.moves=null,setTimeout((()=>{this.naviAnimOption.enableFloorMotionCSS?n&&this.floorMotionCSS(n):(this.cameraController.setIsNaviAnimationOn(!0),this.moveToNextFloor(n))}),t)}else this.naviAnimOption.enableFloorMotionCSS?this.floorMotionCSS(n):(this.moves=null,this.moveToNextFloor(n));else this.cameraController.setIsNaviAnimationOn(!1),this.routeIndex=0,this.setCaptureOriginFloor(),this.captureFloorImage(),null===(e=this.eventDispatcher)||void 0===e||e.dispatchNaviComplete(),this.naviAnimOption.enableTwoFloorsNavigation&&this.getIsNaviAnimation()&&this.originFloorId!==this.destFloorId&&this.mapTwoMaps.displayCaptureRouteSimulationScreen(this.naviAnimOption),this.setIsNaviAnimation(!1);return{crntFloor:i,nextFloor:n}}}},1475:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.MapSvgLoaderObjectGroup=void 0;const o=s(i(5232)),a=i(2676),l=i(9421);class c extends a.Group{constructor(t,e,i){super("svgLoaderMapObject"),this.children=[],this.store=i,this.objectGroup=new a.Group("svgLoaderObject"),this.textureManager=e,this.mapOptions=this.store.getMapOptions(),this.svgLoaderManager=t}init(){this.drawObjects(this.store.getAllSvgLoaderObjectData()),this.scale.set(1,-1,1),this.add(this.objectGroup)}initObject(t){var e,i;const n=(null===(e=this.mapOptions.svgFormatOptions)||void 0===e?void 0:e.depth)||50,r=new a.Group("item"),{path:s}=t,o=s.userData.style.fill;if((null===(i=this.mapOptions.svgFormatOptions)||void 0===i?void 0:i.drawFillShapes)&&void 0!==o&&"none"!==o){l.SVGLoader.createShapes(s).forEach((t=>{var e;const i=this.drawObjectFill(t,s,n);if(i&&r.add(i),null===(e=this.mapOptions.svgFormatOptions)||void 0===e?void 0:e.drawStrokes){const t=this.drawObjectStroke(s,n);t&&r.add(t)}}))}this.objectGroup.add(r)}drawObjects(t){t.forEach((t=>{this.initObject(t)}))}drawObjectFill(t,e,i){var n;if("transparent"===e.userData.style.fill)return null;const r=new o.ExtrudeGeometry(t,{depth:i,bevelEnabled:!1,bevelSize:0,bevelThickness:0,bevelOffset:0}),s=new o.MeshBasicMaterial({color:(new o.Color).setStyle(e.userData.style.fill),opacity:+(e.userData.style.fillOpacity||0),transparent:!1,side:o.DoubleSide,wireframe:null===(n=this.mapOptions.svgFormatOptions)||void 0===n?void 0:n.fillShapesWireframe});return new o.Mesh(r,s)}drawObjectStroke(t,e){const{strokeWidth:i,stroke:n}=t.userData.style;if(void 0!==n&&"none"!==n){const r=new o.Group;for(let s=0,a=t.subPaths.length;s<a;s++){const a=t.subPaths[s],c=new o.MeshBasicMaterial({color:new o.Color(n),opacity:+(t.userData.style.strokeOpacity||0),transparent:!1,side:o.DoubleSide,depthWrite:!0}),h=l.SVGLoader.pointsToStroke(a.getPoints(),t.userData.style);if(!h)return null;if(i>1){const i=[],n=null==h?void 0:h.getAttribute("position").array;for(let t=0;t<n.length;t+=3){const e=new o.Vector2(n[t],n[t+1]);i.push(e)}const s=i.filter(((t,e)=>Boolean(0===e||e===i.length-1||e%6==5||e%6==0))),a=this.createWallByPath({path:i,depth:e,style:t.userData.style}),l=this.createWallByPath({path:s,depth:e,style:t.userData.style});r.add(a),r.add(l)}else{const i=this.createWallByPath({path:a.getPoints(),depth:e,style:t.userData.style,weight:-.05}),n=this.createWallByPath({path:a.getPoints(),depth:e,style:t.userData.style,weight:.05}),s=this.createWallByPath({path:a.getPoints(),depth:e,style:t.userData.style,weight:-.7}),o=this.createWallByPath({path:a.getPoints(),depth:e,style:t.userData.style,weight:.7});r.add(i),r.add(n),r.add(s),r.add(o)}const u=new o.Mesh(h,c);u.translateZ(e+.1),r.add(u)}return r}return null}createWallByPath({depth:t=50,path:e=[],style:i,weight:n=0}){const{stroke:r}=i;let s=null;s=e.reduce(((e,[i,r,s])=>e.concat([[[i+n,r+n,0],[i+n,r+n,t]]])),[]);const a=s.reduce(((t,e,i)=>i===s.length-1?t:t.concat([[e,s[i+1]]])),[]).reduce(((t,e)=>{const[[i,n],[r,s]]=e;return t.concat(...n,...i,...s,...i,...r,...s)}),[]),l=new o.BufferGeometry,c=new Float32Array(a);l.setAttribute("position",new o.BufferAttribute(c,3));const h=new Array(a.length/3/6).fill(0).map(((t,e)=>a.slice(3*e*6,3*(e+1)*6))).map(((t,e)=>new Array(t.length/3).fill(0).map(((e,i)=>t.slice(3*i,3*(i+1))))));l.computeBoundingBox();const{min:u,max:d}=l.boundingBox,p=d.x-u.x,f=[...h.map((t=>{const e=t[0],i=t[5],n=new o.Vector3(...e).distanceTo(new o.Vector3(...i))/(p/10);return[0,1,0,0,n,1,0,0,n,0,n,1]}))];l.setAttribute("uv",new o.BufferAttribute(new Float32Array(f),2));const m=new o.MeshBasicMaterial({color:new o.Color(r),side:o.DoubleSide});return new o.Mesh(l,m)}}e.MapSvgLoaderObjectGroup=c},260:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.MapSvgLoaderPoiGroup=void 0;const o=i(6486),a=s(i(5232)),l=i(2676),c=i(4598),h=i(6250),u=i(2129),d=i(7709),p=i(6202);class f extends l.Group{constructor(t,e,i){super("svgLoaderMapPoi"),this.store=i,this.poiGroup=new u.PoiGroup,this.textureManager=e,this.mapOptions=this.store.getMapOptions(),this.svgLoaderManager=t}init(){var t;const e=(null===(t=this.mapOptions.svgFormatOptions)||void 0===t?void 0:t.depth)||0;this.poiGroup.position.z=e,this.drawPois(this.store.getAllSvgLoaderPoiData()),this.scale.set(1,-1,1),this.add(this.poiGroup)}initPoi(t){const e=new d.PoiItemGroup;if(t.transform){e.matrixAutoUpdate=!0;const i=new a.Matrix4;i.setFromMatrix3(t.transform),e.applyMatrix4(i)}const i=p.DabeeoUtils.getElementAttributes(t.poi);i["ds-x"]&&(e.position.x=+i["ds-x"]),i["ds-y"]&&(e.position.y=+i["ds-y"]),e.scale.y=-1,Object.assign(e.userData,(0,o.cloneDeep)(t)),t.image&&t.text?this.drawPoiIcon(t,e,this.drawPoiTitle(t,e)):t.image?this.drawPoiIcon(t,e,null):t.text&&e.add(this.drawPoiTitle(t,e)),this.poiGroup.add(e)}drawPois(t){t.forEach((t=>{this.initPoi(t)}))}async drawPoiIcon(t,e,i){this.mapOptions.spriteEnable,this.mapOptions.spriteEnable?new h.MapPoiSprite(this.store,this.textureManager).drawSvgLoaderPoiSpriteIcon(t,e,i):new c.MapPoiMesh(this.store).drawSvgLoaderPoiMeshIcon(t,e,i)}drawPoiTitle(t,e){var i,n,r;const s=(null===(n=null===(i=t.text)||void 0===i?void 0:i.getAttribute("text-anchor"))||void 0===n?void 0:n.toUpperCase())||"LEFT",{text:o}=t,a=this.createCanvasText(o,s);if(this.mapOptions.spriteEnable){return new h.MapPoiSprite(this.store,this.textureManager).drawSvgLoaderPoiSpriteTitle(t,e,a)}const l=new c.MapPoiMesh(this.store).drawSvgLoaderPoiMeshTitle(t,e,a),u=(null===(r=this.mapOptions.svgFormatOptions)||void 0===r?void 0:r.depth)||0;return this.poiGroup.position.z=u,l}createCanvasText(t,e){try{const i=window.devicePixelRatio||1,n=p.DabeeoUtils.getElementAttributes(t),r=+(n["font-size"]||10),s=+(n["line-spacing"]||0),o=document.createElement("canvas").getContext("2d"),a=p.DabeeoUtils.isMobile()?1:2,l=(t.textContent||"").split("\n").map((t=>t.trim())).filter((t=>""!==t.trim())),c=[n["font-weight"],`${r}px`,n["font-family"],"Noto Sans SC, Noto Sans JP, Noto Sans KR, sans-serif, 맑은 고딕, Apple SD Gothic Neo"].join(" ");o.font=c;let h=0;l.forEach((t=>{const{width:e}=this.measureText(t,c,r);h<e&&(h=e)})),h=0===h?1:h,o.canvas.width=h*i*1.2,o.canvas.height=(r*l.length+s*a/i*l.length)*a*1.2,o.setTransform(i,0,0,i,0,0);const u=(r+s)*a;return o.font=c,l.forEach(((t,i)=>{const l=this.measureText(t,c,r);let d=.5*h*1.2-.5*l.width;const p=u+r*a*i+s*a*i-r/2;"LEFT"===e?d=0:"RIGHT"===e&&(d=h-l.width),n.stroke&&(o.strokeStyle=n.stroke,o.lineJoin=n["stroke-linejoin"]||"bevel",o.lineWidth=+(n["stroke-width"]||0),o.strokeText(t,d,1.2*p)),o.fillStyle=n.fill||"black",o.fillText(t,d,1.2*p)})),{text:o,geoW:o.canvas.width/i,geoH:o.canvas.height/i}}catch(t){return this.store.getCanvasStacks().length,{text:null,geoW:0,geoH:0}}}measureText(t,e,i){const n=document.createElement("p");n.appendChild(document.createTextNode(t)),Object.assign(n.style,{display:"inline-block",margin:"0",padding:"0",border:"0",fontSize:i,whiteSpace:"pre",visibility:"hidden"}),n.style.setProperty("font",e,"important");const r=document.querySelector("body");r.appendChild(n);let{width:s,height:o}=n.getBoundingClientRect();return i<10&&(s=s*i/10,o=s*i/10),"remove"in n?n.remove():r.removeChild(n),s||(s=1),o||(o=1),{width:s,height:o}}}e.MapSvgLoaderPoiGroup=f},5289:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SvgLoaderManager=void 0;const n=i(9421);e.SvgLoaderManager=class{constructor(t,e,i){this.store=t,this.preprocessing=e,this.textureManager=i,this.svgMapOptionList=new Map,this.svgLoaderPoiDataList=new Map,this.svgLoaderObjectDataList=new Map}setSvgMapOption(t){this.svgMapOptionList.set(t.url,t)}getSvgMapOption(t){return this.svgMapOptionList.get(t||"default")}loadSvgData(t){return new Promise((e=>{(new n.SVGLoader).load(t.url,(t=>{const{paths:i,groups:n}=t;this.setSvgLoaderPoiData("default","default",n.pois),this.setSvgLoaderObjectData("default","default",n.objects),this.store.addToAllSvgLoaderPoiData(n.pois),this.store.addToAllSvgLoaderObjectData(n.objects),e(!0)}),(t=>{t.loaded,t.total}),(t=>{e(!1)}))}))}setSvgLoaderPoiData(t,e,i){const n=this.svgLoaderPoiDataList.get(t);n?n.set(e,i):this.svgLoaderPoiDataList.set(t,(new Map).set(e,i))}setSvgLoaderObjectData(t,e,i){const n=this.svgLoaderObjectDataList.get(t);n?n.set(e,i):this.svgLoaderObjectDataList.set(t,(new Map).set(e,i))}}},3700:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.MapItemTag=void 0;const o=s(i(5232)),a=i(1764);class l extends a.CSS2DObject{constructor(t,e,i,n){super(t),this.element=t,this.cameraController=i,this.store=e,this.preprocessing=n}Update(){const t=new o.Vector3(this.userData.position.x,this.userData.position.y,this.userData.position.z);t.project(this.cameraController.camera),this.changeVector(this.userData.pos,t),this.changeVectorDirection(t),this.position.set(t.x,t.y,t.z)}changeVector(t,e){switch(t){case"TOP":e.y+=.1;break;case"BOTTOM":e.y-=.1;break;case"LEFT":e.x-=.1;break;case"RIGHT":e.x+=.1;break;case"CENTER":break;default:console.error("위치값 오류")}}changeVectorDirection(t){t.unproject(this.cameraController.camera),this.preprocessing.worldCoordToLocalCoord(t)}cleanup(){this.remove()}}e.MapItemTag=l},3458:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MapTag=void 0;const n=i(1764);class r extends n.CSS2DObject{constructor(t,e){super(t),this.element=t,this.store=e}cleanup(){this.remove()}}e.MapTag=r},614:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0});const o=s(i(5232)),a=i(3458),l=i(2676),c=i(3700),h=i(6202);class u extends l.Group{constructor(t,e,i,n){super("css2dObject"),this.tagGroup=[],this.cameraContoller=t,this.store=e,this.container=i,this.preprocessing=n}findTag(t){const e=this.tagGroup.find((e=>e.id===t));return e||null}addTag(t){const e=h.DabeeoUtils.changeVectorMinus({x:t.position.x,y:t.position.y,z:t.position.z});return t.position=Object.assign({},e),this.makeTag(t)}addItemTag(t,e){if(t){const i=new o.Vector3;t.getWorldPosition(i);const n=Object.assign(Object.assign({},e),{position:i,floorId:t.userData.floorId}),r=this.makeItemTag(n),s=h.DabeeoUtils.changeVectorMinus({x:t.position.x,y:t.position.y,z:t.position.z});return Object.assign(Object.assign({},r),{position:s})}return null}drawDestinationTag(t){var e;this.tagGroup.forEach((t=>{t.isDestinationTag&&this.removeToParent(t.parentId)}));const i=null===(e=this.store.getCurPoiGroup())||void 0===e?void 0:e.children.find((e=>e.userData.id===t)),n={tag:this.getDestinationTagElement(t),parentId:t,pos:"TOP",type:"POI",isDestinationTag:!0};this.addItemTag(i,n)}removeTag(t){this.children.filter((e=>e.userData.id===t)).forEach((e=>{this.remove(e),this.tagGroup=this.tagGroup.filter((e=>e.id!==t))})),this.store.setRenderDirty(!0)}removeAllTag(){this.clear(),this.tagGroup=[]}removeToParent(t){const e=this.children.filter((e=>e.userData.parentId===t));e&&(e.forEach((e=>{this.tagGroup=this.tagGroup.filter((e=>e.parentId!==t)),this.remove(e)})),this.store.setRenderDirty(!0))}redraw(t){const e=this.tagGroup.filter((e=>e.floorId===t));e&&e.forEach((t=>{t.parentId?this.redrawItemTag(t):this.redrawTag(t)}))}shouldRedrawTag(t){let e=!0;return this.findTag(t)&&(e=!1),e}Update(){for(let t=0;t<this.children.length;t++)void 0!==this.children[t].Update&&this.children[t].Update()}cleanup(){this.children.length&&(this.children.forEach((t=>{t.cleanup()})),this.clear())}makeTag(t){const e=new a.MapTag(t.tag,this.store),i=Object.assign(Object.assign({},t),{position:{x:t.position.x,y:-t.position.y,z:t.position.z},id:e.uuid});return e.userData=Object.assign({},i),e.position.x=t.position.x,e.position.y=t.position.y,e.position.z=t.position.z,t.floorId===this.store.getDefaultFloorId()&&this.add(e),this.tagGroup.push(e.userData),this.store.setRenderDirty(!0),e.userData}makeItemTag(t){const e=new c.MapItemTag(t.tag,this.store,this.cameraContoller,this.preprocessing),i=Object.assign(Object.assign({},t),{id:e.uuid});return e.userData=Object.assign({},i),this.add(e),this.tagGroup.push(e.userData),this.store.setRenderDirty(!0),e.userData}getDestinationTagElement(t){var e,i;const n=null===(i=null===(e=this.store)||void 0===e?void 0:e.findPoiById(t))||void 0===i?void 0:i.userData,r=`\n          <div style='all:initial; text-align:center; '>\n              <div style='background-color:#0A0A0A; padding: 10px 14px; overflow:hidden; border-radius: 8px;' >\n                  <div style='display:table; margin:0; width:100%; text-align:center; font-size:16px; line-height:24px; font-weight:400;'>\n                      <img style='all:initial; display:table-cell; margin-right:8px; vertical-align:middle; width:24px; height:24px;' src='${null==n?void 0:n.iconUrl}'>\n                      <span style='all:initial; color:#ffffff; text-align: center; font-size: 16px; line-height: 24px; font-weight: 400;box-sizing: border-box; display:table-cell; vertical-align:middle;'>\n                          ${null==n?void 0:n.title}\n                      </span>\n                  </div>\n              </div>\n              <div style='width: auto !important; display: inline-block; border: 6px solid transparent; position: absolute; right: 50%; transform: translate(50%,0%); border-top-color:#0A0A0A;'></div>\n          </div>\n      `,s=document.createElement("div");return s.innerHTML=r.trim(),s}redrawTag(t){const e=new a.MapTag(t.tag,this.store);return e.userData=Object.assign({},t),e.position.x=t.position.x,e.position.y-=t.position.y,e.position.z=t.position.z,this.add(e),this.tagGroup.push(e.userData),this.store.setRenderDirty(!0),e.userData}redrawItemTag(t){const e=new c.MapItemTag(t.tag,this.store,this.cameraContoller,this.preprocessing);return e.userData=Object.assign({},t),this.add(e),this.tagGroup.push(e.userData),this.store.setRenderDirty(!0),e.userData}}e.default=u},7599:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TextureClass=void 0;e.TextureClass=class{constructor(t,e,i){this.url=t,this.mapId=e,this.tex=null,this.isCanvasTextrue=i}getMapId(){return this.mapId}setTextureClassTex(t){this.tex=t}setTextureClassPromise(t){this.promise=t}}},1722:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.TextureManager=void 0;const a=s(i(5232)),l=o(i(3086)),c=i(7599);e.TextureManager=class{constructor(t){this.defaultMapInfo=t,this.textureList=[],this.canvasStack=[]}async loadNewFloorTexture(t,e){const i=[];e.pois.forEach((t=>i.push(t.iconUrl)));const n=[...new Set(i)];await this.makeFloorTexture(n,t.getId(),!1);const r=[];t.getThemes().forEach((t=>{t.objectStyles.forEach((t=>{var e,i;(null===(e=t.sidePattern)||void 0===e?void 0:e.url)&&r.push(t.sidePattern.url),(null===(i=t.topPattern)||void 0===i?void 0:i.url)&&r.push(t.topPattern.url)})),t.sectionStyles.forEach((t=>{var e,i;(null===(e=t.sidePattern)||void 0===e?void 0:e.url)&&r.push(t.sidePattern.url),(null===(i=t.topPattern)||void 0===i?void 0:i.url)&&r.push(t.topPattern.url)}))}))}async loadTextureArray(t){const e=[];t.getFloors().forEach((t=>{t.pois.forEach((t=>{e.push(t.iconUrl)}))}));const i=[...new Set(e)];await this.makeTextures(i,t.getId(),!1);const n=[];t.getThemes().forEach((t=>{t.objectStyles.forEach((t=>{var e,i;(null===(e=t.sidePattern)||void 0===e?void 0:e.url)&&n.push(t.sidePattern.url),(null===(i=t.topPattern)||void 0===i?void 0:i.url)&&n.push(t.topPattern.url)})),t.sectionStyles.forEach((t=>{var e,i;(null===(e=t.sidePattern)||void 0===e?void 0:e.url)&&n.push(t.sidePattern.url),(null===(i=t.topPattern)||void 0===i?void 0:i.url)&&n.push(t.topPattern.url)}))}));const r=[...new Set(n)];return await this.makeTextures(r,t.getId(),!0),1}getTexture(t){return this.textureList.find((e=>e.url===t))||null}async asyncGetTexture(t){const e=this.textureList.find((e=>e.url===t));if(e)return e.promise;const i=new c.TextureClass(t,this.defaultMapInfo.getId());this.textureList.push(i);const n=new Promise((e=>{this.loadTexture(t).then((t=>{"boolean"!=typeof t&&(i.setTextureClassTex(t),e(i.tex)),e(null)}))}));return i.setTextureClassPromise(n),n}async asyncGetGifTexture(t){const e=this.textureList.find((e=>e.url===t));if(e)return e.promise;const i=new c.TextureClass(t,this.defaultMapInfo.getId(),!0);this.textureList.push(i);const n=new Promise((e=>{this.loadGifTexture(t).then((t=>{"boolean"!=typeof t&&(i.setTextureClassTex(t),e(i.tex)),e(null)}))}));return i.setTextureClassPromise(n),n}isGifTexture(t){var e;return"gif"===(null===(e=t.split(".").pop())||void 0===e?void 0:e.toLowerCase())}cleanup(){for(let t=0;t<this.canvasStack.length;t++)this.canvasStack[t].width=0,this.canvasStack[t].height=0,delete this.canvasStack[t];this.canvasStack.length=0,this.textureList.forEach((t=>{var e;null===(e=t.tex)||void 0===e||e.dispose(),t.tex=null})),this.textureList=[]}removeTextureByMapId(t){this.textureList=this.textureList.filter((e=>{var i;let n=!0;return e.getMapId()===t&&(null===(i=e.tex)||void 0===i||i.dispose(),e.tex=null,n=!1),n}))}async loadTexture(t){return new Promise((e=>{let i;const n=new a.LoadingManager((()=>{e(i)}),(()=>{}),(()=>{e(!1)})),r=new a.TextureLoader(n);i=r.load(t)}))}async loadCanvasTexture(t,e){return new Promise((i=>{let n;const r=new a.LoadingManager((()=>{i(n)}),(()=>{}),(()=>{i(!1)}));new a.ImageLoader(r).load(t,(t=>{const i=this.getCanvas(e);t.width=i.height,t.height=i.height;const r=i.getContext("2d");r&&(r.fillStyle="white",r.fillRect(0,0,i.width,i.height),r.drawImage(t,0,0,i.width,i.height),n=new a.CanvasTexture(i)),this.canvasStack.push(i)}))}))}async loadGifTexture(t){return new Promise((e=>{let i;const n=new l.default;i=n.load(t,(()=>{e(i)}),(()=>{}),(()=>{e(!1)}))}))}getCanvas(t){const e=document.createElement("canvas");return e.dataset.mapId=t,e.setAttribute("style","padding:10px;"),e.height=1024,e.width=1024,e.style.width="1024px",e.style.height="1024px;",e.style.border="2px solid #ff0000;",e}async makeTextures(t,e,i){"object"==typeof t&&await Promise.all(t.map((async t=>{try{if(i){const i=await this.loadCanvasTexture(t,e);if("boolean"!=typeof i){const n=new c.TextureClass(t,e,!0);n.setTextureClassTex(i),this.textureList.push(n)}}else{const i=await this.loadTexture(t);if("boolean"!=typeof i){const n=new c.TextureClass(t,e);n.setTextureClassTex(i),this.textureList.push(n)}}}catch(t){console.error(t)}})))}async makeFloorTexture(t,e,i){"object"==typeof t&&await Promise.all(t.map((async t=>{if(!this.textureList.find((e=>e.url===t)))try{if(i){const i=await this.loadCanvasTexture(t,e);if("boolean"!=typeof i){const n=new c.TextureClass(t,e,!0);n.setTextureClassTex(i),this.textureList.push(n)}}else{const i=await this.loadTexture(t);if("boolean"!=typeof i){const n=new c.TextureClass(t,e);n.setTextureClassTex(i),this.textureList.push(n)}}}catch(t){console.error(t)}})))}}},6202:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DabeeoUtils=void 0;e.DabeeoUtils=class{static getMidPoint(t){let e=0,i=0,n=0,r=0;return t.forEach((t=>{n+=t.x,r+=t.y})),e=n/t.length,i=r/t.length,{x:e,y:i,z:0}}static sortPointsClockWise(t){let e=0,i=0;t.forEach((t=>{e+=t.x,i+=t.y}));const n=e/t.length,r=i/t.length;return t.sort(((t,e)=>{const i=Math.atan2(t.y-r,t.x-n),s=Math.atan2(e.y-r,e.x-n);return i<s?-1:i>s?1:0}))}static getCentroid(t){const e=this.sortPointsClockWise(t);let i=0,n=0,r=0;for(let t=0;t<e.length;t++){const s=(t+1)%e.length,o=e[t],a=e[s],l=o.x,c=a.x,h=o.y,u=a.y;i+=l*u,i-=h*c,n+=(l+c)*(l*u-c*h),r+=(h+u)*(l*u-c*h)}return i/=2,i=Math.abs(i),n/=6*i,r/=6*i,{x:Math.abs(n),y:Math.abs(r),z:0}}static getDifference(t,e){return t.filter((t=>!e.includes(t)))}static isEmpty(t){return""===t||null==t}static isMobile(){return window.orientation>-1}static isMobileDevice(){let t=!1;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(t=!0),t}static easeIn(t,e,i){return{curVal:t+=i+=e,velocity:i}}static easeOut(t,e,i){return i&&(t+=(e-t)*i),t}static easeInQuad(t,e,i,n){return(i-e)*(t/=n)*t+e}static hexToRgb(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]:null}static getDistance(t,e){const i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i**2+n**2)}static degToRad(t){return t*Math.PI/180}static changeVectorMinus(t){return{x:t.x,y:-t.y,z:t.z}}static changeVector2Minus(t){return{x:t.x,y:-t.y}}static getElementAttributes(t){if(!t)return{};const e={};return t.getAttributeNames().forEach((i=>{e[`${i}`]=t.getAttribute(i)})),e}}},9935:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.controlDefaultOption=void 0;const n=i(6103);e.controlDefaultOption={controlRangeOption:{zoom:{min:1e-5,max:24},rotate:{min:-1/0,max:1/0},tilt:{min:0,max:80}},mouseOption:{enableZoom:!0,enableRotate:!0,enableTilt:!0,enablePan:!0,buttonOption:{left:n.MOUSE_BUTTON_OPTION.PAN,middle:n.MOUSE_BUTTON_OPTION.ZOOM,right:n.MOUSE_BUTTON_OPTION.ROTATE}},touchOption:{enableZoom:!0,enableRotate:!0,enableTilt:!0,enablePan:!0}}},6103:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MOUSE_BUTTON_OPTION=void 0,function(t){t.ZOOM="ZOOM",t.ROTATE="ROTATE",t.PAN="PAN"}(e.MOUSE_BUTTON_OPTION||(e.MOUSE_BUTTON_OPTION={}))},9570:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CAMERA_TYPE=e.LANG_TYPE=e.WATERMARK_TYPE=void 0,function(t){t.LEFT_TOP="LEFT_TOP",t.RIGHT_TOP="RIGHT_TOP",t.LEFT_BOTTOM="LEFT_BOTTOM",t.RIGHT_BOTTOM="RIGHT_BOTTOM"}(e.WATERMARK_TYPE||(e.WATERMARK_TYPE={})),function(t){t.KO="ko",t.EN="en",t.ZH_CN="zh-CN",t.JA="ja"}(e.LANG_TYPE||(e.LANG_TYPE={})),function(t){t.D3="3d",t.D2="2d"}(e.CAMERA_TYPE||(e.CAMERA_TYPE={}))},985:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SvgObject=void 0;e.SvgObject=class{constructor(t,e,i,n,r){this.sidePatternIdx=0,this.topPatternIdx=0,this.id=t.id,this.object=t,this.paths=e,this.volume=i,this.style=n,this.objectType=r}setMesh(t){this.mesh=t}getId(){return this.id}getObject(){return this.object}getPaths(){return this.paths}getVolume(){return this.volume}getStyle(){return this.style}getSidePatternIdx(){return this.sidePatternIdx}getTopPatternIdx(){return this.topPatternIdx}getMesh(){return this.mesh}getObjectType(){return this.objectType}getMapId(){return this.mapId}setMapId(t){this.mapId=t}updatePatternIdx(t,e){this.topPatternIdx=t,this.sidePatternIdx=e}}},1949:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FOCUS_TYPE=void 0,function(t){t.OBJECT="OBJECT",t.OBJECT_ALL="OBJECT_ALL",t.NAVIGATION="NAVIGATION",t.POI="POI",t.POI_ALL="POI_ALL"}(e.FOCUS_TYPE||(e.FOCUS_TYPE={}))},9377:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SOLID_LINE_CAP_TYPE=e.SOLID_LINE_JOIN_TYPE=void 0,function(t){t.ROUND="round",t.BEVEL="bevel",t.MITER="mitter"}(e.SOLID_LINE_JOIN_TYPE||(e.SOLID_LINE_JOIN_TYPE={})),function(t){t.ROUND="round",t.BUTT="butt"}(e.SOLID_LINE_CAP_TYPE||(e.SOLID_LINE_CAP_TYPE={}))},6731:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DIRECTION_TYPE=e.TRANSPORTATION_RESULT_TYPE=void 0,function(t){t.WALK="걷기",t.STAIRS="계단",t.ELEVATOR="엘리베이터",t.ESCALATOR_BOTH="에스컬레이터 양방향",t.ESCALATOR_UP="에스컬레이터 상행",t.ESCALAOR_DOWN="에스컬레이터 하행"}(e.TRANSPORTATION_RESULT_TYPE||(e.TRANSPORTATION_RESULT_TYPE={})),function(t){t.STRAIGHT="직진",t.LEFT="좌회전",t.RIGHT="우회전",t.UTURN="유턴",t.NONE=""}(e.DIRECTION_TYPE||(e.DIRECTION_TYPE={}))},6509:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TRANSPORTATION_REQUEST_TYPE=void 0,function(t){t.RECOMMENDATION="recommendation",t.STAIRS="stairs",t.EASCALATOR="escalator",t.ELEVATOR="elevator"}(e.TRANSPORTATION_REQUEST_TYPE||(e.TRANSPORTATION_REQUEST_TYPE={}))},9220:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CURRENT_STATE=void 0,function(t){t.OUT_OF_PATH="OUT_OF_PATH",t.ON_PATH="ON_PATH",t.ON_LAST_PATH="ON_LAST_PATH",t.WILL_ARRIVE="WILL_ARRIVE",t.ARRIVED="ARRIVED"}(e.CURRENT_STATE||(e.CURRENT_STATE={}))},4607:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LAST_LOCATION_TYPE=void 0,function(t){t.BEFORE_WAYPOINT="BEFORE_WAYPOINT",t.BEFORE_DESTINATION="BEFORE_DESTINATION",t.WAYPOINT="WAYPOINT",t.DESTINATION="DESTINATION"}(e.LAST_LOCATION_TYPE||(e.LAST_LOCATION_TYPE={}))},5925:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SERVER_TYPE=void 0,e.SERVER_TYPE={PRODUCTION:"SERVER_REAL",STAGE:"SERVER_STAGE",LOCAL:"SERVER_LOCAL"}},5514:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>q});const n=1,r=2,s=4,o=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768});function a(t){return t.isPerspectiveCamera}function l(t){return t.isOrthographicCamera}const c=2*Math.PI,h=Math.PI/2;function u(t,e=1e-5){return Math.abs(t)<e}function d(t,e,i=1e-5){return u(t-e,i)}function p(t){return isFinite(t)?t:t<0?-Number.MAX_VALUE:Number.MAX_VALUE}function f(t){return Math.abs(t)<Number.MAX_VALUE?t:t*(1/0)}function m(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function g(t,e){let i=function(t,e){const i=m(t)*m(e);if(0===i)return 0;let n=function(t,e){return t.x*e.x+t.y*e.y}(t,e)/i;return n>1&&(n=1),Math.acos(n)}(t,e);return function(t,e){return t.x*e.y-e.x*t.y}(t,e)>0&&(i*=-1),180*i/Math.PI}function v(t,e){e.set(0,0),t.forEach((t=>{e.x+=t.clientX,e.y+=t.clientY})),e.x/=t.length,e.y/=t.length}function y(t,e){return!!l(t)}function _(t){return t.invert?t.invert():t.inverse(),t}const x="undefined"!=typeof window,M=x&&/Mac/.test(navigator.platform),b=!(x&&"PointerEvent"in window),w=1/8;let S,T,A,E,C,O,P,I,D,L,R,B,N,F,U,G,z,k,j,H,V,W;class q extends class{constructor(){this._listeners={}}addEventListener(t,e){const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}removeEventListener(t,e){const i=this._listeners[t];if(void 0!==i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}removeAllEventListeners(t){t?Array.isArray(this._listeners[t])&&(this._listeners[t].length=0):this._listeners={}}dispatchEvent(t){const e=this._listeners[t.type];if(void 0!==e){t.target=this;const i=e.slice(0);for(let e=0,n=i.length;e<n;e++)i[e].call(this,t)}}}{static install(t){S=t.THREE,T=Object.freeze(new S.Vector3(0,0,0)),A=Object.freeze(new S.Vector3(0,1,0)),E=Object.freeze(new S.Vector3(0,0,1)),C=new S.Vector2,O=new S.Vector3,P=new S.Vector3,I=new S.Vector3,D=new S.Vector3,L=new S.Vector3,R=new S.Vector3,B=new S.Vector3,N=new S.Vector3,F=new S.Spherical,U=new S.Spherical,G=new S.Box3,z=new S.Box3,k=new S.Sphere,j=new S.Quaternion,H=new S.Quaternion,V=new S.Matrix4,W=new S.Raycaster}static get ACTION(){return o}constructor(t,e){if(super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=0,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.dampingFactor=.05,this.draggingDampingFactor=.25,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=o.NONE,this._viewport=null,this._dollyControlAmount=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._activePointers=[],this._truckInternal=(t,e,i)=>{if(a(this._camera)){const n=O.copy(this._camera.position).sub(this._target),r=this._camera.getEffectiveFOV()*S.MathUtils.DEG2RAD,s=n.length()*Math.tan(.5*r),o=this.truckSpeed*t*s/this._elementRect.height,a=this.truckSpeed*e*s/this._elementRect.height;this.verticalDragToForward?(i?this.setFocalOffset(this._focalOffsetEnd.x+o,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(o,0,!0),this.forward(-a,!0)):i?this.setFocalOffset(this._focalOffsetEnd.x+o,this._focalOffsetEnd.y+a,this._focalOffsetEnd.z,!0):this.truck(o,a,!0)}else if(l(this._camera)){const n=this._camera,r=t*(n.right-n.left)/n.zoom/this._elementRect.width,s=e*(n.top-n.bottom)/n.zoom/this._elementRect.height;i?this.setFocalOffset(this._focalOffsetEnd.x+r,this._focalOffsetEnd.y+s,this._focalOffsetEnd.z,!0):this.truck(r,s,!0)}},this._rotateInternal=(t,e)=>{const i=c*this.azimuthRotateSpeed*t/this._elementRect.height,n=c*this.polarRotateSpeed*e/this._elementRect.height;this.rotate(i,n,!0)},this._rotateAngle=(t,e)=>{const i=t*S.MathUtils.DEG2RAD,n=c*this.polarRotateSpeed*e/this._elementRect.height;this.rotate(i,n,!0)},this._dollyInternal=(t,e,i)=>{const n=Math.pow(.95,-t*this.dollySpeed),r=this._sphericalEnd.radius*n,s=this._sphericalEnd.radius,o=s*(t>=0?-1:1);this.dollyTo(r),this.infinityDolly&&(r<this.minDistance||this.maxDistance===this.minDistance)&&(this._camera.getWorldDirection(O),this._targetEnd.add(O.normalize().multiplyScalar(o)),this._target.add(O.normalize().multiplyScalar(o))),this.dollyToCursor&&(this._dollyControlAmount+=this._sphericalEnd.radius-s,this.infinityDolly&&(r<this.minDistance||this.maxDistance===this.minDistance)&&(this._dollyControlAmount-=o),this._dollyControlCoord.set(e,i))},this._zoomInternal=(t,e,i)=>{const n=Math.pow(.95,t*this.dollySpeed);this.zoomTo(this._zoom*n),this.dollyToCursor&&(this._dollyControlAmount=this._zoomEnd,this._dollyControlCoord.set(e,i))},void 0===S&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=t,this._yAxisUpSpace=(new S.Quaternion).setFromUnitVectors(this._camera.up,A),this._yAxisUpSpaceInverse=_(this._yAxisUpSpace.clone()),this._state=o.NONE,this._domElement=e,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._target=new S.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new S.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=(new S.Spherical).setFromVector3(O.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._nearPlaneCorners=[new S.Vector3,new S.Vector3,new S.Vector3,new S.Vector3],this._updateNearPlaneCorners(),this._boundary=new S.Box3(new S.Vector3(-1/0,-1/0,-1/0),new S.Vector3(1/0,1/0,1/0)),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlAmount=0,this._dollyControlCoord=new S.Vector2,this.mouseButtons={left:o.ROTATE,middle:o.DOLLY,right:o.TRUCK,wheel:a(this._camera)?o.DOLLY:l(this._camera)?o.ZOOM:o.NONE},this.touches={one:o.TOUCH_ROTATE,two:a(this._camera)?o.TOUCH_DOLLY_TRUCK:l(this._camera)?o.TOUCH_ZOOM_TRUCK:o.NONE,three:o.TOUCH_TRUCK},this._domElement){const t=new S.Vector2,e=new S.Vector2,i=new S.Vector2,a=new S.Vector2,l=new S.Vector2,c=t=>{if(!this._enabled)return;const e={pointerId:t.pointerId,clientX:t.clientX,clientY:t.clientY,deltaX:0,deltaY:0};this._activePointers.push(e),this._domElement.ownerDocument.removeEventListener("pointermove",d,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",m),this._domElement.ownerDocument.addEventListener("pointermove",d,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",m),E(t)},h=t=>{if(!this._enabled)return;const e={pointerId:0,clientX:t.clientX,clientY:t.clientY,deltaX:0,deltaY:0};this._activePointers.push(e),this._domElement.ownerDocument.removeEventListener("mousemove",p),this._domElement.ownerDocument.removeEventListener("mouseup",y),this._domElement.ownerDocument.addEventListener("mousemove",p),this._domElement.ownerDocument.addEventListener("mouseup",y),E(t)},u=t=>{this._enabled&&(t.preventDefault(),Array.prototype.forEach.call(t.changedTouches,(t=>{const e={pointerId:t.identifier,clientX:t.clientX,clientY:t.clientY,deltaX:0,deltaY:0};this._activePointers.push(e)})),this._domElement.ownerDocument.removeEventListener("touchmove",f,{passive:!1}),this._domElement.ownerDocument.removeEventListener("touchend",_),this._domElement.ownerDocument.addEventListener("touchmove",f,{passive:!1}),this._domElement.ownerDocument.addEventListener("touchend",_),E(t))},d=t=>{t.cancelable&&t.preventDefault();const e=t.pointerId,i=this._findPointerById(e);if(i){if(i.clientX=t.clientX,i.clientY=t.clientY,i.deltaX=t.movementX,i.deltaY=t.movementY,"touch"===t.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._state=0,(t.buttons&n)===n&&(this._state=this._state|this.mouseButtons.left),(t.buttons&s)===s&&(this._state=this._state|this.mouseButtons.middle),(t.buttons&r)===r&&(this._state=this._state|this.mouseButtons.right);O()}},p=t=>{const e=this._findPointerById(0);e&&(e.clientX=t.clientX,e.clientY=t.clientY,e.deltaX=t.movementX,e.deltaY=t.movementY,this._state=0,(t.buttons&n)===n&&(this._state=this._state|this.mouseButtons.left),(t.buttons&s)===s&&(this._state=this._state|this.mouseButtons.middle),(t.buttons&r)===r&&(this._state=this._state|this.mouseButtons.right),O())},f=t=>{t.cancelable&&t.preventDefault(),Array.prototype.forEach.call(t.changedTouches,(t=>{const e=t.identifier,i=this._findPointerById(e);i&&(i.clientX=t.clientX,i.clientY=t.clientY)})),O()},m=t=>{const e=t.pointerId,i=this._findPointerById(e);if(i&&this._activePointers.splice(this._activePointers.indexOf(i),1),"touch"===t.pointerType)switch(this._activePointers.length){case 0:this._state=o.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._state=o.NONE;P()},y=()=>{const t=this._findPointerById(0);t&&this._activePointers.splice(this._activePointers.indexOf(t),1),this._state=o.NONE,P()},_=t=>{switch(Array.prototype.forEach.call(t.changedTouches,(t=>{const e=t.identifier,i=this._findPointerById(e);i&&this._activePointers.splice(this._activePointers.indexOf(i),1)})),this._activePointers.length){case 0:this._state=o.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}P()};let x=-1;const T=t=>{if(!this._enabled||this.mouseButtons.wheel===o.NONE)return;if(t.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===o.ROTATE||this.mouseButtons.wheel===o.TRUCK){const t=performance.now();x-t<1e3&&this._getClientRect(this._elementRect),x=t}const e=M?-1:-3,i=1===t.deltaMode?t.deltaY/e:t.deltaY/(10*e),n=this.dollyToCursor?(t.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,r=this.dollyToCursor?(t.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case o.ROTATE:this._rotateInternal(t.deltaX,t.deltaY);break;case o.TRUCK:this._truckInternal(t.deltaX,t.deltaY,!1);break;case o.OFFSET:this._truckInternal(t.deltaX,t.deltaY,!0);break;case o.DOLLY:this._dollyInternal(-i,n,r);break;case o.ZOOM:this._zoomInternal(-i,n,r)}this.dispatchEvent({type:"control"})},A=t=>{this._enabled&&t.preventDefault()},E=o=>{if(!this._enabled)return;v(this._activePointers,C),this._getClientRect(this._elementRect),t.copy(C),e.copy(C);if(this._activePointers.length>=2){const t=C.x-this._activePointers[1].clientX,n=C.y-this._activePointers[1].clientY,r=Math.sqrt(t*t+n*n);i.set(0,r);const s=.5*(this._activePointers[0].clientX+this._activePointers[1].clientX),o=.5*(this._activePointers[0].clientY+this._activePointers[1].clientY);e.set(s,o);const c=this._activePointers[0].clientX-this._activePointers[1].clientX,h=this._activePointers[0].clientY-this._activePointers[1].clientY;a.set(c,h),l.copy(a)}if("touches"in o||"pointerType"in o&&"touch"===o.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._state=0,(o.buttons&n)===n&&(this._state=this._state|this.mouseButtons.left),(o.buttons&s)===s&&(this._state=this._state|this.mouseButtons.middle),(o.buttons&r)===r&&(this._state=this._state|this.mouseButtons.right);this.dispatchEvent({type:"controlstart"})},O=()=>{if(!this._enabled)return;v(this._activePointers,C);const n=this._domElement&&document.pointerLockElement===this._domElement,r=n?-this._activePointers[0].deltaX:e.x-C.x,s=n?-this._activePointers[0].deltaY:e.y-C.y;if(e.copy(C),(this._state&o.ROTATE)===o.ROTATE&&this._rotateInternal(r,s),(this._state&o.TOUCH_DOLLY_ROTATE)===o.TOUCH_DOLLY_ROTATE||(this._state&o.TOUCH_ZOOM_ROTATE)===o.TOUCH_ZOOM_ROTATE||(this._state&o.TOUCH_ROTATE)===o.TOUCH_ROTATE){const t=this._activePointers[0].clientX-this._activePointers[1].clientX,e=this._activePointers[0].clientY-this._activePointers[1].clientY;a.set(t,e);const i=g(a,l);this._rotateAngle(i,s),l.copy(a)}if((this._state&o.DOLLY)===o.DOLLY||(this._state&o.ZOOM)===o.ZOOM){const e=this.dollyToCursor?(t.x-this._elementRect.x)/this._elementRect.width*2-1:0,i=this.dollyToCursor?(t.y-this._elementRect.y)/this._elementRect.height*-2+1:0;this._state===o.DOLLY?this._dollyInternal(s*w,e,i):this._zoomInternal(s*w,e,i)}if((this._state&o.TOUCH_DOLLY)===o.TOUCH_DOLLY||(this._state&o.TOUCH_ZOOM)===o.TOUCH_ZOOM||(this._state&o.TOUCH_DOLLY_TRUCK)===o.TOUCH_DOLLY_TRUCK||(this._state&o.TOUCH_ZOOM_TRUCK)===o.TOUCH_ZOOM_TRUCK||(this._state&o.TOUCH_DOLLY_OFFSET)===o.TOUCH_DOLLY_OFFSET||(this._state&o.TOUCH_ZOOM_OFFSET)===o.TOUCH_ZOOM_OFFSET||(this._state&o.TOUCH_DOLLY_ROTATE)===o.TOUCH_DOLLY_ROTATE||(this._state&o.TOUCH_ZOOM_ROTATE)===o.TOUCH_ZOOM_ROTATE){const t=C.x-this._activePointers[1].clientX,n=C.y-this._activePointers[1].clientY,r=Math.sqrt(t*t+n*n),s=i.y-r;i.set(0,r);const a=this.dollyToCursor?(e.x-this._elementRect.x)/this._elementRect.width*2-1:0,l=this.dollyToCursor?(e.y-this._elementRect.y)/this._elementRect.height*-2+1:0;this._state===o.TOUCH_DOLLY||this._state===o.TOUCH_DOLLY_ROTATE||this._state===o.TOUCH_DOLLY_TRUCK||this._state===o.TOUCH_DOLLY_OFFSET?this._dollyInternal(s*w,a,l):this._zoomInternal(s*w,a,l)}(this._state&o.TRUCK)!==o.TRUCK&&(this._state&o.TOUCH_TRUCK)!==o.TOUCH_TRUCK&&(this._state&o.TOUCH_DOLLY_TRUCK)!==o.TOUCH_DOLLY_TRUCK&&(this._state&o.TOUCH_ZOOM_TRUCK)!==o.TOUCH_ZOOM_TRUCK||this._truckInternal(r,s,!1),(this._state&o.OFFSET)!==o.OFFSET&&(this._state&o.TOUCH_OFFSET)!==o.TOUCH_OFFSET&&(this._state&o.TOUCH_DOLLY_OFFSET)!==o.TOUCH_DOLLY_OFFSET&&(this._state&o.TOUCH_ZOOM_OFFSET)!==o.TOUCH_ZOOM_OFFSET||this._truckInternal(r,s,!0),this.dispatchEvent({type:"control"})},P=()=>{v(this._activePointers,C),e.copy(C),0===this._activePointers.length&&(this._domElement.ownerDocument.removeEventListener("pointermove",d,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",m),this._domElement.ownerDocument.removeEventListener("touchmove",f,{passive:!1}),this._domElement.ownerDocument.removeEventListener("touchend",_),this.dispatchEvent({type:"controlend"}))};this._domElement.addEventListener("pointerdown",c),b&&this._domElement.addEventListener("mousedown",h),b&&this._domElement.addEventListener("touchstart",u),this._domElement.addEventListener("pointercancel",m),this._domElement.addEventListener("wheel",T,{passive:!1}),this._domElement.addEventListener("contextmenu",A),this._removeAllEventListeners=()=>{this._domElement.removeEventListener("pointerdown",c),this._domElement.removeEventListener("mousedown",h),this._domElement.removeEventListener("touchstart",u),this._domElement.removeEventListener("pointercancel",m),this._domElement.removeEventListener("wheel",T,{passive:!1}),this._domElement.removeEventListener("contextmenu",A),this._domElement.ownerDocument.removeEventListener("pointermove",d,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",p),this._domElement.ownerDocument.removeEventListener("touchmove",f,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",m),this._domElement.ownerDocument.removeEventListener("mouseup",y),this._domElement.ownerDocument.removeEventListener("touchend",_)},this.cancel=()=>{this._state!==o.NONE&&(this._state=o.NONE,this._activePointers.length=0,P())}}this.update(0)}get camera(){return this._camera}set camera(t){this._camera=t,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(t){this._enabled=t,t?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="")}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(t){this._spherical.radius===t&&this._sphericalEnd.radius===t||(this._spherical.radius=t,this._sphericalEnd.radius=t,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(t){this._spherical.theta===t&&this._sphericalEnd.theta===t||(this._spherical.theta=t,this._sphericalEnd.theta=t,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(t){this._spherical.phi===t&&this._sphericalEnd.phi===t||(this._spherical.phi=t,this._sphericalEnd.phi=t,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(t){this._boundaryEnclosesCamera=t,this._needsUpdate=!0}addEventListener(t,e){super.addEventListener(t,e)}removeEventListener(t,e){super.removeEventListener(t,e)}rotate(t,e,i=!1){return this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+e,i)}rotateAzimuthTo(t,e=!1){return this.rotateTo(t,this._sphericalEnd.phi,e)}rotatePolarTo(t,e=!1){return this.rotateTo(this._sphericalEnd.theta,t,e)}rotateTo(t,e,i=!1){const n=S.MathUtils.clamp(t,this.minAzimuthAngle,this.maxAzimuthAngle),r=S.MathUtils.clamp(e,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=n,this._sphericalEnd.phi=r,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,i||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const s=!i||d(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&d(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(s)}dolly(t,e=!1){return this.dollyTo(this._sphericalEnd.radius-t,e)}dollyTo(t,e=!1){const i=this._sphericalEnd.radius,n=S.MathUtils.clamp(t,this.minDistance,this.maxDistance);if(this.colliderMeshes.length>=1){const t=this._collisionTest(),e=d(t,this._spherical.radius);if(!(i>n)&&e)return Promise.resolve();this._sphericalEnd.radius=Math.min(n,t)}else this._sphericalEnd.radius=n;this._needsUpdate=!0,e||(this._spherical.radius=this._sphericalEnd.radius);const r=!e||d(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(r)}zoom(t,e=!1){return this.zoomTo(this._zoomEnd+t,e)}zoomTo(t,e=!1){this._zoomEnd=S.MathUtils.clamp(t,this.minZoom,this.maxZoom),this._needsUpdate=!0,e||(this._zoom=this._zoomEnd);const i=!e||d(this._zoom,this._zoomEnd,this.restThreshold);return this._createOnRestPromise(i)}pan(t,e,i=!1){return this.truck(t,e,i)}truck(t,e,i=!1){this._camera.updateMatrix(),D.setFromMatrixColumn(this._camera.matrix,0),L.setFromMatrixColumn(this._camera.matrix,1),D.multiplyScalar(t),L.multiplyScalar(-e);const n=O.copy(D).add(L),r=P.copy(this._targetEnd).add(n);return this.moveTo(r.x,r.y,r.z,i)}forward(t,e=!1){O.setFromMatrixColumn(this._camera.matrix,0),O.crossVectors(this._camera.up,O),O.multiplyScalar(t);const i=P.copy(this._targetEnd).add(O);return this.moveTo(i.x,i.y,i.z,e)}moveTo(t,e,i,n=!1){const r=O.set(t,e,i).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,r,this.boundaryFriction),this._needsUpdate=!0,n||this._target.copy(this._targetEnd);const s=!n||d(this._target.x,this._targetEnd.x,this.restThreshold)&&d(this._target.y,this._targetEnd.y,this.restThreshold)&&d(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}fitToBox(t,e,{cover:i=!1,paddingLeft:n=0,paddingRight:r=0,paddingBottom:s=0,paddingTop:o=0}={}){const c=[],u=t.isBox3?G.copy(t):G.setFromObject(t);u.isEmpty()&&Promise.resolve();const p=(f=this._sphericalEnd.theta,m=h,Math.round(f/m)*m);var f,m;const g=O.setFromSpherical(this._sphericalEnd).normalize(),v=j.setFromUnitVectors(g,E),y=d(Math.abs(g.y),1);y&&v.multiply(H.setFromAxisAngle(A,p)),v.multiply(this._yAxisUpSpaceInverse);const _=z.makeEmpty();P.copy(u.min).applyQuaternion(v),_.expandByPoint(P),P.copy(u.min).setX(u.max.x).applyQuaternion(v),_.expandByPoint(P),P.copy(u.min).setY(u.max.y).applyQuaternion(v),_.expandByPoint(P),P.copy(u.max).setZ(u.min.z).applyQuaternion(v),_.expandByPoint(P),P.copy(u.min).setZ(u.max.z).applyQuaternion(v),_.expandByPoint(P),P.copy(u.max).setY(u.min.y).applyQuaternion(v),_.expandByPoint(P),P.copy(u.max).setX(u.min.x).applyQuaternion(v),_.expandByPoint(P),P.copy(u.max).applyQuaternion(v),_.expandByPoint(P),_.min.x-=n,_.min.y-=s,_.max.x+=r,_.max.y+=o,v.setFromUnitVectors(E,g),y&&v.premultiply(H.invert()),v.premultiply(this._yAxisUpSpace);const x=_.getSize(O),M=_.getCenter(P).applyQuaternion(v);if(a(this._camera)){const t=this.getDistanceToFitBox(x.x,x.y,x.z,i);c.push(this.moveTo(M.x,M.y,M.z,e)),c.push(this.dollyTo(t,e))}else if(l(this._camera)){const t=this._camera,n=t.right-t.left,r=t.top-t.bottom,s=i?Math.max(n/x.x,r/x.y):Math.min(n/x.x,r/x.y);c.push(this.moveTo(M.x,M.y,M.z,e)),c.push(this.zoomTo(s,e))}return Promise.all(c)}fitToSphere(t,e){const i=[],n=t instanceof S.Sphere?k.copy(t):function(t,e){const i=e,n=i.center;G.makeEmpty(),t.traverseVisible((t=>{t.isMesh&&G.expandByObject(t)})),G.getCenter(n);let r=0;return t.traverseVisible((t=>{if(!t.isMesh)return;const e=t,i=e.geometry.clone();if(i.applyMatrix4(e.matrixWorld),i.isBufferGeometry){const t=i.attributes.position;for(let e=0,i=t.count;e<i;e++)O.fromBufferAttribute(t,e),r=Math.max(r,n.distanceToSquared(O))}else{const t=i.attributes.position,e=new S.Vector3;for(let i=0,s=t.count;i<s;i++)e.fromBufferAttribute(t,i),r=Math.max(r,n.distanceToSquared(e))}})),i.radius=Math.sqrt(r),i}(t,k);if(i.push(this.moveTo(n.center.x,n.center.y,n.center.z,e)),a(this._camera)){const t=this.getDistanceToFitSphere(n.radius);i.push(this.dollyTo(t,e))}else if(l(this._camera)){const t=this._camera.right-this._camera.left,r=this._camera.top-this._camera.bottom,s=2*n.radius,o=Math.min(t/s,r/s);i.push(this.zoomTo(o,e))}return i.push(this.setFocalOffset(0,0,0,e)),Promise.all(i)}setLookAt(t,e,i,n,r,s,o=!1){const a=P.set(n,r,s),l=O.set(t,e,i);this._targetEnd.copy(a),this._sphericalEnd.setFromVector3(l.sub(a).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,o||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const c=!o||d(this._target.x,this._targetEnd.x,this.restThreshold)&&d(this._target.y,this._targetEnd.y,this.restThreshold)&&d(this._target.z,this._targetEnd.z,this.restThreshold)&&d(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&d(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&d(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(c)}lerpLookAt(t,e,i,n,r,s,o,a,l,c,h,u,p,f=!1){const m=O.set(n,r,s),g=P.set(t,e,i);F.setFromVector3(g.sub(m).applyQuaternion(this._yAxisUpSpace));const v=I.set(c,h,u),y=P.set(o,a,l);U.setFromVector3(y.sub(v).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(m.lerp(v,p));const _=U.theta-F.theta,x=U.phi-F.phi,M=U.radius-F.radius;this._sphericalEnd.set(F.radius+M*p,F.phi+x*p,F.theta+_*p),this.normalizeRotations(),this._needsUpdate=!0,f||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const b=!f||d(this._target.x,this._targetEnd.x,this.restThreshold)&&d(this._target.y,this._targetEnd.y,this.restThreshold)&&d(this._target.z,this._targetEnd.z,this.restThreshold)&&d(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&d(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&d(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(b)}setPosition(t,e,i,n=!1){return this.setLookAt(t,e,i,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,n)}setTarget(t,e,i,n=!1){const r=this.getPosition(O);return this.setLookAt(r.x,r.y,r.z,t,e,i,n)}setFocalOffset(t,e,i,n=!1){this._focalOffsetEnd.set(t,e,i),this._needsUpdate=!0,n||this._focalOffset.copy(this._focalOffsetEnd);const r=!n||d(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&d(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&d(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}setOrbitPoint(t,e,i){D.setFromMatrixColumn(this._camera.matrixWorldInverse,0),L.setFromMatrixColumn(this._camera.matrixWorldInverse,1),R.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const n=O.set(t,e,i),r=n.distanceTo(this._camera.position),s=n.sub(this._camera.position);D.multiplyScalar(s.x),L.multiplyScalar(s.y),R.multiplyScalar(s.z),O.copy(D).add(L).add(R),O.z=O.z+r,this.dollyTo(r,!1),this.setFocalOffset(-O.x,O.y,-O.z,!1),this.moveTo(t,e,i,!1)}setBoundary(t){if(!t)return this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),void(this._needsUpdate=!0);this._boundary.copy(t),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(t,e,i,n){null!==t?(this._viewport=this._viewport||new S.Vector4,"number"==typeof t?this._viewport.set(t,e,i,n):this._viewport.copy(t)):this._viewport=null}getDistanceToFitBox(t,e,i,n=!1){if(y(this._camera))return this._spherical.radius;const r=t/e,s=this._camera.getEffectiveFOV()*S.MathUtils.DEG2RAD,o=this._camera.aspect;return.5*((n?r>o:r<o)?e:t/o)/Math.tan(.5*s)+.5*i}getDistanceToFitSphere(t){if(y(this._camera))return this._spherical.radius;const e=this._camera.getEffectiveFOV()*S.MathUtils.DEG2RAD,i=2*Math.atan(Math.tan(.5*e)*this._camera.aspect),n=1<this._camera.aspect?e:i;return t/Math.sin(.5*n)}getTarget(t){return(t&&t.isVector3?t:new S.Vector3).copy(this._targetEnd)}getPosition(t){return(t&&t.isVector3?t:new S.Vector3).setFromSpherical(this._sphericalEnd).applyQuaternion(this._yAxisUpSpaceInverse).add(this._targetEnd)}getFocalOffset(t){return(t&&t.isVector3?t:new S.Vector3).copy(this._focalOffsetEnd)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%c,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=c),this._spherical.theta+=c*Math.round((this._sphericalEnd.theta-this._spherical.theta)/c)}reset(t=!1){const e=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,t),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,t),this.zoomTo(this._zoom0,t)];return Promise.all(e)}saveState(){this._target0.copy(this._target),this._position0.copy(this._camera.position),this._zoom0=this._zoom}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,A),_(this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace))}update(t){const e=this._state===o.NONE?this.dampingFactor:this.draggingDampingFactor,i=Math.min(e*t*60,1),n=this._sphericalEnd.theta-this._spherical.theta,r=this._sphericalEnd.phi-this._spherical.phi,s=this._sphericalEnd.radius-this._spherical.radius,c=B.subVectors(this._targetEnd,this._target),h=N.subVectors(this._focalOffsetEnd,this._focalOffset);if(u(n)&&u(r)&&u(s)&&u(c.x)&&u(c.y)&&u(c.z)&&u(h.x)&&u(h.y)&&u(h.z)?(this._spherical.copy(this._sphericalEnd),this._target.copy(this._targetEnd),this._focalOffset.copy(this._focalOffsetEnd)):(this._spherical.set(this._spherical.radius+s*i,this._spherical.phi+r*i,this._spherical.theta+n*i),this._target.add(c.multiplyScalar(i)),this._focalOffset.add(h.multiplyScalar(i)),this._needsUpdate=!0),0!==this._dollyControlAmount){if(a(this._camera)){const t=this._camera,e=O.setFromSpherical(this._sphericalEnd).applyQuaternion(this._yAxisUpSpaceInverse).normalize().negate(),i=P.copy(e).cross(t.up).normalize();0===i.lengthSq()&&(i.x=1);const n=I.crossVectors(i,e),r=this._sphericalEnd.radius*Math.tan(t.getEffectiveFOV()*S.MathUtils.DEG2RAD*.5),s=(this._sphericalEnd.radius-this._dollyControlAmount-this._sphericalEnd.radius)/this._sphericalEnd.radius,o=O.copy(this._targetEnd).add(i.multiplyScalar(this._dollyControlCoord.x*r*t.aspect)).add(n.multiplyScalar(this._dollyControlCoord.y*r));this._targetEnd.lerp(o,s),this._target.copy(this._targetEnd),this._boundary.clampPoint(this._targetEnd,this._targetEnd)}else if(l(this._camera)){const t=this._camera,e=O.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(t.near+t.far)/(t.near-t.far)).unproject(t),i=P.set(0,0,-1).applyQuaternion(t.quaternion),n=i.dot(t.up),r=u(n)?-e.dot(t.up):-e.dot(t.up)/n,s=I.copy(e).add(i.multiplyScalar(r));this._targetEnd.lerp(s,1-t.zoom/this._dollyControlAmount),this._target.copy(this._targetEnd),this._boundary.clampPoint(this._targetEnd,this._targetEnd)}this._dollyControlAmount=0}const d=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,d),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target);(!u(this._focalOffset.x)||!u(this._focalOffset.y)||!u(this._focalOffset.z))&&(this._camera.updateMatrix(),D.setFromMatrixColumn(this._camera.matrix,0),L.setFromMatrixColumn(this._camera.matrix,1),R.setFromMatrixColumn(this._camera.matrix,2),D.multiplyScalar(this._focalOffset.x),L.multiplyScalar(-this._focalOffset.y),R.multiplyScalar(this._focalOffset.z),O.copy(D).add(L).add(R),this._camera.position.add(O)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),O.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const p=this._zoomEnd-this._zoom;this._zoom+=p*i,this._camera.zoom!==this._zoom&&(u(p)&&(this._zoom=this._zoomEnd),this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0);const f=this._needsUpdate;return f&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):f?(this.dispatchEvent({type:"update"}),u(n,this.restThreshold)&&u(r,this.restThreshold)&&u(s,this.restThreshold)&&u(c.x,this.restThreshold)&&u(c.y,this.restThreshold)&&u(c.z,this.restThreshold)&&u(h.x,this.restThreshold)&&u(h.y,this.restThreshold)&&u(h.z,this.restThreshold)&&u(p,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!f&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._updatedLastTime=f,this._needsUpdate=!1,f}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:p(this.maxDistance),minZoom:this.minZoom,maxZoom:p(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:p(this.maxPolarAngle),minAzimuthAngle:p(this.minAzimuthAngle),maxAzimuthAngle:p(this.maxAzimuthAngle),dampingFactor:this.dampingFactor,draggingDampingFactor:this.draggingDampingFactor,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:O.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(t,e=!1){const i=JSON.parse(t),n=O.fromArray(i.position);this.enabled=i.enabled,this.minDistance=i.minDistance,this.maxDistance=f(i.maxDistance),this.minZoom=i.minZoom,this.maxZoom=f(i.maxZoom),this.minPolarAngle=i.minPolarAngle,this.maxPolarAngle=f(i.maxPolarAngle),this.minAzimuthAngle=f(i.minAzimuthAngle),this.maxAzimuthAngle=f(i.maxAzimuthAngle),this.dampingFactor=i.dampingFactor,this.draggingDampingFactor=i.draggingDampingFactor,this.dollySpeed=i.dollySpeed,this.truckSpeed=i.truckSpeed,this.dollyToCursor=i.dollyToCursor,this.verticalDragToForward=i.verticalDragToForward,this._target0.fromArray(i.target0),this._position0.fromArray(i.position0),this._zoom0=i.zoom0,this._focalOffset0.fromArray(i.focalOffset0),this.moveTo(i.target[0],i.target[1],i.target[2],e),F.setFromVector3(n.sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(F.theta,F.phi,e),this.zoomTo(i.zoom,e),this.setFocalOffset(i.focalOffset[0],i.focalOffset[1],i.focalOffset[2],e),this._needsUpdate=!0}dispose(){this._removeAllEventListeners()}_findPointerById(t){let e=null;return this._activePointers.some((i=>i.pointerId===t&&(e=i,!0))),e}_encloseToBoundary(t,e,i){const n=e.lengthSq();if(0===n)return t;const r=P.copy(e).add(t),s=this._boundary.clampPoint(r,I).sub(r),o=s.lengthSq();if(0===o)return t.add(e);if(o===n)return t;if(0===i)return t.add(e).add(s);{const n=1+i*o/e.dot(s);return t.add(P.copy(e).multiplyScalar(n)).add(s.multiplyScalar(1-i))}}_updateNearPlaneCorners(){if(a(this._camera)){const t=this._camera,e=t.near,i=t.getEffectiveFOV()*S.MathUtils.DEG2RAD,n=Math.tan(.5*i)*e,r=n*t.aspect;this._nearPlaneCorners[0].set(-r,-n,0),this._nearPlaneCorners[1].set(r,-n,0),this._nearPlaneCorners[2].set(r,n,0),this._nearPlaneCorners[3].set(-r,n,0)}else if(l(this._camera)){const t=this._camera,e=1/t.zoom,i=t.left*e,n=t.right*e,r=t.top*e,s=t.bottom*e;this._nearPlaneCorners[0].set(i,r,0),this._nearPlaneCorners[1].set(n,r,0),this._nearPlaneCorners[2].set(n,s,0),this._nearPlaneCorners[3].set(i,s,0)}}_collisionTest(){let t=1/0;if(!(this.colliderMeshes.length>=1))return t;if(y(this._camera))return t;const e=O.setFromSpherical(this._spherical).divideScalar(this._spherical.radius);V.lookAt(T,e,this._camera.up);for(let i=0;i<4;i++){const n=P.copy(this._nearPlaneCorners[i]);n.applyMatrix4(V);const r=I.addVectors(this._target,n);W.set(r,e),W.far=this._spherical.radius+1;const s=W.intersectObjects(this.colliderMeshes);0!==s.length&&s[0].distance<t&&(t=s[0].distance)}return t}_getClientRect(t){const e=this._domElement.getBoundingClientRect();return t.x=e.left,t.y=e.top,this._viewport?(t.x+=this._viewport.x,t.y+=e.height-this._viewport.w-this._viewport.y,t.width=this._viewport.z,t.height=this._viewport.w):(t.width=e.width,t.height=e.height),t}_createOnRestPromise(t){return t?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise((t=>{const e=()=>{this.removeEventListener("rest",e),t()};this.addEventListener("rest",e)})))}_removeAllEventListeners(){}}},7696:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>r});var n=i(9477);function r(t){Math.PI;t.transformSVGPath=function(t){var e,i,r=new n.T_1,s=1,o=t.length,a=0,l=0,c=null,h=null;function u(){for(var e,i,n,r=!1;s<o&&(44===(i=t.charCodeAt(s))||32===i);)s++;for(e=45===i?s++:s;s<o;)if(48<=(i=t.charCodeAt(s))&&i<=57)s++;else{if(46!==i)return n=t.substring(e,s),r?parseFloat(n):parseInt(n);s++,r=!0}return n=t.substring(e),r?parseFloat(n):parseInt(n)}function d(){for(var e;s<o&&(44===(e=t.charCodeAt(s))||32===e);)s++;return 45===(e=t.charCodeAt(s))||48<=e&&e<=57}for(e=t[0];s<=o;){switch(i=!0,e){case"M":a=u(),l=u(),r.moveTo(a,l),e="L",c=a,h=l;break;case"Z":i=!1,a===c&&l===h||r.lineTo(c,h);break;case"L":a=u(),l=u(),r.lineTo(a,l);break;default:throw new Error("Wrong path command: "+e)}i&&d()||(e=t[s++])}return r}}},5013:(t,e,i)=>{"use strict";i.r(e),i.d(e,{GridClass:()=>n});class n{constructor(t,e,i){const n=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(t/i),this.yCellCount=Math.ceil(e/i);for(let t=0;t<this.xCellCount*this.yCellCount;t++)n.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,e,i,n,r){this._forEachCell(e,i,n,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r)}insertCircle(t,e,i,n){this._forEachCell(e-n,i-n,e+n,i+n,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(i),this.circles.push(n)}_insertBoxCell(t,e,i,n,r,s){this.boxCells[r].push(s)}_insertCircleCell(t,e,i,n,r,s){this.circleCells[r].push(s)}_query(t,e,i,n,r,s,o){if(i<0||t>this.width||n<0||e>this.height)return!r&&[];const l=[];if(t<=0&&e<=0&&this.width<=i&&this.height<=n){if(r)return!0;for(let t=0;t<this.boxKeys.length;t++)l.push({key:this.boxKeys[t],x1:this.bboxes[4*t],y1:this.bboxes[4*t+1],x2:this.bboxes[4*t+2],y2:this.bboxes[4*t+3]});for(let t=0;t<this.circleKeys.length;t++){const e=this.circles[3*t],i=this.circles[3*t+1],n=this.circles[3*t+2];l.push({key:this.circleKeys[t],x1:e-n,y1:i-n,x2:e+n,y2:i+n})}return s?l.filter(a):l}return this._forEachCell(t,e,i,n,this._queryCell,l,{hitTest:r,seenUids:{box:{},circle:{}},index:o},s),r?l.length>0:l}_queryCircle(t,e,i,n,r){const s=t-i,o=t+i,a=e-i,l=e+i;if(o<0||s>this.width||l<0||a>this.height)return!n&&[];const c=[];return this._forEachCell(s,a,o,l,this._queryCellCircle,c,{hitTest:n,circle:{x:t,y:e,radius:i},seenUids:{box:{},circle:{}}},r),n?c.length>0:c}query(t,e,i,n,r){return this._query(t,e,i,n,!1,r)}hitTest(t,e,i,n,r,s){return this._query(t,e,i,n,!0,r,s)}hitTestCircle(t,e,i,n){return this._queryCircle(t,e,i,!0,n)}_queryCell(t,e,i,n,r,s,o,a){const c=o.seenUids,h=this.boxCells[r];if(null!==h){const r=this.bboxes;for(const l of h){if(o.hitTest&&this.boxKeys[l].collisionGroupID===o.index)return 0;if(!c.box[l]){c.box[l]=!0;const h=4*l;if(t<=r[h+2]&&e<=r[h+3]&&i>=r[h+0]&&n>=r[h+1]&&(!a||a(this.boxKeys[l]))){if(o.hitTest)return s.push(!0),!0;s.push({key:this.boxKeys[l],x1:r[h],y1:r[h+1],x2:r[h+2],y2:r[h+3]})}}}}const u=this.circleCells[r];if(null!==u){const r=this.circles;for(const c of u)if(!l.circle[c]){l.circle[c]=!0;const h=3*c;if(this._circleAndRectCollide(r[h],r[h+1],r[h+2],t,e,i,n)&&(!a||a(this.circleKeys[c]))){if(o.hitTest)return s.push(!0),!0;{const t=r[h],e=r[h+1],i=r[h+2];s.push({key:this.circleKeys[c],x1:t-i,y1:e-i,x2:t+i,y2:e+i})}}}}}_queryCellCircle(t,e,i,n,r,s,o,a){const l=o.circle,c=o.seenUids,h=this.boxCells[r];if(null!==h){const t=this.bboxes;for(const e of h)if(!c.box[e]){c.box[e]=!0;const i=4*e;if(this._circleAndRectCollide(l.x,l.y,l.radius,t[i+0],t[i+1],t[i+2],t[i+3])&&(!a||a(this.boxKeys[e])))return s.push(!0),!0}}const u=this.circleCells[r];if(null!==u){const t=this.circles;for(const e of u)if(!c.circle[e]){c.circle[e]=!0;const i=3*e;if(this._circlesCollide(t[i],t[i+1],t[i+2],l.x,l.y,l.radius)&&(!a||a(this.circleKeys[e])))return s.push(!0),!0}}}_forEachCell(t,e,i,n,r,s,o,a){const l=this._convertToXCellCoord(t),c=this._convertToYCellCoord(e),h=this._convertToXCellCoord(i),u=this._convertToYCellCoord(n);for(let d=l;d<=h;d++)for(let l=c;l<=u;l++)if(r.call(this,t,e,i,n,this.xCellCount*l+d,s,o,a))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,e,i,n,r,s){const o=n-t,a=r-e,l=i+s;return l*l>o*o+a*a}_circleAndRectCollide(t,e,i,n,r,s,o){const a=(s-n)/2,l=Math.abs(t-(n+a));if(l>a+i)return!1;const c=(o-r)/2,h=Math.abs(e-(r+c));if(h>c+i)return!1;if(l<=a||h<=c)return!0;const u=l-a,d=h-c;return u*u+d*d<=i*i}isInsideGrid(t,e,i,n){return i>=0&&t<this.width&&n>=0&&e<this.height}}},9421:(t,e,i)=>{"use strict";i.r(e),i.d(e,{SVGLoader:()=>r});var n=i(9477);class r extends n.aNw{constructor(t){super(t),this.defaultDPI=90,this.defaultUnit="px"}load(t,e,i,r){const s=this,o=new n.hH6(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(t,(i=>{try{e(s.parse(i))}catch(e){r?r(e):console.error(e),s.manager.itemError(t)}}),i,r)}parse(t){const e=this,i=[],r=[],s={pois:[],objects:[]};function o(t,e,i,n,r,s,o,l){if(0==e||0==i)return void t.lineTo(l.x,l.y);n=n*Math.PI/180,e=Math.abs(e),i=Math.abs(i);const c=(o.x-l.x)/2,h=(o.y-l.y)/2,u=Math.cos(n)*c+Math.sin(n)*h,d=-Math.sin(n)*c+Math.cos(n)*h;let p=e*e,f=i*i;const m=u*u,g=d*d,v=m/p+g/f;if(v>1){const t=Math.sqrt(v);p=(e*=t)*e,f=(i*=t)*i}const y=p*g+f*m,_=(p*f-y)/y;let x=Math.sqrt(Math.max(0,_));r===s&&(x=-x);const M=x*e*d/i,b=-x*i*u/e,w=Math.cos(n)*M-Math.sin(n)*b+(o.x+l.x)/2,S=Math.sin(n)*M+Math.cos(n)*b+(o.y+l.y)/2,T=a(1,0,(u-M)/e,(d-b)/i),A=a((u-M)/e,(d-b)/i,(-u-M)/e,(-d-b)/i)%(2*Math.PI);t.currentPath.absellipse(w,S,e,i,T,T+A,0===s,n)}function a(t,e,i,n){const r=t*i+e*n,s=Math.sqrt(t*t+e*e)*Math.sqrt(i*i+n*n);let o=Math.acos(Math.max(-1,Math.min(1,r/s)));return t*n-e*i<0&&(o=-o),o}function l(t,e){e={...e};let i={};if(t.hasAttribute("class")){const e=t.getAttribute("class").split(/\s/).filter(Boolean).map((t=>t.trim()));for(let t=0;t<e.length;t++)i=Object.assign(i,_[`.${e[t]}`])}function n(n,r,s){void 0===s&&(s=function(t){return t.startsWith("url"),t}),t.hasAttribute(n)&&(e[r]=s(t.getAttribute(n))),i[n]&&(e[r]=s(i[n])),t.style&&""!==t.style[n]&&(e[r]=s(t.style[n]))}function r(t){return Math.max(0,Math.min(1,p(t)))}function s(t){return Math.max(0,p(t))}return t.hasAttribute("id")&&(i=Object.assign(i,_[`#${t.getAttribute("id")}`])),n("fill","fill"),n("fill-opacity","fillOpacity",r),n("fill-rule","fillRule"),n("opacity","opacity",r),n("stroke","stroke"),n("stroke-opacity","strokeOpacity",r),n("stroke-width","strokeWidth",s),n("stroke-linejoin","strokeLineJoin"),n("stroke-linecap","strokeLineCap"),n("stroke-miterlimit","strokeMiterLimit",s),n("visibility","visibility"),e}function c(t,e){return t-(e-t)}function h(t,e,i){if("string"!=typeof t)throw new TypeError("Invalid input: "+typeof t);const n={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/};let r=0,s=!0,o="",a="";const l=[];function c(t,e,i){const n=new SyntaxError(`Unexpected character "${t}" at index ${e}.`);throw n.partial=i,n}function h(){""!==o&&(""===a?l.push(Number(o)):l.push(Number(o)*10**Number(a))),o="",a=""}let u;const{length:d}=t;for(let p=0;p<d;p++)if(u=t[p],Array.isArray(e)&&e.includes(l.length%i)&&n.FLAGS.test(u))r=1,o=u,h();else{if(0===r){if(n.WHITESPACE.test(u))continue;if(n.DIGIT.test(u)||n.SIGN.test(u)){r=1,o=u;continue}if(n.POINT.test(u)){r=2,o=u;continue}n.COMMA.test(u)&&(s&&c(u,p,l),s=!0)}if(1===r){if(n.DIGIT.test(u)){o+=u;continue}if(n.POINT.test(u)){o+=u,r=2;continue}if(n.EXP.test(u)){r=3;continue}n.SIGN.test(u)&&1===o.length&&n.SIGN.test(o[0])&&c(u,p,l)}if(2===r){if(n.DIGIT.test(u)){o+=u;continue}if(n.EXP.test(u)){r=3;continue}n.POINT.test(u)&&"."===o[o.length-1]&&c(u,p,l)}if(3===r){if(n.DIGIT.test(u)){a+=u;continue}if(n.SIGN.test(u)){if(""===a){a+=u;continue}1===a.length&&n.SIGN.test(a)&&c(u,p,l)}}n.WHITESPACE.test(u)?(h(),r=0,s=!1):n.COMMA.test(u)?(h(),r=0,s=!0):n.SIGN.test(u)?(h(),r=1,o=u):n.POINT.test(u)?(h(),r=2,o=u):c(u,p,l)}return h(),l}const u=["mm","cm","in","pt","pc","px"],d={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function p(t){let i,n="px";if("string"==typeof t||t instanceof String)for(let e=0,i=u.length;e<i;e++){const i=u[e];if(t.endsWith(i)){n=i,t=t.substring(0,t.length-i.length);break}}return"px"===n&&"px"!==e.defaultUnit?i=d.in[e.defaultUnit]/e.defaultDPI:(i=d[n][e.defaultUnit],i<0&&(i=d[n].in*e.defaultDPI)),i*parseFloat(t)}function f(t){const e=t.elements;return e[0]*e[4]-e[1]*e[3]<0}function m(t){const e=t.elements,i=e[0]*e[3]+e[1]*e[4];if(0===i)return!1;const n=g(t),r=v(t);return Math.abs(i/(n*r))>Number.EPSILON}function g(t){const e=t.elements;return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function v(t){const e=t.elements;return Math.sqrt(e[3]*e[3]+e[4]*e[4])}const y=[],_={},x=[],M=new n.Vkp,b=new n.Vkp,w=new n.Vkp,S=new n.Vkp,T=new n.FM8,A=new n.Pa4,E=new n.Vkp,C=(new DOMParser).parseFromString(t,"image/svg+xml");!function t(e,a){if(1!==e.nodeType)return;const u=function(t){if(!(t.hasAttribute("transform")||"use"===t.nodeName&&(t.hasAttribute("x")||t.hasAttribute("y"))))return null;const e=function(t){const e=new n.Vkp,i=M;if("use"===t.nodeName&&(t.hasAttribute("x")||t.hasAttribute("y"))){const i=p(t.getAttribute("x")),n=p(t.getAttribute("y"));e.translate(i,n)}if(t.hasAttribute("transform")){const n=t.getAttribute("transform").split(")");for(let t=n.length-1;t>=0;t--){const r=n[t].trim();if(""===r)continue;const s=r.indexOf("("),o=r.length;if(s>0&&s<o){const t=r.slice(0,s),e=h(r.slice(s+1));switch(i.identity(),t){case"translate":if(e.length>=1){const t=e[0];let n=0;e.length>=2&&(n=e[1]),i.translate(t,n)}break;case"rotate":if(e.length>=1){let t=0,n=0,r=0;t=-e[0]*Math.PI/180,e.length>=3&&(n=e[1],r=e[2]),b.identity().translate(-n,-r),w.identity().rotate(t),S.multiplyMatrices(w,b),b.identity().translate(n,r),i.multiplyMatrices(b,S)}break;case"scale":if(e.length>=1){const t=e[0];let n=t;e.length>=2&&(n=e[1]),i.scale(t,n)}break;case"skewX":1===e.length&&i.set(1,Math.tan(e[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===e.length&&i.set(1,0,0,Math.tan(e[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===e.length&&i.set(e[0],e[2],e[4],e[1],e[3],e[5],0,0,1)}}e.premultiply(i)}}return e}(t);x.length>0&&e.premultiply(x[x.length-1]);return E.copy(e),x.push(e),e}(e);let d=!1,C=null;switch(e.nodeName){case"svg":a=l(e,a);break;case"style":!function(t){if(!t.sheet||!t.sheet.cssRules||!t.sheet.cssRules.length)return;for(let e=0;e<t.sheet.cssRules.length;e++){const i=t.sheet.cssRules[e];if(1!==i.type)continue;const n=i.selectorText.split(/,/gm).filter(Boolean).map((t=>t.trim()));for(let t=0;t<n.length;t++){const e=Object.fromEntries(Object.entries(i.style).filter((([,t])=>""!==t)));_[n[t]]=Object.assign(_[n[t]]||{},e)}}}(e);break;case"g":if("POI_GROUP"===e.getAttribute("group-type"))s.pois.push({poi:e,transform:u});else a=l(e,a);break;case"path":a=l(e,a),e.hasAttribute("d")&&(C=function(t){const e=new n.T_1,i=new n.FM8,r=new n.FM8,s=new n.FM8;let a=!0,l=!1;const u=t.getAttribute("d").match(/[a-df-z][^a-df-z]*/gi);for(let t=0,n=u.length;t<n;t++){const n=u[t],d=n.charAt(0),p=n.slice(1).trim();let f;switch(!0===a&&(l=!0,a=!1),d){case"M":f=h(p);for(let t=0,n=f.length;t<n;t+=2)i.x=f[t+0],i.y=f[t+1],r.x=i.x,r.y=i.y,0===t?e.moveTo(i.x,i.y):e.lineTo(i.x,i.y),0===t&&s.copy(i);break;case"H":f=h(p);for(let t=0,n=f.length;t<n;t++)i.x=f[t],r.x=i.x,r.y=i.y,e.lineTo(i.x,i.y),0===t&&!0===l&&s.copy(i);break;case"V":f=h(p);for(let t=0,n=f.length;t<n;t++)i.y=f[t],r.x=i.x,r.y=i.y,e.lineTo(i.x,i.y),0===t&&!0===l&&s.copy(i);break;case"L":f=h(p);for(let t=0,n=f.length;t<n;t+=2)i.x=f[t+0],i.y=f[t+1],r.x=i.x,r.y=i.y,e.lineTo(i.x,i.y),0===t&&!0===l&&s.copy(i);break;case"C":f=h(p);for(let t=0,n=f.length;t<n;t+=6)e.bezierCurveTo(f[t+0],f[t+1],f[t+2],f[t+3],f[t+4],f[t+5]),r.x=f[t+2],r.y=f[t+3],i.x=f[t+4],i.y=f[t+5],0===t&&!0===l&&s.copy(i);break;case"S":f=h(p);for(let t=0,n=f.length;t<n;t+=4)e.bezierCurveTo(c(i.x,r.x),c(i.y,r.y),f[t+0],f[t+1],f[t+2],f[t+3]),r.x=f[t+0],r.y=f[t+1],i.x=f[t+2],i.y=f[t+3],0===t&&!0===l&&s.copy(i);break;case"Q":f=h(p);for(let t=0,n=f.length;t<n;t+=4)e.quadraticCurveTo(f[t+0],f[t+1],f[t+2],f[t+3]),r.x=f[t+0],r.y=f[t+1],i.x=f[t+2],i.y=f[t+3],0===t&&!0===l&&s.copy(i);break;case"T":f=h(p);for(let t=0,n=f.length;t<n;t+=2){const n=c(i.x,r.x),o=c(i.y,r.y);e.quadraticCurveTo(n,o,f[t+0],f[t+1]),r.x=n,r.y=o,i.x=f[t+0],i.y=f[t+1],0===t&&!0===l&&s.copy(i)}break;case"A":f=h(p,[3,4],7);for(let t=0,n=f.length;t<n;t+=7){if(f[t+5]==i.x&&f[t+6]==i.y)continue;const n=i.clone();i.x=f[t+5],i.y=f[t+6],r.x=i.x,r.y=i.y,o(e,f[t],f[t+1],f[t+2],f[t+3],f[t+4],n,i),0===t&&!0===l&&s.copy(i)}break;case"m":f=h(p);for(let t=0,n=f.length;t<n;t+=2)i.x+=f[t+0],i.y+=f[t+1],r.x=i.x,r.y=i.y,0===t?e.moveTo(i.x,i.y):e.lineTo(i.x,i.y),0===t&&s.copy(i);break;case"h":f=h(p);for(let t=0,n=f.length;t<n;t++)i.x+=f[t],r.x=i.x,r.y=i.y,e.lineTo(i.x,i.y),0===t&&!0===l&&s.copy(i);break;case"v":f=h(p);for(let t=0,n=f.length;t<n;t++)i.y+=f[t],r.x=i.x,r.y=i.y,e.lineTo(i.x,i.y),0===t&&!0===l&&s.copy(i);break;case"l":f=h(p);for(let t=0,n=f.length;t<n;t+=2)i.x+=f[t+0],i.y+=f[t+1],r.x=i.x,r.y=i.y,e.lineTo(i.x,i.y),0===t&&!0===l&&s.copy(i);break;case"c":f=h(p);for(let t=0,n=f.length;t<n;t+=6)e.bezierCurveTo(i.x+f[t+0],i.y+f[t+1],i.x+f[t+2],i.y+f[t+3],i.x+f[t+4],i.y+f[t+5]),r.x=i.x+f[t+2],r.y=i.y+f[t+3],i.x+=f[t+4],i.y+=f[t+5],0===t&&!0===l&&s.copy(i);break;case"s":f=h(p);for(let t=0,n=f.length;t<n;t+=4)e.bezierCurveTo(c(i.x,r.x),c(i.y,r.y),i.x+f[t+0],i.y+f[t+1],i.x+f[t+2],i.y+f[t+3]),r.x=i.x+f[t+0],r.y=i.y+f[t+1],i.x+=f[t+2],i.y+=f[t+3],0===t&&!0===l&&s.copy(i);break;case"q":f=h(p);for(let t=0,n=f.length;t<n;t+=4)e.quadraticCurveTo(i.x+f[t+0],i.y+f[t+1],i.x+f[t+2],i.y+f[t+3]),r.x=i.x+f[t+0],r.y=i.y+f[t+1],i.x+=f[t+2],i.y+=f[t+3],0===t&&!0===l&&s.copy(i);break;case"t":f=h(p);for(let t=0,n=f.length;t<n;t+=2){const n=c(i.x,r.x),o=c(i.y,r.y);e.quadraticCurveTo(n,o,i.x+f[t+0],i.y+f[t+1]),r.x=n,r.y=o,i.x+=f[t+0],i.y+=f[t+1],0===t&&!0===l&&s.copy(i)}break;case"a":f=h(p,[3,4],7);for(let t=0,n=f.length;t<n;t+=7){if(0==f[t+5]&&0==f[t+6])continue;const n=i.clone();i.x+=f[t+5],i.y+=f[t+6],r.x=i.x,r.y=i.y,o(e,f[t],f[t+1],f[t+2],f[t+3],f[t+4],n,i),0===t&&!0===l&&s.copy(i)}break;case"Z":case"z":e.currentPath.autoClose=!0,e.currentPath.curves.length>0&&(i.copy(s),e.currentPath.currentPoint.copy(i),a=!0)}l=!1}return e}(e));break;case"rect":a=l(e,a),C=function(t){const e=p(t.getAttribute("x")||0),i=p(t.getAttribute("y")||0),r=p(t.getAttribute("rx")||t.getAttribute("ry")||0),s=p(t.getAttribute("ry")||t.getAttribute("rx")||0),o=p(t.getAttribute("width")),a=p(t.getAttribute("height")),l=.448084975506,c=new n.T_1;c.moveTo(e+r,i),c.lineTo(e+o-r,i),(0!==r||0!==s)&&c.bezierCurveTo(e+o-r*l,i,e+o,i+s*l,e+o,i+s);c.lineTo(e+o,i+a-s),(0!==r||0!==s)&&c.bezierCurveTo(e+o,i+a-s*l,e+o-r*l,i+a,e+o-r,i+a);c.lineTo(e+r,i+a),(0!==r||0!==s)&&c.bezierCurveTo(e+r*l,i+a,e,i+a-s*l,e,i+a-s);c.lineTo(e,i+s),(0!==r||0!==s)&&c.bezierCurveTo(e,i+s*l,e+r*l,i,e+r,i);return c}(e);break;case"polygon":a=l(e,a),C=function(t){function e(t,e,i){const n=p(e),o=p(i);0===s?r.moveTo(n,o):r.lineTo(n,o),s++}const i=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,r=new n.T_1;let s=0;return t.getAttribute("points").replace(i,e),r.currentPath.autoClose=!0,r}(e);break;case"polyline":a=l(e,a),C=function(t){function e(t,e,i){const n=p(e),o=p(i);0===s?r.moveTo(n,o):r.lineTo(n,o),s++}const i=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,r=new n.T_1;let s=0;return t.getAttribute("points").replace(i,e),r.currentPath.autoClose=!1,r}(e);break;case"circle":a=l(e,a),C=function(t){const e=p(t.getAttribute("cx")||0),i=p(t.getAttribute("cy")||0),r=p(t.getAttribute("r")||0),s=new n.y$t;s.absarc(e,i,r,0,2*Math.PI);const o=new n.T_1;return o.subPaths.push(s),o}(e);break;case"ellipse":a=l(e,a),C=function(t){const e=p(t.getAttribute("cx")||0),i=p(t.getAttribute("cy")||0),r=p(t.getAttribute("rx")||0),s=p(t.getAttribute("ry")||0),o=new n.y$t;o.absellipse(e,i,r,s,0,2*Math.PI);const a=new n.T_1;return a.subPaths.push(o),a}(e);break;case"line":a=l(e,a),C=function(t){const e=p(t.getAttribute("x1")||0),i=p(t.getAttribute("y1")||0),r=p(t.getAttribute("x2")||0),s=p(t.getAttribute("y2")||0),o=new n.T_1;return o.moveTo(e,i),o.lineTo(r,s),o.currentPath.autoClose=!1,o}(e);break;case"defs":d=!0;break;case"text":if("POI_TEXT"===e.getAttribute("poi-type"))"g"===e.parentNode.nodeName&&(s.pois[s.pois.length-1].text=e);else i.push(e);break;case"image":if("POI_IMAGE"===e.getAttribute("poi-type"))"g"===e.parentNode.nodeName&&(s.pois[s.pois.length-1].image=e);else r.push(e);break;case"use":a=l(e,a);const f=(e.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").substring(1),m=e.viewportElement.getElementById(f);m&&t(m,a)}C&&(void 0!==a.fill&&"none"!==a.fill&&C.color.setStyle(a.fill),function(t,e){function i(t){A.set(t.x,t.y,1).applyMatrix3(e),t.set(A.x,A.y)}function r(t){const i=t.xRadius,r=t.yRadius,s=Math.cos(t.aRotation),o=Math.sin(t.aRotation),a=new n.Pa4(i*s,i*o,0),l=new n.Pa4(-r*o,r*s,0),c=a.applyMatrix3(e),h=l.applyMatrix3(e),u=M.set(c.x,h.x,0,c.y,h.y,0,0,0,1),d=b.copy(u).invert(),p=w.copy(d).transpose().multiply(d).elements,m=function(t,e,i){let n,r,s,o,a;const l=t+i,c=t-i,h=Math.sqrt(c*c+4*e*e);l>0?(n=.5*(l+h),a=1/n,r=t*a*i-e*a*e):l<0?r=.5*(l-h):(n=.5*h,r=-.5*h);s=c>0?c+h:c-h;Math.abs(s)>2*Math.abs(e)?(a=-2*e/s,o=1/Math.sqrt(1+a*a),s=a*o):0===Math.abs(e)?(s=1,o=0):(a=-.5*s/e,s=1/Math.sqrt(1+a*a),o=a*s);c>0&&(a=s,s=-o,o=a);return{rt1:n,rt2:r,cs:s,sn:o}}(p[0],p[1],p[4]),g=Math.sqrt(m.rt1),v=Math.sqrt(m.rt2);t.xRadius=1/g,t.yRadius=1/v,t.aRotation=Math.atan2(m.sn,m.cs);if(!((t.aEndAngle-t.aStartAngle)%(2*Math.PI)<Number.EPSILON)){const i=b.set(g,0,0,0,v,0,0,0,1),r=w.set(m.cs,m.sn,0,-m.sn,m.cs,0,0,0,1),s=i.multiply(r).multiply(u),o=t=>{const{x:e,y:i}=new n.Pa4(Math.cos(t),Math.sin(t),0).applyMatrix3(s);return Math.atan2(i,e)};t.aStartAngle=o(t.aStartAngle),t.aEndAngle=o(t.aEndAngle),f(e)&&(t.aClockwise=!t.aClockwise)}}function s(t){const i=g(e),n=v(e);t.xRadius*=i,t.yRadius*=n;const r=i>Number.EPSILON?Math.atan2(e.elements[1],e.elements[0]):Math.atan2(-e.elements[3],e.elements[4]);t.aRotation+=r,f(e)&&(t.aStartAngle*=-1,t.aEndAngle*=-1,t.aClockwise=!t.aClockwise)}const{subPaths:o}=t;for(let t=0,n=o.length;t<n;t++){const n=o[t],{curves:a}=n;for(let t=0;t<a.length;t++){const n=a[t];n.isLineCurve?(i(n.v1),i(n.v2)):n.isCubicBezierCurve?(i(n.v0),i(n.v1),i(n.v2),i(n.v3)):n.isQuadraticBezierCurve?(i(n.v0),i(n.v1),i(n.v2)):n.isEllipseCurve&&(T.set(n.aX,n.aY),i(T),n.aX=T.x,n.aY=T.y,m(e)?r(n):s(n))}}}(C,E),y.push(C),C.userData={node:e,style:a});const{childNodes:O}=e;for(let e=0;e<O.length;e++){const i=O[e];d&&"style"!==i.nodeName&&"defs"!==i.nodeName?t(i,a):t(i,a)}u&&(x.pop(),x.length>0?E.copy(x[x.length-1]):E.identity())}(C.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),y.forEach((t=>{s.objects.push({path:t,objectType:"PATH"})}));return{paths:y,xml:C.documentElement,groups:s,images:r,texts:i}}static createShapes(t){const e=999999999,i=0,r=1,s=2,o=3,a=4,l=5,c=6,h={loc:i,t:0};function u(t,e,n,r){const o=t.x,a=e.x,l=n.x,c=r.x,u=t.y,p=e.y,f=n.y,m=r.y,g=(c-l)*(u-f)-(m-f)*(o-l),v=(m-f)*(a-o)-(c-l)*(p-u),y=g/v,_=((a-o)*(u-f)-(p-u)*(o-l))/v;if(0===v&&0!==g||y<=0||y>=1||_<0||_>1)return null;if(0===g&&0===v){for(let l=0;l<2;l++){if(d(0===l?n:r,t,e),h.loc==i){const t=0===l?n:r;return{x:t.x,y:t.y,t:h.t}}if(h.loc==s){return{x:+(o+h.t*(a-o)).toPrecision(10),y:+(u+h.t*(p-u)).toPrecision(10),t:h.t}}}return null}for(let s=0;s<2;s++)if(d(0===s?n:r,t,e),h.loc==i){const t=0===s?n:r;return{x:t.x,y:t.y,t:h.t}}return{x:+(o+y*(a-o)).toPrecision(10),y:+(u+y*(p-u)).toPrecision(10),t:y}}function d(t,e,n){const u=n.x-e.x,d=n.y-e.y,p=t.x-e.x,f=t.y-e.y,m=u*f-p*d;if(t.x===e.x&&t.y===e.y)return h.loc=i,void(h.t=0);if(t.x===n.x&&t.y===n.y)return h.loc=r,void(h.t=1);if(m<-Number.EPSILON)return void(h.loc=o);if(m>Number.EPSILON)return void(h.loc=a);if(u*p<0||d*f<0)return void(h.loc=l);if(Math.sqrt(u*u+d*d)<Math.sqrt(p*p+f*f))return void(h.loc=c);let g;g=0!==u?p/u:f/d,h.loc=s,h.t=g}function p(t,e,i){const r=new n.FM8;e.getCenter(r);const s=[];return i.forEach((e=>{if(e.boundingBox.containsPoint(r)){(function(t,e){const i=[],r=[];for(let s=1;s<t.length;s++){const o=t[s-1],a=t[s];for(let t=1;t<e.length;t++){const s=u(o,a,e[t-1],e[t]);null!==s&&void 0===i.find((t=>t.t<=s.t+Number.EPSILON&&t.t>=s.t-Number.EPSILON))&&(i.push(s),r.push(new n.FM8(s.x,s.y)))}}return r})(t,e.points).forEach((t=>{s.push({identifier:e.identifier,isCW:e.isCW,point:t})}))}})),s.sort(((t,e)=>t.point.x-e.point.x)),s}let f=0,m=e,g=-999999999,v=t.subPaths.map((t=>{const i=t.getPoints();let r=-999999999,s=e,o=-999999999,a=e;for(let t=0;t<i.length;t++){const e=i[t];e.y>r&&(r=e.y),e.y<s&&(s=e.y),e.x>o&&(o=e.x),e.x<a&&(a=e.x)}return g<=o&&(g=o+1),m>=a&&(m=a-1),{curves:t.curves,points:i,isCW:n.iDF.isClockWise(i),identifier:f++,boundingBox:new n.TUj(new n.FM8(a,s),new n.FM8(o,r))}}));v=v.filter((t=>t.points.length>1));const y=v.map((e=>function(t,e,i,r,s){null!=s&&""!==s||(s="nonzero");const o=new n.FM8;t.boundingBox.getCenter(o);const a=p([new n.FM8(i,o.y),new n.FM8(r,o.y)],t.boundingBox,e);a.sort(((t,e)=>t.point.x-e.point.x));const l=[],c=[];a.forEach((e=>{e.identifier===t.identifier?l.push(e):c.push(e)}));const h=l[0].point.x,u=[];let d=0;for(;d<c.length&&c[d].point.x<h;)u.length>0&&u[u.length-1]===c[d].identifier?u.pop():u.push(c[d].identifier),d++;if(u.push(t.identifier),"evenodd"===s){const e=u.length%2==0,i=u[u.length-2];return{identifier:t.identifier,isHole:e,for:i}}if("nonzero"===s){let i=!0,n=null,r=null;for(let t=0;t<u.length;t++){const s=u[t];i?(r=e[s].isCW,i=!1,n=s):r!==e[s].isCW&&(r=e[s].isCW,i=!0)}return{identifier:t.identifier,isHole:i,for:n}}}(e,v,m,g,t.userData?.style.fillRule))),_=[];return v.forEach((t=>{if(!y[t.identifier].isHole){const e=new n.bnF;e.curves=t.curves;y.filter((e=>e.isHole&&e.for===t.identifier)).forEach((t=>{const i=v[t.identifier],r=new n.y$t;r.curves=i.curves,e.holes.push(r)})),_.push(e)}})),_}static getStrokeStyle(t,e,i,n,r){return{strokeColor:e=void 0!==e?e:"#000",strokeWidth:t=void 0!==t?t:1,strokeLineJoin:i=void 0!==i?i:"miter",strokeLineCap:n=void 0!==n?n:"butt",strokeMiterLimit:r=void 0!==r?r:4}}static pointsToStroke(t,e,i,s){const o=[],a=[],l=[];if(0===r.pointsToStrokeWithBuffers(t,e,i,s,o,a,l))return null;const c=new n.u9r;return c.setAttribute("position",new n.a$l(o,3)),c.setAttribute("normal",new n.a$l(a,3)),c.setAttribute("uv",new n.a$l(l,2)),c}static pointsToStrokeWithBuffers(t,e,i,r,s,o,a,l){const c=new n.FM8,h=new n.FM8,u=new n.FM8,d=new n.FM8,p=new n.FM8,f=new n.FM8,m=new n.FM8,g=new n.FM8,v=new n.FM8,y=new n.FM8,_=new n.FM8,x=new n.FM8,M=new n.FM8,b=new n.FM8,w=new n.FM8,S=new n.FM8,T=new n.FM8;i=void 0!==i?i:12,r=void 0!==r?r:.001,l=void 0!==l?l:0;const A=(t=function(t){let e=!1;for(let i=1,n=t.length-1;i<n;i++)if(t[i].distanceTo(t[i+1])<r){e=!0;break}if(!e)return t;const i=[];i.push(t[0]);for(let e=1,n=t.length-1;e<n;e++)t[e].distanceTo(t[e+1])>=r&&i.push(t[e]);return i.push(t[t.length-1]),i}(t)).length;if(A<2)return 0;const E=t[0].equals(t[A-1]);let C,O,P=t[0];const I=e.strokeWidth/2,D=1/(A-1);let L,R,B,N,F=0,U=!1,G=0,z=3*l,k=2*l;j(t[0],t[1],c).multiplyScalar(I),g.copy(t[0]).sub(c),v.copy(t[0]).add(c),y.copy(g),_.copy(v);for(let i=1;i<A;i++){C=t[i],O=i===A-1?E?t[1]:void 0:t[i+1];const n=c;if(j(P,C,n),u.copy(n).multiplyScalar(I),x.copy(C).sub(u),M.copy(C).add(u),L=F+D,R=!1,void 0!==O){j(C,O,h),u.copy(h).multiplyScalar(I),b.copy(C).sub(u),w.copy(C).add(u),B=!0,u.subVectors(O,P),n.dot(u)<0&&(B=!1),1===i&&(U=B),u.subVectors(O,C),u.normalize();const t=Math.abs(n.dot(u));if(t>Number.EPSILON){const i=I/t;u.multiplyScalar(-i),d.subVectors(C,P),p.copy(d).setLength(i).add(u),S.copy(p).negate();const n=p.length(),r=d.length();d.divideScalar(r),f.subVectors(O,C);const s=f.length();switch(f.divideScalar(s),d.dot(S)<r&&f.dot(S)<s&&(R=!0),T.copy(p).add(C),S.add(C),N=!1,R?B?(w.copy(S),M.copy(S)):(b.copy(S),x.copy(S)):W(),e.strokeLineJoin){case"bevel":q(B,R,L);break;case"round":J(B,R),B?V(C,x,b,L,0):V(C,w,M,L,1);break;default:const t=I*e.strokeMiterLimit/n;if(t<1){if("miter-clip"!==e.strokeLineJoin){q(B,R,L);break}J(B,R),B?(f.subVectors(T,x).multiplyScalar(t).add(x),m.subVectors(T,b).multiplyScalar(t).add(b),H(x,L,0),H(f,L,0),H(C,L,.5),H(C,L,.5),H(f,L,0),H(m,L,0),H(C,L,.5),H(m,L,0),H(b,L,0)):(f.subVectors(T,M).multiplyScalar(t).add(M),m.subVectors(T,w).multiplyScalar(t).add(w),H(M,L,1),H(f,L,1),H(C,L,.5),H(C,L,.5),H(f,L,1),H(m,L,1),H(C,L,.5),H(m,L,1),H(w,L,1))}else R?(B?(H(v,F,1),H(g,F,0),H(T,L,0),H(v,F,1),H(T,L,0),H(S,L,1)):(H(v,F,1),H(g,F,0),H(T,L,1),H(g,F,0),H(S,L,0),H(T,L,1)),B?b.copy(T):w.copy(T)):B?(H(x,L,0),H(T,L,0),H(C,L,.5),H(C,L,.5),H(T,L,0),H(b,L,0)):(H(M,L,1),H(T,L,1),H(C,L,.5),H(C,L,.5),H(T,L,1),H(w,L,1)),N=!0}}else W()}else W();E||i!==A-1||X(t[0],y,_,B,!0,F),F=L,P=C,g.copy(b),v.copy(w)}if(E){if(R&&s){let t=T,e=S;U!==B&&(t=S,e=T),B?(N||U)&&(e.toArray(s,0),e.toArray(s,9),N&&t.toArray(s,3)):!N&&U||(e.toArray(s,3),e.toArray(s,9),N&&t.toArray(s,0))}}else X(C,x,M,B,!1,L);return G;function j(t,e,i){return i.subVectors(e,t),i.set(-i.y,i.x).normalize()}function H(t,e,i){s&&(s[z]=t.x,s[z+1]=t.y,s[z+2]=0,o&&(o[z]=0,o[z+1]=0,o[z+2]=1),z+=3,a&&(a[k]=e,a[k+1]=i,k+=2)),G+=3}function V(t,e,n,r,s){c.copy(e).sub(t).normalize(),h.copy(n).sub(t).normalize();let o=Math.PI;const a=c.dot(h);Math.abs(a)<1&&(o=Math.abs(Math.acos(a))),o/=i,u.copy(e);for(let e=0,n=i-1;e<n;e++)d.copy(u).rotateAround(t,o),H(u,r,s),H(d,r,s),H(t,r,.5),u.copy(d);H(d,r,s),H(n,r,s),H(t,r,.5)}function W(){H(v,F,1),H(g,F,0),H(x,L,0),H(v,F,1),H(x,L,1),H(M,L,0)}function q(t,e,i){e?t?(H(v,F,1),H(g,F,0),H(x,L,0),H(v,F,1),H(x,L,0),H(S,L,1),H(x,i,0),H(b,i,0),H(S,i,.5)):(H(v,F,1),H(g,F,0),H(M,L,1),H(g,F,0),H(S,L,0),H(M,L,1),H(M,i,1),H(w,i,0),H(S,i,.5)):t?(H(x,i,0),H(b,i,0),H(C,i,.5)):(H(M,i,1),H(w,i,0),H(C,i,.5))}function J(t,e){e&&(t?(H(v,F,1),H(g,F,0),H(x,L,0),H(v,F,1),H(x,L,0),H(S,L,1),H(x,F,0),H(C,L,.5),H(S,L,1),H(C,L,.5),H(b,F,0),H(S,L,1)):(H(v,F,1),H(g,F,0),H(M,L,1),H(g,F,0),H(S,L,0),H(M,L,1),H(M,F,1),H(S,L,0),H(C,L,.5),H(C,L,.5),H(S,L,0),H(w,F,1)))}function X(t,i,n,r,o,a){switch(e.strokeLineCap){case"round":o?V(t,n,i,a,.5):V(t,i,n,a,.5);break;case"square":if(o)c.subVectors(i,t),h.set(c.y,-c.x),u.addVectors(c,h).add(t),d.subVectors(h,c).add(t),r?(u.toArray(s,3),d.toArray(s,0),d.toArray(s,9)):(u.toArray(s,3),u.toArray(s,9),d.toArray(s,0));else{c.subVectors(n,t),h.set(c.y,-c.x),u.addVectors(c,h).add(t),d.subVectors(h,c).add(t);const e=s.length;r?(u.toArray(s,e-3),d.toArray(s,e-6),d.toArray(s,e-12)):(u.toArray(s,e-6),d.toArray(s,e-3),d.toArray(s,e-12))}}}}}},3086:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>h});const n={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};const r=new class{constructor(t,e,i){const n=this;let r,s=!1,o=0,a=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(t){a++,!1===s&&void 0!==n.onStart&&n.onStart(t,o,a),s=!0},this.itemEnd=function(t){o++,void 0!==n.onProgress&&n.onProgress(t,o,a),o===a&&(s=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)},this.resolveURL=function(t){return r?r(t):t},this.setURLModifier=function(t){return r=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,i=l.length;e<i;e+=2){const i=l[e],n=l[e+1];if(i.global&&(i.lastIndex=0),i.test(t))return n}return null}}};const s={};class o extends class{constructor(t){this.manager=void 0!==t?t:r,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise((function(n,r){i.load(t,n,e,r)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}{constructor(t){super(t)}load(t,e,i,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const o=n.get(t);if(void 0!==o)return this.manager.itemStart(t),setTimeout((()=>{e&&e(o),this.manager.itemEnd(t)}),0),o;if(void 0!==s[t])return void s[t].push({onLoad:e,onProgress:i,onError:r});s[t]=[],s[t].push({onLoad:e,onProgress:i,onError:r});const a=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),l=this.mimeType,c=this.responseType;fetch(a).then((e=>{if(200===e.status||0===e.status){if(e.status,"undefined"==typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;const i=s[t],n=e.body.getReader(),r=e.headers.get("Content-Length"),o=r?parseInt(r):0,a=0!==o;let l=0;const c=new ReadableStream({start(t){!function e(){n.read().then((({done:n,value:r})=>{if(n)t.close();else{l+=r.byteLength;const n=new ProgressEvent("progress",{lengthComputable:a,loaded:l,total:o});for(let t=0,e=i.length;t<e;t++){const e=i[t];e.onProgress&&e.onProgress(n)}t.enqueue(r),e()}}))}()}});return new Response(c)}throw Error(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`)})).then((t=>{switch(c){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((t=>(new DOMParser).parseFromString(t,l)));case"json":return t.json();default:if(void 0===l)return t.text();{const e=/charset="?([^;"\s]*)"?/i.exec(l),i=e&&e[1]?e[1].toLowerCase():void 0,n=new TextDecoder(i);return t.arrayBuffer().then((t=>n.decode(t)))}}})).then((e=>{n.add(t,e);const i=s[t];delete s[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onLoad&&n.onLoad(e)}})).catch((e=>{const i=s[t];if(void 0===i)throw this.manager.itemError(t),e;delete s[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onError&&n.onError(e)}this.manager.itemError(t)})).finally((()=>{this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}var a=i(9477);class l extends a.ROQ{constructor(t,e,i,n,r,s,o,a,l){super(t,e,i,n,r,s,o,a,l),this.needsUpdate=!1,this.timeoutId=null}setReader(t){this.reader=t,this.image=document.createElement("canvas"),this.image.width=t.width,this.image.height=t.height,this.context=this.image.getContext("2d"),this.frameNumber=0,this.previousFrameInfo=null,this.draw()}draw(){if(!this.reader)return;const{reader:t,image:e,context:i}=this,{width:n,height:r}=e,s=++this.frameNumber%t.numFrames(),o=t.frameInfo(s);0===s?i.clearRect(0,0,n,r):this.previousFrameInfo&&2===this.previousFrameInfo.disposal&&i.clearRect(this.previousFrameInfo.x,this.previousFrameInfo.y,this.previousFrameInfo.width,this.previousFrameInfo.height);const a=i.getImageData(0,0,n,r);t.decodeAndBlitFrameRGBA(s,a.data),i.putImageData(a,0,0),this.needsUpdate=!0,this.previousFrameInfo=o,this.timeoutId=setTimeout(this.draw.bind(this),10*o.delay)}stop(){this.timeoutId&&clearTimeout(this.timeoutId)}}var c=i(1494);class h{constructor(t){this.manager=t||r,this.crossOrigin="anonymous"}load(t,e,i,n){const r=new l,s=new o(this.manager);return s.setPath(this.path),s.setResponseType("arraybuffer"),s.load(t,(t=>{const i=new Uint8Array(t),n=new c.N(i);r.setReader(n),e&&e(n)}),i,n),r}setPath(t){return this.path=t,this}}},3970:(t,e,i)=>{"use strict";i.r(e),i.d(e,{Raycaster:()=>s});var n=i(9477);function r(t,e,i,n){if(t.visible&&(t.raycast(e,i),!0===n)){const{children:n}=t;for(let t=0,{length:s}=n;t<s;t++)r(n[t],e,i,!0)}}class s extends n.iMs{intersectObject(t,e,i){const n=i||[];return r(t,this,n,e||!1),n}intersectObjects(t,e,i){const n=i||[];if(!1===Array.isArray(t))return n;for(let i=0,s=t.length;i<s;i++)r(t[i],this,n,e||!1);return n}}},326:(t,e,i)=>{"use strict";i.r(e),i.d(e,{ThreeDebugUtils:()=>r});var n=i(9477);class r{constructor(t){this.scene=t}setHelper(){const t=1e5,e=new n.VLJ(t,100);this.scene.add(e),this.scene.add(new n.y8_(t));const i=new n.PMe(16777215);i.position.set(10,10,10),this.scene.add(i);const r=new n.FvO(i);this.scene.add(r)}drawPointSphereHelper(t,e,i){const r=new n.xo$(i,5,5),s=new n.nls({color:e}),o=new n.blk(r,s);o.position.set(t.x,t.y,t.z),this.scene.add(o)}}},7218:(t,e,i)=>{"use strict";function n(t,e){return function(){return t.apply(e,arguments)}}const{toString:r}=Object.prototype,{getPrototypeOf:s}=Object,o=(a=Object.create(null),t=>{const e=r.call(t);return a[e]||(a[e]=e.slice(8,-1).toLowerCase())});var a;const l=t=>(t=t.toLowerCase(),e=>o(e)===t),c=t=>e=>typeof e===t,{isArray:h}=Array,u=c("undefined");const d=l("ArrayBuffer");const p=c("string"),f=c("function"),m=c("number"),g=t=>null!==t&&"object"==typeof t,v=t=>{if("object"!==o(t))return!1;const e=s(t);return!(null!==e&&e!==Object.prototype&&null!==Object.getPrototypeOf(e)||Symbol.toStringTag in t||Symbol.iterator in t)},y=l("Date"),_=l("File"),x=l("Blob"),M=l("FileList"),b=l("URLSearchParams");function w(t,e,{allOwnKeys:i=!1}={}){if(null==t)return;let n,r;if("object"!=typeof t&&(t=[t]),h(t))for(n=0,r=t.length;n<r;n++)e.call(null,t[n],n,t);else{const r=i?Object.getOwnPropertyNames(t):Object.keys(t),s=r.length;let o;for(n=0;n<s;n++)o=r[n],e.call(null,t[o],o,t)}}function S(t,e){e=e.toLowerCase();const i=Object.keys(t);let n,r=i.length;for(;r-- >0;)if(n=i[r],e===n.toLowerCase())return n;return null}const T="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:i.g,A=t=>!u(t)&&t!==T;const E=(C="undefined"!=typeof Uint8Array&&s(Uint8Array),t=>C&&t instanceof C);var C;const O=l("HTMLFormElement"),P=(({hasOwnProperty:t})=>(e,i)=>t.call(e,i))(Object.prototype),I=l("RegExp"),D=(t,e)=>{const i=Object.getOwnPropertyDescriptors(t),n={};w(i,((i,r)=>{!1!==e(i,r,t)&&(n[r]=i)})),Object.defineProperties(t,n)},L="abcdefghijklmnopqrstuvwxyz",R="0123456789",B={DIGIT:R,ALPHA:L,ALPHA_DIGIT:L+L.toUpperCase()+R};var N={isArray:h,isArrayBuffer:d,isBuffer:function(t){return null!==t&&!u(t)&&null!==t.constructor&&!u(t.constructor)&&f(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{const e="[object FormData]";return t&&("function"==typeof FormData&&t instanceof FormData||r.call(t)===e||f(t.toString)&&t.toString()===e)},isArrayBufferView:function(t){let e;return e="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&d(t.buffer),e},isString:p,isNumber:m,isBoolean:t=>!0===t||!1===t,isObject:g,isPlainObject:v,isUndefined:u,isDate:y,isFile:_,isBlob:x,isRegExp:I,isFunction:f,isStream:t=>g(t)&&f(t.pipe),isURLSearchParams:b,isTypedArray:E,isFileList:M,forEach:w,merge:function t(){const{caseless:e}=A(this)&&this||{},i={},n=(n,r)=>{const s=e&&S(i,r)||r;v(i[s])&&v(n)?i[s]=t(i[s],n):v(n)?i[s]=t({},n):h(n)?i[s]=n.slice():i[s]=n};for(let t=0,e=arguments.length;t<e;t++)arguments[t]&&w(arguments[t],n);return i},extend:(t,e,i,{allOwnKeys:r}={})=>(w(e,((e,r)=>{i&&f(e)?t[r]=n(e,i):t[r]=e}),{allOwnKeys:r}),t),trim:t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(65279===t.charCodeAt(0)&&(t=t.slice(1)),t),inherits:(t,e,i,n)=>{t.prototype=Object.create(e.prototype,n),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),i&&Object.assign(t.prototype,i)},toFlatObject:(t,e,i,n)=>{let r,o,a;const l={};if(e=e||{},null==t)return e;do{for(r=Object.getOwnPropertyNames(t),o=r.length;o-- >0;)a=r[o],n&&!n(a,t,e)||l[a]||(e[a]=t[a],l[a]=!0);t=!1!==i&&s(t)}while(t&&(!i||i(t,e))&&t!==Object.prototype);return e},kindOf:o,kindOfTest:l,endsWith:(t,e,i)=>{t=String(t),(void 0===i||i>t.length)&&(i=t.length),i-=e.length;const n=t.indexOf(e,i);return-1!==n&&n===i},toArray:t=>{if(!t)return null;if(h(t))return t;let e=t.length;if(!m(e))return null;const i=new Array(e);for(;e-- >0;)i[e]=t[e];return i},forEachEntry:(t,e)=>{const i=(t&&t[Symbol.iterator]).call(t);let n;for(;(n=i.next())&&!n.done;){const i=n.value;e.call(t,i[0],i[1])}},matchAll:(t,e)=>{let i;const n=[];for(;null!==(i=t.exec(e));)n.push(i);return n},isHTMLForm:O,hasOwnProperty:P,hasOwnProp:P,reduceDescriptors:D,freezeMethods:t=>{D(t,((e,i)=>{if(f(t)&&-1!==["arguments","caller","callee"].indexOf(i))return!1;const n=t[i];f(n)&&(e.enumerable=!1,"writable"in e?e.writable=!1:e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))}))},toObjectSet:(t,e)=>{const i={},n=t=>{t.forEach((t=>{i[t]=!0}))};return h(t)?n(t):n(String(t).split(e)),i},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(t,e,i){return e.toUpperCase()+i})),noop:()=>{},toFiniteNumber:(t,e)=>(t=+t,Number.isFinite(t)?t:e),findKey:S,global:T,isContextDefined:A,ALPHABET:B,generateString:(t=16,e=B.ALPHA_DIGIT)=>{let i="";const{length:n}=e;for(;t--;)i+=e[Math.random()*n|0];return i},isSpecCompliantForm:function(t){return!!(t&&f(t.append)&&"FormData"===t[Symbol.toStringTag]&&t[Symbol.iterator])},toJSONObject:t=>{const e=new Array(10),i=(t,n)=>{if(g(t)){if(e.indexOf(t)>=0)return;if(!("toJSON"in t)){e[n]=t;const r=h(t)?[]:{};return w(t,((t,e)=>{const s=i(t,n+1);!u(s)&&(r[e]=s)})),e[n]=void 0,r}}return t};return i(t,0)}};function F(t,e,i,n,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=t,this.name="AxiosError",e&&(this.code=e),i&&(this.config=i),n&&(this.request=n),r&&(this.response=r)}N.inherits(F,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:N.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const U=F.prototype,G={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((t=>{G[t]={value:t}})),Object.defineProperties(F,G),Object.defineProperty(U,"isAxiosError",{value:!0}),F.from=(t,e,i,n,r,s)=>{const o=Object.create(U);return N.toFlatObject(t,o,(function(t){return t!==Error.prototype}),(t=>"isAxiosError"!==t)),F.call(o,t.message,e,i,n,r),o.cause=t,o.name=t.name,s&&Object.assign(o,s),o};function z(t){return N.isPlainObject(t)||N.isArray(t)}function k(t){return N.endsWith(t,"[]")?t.slice(0,-2):t}function j(t,e,i){return t?t.concat(e).map((function(t,e){return t=k(t),!i&&e?"["+t+"]":t})).join(i?".":""):e}const H=N.toFlatObject(N,{},null,(function(t){return/^is[A-Z]/.test(t)}));function V(t,e,i){if(!N.isObject(t))throw new TypeError("target must be an object");e=e||new FormData;const n=(i=N.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(t,e){return!N.isUndefined(e[t])}))).metaTokens,r=i.visitor||c,s=i.dots,o=i.indexes,a=(i.Blob||"undefined"!=typeof Blob&&Blob)&&N.isSpecCompliantForm(e);if(!N.isFunction(r))throw new TypeError("visitor must be a function");function l(t){if(null===t)return"";if(N.isDate(t))return t.toISOString();if(!a&&N.isBlob(t))throw new F("Blob is not supported. Use a Buffer instead.");return N.isArrayBuffer(t)||N.isTypedArray(t)?a&&"function"==typeof Blob?new Blob([t]):Buffer.from(t):t}function c(t,i,r){let a=t;if(t&&!r&&"object"==typeof t)if(N.endsWith(i,"{}"))i=n?i:i.slice(0,-2),t=JSON.stringify(t);else if(N.isArray(t)&&function(t){return N.isArray(t)&&!t.some(z)}(t)||(N.isFileList(t)||N.endsWith(i,"[]"))&&(a=N.toArray(t)))return i=k(i),a.forEach((function(t,n){!N.isUndefined(t)&&null!==t&&e.append(!0===o?j([i],n,s):null===o?i:i+"[]",l(t))})),!1;return!!z(t)||(e.append(j(r,i,s),l(t)),!1)}const h=[],u=Object.assign(H,{defaultVisitor:c,convertValue:l,isVisitable:z});if(!N.isObject(t))throw new TypeError("data must be an object");return function t(i,n){if(!N.isUndefined(i)){if(-1!==h.indexOf(i))throw Error("Circular reference detected in "+n.join("."));h.push(i),N.forEach(i,(function(i,s){!0===(!(N.isUndefined(i)||null===i)&&r.call(e,i,N.isString(s)?s.trim():s,n,u))&&t(i,n?n.concat(s):[s])})),h.pop()}}(t),e}function W(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,(function(t){return e[t]}))}function q(t,e){this._pairs=[],t&&V(t,this,e)}const J=q.prototype;function X(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Y(t,e,i){if(!e)return t;const n=i&&i.encode||X,r=i&&i.serialize;let s;if(s=r?r(e,i):N.isURLSearchParams(e)?e.toString():new q(e,i).toString(n),s){const e=t.indexOf("#");-1!==e&&(t=t.slice(0,e)),t+=(-1===t.indexOf("?")?"?":"&")+s}return t}J.append=function(t,e){this._pairs.push([t,e])},J.toString=function(t){const e=t?function(e){return t.call(this,e,W)}:W;return this._pairs.map((function(t){return e(t[0])+"="+e(t[1])}),"").join("&")};var Z=class{constructor(){this.handlers=[]}use(t,e,i){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){N.forEach(this.handlers,(function(e){null!==e&&t(e)}))}},K={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};var Q={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:q,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},isStandardBrowserEnv:(()=>{let t;return("undefined"==typeof navigator||"ReactNative"!==(t=navigator.product)&&"NativeScript"!==t&&"NS"!==t)&&("undefined"!=typeof window&&"undefined"!=typeof document)})(),isStandardBrowserWebWorkerEnv:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,protocols:["http","https","file","blob","url","data"]};function $(t){function e(t,i,n,r){let s=t[r++];const o=Number.isFinite(+s),a=r>=t.length;if(s=!s&&N.isArray(n)?n.length:s,a)return N.hasOwnProp(n,s)?n[s]=[n[s],i]:n[s]=i,!o;n[s]&&N.isObject(n[s])||(n[s]=[]);return e(t,i,n[s],r)&&N.isArray(n[s])&&(n[s]=function(t){const e={},i=Object.keys(t);let n;const r=i.length;let s;for(n=0;n<r;n++)s=i[n],e[s]=t[s];return e}(n[s])),!o}if(N.isFormData(t)&&N.isFunction(t.entries)){const i={};return N.forEachEntry(t,((t,n)=>{e(function(t){return N.matchAll(/\w+|\[(\w*)]/g,t).map((t=>"[]"===t[0]?"":t[1]||t[0]))}(t),n,i,0)})),i}return null}const tt={"Content-Type":void 0};const et={transitional:K,adapter:["xhr","http"],transformRequest:[function(t,e){const i=e.getContentType()||"",n=i.indexOf("application/json")>-1,r=N.isObject(t);r&&N.isHTMLForm(t)&&(t=new FormData(t));if(N.isFormData(t))return n&&n?JSON.stringify($(t)):t;if(N.isArrayBuffer(t)||N.isBuffer(t)||N.isStream(t)||N.isFile(t)||N.isBlob(t))return t;if(N.isArrayBufferView(t))return t.buffer;if(N.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let s;if(r){if(i.indexOf("application/x-www-form-urlencoded")>-1)return function(t,e){return V(t,new Q.classes.URLSearchParams,Object.assign({visitor:function(t,e,i,n){return Q.isNode&&N.isBuffer(t)?(this.append(e,t.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},e))}(t,this.formSerializer).toString();if((s=N.isFileList(t))||i.indexOf("multipart/form-data")>-1){const e=this.env&&this.env.FormData;return V(s?{"files[]":t}:t,e&&new e,this.formSerializer)}}return r||n?(e.setContentType("application/json",!1),function(t,e,i){if(N.isString(t))try{return(e||JSON.parse)(t),N.trim(t)}catch(t){if("SyntaxError"!==t.name)throw t}return(i||JSON.stringify)(t)}(t)):t}],transformResponse:[function(t){const e=this.transitional||et.transitional,i=e&&e.forcedJSONParsing,n="json"===this.responseType;if(t&&N.isString(t)&&(i&&!this.responseType||n)){const i=!(e&&e.silentJSONParsing)&&n;try{return JSON.parse(t)}catch(t){if(i){if("SyntaxError"===t.name)throw F.from(t,F.ERR_BAD_RESPONSE,this,null,this.response);throw t}}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Q.classes.FormData,Blob:Q.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};N.forEach(["delete","get","head"],(function(t){et.headers[t]={}})),N.forEach(["post","put","patch"],(function(t){et.headers[t]=N.merge(tt)}));var it=et;const nt=N.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]);const rt=Symbol("internals");function st(t){return t&&String(t).trim().toLowerCase()}function ot(t){return!1===t||null==t?t:N.isArray(t)?t.map(ot):String(t)}function at(t,e,i,n,r){return N.isFunction(n)?n.call(this,e,i):(r&&(e=i),N.isString(e)?N.isString(n)?-1!==e.indexOf(n):N.isRegExp(n)?n.test(e):void 0:void 0)}class lt{constructor(t){t&&this.set(t)}set(t,e,i){const n=this;function r(t,e,i){const r=st(e);if(!r)throw new Error("header name must be a non-empty string");const s=N.findKey(n,r);(!s||void 0===n[s]||!0===i||void 0===i&&!1!==n[s])&&(n[s||e]=ot(t))}const s=(t,e)=>N.forEach(t,((t,i)=>r(t,i,e)));return N.isPlainObject(t)||t instanceof this.constructor?s(t,e):N.isString(t)&&(t=t.trim())&&!/^[-_a-zA-Z]+$/.test(t.trim())?s((t=>{const e={};let i,n,r;return t&&t.split("\n").forEach((function(t){r=t.indexOf(":"),i=t.substring(0,r).trim().toLowerCase(),n=t.substring(r+1).trim(),!i||e[i]&&nt[i]||("set-cookie"===i?e[i]?e[i].push(n):e[i]=[n]:e[i]=e[i]?e[i]+", "+n:n)})),e})(t),e):null!=t&&r(e,t,i),this}get(t,e){if(t=st(t)){const i=N.findKey(this,t);if(i){const t=this[i];if(!e)return t;if(!0===e)return function(t){const e=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=i.exec(t);)e[n[1]]=n[2];return e}(t);if(N.isFunction(e))return e.call(this,t,i);if(N.isRegExp(e))return e.exec(t);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=st(t)){const i=N.findKey(this,t);return!(!i||void 0===this[i]||e&&!at(0,this[i],i,e))}return!1}delete(t,e){const i=this;let n=!1;function r(t){if(t=st(t)){const r=N.findKey(i,t);!r||e&&!at(0,i[r],r,e)||(delete i[r],n=!0)}}return N.isArray(t)?t.forEach(r):r(t),n}clear(t){const e=Object.keys(this);let i=e.length,n=!1;for(;i--;){const r=e[i];t&&!at(0,this[r],r,t,!0)||(delete this[r],n=!0)}return n}normalize(t){const e=this,i={};return N.forEach(this,((n,r)=>{const s=N.findKey(i,r);if(s)return e[s]=ot(n),void delete e[r];const o=t?function(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((t,e,i)=>e.toUpperCase()+i))}(r):String(r).trim();o!==r&&delete e[r],e[o]=ot(n),i[o]=!0})),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const e=Object.create(null);return N.forEach(this,((i,n)=>{null!=i&&!1!==i&&(e[n]=t&&N.isArray(i)?i.join(", "):i)})),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((([t,e])=>t+": "+e)).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){const i=new this(t);return e.forEach((t=>i.set(t))),i}static accessor(t){const e=(this[rt]=this[rt]={accessors:{}}).accessors,i=this.prototype;function n(t){const n=st(t);e[n]||(!function(t,e){const i=N.toCamelCase(" "+e);["get","set","has"].forEach((n=>{Object.defineProperty(t,n+i,{value:function(t,i,r){return this[n].call(this,e,t,i,r)},configurable:!0})}))}(i,t),e[n]=!0)}return N.isArray(t)?t.forEach(n):n(t),this}}lt.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),N.freezeMethods(lt.prototype),N.freezeMethods(lt);var ct=lt;function ht(t,e){const i=this||it,n=e||i,r=ct.from(n.headers);let s=n.data;return N.forEach(t,(function(t){s=t.call(i,s,r.normalize(),e?e.status:void 0)})),r.normalize(),s}function ut(t){return!(!t||!t.__CANCEL__)}function dt(t,e,i){F.call(this,null==t?"canceled":t,F.ERR_CANCELED,e,i),this.name="CanceledError"}N.inherits(dt,F,{__CANCEL__:!0});var pt=Q.isStandardBrowserEnv?{write:function(t,e,i,n,r,s){const o=[];o.push(t+"="+encodeURIComponent(e)),N.isNumber(i)&&o.push("expires="+new Date(i).toGMTString()),N.isString(n)&&o.push("path="+n),N.isString(r)&&o.push("domain="+r),!0===s&&o.push("secure"),document.cookie=o.join("; ")},read:function(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}};function ft(t,e){return t&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)?function(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}(t,e):e}var mt=Q.isStandardBrowserEnv?function(){const t=/(msie|trident)/i.test(navigator.userAgent),e=document.createElement("a");let i;function n(i){let n=i;return t&&(e.setAttribute("href",n),n=e.href),e.setAttribute("href",n),{href:e.href,protocol:e.protocol?e.protocol.replace(/:$/,""):"",host:e.host,search:e.search?e.search.replace(/^\?/,""):"",hash:e.hash?e.hash.replace(/^#/,""):"",hostname:e.hostname,port:e.port,pathname:"/"===e.pathname.charAt(0)?e.pathname:"/"+e.pathname}}return i=n(window.location.href),function(t){const e=N.isString(t)?n(t):t;return e.protocol===i.protocol&&e.host===i.host}}():function(){return!0};function gt(t,e){let i=0;const n=function(t,e){t=t||10;const i=new Array(t),n=new Array(t);let r,s=0,o=0;return e=void 0!==e?e:1e3,function(a){const l=Date.now(),c=n[o];r||(r=l),i[s]=a,n[s]=l;let h=o,u=0;for(;h!==s;)u+=i[h++],h%=t;if(s=(s+1)%t,s===o&&(o=(o+1)%t),l-r<e)return;const d=c&&l-c;return d?Math.round(1e3*u/d):void 0}}(50,250);return r=>{const s=r.loaded,o=r.lengthComputable?r.total:void 0,a=s-i,l=n(a);i=s;const c={loaded:s,total:o,progress:o?s/o:void 0,bytes:a,rate:l||void 0,estimated:l&&o&&s<=o?(o-s)/l:void 0,event:r};c[e?"download":"upload"]=!0,t(c)}}const vt={http:null,xhr:"undefined"!=typeof XMLHttpRequest&&function(t){return new Promise((function(e,i){let n=t.data;const r=ct.from(t.headers).normalize(),s=t.responseType;let o;function a(){t.cancelToken&&t.cancelToken.unsubscribe(o),t.signal&&t.signal.removeEventListener("abort",o)}N.isFormData(n)&&(Q.isStandardBrowserEnv||Q.isStandardBrowserWebWorkerEnv)&&r.setContentType(!1);let l=new XMLHttpRequest;if(t.auth){const e=t.auth.username||"",i=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";r.set("Authorization","Basic "+btoa(e+":"+i))}const c=ft(t.baseURL,t.url);function h(){if(!l)return;const n=ct.from("getAllResponseHeaders"in l&&l.getAllResponseHeaders());!function(t,e,i){const n=i.config.validateStatus;i.status&&n&&!n(i.status)?e(new F("Request failed with status code "+i.status,[F.ERR_BAD_REQUEST,F.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):t(i)}((function(t){e(t),a()}),(function(t){i(t),a()}),{data:s&&"text"!==s&&"json"!==s?l.response:l.responseText,status:l.status,statusText:l.statusText,headers:n,config:t,request:l}),l=null}if(l.open(t.method.toUpperCase(),Y(c,t.params,t.paramsSerializer),!0),l.timeout=t.timeout,"onloadend"in l?l.onloadend=h:l.onreadystatechange=function(){l&&4===l.readyState&&(0!==l.status||l.responseURL&&0===l.responseURL.indexOf("file:"))&&setTimeout(h)},l.onabort=function(){l&&(i(new F("Request aborted",F.ECONNABORTED,t,l)),l=null)},l.onerror=function(){i(new F("Network Error",F.ERR_NETWORK,t,l)),l=null},l.ontimeout=function(){let e=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded";const n=t.transitional||K;t.timeoutErrorMessage&&(e=t.timeoutErrorMessage),i(new F(e,n.clarifyTimeoutError?F.ETIMEDOUT:F.ECONNABORTED,t,l)),l=null},Q.isStandardBrowserEnv){const e=(t.withCredentials||mt(c))&&t.xsrfCookieName&&pt.read(t.xsrfCookieName);e&&r.set(t.xsrfHeaderName,e)}void 0===n&&r.setContentType(null),"setRequestHeader"in l&&N.forEach(r.toJSON(),(function(t,e){l.setRequestHeader(e,t)})),N.isUndefined(t.withCredentials)||(l.withCredentials=!!t.withCredentials),s&&"json"!==s&&(l.responseType=t.responseType),"function"==typeof t.onDownloadProgress&&l.addEventListener("progress",gt(t.onDownloadProgress,!0)),"function"==typeof t.onUploadProgress&&l.upload&&l.upload.addEventListener("progress",gt(t.onUploadProgress)),(t.cancelToken||t.signal)&&(o=e=>{l&&(i(!e||e.type?new dt(null,t,l):e),l.abort(),l=null)},t.cancelToken&&t.cancelToken.subscribe(o),t.signal&&(t.signal.aborted?o():t.signal.addEventListener("abort",o)));const u=function(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}(c);u&&-1===Q.protocols.indexOf(u)?i(new F("Unsupported protocol "+u+":",F.ERR_BAD_REQUEST,t)):l.send(n||null)}))}};N.forEach(vt,((t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch(t){}Object.defineProperty(t,"adapterName",{value:e})}}));var yt=t=>{t=N.isArray(t)?t:[t];const{length:e}=t;let i,n;for(let r=0;r<e&&(i=t[r],!(n=N.isString(i)?vt[i.toLowerCase()]:i));r++);if(!n){if(!1===n)throw new F(`Adapter ${i} is not supported by the environment`,"ERR_NOT_SUPPORT");throw new Error(N.hasOwnProp(vt,i)?`Adapter '${i}' is not available in the build`:`Unknown adapter '${i}'`)}if(!N.isFunction(n))throw new TypeError("adapter is not a function");return n};function _t(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new dt(null,t)}function xt(t){_t(t),t.headers=ct.from(t.headers),t.data=ht.call(t,t.transformRequest),-1!==["post","put","patch"].indexOf(t.method)&&t.headers.setContentType("application/x-www-form-urlencoded",!1);return yt(t.adapter||it.adapter)(t).then((function(e){return _t(t),e.data=ht.call(t,t.transformResponse,e),e.headers=ct.from(e.headers),e}),(function(e){return ut(e)||(_t(t),e&&e.response&&(e.response.data=ht.call(t,t.transformResponse,e.response),e.response.headers=ct.from(e.response.headers))),Promise.reject(e)}))}const Mt=t=>t instanceof ct?t.toJSON():t;function bt(t,e){e=e||{};const i={};function n(t,e,i){return N.isPlainObject(t)&&N.isPlainObject(e)?N.merge.call({caseless:i},t,e):N.isPlainObject(e)?N.merge({},e):N.isArray(e)?e.slice():e}function r(t,e,i){return N.isUndefined(e)?N.isUndefined(t)?void 0:n(void 0,t,i):n(t,e,i)}function s(t,e){if(!N.isUndefined(e))return n(void 0,e)}function o(t,e){return N.isUndefined(e)?N.isUndefined(t)?void 0:n(void 0,t):n(void 0,e)}function a(i,r,s){return s in e?n(i,r):s in t?n(void 0,i):void 0}const l={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(t,e)=>r(Mt(t),Mt(e),!0)};return N.forEach(Object.keys(t).concat(Object.keys(e)),(function(n){const s=l[n]||r,o=s(t[n],e[n],n);N.isUndefined(o)&&s!==a||(i[n]=o)})),i}const wt="1.3.4",St={};["object","boolean","number","function","string","symbol"].forEach(((t,e)=>{St[t]=function(i){return typeof i===t||"a"+(e<1?"n ":" ")+t}}));const Tt={};St.transitional=function(t,e,i){function n(t,e){return"[Axios v1.3.4] Transitional option '"+t+"'"+e+(i?". "+i:"")}return(i,r,s)=>{if(!1===t)throw new F(n(r," has been removed"+(e?" in "+e:"")),F.ERR_DEPRECATED);return e&&!Tt[r]&&(Tt[r]=!0,n(r," has been deprecated since v"+e+" and will be removed in the near future")),!t||t(i,r,s)}};var At={assertOptions:function(t,e,i){if("object"!=typeof t)throw new F("options must be an object",F.ERR_BAD_OPTION_VALUE);const n=Object.keys(t);let r=n.length;for(;r-- >0;){const s=n[r],o=e[s];if(o){const e=t[s],i=void 0===e||o(e,s,t);if(!0!==i)throw new F("option "+s+" must be "+i,F.ERR_BAD_OPTION_VALUE)}else if(!0!==i)throw new F("Unknown option "+s,F.ERR_BAD_OPTION)}},validators:St};const Et=At.validators;class Ct{constructor(t){this.defaults=t,this.interceptors={request:new Z,response:new Z}}request(t,e){"string"==typeof t?(e=e||{}).url=t:e=t||{},e=bt(this.defaults,e);const{transitional:i,paramsSerializer:n,headers:r}=e;let s;void 0!==i&&At.assertOptions(i,{silentJSONParsing:Et.transitional(Et.boolean),forcedJSONParsing:Et.transitional(Et.boolean),clarifyTimeoutError:Et.transitional(Et.boolean)},!1),void 0!==n&&At.assertOptions(n,{encode:Et.function,serialize:Et.function},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase(),s=r&&N.merge(r.common,r[e.method]),s&&N.forEach(["delete","get","head","post","put","patch","common"],(t=>{delete r[t]})),e.headers=ct.concat(s,r);const o=[];let a=!0;this.interceptors.request.forEach((function(t){"function"==typeof t.runWhen&&!1===t.runWhen(e)||(a=a&&t.synchronous,o.unshift(t.fulfilled,t.rejected))}));const l=[];let c;this.interceptors.response.forEach((function(t){l.push(t.fulfilled,t.rejected)}));let h,u=0;if(!a){const t=[xt.bind(this),void 0];for(t.unshift.apply(t,o),t.push.apply(t,l),h=t.length,c=Promise.resolve(e);u<h;)c=c.then(t[u++],t[u++]);return c}h=o.length;let d=e;for(u=0;u<h;){const t=o[u++],e=o[u++];try{d=t(d)}catch(t){e.call(this,t);break}}try{c=xt.call(this,d)}catch(t){return Promise.reject(t)}for(u=0,h=l.length;u<h;)c=c.then(l[u++],l[u++]);return c}getUri(t){return Y(ft((t=bt(this.defaults,t)).baseURL,t.url),t.params,t.paramsSerializer)}}N.forEach(["delete","get","head","options"],(function(t){Ct.prototype[t]=function(e,i){return this.request(bt(i||{},{method:t,url:e,data:(i||{}).data}))}})),N.forEach(["post","put","patch"],(function(t){function e(e){return function(i,n,r){return this.request(bt(r||{},{method:t,headers:e?{"Content-Type":"multipart/form-data"}:{},url:i,data:n}))}}Ct.prototype[t]=e(),Ct.prototype[t+"Form"]=e(!0)}));var Ot=Ct;class Pt{constructor(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");let e;this.promise=new Promise((function(t){e=t}));const i=this;this.promise.then((t=>{if(!i._listeners)return;let e=i._listeners.length;for(;e-- >0;)i._listeners[e](t);i._listeners=null})),this.promise.then=t=>{let e;const n=new Promise((t=>{i.subscribe(t),e=t})).then(t);return n.cancel=function(){i.unsubscribe(e)},n},t((function(t,n,r){i.reason||(i.reason=new dt(t,n,r),e(i.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);-1!==e&&this._listeners.splice(e,1)}static source(){let t;return{token:new Pt((function(e){t=e})),cancel:t}}}var It=Pt;const Dt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Dt).forEach((([t,e])=>{Dt[e]=t}));var Lt=Dt;const Rt=function t(e){const i=new Ot(e),r=n(Ot.prototype.request,i);return N.extend(r,Ot.prototype,i,{allOwnKeys:!0}),N.extend(r,i,null,{allOwnKeys:!0}),r.create=function(i){return t(bt(e,i))},r}(it);Rt.Axios=Ot,Rt.CanceledError=dt,Rt.CancelToken=It,Rt.isCancel=ut,Rt.VERSION=wt,Rt.toFormData=V,Rt.AxiosError=F,Rt.Cancel=Rt.CanceledError,Rt.all=function(t){return Promise.all(t)},Rt.spread=function(t){return function(e){return t.apply(null,e)}},Rt.isAxiosError=function(t){return N.isObject(t)&&!0===t.isAxiosError},Rt.mergeConfig=bt,Rt.AxiosHeaders=ct,Rt.formToJSON=t=>$(N.isHTMLForm(t)?new FormData(t):t),Rt.HttpStatusCode=Lt,Rt.default=Rt,t.exports=Rt},5232:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i="138",n=100,r=300,s=301,o=302,a=303,l=304,c=306,h=307,u=1e3,d=1001,p=1002,f=1003,m=1004,g=1005,v=1006,y=1007,_=1008,x=1009,M=1012,b=1014,w=1015,S=1016,T=1020,A=1023,E=1026,C=1027,O=33776,P=33777,I=33778,D=33779,L=35840,R=35841,B=35842,N=35843,F=37492,U=37496,G=37808,z=37809,k=37810,j=37811,H=37812,V=37813,W=37814,q=37815,J=37816,X=37817,Y=37818,Z=37819,K=37820,Q=37821,$=36492,tt=2300,et=2301,it=2302,nt=2400,rt=2401,st=2402,ot=2500,at=2501,lt=3e3,ct=3001,ht=7680,ut=35044,dt=35048,pt="300 es",ft=1035;class mt{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const i=this._listeners[t];if(void 0!==i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const i=e.slice(0);for(let e=0,n=i.length;e<n;e++)i[e].call(this,t);t.target=null}}}const gt=[];for(let t=0;t<256;t++)gt[t]=(t<16?"0":"")+t.toString(16);let vt=1234567;const yt=Math.PI/180,_t=180/Math.PI;function xt(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(gt[255&t]+gt[t>>8&255]+gt[t>>16&255]+gt[t>>24&255]+"-"+gt[255&e]+gt[e>>8&255]+"-"+gt[e>>16&15|64]+gt[e>>24&255]+"-"+gt[63&i|128]+gt[i>>8&255]+"-"+gt[i>>16&255]+gt[i>>24&255]+gt[255&n]+gt[n>>8&255]+gt[n>>16&255]+gt[n>>24&255]).toUpperCase()}function Mt(t,e,i){return Math.max(e,Math.min(i,t))}function bt(t,e){return(t%e+e)%e}function wt(t,e,i){return(1-i)*t+i*e}function St(t){return 0==(t&t-1)&&0!==t}function Tt(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function At(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}var Et=Object.freeze({__proto__:null,DEG2RAD:yt,RAD2DEG:_t,generateUUID:xt,clamp:Mt,euclideanModulo:bt,mapLinear:function(t,e,i,n,r){return n+(t-e)*(r-n)/(i-e)},inverseLerp:function(t,e,i){return t!==e?(i-t)/(e-t):0},lerp:wt,damp:function(t,e,i,n){return wt(t,e,1-Math.exp(-i*n))},pingpong:function(t,e=1){return e-Math.abs(bt(t,2*e)-e)},smoothstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*(3-2*t)},smootherstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){return void 0!==t&&(vt=t%2147483647),vt=16807*vt%2147483647,(vt-1)/2147483646},degToRad:function(t){return t*yt},radToDeg:function(t){return t*_t},isPowerOfTwo:St,ceilPowerOfTwo:Tt,floorPowerOfTwo:At,setQuaternionFromProperEuler:function(t,e,i,n,r){const s=Math.cos,o=Math.sin,a=s(i/2),l=o(i/2),c=s((e+n)/2),h=o((e+n)/2),u=s((e-n)/2),d=o((e-n)/2),p=s((n-e)/2),f=o((n-e)/2);switch(r){case"XYX":t.set(a*h,l*u,l*d,a*c);break;case"YZY":t.set(l*d,a*h,l*u,a*c);break;case"ZXZ":t.set(l*u,l*d,a*h,a*c);break;case"XZX":t.set(a*h,l*f,l*p,a*c);break;case"YXY":t.set(l*p,a*h,l*f,a*c);break;case"ZYZ":t.set(l*f,l*p,a*h,a*c)}}});class Ct{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?this.addVectors(t,e):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?this.subVectors(t,e):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,i){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),n=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*i-s*n+t.x,this.y=r*n+s*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}Ct.prototype.isVector2=!0;class Ot{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,n,r,s,o,a,l){const c=this.elements;return c[0]=t,c[1]=n,c[2]=o,c[3]=e,c[4]=r,c[5]=a,c[6]=i,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,r=this.elements,s=i[0],o=i[3],a=i[6],l=i[1],c=i[4],h=i[7],u=i[2],d=i[5],p=i[8],f=n[0],m=n[3],g=n[6],v=n[1],y=n[4],_=n[7],x=n[2],M=n[5],b=n[8];return r[0]=s*f+o*v+a*x,r[3]=s*m+o*y+a*M,r[6]=s*g+o*_+a*b,r[1]=l*f+c*v+h*x,r[4]=l*m+c*y+h*M,r[7]=l*g+c*_+h*b,r[2]=u*f+d*v+p*x,r[5]=u*m+d*y+p*M,r[8]=u*g+d*_+p*b,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*s*c-e*o*l-i*r*c+i*o*a+n*r*l-n*s*a}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=c*s-o*l,u=o*a-c*r,d=l*r-s*a,p=e*h+i*u+n*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=h*f,t[1]=(n*l-c*i)*f,t[2]=(o*i-n*s)*f,t[3]=u*f,t[4]=(c*e-n*a)*f,t[5]=(n*r-o*e)*f,t[6]=d*f,t[7]=(i*a-l*e)*f,t[8]=(s*e-i*r)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,n,r,s,o){const a=Math.cos(r),l=Math.sin(r);return this.set(i*a,i*l,-i*(a*s+l*o)+s+t,-n*l,n*a,-n*(-l*s+a*o)+o+e,0,0,1),this}scale(t,e){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.elements,r=n[0],s=n[3],o=n[6],a=n[1],l=n[4],c=n[7];return n[0]=e*r+i*a,n[3]=e*s+i*l,n[6]=e*o+i*c,n[1]=-i*r+e*a,n[4]=-i*s+e*l,n[7]=-i*o+e*c,this}translate(t,e){const i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<9;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}function Pt(t){for(let e=t.length-1;e>=0;--e)if(t[e]>65535)return!0;return!1}Ot.prototype.isMatrix3=!0;const It={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Dt(t,e){return new It[t](e)}function Lt(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}const Rt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Bt={h:0,s:0,l:0},Nt={h:0,s:0,l:0};function Ft(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}function Ut(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Gt(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}class zt{constructor(t,e,i){return void 0===e&&void 0===i?this.set(t):this.setRGB(t,e,i)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}setRGB(t,e,i){return this.r=t,this.g=e,this.b=i,this}setHSL(t,e,i){if(t=bt(t,1),e=Mt(e,0,1),i=Mt(i,0,1),0===e)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+e):i+e-i*e,r=2*i-n;this.r=Ft(r,n,t+1/3),this.g=Ft(r,n,t),this.b=Ft(r,n,t-1/3)}return this}setStyle(t){function e(t){void 0!==t&&parseFloat(t)}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t;const n=i[1],r=i[2];switch(n){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,e(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,e(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r)){const i=parseFloat(t[1])/360,n=parseInt(t[2],10)/100,r=parseInt(t[3],10)/100;return e(t[4]),this.setHSL(i,n,r)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=i[1],e=t.length;if(3===e)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,this;if(6===e)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}setColorName(t){const e=Rt[t.toLowerCase()];return void 0!==e&&this.setHex(e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Ut(t.r),this.g=Ut(t.g),this.b=Ut(t.b),this}copyLinearToSRGB(t){return this.r=Gt(t.r),this.g=Gt(t.g),this.b=Gt(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){const e=this.r,i=this.g,n=this.b,r=Math.max(e,i,n),s=Math.min(e,i,n);let o,a;const l=(s+r)/2;if(s===r)o=0,a=0;else{const t=r-s;switch(a=l<=.5?t/(r+s):t/(2-r-s),r){case e:o=(i-n)/t+(i<n?6:0);break;case i:o=(n-e)/t+2;break;case n:o=(e-i)/t+4}o/=6}return t.h=o,t.s=a,t.l=l,t}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(t,e,i){return this.getHSL(Bt),Bt.h+=t,Bt.s+=e,Bt.l+=i,this.setHSL(Bt.h,Bt.s,Bt.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(Bt),t.getHSL(Nt);const i=wt(Bt.h,Nt.h,e),n=wt(Bt.s,Nt.s,e),r=wt(Bt.l,Nt.l,e);return this.setHSL(i,n,r),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}let kt;zt.NAMES=Rt,zt.prototype.isColor=!0,zt.prototype.r=1,zt.prototype.g=1,zt.prototype.b=1;class jt{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===kt&&(kt=Lt("canvas")),kt.width=t.width,kt.height=t.height;const i=kt.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=kt}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=Lt("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const n=i.getImageData(0,0,t.width,t.height),r=n.data;for(let t=0;t<r.length;t++)r[t]=255*Ut(r[t]/255);return i.putImageData(n,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*Ut(e[t]/255)):e[t]=Ut(e[t]);return{data:e,width:t.width,height:t.height}}return t}}class Ht{constructor(t=null){this.uuid=xt(),this.data=t,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(null!==n){let t;if(Array.isArray(n)){t=[];for(let e=0,i=n.length;e<i;e++)n[e].isDataTexture?t.push(Vt(n[e].image)):t.push(Vt(n[e]))}else t=Vt(n);i.url=t}return e||(t.images[this.uuid]=i),i}}function Vt(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?jt.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:{}}Ht.prototype.isSource=!0;let Wt=0;class qt extends mt{constructor(t=qt.DEFAULT_IMAGE,e=qt.DEFAULT_MAPPING,i=1001,n=1001,r=1006,s=1008,o=1023,a=1009,l=1,c=3e3){super(),Object.defineProperty(this,"id",{value:Wt++}),this.uuid=xt(),this.name="",this.source=new Ht(t),this.mipmaps=[],this.mapping=e,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new Ct(0,0),this.repeat=new Ct(1,1),this.center=new Ct(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ot,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==r)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case u:t.x=t.x-Math.floor(t.x);break;case d:t.x=t.x<0?0:1;break;case p:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case u:t.y=t.y-Math.floor(t.y);break;case d:t.y=t.y<0?0:1;break;case p:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}}qt.DEFAULT_IMAGE=null,qt.DEFAULT_MAPPING=r,qt.prototype.isTexture=!0;class Jt{constructor(t=0,e=0,i=0,n=1){this.x=t,this.y=e,this.z=i,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?this.addVectors(t,e):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?this.subVectors(t,e):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,r=this.w,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*n+s[12]*r,this.y=s[1]*e+s[5]*i+s[9]*n+s[13]*r,this.z=s[2]*e+s[6]*i+s[10]*n+s[14]*r,this.w=s[3]*e+s[7]*i+s[11]*n+s[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,n,r;const s=.01,o=.1,a=t.elements,l=a[0],c=a[4],h=a[8],u=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(c-u)<s&&Math.abs(h-f)<s&&Math.abs(p-m)<s){if(Math.abs(c+u)<o&&Math.abs(h+f)<o&&Math.abs(p+m)<o&&Math.abs(l+d+g-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,a=(d+1)/2,v=(g+1)/2,y=(c+u)/4,_=(h+f)/4,x=(p+m)/4;return t>a&&t>v?t<s?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(t),n=y/i,r=_/i):a>v?a<s?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(a),i=y/n,r=x/n):v<s?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(v),i=_/r,n=x/r),this.set(i,n,r,e),this}let v=Math.sqrt((m-p)*(m-p)+(h-f)*(h-f)+(u-c)*(u-c));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(h-f)/v,this.z=(u-c)/v,this.w=Math.acos((l+d+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,i){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}Jt.prototype.isVector4=!0;class Xt extends mt{constructor(t,e,i={}){super(),this.width=t,this.height=e,this.depth=1,this.scissor=new Jt(0,0,t,e),this.scissorTest=!1,this.viewport=new Jt(0,0,t,e);const n={width:t,height:e,depth:1};this.texture=new qt(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:v,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,this.samples=void 0!==i.samples?i.samples:0}setSize(t,e,i=1){this.width===t&&this.height===e&&this.depth===i||(this.width=t,this.height=e,this.depth=i,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.image=Object.assign({},t.texture.image),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}Xt.prototype.isWebGLRenderTarget=!0;class Yt extends qt{constructor(t=null,e=1,i=1,n=1){super(null),this.image={data:t,width:e,height:i,depth:n},this.magFilter=f,this.minFilter=f,this.wrapR=d,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Yt.prototype.isDataArrayTexture=!0;class Zt extends Xt{constructor(t,e,i){super(t,e),this.depth=i,this.texture=new Yt(null,t,e,i),this.texture.isRenderTargetTexture=!0}}Zt.prototype.isWebGLArrayRenderTarget=!0;class Kt extends qt{constructor(t=null,e=1,i=1,n=1){super(null),this.image={data:t,width:e,height:i,depth:n},this.magFilter=f,this.minFilter=f,this.wrapR=d,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Kt.prototype.isData3DTexture=!0;class Qt extends Xt{constructor(t,e,i){super(t,e),this.depth=i,this.texture=new Kt(null,t,e,i),this.texture.isRenderTargetTexture=!0}}Qt.prototype.isWebGL3DRenderTarget=!0;class $t extends Xt{constructor(t,e,i,n={}){super(t,e,n);const r=this.texture;this.texture=[];for(let t=0;t<i;t++)this.texture[t]=r.clone(),this.texture[t].isRenderTargetTexture=!0}setSize(t,e,i=1){if(this.width!==t||this.height!==e||this.depth!==i){this.width=t,this.height=e,this.depth=i;for(let n=0,r=this.texture.length;n<r;n++)this.texture[n].image.width=t,this.texture[n].image.height=e,this.texture[n].image.depth=i;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this.texture.length=0;for(let e=0,i=t.texture.length;e<i;e++)this.texture[e]=t.texture[e].clone();return this}}$t.prototype.isWebGLMultipleRenderTargets=!0;class te{constructor(t=0,e=0,i=0,n=1){this._x=t,this._y=e,this._z=i,this._w=n}static slerp(t,e,i,n){return i.slerpQuaternions(t,e,n)}static slerpFlat(t,e,i,n,r,s,o){let a=i[n+0],l=i[n+1],c=i[n+2],h=i[n+3];const u=r[s+0],d=r[s+1],p=r[s+2],f=r[s+3];if(0===o)return t[e+0]=a,t[e+1]=l,t[e+2]=c,void(t[e+3]=h);if(1===o)return t[e+0]=u,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(h!==f||a!==u||l!==d||c!==p){let t=1-o;const e=a*u+l*d+c*p+h*f,i=e>=0?1:-1,n=1-e*e;if(n>Number.EPSILON){const r=Math.sqrt(n),s=Math.atan2(r,e*i);t=Math.sin(t*s)/r,o=Math.sin(o*s)/r}const r=o*i;if(a=a*t+u*r,l=l*t+d*r,c=c*t+p*r,h=h*t+f*r,t===1-o){const t=1/Math.sqrt(a*a+l*l+c*c+h*h);a*=t,l*=t,c*=t,h*=t}}t[e]=a,t[e+1]=l,t[e+2]=c,t[e+3]=h}static multiplyQuaternionsFlat(t,e,i,n,r,s){const o=i[n],a=i[n+1],l=i[n+2],c=i[n+3],h=r[s],u=r[s+1],d=r[s+2],p=r[s+3];return t[e]=o*p+c*h+a*d-l*u,t[e+1]=a*p+c*u+l*h-o*d,t[e+2]=l*p+c*d+o*u-a*h,t[e+3]=c*p-o*h-a*u-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=t._x,n=t._y,r=t._z,s=t._order,o=Math.cos,a=Math.sin,l=o(i/2),c=o(n/2),h=o(r/2),u=a(i/2),d=a(n/2),p=a(r/2);switch(s){case"XYZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"YXZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"ZXY":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"ZYX":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"YZX":this._x=u*c*h+l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h-u*d*p;break;case"XZY":this._x=u*c*h-l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h+u*d*p}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],n=e[4],r=e[8],s=e[1],o=e[5],a=e[9],l=e[2],c=e[6],h=e[10],u=i+o+h;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(c-a)*t,this._y=(r-l)*t,this._z=(s-n)*t}else if(i>o&&i>h){const t=2*Math.sqrt(1+i-o-h);this._w=(c-a)/t,this._x=.25*t,this._y=(n+s)/t,this._z=(r+l)/t}else if(o>h){const t=2*Math.sqrt(1+o-i-h);this._w=(r-l)/t,this._x=(n+s)/t,this._y=.25*t,this._z=(a+c)/t}else{const t=2*Math.sqrt(1+h-i-o);this._w=(s-n)/t,this._x=(r+l)/t,this._y=(a+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Mt(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const n=Math.min(1,e/i);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?this.multiplyQuaternions(t,e):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,n=t._y,r=t._z,s=t._w,o=e._x,a=e._y,l=e._z,c=e._w;return this._x=i*c+s*o+n*l-r*a,this._y=n*c+s*a+r*o-i*l,this._z=r*c+s*l+i*a-n*o,this._w=s*c-i*o-n*a-r*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const i=this._x,n=this._y,r=this._z,s=this._w;let o=s*t._w+i*t._x+n*t._y+r*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=i,this._y=n,this._z=r,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*i+e*this._x,this._y=t*n+e*this._y,this._z=t*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,o),h=Math.sin((1-e)*c)/l,u=Math.sin(e*c)/l;return this._w=s*h+this._w*u,this._x=i*h+this._x*u,this._y=n*h+this._y*u,this._z=r*h+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),n=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(n),i*Math.sin(r),i*Math.cos(r),e*Math.sin(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}te.prototype.isQuaternion=!0;class ee{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?this.addVectors(t,e):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?this.subVectors(t,e):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?this.multiplyVectors(t,e):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(ne.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(ne.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*n,this.y=r[1]*e+r[4]*i+r[7]*n,this.z=r[2]*e+r[5]*i+r[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,r=t.elements,s=1/(r[3]*e+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*n+r[12])*s,this.y=(r[1]*e+r[5]*i+r[9]*n+r[13])*s,this.z=(r[2]*e+r[6]*i+r[10]*n+r[14])*s,this}applyQuaternion(t){const e=this.x,i=this.y,n=this.z,r=t.x,s=t.y,o=t.z,a=t.w,l=a*e+s*n-o*i,c=a*i+o*e-r*n,h=a*n+r*i-s*e,u=-r*e-s*i-o*n;return this.x=l*a+u*-r+c*-o-h*-s,this.y=c*a+u*-s+h*-r-l*-o,this.z=h*a+u*-o+l*-s-c*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n,this.y=r[1]*e+r[5]*i+r[9]*n,this.z=r[2]*e+r[6]*i+r[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t,e){return void 0!==e?this.crossVectors(t,e):this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,n=t.y,r=t.z,s=e.x,o=e.y,a=e.z;return this.x=n*a-r*o,this.y=r*s-i*a,this.z=i*o-n*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return ie.copy(this).projectOnVector(t),this.sub(ie)}reflect(t){return this.sub(ie.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(Mt(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const n=Math.sin(e)*t;return this.x=n*Math.sin(i),this.y=Math.cos(e)*t,this.z=n*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,i){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}ee.prototype.isVector3=!0;const ie=new ee,ne=new te;class re{constructor(t=new ee(1/0,1/0,1/0),e=new ee(-1/0,-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,l=t.length;a<l;a+=3){const l=t[a],c=t[a+1],h=t[a+2];l<e&&(e=l),c<i&&(i=c),h<n&&(n=h),l>r&&(r=l),c>s&&(s=c),h>o&&(o=h)}return this.min.set(e,i,n),this.max.set(r,s,o),this}setFromBufferAttribute(t){let e=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,l=t.count;a<l;a++){const l=t.getX(a),c=t.getY(a),h=t.getZ(a);l<e&&(e=l),c<i&&(i=c),h<n&&(n=h),l>r&&(r=l),c>s&&(s=c),h>o&&(o=h)}return this.min.set(e,i,n),this.max.set(r,s,o),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=oe.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const i=t.geometry;if(void 0!==i)if(e&&null!=i.attributes&&void 0!==i.attributes.position){const e=i.attributes.position;for(let i=0,n=e.count;i<n;i++)oe.fromBufferAttribute(e,i).applyMatrix4(t.matrixWorld),this.expandByPoint(oe)}else null===i.boundingBox&&i.computeBoundingBox(),ae.copy(i.boundingBox),ae.applyMatrix4(t.matrixWorld),this.union(ae);const n=t.children;for(let t=0,i=n.length;t<i;t++)this.expandByObject(n[t],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,oe),oe.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(fe),me.subVectors(this.max,fe),le.subVectors(t.a,fe),ce.subVectors(t.b,fe),he.subVectors(t.c,fe),ue.subVectors(ce,le),de.subVectors(he,ce),pe.subVectors(le,he);let e=[0,-ue.z,ue.y,0,-de.z,de.y,0,-pe.z,pe.y,ue.z,0,-ue.x,de.z,0,-de.x,pe.z,0,-pe.x,-ue.y,ue.x,0,-de.y,de.x,0,-pe.y,pe.x,0];return!!ye(e,le,ce,he,me)&&(e=[1,0,0,0,1,0,0,0,1],!!ye(e,le,ce,he,me)&&(ge.crossVectors(ue,de),e=[ge.x,ge.y,ge.z],ye(e,le,ce,he,me)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return oe.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=.5*this.getSize(oe).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(se[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),se[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),se[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),se[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),se[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),se[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),se[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),se[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(se)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}re.prototype.isBox3=!0;const se=[new ee,new ee,new ee,new ee,new ee,new ee,new ee,new ee],oe=new ee,ae=new re,le=new ee,ce=new ee,he=new ee,ue=new ee,de=new ee,pe=new ee,fe=new ee,me=new ee,ge=new ee,ve=new ee;function ye(t,e,i,n,r){for(let s=0,o=t.length-3;s<=o;s+=3){ve.fromArray(t,s);const o=r.x*Math.abs(ve.x)+r.y*Math.abs(ve.y)+r.z*Math.abs(ve.z),a=e.dot(ve),l=i.dot(ve),c=n.dot(ve);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>o)return!1}return!0}const _e=new re,xe=new ee,Me=new ee,be=new ee;class we{constructor(t=new ee,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;void 0!==e?i.copy(e):_e.setFromPoints(t).getCenter(i);let n=0;for(let e=0,r=t.length;e<r;e++)n=Math.max(n,i.distanceToSquared(t[e]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){be.subVectors(t,this.center);const e=be.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),i=.5*(t-this.radius);this.center.add(be.multiplyScalar(i/t)),this.radius+=i}return this}union(t){return!0===this.center.equals(t.center)?Me.set(0,0,1).multiplyScalar(t.radius):Me.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(xe.copy(t.center).add(Me)),this.expandByPoint(xe.copy(t.center).sub(Me)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Se=new ee,Te=new ee,Ae=new ee,Ee=new ee,Ce=new ee,Oe=new ee,Pe=new ee;class Ie{constructor(t=new ee,e=new ee(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Se)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Se.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Se.copy(this.direction).multiplyScalar(e).add(this.origin),Se.distanceToSquared(t))}distanceSqToSegment(t,e,i,n){Te.copy(t).add(e).multiplyScalar(.5),Ae.copy(e).sub(t).normalize(),Ee.copy(this.origin).sub(Te);const r=.5*t.distanceTo(e),s=-this.direction.dot(Ae),o=Ee.dot(this.direction),a=-Ee.dot(Ae),l=Ee.lengthSq(),c=Math.abs(1-s*s);let h,u,d,p;if(c>0)if(h=s*a-o,u=s*o-a,p=r*c,h>=0)if(u>=-p)if(u<=p){const t=1/c;h*=t,u*=t,d=h*(h+s*u+2*o)+u*(s*h+u+2*a)+l}else u=r,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+l;else u=-r,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+l;else u<=-p?(h=Math.max(0,-(-s*r+o)),u=h>0?-r:Math.min(Math.max(-r,-a),r),d=-h*h+u*(u+2*a)+l):u<=p?(h=0,u=Math.min(Math.max(-r,-a),r),d=u*(u+2*a)+l):(h=Math.max(0,-(s*r+o)),u=h>0?r:Math.min(Math.max(-r,-a),r),d=-h*h+u*(u+2*a)+l);else u=s>0?-r:r,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+l;return i&&i.copy(this.direction).multiplyScalar(h).add(this.origin),n&&n.copy(Ae).multiplyScalar(u).add(Te),d}intersectSphere(t,e){Se.subVectors(t.center,this.origin);const i=Se.dot(this.direction),n=Se.dot(Se)-i*i,r=t.radius*t.radius;if(n>r)return null;const s=Math.sqrt(r-n),o=i-s,a=i+s;return o<0&&a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return null===i?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,n,r,s,o,a;const l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return l>=0?(i=(t.min.x-u.x)*l,n=(t.max.x-u.x)*l):(i=(t.max.x-u.x)*l,n=(t.min.x-u.x)*l),c>=0?(r=(t.min.y-u.y)*c,s=(t.max.y-u.y)*c):(r=(t.max.y-u.y)*c,s=(t.min.y-u.y)*c),i>s||r>n?null:((r>i||i!=i)&&(i=r),(s<n||n!=n)&&(n=s),h>=0?(o=(t.min.z-u.z)*h,a=(t.max.z-u.z)*h):(o=(t.max.z-u.z)*h,a=(t.min.z-u.z)*h),i>a||o>n?null:((o>i||i!=i)&&(i=o),(a<n||n!=n)&&(n=a),n<0?null:this.at(i>=0?i:n,e)))}intersectsBox(t){return null!==this.intersectBox(t,Se)}intersectTriangle(t,e,i,n,r){Ce.subVectors(e,t),Oe.subVectors(i,t),Pe.crossVectors(Ce,Oe);let s,o=this.direction.dot(Pe);if(o>0){if(n)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}Ee.subVectors(this.origin,t);const a=s*this.direction.dot(Oe.crossVectors(Ee,Oe));if(a<0)return null;const l=s*this.direction.dot(Ce.cross(Ee));if(l<0)return null;if(a+l>o)return null;const c=-s*Ee.dot(Pe);return c<0?null:this.at(c/o,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class De{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,n,r,s,o,a,l,c,h,u,d,p,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=n,g[1]=r,g[5]=s,g[9]=o,g[13]=a,g[2]=l,g[6]=c,g[10]=h,g[14]=u,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new De).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,n=1/Le.setFromMatrixColumn(t,0).length(),r=1/Le.setFromMatrixColumn(t,1).length(),s=1/Le.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=0,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=0,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,i=t.x,n=t.y,r=t.z,s=Math.cos(i),o=Math.sin(i),a=Math.cos(n),l=Math.sin(n),c=Math.cos(r),h=Math.sin(r);if("XYZ"===t.order){const t=s*c,i=s*h,n=o*c,r=o*h;e[0]=a*c,e[4]=-a*h,e[8]=l,e[1]=i+n*l,e[5]=t-r*l,e[9]=-o*a,e[2]=r-t*l,e[6]=n+i*l,e[10]=s*a}else if("YXZ"===t.order){const t=a*c,i=a*h,n=l*c,r=l*h;e[0]=t+r*o,e[4]=n*o-i,e[8]=s*l,e[1]=s*h,e[5]=s*c,e[9]=-o,e[2]=i*o-n,e[6]=r+t*o,e[10]=s*a}else if("ZXY"===t.order){const t=a*c,i=a*h,n=l*c,r=l*h;e[0]=t-r*o,e[4]=-s*h,e[8]=n+i*o,e[1]=i+n*o,e[5]=s*c,e[9]=r-t*o,e[2]=-s*l,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){const t=s*c,i=s*h,n=o*c,r=o*h;e[0]=a*c,e[4]=n*l-i,e[8]=t*l+r,e[1]=a*h,e[5]=r*l+t,e[9]=i*l-n,e[2]=-l,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){const t=s*a,i=s*l,n=o*a,r=o*l;e[0]=a*c,e[4]=r-t*h,e[8]=n*h+i,e[1]=h,e[5]=s*c,e[9]=-o*c,e[2]=-l*c,e[6]=i*h+n,e[10]=t-r*h}else if("XZY"===t.order){const t=s*a,i=s*l,n=o*a,r=o*l;e[0]=a*c,e[4]=-h,e[8]=l*c,e[1]=t*h+r,e[5]=s*c,e[9]=i*h-n,e[2]=n*h-i,e[6]=o*c,e[10]=r*h+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Be,t,Ne)}lookAt(t,e,i){const n=this.elements;return Ge.subVectors(t,e),0===Ge.lengthSq()&&(Ge.z=1),Ge.normalize(),Fe.crossVectors(i,Ge),0===Fe.lengthSq()&&(1===Math.abs(i.z)?Ge.x+=1e-4:Ge.z+=1e-4,Ge.normalize(),Fe.crossVectors(i,Ge)),Fe.normalize(),Ue.crossVectors(Ge,Fe),n[0]=Fe.x,n[4]=Ue.x,n[8]=Ge.x,n[1]=Fe.y,n[5]=Ue.y,n[9]=Ge.y,n[2]=Fe.z,n[6]=Ue.z,n[10]=Ge.z,this}multiply(t,e){return void 0!==e?this.multiplyMatrices(t,e):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,r=this.elements,s=i[0],o=i[4],a=i[8],l=i[12],c=i[1],h=i[5],u=i[9],d=i[13],p=i[2],f=i[6],m=i[10],g=i[14],v=i[3],y=i[7],_=i[11],x=i[15],M=n[0],b=n[4],w=n[8],S=n[12],T=n[1],A=n[5],E=n[9],C=n[13],O=n[2],P=n[6],I=n[10],D=n[14],L=n[3],R=n[7],B=n[11],N=n[15];return r[0]=s*M+o*T+a*O+l*L,r[4]=s*b+o*A+a*P+l*R,r[8]=s*w+o*E+a*I+l*B,r[12]=s*S+o*C+a*D+l*N,r[1]=c*M+h*T+u*O+d*L,r[5]=c*b+h*A+u*P+d*R,r[9]=c*w+h*E+u*I+d*B,r[13]=c*S+h*C+u*D+d*N,r[2]=p*M+f*T+m*O+g*L,r[6]=p*b+f*A+m*P+g*R,r[10]=p*w+f*E+m*I+g*B,r[14]=p*S+f*C+m*D+g*N,r[3]=v*M+y*T+_*O+x*L,r[7]=v*b+y*A+_*P+x*R,r[11]=v*w+y*E+_*I+x*B,r[15]=v*S+y*C+_*D+x*N,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],n=t[8],r=t[12],s=t[1],o=t[5],a=t[9],l=t[13],c=t[2],h=t[6],u=t[10],d=t[14];return t[3]*(+r*a*h-n*l*h-r*o*u+i*l*u+n*o*d-i*a*d)+t[7]*(+e*a*d-e*l*u+r*s*u-n*s*d+n*l*c-r*a*c)+t[11]*(+e*l*h-e*o*d-r*s*h+i*s*d+r*o*c-i*l*c)+t[15]*(-n*o*c-e*a*h+e*o*u+n*s*h-i*s*u+i*a*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],u=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],v=h*m*l-f*u*l+f*a*d-o*m*d-h*a*g+o*u*g,y=p*u*l-c*m*l-p*a*d+s*m*d+c*a*g-s*u*g,_=c*f*l-p*h*l+p*o*d-s*f*d-c*o*g+s*h*g,x=p*h*a-c*f*a-p*o*u+s*f*u+c*o*m-s*h*m,M=e*v+i*y+n*_+r*x;if(0===M)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const b=1/M;return t[0]=v*b,t[1]=(f*u*r-h*m*r-f*n*d+i*m*d+h*n*g-i*u*g)*b,t[2]=(o*m*r-f*a*r+f*n*l-i*m*l-o*n*g+i*a*g)*b,t[3]=(h*a*r-o*u*r-h*n*l+i*u*l+o*n*d-i*a*d)*b,t[4]=y*b,t[5]=(c*m*r-p*u*r+p*n*d-e*m*d-c*n*g+e*u*g)*b,t[6]=(p*a*r-s*m*r-p*n*l+e*m*l+s*n*g-e*a*g)*b,t[7]=(s*u*r-c*a*r+c*n*l-e*u*l-s*n*d+e*a*d)*b,t[8]=_*b,t[9]=(p*h*r-c*f*r-p*i*d+e*f*d+c*i*g-e*h*g)*b,t[10]=(s*f*r-p*o*r+p*i*l-e*f*l-s*i*g+e*o*g)*b,t[11]=(c*o*r-s*h*r-c*i*l+e*h*l+s*i*d-e*o*d)*b,t[12]=x*b,t[13]=(c*f*n-p*h*n+p*i*u-e*f*u-c*i*m+e*h*m)*b,t[14]=(p*o*n-s*f*n-p*i*a+e*f*a+s*i*m-e*o*m)*b,t[15]=(s*h*n-c*o*n+c*i*a-e*h*a-s*i*u+e*o*u)*b,this}scale(t){const e=this.elements,i=t.x,n=t.y,r=t.z;return e[0]*=i,e[4]*=n,e[8]*=r,e[1]*=i,e[5]*=n,e[9]*=r,e[2]*=i,e[6]*=n,e[10]*=r,e[3]*=i,e[7]*=n,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),n=Math.sin(e),r=1-i,s=t.x,o=t.y,a=t.z,l=r*s,c=r*o;return this.set(l*s+i,l*o-n*a,l*a+n*o,0,l*o+n*a,c*o+i,c*a-n*s,0,l*a-n*o,c*a+n*s,r*a*a+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,n,r,s){return this.set(1,i,r,0,t,1,s,0,e,n,1,0,0,0,0,1),this}compose(t,e,i){const n=this.elements,r=e._x,s=e._y,o=e._z,a=e._w,l=r+r,c=s+s,h=o+o,u=r*l,d=r*c,p=r*h,f=s*c,m=s*h,g=o*h,v=a*l,y=a*c,_=a*h,x=i.x,M=i.y,b=i.z;return n[0]=(1-(f+g))*x,n[1]=(d+_)*x,n[2]=(p-y)*x,n[3]=0,n[4]=(d-_)*M,n[5]=(1-(u+g))*M,n[6]=(m+v)*M,n[7]=0,n[8]=(p+y)*b,n[9]=(m-v)*b,n[10]=(1-(u+f))*b,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,i){const n=this.elements;let r=Le.set(n[0],n[1],n[2]).length();const s=Le.set(n[4],n[5],n[6]).length(),o=Le.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),t.x=n[12],t.y=n[13],t.z=n[14],Re.copy(this);const a=1/r,l=1/s,c=1/o;return Re.elements[0]*=a,Re.elements[1]*=a,Re.elements[2]*=a,Re.elements[4]*=l,Re.elements[5]*=l,Re.elements[6]*=l,Re.elements[8]*=c,Re.elements[9]*=c,Re.elements[10]*=c,e.setFromRotationMatrix(Re),i.x=r,i.y=s,i.z=o,this}makePerspective(t,e,i,n,r,s){const o=this.elements,a=2*r/(e-t),l=2*r/(i-n),c=(e+t)/(e-t),h=(i+n)/(i-n),u=-(s+r)/(s-r),d=-2*s*r/(s-r);return o[0]=a,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=u,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,i,n,r,s){const o=this.elements,a=1/(e-t),l=1/(i-n),c=1/(s-r),h=(e+t)*a,u=(i+n)*l,d=(s+r)*c;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-u,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<16;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}De.prototype.isMatrix4=!0;const Le=new ee,Re=new De,Be=new ee(0,0,0),Ne=new ee(1,1,1),Fe=new ee,Ue=new ee,Ge=new ee,ze=new De,ke=new te;class je{constructor(t=0,e=0,i=0,n=je.DefaultOrder){this._x=t,this._y=e,this._z=i,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,n=this._order){return this._x=t,this._y=e,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const n=t.elements,r=n[0],s=n[4],o=n[8],a=n[1],l=n[5],c=n[9],h=n[2],u=n[6],d=n[10];switch(e){case"XYZ":this._y=Math.asin(Mt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Mt(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-h,r),this._z=0);break;case"ZXY":this._x=Math.asin(Mt(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(a,r));break;case"ZYX":this._y=Math.asin(-Mt(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(Mt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,r)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-Mt(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-c,d),this._y=0)}return this._order=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return ze.makeRotationFromQuaternion(t),this.setFromRotationMatrix(ze,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return ke.setFromEuler(this),this.setFromQuaternion(ke,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}je.prototype.isEuler=!0,je.DefaultOrder="XYZ",je.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class He{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}let Ve=0;const We=new ee,qe=new te,Je=new De,Xe=new ee,Ye=new ee,Ze=new ee,Ke=new te,Qe=new ee(1,0,0),$e=new ee(0,1,0),ti=new ee(0,0,1),ei={type:"added"},ii={type:"removed"};class ni extends mt{constructor(){super(),Object.defineProperty(this,"id",{value:Ve++}),this.uuid=xt(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ni.DefaultUp.clone();const t=new ee,e=new je,i=new te,n=new ee(1,1,1);e._onChange((function(){i.setFromEuler(e,!1)})),i._onChange((function(){e.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new De},normalMatrix:{value:new Ot}}),this.matrix=new De,this.matrixWorld=new De,this.matrixAutoUpdate=ni.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new He,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return qe.setFromAxisAngle(t,e),this.quaternion.multiply(qe),this}rotateOnWorldAxis(t,e){return qe.setFromAxisAngle(t,e),this.quaternion.premultiply(qe),this}rotateX(t){return this.rotateOnAxis(Qe,t)}rotateY(t){return this.rotateOnAxis($e,t)}rotateZ(t){return this.rotateOnAxis(ti,t)}translateOnAxis(t,e){return We.copy(t).applyQuaternion(this.quaternion),this.position.add(We.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Qe,t)}translateY(t){return this.translateOnAxis($e,t)}translateZ(t){return this.translateOnAxis(ti,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(Je.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?Xe.copy(t):Xe.set(t,e,i);const n=this.parent;this.updateWorldMatrix(!0,!1),Ye.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Je.lookAt(Ye,Xe,this.up):Je.lookAt(Xe,Ye,this.up),this.quaternion.setFromRotationMatrix(Je),n&&(Je.extractRotation(n.matrixWorld),qe.setFromRotationMatrix(Je),this.quaternion.premultiply(qe.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(ei)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(ii)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(ii)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),Je.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Je.multiply(t.parent.matrixWorld)),t.applyMatrix4(Je),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectByProperty(t,e);if(void 0!==n)return n}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ye,t,Ze),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ye,Ke,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].updateMatrixWorld(t)}updateWorldMatrix(t,e){const i=this.parent;if(!0===t&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,i=t.length;e<i;e++)t[e].updateWorldMatrix(!1,!0)}}toJSON(t){const e=void 0===t||"string"==typeof t,i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};function r(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const i=e.shapes;if(Array.isArray(i))for(let e=0,n=i.length;e<n;e++){const n=i[e];r(t.shapes,n)}else r(t.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let i=0,n=this.material.length;i<n;i++)e.push(r(t.materials,this.material[i]));n.material=e}else n.material=r(t.materials,this.material);if(this.children.length>0){n.children=[];for(let e=0;e<this.children.length;e++)n.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let e=0;e<this.animations.length;e++){const i=this.animations[e];n.animations.push(r(t.animations,i))}}if(e){const e=s(t.geometries),n=s(t.materials),r=s(t.textures),o=s(t.images),a=s(t.shapes),l=s(t.skeletons),c=s(t.animations),h=s(t.nodes);e.length>0&&(i.geometries=e),n.length>0&&(i.materials=n),r.length>0&&(i.textures=r),o.length>0&&(i.images=o),a.length>0&&(i.shapes=a),l.length>0&&(i.skeletons=l),c.length>0&&(i.animations=c),h.length>0&&(i.nodes=h)}return i.object=n,i;function s(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const i=t.children[e];this.add(i.clone())}return this}}ni.DefaultUp=new ee(0,1,0),ni.DefaultMatrixAutoUpdate=!0,ni.prototype.isObject3D=!0;const ri=new ee,si=new ee,oi=new ee,ai=new ee,li=new ee,ci=new ee,hi=new ee,ui=new ee,di=new ee,pi=new ee;class fi{constructor(t=new ee,e=new ee,i=new ee){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,n){n.subVectors(i,e),ri.subVectors(t,e),n.cross(ri);const r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(t,e,i,n,r){ri.subVectors(n,e),si.subVectors(i,e),oi.subVectors(t,e);const s=ri.dot(ri),o=ri.dot(si),a=ri.dot(oi),l=si.dot(si),c=si.dot(oi),h=s*l-o*o;if(0===h)return r.set(-2,-1,-1);const u=1/h,d=(l*a-o*c)*u,p=(s*c-o*a)*u;return r.set(1-d-p,p,d)}static containsPoint(t,e,i,n){return this.getBarycoord(t,e,i,n,ai),ai.x>=0&&ai.y>=0&&ai.x+ai.y<=1}static getUV(t,e,i,n,r,s,o,a){return this.getBarycoord(t,e,i,n,ai),a.set(0,0),a.addScaledVector(r,ai.x),a.addScaledVector(s,ai.y),a.addScaledVector(o,ai.z),a}static isFrontFacing(t,e,i,n){return ri.subVectors(i,e),si.subVectors(t,e),ri.cross(si).dot(n)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this}setFromAttributeAndIndices(t,e,i,n){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return ri.subVectors(this.c,this.b),si.subVectors(this.a,this.b),.5*ri.cross(si).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return fi.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return fi.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,n,r){return fi.getUV(t,this.a,this.b,this.c,e,i,n,r)}containsPoint(t){return fi.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return fi.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,n=this.b,r=this.c;let s,o;li.subVectors(n,i),ci.subVectors(r,i),ui.subVectors(t,i);const a=li.dot(ui),l=ci.dot(ui);if(a<=0&&l<=0)return e.copy(i);di.subVectors(t,n);const c=li.dot(di),h=ci.dot(di);if(c>=0&&h<=c)return e.copy(n);const u=a*h-c*l;if(u<=0&&a>=0&&c<=0)return s=a/(a-c),e.copy(i).addScaledVector(li,s);pi.subVectors(t,r);const d=li.dot(pi),p=ci.dot(pi);if(p>=0&&d<=p)return e.copy(r);const f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return o=l/(l-p),e.copy(i).addScaledVector(ci,o);const m=c*p-d*h;if(m<=0&&h-c>=0&&d-p>=0)return hi.subVectors(r,n),o=(h-c)/(h-c+(d-p)),e.copy(n).addScaledVector(hi,o);const g=1/(m+f+u);return s=f*g,o=u*g,e.copy(i).addScaledVector(li,s).addScaledVector(ci,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let mi=0;class gi extends mt{constructor(){super(),Object.defineProperty(this,"id",{value:mi++}),this.uuid=xt(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=n,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ht,this.stencilZFail=ht,this.stencilZPass=ht,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const i=t[e];if(void 0===i)continue;if("shading"===e){this.type,this.flatShading=1===i;continue}const n=this[e];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]=i:this.type}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),0!==this.side&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),e){const e=n(t.textures),r=n(t.images);e.length>0&&(i.textures=e),r.length>0&&(i.images=r)}return i}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(null!==e){const t=e.length;i=new Array(t);for(let n=0;n!==t;++n)i[n]=e[n].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}gi.prototype.isMaterial=!0,gi.fromType=function(){return null};class vi extends gi{constructor(t){super(),this.type="MeshBasicMaterial",this.color=new zt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}vi.prototype.isMeshBasicMaterial=!0;const yi=new ee,_i=new Ct;class xi{constructor(t,e,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===i,this.usage=ut,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[t+n]=e.array[i+n];return this}copyArray(t){return this.array.set(t),this}copyColorsArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(r=new zt),e[i++]=r.r,e[i++]=r.g,e[i++]=r.b}return this}copyVector2sArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(r=new Ct),e[i++]=r.x,e[i++]=r.y}return this}copyVector3sArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(r=new ee),e[i++]=r.x,e[i++]=r.y,e[i++]=r.z}return this}copyVector4sArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(r=new Jt),e[i++]=r.x,e[i++]=r.y,e[i++]=r.z,e[i++]=r.w}return this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,i=this.count;e<i;e++)_i.fromBufferAttribute(this,e),_i.applyMatrix3(t),this.setXY(e,_i.x,_i.y);else if(3===this.itemSize)for(let e=0,i=this.count;e<i;e++)yi.fromBufferAttribute(this,e),yi.applyMatrix3(t),this.setXYZ(e,yi.x,yi.y,yi.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)yi.x=this.getX(e),yi.y=this.getY(e),yi.z=this.getZ(e),yi.applyMatrix4(t),this.setXYZ(e,yi.x,yi.y,yi.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)yi.x=this.getX(e),yi.y=this.getY(e),yi.z=this.getZ(e),yi.applyNormalMatrix(t),this.setXYZ(e,yi.x,yi.y,yi.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)yi.x=this.getX(e),yi.y=this.getY(e),yi.z=this.getZ(e),yi.transformDirection(t),this.setXYZ(e,yi.x,yi.y,yi.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){return this.array[t*this.itemSize]}setX(t,e){return this.array[t*this.itemSize]=e,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,e){return this.array[t*this.itemSize+1]=e,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,e){return this.array[t*this.itemSize+2]=e,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,e){return this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this}setXYZW(t,e,i,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==ut&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t}}xi.prototype.isBufferAttribute=!0;class Mi extends xi{constructor(t,e,i){super(new Int8Array(t),e,i)}}class bi extends xi{constructor(t,e,i){super(new Uint8Array(t),e,i)}}class wi extends xi{constructor(t,e,i){super(new Uint8ClampedArray(t),e,i)}}class Si extends xi{constructor(t,e,i){super(new Int16Array(t),e,i)}}class Ti extends xi{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class Ai extends xi{constructor(t,e,i){super(new Int32Array(t),e,i)}}class Ei extends xi{constructor(t,e,i){super(new Uint32Array(t),e,i)}}class Ci extends xi{constructor(t,e,i){super(new Uint16Array(t),e,i)}}Ci.prototype.isFloat16BufferAttribute=!0;class Oi extends xi{constructor(t,e,i){super(new Float32Array(t),e,i)}}class Pi extends xi{constructor(t,e,i){super(new Float64Array(t),e,i)}}let Ii=0;const Di=new De,Li=new ni,Ri=new ee,Bi=new re,Ni=new re,Fi=new ee;class Ui extends mt{constructor(){super(),Object.defineProperty(this,"id",{value:Ii++}),this.uuid=xt(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Pt(t)?Ei:Ti)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const e=(new Ot).getNormalMatrix(t);i.applyNormalMatrix(e),i.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(t),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return Di.makeRotationFromQuaternion(t),this.applyMatrix4(Di),this}rotateX(t){return Di.makeRotationX(t),this.applyMatrix4(Di),this}rotateY(t){return Di.makeRotationY(t),this.applyMatrix4(Di),this}rotateZ(t){return Di.makeRotationZ(t),this.applyMatrix4(Di),this}translate(t,e,i){return Di.makeTranslation(t,e,i),this.applyMatrix4(Di),this}scale(t,e,i){return Di.makeScale(t,e,i),this.applyMatrix4(Di),this}lookAt(t){return Li.lookAt(t),Li.updateMatrix(),this.applyMatrix4(Li.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ri).negate(),this.translate(Ri.x,Ri.y,Ri.z),this}setFromPoints(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i];e.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new Oi(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new re);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new ee(-1/0,-1/0,-1/0),new ee(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];Bi.setFromBufferAttribute(i),this.morphTargetsRelative?(Fi.addVectors(this.boundingBox.min,Bi.min),this.boundingBox.expandByPoint(Fi),Fi.addVectors(this.boundingBox.max,Bi.max),this.boundingBox.expandByPoint(Fi)):(this.boundingBox.expandByPoint(Bi.min),this.boundingBox.expandByPoint(Bi.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new we);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new ee,1/0);if(t){const i=this.boundingSphere.center;if(Bi.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];Ni.setFromBufferAttribute(i),this.morphTargetsRelative?(Fi.addVectors(Bi.min,Ni.min),Bi.expandByPoint(Fi),Fi.addVectors(Bi.max,Ni.max),Bi.expandByPoint(Fi)):(Bi.expandByPoint(Ni.min),Bi.expandByPoint(Ni.max))}Bi.getCenter(i);let n=0;for(let e=0,r=t.count;e<r;e++)Fi.fromBufferAttribute(t,e),n=Math.max(n,i.distanceToSquared(Fi));if(e)for(let r=0,s=e.length;r<s;r++){const s=e[r],o=this.morphTargetsRelative;for(let e=0,r=s.count;e<r;e++)Fi.fromBufferAttribute(s,e),o&&(Ri.fromBufferAttribute(t,e),Fi.add(Ri)),n=Math.max(n,i.distanceToSquared(Fi))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=t.array,n=e.position.array,r=e.normal.array,s=e.uv.array,o=n.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new xi(new Float32Array(4*o),4));const a=this.getAttribute("tangent").array,l=[],c=[];for(let t=0;t<o;t++)l[t]=new ee,c[t]=new ee;const h=new ee,u=new ee,d=new ee,p=new Ct,f=new Ct,m=new Ct,g=new ee,v=new ee;function y(t,e,i){h.fromArray(n,3*t),u.fromArray(n,3*e),d.fromArray(n,3*i),p.fromArray(s,2*t),f.fromArray(s,2*e),m.fromArray(s,2*i),u.sub(h),d.sub(h),f.sub(p),m.sub(p);const r=1/(f.x*m.y-m.x*f.y);isFinite(r)&&(g.copy(u).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(r),v.copy(d).multiplyScalar(f.x).addScaledVector(u,-m.x).multiplyScalar(r),l[t].add(g),l[e].add(g),l[i].add(g),c[t].add(v),c[e].add(v),c[i].add(v))}let _=this.groups;0===_.length&&(_=[{start:0,count:i.length}]);for(let t=0,e=_.length;t<e;++t){const e=_[t],n=e.start;for(let t=n,r=n+e.count;t<r;t+=3)y(i[t+0],i[t+1],i[t+2])}const x=new ee,M=new ee,b=new ee,w=new ee;function S(t){b.fromArray(r,3*t),w.copy(b);const e=l[t];x.copy(e),x.sub(b.multiplyScalar(b.dot(e))).normalize(),M.crossVectors(w,e);const i=M.dot(c[t])<0?-1:1;a[4*t]=x.x,a[4*t+1]=x.y,a[4*t+2]=x.z,a[4*t+3]=i}for(let t=0,e=_.length;t<e;++t){const e=_[t],n=e.start;for(let t=n,r=n+e.count;t<r;t+=3)S(i[t+0]),S(i[t+1]),S(i[t+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let i=this.getAttribute("normal");if(void 0===i)i=new xi(new Float32Array(3*e.count),3),this.setAttribute("normal",i);else for(let t=0,e=i.count;t<e;t++)i.setXYZ(t,0,0,0);const n=new ee,r=new ee,s=new ee,o=new ee,a=new ee,l=new ee,c=new ee,h=new ee;if(t)for(let u=0,d=t.count;u<d;u+=3){const d=t.getX(u+0),p=t.getX(u+1),f=t.getX(u+2);n.fromBufferAttribute(e,d),r.fromBufferAttribute(e,p),s.fromBufferAttribute(e,f),c.subVectors(s,r),h.subVectors(n,r),c.cross(h),o.fromBufferAttribute(i,d),a.fromBufferAttribute(i,p),l.fromBufferAttribute(i,f),o.add(c),a.add(c),l.add(c),i.setXYZ(d,o.x,o.y,o.z),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,o=e.count;t<o;t+=3)n.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),c.subVectors(s,r),h.subVectors(n,r),c.cross(h),i.setXYZ(t+0,c.x,c.y,c.z),i.setXYZ(t+1,c.x,c.y,c.z),i.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0);const i=this.attributes;for(const n in i){if(void 0===t.attributes[n])continue;const r=i[n].array,s=t.attributes[n],o=s.array,a=s.itemSize*e,l=Math.min(o.length,r.length-a);for(let t=0,e=a;t<l;t++,e++)r[e]=o[t]}return this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)Fi.fromBufferAttribute(t,e),Fi.normalize(),t.setXYZ(e,Fi.x,Fi.y,Fi.z)}toNonIndexed(){function t(t,e){const i=t.array,n=t.itemSize,r=t.normalized,s=new i.constructor(e.length*n);let o=0,a=0;for(let r=0,l=e.length;r<l;r++){o=t.isInterleavedBufferAttribute?e[r]*t.data.stride+t.offset:e[r]*n;for(let t=0;t<n;t++)s[a++]=i[o++]}return new xi(s,n,r)}if(null===this.index)return this;const e=new Ui,i=this.index.array,n=this.attributes;for(const r in n){const s=t(n[r],i);e.setAttribute(r,s)}const r=this.morphAttributes;for(const n in r){const s=[],o=r[n];for(let e=0,n=o.length;e<n;e++){const n=t(o[e],i);s.push(n)}e.morphAttributes[n]=s}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let t=0,i=s.length;t<i;t++){const i=s[t];e.addGroup(i.start,i.count,i.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const i in e)void 0!==e[i]&&(t[i]=e[i]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const e in i){const n=i[e];t.data.attributes[e]=n.toJSON(t.data)}const n={};let r=!1;for(const e in this.morphAttributes){const i=this.morphAttributes[e],s=[];for(let e=0,n=i.length;e<n;e++){const n=i[e];s.push(n.toJSON(t.data))}s.length>0&&(n[e]=s,r=!0)}r&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;null!==i&&this.setIndex(i.clone(e));const n=t.attributes;for(const t in n){const i=n[t];this.setAttribute(t,i.clone(e))}const r=t.morphAttributes;for(const t in r){const i=[],n=r[t];for(let t=0,r=n.length;t<r;t++)i.push(n[t].clone(e));this.morphAttributes[t]=i}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;t<e;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,void 0!==t.parameters&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}Ui.prototype.isBufferGeometry=!0;const Gi=new De,zi=new Ie,ki=new we,ji=new ee,Hi=new ee,Vi=new ee,Wi=new ee,qi=new ee,Ji=new ee,Xi=new ee,Yi=new ee,Zi=new ee,Ki=new Ct,Qi=new Ct,$i=new Ct,tn=new ee,en=new ee;class nn extends ni{constructor(t=new Ui,e=new vi){super(),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(t,e){const i=this.geometry,n=this.material,r=this.matrixWorld;if(void 0===n)return;if(null===i.boundingSphere&&i.computeBoundingSphere(),ki.copy(i.boundingSphere),ki.applyMatrix4(r),!1===t.ray.intersectsSphere(ki))return;if(Gi.copy(r).invert(),zi.copy(t.ray).applyMatrix4(Gi),null!==i.boundingBox&&!1===zi.intersectsBox(i.boundingBox))return;let s;if(i.isBufferGeometry){const r=i.index,o=i.attributes.position,a=i.morphAttributes.position,l=i.morphTargetsRelative,c=i.attributes.uv,h=i.attributes.uv2,u=i.groups,d=i.drawRange;if(null!==r)if(Array.isArray(n))for(let i=0,p=u.length;i<p;i++){const p=u[i],f=n[p.materialIndex];for(let i=Math.max(p.start,d.start),n=Math.min(r.count,Math.min(p.start+p.count,d.start+d.count));i<n;i+=3){const n=r.getX(i),u=r.getX(i+1),d=r.getX(i+2);s=rn(this,f,t,zi,o,a,l,c,h,n,u,d),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=p.materialIndex,e.push(s))}}else{for(let i=Math.max(0,d.start),u=Math.min(r.count,d.start+d.count);i<u;i+=3){const u=r.getX(i),d=r.getX(i+1),p=r.getX(i+2);s=rn(this,n,t,zi,o,a,l,c,h,u,d,p),s&&(s.faceIndex=Math.floor(i/3),e.push(s))}}else if(void 0!==o)if(Array.isArray(n))for(let i=0,r=u.length;i<r;i++){const r=u[i],p=n[r.materialIndex];for(let i=Math.max(r.start,d.start),n=Math.min(o.count,Math.min(r.start+r.count,d.start+d.count));i<n;i+=3){s=rn(this,p,t,zi,o,a,l,c,h,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=r.materialIndex,e.push(s))}}else{for(let i=Math.max(0,d.start),r=Math.min(o.count,d.start+d.count);i<r;i+=3){s=rn(this,n,t,zi,o,a,l,c,h,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),e.push(s))}}}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function rn(t,e,i,n,r,s,o,a,l,c,h,u){ji.fromBufferAttribute(r,c),Hi.fromBufferAttribute(r,h),Vi.fromBufferAttribute(r,u);const d=t.morphTargetInfluences;if(s&&d){Xi.set(0,0,0),Yi.set(0,0,0),Zi.set(0,0,0);for(let t=0,e=s.length;t<e;t++){const e=d[t],i=s[t];0!==e&&(Wi.fromBufferAttribute(i,c),qi.fromBufferAttribute(i,h),Ji.fromBufferAttribute(i,u),o?(Xi.addScaledVector(Wi,e),Yi.addScaledVector(qi,e),Zi.addScaledVector(Ji,e)):(Xi.addScaledVector(Wi.sub(ji),e),Yi.addScaledVector(qi.sub(Hi),e),Zi.addScaledVector(Ji.sub(Vi),e)))}ji.add(Xi),Hi.add(Yi),Vi.add(Zi)}t.isSkinnedMesh&&(t.boneTransform(c,ji),t.boneTransform(h,Hi),t.boneTransform(u,Vi));const p=function(t,e,i,n,r,s,o,a){let l;if(l=1===e.side?n.intersectTriangle(o,s,r,!0,a):n.intersectTriangle(r,s,o,2!==e.side,a),null===l)return null;en.copy(a),en.applyMatrix4(t.matrixWorld);const c=i.ray.origin.distanceTo(en);return c<i.near||c>i.far?null:{distance:c,point:en.clone(),object:t}}(t,e,i,n,ji,Hi,Vi,tn);if(p){a&&(Ki.fromBufferAttribute(a,c),Qi.fromBufferAttribute(a,h),$i.fromBufferAttribute(a,u),p.uv=fi.getUV(tn,ji,Hi,Vi,Ki,Qi,$i,new Ct)),l&&(Ki.fromBufferAttribute(l,c),Qi.fromBufferAttribute(l,h),$i.fromBufferAttribute(l,u),p.uv2=fi.getUV(tn,ji,Hi,Vi,Ki,Qi,$i,new Ct));const t={a:c,b:h,c:u,normal:new ee,materialIndex:0};fi.getNormal(ji,Hi,Vi,t.normal),p.face=t}return p}nn.prototype.isMesh=!0;class sn extends Ui{constructor(t=1,e=1,i=1,n=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:r,depthSegments:s};const o=this;n=Math.floor(n),r=Math.floor(r),s=Math.floor(s);const a=[],l=[],c=[],h=[];let u=0,d=0;function p(t,e,i,n,r,s,p,f,m,g,v){const y=s/m,_=p/g,x=s/2,M=p/2,b=f/2,w=m+1,S=g+1;let T=0,A=0;const E=new ee;for(let s=0;s<S;s++){const o=s*_-M;for(let a=0;a<w;a++){const u=a*y-x;E[t]=u*n,E[e]=o*r,E[i]=b,l.push(E.x,E.y,E.z),E[t]=0,E[e]=0,E[i]=f>0?1:-1,c.push(E.x,E.y,E.z),h.push(a/m),h.push(1-s/g),T+=1}}for(let t=0;t<g;t++)for(let e=0;e<m;e++){const i=u+e+w*t,n=u+e+w*(t+1),r=u+(e+1)+w*(t+1),s=u+(e+1)+w*t;a.push(i,n,s),a.push(n,r,s),A+=6}o.addGroup(d,A,v),d+=A,u+=T}p("z","y","x",-1,-1,i,e,t,s,r,0),p("z","y","x",1,-1,i,e,-t,s,r,1),p("x","z","y",1,1,t,i,e,n,s,2),p("x","z","y",1,-1,t,i,-e,n,s,3),p("x","y","z",1,-1,t,e,i,n,r,4),p("x","y","z",-1,-1,t,e,-i,n,r,5),this.setIndex(a),this.setAttribute("position",new Oi(l,3)),this.setAttribute("normal",new Oi(c,3)),this.setAttribute("uv",new Oi(h,2))}static fromJSON(t){return new sn(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function on(t){const e={};for(const i in t){e[i]={};for(const n in t[i]){const r=t[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?e[i][n]=r.clone():Array.isArray(r)?e[i][n]=r.slice():e[i][n]=r}}return e}function an(t){const e={};for(let i=0;i<t.length;i++){const n=on(t[i]);for(const t in n)e[t]=n[t]}return e}const ln={clone:on,merge:an};class cn extends gi{constructor(t){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=on(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?e.uniforms[i]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[i]={type:"m4",value:n.toArray()}:e.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const i={};for(const t in this.extensions)!0===this.extensions[t]&&(i[t]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}}cn.prototype.isShaderMaterial=!0;class hn extends ni{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new De,this.projectionMatrix=new De,this.projectionMatrixInverse=new De}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}hn.prototype.isCamera=!0;class un extends hn{constructor(t=50,e=1,i=.1,n=2e3){super(),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*_t*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*yt*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*_t*Math.atan(Math.tan(.5*yt*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,n,r,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*yt*this.fov)/this.zoom,i=2*e,n=this.aspect*i,r=-.5*n;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,o=s.fullHeight;r+=s.offsetX*n/t,e-=s.offsetY*i/o,n*=s.width/t,i*=s.height/o}const o=this.filmOffset;0!==o&&(r+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,e,e-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}un.prototype.isPerspectiveCamera=!0;const dn=90;class pn extends ni{constructor(t,e,i){if(super(),this.type="CubeCamera",!0!==i.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=i;const n=new un(dn,1,t,e);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new ee(1,0,0)),this.add(n);const r=new un(dn,1,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new ee(-1,0,0)),this.add(r);const s=new un(dn,1,t,e);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new ee(0,1,0)),this.add(s);const o=new un(dn,1,t,e);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new ee(0,-1,0)),this.add(o);const a=new un(dn,1,t,e);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new ee(0,0,1)),this.add(a);const l=new un(dn,1,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new ee(0,0,-1)),this.add(l)}update(t,e){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget,[n,r,s,o,a,l]=this.children,c=t.xr.enabled,h=t.getRenderTarget();t.xr.enabled=!1;const u=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(e,n),t.setRenderTarget(i,1),t.render(e,r),t.setRenderTarget(i,2),t.render(e,s),t.setRenderTarget(i,3),t.render(e,o),t.setRenderTarget(i,4),t.render(e,a),i.texture.generateMipmaps=u,t.setRenderTarget(i,5),t.render(e,l),t.setRenderTarget(h),t.xr.enabled=c,i.texture.needsPMREMUpdate=!0}}class fn extends qt{constructor(t,e,i,n,r,o,a,l,c,h){super(t=void 0!==t?t:[],e=void 0!==e?e:s,i,n,r,o,a,l,c,h),this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}fn.prototype.isCubeTexture=!0;class mn extends Xt{constructor(t,e={}){super(t,t,e);const i={width:t,height:t,depth:1},n=[i,i,i,i,i,i];this.texture=new fn(n,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:v}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.format=A,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},n=new sn(5,5,5),r=new cn({name:"CubemapFromEquirect",uniforms:on(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:1,blending:0});r.uniforms.tEquirect.value=e;const s=new nn(n,r),o=e.minFilter;e.minFilter===_&&(e.minFilter=v);return new pn(1,10,this).update(t,s),e.minFilter=o,s.geometry.dispose(),s.material.dispose(),this}clear(t,e,i,n){const r=t.getRenderTarget();for(let r=0;r<6;r++)t.setRenderTarget(this,r),t.clear(e,i,n);t.setRenderTarget(r)}}mn.prototype.isWebGLCubeRenderTarget=!0;const gn=new ee,vn=new ee,yn=new Ot;class _n{constructor(t=new ee(1,0,0),e=0){this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const n=gn.subVectors(i,e).cross(vn.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){const i=t.delta(gn),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:e.copy(i).multiplyScalar(r).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||yn.getNormalMatrix(t),n=this.coplanarPoint(gn).applyMatrix4(t),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}_n.prototype.isPlane=!0;const xn=new we,Mn=new ee;class bn{constructor(t=new _n,e=new _n,i=new _n,n=new _n,r=new _n,s=new _n){this.planes=[t,e,i,n,r,s]}set(t,e,i,n,r,s){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(i),o[3].copy(n),o[4].copy(r),o[5].copy(s),this}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){const e=this.planes,i=t.elements,n=i[0],r=i[1],s=i[2],o=i[3],a=i[4],l=i[5],c=i[6],h=i[7],u=i[8],d=i[9],p=i[10],f=i[11],m=i[12],g=i[13],v=i[14],y=i[15];return e[0].setComponents(o-n,h-a,f-u,y-m).normalize(),e[1].setComponents(o+n,h+a,f+u,y+m).normalize(),e[2].setComponents(o+r,h+l,f+d,y+g).normalize(),e[3].setComponents(o-r,h-l,f-d,y-g).normalize(),e[4].setComponents(o-s,h-c,f-p,y-v).normalize(),e[5].setComponents(o+s,h+c,f+p,y+v).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),xn.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(xn)}intersectsSprite(t){return xn.center.set(0,0,0),xn.radius=.7071067811865476,xn.applyMatrix4(t.matrixWorld),this.intersectsSphere(xn)}intersectsSphere(t){const e=this.planes,i=t.center,n=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(i)<n)return!1}return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const n=e[i];if(Mn.x=n.normal.x>0?t.max.x:t.min.x,Mn.y=n.normal.y>0?t.max.y:t.min.y,Mn.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(Mn)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function wn(){let t=null,e=!1,i=null,n=null;function r(e,s){i(e,s),n=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==i&&(n=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(t){i=t},setContext:function(e){t=e}}}function Sn(t,e){const i=e.isWebGL2,n=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),n.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const i=n.get(e);i&&(t.deleteBuffer(i.buffer),n.delete(e))},update:function(e,r){if(e.isGLBufferAttribute){const t=n.get(e);return void((!t||t.version<e.version)&&n.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const s=n.get(e);void 0===s?n.set(e,function(e,n){const r=e.array,s=e.usage,o=t.createBuffer();let a;if(t.bindBuffer(n,o),t.bufferData(n,r,s),e.onUploadCallback(),r instanceof Float32Array)a=t.FLOAT;else if(r instanceof Uint16Array)if(e.isFloat16BufferAttribute){if(!i)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");a=t.HALF_FLOAT}else a=t.UNSIGNED_SHORT;else if(r instanceof Int16Array)a=t.SHORT;else if(r instanceof Uint32Array)a=t.UNSIGNED_INT;else if(r instanceof Int32Array)a=t.INT;else if(r instanceof Int8Array)a=t.BYTE;else if(r instanceof Uint8Array)a=t.UNSIGNED_BYTE;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);a=t.UNSIGNED_BYTE}return{buffer:o,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}(e,r)):s.version<e.version&&(!function(e,n,r){const s=n.array,o=n.updateRange;t.bindBuffer(r,e),-1===o.count?t.bufferSubData(r,0,s):(i?t.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s,o.offset,o.count):t.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s.subarray(o.offset,o.offset+o.count)),o.count=-1)}(s.buffer,e,r),s.version=e.version)}}}class Tn extends Ui{constructor(t=1,e=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n};const r=t/2,s=e/2,o=Math.floor(i),a=Math.floor(n),l=o+1,c=a+1,h=t/o,u=e/a,d=[],p=[],f=[],m=[];for(let t=0;t<c;t++){const e=t*u-s;for(let i=0;i<l;i++){const n=i*h-r;p.push(n,-e,0),f.push(0,0,1),m.push(i/o),m.push(1-t/a)}}for(let t=0;t<a;t++)for(let e=0;e<o;e++){const i=e+l*t,n=e+l*(t+1),r=e+1+l*(t+1),s=e+1+l*t;d.push(i,n,s),d.push(n,r,s)}this.setIndex(d),this.setAttribute("position",new Oi(p,3)),this.setAttribute("normal",new Oi(f,3)),this.setAttribute("uv",new Oi(m,2))}static fromJSON(t){return new Tn(t.width,t.height,t.widthSegments,t.heightSegments)}}const An={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 ) + 0.5;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(\t\t0, 1,\t\t0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ]\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform vec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tfloat texelIndex = float( vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset );\n\t\t\tfloat y = floor( texelIndex / morphTargetsTextureSize.x );\n\t\t\tfloat x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tvec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );\n\t\t\treturn texture( morphTargetsTexture, morphUV );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(\t1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,\t1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,\t1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},En={common:{diffuse:{value:new zt(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Ot},uv2Transform:{value:new Ot},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Ct(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new zt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new zt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ot}},sprite:{diffuse:{value:new zt(16777215)},opacity:{value:1},center:{value:new Ct(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ot}}},Cn={basic:{uniforms:an([En.common,En.specularmap,En.envmap,En.aomap,En.lightmap,En.fog]),vertexShader:An.meshbasic_vert,fragmentShader:An.meshbasic_frag},lambert:{uniforms:an([En.common,En.specularmap,En.envmap,En.aomap,En.lightmap,En.emissivemap,En.fog,En.lights,{emissive:{value:new zt(0)}}]),vertexShader:An.meshlambert_vert,fragmentShader:An.meshlambert_frag},phong:{uniforms:an([En.common,En.specularmap,En.envmap,En.aomap,En.lightmap,En.emissivemap,En.bumpmap,En.normalmap,En.displacementmap,En.fog,En.lights,{emissive:{value:new zt(0)},specular:{value:new zt(1118481)},shininess:{value:30}}]),vertexShader:An.meshphong_vert,fragmentShader:An.meshphong_frag},standard:{uniforms:an([En.common,En.envmap,En.aomap,En.lightmap,En.emissivemap,En.bumpmap,En.normalmap,En.displacementmap,En.roughnessmap,En.metalnessmap,En.fog,En.lights,{emissive:{value:new zt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:An.meshphysical_vert,fragmentShader:An.meshphysical_frag},toon:{uniforms:an([En.common,En.aomap,En.lightmap,En.emissivemap,En.bumpmap,En.normalmap,En.displacementmap,En.gradientmap,En.fog,En.lights,{emissive:{value:new zt(0)}}]),vertexShader:An.meshtoon_vert,fragmentShader:An.meshtoon_frag},matcap:{uniforms:an([En.common,En.bumpmap,En.normalmap,En.displacementmap,En.fog,{matcap:{value:null}}]),vertexShader:An.meshmatcap_vert,fragmentShader:An.meshmatcap_frag},points:{uniforms:an([En.points,En.fog]),vertexShader:An.points_vert,fragmentShader:An.points_frag},dashed:{uniforms:an([En.common,En.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:An.linedashed_vert,fragmentShader:An.linedashed_frag},depth:{uniforms:an([En.common,En.displacementmap]),vertexShader:An.depth_vert,fragmentShader:An.depth_frag},normal:{uniforms:an([En.common,En.bumpmap,En.normalmap,En.displacementmap,{opacity:{value:1}}]),vertexShader:An.meshnormal_vert,fragmentShader:An.meshnormal_frag},sprite:{uniforms:an([En.sprite,En.fog]),vertexShader:An.sprite_vert,fragmentShader:An.sprite_frag},background:{uniforms:{uvTransform:{value:new Ot},t2D:{value:null}},vertexShader:An.background_vert,fragmentShader:An.background_frag},cube:{uniforms:an([En.envmap,{opacity:{value:1}}]),vertexShader:An.cube_vert,fragmentShader:An.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:An.equirect_vert,fragmentShader:An.equirect_frag},distanceRGBA:{uniforms:an([En.common,En.displacementmap,{referencePosition:{value:new ee},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:An.distanceRGBA_vert,fragmentShader:An.distanceRGBA_frag},shadow:{uniforms:an([En.lights,En.fog,{color:{value:new zt(0)},opacity:{value:1}}]),vertexShader:An.shadow_vert,fragmentShader:An.shadow_frag}};function On(t,e,i,n,r,s){const o=new zt(0);let a,l,h=!0===r?0:1,u=null,d=0,p=null;function f(t,e){i.buffers.color.setClear(t.r,t.g,t.b,e,s)}return{getClearColor:function(){return o},setClearColor:function(t,e=1){o.set(t),h=e,f(o,h)},getClearAlpha:function(){return h},setClearAlpha:function(t){h=t,f(o,h)},render:function(i,r){let s=!1,m=!0===r.isScene?r.background:null;m&&m.isTexture&&(m=e.get(m));const g=t.xr,v=g.getSession&&g.getSession();v&&"additive"===v.environmentBlendMode&&(m=null),null===m?f(o,h):m&&m.isColor&&(f(m,1),s=!0),(t.autoClear||s)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),m&&(m.isCubeTexture||m.mapping===c)?(void 0===l&&(l=new nn(new sn(1,1,1),new cn({name:"BackgroundCubeMaterial",uniforms:on(Cn.cube.uniforms),vertexShader:Cn.cube.vertexShader,fragmentShader:Cn.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(t,e,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(l)),l.material.uniforms.envMap.value=m,l.material.uniforms.flipEnvMap.value=m.isCubeTexture&&!1===m.isRenderTargetTexture?-1:1,u===m&&d===m.version&&p===t.toneMapping||(l.material.needsUpdate=!0,u=m,d=m.version,p=t.toneMapping),i.unshift(l,l.geometry,l.material,0,0,null)):m&&m.isTexture&&(void 0===a&&(a=new nn(new Tn(2,2),new cn({name:"BackgroundMaterial",uniforms:on(Cn.background.uniforms),vertexShader:Cn.background.vertexShader,fragmentShader:Cn.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(a)),a.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),a.material.uniforms.uvTransform.value.copy(m.matrix),u===m&&d===m.version&&p===t.toneMapping||(a.material.needsUpdate=!0,u=m,d=m.version,p=t.toneMapping),i.unshift(a,a.geometry,a.material,0,0,null))}}}function Pn(t,e,i,n){const r=t.getParameter(t.MAX_VERTEX_ATTRIBS),s=n.isWebGL2?null:e.get("OES_vertex_array_object"),o=n.isWebGL2||null!==s,a={},l=d(null);let c=l;function h(e){return n.isWebGL2?t.bindVertexArray(e):s.bindVertexArrayOES(e)}function u(e){return n.isWebGL2?t.deleteVertexArray(e):s.deleteVertexArrayOES(e)}function d(t){const e=[],i=[],n=[];for(let t=0;t<r;t++)e[t]=0,i[t]=0,n[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:i,attributeDivisors:n,object:t,attributes:{},index:null}}function p(){const t=c.newAttributes;for(let e=0,i=t.length;e<i;e++)t[e]=0}function f(t){m(t,0)}function m(i,r){const s=c.newAttributes,o=c.enabledAttributes,a=c.attributeDivisors;if(s[i]=1,0===o[i]&&(t.enableVertexAttribArray(i),o[i]=1),a[i]!==r){(n.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,r),a[i]=r}}function g(){const e=c.newAttributes,i=c.enabledAttributes;for(let n=0,r=i.length;n<r;n++)i[n]!==e[n]&&(t.disableVertexAttribArray(n),i[n]=0)}function v(e,i,r,s,o,a){!0!==n.isWebGL2||r!==t.INT&&r!==t.UNSIGNED_INT?t.vertexAttribPointer(e,i,r,s,o,a):t.vertexAttribIPointer(e,i,r,o,a)}function y(){_(),c!==l&&(c=l,h(c.object))}function _(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,u,y,_){let x=!1;if(o){const e=function(e,i,r){const o=!0===r.wireframe;let l=a[e.id];void 0===l&&(l={},a[e.id]=l);let c=l[i.id];void 0===c&&(c={},l[i.id]=c);let h=c[o];void 0===h&&(h=d(n.isWebGL2?t.createVertexArray():s.createVertexArrayOES()),c[o]=h);return h}(y,u,l);c!==e&&(c=e,h(c.object)),x=function(t,e){const i=c.attributes,n=t.attributes;let r=0;for(const t in n){const e=i[t],s=n[t];if(void 0===e)return!0;if(e.attribute!==s)return!0;if(e.data!==s.data)return!0;r++}return c.attributesNum!==r||c.index!==e}(y,_),x&&function(t,e){const i={},n=t.attributes;let r=0;for(const t in n){const e=n[t],s={};s.attribute=e,e.data&&(s.data=e.data),i[t]=s,r++}c.attributes=i,c.attributesNum=r,c.index=e}(y,_)}else{const t=!0===l.wireframe;c.geometry===y.id&&c.program===u.id&&c.wireframe===t||(c.geometry=y.id,c.program=u.id,c.wireframe=t,x=!0)}!0===r.isInstancedMesh&&(x=!0),null!==_&&i.update(_,t.ELEMENT_ARRAY_BUFFER),x&&(!function(r,s,o,a){if(!1===n.isWebGL2&&(r.isInstancedMesh||a.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;p();const l=a.attributes,c=o.getAttributes(),h=s.defaultAttributeValues;for(const e in c){const n=c[e];if(n.location>=0){let s=l[e];if(void 0===s&&("instanceMatrix"===e&&r.instanceMatrix&&(s=r.instanceMatrix),"instanceColor"===e&&r.instanceColor&&(s=r.instanceColor)),void 0!==s){const e=s.normalized,o=s.itemSize,l=i.get(s);if(void 0===l)continue;const c=l.buffer,h=l.type,u=l.bytesPerElement;if(s.isInterleavedBufferAttribute){const i=s.data,l=i.stride,d=s.offset;if(i.isInstancedInterleavedBuffer){for(let t=0;t<n.locationSize;t++)m(n.location+t,i.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let t=0;t<n.locationSize;t++)f(n.location+t);t.bindBuffer(t.ARRAY_BUFFER,c);for(let t=0;t<n.locationSize;t++)v(n.location+t,o/n.locationSize,h,e,l*u,(d+o/n.locationSize*t)*u)}else{if(s.isInstancedBufferAttribute){for(let t=0;t<n.locationSize;t++)m(n.location+t,s.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let t=0;t<n.locationSize;t++)f(n.location+t);t.bindBuffer(t.ARRAY_BUFFER,c);for(let t=0;t<n.locationSize;t++)v(n.location+t,o/n.locationSize,h,e,o*u,o/n.locationSize*t*u)}}else if(void 0!==h){const i=h[e];if(void 0!==i)switch(i.length){case 2:t.vertexAttrib2fv(n.location,i);break;case 3:t.vertexAttrib3fv(n.location,i);break;case 4:t.vertexAttrib4fv(n.location,i);break;default:t.vertexAttrib1fv(n.location,i)}}}}g()}(r,l,u,y),null!==_&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i.get(_).buffer))},reset:y,resetDefaultState:_,dispose:function(){y();for(const t in a){const e=a[t];for(const t in e){const i=e[t];for(const t in i)u(i[t].object),delete i[t];delete e[t]}delete a[t]}},releaseStatesOfGeometry:function(t){if(void 0===a[t.id])return;const e=a[t.id];for(const t in e){const i=e[t];for(const t in i)u(i[t].object),delete i[t];delete e[t]}delete a[t.id]},releaseStatesOfProgram:function(t){for(const e in a){const i=a[e];if(void 0===i[t.id])continue;const n=i[t.id];for(const t in n)u(n[t].object),delete n[t];delete i[t.id]}},initAttributes:p,enableAttribute:f,disableUnusedAttributes:g}}function In(t,e,i,n){const r=n.isWebGL2;let s;this.setMode=function(t){s=t},this.render=function(e,n){t.drawArrays(s,e,n),i.update(n,s,1)},this.renderInstances=function(n,o,a){if(0===a)return;let l,c;if(r)l=t,c="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](s,n,o,a),i.update(o,s,a)}}function Dn(t,e,i){let n;function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let o=void 0!==i.precision?i.precision:"highp";const a=r(o);a!==o&&(o=a);const l=s||e.has("WEBGL_draw_buffers"),c=!0===i.logarithmicDepthBuffer,h=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),u=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),d=t.getParameter(t.MAX_TEXTURE_SIZE),p=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),f=t.getParameter(t.MAX_VERTEX_ATTRIBS),m=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),g=t.getParameter(t.MAX_VARYING_VECTORS),v=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),y=u>0,_=s||e.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===e.has("EXT_texture_filter_anisotropic")){const i=e.get("EXT_texture_filter_anisotropic");n=t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:c,maxTextures:h,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:_,floatVertexTextures:y&&_,maxSamples:s?t.getParameter(t.MAX_SAMPLES):0}}function Ln(t){const e=this;let i=null,n=0,r=!1,s=!1;const o=new _n,a=new Ot,l={value:null,needsUpdate:!1};function c(){l.value!==i&&(l.value=i,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function h(t,i,n,r){const s=null!==t?t.length:0;let c=null;if(0!==s){if(c=l.value,!0!==r||null===c){const e=n+4*s,r=i.matrixWorldInverse;a.getNormalMatrix(r),(null===c||c.length<e)&&(c=new Float32Array(e));for(let e=0,i=n;e!==s;++e,i+=4)o.copy(t[e]).applyMatrix4(r,a),o.normal.toArray(c,i),c[i+3]=o.constant}l.value=c,l.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,s){const o=0!==t.length||e||0!==n||r;return r=e,i=h(t,s,0),n=t.length,o},this.beginShadows=function(){s=!0,h(null)},this.endShadows=function(){s=!1,c()},this.setState=function(e,o,a){const u=e.clippingPlanes,d=e.clipIntersection,p=e.clipShadows,f=t.get(e);if(!r||null===u||0===u.length||s&&!p)s?h(null):c();else{const t=s?0:n,e=4*t;let r=f.clippingState||null;l.value=r,r=h(u,o,e,a);for(let t=0;t!==e;++t)r[t]=i[t];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function Rn(t){let e=new WeakMap;function i(t,e){return e===a?t.mapping=s:e===l&&(t.mapping=o),t}function n(t){const i=t.target;i.removeEventListener("dispose",n);const r=e.get(i);void 0!==r&&(e.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){const s=r.mapping;if(s===a||s===l){if(e.has(r)){return i(e.get(r).texture,r.mapping)}{const s=r.image;if(s&&s.height>0){const o=new mn(s.height/2);return o.fromEquirectangularTexture(t,r),e.set(r,o),r.addEventListener("dispose",n),i(o.texture,r.mapping)}return null}}}return r},dispose:function(){e=new WeakMap}}}Cn.physical={uniforms:an([Cn.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Ct(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new zt(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Ct},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new zt(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new zt(1,1,1)},specularColorMap:{value:null}}]),vertexShader:An.meshphysical_vert,fragmentShader:An.meshphysical_frag};class Bn extends hn{constructor(t=-1,e=1,i=1,n=-1,r=.1,s=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=n,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,i,n,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let r=i-t,s=i+t,o=n+e,a=n-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=t*this.view.offsetX,s=r+t*this.view.width,o-=e*this.view.offsetY,a=o-e*this.view.height}this.projectionMatrix.makeOrthographic(r,s,o,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}Bn.prototype.isOrthographicCamera=!0;const Nn=[.125,.215,.35,.446,.526,.582],Fn=20,Un=new Bn,Gn=new zt;let zn=null;const kn=(1+Math.sqrt(5))/2,jn=1/kn,Hn=[new ee(1,1,1),new ee(-1,1,1),new ee(1,1,-1),new ee(-1,1,-1),new ee(0,kn,jn),new ee(0,kn,-jn),new ee(jn,0,kn),new ee(-jn,0,kn),new ee(kn,jn,0),new ee(-kn,jn,0)];class Vn{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,n=100){zn=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(t,i,n,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Xn(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Jn(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(zn),t.scissorTest=!1,qn(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===s||t.mapping===o?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),zn=this._renderer.getRenderTarget();const i=e||this._allocateTargets();return this._textureToCubeUV(t,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize-32,i={magFilter:v,minFilter:v,generateMipmaps:!1,type:S,format:A,encoding:lt,depthBuffer:!1},n=Wn(t,e,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Wn(t,e,i);const{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(t){const e=[],i=[],n=[];let r=t;const s=t-4+1+Nn.length;for(let o=0;o<s;o++){const s=Math.pow(2,r);i.push(s);let a=1/s;o>t-4?a=Nn[o-t+4-1]:0===o&&(a=0),n.push(a);const l=1/(s-1),c=-l/2,h=1+l/2,u=[c,c,h,c,h,h,c,c,h,h,c,h],d=6,p=6,f=3,m=2,g=1,v=new Float32Array(f*p*d),y=new Float32Array(m*p*d),_=new Float32Array(g*p*d);for(let t=0;t<d;t++){const e=t%3*2/3-1,i=t>2?0:-1,n=[e,i,0,e+2/3,i,0,e+2/3,i+1,0,e,i,0,e+2/3,i+1,0,e,i+1,0];v.set(n,f*p*t),y.set(u,m*p*t);const r=[t,t,t,t,t,t];_.set(r,g*p*t)}const x=new Ui;x.setAttribute("position",new xi(v,f)),x.setAttribute("uv",new xi(y,m)),x.setAttribute("faceIndex",new xi(_,g)),e.push(x),r>4&&r--}return{lodPlanes:e,sizeLods:i,sigmas:n}}(n)),this._blurMaterial=function(t,e,i){const n=new Float32Array(Fn),r=new ee(0,1,0);return new cn({name:"SphericalGaussianBlur",defines:{n:Fn,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:Yn(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(n,t,e)}return n}_compileMaterial(t){const e=new nn(this._lodPlanes[0],t);this._renderer.compile(e,Un)}_sceneToCubeUV(t,e,i,n){const r=new un(90,1,e,i),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,c=a.toneMapping;a.getClearColor(Gn),a.toneMapping=0,a.autoClear=!1;const h=new vi({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),u=new nn(new sn,h);let d=!1;const p=t.background;p?p.isColor&&(h.color.copy(p),t.background=null,d=!0):(h.color.copy(Gn),d=!0);for(let e=0;e<6;e++){const i=e%3;0===i?(r.up.set(0,s[e],0),r.lookAt(o[e],0,0)):1===i?(r.up.set(0,0,s[e]),r.lookAt(0,o[e],0)):(r.up.set(0,s[e],0),r.lookAt(0,0,o[e]));const l=this._cubeSize;qn(n,i*l,e>2?l:0,l,l),a.setRenderTarget(n),d&&a.render(u,r),a.render(t,r)}u.geometry.dispose(),u.material.dispose(),a.toneMapping=c,a.autoClear=l,t.background=p}_textureToCubeUV(t,e){const i=this._renderer,n=t.mapping===s||t.mapping===o;n?(null===this._cubemapMaterial&&(this._cubemapMaterial=Xn()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Jn());const r=n?this._cubemapMaterial:this._equirectMaterial,a=new nn(this._lodPlanes[0],r);r.uniforms.envMap.value=t;const l=this._cubeSize;qn(e,0,0,3*l,2*l),i.setRenderTarget(e),i.render(a,Un)}_applyPMREM(t){const e=this._renderer,i=e.autoClear;e.autoClear=!1;for(let e=1;e<this._lodPlanes.length;e++){const i=Math.sqrt(this._sigmas[e]*this._sigmas[e]-this._sigmas[e-1]*this._sigmas[e-1]),n=Hn[(e-1)%Hn.length];this._blur(t,e-1,e,i,n)}e.autoClear=i}_blur(t,e,i,n,r){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,i,n,"latitudinal",r),this._halfBlur(s,t,i,i,n,"longitudinal",r)}_halfBlur(t,e,i,n,r,s,o){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new nn(this._lodPlanes[n],l),h=l.uniforms,u=this._sizeLods[i]-1,d=isFinite(r)?Math.PI/(2*u):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):Fn,m=[];let g=0;for(let t=0;t<Fn;++t){const e=t/p,i=Math.exp(-e*e/2);m.push(i),0===t?g+=i:t<f&&(g+=2*i)}for(let t=0;t<m.length;t++)m[t]=m[t]/g;h.envMap.value=t.texture,h.samples.value=f,h.weights.value=m,h.latitudinal.value="latitudinal"===s,o&&(h.poleAxis.value=o);const{_lodMax:v}=this;h.dTheta.value=d,h.mipInt.value=v-i;const y=this._sizeLods[n];qn(e,3*y*(n>v-4?n-v+4:0),4*(this._cubeSize-y),3*y,2*y),a.setRenderTarget(e),a.render(c,Un)}}function Wn(t,e,i){const n=new Xt(t,e,i);return n.texture.mapping=c,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function qn(t,e,i,n,r){t.viewport.set(e,i,n,r),t.scissor.set(e,i,n,r)}function Jn(){return new cn({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Yn(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Xn(){return new cn({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Yn(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Yn(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function Zn(t){let e=new WeakMap,i=null;function n(t){const i=t.target;i.removeEventListener("dispose",n);const r=e.get(i);void 0!==r&&(e.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture){const c=r.mapping,h=c===a||c===l,u=c===s||c===o;if(h||u){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;let n=e.get(r);return null===i&&(i=new Vn(t)),n=h?i.fromEquirectangular(r,n):i.fromCubemap(r,n),e.set(r,n),n.texture}if(e.has(r))return e.get(r).texture;{const s=r.image;if(h&&s&&s.height>0||u&&s&&function(t){let e=0;const i=6;for(let n=0;n<i;n++)void 0!==t[n]&&e++;return e===i}(s)){null===i&&(i=new Vn(t));const s=h?i.fromEquirectangular(r):i.fromCubemap(r);return e.set(r,s),r.addEventListener("dispose",n),s.texture}return null}}}return r},dispose:function(){e=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function Kn(t){const e={};function i(i){if(void 0!==e[i])return e[i];let n;switch(i){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(i)}return e[i]=n,n}return{has:function(t){return null!==i(t)},init:function(t){t.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(t){const e=i(t);return e}}}function Qn(t,e,i,n){const r={},s=new WeakMap;function o(t){const a=t.target;null!==a.index&&e.remove(a.index);for(const t in a.attributes)e.remove(a.attributes[t]);a.removeEventListener("dispose",o),delete r[a.id];const l=s.get(a);l&&(e.remove(l),s.delete(a)),n.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,i.memory.geometries--}function a(t){const i=[],n=t.index,r=t.attributes.position;let o=0;if(null!==n){const t=n.array;o=n.version;for(let e=0,n=t.length;e<n;e+=3){const n=t[e+0],r=t[e+1],s=t[e+2];i.push(n,r,r,s,s,n)}}else{const t=r.array;o=r.version;for(let e=0,n=t.length/3-1;e<n;e+=3){const t=e+0,n=e+1,r=e+2;i.push(t,n,n,r,r,t)}}const a=new(Pt(i)?Ei:Ti)(i,1);a.version=o;const l=s.get(t);l&&e.remove(l),s.set(t,a)}return{get:function(t,e){return!0===r[e.id]||(e.addEventListener("dispose",o),r[e.id]=!0,i.memory.geometries++),e},update:function(i){const n=i.attributes;for(const i in n)e.update(n[i],t.ARRAY_BUFFER);const r=i.morphAttributes;for(const i in r){const n=r[i];for(let i=0,r=n.length;i<r;i++)e.update(n[i],t.ARRAY_BUFFER)}},getWireframeAttribute:function(t){const e=s.get(t);if(e){const i=t.index;null!==i&&e.version<i.version&&a(t)}else a(t);return s.get(t)}}}function $n(t,e,i,n){const r=n.isWebGL2;let s,o,a;this.setMode=function(t){s=t},this.setIndex=function(t){o=t.type,a=t.bytesPerElement},this.render=function(e,n){t.drawElements(s,n,o,e*a),i.update(n,s,1)},this.renderInstances=function(n,l,c){if(0===c)return;let h,u;if(r)h=t,u="drawElementsInstanced";else if(h=e.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",null===h)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[u](s,l,o,n*a,c),i.update(l,s,c)}}function tr(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(i,n,r){switch(e.calls++,n){case t.TRIANGLES:e.triangles+=r*(i/3);break;case t.LINES:e.lines+=r*(i/2);break;case t.LINE_STRIP:e.lines+=r*(i-1);break;case t.LINE_LOOP:e.lines+=r*i;break;case t.POINTS:e.points+=r*i;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function er(t,e){return t[0]-e[0]}function ir(t,e){return Math.abs(e[1])-Math.abs(t[1])}function nr(t,e){let i=1;const n=e.isInterleavedBufferAttribute?e.data.array:e.array;n instanceof Int8Array?i=127:n instanceof Int16Array?i=32767:n instanceof Int32Array?i=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",n),t.divideScalar(i)}function rr(t,e,i){const n={},r=new Float32Array(8),s=new WeakMap,o=new Jt,a=[];for(let t=0;t<8;t++)a[t]=[t,0];return{update:function(l,c,h,u){const d=l.morphTargetInfluences;if(!0===e.isWebGL2){const p=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,f=void 0!==p?p.length:0;let m=s.get(c);if(void 0===m||m.count!==f){void 0!==m&&m.texture.dispose();const y=void 0!==c.morphAttributes.position,_=void 0!==c.morphAttributes.normal,x=void 0!==c.morphAttributes.color,M=c.morphAttributes.position||[],b=c.morphAttributes.normal||[],S=c.morphAttributes.color||[];let T=0;!0===y&&(T=1),!0===_&&(T=2),!0===x&&(T=3);let E=c.attributes.position.count*T,C=1;E>e.maxTextureSize&&(C=Math.ceil(E/e.maxTextureSize),E=e.maxTextureSize);const O=new Float32Array(E*C*4*f),P=new Yt(O,E,C,f);P.format=A,P.type=w,P.needsUpdate=!0;const I=4*T;for(let L=0;L<f;L++){const R=M[L],B=b[L],N=S[L],F=E*C*4*L;for(let U=0;U<R.count;U++){const G=U*I;!0===y&&(o.fromBufferAttribute(R,U),!0===R.normalized&&nr(o,R),O[F+G+0]=o.x,O[F+G+1]=o.y,O[F+G+2]=o.z,O[F+G+3]=0),!0===_&&(o.fromBufferAttribute(B,U),!0===B.normalized&&nr(o,B),O[F+G+4]=o.x,O[F+G+5]=o.y,O[F+G+6]=o.z,O[F+G+7]=0),!0===x&&(o.fromBufferAttribute(N,U),!0===N.normalized&&nr(o,B),O[F+G+8]=o.x,O[F+G+9]=o.y,O[F+G+10]=o.z,O[F+G+11]=4===N.itemSize?o.w:1)}}function D(){P.dispose(),s.delete(c),c.removeEventListener("dispose",D)}m={count:f,texture:P,size:new Ct(E,C)},s.set(c,m),c.addEventListener("dispose",D)}let g=0;for(let z=0;z<d.length;z++)g+=d[z];const v=c.morphTargetsRelative?1:1-g;u.getUniforms().setValue(t,"morphTargetBaseInfluence",v),u.getUniforms().setValue(t,"morphTargetInfluences",d),u.getUniforms().setValue(t,"morphTargetsTexture",m.texture,i),u.getUniforms().setValue(t,"morphTargetsTextureSize",m.size)}else{const k=void 0===d?0:d.length;let j=n[c.id];if(void 0===j||j.length!==k){j=[];for(let J=0;J<k;J++)j[J]=[J,0];n[c.id]=j}for(let X=0;X<k;X++){const Y=j[X];Y[0]=X,Y[1]=d[X]}j.sort(ir);for(let Z=0;Z<8;Z++)Z<k&&j[Z][1]?(a[Z][0]=j[Z][0],a[Z][1]=j[Z][1]):(a[Z][0]=Number.MAX_SAFE_INTEGER,a[Z][1]=0);a.sort(er);const H=c.morphAttributes.position,V=c.morphAttributes.normal;let W=0;for(let K=0;K<8;K++){const Q=a[K],$=Q[0],tt=Q[1];$!==Number.MAX_SAFE_INTEGER&&tt?(H&&c.getAttribute("morphTarget"+K)!==H[$]&&c.setAttribute("morphTarget"+K,H[$]),V&&c.getAttribute("morphNormal"+K)!==V[$]&&c.setAttribute("morphNormal"+K,V[$]),r[K]=tt,W+=tt):(H&&!0===c.hasAttribute("morphTarget"+K)&&c.deleteAttribute("morphTarget"+K),V&&!0===c.hasAttribute("morphNormal"+K)&&c.deleteAttribute("morphNormal"+K),r[K]=0)}const q=c.morphTargetsRelative?1:1-W;u.getUniforms().setValue(t,"morphTargetBaseInfluence",q),u.getUniforms().setValue(t,"morphTargetInfluences",r)}}}}function sr(t,e,i,n){let r=new WeakMap;function s(t){const e=t.target;e.removeEventListener("dispose",s),i.remove(e.instanceMatrix),null!==e.instanceColor&&i.remove(e.instanceColor)}return{update:function(o){const a=n.render.frame,l=o.geometry,c=e.get(o,l);return r.get(c)!==a&&(e.update(c),r.set(c,a)),o.isInstancedMesh&&(!1===o.hasEventListener("dispose",s)&&o.addEventListener("dispose",s),i.update(o.instanceMatrix,t.ARRAY_BUFFER),null!==o.instanceColor&&i.update(o.instanceColor,t.ARRAY_BUFFER)),c},dispose:function(){r=new WeakMap}}}const or=new qt,ar=new Yt,lr=new Kt,cr=new fn,hr=[],ur=[],dr=new Float32Array(16),pr=new Float32Array(9),fr=new Float32Array(4);function mr(t,e,i){const n=t[0];if(n<=0||n>0)return t;const r=e*i;let s=hr[r];if(void 0===s&&(s=new Float32Array(r),hr[r]=s),0!==e){n.toArray(s,0);for(let n=1,r=0;n!==e;++n)r+=i,t[n].toArray(s,r)}return s}function gr(t,e){if(t.length!==e.length)return!1;for(let i=0,n=t.length;i<n;i++)if(t[i]!==e[i])return!1;return!0}function vr(t,e){for(let i=0,n=e.length;i<n;i++)t[i]=e[i]}function yr(t,e){let i=ur[e];void 0===i&&(i=new Int32Array(e),ur[e]=i);for(let n=0;n!==e;++n)i[n]=t.allocateTextureUnit();return i}function _r(t,e){const i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function xr(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(gr(i,e))return;t.uniform2fv(this.addr,e),vr(i,e)}}function Mr(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(void 0!==e.r)i[0]===e.r&&i[1]===e.g&&i[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(gr(i,e))return;t.uniform3fv(this.addr,e),vr(i,e)}}function br(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(gr(i,e))return;t.uniform4fv(this.addr,e),vr(i,e)}}function wr(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(gr(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),vr(i,e)}else{if(gr(i,n))return;fr.set(n),t.uniformMatrix2fv(this.addr,!1,fr),vr(i,n)}}function Sr(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(gr(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),vr(i,e)}else{if(gr(i,n))return;pr.set(n),t.uniformMatrix3fv(this.addr,!1,pr),vr(i,n)}}function Tr(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(gr(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),vr(i,e)}else{if(gr(i,n))return;dr.set(n),t.uniformMatrix4fv(this.addr,!1,dr),vr(i,n)}}function Ar(t,e){const i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function Er(t,e){const i=this.cache;gr(i,e)||(t.uniform2iv(this.addr,e),vr(i,e))}function Cr(t,e){const i=this.cache;gr(i,e)||(t.uniform3iv(this.addr,e),vr(i,e))}function Or(t,e){const i=this.cache;gr(i,e)||(t.uniform4iv(this.addr,e),vr(i,e))}function Pr(t,e){const i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function Ir(t,e){const i=this.cache;gr(i,e)||(t.uniform2uiv(this.addr,e),vr(i,e))}function Dr(t,e){const i=this.cache;gr(i,e)||(t.uniform3uiv(this.addr,e),vr(i,e))}function Lr(t,e){const i=this.cache;gr(i,e)||(t.uniform4uiv(this.addr,e),vr(i,e))}function Rr(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture2D(e||or,r)}function Br(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(e||lr,r)}function Nr(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTextureCube(e||cr,r)}function Fr(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(e||ar,r)}function Ur(t,e){t.uniform1fv(this.addr,e)}function Gr(t,e){const i=mr(e,this.size,2);t.uniform2fv(this.addr,i)}function zr(t,e){const i=mr(e,this.size,3);t.uniform3fv(this.addr,i)}function kr(t,e){const i=mr(e,this.size,4);t.uniform4fv(this.addr,i)}function jr(t,e){const i=mr(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function Hr(t,e){const i=mr(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function Vr(t,e){const i=mr(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function Wr(t,e){t.uniform1iv(this.addr,e)}function qr(t,e){t.uniform2iv(this.addr,e)}function Jr(t,e){t.uniform3iv(this.addr,e)}function Xr(t,e){t.uniform4iv(this.addr,e)}function Yr(t,e){t.uniform1uiv(this.addr,e)}function Zr(t,e){t.uniform2uiv(this.addr,e)}function Kr(t,e){t.uniform3uiv(this.addr,e)}function Qr(t,e){t.uniform4uiv(this.addr,e)}function $r(t,e,i){const n=e.length,r=yr(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.setTexture2D(e[t]||or,r[t])}function ts(t,e,i){const n=e.length,r=yr(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.setTexture3D(e[t]||lr,r[t])}function es(t,e,i){const n=e.length,r=yr(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.setTextureCube(e[t]||cr,r[t])}function is(t,e,i){const n=e.length,r=yr(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.setTexture2DArray(e[t]||ar,r[t])}function ns(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=function(t){switch(t){case 5126:return _r;case 35664:return xr;case 35665:return Mr;case 35666:return br;case 35674:return wr;case 35675:return Sr;case 35676:return Tr;case 5124:case 35670:return Ar;case 35667:case 35671:return Er;case 35668:case 35672:return Cr;case 35669:case 35673:return Or;case 5125:return Pr;case 36294:return Ir;case 36295:return Dr;case 36296:return Lr;case 35678:case 36198:case 36298:case 36306:case 35682:return Rr;case 35679:case 36299:case 36307:return Br;case 35680:case 36300:case 36308:case 36293:return Nr;case 36289:case 36303:case 36311:case 36292:return Fr}}(e.type)}function rs(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return Ur;case 35664:return Gr;case 35665:return zr;case 35666:return kr;case 35674:return jr;case 35675:return Hr;case 35676:return Vr;case 5124:case 35670:return Wr;case 35667:case 35671:return qr;case 35668:case 35672:return Jr;case 35669:case 35673:return Xr;case 5125:return Yr;case 36294:return Zr;case 36295:return Kr;case 36296:return Qr;case 35678:case 36198:case 36298:case 36306:case 35682:return $r;case 35679:case 36299:case 36307:return ts;case 35680:case 36300:case 36308:case 36293:return es;case 36289:case 36303:case 36311:case 36292:return is}}(e.type)}function ss(t){this.id=t,this.seq=[],this.map={}}rs.prototype.updateCache=function(t){const e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),vr(e,t)},ss.prototype.setValue=function(t,e,i){const n=this.seq;for(let r=0,s=n.length;r!==s;++r){const s=n[r];s.setValue(t,e[s.id],i)}};const os=/(\w+)(\])?(\[|\.)?/g;function as(t,e){t.seq.push(e),t.map[e.id]=e}function ls(t,e,i){const n=t.name,r=n.length;for(os.lastIndex=0;;){const s=os.exec(n),o=os.lastIndex;let a=s[1];const l="]"===s[2],c=s[3];if(l&&(a|=0),void 0===c||"["===c&&o+2===r){as(i,void 0===c?new ns(a,t,e):new rs(a,t,e));break}{let t=i.map[a];void 0===t&&(t=new ss(a),as(i,t)),i=t}}}function cs(t,e){this.seq=[],this.map={};const i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let n=0;n<i;++n){const i=t.getActiveUniform(e,n);ls(i,t.getUniformLocation(e,i.name),this)}}function hs(t,e,i){const n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),n}cs.prototype.setValue=function(t,e,i,n){const r=this.map[e];void 0!==r&&r.setValue(t,i,n)},cs.prototype.setOptional=function(t,e,i){const n=e[i];void 0!==n&&this.setValue(t,i,n)},cs.upload=function(t,e,i,n){for(let r=0,s=e.length;r!==s;++r){const s=e[r],o=i[s.id];!1!==o.needsUpdate&&s.setValue(t,o.value,n)}},cs.seqWithValue=function(t,e){const i=[];for(let n=0,r=t.length;n!==r;++n){const r=t[n];r.id in e&&i.push(r)}return i};let us=0;function ds(t,e,i){const n=t.getShaderParameter(e,t.COMPILE_STATUS),r=t.getShaderInfoLog(e).trim();return n&&""===r?"":i.toUpperCase()+"\n\n"+r+"\n\n"+function(t){const e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}(t.getShaderSource(e))}function ps(t,e){const i=function(t){switch(t){case lt:return["Linear","( value )"];case ct:return["sRGB","( value )"];default:return["Linear","( value )"]}}(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function fs(t,e){let i;switch(e){case 1:default:i="Linear";break;case 2:i="Reinhard";break;case 3:i="OptimizedCineon";break;case 4:i="ACESFilmic";break;case 5:i="Custom"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function ms(t){return""!==t}function gs(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function vs(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const ys=/^[ \t]*#include +<([\w\d./]+)>/gm;function _s(t){return t.replace(ys,xs)}function xs(t,e){const i=An[e];if(void 0===i)throw new Error("Can not resolve #include <"+e+">");return _s(i)}const Ms=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,bs=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function ws(t){return t.replace(bs,Ts).replace(Ms,Ss)}function Ss(t,e,i,n){return Ts(t,e,i,n)}function Ts(t,e,i,n){let r="";for(let t=parseInt(e);t<parseInt(i);t++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return r}function As(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function Es(t,e,i,n){const r=t.getContext(),a=i.defines;let l=i.vertexShader,u=i.fragmentShader;const d=function(t){let e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(i),p=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case s:case o:e="ENVMAP_TYPE_CUBE";break;case c:case h:e="ENVMAP_TYPE_CUBE_UV"}return e}(i),f=function(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case o:case h:e="ENVMAP_MODE_REFRACTION"}return e}(i),m=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(i),g=function(t){const e=t.envMapCubeUVHeight;if(null===e)return null;const i=Math.log2(e/32+1)+3,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:n,maxMip:i}}(i),v=i.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ms).join("\n")}(i),y=function(t){const e=[];for(const i in t){const n=t[i];!1!==n&&e.push("#define "+i+" "+n)}return e.join("\n")}(a),_=r.createProgram();let x,M,b=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(x=[y].filter(ms).join("\n"),x.length>0&&(x+="\n"),M=[v,y].filter(ms).join("\n"),M.length>0&&(M+="\n")):(x=[As(i),"#define SHADER_NAME "+i.shaderName,y,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+f:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+d:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ms).join("\n"),M=[v,As(i),"#define SHADER_NAME "+i.shaderName,y,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+p:"",i.envMap?"#define "+f:"",i.envMap?"#define "+m:"",g?"#define CUBEUV_TEXEL_WIDTH "+g.texelWidth:"",g?"#define CUBEUV_TEXEL_HEIGHT "+g.texelHeight:"",g?"#define CUBEUV_MAX_MIP "+g.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+d:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==i.toneMapping?"#define TONE_MAPPING":"",0!==i.toneMapping?An.tonemapping_pars_fragment:"",0!==i.toneMapping?fs("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",An.encodings_pars_fragment,ps("linearToOutputTexel",i.outputEncoding),i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(ms).join("\n")),l=_s(l),l=gs(l,i),l=vs(l,i),u=_s(u),u=gs(u,i),u=vs(u,i),l=ws(l),u=ws(u),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(b="#version 300 es\n",x=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+x,M=["#define varying in",i.glslVersion===pt?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===pt?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+M);const w=b+x+l,S=b+M+u,T=hs(r,r.VERTEX_SHADER,w),A=hs(r,r.FRAGMENT_SHADER,S);if(r.attachShader(_,T),r.attachShader(_,A),void 0!==i.index0AttributeName?r.bindAttribLocation(_,0,i.index0AttributeName):!0===i.morphTargets&&r.bindAttribLocation(_,0,"position"),r.linkProgram(_),t.debug.checkShaderErrors){const t=r.getProgramInfoLog(_).trim(),e=r.getShaderInfoLog(T).trim(),i=r.getShaderInfoLog(A).trim();let n=!0,s=!0;if(!1===r.getProgramParameter(_,r.LINK_STATUS)){n=!1;const e=ds(r,T,"vertex"),i=ds(r,A,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(_,r.VALIDATE_STATUS)+"\n\nProgram Info Log: "+t+"\n"+e+"\n"+i)}else""!==t||""!==e&&""!==i||(s=!1);s&&(this.diagnostics={runnable:n,programLog:t,vertexShader:{log:e,prefix:x},fragmentShader:{log:i,prefix:M}})}let E,C;return r.deleteShader(T),r.deleteShader(A),this.getUniforms=function(){return void 0===E&&(E=new cs(r,_)),E},this.getAttributes=function(){return void 0===C&&(C=function(t,e){const i={},n=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let r=0;r<n;r++){const n=t.getActiveAttrib(e,r),s=n.name;let o=1;n.type===t.FLOAT_MAT2&&(o=2),n.type===t.FLOAT_MAT3&&(o=3),n.type===t.FLOAT_MAT4&&(o=4),i[s]={type:n.type,location:t.getAttribLocation(e,s),locationSize:o}}return i}(r,_)),C},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(_),this.program=void 0},this.name=i.shaderName,this.id=us++,this.cacheKey=e,this.usedTimes=1,this.program=_,this.vertexShader=T,this.fragmentShader=A,this}let Cs=0;class Os{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,i=t.fragmentShader,n=this._getShaderStage(e),r=this._getShaderStage(i),s=this._getShaderCacheForMaterial(t);return!1===s.has(n)&&(s.add(n),n.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const t of e)t.usedTimes--,0===t.usedTimes&&this.shaderCache.delete(t);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;return!1===e.has(t)&&e.set(t,new Set),e.get(t)}_getShaderStage(t){const e=this.shaderCache;if(!1===e.has(t)){const i=new Ps;e.set(t,i)}return e.get(t)}}class Ps{constructor(){this.id=Cs++,this.usedTimes=0}}function Is(t,e,i,n,r,s,o){const a=new He,l=new Os,u=[],d=r.isWebGL2,p=r.logarithmicDepthBuffer,f=r.floatVertexTextures,m=r.maxVertexUniforms,g=r.vertexTextures;let v=r.precision;const y={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(s,a,u,_,x){const M=_.fog,b=x.geometry,w=s.isMeshStandardMaterial?_.environment:null,S=(s.isMeshStandardMaterial?i:e).get(s.envMap||w),T=!S||S.mapping!==c&&S.mapping!==h?null:S.image.height,A=y[s.type],E=x.isSkinnedMesh?function(t){const e=t.skeleton.bones;if(f)return 1024;{const t=m,i=Math.floor((t-20)/4),n=Math.min(i,e.length);return n<e.length?(e.length,0):n}}(x):0;null!==s.precision&&(v=r.getMaxPrecision(s.precision),v!==s.precision&&s.precision);const C=b.morphAttributes.position||b.morphAttributes.normal||b.morphAttributes.color,O=void 0!==C?C.length:0;let P,I,D,L,R=0;if(void 0!==b.morphAttributes.position&&(R=1),void 0!==b.morphAttributes.normal&&(R=2),void 0!==b.morphAttributes.color&&(R=3),A){const t=Cn[A];P=t.vertexShader,I=t.fragmentShader}else P=s.vertexShader,I=s.fragmentShader,l.update(s),D=l.getVertexShaderID(s),L=l.getFragmentShaderID(s);const B=t.getRenderTarget(),N=s.alphaTest>0,F=s.clearcoat>0;return{isWebGL2:d,shaderID:A,shaderName:s.type,vertexShader:P,fragmentShader:I,defines:s.defines,customVertexShaderID:D,customFragmentShaderID:L,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:v,instancing:!0===x.isInstancedMesh,instancingColor:!0===x.isInstancedMesh&&null!==x.instanceColor,supportsVertexTextures:g,outputEncoding:null===B?t.outputEncoding:!0===B.isXRRenderTarget?B.texture.encoding:lt,map:!!s.map,matcap:!!s.matcap,envMap:!!S,envMapMode:S&&S.mapping,envMapCubeUVHeight:T,lightMap:!!s.lightMap,aoMap:!!s.aoMap,emissiveMap:!!s.emissiveMap,bumpMap:!!s.bumpMap,normalMap:!!s.normalMap,objectSpaceNormalMap:1===s.normalMapType,tangentSpaceNormalMap:0===s.normalMapType,decodeVideoTexture:!!s.map&&!0===s.map.isVideoTexture&&s.map.encoding===ct,clearcoat:F,clearcoatMap:F&&!!s.clearcoatMap,clearcoatRoughnessMap:F&&!!s.clearcoatRoughnessMap,clearcoatNormalMap:F&&!!s.clearcoatNormalMap,displacementMap:!!s.displacementMap,roughnessMap:!!s.roughnessMap,metalnessMap:!!s.metalnessMap,specularMap:!!s.specularMap,specularIntensityMap:!!s.specularIntensityMap,specularColorMap:!!s.specularColorMap,opaque:!1===s.transparent&&1===s.blending,alphaMap:!!s.alphaMap,alphaTest:N,gradientMap:!!s.gradientMap,sheen:s.sheen>0,sheenColorMap:!!s.sheenColorMap,sheenRoughnessMap:!!s.sheenRoughnessMap,transmission:s.transmission>0,transmissionMap:!!s.transmissionMap,thicknessMap:!!s.thicknessMap,combine:s.combine,vertexTangents:!!s.normalMap&&!!b.attributes.tangent,vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!b.attributes.color&&4===b.attributes.color.itemSize,vertexUvs:!!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatMap||s.clearcoatRoughnessMap||s.clearcoatNormalMap||s.displacementMap||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheenColorMap||s.sheenRoughnessMap),uvsVertexOnly:!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatNormalMap||s.transmission>0||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheen>0||s.sheenColorMap||s.sheenRoughnessMap||!s.displacementMap),fog:!!M,useFog:s.fog,fogExp2:M&&M.isFogExp2,flatShading:!!s.flatShading,sizeAttenuation:s.sizeAttenuation,logarithmicDepthBuffer:p,skinning:!0===x.isSkinnedMesh&&E>0,maxBones:E,useVertexTexture:f,morphTargets:void 0!==b.morphAttributes.position,morphNormals:void 0!==b.morphAttributes.normal,morphColors:void 0!==b.morphAttributes.color,morphTargetsCount:O,morphTextureStride:R,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:s.dithering,shadowMapEnabled:t.shadowMap.enabled&&u.length>0,shadowMapType:t.shadowMap.type,toneMapping:s.toneMapped?t.toneMapping:0,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:s.premultipliedAlpha,doubleSided:2===s.side,flipSided:1===s.side,depthPacking:void 0!==s.depthPacking&&s.depthPacking,index0AttributeName:s.index0AttributeName,extensionDerivatives:s.extensions&&s.extensions.derivatives,extensionFragDepth:s.extensions&&s.extensions.fragDepth,extensionDrawBuffers:s.extensions&&s.extensions.drawBuffers,extensionShaderTextureLOD:s.extensions&&s.extensions.shaderTextureLOD,rendererExtensionFragDepth:d||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:d||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:d||n.has("EXT_shader_texture_lod"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(e){const i=[];if(e.shaderID?i.push(e.shaderID):(i.push(e.customVertexShaderID),i.push(e.customFragmentShaderID)),void 0!==e.defines)for(const t in e.defines)i.push(t),i.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(!function(t,e){t.push(e.precision),t.push(e.outputEncoding),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.combine),t.push(e.vertexUvs),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.maxBones),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection)}(i,e),function(t,e){a.disableAll(),e.isWebGL2&&a.enable(0);e.supportsVertexTextures&&a.enable(1);e.instancing&&a.enable(2);e.instancingColor&&a.enable(3);e.map&&a.enable(4);e.matcap&&a.enable(5);e.envMap&&a.enable(6);e.lightMap&&a.enable(7);e.aoMap&&a.enable(8);e.emissiveMap&&a.enable(9);e.bumpMap&&a.enable(10);e.normalMap&&a.enable(11);e.objectSpaceNormalMap&&a.enable(12);e.tangentSpaceNormalMap&&a.enable(13);e.clearcoat&&a.enable(14);e.clearcoatMap&&a.enable(15);e.clearcoatRoughnessMap&&a.enable(16);e.clearcoatNormalMap&&a.enable(17);e.displacementMap&&a.enable(18);e.specularMap&&a.enable(19);e.roughnessMap&&a.enable(20);e.metalnessMap&&a.enable(21);e.gradientMap&&a.enable(22);e.alphaMap&&a.enable(23);e.alphaTest&&a.enable(24);e.vertexColors&&a.enable(25);e.vertexAlphas&&a.enable(26);e.vertexUvs&&a.enable(27);e.vertexTangents&&a.enable(28);e.uvsVertexOnly&&a.enable(29);e.fog&&a.enable(30);t.push(a.mask),a.disableAll(),e.useFog&&a.enable(0);e.flatShading&&a.enable(1);e.logarithmicDepthBuffer&&a.enable(2);e.skinning&&a.enable(3);e.useVertexTexture&&a.enable(4);e.morphTargets&&a.enable(5);e.morphNormals&&a.enable(6);e.morphColors&&a.enable(7);e.premultipliedAlpha&&a.enable(8);e.shadowMapEnabled&&a.enable(9);e.physicallyCorrectLights&&a.enable(10);e.doubleSided&&a.enable(11);e.flipSided&&a.enable(12);e.depthPacking&&a.enable(13);e.dithering&&a.enable(14);e.specularIntensityMap&&a.enable(15);e.specularColorMap&&a.enable(16);e.transmission&&a.enable(17);e.transmissionMap&&a.enable(18);e.thicknessMap&&a.enable(19);e.sheen&&a.enable(20);e.sheenColorMap&&a.enable(21);e.sheenRoughnessMap&&a.enable(22);e.decodeVideoTexture&&a.enable(23);e.opaque&&a.enable(24);t.push(a.mask)}(i,e),i.push(t.outputEncoding)),i.push(e.customProgramCacheKey),i.join()},getUniforms:function(t){const e=y[t.type];let i;if(e){const t=Cn[e];i=ln.clone(t.uniforms)}else i=t.uniforms;return i},acquireProgram:function(e,i){let n;for(let t=0,e=u.length;t<e;t++){const e=u[t];if(e.cacheKey===i){n=e,++n.usedTimes;break}}return void 0===n&&(n=new Es(t,i,e,s),u.push(n)),n},releaseProgram:function(t){if(0==--t.usedTimes){const e=u.indexOf(t);u[e]=u[u.length-1],u.pop(),t.destroy()}},releaseShaderCache:function(t){l.remove(t)},programs:u,dispose:function(){l.dispose()}}}function Ds(){let t=new WeakMap;return{get:function(e){let i=t.get(e);return void 0===i&&(i={},t.set(e,i)),i},remove:function(e){t.delete(e)},update:function(e,i,n){t.get(e)[i]=n},dispose:function(){t=new WeakMap}}}function Ls(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Rs(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Bs(){const t=[];let e=0;const i=[],n=[],r=[];function s(i,n,r,s,o,a){let l=t[e];return void 0===l?(l={id:i.id,object:i,geometry:n,material:r,groupOrder:s,renderOrder:i.renderOrder,z:o,group:a},t[e]=l):(l.id=i.id,l.object=i,l.geometry=n,l.material=r,l.groupOrder=s,l.renderOrder=i.renderOrder,l.z=o,l.group=a),e++,l}return{opaque:i,transmissive:n,transparent:r,init:function(){e=0,i.length=0,n.length=0,r.length=0},push:function(t,e,o,a,l,c){const h=s(t,e,o,a,l,c);o.transmission>0?n.push(h):!0===o.transparent?r.push(h):i.push(h)},unshift:function(t,e,o,a,l,c){const h=s(t,e,o,a,l,c);o.transmission>0?n.unshift(h):!0===o.transparent?r.unshift(h):i.unshift(h)},finish:function(){for(let i=e,n=t.length;i<n;i++){const e=t[i];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(t,e){i.length>1&&i.sort(t||Ls),n.length>1&&n.sort(e||Rs),r.length>1&&r.sort(e||Rs)}}}function Ns(){let t=new WeakMap;return{get:function(e,i){let n;return!1===t.has(e)?(n=new Bs,t.set(e,[n])):i>=t.get(e).length?(n=new Bs,t.get(e).push(n)):n=t.get(e)[i],n},dispose:function(){t=new WeakMap}}}function Fs(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new ee,color:new zt};break;case"SpotLight":i={position:new ee,direction:new ee,color:new zt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new ee,color:new zt,distance:0,decay:0};break;case"HemisphereLight":i={direction:new ee,skyColor:new zt,groundColor:new zt};break;case"RectAreaLight":i={color:new zt,position:new ee,halfWidth:new ee,halfHeight:new ee}}return t[e.id]=i,i}}}let Us=0;function Gs(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function zs(t,e){const i=new Fs,n=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ct};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ct,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=i,i}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let t=0;t<9;t++)r.probe.push(new ee);const s=new ee,o=new De,a=new De;return{setup:function(s,o){let a=0,l=0,c=0;for(let t=0;t<9;t++)r.probe[t].set(0,0,0);let h=0,u=0,d=0,p=0,f=0,m=0,g=0,v=0;s.sort(Gs);const y=!0!==o?Math.PI:1;for(let t=0,e=s.length;t<e;t++){const e=s[t],o=e.color,_=e.intensity,x=e.distance,M=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)a+=o.r*_*y,l+=o.g*_*y,c+=o.b*_*y;else if(e.isLightProbe)for(let t=0;t<9;t++)r.probe[t].addScaledVector(e.sh.coefficients[t],_);else if(e.isDirectionalLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*y),e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,r.directionalShadow[h]=i,r.directionalShadowMap[h]=M,r.directionalShadowMatrix[h]=e.shadow.matrix,m++}r.directional[h]=t,h++}else if(e.isSpotLight){const t=i.get(e);if(t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(o).multiplyScalar(_*y),t.distance=x,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,r.spotShadow[d]=i,r.spotShadowMap[d]=M,r.spotShadowMatrix[d]=e.shadow.matrix,v++}r.spot[d]=t,d++}else if(e.isRectAreaLight){const t=i.get(e);t.color.copy(o).multiplyScalar(_),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),r.rectArea[p]=t,p++}else if(e.isPointLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*y),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,i.shadowCameraNear=t.camera.near,i.shadowCameraFar=t.camera.far,r.pointShadow[u]=i,r.pointShadowMap[u]=M,r.pointShadowMatrix[u]=e.shadow.matrix,g++}r.point[u]=t,u++}else if(e.isHemisphereLight){const t=i.get(e);t.skyColor.copy(e.color).multiplyScalar(_*y),t.groundColor.copy(e.groundColor).multiplyScalar(_*y),r.hemi[f]=t,f++}}p>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(r.rectAreaLTC1=En.LTC_FLOAT_1,r.rectAreaLTC2=En.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=En.LTC_HALF_1,r.rectAreaLTC2=En.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=a,r.ambient[1]=l,r.ambient[2]=c;const _=r.hash;_.directionalLength===h&&_.pointLength===u&&_.spotLength===d&&_.rectAreaLength===p&&_.hemiLength===f&&_.numDirectionalShadows===m&&_.numPointShadows===g&&_.numSpotShadows===v||(r.directional.length=h,r.spot.length=d,r.rectArea.length=p,r.point.length=u,r.hemi.length=f,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=v,r.spotShadowMap.length=v,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=g,r.spotShadowMatrix.length=v,_.directionalLength=h,_.pointLength=u,_.spotLength=d,_.rectAreaLength=p,_.hemiLength=f,_.numDirectionalShadows=m,_.numPointShadows=g,_.numSpotShadows=v,r.version=Us++)},setupView:function(t,e){let i=0,n=0,l=0,c=0,h=0;const u=e.matrixWorldInverse;for(let e=0,d=t.length;e<d;e++){const d=t[e];if(d.isDirectionalLight){const t=r.directional[i];t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(u),i++}else if(d.isSpotLight){const t=r.spot[l];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(u),l++}else if(d.isRectAreaLight){const t=r.rectArea[c];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),a.identity(),o.copy(d.matrixWorld),o.premultiply(u),a.extractRotation(o),t.halfWidth.set(.5*d.width,0,0),t.halfHeight.set(0,.5*d.height,0),t.halfWidth.applyMatrix4(a),t.halfHeight.applyMatrix4(a),c++}else if(d.isPointLight){const t=r.point[n];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),n++}else if(d.isHemisphereLight){const t=r.hemi[h];t.direction.setFromMatrixPosition(d.matrixWorld),t.direction.transformDirection(u),t.direction.normalize(),h++}}},state:r}}function ks(t,e){const i=new zs(t,e),n=[],r=[];return{init:function(){n.length=0,r.length=0},state:{lightsArray:n,shadowsArray:r,lights:i},setupLights:function(t){i.setup(n,t)},setupLightsView:function(t){i.setupView(n,t)},pushLight:function(t){n.push(t)},pushShadow:function(t){r.push(t)}}}function js(t,e){let i=new WeakMap;return{get:function(n,r=0){let s;return!1===i.has(n)?(s=new ks(t,e),i.set(n,[s])):r>=i.get(n).length?(s=new ks(t,e),i.get(n).push(s)):s=i.get(n)[r],s},dispose:function(){i=new WeakMap}}}class Hs extends gi{constructor(t){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}Hs.prototype.isMeshDepthMaterial=!0;class Vs extends gi{constructor(t){super(),this.type="MeshDistanceMaterial",this.referencePosition=new ee,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}Vs.prototype.isMeshDistanceMaterial=!0;function Ws(t,e,i){let n=new bn;const r=new Ct,s=new Ct,o=new Jt,a=new Hs({depthPacking:3201}),l=new Vs,c={},h=i.maxTextureSize,u={0:1,1:0,2:2},d=new cn({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ct},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const m=new Ui;m.setAttribute("position",new xi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const g=new nn(m,d),y=this;function _(i,n){const r=e.update(g);d.defines.VSM_SAMPLES!==i.blurSamples&&(d.defines.VSM_SAMPLES=i.blurSamples,p.defines.VSM_SAMPLES=i.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),d.uniforms.shadow_pass.value=i.map.texture,d.uniforms.resolution.value=i.mapSize,d.uniforms.radius.value=i.radius,t.setRenderTarget(i.mapPass),t.clear(),t.renderBufferDirect(n,null,r,d,g,null),p.uniforms.shadow_pass.value=i.mapPass.texture,p.uniforms.resolution.value=i.mapSize,p.uniforms.radius.value=i.radius,t.setRenderTarget(i.map),t.clear(),t.renderBufferDirect(n,null,r,p,g,null)}function x(e,i,n,r,s,o){let h=null;const d=!0===n.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(h=void 0!==d?d:!0===n.isPointLight?l:a,t.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&i.alphaTest>0){const t=h.uuid,e=i.uuid;let n=c[t];void 0===n&&(n={},c[t]=n);let r=n[e];void 0===r&&(r=h.clone(),n[e]=r),h=r}return h.visible=i.visible,h.wireframe=i.wireframe,h.side=3===o?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:u[i.side],h.alphaMap=i.alphaMap,h.alphaTest=i.alphaTest,h.clipShadows=i.clipShadows,h.clippingPlanes=i.clippingPlanes,h.clipIntersection=i.clipIntersection,h.displacementMap=i.displacementMap,h.displacementScale=i.displacementScale,h.displacementBias=i.displacementBias,h.wireframeLinewidth=i.wireframeLinewidth,h.linewidth=i.linewidth,!0===n.isPointLight&&!0===h.isMeshDistanceMaterial&&(h.referencePosition.setFromMatrixPosition(n.matrixWorld),h.nearDistance=r,h.farDistance=s),h}function M(i,r,s,o,a){if(!1===i.visible)return;if(i.layers.test(r.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&3===a)&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,i.matrixWorld);const n=e.update(i),r=i.material;if(Array.isArray(r)){const e=n.groups;for(let l=0,c=e.length;l<c;l++){const c=e[l],h=r[c.materialIndex];if(h&&h.visible){const e=x(i,h,o,s.near,s.far,a);t.renderBufferDirect(s,null,n,e,i,c)}}}else if(r.visible){const e=x(i,r,o,s.near,s.far,a);t.renderBufferDirect(s,null,n,e,i,null)}}const l=i.children;for(let t=0,e=l.length;t<e;t++)M(l[t],r,s,o,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(e,i,a){if(!1===y.enabled)return;if(!1===y.autoUpdate&&!1===y.needsUpdate)return;if(0===e.length)return;const l=t.getRenderTarget(),c=t.getActiveCubeFace(),u=t.getActiveMipmapLevel(),d=t.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let l=0,c=e.length;l<c;l++){const c=e[l],u=c.shadow;if(void 0===u)continue;if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;r.copy(u.mapSize);const p=u.getFrameExtents();if(r.multiply(p),s.copy(u.mapSize),(r.x>h||r.y>h)&&(r.x>h&&(s.x=Math.floor(h/p.x),r.x=s.x*p.x,u.mapSize.x=s.x),r.y>h&&(s.y=Math.floor(h/p.y),r.y=s.y*p.y,u.mapSize.y=s.y)),null===u.map&&!u.isPointLightShadow&&3===this.type){const t={minFilter:v,magFilter:v,format:A};u.map=new Xt(r.x,r.y,t),u.map.texture.name=c.name+".shadowMap",u.mapPass=new Xt(r.x,r.y,t),u.camera.updateProjectionMatrix()}if(null===u.map){const t={minFilter:f,magFilter:f,format:A};u.map=new Xt(r.x,r.y,t),u.map.texture.name=c.name+".shadowMap",u.camera.updateProjectionMatrix()}t.setRenderTarget(u.map),t.clear();const m=u.getViewportCount();for(let t=0;t<m;t++){const e=u.getViewport(t);o.set(s.x*e.x,s.y*e.y,s.x*e.z,s.y*e.w),d.viewport(o),u.updateMatrices(c,t),n=u.getFrustum(),M(i,a,u.camera,c,this.type)}u.isPointLightShadow||3!==this.type||_(u,a),u.needsUpdate=!1}y.needsUpdate=!1,t.setRenderTarget(l,c,u)}}function qs(t,e,i){const r=i.isWebGL2;const s=new function(){let e=!1;const i=new Jt;let n=null;const r=new Jt(0,0,0,0);return{setMask:function(i){n===i||e||(t.colorMask(i,i,i,i),n=i)},setLocked:function(t){e=t},setClear:function(e,n,s,o,a){!0===a&&(e*=o,n*=o,s*=o),i.set(e,n,s,o),!1===r.equals(i)&&(t.clearColor(e,n,s,o),r.copy(i))},reset:function(){e=!1,n=null,r.set(-1,0,0,0)}}},o=new function(){let e=!1,i=null,n=null,r=null;return{setTest:function(e){e?G(t.DEPTH_TEST):z(t.DEPTH_TEST)},setMask:function(n){i===n||e||(t.depthMask(n),i=n)},setFunc:function(e){if(n!==e){if(e)switch(e){case 0:t.depthFunc(t.NEVER);break;case 1:t.depthFunc(t.ALWAYS);break;case 2:t.depthFunc(t.LESS);break;case 3:default:t.depthFunc(t.LEQUAL);break;case 4:t.depthFunc(t.EQUAL);break;case 5:t.depthFunc(t.GEQUAL);break;case 6:t.depthFunc(t.GREATER);break;case 7:t.depthFunc(t.NOTEQUAL)}else t.depthFunc(t.LEQUAL);n=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,i=null,n=null,r=null}}},a=new function(){let e=!1,i=null,n=null,r=null,s=null,o=null,a=null,l=null,c=null;return{setTest:function(i){e||(i?G(t.STENCIL_TEST):z(t.STENCIL_TEST))},setMask:function(n){i===n||e||(t.stencilMask(n),i=n)},setFunc:function(e,i,o){n===e&&r===i&&s===o||(t.stencilFunc(e,i,o),n=e,r=i,s=o)},setOp:function(e,i,n){o===e&&a===i&&l===n||(t.stencilOp(e,i,n),o=e,a=i,l=n)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,i=null,n=null,r=null,s=null,o=null,a=null,l=null,c=null}}};let l={},c={},h=new WeakMap,u=[],d=null,p=!1,f=null,m=null,g=null,v=null,y=null,_=null,x=null,M=!1,b=null,w=null,S=null,T=null,A=null;const E=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let C=!1,O=0;const P=t.getParameter(t.VERSION);-1!==P.indexOf("WebGL")?(O=parseFloat(/^WebGL (\d)/.exec(P)[1]),C=O>=1):-1!==P.indexOf("OpenGL ES")&&(O=parseFloat(/^OpenGL ES (\d)/.exec(P)[1]),C=O>=2);let I=null,D={};const L=t.getParameter(t.SCISSOR_BOX),R=t.getParameter(t.VIEWPORT),B=(new Jt).fromArray(L),N=(new Jt).fromArray(R);function F(e,i,n){const r=new Uint8Array(4),s=t.createTexture();t.bindTexture(e,s),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let e=0;e<n;e++)t.texImage2D(i+e,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,r);return s}const U={};function G(e){!0!==l[e]&&(t.enable(e),l[e]=!0)}function z(e){!1!==l[e]&&(t.disable(e),l[e]=!1)}U[t.TEXTURE_2D]=F(t.TEXTURE_2D,t.TEXTURE_2D,1),U[t.TEXTURE_CUBE_MAP]=F(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),s.setClear(0,0,0,1),o.setClear(1),a.setClear(0),G(t.DEPTH_TEST),o.setFunc(3),V(!1),W(1),G(t.CULL_FACE),H(0);const k={[n]:t.FUNC_ADD,101:t.FUNC_SUBTRACT,102:t.FUNC_REVERSE_SUBTRACT};if(r)k[103]=t.MIN,k[104]=t.MAX;else{const t=e.get("EXT_blend_minmax");null!==t&&(k[103]=t.MIN_EXT,k[104]=t.MAX_EXT)}const j={200:t.ZERO,201:t.ONE,202:t.SRC_COLOR,204:t.SRC_ALPHA,210:t.SRC_ALPHA_SATURATE,208:t.DST_COLOR,206:t.DST_ALPHA,203:t.ONE_MINUS_SRC_COLOR,205:t.ONE_MINUS_SRC_ALPHA,209:t.ONE_MINUS_DST_COLOR,207:t.ONE_MINUS_DST_ALPHA};function H(e,i,r,s,o,a,l,c){if(0!==e){if(!1===p&&(G(t.BLEND),p=!0),5===e)o=o||i,a=a||r,l=l||s,i===m&&o===y||(t.blendEquationSeparate(k[i],k[o]),m=i,y=o),r===g&&s===v&&a===_&&l===x||(t.blendFuncSeparate(j[r],j[s],j[a],j[l]),g=r,v=s,_=a,x=l),f=e,M=null;else if(e!==f||c!==M){if(m===n&&y===n||(t.blendEquation(t.FUNC_ADD),m=n,y=n),c)switch(e){case 1:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.ONE,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}g=null,v=null,_=null,x=null,f=e,M=c}}else!0===p&&(z(t.BLEND),p=!1)}function V(e){b!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),b=e)}function W(e){0!==e?(G(t.CULL_FACE),e!==w&&(1===e?t.cullFace(t.BACK):2===e?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):z(t.CULL_FACE),w=e}function q(e,i,n){e?(G(t.POLYGON_OFFSET_FILL),T===i&&A===n||(t.polygonOffset(i,n),T=i,A=n)):z(t.POLYGON_OFFSET_FILL)}function J(e){void 0===e&&(e=t.TEXTURE0+E-1),I!==e&&(t.activeTexture(e),I=e)}return{buffers:{color:s,depth:o,stencil:a},enable:G,disable:z,bindFramebuffer:function(e,i){return c[e]!==i&&(t.bindFramebuffer(e,i),c[e]=i,r&&(e===t.DRAW_FRAMEBUFFER&&(c[t.FRAMEBUFFER]=i),e===t.FRAMEBUFFER&&(c[t.DRAW_FRAMEBUFFER]=i)),!0)},drawBuffers:function(n,r){let s=u,o=!1;if(n)if(s=h.get(r),void 0===s&&(s=[],h.set(r,s)),n.isWebGLMultipleRenderTargets){const e=n.texture;if(s.length!==e.length||s[0]!==t.COLOR_ATTACHMENT0){for(let i=0,n=e.length;i<n;i++)s[i]=t.COLOR_ATTACHMENT0+i;s.length=e.length,o=!0}}else s[0]!==t.COLOR_ATTACHMENT0&&(s[0]=t.COLOR_ATTACHMENT0,o=!0);else s[0]!==t.BACK&&(s[0]=t.BACK,o=!0);o&&(i.isWebGL2?t.drawBuffers(s):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(s))},useProgram:function(e){return d!==e&&(t.useProgram(e),d=e,!0)},setBlending:H,setMaterial:function(e,i){2===e.side?z(t.CULL_FACE):G(t.CULL_FACE);let n=1===e.side;i&&(n=!n),V(n),1===e.blending&&!1===e.transparent?H(0):H(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),o.setFunc(e.depthFunc),o.setTest(e.depthTest),o.setMask(e.depthWrite),s.setMask(e.colorWrite);const r=e.stencilWrite;a.setTest(r),r&&(a.setMask(e.stencilWriteMask),a.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),a.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),q(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?G(t.SAMPLE_ALPHA_TO_COVERAGE):z(t.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:V,setCullFace:W,setLineWidth:function(e){e!==S&&(C&&t.lineWidth(e),S=e)},setPolygonOffset:q,setScissorTest:function(e){e?G(t.SCISSOR_TEST):z(t.SCISSOR_TEST)},activeTexture:J,bindTexture:function(e,i){null===I&&J();let n=D[I];void 0===n&&(n={type:void 0,texture:void 0},D[I]=n),n.type===e&&n.texture===i||(t.bindTexture(e,i||U[e]),n.type=e,n.texture=i)},unbindTexture:function(){const e=D[I];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage2D:function(){try{t.texStorage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{t.texStorage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{t.texSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{t.texSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===B.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),B.copy(e))},viewport:function(e){!1===N.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),N.copy(e))},reset:function(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),!0===r&&(t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),l={},I=null,D={},c={},h=new WeakMap,u=[],d=null,p=!1,f=null,m=null,g=null,v=null,y=null,_=null,x=null,M=!1,b=null,w=null,S=null,T=null,A=null,B.set(0,0,t.canvas.width,t.canvas.height),N.set(0,0,t.canvas.width,t.canvas.height),s.reset(),o.reset(),a.reset()}}}function Js(t,e,i,n,r,s,o){const a=r.isWebGL2,l=(r.maxTextures,r.maxCubemapSize),c=r.maxTextureSize,h=r.maxSamples,x=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,O=new WeakMap;let P;const I=new WeakMap;let D=!1;try{D="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function L(t,e){return D?new OffscreenCanvas(t,e):Lt("canvas")}function R(t,e,i,n){let r=1;if((t.width>n||t.height>n)&&(r=n/Math.max(t.width,t.height)),r<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const n=e?At:Math.floor,s=n(r*t.width),o=n(r*t.height);void 0===P&&(P=L(s,o));const a=i?L(s,o):P;a.width=s,a.height=o;return a.getContext("2d").drawImage(t,0,0,s,o),t.width,t.height,a}return"data"in t&&(t.width,t.height),t}return t}function B(t){return St(t.width)&&St(t.height)}function N(t,e){return t.generateMipmaps&&e&&t.minFilter!==f&&t.minFilter!==v}function F(e){t.generateMipmap(e)}function U(i,n,r,s,o=!1){if(!1===a)return n;if(null!==i&&void 0!==t[i])return t[i];let l=n;return n===t.RED&&(r===t.FLOAT&&(l=t.R32F),r===t.HALF_FLOAT&&(l=t.R16F),r===t.UNSIGNED_BYTE&&(l=t.R8)),n===t.RG&&(r===t.FLOAT&&(l=t.RG32F),r===t.HALF_FLOAT&&(l=t.RG16F),r===t.UNSIGNED_BYTE&&(l=t.RG8)),n===t.RGBA&&(r===t.FLOAT&&(l=t.RGBA32F),r===t.HALF_FLOAT&&(l=t.RGBA16F),r===t.UNSIGNED_BYTE&&(l=s===ct&&!1===o?t.SRGB8_ALPHA8:t.RGBA8),r===t.UNSIGNED_SHORT_4_4_4_4&&(l=t.RGBA4),r===t.UNSIGNED_SHORT_5_5_5_1&&(l=t.RGB5_A1)),l!==t.R16F&&l!==t.R32F&&l!==t.RG16F&&l!==t.RG32F&&l!==t.RGBA16F&&l!==t.RGBA32F||e.get("EXT_color_buffer_float"),l}function G(t,e,i){return!0===N(t,i)||t.isFramebufferTexture&&t.minFilter!==f&&t.minFilter!==v?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function z(e){return e===f||e===m||e===g?t.NEAREST:t.LINEAR}function k(t){const e=t.target;e.removeEventListener("dispose",k),function(t){const e=n.get(t);if(void 0===e.__webglInit)return;const i=t.source,r=I.get(i);if(r){const n=r[e.__cacheKey];n.usedTimes--,0===n.usedTimes&&H(t),0===Object.keys(r).length&&I.delete(i)}n.remove(t)}(e),e.isVideoTexture&&O.delete(e)}function j(e){const i=e.target;i.removeEventListener("dispose",j),function(e){const i=e.texture,r=n.get(e),s=n.get(i);void 0!==s.__webglTexture&&(t.deleteTexture(s.__webglTexture),o.memory.textures--);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)t.deleteFramebuffer(r.__webglFramebuffer[e]),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer[e]);else t.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&t.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer&&t.deleteRenderbuffer(r.__webglColorRenderbuffer),r.__webglDepthRenderbuffer&&t.deleteRenderbuffer(r.__webglDepthRenderbuffer);if(e.isWebGLMultipleRenderTargets)for(let e=0,r=i.length;e<r;e++){const r=n.get(i[e]);r.__webglTexture&&(t.deleteTexture(r.__webglTexture),o.memory.textures--),n.remove(i[e])}n.remove(i),n.remove(e)}(i)}function H(e){const i=n.get(e);t.deleteTexture(i.__webglTexture);const r=e.source;delete I.get(r)[i.__cacheKey],o.memory.textures--}let V=0;function W(e,r){const s=n.get(e);if(e.isVideoTexture&&function(t){const e=o.render.frame;O.get(t)!==e&&(O.set(t,e),t.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&s.__version!==e.version){const t=e.image;if(null===t);else if(!1!==t.complete)return void Z(s,e,r)}i.activeTexture(t.TEXTURE0+r),i.bindTexture(t.TEXTURE_2D,s.__webglTexture)}const q={[u]:t.REPEAT,[d]:t.CLAMP_TO_EDGE,[p]:t.MIRRORED_REPEAT},J={[f]:t.NEAREST,[m]:t.NEAREST_MIPMAP_NEAREST,[g]:t.NEAREST_MIPMAP_LINEAR,[v]:t.LINEAR,[y]:t.LINEAR_MIPMAP_NEAREST,[_]:t.LINEAR_MIPMAP_LINEAR};function X(i,s,o){if(o?(t.texParameteri(i,t.TEXTURE_WRAP_S,q[s.wrapS]),t.texParameteri(i,t.TEXTURE_WRAP_T,q[s.wrapT]),i!==t.TEXTURE_3D&&i!==t.TEXTURE_2D_ARRAY||t.texParameteri(i,t.TEXTURE_WRAP_R,q[s.wrapR]),t.texParameteri(i,t.TEXTURE_MAG_FILTER,J[s.magFilter]),t.texParameteri(i,t.TEXTURE_MIN_FILTER,J[s.minFilter])):(t.texParameteri(i,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(i,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),i!==t.TEXTURE_3D&&i!==t.TEXTURE_2D_ARRAY||t.texParameteri(i,t.TEXTURE_WRAP_R,t.CLAMP_TO_EDGE),s.wrapS!==d||s.wrapT,t.texParameteri(i,t.TEXTURE_MAG_FILTER,z(s.magFilter)),t.texParameteri(i,t.TEXTURE_MIN_FILTER,z(s.minFilter)),s.minFilter!==f&&s.minFilter),!0===e.has("EXT_texture_filter_anisotropic")){const o=e.get("EXT_texture_filter_anisotropic");if(s.type===w&&!1===e.has("OES_texture_float_linear"))return;if(!1===a&&s.type===S&&!1===e.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||n.get(s).__currentAnisotropy)&&(t.texParameterf(i,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),n.get(s).__currentAnisotropy=s.anisotropy)}}function Y(e,i){let n=!1;void 0===e.__webglInit&&(e.__webglInit=!0,i.addEventListener("dispose",k));const r=i.source;let s=I.get(r);void 0===s&&(s={},I.set(r,s));const a=function(t){const e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.encoding),e.join()}(i);if(a!==e.__cacheKey){void 0===s[a]&&(s[a]={texture:t.createTexture(),usedTimes:0},o.memory.textures++,n=!0),s[a].usedTimes++;const r=s[e.__cacheKey];void 0!==r&&(s[e.__cacheKey].usedTimes--,0===r.usedTimes&&H(i)),e.__cacheKey=a,e.__webglTexture=s[a].texture}return n}function Z(e,n,r){let o=t.TEXTURE_2D;n.isDataArrayTexture&&(o=t.TEXTURE_2D_ARRAY),n.isData3DTexture&&(o=t.TEXTURE_3D);const l=Y(e,n),h=n.source;if(i.activeTexture(t.TEXTURE0+r),i.bindTexture(o,e.__webglTexture),h.version!==h.__currentVersion||!0===l){t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,n.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,n.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE);const r=function(t){return!a&&(t.wrapS!==d||t.wrapT!==d||t.minFilter!==f&&t.minFilter!==v)}(n)&&!1===B(n.image);let l=R(n.image,r,!1,c);l=it(n,l);const u=B(l)||a,p=s.convert(n.format,n.encoding);let m,g=s.convert(n.type),y=U(n.internalFormat,p,g,n.encoding,n.isVideoTexture);X(o,n,u);const _=n.mipmaps,x=a&&!0!==n.isVideoTexture,S=void 0===e.__version,O=G(n,l,u);if(n.isDepthTexture)y=t.DEPTH_COMPONENT,a?y=n.type===w?t.DEPTH_COMPONENT32F:n.type===b?t.DEPTH_COMPONENT24:n.type===T?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT16:n.type===w&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),n.format===E&&y===t.DEPTH_COMPONENT&&n.type!==M&&n.type!==b&&(n.type=M,g=s.convert(n.type)),n.format===C&&y===t.DEPTH_COMPONENT&&(y=t.DEPTH_STENCIL,n.type!==T&&(n.type=T,g=s.convert(n.type))),x&&S?i.texStorage2D(t.TEXTURE_2D,1,y,l.width,l.height):i.texImage2D(t.TEXTURE_2D,0,y,l.width,l.height,0,p,g,null);else if(n.isDataTexture)if(_.length>0&&u){x&&S&&i.texStorage2D(t.TEXTURE_2D,O,y,_[0].width,_[0].height);for(let e=0,n=_.length;e<n;e++)m=_[e],x?i.texSubImage2D(t.TEXTURE_2D,e,0,0,m.width,m.height,p,g,m.data):i.texImage2D(t.TEXTURE_2D,e,y,m.width,m.height,0,p,g,m.data);n.generateMipmaps=!1}else x?(S&&i.texStorage2D(t.TEXTURE_2D,O,y,l.width,l.height),i.texSubImage2D(t.TEXTURE_2D,0,0,0,l.width,l.height,p,g,l.data)):i.texImage2D(t.TEXTURE_2D,0,y,l.width,l.height,0,p,g,l.data);else if(n.isCompressedTexture){x&&S&&i.texStorage2D(t.TEXTURE_2D,O,y,_[0].width,_[0].height);for(let e=0,r=_.length;e<r;e++)m=_[e],n.format!==A?null!==p&&(x?i.compressedTexSubImage2D(t.TEXTURE_2D,e,0,0,m.width,m.height,p,m.data):i.compressedTexImage2D(t.TEXTURE_2D,e,y,m.width,m.height,0,m.data)):x?i.texSubImage2D(t.TEXTURE_2D,e,0,0,m.width,m.height,p,g,m.data):i.texImage2D(t.TEXTURE_2D,e,y,m.width,m.height,0,p,g,m.data)}else if(n.isDataArrayTexture)x?(S&&i.texStorage3D(t.TEXTURE_2D_ARRAY,O,y,l.width,l.height,l.depth),i.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,l.width,l.height,l.depth,p,g,l.data)):i.texImage3D(t.TEXTURE_2D_ARRAY,0,y,l.width,l.height,l.depth,0,p,g,l.data);else if(n.isData3DTexture)x?(S&&i.texStorage3D(t.TEXTURE_3D,O,y,l.width,l.height,l.depth),i.texSubImage3D(t.TEXTURE_3D,0,0,0,0,l.width,l.height,l.depth,p,g,l.data)):i.texImage3D(t.TEXTURE_3D,0,y,l.width,l.height,l.depth,0,p,g,l.data);else if(n.isFramebufferTexture)x&&S?i.texStorage2D(t.TEXTURE_2D,O,y,l.width,l.height):i.texImage2D(t.TEXTURE_2D,0,y,l.width,l.height,0,p,g,null);else if(_.length>0&&u){x&&S&&i.texStorage2D(t.TEXTURE_2D,O,y,_[0].width,_[0].height);for(let e=0,n=_.length;e<n;e++)m=_[e],x?i.texSubImage2D(t.TEXTURE_2D,e,0,0,p,g,m):i.texImage2D(t.TEXTURE_2D,e,y,p,g,m);n.generateMipmaps=!1}else x?(S&&i.texStorage2D(t.TEXTURE_2D,O,y,l.width,l.height),i.texSubImage2D(t.TEXTURE_2D,0,0,0,p,g,l)):i.texImage2D(t.TEXTURE_2D,0,y,p,g,l);N(n,u)&&F(o),h.__currentVersion=h.version,n.onUpdate&&n.onUpdate(n)}e.__version=n.version}function K(e,r,o,a,l){const c=s.convert(o.format,o.encoding),h=s.convert(o.type),u=U(o.internalFormat,c,h,o.encoding);n.get(r).__hasExternalTextures||(l===t.TEXTURE_3D||l===t.TEXTURE_2D_ARRAY?i.texImage3D(l,0,u,r.width,r.height,r.depth,0,c,h,null):i.texImage2D(l,0,u,r.width,r.height,0,c,h,null)),i.bindFramebuffer(t.FRAMEBUFFER,e),et(r)?x.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,a,l,n.get(o).__webglTexture,0,tt(r)):t.framebufferTexture2D(t.FRAMEBUFFER,a,l,n.get(o).__webglTexture,0),i.bindFramebuffer(t.FRAMEBUFFER,null)}function Q(e,i,n){if(t.bindRenderbuffer(t.RENDERBUFFER,e),i.depthBuffer&&!i.stencilBuffer){let r=t.DEPTH_COMPONENT16;if(n||et(i)){const e=i.depthTexture;e&&e.isDepthTexture&&(e.type===w?r=t.DEPTH_COMPONENT32F:e.type===b&&(r=t.DEPTH_COMPONENT24));const n=tt(i);et(i)?x.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,n,r,i.width,i.height):t.renderbufferStorageMultisample(t.RENDERBUFFER,n,r,i.width,i.height)}else t.renderbufferStorage(t.RENDERBUFFER,r,i.width,i.height);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e)}else if(i.depthBuffer&&i.stencilBuffer){const r=tt(i);n&&!1===et(i)?t.renderbufferStorageMultisample(t.RENDERBUFFER,r,t.DEPTH24_STENCIL8,i.width,i.height):et(i)?x.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,r,t.DEPTH24_STENCIL8,i.width,i.height):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,i.width,i.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e)}else{const e=!0===i.isWebGLMultipleRenderTargets?i.texture[0]:i.texture,r=s.convert(e.format,e.encoding),o=s.convert(e.type),a=U(e.internalFormat,r,o,e.encoding),l=tt(i);n&&!1===et(i)?t.renderbufferStorageMultisample(t.RENDERBUFFER,l,a,i.width,i.height):et(i)?x.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,l,a,i.width,i.height):t.renderbufferStorage(t.RENDERBUFFER,a,i.width,i.height)}t.bindRenderbuffer(t.RENDERBUFFER,null)}function $(e){const r=n.get(e),s=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(t.FRAMEBUFFER,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),W(r.depthTexture,0);const s=n.get(r.depthTexture).__webglTexture,o=tt(r);if(r.depthTexture.format===E)et(r)?x.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,s,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,s,0);else{if(r.depthTexture.format!==C)throw new Error("Unknown depthTexture format");et(r)?x.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,s,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,s,0)}}(r.__webglFramebuffer,e)}else if(s){r.__webglDepthbuffer=[];for(let n=0;n<6;n++)i.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer[n]),r.__webglDepthbuffer[n]=t.createRenderbuffer(),Q(r.__webglDepthbuffer[n],e,!1)}else i.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),Q(r.__webglDepthbuffer,e,!1);i.bindFramebuffer(t.FRAMEBUFFER,null)}function tt(t){return Math.min(h,t.samples)}function et(t){const i=n.get(t);return a&&t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==i.__useRenderToTexture}function it(t,i){const n=t.encoding,r=t.format;t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||t.format===ft||n!==lt&&(n===ct?!1===a&&(!0===e.has("EXT_sRGB")&&r===A?(t.format=ft,t.minFilter=v,t.generateMipmaps=!1):i=jt.sRGBToLinear(i)):console.error("THREE.WebGLTextures: Unsupported texture encoding:",n)),i}this.allocateTextureUnit=function(){const t=V;return V+=1,t},this.resetTextureUnits=function(){V=0},this.setTexture2D=W,this.setTexture2DArray=function(e,r){const s=n.get(e);e.version>0&&s.__version!==e.version?Z(s,e,r):(i.activeTexture(t.TEXTURE0+r),i.bindTexture(t.TEXTURE_2D_ARRAY,s.__webglTexture))},this.setTexture3D=function(e,r){const s=n.get(e);e.version>0&&s.__version!==e.version?Z(s,e,r):(i.activeTexture(t.TEXTURE0+r),i.bindTexture(t.TEXTURE_3D,s.__webglTexture))},this.setTextureCube=function(e,r){const o=n.get(e);e.version>0&&o.__version!==e.version?function(e,n,r){if(6!==n.image.length)return;const o=Y(e,n),c=n.source;if(i.activeTexture(t.TEXTURE0+r),i.bindTexture(t.TEXTURE_CUBE_MAP,e.__webglTexture),c.version!==c.__currentVersion||!0===o){t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,n.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,n.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE);const r=n.isCompressedTexture||n.image[0].isCompressedTexture,o=n.image[0]&&n.image[0].isDataTexture,h=[];for(let t=0;t<6;t++)h[t]=r||o?o?n.image[t].image:n.image[t]:R(n.image[t],!1,!0,l),h[t]=it(n,h[t]);const u=h[0],d=B(u)||a,p=s.convert(n.format,n.encoding),f=s.convert(n.type),m=U(n.internalFormat,p,f,n.encoding),g=a&&!0!==n.isVideoTexture,v=void 0===e.__version;let y,_=G(n,u,d);if(X(t.TEXTURE_CUBE_MAP,n,d),r){g&&v&&i.texStorage2D(t.TEXTURE_CUBE_MAP,_,m,u.width,u.height);for(let e=0;e<6;e++){y=h[e].mipmaps;for(let r=0;r<y.length;r++){const s=y[r];n.format!==A?null!==p&&(g?i.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,0,0,s.width,s.height,p,s.data):i.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,m,s.width,s.height,0,s.data)):g?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,0,0,s.width,s.height,p,f,s.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,m,s.width,s.height,0,p,f,s.data)}}}else{y=n.mipmaps,g&&v&&(y.length>0&&_++,i.texStorage2D(t.TEXTURE_CUBE_MAP,_,m,h[0].width,h[0].height));for(let e=0;e<6;e++)if(o){g?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,h[e].width,h[e].height,p,f,h[e].data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,m,h[e].width,h[e].height,0,p,f,h[e].data);for(let n=0;n<y.length;n++){const r=y[n].image[e].image;g?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,0,0,r.width,r.height,p,f,r.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,m,r.width,r.height,0,p,f,r.data)}}else{g?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,p,f,h[e]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,m,p,f,h[e]);for(let n=0;n<y.length;n++){const r=y[n];g?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,0,0,p,f,r.image[e]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,m,p,f,r.image[e])}}}N(n,d)&&F(t.TEXTURE_CUBE_MAP),c.__currentVersion=c.version,n.onUpdate&&n.onUpdate(n)}e.__version=n.version}(o,e,r):(i.activeTexture(t.TEXTURE0+r),i.bindTexture(t.TEXTURE_CUBE_MAP,o.__webglTexture))},this.rebindTextures=function(e,i,r){const s=n.get(e);void 0!==i&&K(s.__webglFramebuffer,e,e.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D),void 0!==r&&$(e)},this.setupRenderTarget=function(e){const l=e.texture,c=n.get(e),h=n.get(l);e.addEventListener("dispose",j),!0!==e.isWebGLMultipleRenderTargets&&(void 0===h.__webglTexture&&(h.__webglTexture=t.createTexture()),h.__version=l.version,o.memory.textures++);const u=!0===e.isWebGLCubeRenderTarget,d=!0===e.isWebGLMultipleRenderTargets,p=B(e)||a;if(u){c.__webglFramebuffer=[];for(let e=0;e<6;e++)c.__webglFramebuffer[e]=t.createFramebuffer()}else if(c.__webglFramebuffer=t.createFramebuffer(),d){if(r.drawBuffers){const i=e.texture;for(let e=0,r=i.length;e<r;e++){const r=n.get(i[e]);void 0===r.__webglTexture&&(r.__webglTexture=t.createTexture(),o.memory.textures++)}}}else if(a&&e.samples>0&&!1===et(e)){c.__webglMultisampledFramebuffer=t.createFramebuffer(),c.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,c.__webglColorRenderbuffer);const n=s.convert(l.format,l.encoding),r=s.convert(l.type),o=U(l.internalFormat,n,r,l.encoding),a=tt(e);t.renderbufferStorageMultisample(t.RENDERBUFFER,a,o,e.width,e.height),i.bindFramebuffer(t.FRAMEBUFFER,c.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,c.__webglColorRenderbuffer),t.bindRenderbuffer(t.RENDERBUFFER,null),e.depthBuffer&&(c.__webglDepthRenderbuffer=t.createRenderbuffer(),Q(c.__webglDepthRenderbuffer,e,!0)),i.bindFramebuffer(t.FRAMEBUFFER,null)}if(u){i.bindTexture(t.TEXTURE_CUBE_MAP,h.__webglTexture),X(t.TEXTURE_CUBE_MAP,l,p);for(let i=0;i<6;i++)K(c.__webglFramebuffer[i],e,l,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+i);N(l,p)&&F(t.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(d){const r=e.texture;for(let s=0,o=r.length;s<o;s++){const o=r[s],a=n.get(o);i.bindTexture(t.TEXTURE_2D,a.__webglTexture),X(t.TEXTURE_2D,o,p),K(c.__webglFramebuffer,e,o,t.COLOR_ATTACHMENT0+s,t.TEXTURE_2D),N(o,p)&&F(t.TEXTURE_2D)}i.unbindTexture()}else{let n=t.TEXTURE_2D;(e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(a?n=e.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(n,h.__webglTexture),X(n,l,p),K(c.__webglFramebuffer,e,l,t.COLOR_ATTACHMENT0,n),N(l,p)&&F(n),i.unbindTexture()}e.depthBuffer&&$(e)},this.updateRenderTargetMipmap=function(e){const r=B(e)||a,s=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let o=0,a=s.length;o<a;o++){const a=s[o];if(N(a,r)){const r=e.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,s=n.get(a).__webglTexture;i.bindTexture(r,s),F(r),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(a&&e.samples>0&&!1===et(e)){const r=e.width,s=e.height;let o=t.COLOR_BUFFER_BIT;const a=[t.COLOR_ATTACHMENT0],l=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;e.depthBuffer&&a.push(l);const c=n.get(e),h=void 0!==c.__ignoreDepthValues&&c.__ignoreDepthValues;!1===h&&(e.depthBuffer&&(o|=t.DEPTH_BUFFER_BIT),e.stencilBuffer&&(o|=t.STENCIL_BUFFER_BIT)),i.bindFramebuffer(t.READ_FRAMEBUFFER,c.__webglMultisampledFramebuffer),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,c.__webglFramebuffer),!0===h&&(t.invalidateFramebuffer(t.READ_FRAMEBUFFER,[l]),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[l])),t.blitFramebuffer(0,0,r,s,0,0,r,s,o,t.NEAREST),t.invalidateFramebuffer(t.READ_FRAMEBUFFER,a),i.bindFramebuffer(t.READ_FRAMEBUFFER,null),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,c.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=$,this.setupFrameBufferTexture=K,this.useMultisampledRTT=et}function Xs(t,e,i){const n=i.isWebGL2;return{convert:function(i,r=null){let s;if(i===x)return t.UNSIGNED_BYTE;if(1017===i)return t.UNSIGNED_SHORT_4_4_4_4;if(1018===i)return t.UNSIGNED_SHORT_5_5_5_1;if(1010===i)return t.BYTE;if(1011===i)return t.SHORT;if(i===M)return t.UNSIGNED_SHORT;if(1013===i)return t.INT;if(i===b)return t.UNSIGNED_INT;if(i===w)return t.FLOAT;if(i===S)return n?t.HALF_FLOAT:(s=e.get("OES_texture_half_float"),null!==s?s.HALF_FLOAT_OES:null);if(1021===i)return t.ALPHA;if(i===A)return t.RGBA;if(1024===i)return t.LUMINANCE;if(1025===i)return t.LUMINANCE_ALPHA;if(i===E)return t.DEPTH_COMPONENT;if(i===C)return t.DEPTH_STENCIL;if(1028===i)return t.RED;if(1022===i)return t.RGBA;if(i===ft)return s=e.get("EXT_sRGB"),null!==s?s.SRGB_ALPHA_EXT:null;if(1029===i)return t.RED_INTEGER;if(1030===i)return t.RG;if(1031===i)return t.RG_INTEGER;if(1033===i)return t.RGBA_INTEGER;if(i===O||i===P||i===I||i===D)if(r===ct){if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===s)return null;if(i===O)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===P)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===I)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===D)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(s=e.get("WEBGL_compressed_texture_s3tc"),null===s)return null;if(i===O)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===P)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===I)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===D)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(i===L||i===R||i===B||i===N){if(s=e.get("WEBGL_compressed_texture_pvrtc"),null===s)return null;if(i===L)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===R)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===B)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===N)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===i)return s=e.get("WEBGL_compressed_texture_etc1"),null!==s?s.COMPRESSED_RGB_ETC1_WEBGL:null;if(i===F||i===U){if(s=e.get("WEBGL_compressed_texture_etc"),null===s)return null;if(i===F)return r===ct?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(i===U)return r===ct?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}if(i===G||i===z||i===k||i===j||i===H||i===V||i===W||i===q||i===J||i===X||i===Y||i===Z||i===K||i===Q){if(s=e.get("WEBGL_compressed_texture_astc"),null===s)return null;if(i===G)return r===ct?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===z)return r===ct?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===k)return r===ct?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===j)return r===ct?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===H)return r===ct?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===V)return r===ct?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===W)return r===ct?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===q)return r===ct?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===J)return r===ct?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===X)return r===ct?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===Y)return r===ct?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===Z)return r===ct?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===K)return r===ct?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===Q)return r===ct?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}if(i===$){if(s=e.get("EXT_texture_compression_bptc"),null===s)return null;if(i===$)return r===ct?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}return i===T?n?t.UNSIGNED_INT_24_8:(s=e.get("WEBGL_depth_texture"),null!==s?s.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class Ys extends un{constructor(t=[]){super(),this.cameras=t}}Ys.prototype.isArrayCamera=!0;class Zs extends ni{constructor(){super(),this.type="Group"}}Zs.prototype.isGroup=!0;const Ks={type:"move"};class Qs{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Zs,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Zs,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ee,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ee),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Zs,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ee,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ee),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,i){let n=null,r=null,s=null;const o=this._targetRay,a=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState)if(null!==o&&(n=e.getPose(t.targetRaySpace,i),null!==n&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Ks))),l&&t.hand){s=!0;for(const n of t.hand.values()){const t=e.getJointPose(n,i);if(void 0===l.joints[n.jointName]){const t=new Zs;t.matrixAutoUpdate=!1,t.visible=!1,l.joints[n.jointName]=t,l.add(t)}const r=l.joints[n.jointName];null!==t&&(r.matrix.fromArray(t.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=t.radius),r.visible=null!==t}const n=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],o=n.position.distanceTo(r.position),a=.02,c=.005;l.inputState.pinching&&o>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&o<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==a&&t.gripSpace&&(r=e.getPose(t.gripSpace,i),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1));return null!==o&&(o.visible=null!==n),null!==a&&(a.visible=null!==r),null!==l&&(l.visible=null!==s),this}}class $s extends qt{constructor(t,e,i,n,r,s,o,a,l,c){if((c=void 0!==c?c:E)!==E&&c!==C)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===E&&(i=M),void 0===i&&c===C&&(i=T),super(null,n,r,s,o,a,c,i,l),this.image={width:t,height:e},this.magFilter=void 0!==o?o:f,this.minFilter=void 0!==a?a:f,this.flipY=!1,this.generateMipmaps=!1}}$s.prototype.isDepthTexture=!0;class to extends mt{constructor(t,e){super();const i=this;let n=null,r=1,s=null,o="local-floor",a=null,l=null,c=null,h=null,u=null;const d=e.getContextAttributes();let p=null,f=null;const m=[],g=new Map,v=new un;v.layers.enable(1),v.viewport=new Jt;const y=new un;y.layers.enable(2),y.viewport=new Jt;const _=[v,y],b=new Ys;b.layers.enable(1),b.layers.enable(2);let w=null,S=null;function O(t){const e=g.get(t.inputSource);e&&e.dispatchEvent({type:t.type,data:t.inputSource})}function P(){g.forEach((function(t,e){t.disconnect(e)})),g.clear(),w=null,S=null,t.setRenderTarget(p),h=null,c=null,l=null,n=null,f=null,N.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function I(t){const e=n.inputSources;for(let t=0;t<m.length;t++)g.set(e[t],m[t]);for(let e=0;e<t.removed.length;e++){const i=t.removed[e],n=g.get(i);n&&(n.dispatchEvent({type:"disconnected",data:i}),g.delete(i))}for(let e=0;e<t.added.length;e++){const i=t.added[e],n=g.get(i);n&&n.dispatchEvent({type:"connected",data:i})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=m[t];return void 0===e&&(e=new Qs,m[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=m[t];return void 0===e&&(e=new Qs,m[t]=e),e.getGripSpace()},this.getHand=function(t){let e=m[t];return void 0===e&&(e=new Qs,m[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){r=t,i.isPresenting},this.setReferenceSpaceType=function(t){o=t,i.isPresenting},this.getReferenceSpace=function(){return s},this.getBaseLayer=function(){return null!==c?c:h},this.getBinding=function(){return l},this.getFrame=function(){return u},this.getSession=function(){return n},this.setSession=async function(a){if(n=a,null!==n){if(p=t.getRenderTarget(),n.addEventListener("select",O),n.addEventListener("selectstart",O),n.addEventListener("selectend",O),n.addEventListener("squeeze",O),n.addEventListener("squeezestart",O),n.addEventListener("squeezeend",O),n.addEventListener("end",P),n.addEventListener("inputsourceschange",I),!0!==d.xrCompatible&&await e.makeXRCompatible(),void 0===n.renderState.layers||!1===t.capabilities.isWebGL2){const i={antialias:void 0!==n.renderState.layers||d.antialias,alpha:d.alpha,depth:d.depth,stencil:d.stencil,framebufferScaleFactor:r};h=new XRWebGLLayer(n,e,i),n.updateRenderState({baseLayer:h}),f=new Xt(h.framebufferWidth,h.framebufferHeight,{format:A,type:x,encoding:t.outputEncoding})}else{let i=null,s=null,o=null;d.depth&&(o=d.stencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24,i=d.stencil?C:E,s=d.stencil?T:M);const a={colorFormat:t.outputEncoding===ct?e.SRGB8_ALPHA8:e.RGBA8,depthFormat:o,scaleFactor:r};l=new XRWebGLBinding(n,e),c=l.createProjectionLayer(a),n.updateRenderState({layers:[c]}),f=new Xt(c.textureWidth,c.textureHeight,{format:A,type:x,depthTexture:new $s(c.textureWidth,c.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,i),stencilBuffer:d.stencil,encoding:t.outputEncoding,samples:d.antialias?4:0});t.properties.get(f).__ignoreDepthValues=c.ignoreDepthValues}f.isXRRenderTarget=!0,this.setFoveation(1),s=await n.requestReferenceSpace(o),N.setContext(n),N.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};const D=new ee,L=new ee;function R(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===n)return;b.near=y.near=v.near=t.near,b.far=y.far=v.far=t.far,w===b.near&&S===b.far||(n.updateRenderState({depthNear:b.near,depthFar:b.far}),w=b.near,S=b.far);const e=t.parent,i=b.cameras;R(b,e);for(let t=0;t<i.length;t++)R(i[t],e);b.matrixWorld.decompose(b.position,b.quaternion,b.scale),t.position.copy(b.position),t.quaternion.copy(b.quaternion),t.scale.copy(b.scale),t.matrix.copy(b.matrix),t.matrixWorld.copy(b.matrixWorld);const r=t.children;for(let t=0,e=r.length;t<e;t++)r[t].updateMatrixWorld(!0);2===i.length?function(t,e,i){D.setFromMatrixPosition(e.matrixWorld),L.setFromMatrixPosition(i.matrixWorld);const n=D.distanceTo(L),r=e.projectionMatrix.elements,s=i.projectionMatrix.elements,o=r[14]/(r[10]-1),a=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],h=(r[8]-1)/r[0],u=(s[8]+1)/s[0],d=o*h,p=o*u,f=n/(-h+u),m=f*-h;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const g=o+f,v=a+f,y=d-m,_=p+(n-m),x=l*a/v*g,M=c*a/v*g;t.projectionMatrix.makePerspective(y,_,x,M,g,v)}(b,v,y):b.projectionMatrix.copy(v.projectionMatrix)},this.getCamera=function(){return b},this.getFoveation=function(){return null!==c?c.fixedFoveation:null!==h?h.fixedFoveation:void 0},this.setFoveation=function(t){null!==c&&(c.fixedFoveation=t),null!==h&&void 0!==h.fixedFoveation&&(h.fixedFoveation=t)};let B=null;const N=new wn;N.setAnimationLoop((function(e,i){if(a=i.getViewerPose(s),u=i,null!==a){const e=a.views;null!==h&&(t.setRenderTargetFramebuffer(f,h.framebuffer),t.setRenderTarget(f));let i=!1;e.length!==b.cameras.length&&(b.cameras.length=0,i=!0);for(let n=0;n<e.length;n++){const r=e[n];let s=null;if(null!==h)s=h.getViewport(r);else{const e=l.getViewSubImage(c,r);s=e.viewport,0===n&&(t.setRenderTargetTextures(f,e.colorTexture,c.ignoreDepthValues?void 0:e.depthStencilTexture),t.setRenderTarget(f))}const o=_[n];o.matrix.fromArray(r.transform.matrix),o.projectionMatrix.fromArray(r.projectionMatrix),o.viewport.set(s.x,s.y,s.width,s.height),0===n&&b.matrix.copy(o.matrix),!0===i&&b.cameras.push(o)}}const r=n.inputSources;for(let t=0;t<m.length;t++){const e=m[t],n=r[t];e.update(n,i,s)}B&&B(e,i),u=null})),this.setAnimationLoop=function(t){B=t},this.dispose=function(){}}}function eo(t){function e(e,i){e.opacity.value=i.opacity,i.color&&e.diffuse.value.copy(i.color),i.emissive&&e.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(e.map.value=i.map),i.alphaMap&&(e.alphaMap.value=i.alphaMap),i.specularMap&&(e.specularMap.value=i.specularMap),i.alphaTest>0&&(e.alphaTest.value=i.alphaTest);const n=t.get(i).envMap;let r,s;n&&(e.envMap.value=n,e.flipEnvMap.value=n.isCubeTexture&&!1===n.isRenderTargetTexture?-1:1,e.reflectivity.value=i.reflectivity,e.ior.value=i.ior,e.refractionRatio.value=i.refractionRatio),i.lightMap&&(e.lightMap.value=i.lightMap,e.lightMapIntensity.value=i.lightMapIntensity),i.aoMap&&(e.aoMap.value=i.aoMap,e.aoMapIntensity.value=i.aoMapIntensity),i.map?r=i.map:i.specularMap?r=i.specularMap:i.displacementMap?r=i.displacementMap:i.normalMap?r=i.normalMap:i.bumpMap?r=i.bumpMap:i.roughnessMap?r=i.roughnessMap:i.metalnessMap?r=i.metalnessMap:i.alphaMap?r=i.alphaMap:i.emissiveMap?r=i.emissiveMap:i.clearcoatMap?r=i.clearcoatMap:i.clearcoatNormalMap?r=i.clearcoatNormalMap:i.clearcoatRoughnessMap?r=i.clearcoatRoughnessMap:i.specularIntensityMap?r=i.specularIntensityMap:i.specularColorMap?r=i.specularColorMap:i.transmissionMap?r=i.transmissionMap:i.thicknessMap?r=i.thicknessMap:i.sheenColorMap?r=i.sheenColorMap:i.sheenRoughnessMap&&(r=i.sheenRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix)),i.aoMap?s=i.aoMap:i.lightMap&&(s=i.lightMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),e.uv2Transform.value.copy(s.matrix))}function i(e,i){e.roughness.value=i.roughness,e.metalness.value=i.metalness,i.roughnessMap&&(e.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(e.metalnessMap.value=i.metalnessMap),i.emissiveMap&&(e.emissiveMap.value=i.emissiveMap),i.bumpMap&&(e.bumpMap.value=i.bumpMap,e.bumpScale.value=i.bumpScale,1===i.side&&(e.bumpScale.value*=-1)),i.normalMap&&(e.normalMap.value=i.normalMap,e.normalScale.value.copy(i.normalScale),1===i.side&&e.normalScale.value.negate()),i.displacementMap&&(e.displacementMap.value=i.displacementMap,e.displacementScale.value=i.displacementScale,e.displacementBias.value=i.displacementBias);t.get(i).envMap&&(e.envMapIntensity.value=i.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,n,r,s,o){n.isMeshBasicMaterial?e(t,n):n.isMeshLambertMaterial?(e(t,n),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(t,n)):n.isMeshToonMaterial?(e(t,n),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap);e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshPhongMaterial?(e(t,n),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshStandardMaterial?(e(t,n),n.isMeshPhysicalMaterial?function(t,e,n){i(t,e),t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap));e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,1===e.side&&t.clearcoatNormalScale.value.negate()));e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=n.texture,t.transmissionSamplerSize.value.set(n.width,n.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor));t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap);e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap)}(t,n,o):i(t,n)):n.isMeshMatcapMaterial?(e(t,n),function(t,e){e.matcap&&(t.matcap.value=e.matcap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshDepthMaterial?(e(t,n),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshDistanceMaterial?(e(t,n),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias);t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,n)):n.isMeshNormalMaterial?(e(t,n),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,n),n.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,n)):n.isPointsMaterial?function(t,e,i,n){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*i,t.scale.value=.5*n,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);e.alphaTest>0&&(t.alphaTest.value=e.alphaTest);let r;e.map?r=e.map:e.alphaMap&&(r=e.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}(t,n,r,s):n.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);e.alphaTest>0&&(t.alphaTest.value=e.alphaTest);let i;e.map?i=e.map:e.alphaMap&&(i=e.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}(t,n):n.isShadowMaterial?(t.color.value.copy(n.color),t.opacity.value=n.opacity):n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)}}}function io(t={}){const e=void 0!==t.canvas?t.canvas:function(){const t=Lt("canvas");return t.style.display="block",t}(),i=void 0!==t.context?t.context:null,n=void 0===t.depth||t.depth,r=void 0===t.stencil||t.stencil,s=void 0!==t.antialias&&t.antialias,o=void 0===t.premultipliedAlpha||t.premultipliedAlpha,a=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,l=void 0!==t.powerPreference?t.powerPreference:"default",c=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let h;h=void 0!==t.context?i.getContextAttributes().alpha:void 0!==t.alpha&&t.alpha;let u=null,d=null;const p=[],f=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=lt,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const m=this;let g=!1,v=0,y=0,M=null,b=-1,T=null;const E=new Jt,C=new Jt;let O=null,P=e.width,I=e.height,D=1,L=null,R=null;const B=new Jt(0,0,P,I),N=new Jt(0,0,P,I);let F=!1;const U=new bn;let G=!1,z=!1,k=null;const j=new De,H=new Ct,V=new ee,W={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function q(){return null===M?D:1}let J,X,Y,Z,K,Q,$,tt,et,it,nt,rt,st,ot,at,ct,ht,ut,dt,pt,ft,mt,gt,vt=i;function yt(t,i){for(let n=0;n<t.length;n++){const r=t[n],s=e.getContext(r,i);if(null!==s)return s}return null}try{const t={alpha:!0,depth:n,stencil:r,antialias:s,premultipliedAlpha:o,preserveDrawingBuffer:a,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in e&&e.setAttribute("data-engine","three.js r138"),e.addEventListener("webglcontextlost",Mt,!1),e.addEventListener("webglcontextrestored",bt,!1),null===vt){const e=["webgl2","webgl","experimental-webgl"];if(!0===m.isWebGL1Renderer&&e.shift(),vt=yt(e,t),null===vt)throw yt(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===vt.getShaderPrecisionFormat&&(vt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function _t(){J=new Kn(vt),X=new Dn(vt,J,t),J.init(X),mt=new Xs(vt,J,X),Y=new qs(vt,J,X),Z=new tr(vt),K=new Ds,Q=new Js(vt,J,Y,K,X,mt,Z),$=new Rn(m),tt=new Zn(m),et=new Sn(vt,X),gt=new Pn(vt,J,et,X),it=new Qn(vt,et,Z,gt),nt=new sr(vt,it,et,Z),dt=new rr(vt,X,Q),ct=new Ln(K),rt=new Is(m,$,tt,J,X,gt,ct),st=new eo(K),ot=new Ns,at=new js(J,X),ut=new On(m,$,Y,nt,h,o),ht=new Ws(m,nt,X),pt=new In(vt,J,Z,X),ft=new $n(vt,J,Z,X),Z.programs=rt.programs,m.capabilities=X,m.extensions=J,m.properties=K,m.renderLists=ot,m.shadowMap=ht,m.state=Y,m.info=Z}_t();const xt=new to(m,vt);function Mt(t){t.preventDefault(),g=!0}function bt(){g=!1;const t=Z.autoReset,e=ht.enabled,i=ht.autoUpdate,n=ht.needsUpdate,r=ht.type;_t(),Z.autoReset=t,ht.enabled=e,ht.autoUpdate=i,ht.needsUpdate=n,ht.type=r}function wt(t){const e=t.target;e.removeEventListener("dispose",wt),function(t){(function(t){const e=K.get(t).programs;void 0!==e&&(e.forEach((function(t){rt.releaseProgram(t)})),t.isShaderMaterial&&rt.releaseShaderCache(t))})(t),K.remove(t)}(e)}this.xr=xt,this.getContext=function(){return vt},this.getContextAttributes=function(){return vt.getContextAttributes()},this.forceContextLoss=function(){const t=J.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=J.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return D},this.setPixelRatio=function(t){void 0!==t&&(D=t,this.setSize(P,I,!1))},this.getSize=function(t){return t.set(P,I)},this.setSize=function(t,i,n){xt.isPresenting||(P=t,I=i,e.width=Math.floor(t*D),e.height=Math.floor(i*D),!1!==n&&(e.style.width=t+"px",e.style.height=i+"px"),this.setViewport(0,0,t,i))},this.getDrawingBufferSize=function(t){return t.set(P*D,I*D).floor()},this.setDrawingBufferSize=function(t,i,n){P=t,I=i,D=n,e.width=Math.floor(t*n),e.height=Math.floor(i*n),this.setViewport(0,0,t,i)},this.getCurrentViewport=function(t){return t.copy(E)},this.getViewport=function(t){return t.copy(B)},this.setViewport=function(t,e,i,n){t.isVector4?B.set(t.x,t.y,t.z,t.w):B.set(t,e,i,n),Y.viewport(E.copy(B).multiplyScalar(D).floor())},this.getScissor=function(t){return t.copy(N)},this.setScissor=function(t,e,i,n){t.isVector4?N.set(t.x,t.y,t.z,t.w):N.set(t,e,i,n),Y.scissor(C.copy(N).multiplyScalar(D).floor())},this.getScissorTest=function(){return F},this.setScissorTest=function(t){Y.setScissorTest(F=t)},this.setOpaqueSort=function(t){L=t},this.setTransparentSort=function(t){R=t},this.getClearColor=function(t){return t.copy(ut.getClearColor())},this.setClearColor=function(){ut.setClearColor.apply(ut,arguments)},this.getClearAlpha=function(){return ut.getClearAlpha()},this.setClearAlpha=function(){ut.setClearAlpha.apply(ut,arguments)},this.clear=function(t=!0,e=!0,i=!0){let n=0;t&&(n|=vt.COLOR_BUFFER_BIT),e&&(n|=vt.DEPTH_BUFFER_BIT),i&&(n|=vt.STENCIL_BUFFER_BIT),vt.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Mt,!1),e.removeEventListener("webglcontextrestored",bt,!1),ot.dispose(),at.dispose(),K.dispose(),$.dispose(),tt.dispose(),nt.dispose(),gt.dispose(),rt.dispose(),xt.dispose(),xt.removeEventListener("sessionstart",Tt),xt.removeEventListener("sessionend",Et),k&&(k.dispose(),k=null),Ot.stop()},this.renderBufferDirect=function(t,e,i,n,r,s){null===e&&(e=W);const o=r.isMesh&&r.matrixWorld.determinant()<0,a=function(t,e,i,n,r){!0!==e.isScene&&(e=W);Q.resetTextureUnits();const s=e.fog,o=n.isMeshStandardMaterial?e.environment:null,a=null===M?m.outputEncoding:!0===M.isXRRenderTarget?M.texture.encoding:lt,l=(n.isMeshStandardMaterial?tt:$).get(n.envMap||o),c=!0===n.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,h=!!n.normalMap&&!!i.attributes.tangent,u=!!i.morphAttributes.position,p=!!i.morphAttributes.normal,f=!!i.morphAttributes.color,g=n.toneMapped?m.toneMapping:0,v=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,y=void 0!==v?v.length:0,_=K.get(n),x=d.state.lights;if(!0===G&&(!0===z||t!==T)){const e=t===T&&n.id===b;ct.setState(n,t,e)}let w=!1;n.version===_.__version?_.needsLights&&_.lightsStateVersion!==x.state.version||_.outputEncoding!==a||r.isInstancedMesh&&!1===_.instancing?w=!0:r.isInstancedMesh||!0!==_.instancing?r.isSkinnedMesh&&!1===_.skinning?w=!0:r.isSkinnedMesh||!0!==_.skinning?_.envMap!==l||n.fog&&_.fog!==s?w=!0:void 0===_.numClippingPlanes||_.numClippingPlanes===ct.numPlanes&&_.numIntersection===ct.numIntersection?(_.vertexAlphas!==c||_.vertexTangents!==h||_.morphTargets!==u||_.morphNormals!==p||_.morphColors!==f||_.toneMapping!==g||!0===X.isWebGL2&&_.morphTargetsCount!==y)&&(w=!0):w=!0:w=!0:w=!0:(w=!0,_.__version=n.version);let S=_.currentProgram;!0===w&&(S=Bt(n,e,r));let A=!1,E=!1,C=!1;const O=S.getUniforms(),P=_.uniforms;Y.useProgram(S.program)&&(A=!0,E=!0,C=!0);n.id!==b&&(b=n.id,E=!0);if(A||T!==t){if(O.setValue(vt,"projectionMatrix",t.projectionMatrix),X.logarithmicDepthBuffer&&O.setValue(vt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),T!==t&&(T=t,E=!0,C=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const e=O.map.cameraPosition;void 0!==e&&e.setValue(vt,V.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&O.setValue(vt,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||r.isSkinnedMesh)&&O.setValue(vt,"viewMatrix",t.matrixWorldInverse)}if(r.isSkinnedMesh){O.setOptional(vt,r,"bindMatrix"),O.setOptional(vt,r,"bindMatrixInverse");const t=r.skeleton;t&&(X.floatVertexTextures?(null===t.boneTexture&&t.computeBoneTexture(),O.setValue(vt,"boneTexture",t.boneTexture,Q),O.setValue(vt,"boneTextureSize",t.boneTextureSize)):O.setOptional(vt,t,"boneMatrices"))}const L=i.morphAttributes;(void 0!==L.position||void 0!==L.normal||void 0!==L.color&&!0===X.isWebGL2)&&dt.update(r,i,n,S);(E||_.receiveShadow!==r.receiveShadow)&&(_.receiveShadow=r.receiveShadow,O.setValue(vt,"receiveShadow",r.receiveShadow));E&&(O.setValue(vt,"toneMappingExposure",m.toneMappingExposure),_.needsLights&&(B=C,(R=P).ambientLightColor.needsUpdate=B,R.lightProbe.needsUpdate=B,R.directionalLights.needsUpdate=B,R.directionalLightShadows.needsUpdate=B,R.pointLights.needsUpdate=B,R.pointLightShadows.needsUpdate=B,R.spotLights.needsUpdate=B,R.spotLightShadows.needsUpdate=B,R.rectAreaLights.needsUpdate=B,R.hemisphereLights.needsUpdate=B),s&&n.fog&&st.refreshFogUniforms(P,s),st.refreshMaterialUniforms(P,n,D,I,k),cs.upload(vt,_.uniformsList,P,Q));var R,B;n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(cs.upload(vt,_.uniformsList,P,Q),n.uniformsNeedUpdate=!1);n.isSpriteMaterial&&O.setValue(vt,"center",r.center);return O.setValue(vt,"modelViewMatrix",r.modelViewMatrix),O.setValue(vt,"normalMatrix",r.normalMatrix),O.setValue(vt,"modelMatrix",r.matrixWorld),S}(t,e,i,n,r);Y.setMaterial(n,o);let l=i.index;const c=i.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let h,u=1;!0===n.wireframe&&(l=it.getWireframeAttribute(i),u=2),gt.setup(r,n,a,i,l);let p=pt;null!==l&&(h=et.get(l),p=ft,p.setIndex(h));const f=null!==l?l.count:c.count,g=i.drawRange.start*u,v=i.drawRange.count*u,y=null!==s?s.start*u:0,_=null!==s?s.count*u:1/0,x=Math.max(g,y),w=Math.min(f,g+v,y+_)-1,S=Math.max(0,w-x+1);if(0!==S){if(r.isMesh)!0===n.wireframe?(Y.setLineWidth(n.wireframeLinewidth*q()),p.setMode(vt.LINES)):p.setMode(vt.TRIANGLES);else if(r.isLine){let t=n.linewidth;void 0===t&&(t=1),Y.setLineWidth(t*q()),r.isLineSegments?p.setMode(vt.LINES):r.isLineLoop?p.setMode(vt.LINE_LOOP):p.setMode(vt.LINE_STRIP)}else r.isPoints?p.setMode(vt.POINTS):r.isSprite&&p.setMode(vt.TRIANGLES);if(r.isInstancedMesh)p.renderInstances(x,S,r.count);else if(i.isInstancedBufferGeometry){const t=Math.min(i.instanceCount,i._maxInstanceCount);p.renderInstances(x,S,t)}else p.render(x,S)}},this.compile=function(t,e){d=at.get(t),d.init(),f.push(d),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(d.pushLight(t),t.castShadow&&d.pushShadow(t))})),d.setupLights(m.physicallyCorrectLights),t.traverse((function(e){const i=e.material;if(i)if(Array.isArray(i))for(let n=0;n<i.length;n++){Bt(i[n],t,e)}else Bt(i,t,e)})),f.pop(),d=null};let St=null;function Tt(){Ot.stop()}function Et(){Ot.start()}const Ot=new wn;function Pt(t,e,i,n){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)i=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)d.pushLight(t),t.castShadow&&d.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||U.intersectsSprite(t)){n&&V.setFromMatrixPosition(t.matrixWorld).applyMatrix4(j);const e=nt.update(t),r=t.material;r.visible&&u.push(t,e,r,i,V.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==Z.render.frame&&(t.skeleton.update(),t.skeleton.frame=Z.render.frame),!t.frustumCulled||U.intersectsObject(t))){n&&V.setFromMatrixPosition(t.matrixWorld).applyMatrix4(j);const e=nt.update(t),r=t.material;if(Array.isArray(r)){const n=e.groups;for(let s=0,o=n.length;s<o;s++){const o=n[s],a=r[o.materialIndex];a&&a.visible&&u.push(t,e,a,i,V.z,o)}}else r.visible&&u.push(t,e,r,i,V.z,null)}const r=t.children;for(let t=0,s=r.length;t<s;t++)Pt(r[t],e,i,n)}function It(t,e,i,n){const r=t.opaque,o=t.transmissive,a=t.transparent;d.setupLightsView(i),o.length>0&&function(t,e,i){const n=X.isWebGL2;null===k&&(k=new Xt(1,1,{generateMipmaps:!0,type:null!==mt.convert(S)?S:x,minFilter:_,samples:n&&!0===s?4:0}));m.getDrawingBufferSize(H),n?k.setSize(H.x,H.y):k.setSize(At(H.x),At(H.y));const r=m.getRenderTarget();m.setRenderTarget(k),m.clear();const o=m.toneMapping;m.toneMapping=0,Dt(t,e,i),m.toneMapping=o,Q.updateMultisampleRenderTarget(k),Q.updateRenderTargetMipmap(k),m.setRenderTarget(r)}(r,e,i),n&&Y.viewport(E.copy(n)),r.length>0&&Dt(r,e,i),o.length>0&&Dt(o,e,i),a.length>0&&Dt(a,e,i),Y.buffers.depth.setTest(!0),Y.buffers.depth.setMask(!0),Y.buffers.color.setMask(!0),Y.setPolygonOffset(!1)}function Dt(t,e,i){const n=!0===e.isScene?e.overrideMaterial:null;for(let r=0,s=t.length;r<s;r++){const s=t[r],o=s.object,a=s.geometry,l=null===n?s.material:n,c=s.group;o.layers.test(i.layers)&&Rt(o,e,i,a,l,c)}}function Rt(t,e,i,n,r,s){t.onBeforeRender(m,e,i,n,r,s),t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),r.onBeforeRender(m,e,i,n,t,s),!0===r.transparent&&2===r.side?(r.side=1,r.needsUpdate=!0,m.renderBufferDirect(i,e,n,r,t,s),r.side=0,r.needsUpdate=!0,m.renderBufferDirect(i,e,n,r,t,s),r.side=2):m.renderBufferDirect(i,e,n,r,t,s),t.onAfterRender(m,e,i,n,r,s)}function Bt(t,e,i){!0!==e.isScene&&(e=W);const n=K.get(t),r=d.state.lights,s=d.state.shadowsArray,o=r.state.version,a=rt.getParameters(t,r.state,s,e,i),l=rt.getProgramCacheKey(a);let c=n.programs;n.environment=t.isMeshStandardMaterial?e.environment:null,n.fog=e.fog,n.envMap=(t.isMeshStandardMaterial?tt:$).get(t.envMap||n.environment),void 0===c&&(t.addEventListener("dispose",wt),c=new Map,n.programs=c);let h=c.get(l);if(void 0!==h){if(n.currentProgram===h&&n.lightsStateVersion===o)return Nt(t,a),h}else a.uniforms=rt.getUniforms(t),t.onBuild(i,a,m),t.onBeforeCompile(a,m),h=rt.acquireProgram(a,l),c.set(l,h),n.uniforms=a.uniforms;const u=n.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(u.clippingPlanes=ct.uniform),Nt(t,a),n.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),n.lightsStateVersion=o,n.needsLights&&(u.ambientLightColor.value=r.state.ambient,u.lightProbe.value=r.state.probe,u.directionalLights.value=r.state.directional,u.directionalLightShadows.value=r.state.directionalShadow,u.spotLights.value=r.state.spot,u.spotLightShadows.value=r.state.spotShadow,u.rectAreaLights.value=r.state.rectArea,u.ltc_1.value=r.state.rectAreaLTC1,u.ltc_2.value=r.state.rectAreaLTC2,u.pointLights.value=r.state.point,u.pointLightShadows.value=r.state.pointShadow,u.hemisphereLights.value=r.state.hemi,u.directionalShadowMap.value=r.state.directionalShadowMap,u.directionalShadowMatrix.value=r.state.directionalShadowMatrix,u.spotShadowMap.value=r.state.spotShadowMap,u.spotShadowMatrix.value=r.state.spotShadowMatrix,u.pointShadowMap.value=r.state.pointShadowMap,u.pointShadowMatrix.value=r.state.pointShadowMatrix);const p=h.getUniforms(),f=cs.seqWithValue(p.seq,u);return n.currentProgram=h,n.uniformsList=f,h}function Nt(t,e){const i=K.get(t);i.outputEncoding=e.outputEncoding,i.instancing=e.instancing,i.skinning=e.skinning,i.morphTargets=e.morphTargets,i.morphNormals=e.morphNormals,i.morphColors=e.morphColors,i.morphTargetsCount=e.morphTargetsCount,i.numClippingPlanes=e.numClippingPlanes,i.numIntersection=e.numClipIntersection,i.vertexAlphas=e.vertexAlphas,i.vertexTangents=e.vertexTangents,i.toneMapping=e.toneMapping}Ot.setAnimationLoop((function(t){St&&St(t)})),"undefined"!=typeof window&&Ot.setContext(window),this.setAnimationLoop=function(t){St=t,xt.setAnimationLoop(t),null===t?Ot.stop():Ot.start()},xt.addEventListener("sessionstart",Tt),xt.addEventListener("sessionend",Et),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===g)return;!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===xt.enabled&&!0===xt.isPresenting&&(!0===xt.cameraAutoUpdate&&xt.updateCamera(e),e=xt.getCamera()),!0===t.isScene&&t.onBeforeRender(m,t,e,M),d=at.get(t,f.length),d.init(),f.push(d),j.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),U.setFromProjectionMatrix(j),z=this.localClippingEnabled,G=ct.init(this.clippingPlanes,z,e),u=ot.get(t,p.length),u.init(),p.push(u),Pt(t,e,0,m.sortObjects),u.finish(),!0===m.sortObjects&&u.sort(L,R),!0===G&&ct.beginShadows();const i=d.state.shadowsArray;if(ht.render(i,t,e),!0===G&&ct.endShadows(),!0===this.info.autoReset&&this.info.reset(),ut.render(u,t),d.setupLights(m.physicallyCorrectLights),e.isArrayCamera){const i=e.cameras;for(let e=0,n=i.length;e<n;e++){const n=i[e];It(u,t,n,n.viewport)}}else It(u,t,e);null!==M&&(Q.updateMultisampleRenderTarget(M),Q.updateRenderTargetMipmap(M)),!0===t.isScene&&t.onAfterRender(m,t,e),gt.resetDefaultState(),b=-1,T=null,f.pop(),d=f.length>0?f[f.length-1]:null,p.pop(),u=p.length>0?p[p.length-1]:null},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return M},this.setRenderTargetTextures=function(t,e,i){K.get(t.texture).__webglTexture=e,K.get(t.depthTexture).__webglTexture=i;const n=K.get(t);n.__hasExternalTextures=!0,n.__hasExternalTextures&&(n.__autoAllocateDepthBuffer=void 0===i,n.__autoAllocateDepthBuffer||!0===J.has("WEBGL_multisampled_render_to_texture")&&(n.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(t,e){const i=K.get(t);i.__webglFramebuffer=e,i.__useDefaultFramebuffer=void 0===e},this.setRenderTarget=function(t,e=0,i=0){M=t,v=e,y=i;let n=!0;if(t){const e=K.get(t);void 0!==e.__useDefaultFramebuffer?(Y.bindFramebuffer(vt.FRAMEBUFFER,null),n=!1):void 0===e.__webglFramebuffer?Q.setupRenderTarget(t):e.__hasExternalTextures&&Q.rebindTextures(t,K.get(t.texture).__webglTexture,K.get(t.depthTexture).__webglTexture)}let r=null,s=!1,o=!1;if(t){const i=t.texture;(i.isData3DTexture||i.isDataArrayTexture)&&(o=!0);const n=K.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=n[e],s=!0):r=X.isWebGL2&&t.samples>0&&!1===Q.useMultisampledRTT(t)?K.get(t).__webglMultisampledFramebuffer:n,E.copy(t.viewport),C.copy(t.scissor),O=t.scissorTest}else E.copy(B).multiplyScalar(D).floor(),C.copy(N).multiplyScalar(D).floor(),O=F;if(Y.bindFramebuffer(vt.FRAMEBUFFER,r)&&X.drawBuffers&&n&&Y.drawBuffers(t,r),Y.viewport(E),Y.scissor(C),Y.setScissorTest(O),s){const n=K.get(t.texture);vt.framebufferTexture2D(vt.FRAMEBUFFER,vt.COLOR_ATTACHMENT0,vt.TEXTURE_CUBE_MAP_POSITIVE_X+e,n.__webglTexture,i)}else if(o){const n=K.get(t.texture),r=e||0;vt.framebufferTextureLayer(vt.FRAMEBUFFER,vt.COLOR_ATTACHMENT0,n.__webglTexture,i||0,r)}b=-1},this.readRenderTargetPixels=function(t,e,i,n,r,s,o){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=K.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){Y.bindFramebuffer(vt.FRAMEBUFFER,a);try{const o=t.texture,a=o.format,l=o.type;if(a!==A&&mt.convert(a)!==vt.getParameter(vt.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===S&&(J.has("EXT_color_buffer_half_float")||X.isWebGL2&&J.has("EXT_color_buffer_float"));if(!(l===x||mt.convert(l)===vt.getParameter(vt.IMPLEMENTATION_COLOR_READ_TYPE)||l===w&&(X.isWebGL2||J.has("OES_texture_float")||J.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");vt.checkFramebufferStatus(vt.FRAMEBUFFER)===vt.FRAMEBUFFER_COMPLETE?e>=0&&e<=t.width-n&&i>=0&&i<=t.height-r&&vt.readPixels(e,i,n,r,mt.convert(a),mt.convert(l),s):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const t=null!==M?K.get(M).__webglFramebuffer:null;Y.bindFramebuffer(vt.FRAMEBUFFER,t)}}},this.copyFramebufferToTexture=function(t,e,i=0){if(!0!==e.isFramebufferTexture)return void console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");const n=Math.pow(2,-i),r=Math.floor(e.image.width*n),s=Math.floor(e.image.height*n);Q.setTexture2D(e,0),vt.copyTexSubImage2D(vt.TEXTURE_2D,i,0,0,t.x,t.y,r,s),Y.unbindTexture()},this.copyTextureToTexture=function(t,e,i,n=0){const r=e.image.width,s=e.image.height,o=mt.convert(i.format),a=mt.convert(i.type);Q.setTexture2D(i,0),vt.pixelStorei(vt.UNPACK_FLIP_Y_WEBGL,i.flipY),vt.pixelStorei(vt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),vt.pixelStorei(vt.UNPACK_ALIGNMENT,i.unpackAlignment),e.isDataTexture?vt.texSubImage2D(vt.TEXTURE_2D,n,t.x,t.y,r,s,o,a,e.image.data):e.isCompressedTexture?vt.compressedTexSubImage2D(vt.TEXTURE_2D,n,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,o,e.mipmaps[0].data):vt.texSubImage2D(vt.TEXTURE_2D,n,t.x,t.y,o,a,e.image),0===n&&i.generateMipmaps&&vt.generateMipmap(vt.TEXTURE_2D),Y.unbindTexture()},this.copyTextureToTexture3D=function(t,e,i,n,r=0){if(m.isWebGL1Renderer)return;const s=t.max.x-t.min.x+1,o=t.max.y-t.min.y+1,a=t.max.z-t.min.z+1,l=mt.convert(n.format),c=mt.convert(n.type);let h;if(n.isData3DTexture)Q.setTexture3D(n,0),h=vt.TEXTURE_3D;else{if(!n.isDataArrayTexture)return;Q.setTexture2DArray(n,0),h=vt.TEXTURE_2D_ARRAY}vt.pixelStorei(vt.UNPACK_FLIP_Y_WEBGL,n.flipY),vt.pixelStorei(vt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),vt.pixelStorei(vt.UNPACK_ALIGNMENT,n.unpackAlignment);const u=vt.getParameter(vt.UNPACK_ROW_LENGTH),d=vt.getParameter(vt.UNPACK_IMAGE_HEIGHT),p=vt.getParameter(vt.UNPACK_SKIP_PIXELS),f=vt.getParameter(vt.UNPACK_SKIP_ROWS),g=vt.getParameter(vt.UNPACK_SKIP_IMAGES),v=i.isCompressedTexture?i.mipmaps[0]:i.image;vt.pixelStorei(vt.UNPACK_ROW_LENGTH,v.width),vt.pixelStorei(vt.UNPACK_IMAGE_HEIGHT,v.height),vt.pixelStorei(vt.UNPACK_SKIP_PIXELS,t.min.x),vt.pixelStorei(vt.UNPACK_SKIP_ROWS,t.min.y),vt.pixelStorei(vt.UNPACK_SKIP_IMAGES,t.min.z),i.isDataTexture||i.isData3DTexture?vt.texSubImage3D(h,r,e.x,e.y,e.z,s,o,a,l,c,v.data):i.isCompressedTexture?vt.compressedTexSubImage3D(h,r,e.x,e.y,e.z,s,o,a,l,v.data):vt.texSubImage3D(h,r,e.x,e.y,e.z,s,o,a,l,c,v),vt.pixelStorei(vt.UNPACK_ROW_LENGTH,u),vt.pixelStorei(vt.UNPACK_IMAGE_HEIGHT,d),vt.pixelStorei(vt.UNPACK_SKIP_PIXELS,p),vt.pixelStorei(vt.UNPACK_SKIP_ROWS,f),vt.pixelStorei(vt.UNPACK_SKIP_IMAGES,g),0===r&&n.generateMipmaps&&vt.generateMipmap(h),Y.unbindTexture()},this.initTexture=function(t){Q.setTexture2D(t,0),Y.unbindTexture()},this.resetState=function(){v=0,y=0,M=null,Y.reset(),gt.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}io.prototype.isWebGLRenderer=!0;class no extends io{}no.prototype.isWebGL1Renderer=!0;class ro{constructor(t,e=25e-5){this.name="",this.color=new zt(t),this.density=e}clone(){return new ro(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}ro.prototype.isFogExp2=!0;class so{constructor(t,e=1,i=1e3){this.name="",this.color=new zt(t),this.near=e,this.far=i}clone(){return new so(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}so.prototype.isFog=!0;class oo extends ni{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}oo.prototype.isScene=!0;class ao{constructor(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=ut,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=xt()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let n=0,r=this.stride;n<r;n++)this.array[t+n]=e.array[i+n];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=xt()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=xt()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}ao.prototype.isInterleavedBuffer=!0;const lo=new ee;class co{constructor(t,e,i,n=!1){this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=!0===n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)lo.x=this.getX(e),lo.y=this.getY(e),lo.z=this.getZ(e),lo.applyMatrix4(t),this.setXYZ(e,lo.x,lo.y,lo.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)lo.x=this.getX(e),lo.y=this.getY(e),lo.z=this.getZ(e),lo.applyNormalMatrix(t),this.setXYZ(e,lo.x,lo.y,lo.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)lo.x=this.getX(e),lo.y=this.getY(e),lo.z=this.getZ(e),lo.transformDirection(t),this.setXYZ(e,lo.x,lo.y,lo.z);return this}setX(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){return this.data.array[t*this.data.stride+this.offset]}getY(t){return this.data.array[t*this.data.stride+this.offset+1]}getZ(t){return this.data.array[t*this.data.stride+this.offset+2]}getW(t){return this.data.array[t*this.data.stride+this.offset+3]}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this}setXYZW(t,e,i,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this.data.array[t+3]=r,this}clone(t){if(void 0===t){const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return new xi(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new co(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}co.prototype.isInterleavedBufferAttribute=!0;class ho extends gi{constructor(t){super(),this.type="SpriteMaterial",this.color=new zt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this}}let uo;ho.prototype.isSpriteMaterial=!0;const po=new ee,fo=new ee,mo=new ee,go=new Ct,vo=new Ct,yo=new De,_o=new ee,xo=new ee,Mo=new ee,bo=new Ct,wo=new Ct,So=new Ct;class To extends ni{constructor(t){if(super(),this.type="Sprite",void 0===uo){uo=new Ui;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new ao(t,5);uo.setIndex([0,1,2,0,2,3]),uo.setAttribute("position",new co(e,3,0,!1)),uo.setAttribute("uv",new co(e,2,3,!1))}this.geometry=uo,this.material=void 0!==t?t:new ho,this.center=new Ct(.5,.5)}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),fo.setFromMatrixScale(this.matrixWorld),yo.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),mo.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&fo.multiplyScalar(-mo.z);const i=this.material.rotation;let n,r;0!==i&&(r=Math.cos(i),n=Math.sin(i));const s=this.center;Ao(_o.set(-.5,-.5,0),mo,s,fo,n,r),Ao(xo.set(.5,-.5,0),mo,s,fo,n,r),Ao(Mo.set(.5,.5,0),mo,s,fo,n,r),bo.set(0,0),wo.set(1,0),So.set(1,1);let o=t.ray.intersectTriangle(_o,xo,Mo,!1,po);if(null===o&&(Ao(xo.set(-.5,.5,0),mo,s,fo,n,r),wo.set(0,1),o=t.ray.intersectTriangle(_o,Mo,xo,!1,po),null===o))return;const a=t.ray.origin.distanceTo(po);a<t.near||a>t.far||e.push({distance:a,point:po.clone(),uv:fi.getUV(po,_o,xo,Mo,bo,wo,So,new Ct),face:null,object:this})}copy(t){return super.copy(t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}function Ao(t,e,i,n,r,s){go.subVectors(t,i).addScalar(.5).multiply(n),void 0!==r?(vo.x=s*go.x-r*go.y,vo.y=r*go.x+s*go.y):vo.copy(go),t.copy(e),t.x+=vo.x,t.y+=vo.y,t.applyMatrix4(yo)}To.prototype.isSprite=!0;const Eo=new ee,Co=new ee;class Oo extends ni{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const e=t.levels;for(let t=0,i=e.length;t<i;t++){const i=e[t];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,e=0){e=Math.abs(e);const i=this.levels;let n;for(n=0;n<i.length&&!(e<i[n].distance);n++);return i.splice(n,0,{distance:e,object:t}),this.add(t),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const e=this.levels;if(e.length>0){let i,n;for(i=1,n=e.length;i<n&&!(t<e[i].distance);i++);return e[i-1].object}return null}raycast(t,e){if(this.levels.length>0){Eo.setFromMatrixPosition(this.matrixWorld);const i=t.ray.origin.distanceTo(Eo);this.getObjectForDistance(i).raycast(t,e)}}update(t){const e=this.levels;if(e.length>1){Eo.setFromMatrixPosition(t.matrixWorld),Co.setFromMatrixPosition(this.matrixWorld);const i=Eo.distanceTo(Co)/t.zoom;let n,r;for(e[0].object.visible=!0,n=1,r=e.length;n<r&&i>=e[n].distance;n++)e[n-1].object.visible=!1,e[n].object.visible=!0;for(this._currentLevel=n-1;n<r;n++)e[n].object.visible=!1}}toJSON(t){const e=super.toJSON(t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const i=this.levels;for(let t=0,n=i.length;t<n;t++){const n=i[t];e.object.levels.push({object:n.object.uuid,distance:n.distance})}return e}}const Po=new ee,Io=new Jt,Do=new Jt,Lo=new ee,Ro=new De;class Bo extends nn{constructor(t,e){super(t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new De,this.bindMatrixInverse=new De}copy(t){return super.copy(t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Jt,e=this.geometry.attributes.skinWeight;for(let i=0,n=e.count;i<n;i++){t.x=e.getX(i),t.y=e.getY(i),t.z=e.getZ(i),t.w=e.getW(i);const n=1/t.manhattanLength();n!==1/0?t.multiplyScalar(n):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():this.bindMode}boneTransform(t,e){const i=this.skeleton,n=this.geometry;Io.fromBufferAttribute(n.attributes.skinIndex,t),Do.fromBufferAttribute(n.attributes.skinWeight,t),Po.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const n=Do.getComponent(t);if(0!==n){const r=Io.getComponent(t);Ro.multiplyMatrices(i.bones[r].matrixWorld,i.boneInverses[r]),e.addScaledVector(Lo.copy(Po).applyMatrix4(Ro),n)}}return e.applyMatrix4(this.bindMatrixInverse)}}Bo.prototype.isSkinnedMesh=!0;class No extends ni{constructor(){super(),this.type="Bone"}}No.prototype.isBone=!0;class Fo extends qt{constructor(t=null,e=1,i=1,n,r,s,o,a,l=1003,c=1003,h,u){super(null,s,o,a,l,c,n,r,h,u),this.image={data:t,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Fo.prototype.isDataTexture=!0;const Uo=new De,Go=new De;class zo{constructor(t=[],e=[]){this.uuid=xt(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new De)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new De;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let n=0,r=t.length;n<r;n++){const r=t[n]?t[n].matrixWorld:Go;Uo.multiplyMatrices(r,e[n]),Uo.toArray(i,16*n)}null!==n&&(n.needsUpdate=!0)}clone(){return new zo(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=Tt(t),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const i=new Fo(e,t,t,A,w);return i.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=i,this.boneTextureSize=t,this}getBoneByName(t){for(let e=0,i=this.bones.length;e<i;e++){const i=this.bones[e];if(i.name===t)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let i=0,n=t.bones.length;i<n;i++){const n=t.bones[i];let r=e[n];void 0===r&&(r=new No),this.bones.push(r),this.boneInverses.push((new De).fromArray(t.boneInverses[i]))}return this.init(),this}toJSON(){const t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,i=this.boneInverses;for(let n=0,r=e.length;n<r;n++){const r=e[n];t.bones.push(r.uuid);const s=i[n];t.boneInverses.push(s.toArray())}return t}}class ko extends xi{constructor(t,e,i,n=1){"number"==typeof i&&(n=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(t,e,i),this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}ko.prototype.isInstancedBufferAttribute=!0;const jo=new De,Ho=new De,Vo=[],Wo=new nn;class qo extends nn{constructor(t,e,i){super(t,e),this.instanceMatrix=new ko(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(t){return super.copy(t),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}raycast(t,e){const i=this.matrixWorld,n=this.count;if(Wo.geometry=this.geometry,Wo.material=this.material,void 0!==Wo.material)for(let r=0;r<n;r++){this.getMatrixAt(r,jo),Ho.multiplyMatrices(i,jo),Wo.matrixWorld=Ho,Wo.raycast(t,Vo);for(let t=0,i=Vo.length;t<i;t++){const i=Vo[t];i.instanceId=r,i.object=this,e.push(i)}Vo.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new ko(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}qo.prototype.isInstancedMesh=!0;class Jo extends gi{constructor(t){super(),this.type="LineBasicMaterial",this.color=new zt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this}}Jo.prototype.isLineBasicMaterial=!0;const Xo=new ee,Yo=new ee,Zo=new De,Ko=new Ie,Qo=new we;class $o extends ni{constructor(t=new Ui,e=new Jo){super(),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry){if(null===t.index){const e=t.attributes.position,i=[0];for(let t=1,n=e.count;t<n;t++)Xo.fromBufferAttribute(e,t-1),Yo.fromBufferAttribute(e,t),i[t]=i[t-1],i[t]+=Xo.distanceTo(Yo);t.setAttribute("lineDistance",new Oi(i,1))}}else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,r=t.params.Line.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Qo.copy(i.boundingSphere),Qo.applyMatrix4(n),Qo.radius+=r,!1===t.ray.intersectsSphere(Qo))return;Zo.copy(n).invert(),Ko.copy(t.ray).applyMatrix4(Zo);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=new ee,c=new ee,h=new ee,u=new ee,d=this.isLineSegments?2:1;if(i.isBufferGeometry){const n=i.index,r=i.attributes.position;if(null!==n){for(let i=Math.max(0,s.start),o=Math.min(n.count,s.start+s.count)-1;i<o;i+=d){const s=n.getX(i),o=n.getX(i+1);l.fromBufferAttribute(r,s),c.fromBufferAttribute(r,o);if(Ko.distanceSqToSegment(l,c,u,h)>a)continue;u.applyMatrix4(this.matrixWorld);const d=t.ray.origin.distanceTo(u);d<t.near||d>t.far||e.push({distance:d,point:h.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else{for(let i=Math.max(0,s.start),n=Math.min(r.count,s.start+s.count)-1;i<n;i+=d){l.fromBufferAttribute(r,i),c.fromBufferAttribute(r,i+1);if(Ko.distanceSqToSegment(l,c,u,h)>a)continue;u.applyMatrix4(this.matrixWorld);const n=t.ray.origin.distanceTo(u);n<t.near||n>t.far||e.push({distance:n,point:h.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}else i.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}$o.prototype.isLine=!0;const ta=new ee,ea=new ee;class ia extends $o{constructor(t,e){super(t,e),this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry){if(null===t.index){const e=t.attributes.position,i=[];for(let t=0,n=e.count;t<n;t+=2)ta.fromBufferAttribute(e,t),ea.fromBufferAttribute(e,t+1),i[t]=0===t?0:i[t-1],i[t+1]=i[t]+ta.distanceTo(ea);t.setAttribute("lineDistance",new Oi(i,1))}}else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}ia.prototype.isLineSegments=!0;class na extends $o{constructor(t,e){super(t,e),this.type="LineLoop"}}na.prototype.isLineLoop=!0;class ra extends gi{constructor(t){super(),this.type="PointsMaterial",this.color=new zt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this}}ra.prototype.isPointsMaterial=!0;const sa=new De,oa=new Ie,aa=new we,la=new ee;class ca extends ni{constructor(t=new Ui,e=new ra){super(),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,r=t.params.Points.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),aa.copy(i.boundingSphere),aa.applyMatrix4(n),aa.radius+=r,!1===t.ray.intersectsSphere(aa))return;sa.copy(n).invert(),oa.copy(t.ray).applyMatrix4(sa);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o;if(i.isBufferGeometry){const r=i.index,o=i.attributes.position;if(null!==r){for(let i=Math.max(0,s.start),l=Math.min(r.count,s.start+s.count);i<l;i++){const s=r.getX(i);la.fromBufferAttribute(o,s),ha(la,s,a,n,t,e,this)}}else{for(let i=Math.max(0,s.start),r=Math.min(o.count,s.start+s.count);i<r;i++)la.fromBufferAttribute(o,i),ha(la,i,a,n,t,e,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function ha(t,e,i,n,r,s,o){const a=oa.distanceSqToPoint(t);if(a<i){const i=new ee;oa.closestPointToPoint(t,i),i.applyMatrix4(n);const l=r.ray.origin.distanceTo(i);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:i,index:e,face:null,object:o})}}ca.prototype.isPoints=!0;class ua extends qt{constructor(t,e,i,n,r,s,o,a,l){super(t,e,i,n,r,s,o,a,l),this.minFilter=void 0!==s?s:v,this.magFilter=void 0!==r?r:v,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){c.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!1==="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}ua.prototype.isVideoTexture=!0;class da extends qt{constructor(t,e,i){super({width:t,height:e}),this.format=i,this.magFilter=f,this.minFilter=f,this.generateMipmaps=!1,this.needsUpdate=!0}}da.prototype.isFramebufferTexture=!0;class pa extends qt{constructor(t,e,i,n,r,s,o,a,l,c,h,u){super(null,s,o,a,l,c,n,r,h,u),this.image={width:e,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}pa.prototype.isCompressedTexture=!0;class fa extends qt{constructor(t,e,i,n,r,s,o,a,l){super(t,e,i,n,r,s,o,a,l),this.needsUpdate=!0}}fa.prototype.isCanvasTexture=!0;class ma extends Ui{constructor(t=1,e=8,i=0,n=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:i,thetaLength:n},e=Math.max(3,e);const r=[],s=[],o=[],a=[],l=new ee,c=new Ct;s.push(0,0,0),o.push(0,0,1),a.push(.5,.5);for(let r=0,h=3;r<=e;r++,h+=3){const u=i+r/e*n;l.x=t*Math.cos(u),l.y=t*Math.sin(u),s.push(l.x,l.y,l.z),o.push(0,0,1),c.x=(s[h]/t+1)/2,c.y=(s[h+1]/t+1)/2,a.push(c.x,c.y)}for(let t=1;t<=e;t++)r.push(t,t+1,0);this.setIndex(r),this.setAttribute("position",new Oi(s,3)),this.setAttribute("normal",new Oi(o,3)),this.setAttribute("uv",new Oi(a,2))}static fromJSON(t){return new ma(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class ga extends Ui{constructor(t=1,e=1,i=1,n=8,r=1,s=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a};const l=this;n=Math.floor(n),r=Math.floor(r);const c=[],h=[],u=[],d=[];let p=0;const f=[],m=i/2;let g=0;function v(i){const r=p,s=new Ct,f=new ee;let v=0;const y=!0===i?t:e,_=!0===i?1:-1;for(let t=1;t<=n;t++)h.push(0,m*_,0),u.push(0,_,0),d.push(.5,.5),p++;const x=p;for(let t=0;t<=n;t++){const e=t/n*a+o,i=Math.cos(e),r=Math.sin(e);f.x=y*r,f.y=m*_,f.z=y*i,h.push(f.x,f.y,f.z),u.push(0,_,0),s.x=.5*i+.5,s.y=.5*r*_+.5,d.push(s.x,s.y),p++}for(let t=0;t<n;t++){const e=r+t,n=x+t;!0===i?c.push(n,n+1,e):c.push(n+1,n,e),v+=3}l.addGroup(g,v,!0===i?1:2),g+=v}!function(){const s=new ee,v=new ee;let y=0;const _=(e-t)/i;for(let l=0;l<=r;l++){const c=[],g=l/r,y=g*(e-t)+t;for(let t=0;t<=n;t++){const e=t/n,r=e*a+o,l=Math.sin(r),f=Math.cos(r);v.x=y*l,v.y=-g*i+m,v.z=y*f,h.push(v.x,v.y,v.z),s.set(l,_,f).normalize(),u.push(s.x,s.y,s.z),d.push(e,1-g),c.push(p++)}f.push(c)}for(let t=0;t<n;t++)for(let e=0;e<r;e++){const i=f[e][t],n=f[e+1][t],r=f[e+1][t+1],s=f[e][t+1];c.push(i,n,s),c.push(n,r,s),y+=6}l.addGroup(g,y,0),g+=y}(),!1===s&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new Oi(h,3)),this.setAttribute("normal",new Oi(u,3)),this.setAttribute("uv",new Oi(d,2))}static fromJSON(t){return new ga(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class va extends ga{constructor(t=1,e=1,i=8,n=1,r=!1,s=0,o=2*Math.PI){super(0,t,e,i,n,r,s,o),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:s,thetaLength:o}}static fromJSON(t){return new va(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class ya extends Ui{constructor(t=[],e=[],i=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:n};const r=[],s=[];function o(t,e,i,n){const r=n+1,s=[];for(let n=0;n<=r;n++){s[n]=[];const o=t.clone().lerp(i,n/r),a=e.clone().lerp(i,n/r),l=r-n;for(let t=0;t<=l;t++)s[n][t]=0===t&&n===r?o:o.clone().lerp(a,t/l)}for(let t=0;t<r;t++)for(let e=0;e<2*(r-t)-1;e++){const i=Math.floor(e/2);e%2==0?(a(s[t][i+1]),a(s[t+1][i]),a(s[t][i])):(a(s[t][i+1]),a(s[t+1][i+1]),a(s[t+1][i]))}}function a(t){r.push(t.x,t.y,t.z)}function l(e,i){const n=3*e;i.x=t[n+0],i.y=t[n+1],i.z=t[n+2]}function c(t,e,i,n){n<0&&1===t.x&&(s[e]=t.x-1),0===i.x&&0===i.z&&(s[e]=n/2/Math.PI+.5)}function h(t){return Math.atan2(t.z,-t.x)}!function(t){const i=new ee,n=new ee,r=new ee;for(let s=0;s<e.length;s+=3)l(e[s+0],i),l(e[s+1],n),l(e[s+2],r),o(i,n,r,t)}(n),function(t){const e=new ee;for(let i=0;i<r.length;i+=3)e.x=r[i+0],e.y=r[i+1],e.z=r[i+2],e.normalize().multiplyScalar(t),r[i+0]=e.x,r[i+1]=e.y,r[i+2]=e.z}(i),function(){const t=new ee;for(let i=0;i<r.length;i+=3){t.x=r[i+0],t.y=r[i+1],t.z=r[i+2];const n=h(t)/2/Math.PI+.5,o=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);s.push(n,1-o)}var e;(function(){const t=new ee,e=new ee,i=new ee,n=new ee,o=new Ct,a=new Ct,l=new Ct;for(let u=0,d=0;u<r.length;u+=9,d+=6){t.set(r[u+0],r[u+1],r[u+2]),e.set(r[u+3],r[u+4],r[u+5]),i.set(r[u+6],r[u+7],r[u+8]),o.set(s[d+0],s[d+1]),a.set(s[d+2],s[d+3]),l.set(s[d+4],s[d+5]),n.copy(t).add(e).add(i).divideScalar(3);const p=h(n);c(o,d+0,t,p),c(a,d+2,e,p),c(l,d+4,i,p)}})(),function(){for(let t=0;t<s.length;t+=6){const e=s[t+0],i=s[t+2],n=s[t+4],r=Math.max(e,i,n),o=Math.min(e,i,n);r>.9&&o<.1&&(e<.2&&(s[t+0]+=1),i<.2&&(s[t+2]+=1),n<.2&&(s[t+4]+=1))}}()}(),this.setAttribute("position",new Oi(r,3)),this.setAttribute("normal",new Oi(r.slice(),3)),this.setAttribute("uv",new Oi(s,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(t){return new ya(t.vertices,t.indices,t.radius,t.details)}}class _a extends ya{constructor(t=1,e=0){const i=(1+Math.sqrt(5))/2,n=1/i;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new _a(t.radius,t.detail)}}const xa=new ee,Ma=new ee,ba=new ee,wa=new fi;class Sa extends Ui{constructor(t=null,e=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:e},null!==t){const i=4,n=Math.pow(10,i),r=Math.cos(yt*e),s=t.getIndex(),o=t.getAttribute("position"),a=s?s.count:o.count,l=[0,0,0],c=["a","b","c"],h=new Array(3),u={},d=[];for(let t=0;t<a;t+=3){s?(l[0]=s.getX(t),l[1]=s.getX(t+1),l[2]=s.getX(t+2)):(l[0]=t,l[1]=t+1,l[2]=t+2);const{a:e,b:i,c:a}=wa;if(e.fromBufferAttribute(o,l[0]),i.fromBufferAttribute(o,l[1]),a.fromBufferAttribute(o,l[2]),wa.getNormal(ba),h[0]=`${Math.round(e.x*n)},${Math.round(e.y*n)},${Math.round(e.z*n)}`,h[1]=`${Math.round(i.x*n)},${Math.round(i.y*n)},${Math.round(i.z*n)}`,h[2]=`${Math.round(a.x*n)},${Math.round(a.y*n)},${Math.round(a.z*n)}`,h[0]!==h[1]&&h[1]!==h[2]&&h[2]!==h[0])for(let t=0;t<3;t++){const e=(t+1)%3,i=h[t],n=h[e],s=wa[c[t]],o=wa[c[e]],a=`${i}_${n}`,p=`${n}_${i}`;p in u&&u[p]?(ba.dot(u[p].normal)<=r&&(d.push(s.x,s.y,s.z),d.push(o.x,o.y,o.z)),u[p]=null):a in u||(u[a]={index0:l[t],index1:l[e],normal:ba.clone()})}}for(const t in u)if(u[t]){const{index0:e,index1:i}=u[t];xa.fromBufferAttribute(o,e),Ma.fromBufferAttribute(o,i),d.push(xa.x,xa.y,xa.z),d.push(Ma.x,Ma.y,Ma.z)}this.setAttribute("position",new Oi(d,3))}}}class Ta{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return null}getPointAt(t,e){const i=this.getUtoTmapping(t);return this.getPoint(i,e)}getPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return e}getSpacedPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let i,n=this.getPoint(0),r=0;e.push(0);for(let s=1;s<=t;s++)i=this.getPoint(s/t),r+=i.distanceTo(n),e.push(r),n=i;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const i=this.getLengths();let n=0;const r=i.length;let s;s=e||t*i[r-1];let o,a=0,l=r-1;for(;a<=l;)if(n=Math.floor(a+(l-a)/2),o=i[n]-s,o<0)a=n+1;else{if(!(o>0)){l=n;break}l=n-1}if(n=l,i[n]===s)return n/(r-1);const c=i[n];return(n+(s-c)/(i[n+1]-c))/(r-1)}getTangent(t,e){const i=1e-4;let n=t-i,r=t+i;n<0&&(n=0),r>1&&(r=1);const s=this.getPoint(n),o=this.getPoint(r),a=e||(s.isVector2?new Ct:new ee);return a.copy(o).sub(s).normalize(),a}getTangentAt(t,e){const i=this.getUtoTmapping(t);return this.getTangent(i,e)}computeFrenetFrames(t,e){const i=new ee,n=[],r=[],s=[],o=new ee,a=new De;for(let e=0;e<=t;e++){const i=e/t;n[e]=this.getTangentAt(i,new ee)}r[0]=new ee,s[0]=new ee;let l=Number.MAX_VALUE;const c=Math.abs(n[0].x),h=Math.abs(n[0].y),u=Math.abs(n[0].z);c<=l&&(l=c,i.set(1,0,0)),h<=l&&(l=h,i.set(0,1,0)),u<=l&&i.set(0,0,1),o.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],o),s[0].crossVectors(n[0],r[0]);for(let e=1;e<=t;e++){if(r[e]=r[e-1].clone(),s[e]=s[e-1].clone(),o.crossVectors(n[e-1],n[e]),o.length()>Number.EPSILON){o.normalize();const t=Math.acos(Mt(n[e-1].dot(n[e]),-1,1));r[e].applyMatrix4(a.makeRotationAxis(o,t))}s[e].crossVectors(n[e],r[e])}if(!0===e){let e=Math.acos(Mt(r[0].dot(r[t]),-1,1));e/=t,n[0].dot(o.crossVectors(r[0],r[t]))>0&&(e=-e);for(let i=1;i<=t;i++)r[i].applyMatrix4(a.makeRotationAxis(n[i],e*i)),s[i].crossVectors(n[i],r[i])}return{tangents:n,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class Aa extends Ta{constructor(t=0,e=0,i=1,n=1,r=0,s=2*Math.PI,o=!1,a=0){super(),this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=o,this.aRotation=a}getPoint(t,e){const i=e||new Ct,n=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=s?0:n),!0!==this.aClockwise||s||(r===n?r=-n:r-=n);const o=this.aStartAngle+t*r;let a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),i=a-this.aX,n=l-this.aY;a=i*t-n*e+this.aX,l=i*e+n*t+this.aY}return i.set(a,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}Aa.prototype.isEllipseCurve=!0;class Ea extends Aa{constructor(t,e,i,n,r,s){super(t,e,i,i,n,r,s),this.type="ArcCurve"}}function Ca(){let t=0,e=0,i=0,n=0;function r(r,s,o,a){t=r,e=o,i=-3*r+3*s-2*o-a,n=2*r-2*s+o+a}return{initCatmullRom:function(t,e,i,n,s){r(e,i,s*(i-t),s*(n-e))},initNonuniformCatmullRom:function(t,e,i,n,s,o,a){let l=(e-t)/s-(i-t)/(s+o)+(i-e)/o,c=(i-e)/o-(n-e)/(o+a)+(n-i)/a;l*=o,c*=o,r(e,i,l,c)},calc:function(r){const s=r*r;return t+e*r+i*s+n*(s*r)}}}Ea.prototype.isArcCurve=!0;const Oa=new ee,Pa=new Ca,Ia=new Ca,Da=new Ca;class La extends Ta{constructor(t=[],e=!1,i="centripetal",n=.5){super(),this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=i,this.tension=n}getPoint(t,e=new ee){const i=e,n=this.points,r=n.length,s=(r-(this.closed?0:1))*t;let o,a,l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===c&&l===r-1&&(l=r-2,c=1),this.closed||l>0?o=n[(l-1)%r]:(Oa.subVectors(n[0],n[1]).add(n[0]),o=Oa);const h=n[l%r],u=n[(l+1)%r];if(this.closed||l+2<r?a=n[(l+2)%r]:(Oa.subVectors(n[r-1],n[r-2]).add(n[r-1]),a=Oa),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(o.distanceToSquared(h),t),i=Math.pow(h.distanceToSquared(u),t),n=Math.pow(u.distanceToSquared(a),t);i<1e-4&&(i=1),e<1e-4&&(e=i),n<1e-4&&(n=i),Pa.initNonuniformCatmullRom(o.x,h.x,u.x,a.x,e,i,n),Ia.initNonuniformCatmullRom(o.y,h.y,u.y,a.y,e,i,n),Da.initNonuniformCatmullRom(o.z,h.z,u.z,a.z,e,i,n)}else"catmullrom"===this.curveType&&(Pa.initCatmullRom(o.x,h.x,u.x,a.x,this.tension),Ia.initCatmullRom(o.y,h.y,u.y,a.y,this.tension),Da.initCatmullRom(o.z,h.z,u.z,a.z,this.tension));return i.set(Pa.calc(c),Ia.calc(c),Da.calc(c)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new ee).fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function Ra(t,e,i,n,r){const s=.5*(n-e),o=.5*(r-i),a=t*t;return(2*i-2*n+s+o)*(t*a)+(-3*i+3*n-2*s-o)*a+s*t+i}function Ba(t,e,i,n){return function(t,e){const i=1-t;return i*i*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,i)+function(t,e){return t*t*e}(t,n)}function Na(t,e,i,n,r){return function(t,e){const i=1-t;return i*i*i*e}(t,e)+function(t,e){const i=1-t;return 3*i*i*t*e}(t,i)+function(t,e){return 3*(1-t)*t*t*e}(t,n)+function(t,e){return t*t*t*e}(t,r)}La.prototype.isCatmullRomCurve3=!0;class Fa extends Ta{constructor(t=new Ct,e=new Ct,i=new Ct,n=new Ct){super(),this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new Ct){const i=e,n=this.v0,r=this.v1,s=this.v2,o=this.v3;return i.set(Na(t,n.x,r.x,s.x,o.x),Na(t,n.y,r.y,s.y,o.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}Fa.prototype.isCubicBezierCurve=!0;class Ua extends Ta{constructor(t=new ee,e=new ee,i=new ee,n=new ee){super(),this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new ee){const i=e,n=this.v0,r=this.v1,s=this.v2,o=this.v3;return i.set(Na(t,n.x,r.x,s.x,o.x),Na(t,n.y,r.y,s.y,o.y),Na(t,n.z,r.z,s.z,o.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}Ua.prototype.isCubicBezierCurve3=!0;class Ga extends Ta{constructor(t=new Ct,e=new Ct){super(),this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new Ct){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){const i=e||new Ct;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Ga.prototype.isLineCurve=!0;class za extends Ta{constructor(t=new ee,e=new ee){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=t,this.v2=e}getPoint(t,e=new ee){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class ka extends Ta{constructor(t=new Ct,e=new Ct,i=new Ct){super(),this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new Ct){const i=e,n=this.v0,r=this.v1,s=this.v2;return i.set(Ba(t,n.x,r.x,s.x),Ba(t,n.y,r.y,s.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}ka.prototype.isQuadraticBezierCurve=!0;class ja extends Ta{constructor(t=new ee,e=new ee,i=new ee){super(),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new ee){const i=e,n=this.v0,r=this.v1,s=this.v2;return i.set(Ba(t,n.x,r.x,s.x),Ba(t,n.y,r.y,s.y),Ba(t,n.z,r.z,s.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}ja.prototype.isQuadraticBezierCurve3=!0;class Ha extends Ta{constructor(t=[]){super(),this.type="SplineCurve",this.points=t}getPoint(t,e=new Ct){const i=e,n=this.points,r=(n.length-1)*t,s=Math.floor(r),o=r-s,a=n[0===s?s:s-1],l=n[s],c=n[s>n.length-2?n.length-1:s+1],h=n[s>n.length-3?n.length-1:s+2];return i.set(Ra(o,a.x,l.x,c.x,h.x),Ra(o,a.y,l.y,c.y,h.y)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new Ct).fromArray(i))}return this}}Ha.prototype.isSplineCurve=!0;var Va=Object.freeze({__proto__:null,ArcCurve:Ea,CatmullRomCurve3:La,CubicBezierCurve:Fa,CubicBezierCurve3:Ua,EllipseCurve:Aa,LineCurve:Ga,LineCurve3:za,QuadraticBezierCurve:ka,QuadraticBezierCurve3:ja,SplineCurve:Ha});class Wa extends Ta{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Ga(e,t))}getPoint(t,e){const i=t*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=i){const t=n[r]-i,s=this.curves[r],o=s.getLength(),a=0===o?0:1-t/o;return s.getPointAt(a,e)}r++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let i=0,n=this.curves.length;i<n;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let i;for(let n=0,r=this.curves;n<r.length;n++){const s=r[n],o=s.isEllipseCurve?2*t:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?t*s.points.length:t,a=s.getPoints(o);for(let t=0;t<a.length;t++){const n=a[t];i&&i.equals(n)||(e.push(n),i=n)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,i=this.curves.length;e<i;e++){const i=this.curves[e];t.curves.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push((new Va[i.type]).fromJSON(i))}return this}}class qa extends Wa{constructor(t){super(),this.type="Path",this.currentPoint=new Ct,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const i=new Ga(this.currentPoint.clone(),new Ct(t,e));return this.curves.push(i),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,i,n){const r=new ka(this.currentPoint.clone(),new Ct(t,e),new Ct(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this}bezierCurveTo(t,e,i,n,r,s){const o=new Fa(this.currentPoint.clone(),new Ct(t,e),new Ct(i,n),new Ct(r,s));return this.curves.push(o),this.currentPoint.set(r,s),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),i=new Ha(e);return this.curves.push(i),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,i,n,r,s){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+o,e+a,i,n,r,s),this}absarc(t,e,i,n,r,s){return this.absellipse(t,e,i,i,n,r,s),this}ellipse(t,e,i,n,r,s,o,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,e+c,i,n,r,s,o,a),this}absellipse(t,e,i,n,r,s,o,a){const l=new Aa(t,e,i,n,r,s,o,a);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class Ja extends qa{constructor(t){super(t),this.uuid=xt(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let i=0,n=this.holes.length;i<n;i++)e[i]=this.holes[i].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,i=this.holes.length;e<i;e++){const i=this.holes[e];t.holes.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push((new qa).fromJSON(i))}return this}}const Xa=function(t,e,i=2){const n=e&&e.length,r=n?e[0]*i:t.length;let s=Ya(t,0,r,i,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,c,h,u,d,p;if(n&&(s=function(t,e,i,n){const r=[];let s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*n,l=s<o-1?e[s+1]*n:t.length,c=Ya(t,a,l,n,!1),c===c.next&&(c.steiner=!0),r.push(ol(c));for(r.sort(il),s=0;s<r.length;s++)nl(r[s],i),i=Za(i,i.next);return i}(t,e,s,i)),t.length>80*i){a=c=t[0],l=h=t[1];for(let e=i;e<r;e+=i)u=t[e],d=t[e+1],u<a&&(a=u),d<l&&(l=d),u>c&&(c=u),d>h&&(h=d);p=Math.max(c-a,h-l),p=0!==p?1/p:0}return Ka(s,o,i,a,l,p),o};function Ya(t,e,i,n,r){let s,o;if(r===function(t,e,i,n){let r=0;for(let s=e,o=i-n;s<i;s+=n)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}(t,e,i,n)>0)for(s=e;s<i;s+=n)o=gl(s,t[s],t[s+1],o);else for(s=i-n;s>=e;s-=n)o=gl(s,t[s],t[s+1],o);return o&&hl(o,o.next)&&(vl(o),o=o.next),o}function Za(t,e){if(!t)return t;e||(e=t);let i,n=t;do{if(i=!1,n.steiner||!hl(n,n.next)&&0!==cl(n.prev,n,n.next))n=n.next;else{if(vl(n),n=e=n.prev,n===n.next)break;i=!0}}while(i||n!==e);return e}function Ka(t,e,i,n,r,s,o){if(!t)return;!o&&s&&function(t,e,i,n){let r=t;do{null===r.z&&(r.z=sl(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,i,n,r,s,o,a,l,c=1;do{for(i=t,t=null,s=null,o=0;i;){for(o++,n=i,a=0,e=0;e<c&&(a++,n=n.nextZ,n);e++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}s.nextZ=null,c*=2}while(o>1)}(r)}(t,n,r,s);let a,l,c=t;for(;t.prev!==t.next;)if(a=t.prev,l=t.next,s?$a(t,n,r,s):Qa(t))e.push(a.i/i),e.push(t.i/i),e.push(l.i/i),vl(t),t=l.next,c=l.next;else if((t=l)===c){o?1===o?Ka(t=tl(Za(t),e,i),e,i,n,r,s,2):2===o&&el(t,e,i,n,r,s):Ka(Za(t),e,i,n,r,s,1);break}}function Qa(t){const e=t.prev,i=t,n=t.next;if(cl(e,i,n)>=0)return!1;let r=t.next.next;for(;r!==t.prev;){if(al(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&cl(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function $a(t,e,i,n){const r=t.prev,s=t,o=t.next;if(cl(r,s,o)>=0)return!1;const a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,l=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,c=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,h=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,u=sl(a,l,e,i,n),d=sl(c,h,e,i,n);let p=t.prevZ,f=t.nextZ;for(;p&&p.z>=u&&f&&f.z<=d;){if(p!==t.prev&&p!==t.next&&al(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&cl(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==t.prev&&f!==t.next&&al(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&cl(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=u;){if(p!==t.prev&&p!==t.next&&al(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&cl(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==t.prev&&f!==t.next&&al(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&cl(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function tl(t,e,i){let n=t;do{const r=n.prev,s=n.next.next;!hl(r,s)&&ul(r,n,n.next,s)&&fl(r,s)&&fl(s,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(s.i/i),vl(n),vl(n.next),n=t=s),n=n.next}while(n!==t);return Za(n)}function el(t,e,i,n,r,s){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&ll(o,t)){let a=ml(o,t);return o=Za(o,o.next),a=Za(a,a.next),Ka(o,e,i,n,r,s),void Ka(a,e,i,n,r,s)}t=t.next}o=o.next}while(o!==t)}function il(t,e){return t.x-e.x}function nl(t,e){if(e=function(t,e){let i=e;const n=t.x,r=t.y;let s,o=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const t=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=n&&t>o){if(o=t,t===n){if(r===i.y)return i;if(r===i.next.y)return i.next}s=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!s)return null;if(n===o)return s;const a=s,l=s.x,c=s.y;let h,u=1/0;i=s;do{n>=i.x&&i.x>=l&&n!==i.x&&al(r<c?n:o,r,l,c,r<c?o:n,r,i.x,i.y)&&(h=Math.abs(r-i.y)/(n-i.x),fl(i,t)&&(h<u||h===u&&(i.x>s.x||i.x===s.x&&rl(s,i)))&&(s=i,u=h)),i=i.next}while(i!==a);return s}(t,e),e){const i=ml(e,t);Za(e,e.next),Za(i,i.next)}}function rl(t,e){return cl(t.prev,t,e.prev)<0&&cl(e.next,t,t.next)<0}function sl(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ol(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function al(t,e,i,n,r,s,o,a){return(r-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(n-a)-(i-o)*(e-a)>=0&&(i-o)*(s-a)-(r-o)*(n-a)>=0}function ll(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&ul(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(fl(t,e)&&fl(e,t)&&function(t,e){let i=t,n=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(cl(t.prev,t,e.prev)||cl(t,e.prev,e))||hl(t,e)&&cl(t.prev,t,t.next)>0&&cl(e.prev,e,e.next)>0)}function cl(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function hl(t,e){return t.x===e.x&&t.y===e.y}function ul(t,e,i,n){const r=pl(cl(t,e,i)),s=pl(cl(t,e,n)),o=pl(cl(i,n,t)),a=pl(cl(i,n,e));return r!==s&&o!==a||(!(0!==r||!dl(t,i,e))||(!(0!==s||!dl(t,n,e))||(!(0!==o||!dl(i,t,n))||!(0!==a||!dl(i,e,n)))))}function dl(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function pl(t){return t>0?1:t<0?-1:0}function fl(t,e){return cl(t.prev,t,t.next)<0?cl(t,e,t.next)>=0&&cl(t,t.prev,e)>=0:cl(t,e,t.prev)<0||cl(t,t.next,e)<0}function ml(t,e){const i=new yl(t.i,t.x,t.y),n=new yl(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function gl(t,e,i,n){const r=new yl(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function vl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function yl(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class _l{static area(t){const e=t.length;let i=0;for(let n=e-1,r=0;r<e;n=r++)i+=t[n].x*t[r].y-t[r].x*t[n].y;return.5*i}static isClockWise(t){return _l.area(t)<0}static triangulateShape(t,e){const i=[],n=[],r=[];xl(t),Ml(i,t);let s=t.length;e.forEach(xl);for(let t=0;t<e.length;t++)n.push(s),s+=e[t].length,Ml(i,e[t]);const o=Xa(i,n);for(let t=0;t<o.length;t+=3)r.push(o.slice(t,t+3));return r}}function xl(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function Ml(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}class bl extends Ui{constructor(t=new Ja([new Ct(.5,.5),new Ct(-.5,.5),new Ct(-.5,-.5),new Ct(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const i=this,n=[],r=[];for(let e=0,i=t.length;e<i;e++){s(t[e])}function s(t){const s=[],o=void 0!==e.curveSegments?e.curveSegments:12,a=void 0!==e.steps?e.steps:1;let l=void 0!==e.depth?e.depth:1,c=void 0===e.bevelEnabled||e.bevelEnabled,h=void 0!==e.bevelThickness?e.bevelThickness:.2,u=void 0!==e.bevelSize?e.bevelSize:h-.1,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3;const f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:wl;void 0!==e.amount&&(l=e.amount);let g,v,y,_,x,M=!1;f&&(g=f.getSpacedPoints(a),M=!0,c=!1,v=f.computeFrenetFrames(a,!1),y=new ee,_=new ee,x=new ee),c||(p=0,h=0,u=0,d=0);const b=t.extractPoints(o);let w=b.shape;const S=b.holes;if(!_l.isClockWise(w)){w=w.reverse();for(let t=0,e=S.length;t<e;t++){const e=S[t];_l.isClockWise(e)&&(S[t]=e.reverse())}}const T=_l.triangulateShape(w,S),A=w;for(let t=0,e=S.length;t<e;t++){const e=S[t];w=w.concat(e)}function E(t,e,i){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(i).add(t)}const C=w.length,O=T.length;function P(t,e,i){let n,r,s;const o=t.x-e.x,a=t.y-e.y,l=i.x-t.x,c=i.y-t.y,h=o*o+a*a,u=o*c-a*l;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(h),d=Math.sqrt(l*l+c*c),p=e.x-a/u,f=e.y+o/u,m=((i.x-c/d-p)*c-(i.y+l/d-f)*l)/(o*c-a*l);n=p+o*m-t.x,r=f+a*m-t.y;const g=n*n+r*r;if(g<=2)return new Ct(n,r);s=Math.sqrt(g/2)}else{let t=!1;o>Number.EPSILON?l>Number.EPSILON&&(t=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(a)===Math.sign(c)&&(t=!0),t?(n=-a,r=o,s=Math.sqrt(h)):(n=o,r=a,s=Math.sqrt(h/2))}return new Ct(n/s,r/s)}const I=[];for(let t=0,e=A.length,i=e-1,n=t+1;t<e;t++,i++,n++)i===e&&(i=0),n===e&&(n=0),I[t]=P(A[t],A[i],A[n]);const D=[];let L,R=I.concat();for(let t=0,e=S.length;t<e;t++){const e=S[t];L=[];for(let t=0,i=e.length,n=i-1,r=t+1;t<i;t++,n++,r++)n===i&&(n=0),r===i&&(r=0),L[t]=P(e[t],e[n],e[r]);D.push(L),R=R.concat(L)}for(let t=0;t<p;t++){const e=t/p,i=h*Math.cos(e*Math.PI/2),n=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=A.length;t<e;t++){const e=E(A[t],I[t],n);F(e.x,e.y,-i)}for(let t=0,e=S.length;t<e;t++){const e=S[t];L=D[t];for(let t=0,r=e.length;t<r;t++){const r=E(e[t],L[t],n);F(r.x,r.y,-i)}}}const B=u+d;for(let t=0;t<C;t++){const e=c?E(w[t],R[t],B):w[t];M?(_.copy(v.normals[0]).multiplyScalar(e.x),y.copy(v.binormals[0]).multiplyScalar(e.y),x.copy(g[0]).add(_).add(y),F(x.x,x.y,x.z)):F(e.x,e.y,0)}for(let t=1;t<=a;t++)for(let e=0;e<C;e++){const i=c?E(w[e],R[e],B):w[e];M?(_.copy(v.normals[t]).multiplyScalar(i.x),y.copy(v.binormals[t]).multiplyScalar(i.y),x.copy(g[t]).add(_).add(y),F(x.x,x.y,x.z)):F(i.x,i.y,l/a*t)}for(let t=p-1;t>=0;t--){const e=t/p,i=h*Math.cos(e*Math.PI/2),n=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=A.length;t<e;t++){const e=E(A[t],I[t],n);F(e.x,e.y,l+i)}for(let t=0,e=S.length;t<e;t++){const e=S[t];L=D[t];for(let t=0,r=e.length;t<r;t++){const r=E(e[t],L[t],n);M?F(r.x,r.y+g[a-1].y,g[a-1].x+i):F(r.x,r.y,l+i)}}}function N(t,e){let i=t.length;for(;--i>=0;){const n=i;let r=i-1;r<0&&(r=t.length-1);for(let t=0,i=a+2*p;t<i;t++){const i=C*t,s=C*(t+1);G(e+n+i,e+r+i,e+r+s,e+n+s)}}}function F(t,e,i){s.push(t),s.push(e),s.push(i)}function U(t,e,r){z(t),z(e),z(r);const s=n.length/3,o=m.generateTopUV(i,n,s-3,s-2,s-1);k(o[0]),k(o[1]),k(o[2])}function G(t,e,r,s){z(t),z(e),z(s),z(e),z(r),z(s);const o=n.length/3,a=m.generateSideWallUV(i,n,o-6,o-3,o-2,o-1);k(a[0]),k(a[1]),k(a[3]),k(a[1]),k(a[2]),k(a[3])}function z(t){n.push(s[3*t+0]),n.push(s[3*t+1]),n.push(s[3*t+2])}function k(t){r.push(t.x),r.push(t.y)}!function(){const t=n.length/3;if(c){let t=0,e=C*t;for(let t=0;t<O;t++){const i=T[t];U(i[2]+e,i[1]+e,i[0]+e)}t=a+2*p,e=C*t;for(let t=0;t<O;t++){const i=T[t];U(i[0]+e,i[1]+e,i[2]+e)}}else{for(let t=0;t<O;t++){const e=T[t];U(e[2],e[1],e[0])}for(let t=0;t<O;t++){const e=T[t];U(e[0]+C*a,e[1]+C*a,e[2]+C*a)}}i.addGroup(t,n.length/3-t,0)}(),function(){const t=n.length/3;let e=0;N(A,e),e+=A.length;for(let t=0,i=S.length;t<i;t++){const i=S[t];N(i,e),e+=i.length}i.addGroup(t,n.length/3-t,1)}()}this.setAttribute("position",new Oi(n,3)),this.setAttribute("uv",new Oi(r,2)),this.computeVertexNormals()}toJSON(){const t=super.toJSON();return function(t,e,i){if(i.shapes=[],Array.isArray(t))for(let e=0,n=t.length;e<n;e++){const n=t[e];i.shapes.push(n.uuid)}else i.shapes.push(t.uuid);void 0!==e.extrudePath&&(i.options.extrudePath=e.extrudePath.toJSON());return i}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const i=[];for(let n=0,r=t.shapes.length;n<r;n++){const r=e[t.shapes[n]];i.push(r)}const n=t.options.extrudePath;return void 0!==n&&(t.options.extrudePath=(new Va[n.type]).fromJSON(n)),new bl(i,t.options)}}const wl={generateTopUV:function(t,e,i,n,r){const s=e[3*i],o=e[3*i+1],a=e[3*n],l=e[3*n+1],c=e[3*r],h=e[3*r+1];return[new Ct(s,o),new Ct(a,l),new Ct(c,h)]},generateSideWallUV:function(t,e,i,n,r,s){const o=e[3*i],a=e[3*i+1],l=e[3*i+2],c=e[3*n],h=e[3*n+1],u=e[3*n+2],d=e[3*r],p=e[3*r+1],f=e[3*r+2],m=e[3*s],g=e[3*s+1],v=e[3*s+2];return Math.abs(a-h)<Math.abs(o-c)?[new Ct(o,1-l),new Ct(c,1-u),new Ct(d,1-f),new Ct(m,1-v)]:[new Ct(a,1-l),new Ct(h,1-u),new Ct(p,1-f),new Ct(g,1-v)]}};class Sl extends ya{constructor(t=1,e=0){const i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Sl(t.radius,t.detail)}}class Tl extends Ui{constructor(t=[new Ct(0,.5),new Ct(.5,0),new Ct(0,-.5)],e=12,i=0,n=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:n},e=Math.floor(e),n=Mt(n,0,2*Math.PI);const r=[],s=[],o=[],a=[],l=[],c=1/e,h=new ee,u=new Ct,d=new ee,p=new ee,f=new ee;let m=0,g=0;for(let e=0;e<=t.length-1;e++)switch(e){case 0:m=t[e+1].x-t[e].x,g=t[e+1].y-t[e].y,d.x=1*g,d.y=-m,d.z=0*g,f.copy(d),d.normalize(),a.push(d.x,d.y,d.z);break;case t.length-1:a.push(f.x,f.y,f.z);break;default:m=t[e+1].x-t[e].x,g=t[e+1].y-t[e].y,d.x=1*g,d.y=-m,d.z=0*g,p.copy(d),d.x+=f.x,d.y+=f.y,d.z+=f.z,d.normalize(),a.push(d.x,d.y,d.z),f.copy(p)}for(let r=0;r<=e;r++){const d=i+r*c*n,p=Math.sin(d),f=Math.cos(d);for(let i=0;i<=t.length-1;i++){h.x=t[i].x*p,h.y=t[i].y,h.z=t[i].x*f,s.push(h.x,h.y,h.z),u.x=r/e,u.y=i/(t.length-1),o.push(u.x,u.y);const n=a[3*i+0]*p,c=a[3*i+1],d=a[3*i+0]*f;l.push(n,c,d)}}for(let i=0;i<e;i++)for(let e=0;e<t.length-1;e++){const n=e+i*t.length,s=n,o=n+t.length,a=n+t.length+1,l=n+1;r.push(s,o,l),r.push(a,l,o)}this.setIndex(r),this.setAttribute("position",new Oi(s,3)),this.setAttribute("uv",new Oi(o,2)),this.setAttribute("normal",new Oi(l,3))}static fromJSON(t){return new Tl(t.points,t.segments,t.phiStart,t.phiLength)}}class Al extends ya{constructor(t=1,e=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Al(t.radius,t.detail)}}class El extends Ui{constructor(t=.5,e=1,i=8,n=1,r=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:s},i=Math.max(3,i);const o=[],a=[],l=[],c=[];let h=t;const u=(e-t)/(n=Math.max(1,n)),d=new ee,p=new Ct;for(let t=0;t<=n;t++){for(let t=0;t<=i;t++){const n=r+t/i*s;d.x=h*Math.cos(n),d.y=h*Math.sin(n),a.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/e+1)/2,p.y=(d.y/e+1)/2,c.push(p.x,p.y)}h+=u}for(let t=0;t<n;t++){const e=t*(i+1);for(let t=0;t<i;t++){const n=t+e,r=n,s=n+i+1,a=n+i+2,l=n+1;o.push(r,s,l),o.push(s,a,l)}}this.setIndex(o),this.setAttribute("position",new Oi(a,3)),this.setAttribute("normal",new Oi(l,3)),this.setAttribute("uv",new Oi(c,2))}static fromJSON(t){return new El(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class Cl extends Ui{constructor(t=new Ja([new Ct(0,.5),new Ct(-.5,-.5),new Ct(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const i=[],n=[],r=[],s=[];let o=0,a=0;if(!1===Array.isArray(t))l(t);else for(let e=0;e<t.length;e++)l(t[e]),this.addGroup(o,a,e),o+=a,a=0;function l(t){const o=n.length/3,l=t.extractPoints(e);let c=l.shape;const h=l.holes;!1===_l.isClockWise(c)&&(c=c.reverse());for(let t=0,e=h.length;t<e;t++){const e=h[t];!0===_l.isClockWise(e)&&(h[t]=e.reverse())}const u=_l.triangulateShape(c,h);for(let t=0,e=h.length;t<e;t++){const e=h[t];c=c.concat(e)}for(let t=0,e=c.length;t<e;t++){const e=c[t];n.push(e.x,e.y,0),r.push(0,0,1),s.push(e.x,e.y)}for(let t=0,e=u.length;t<e;t++){const e=u[t],n=e[0]+o,r=e[1]+o,s=e[2]+o;i.push(n,r,s),a+=3}}this.setIndex(i),this.setAttribute("position",new Oi(n,3)),this.setAttribute("normal",new Oi(r,3)),this.setAttribute("uv",new Oi(s,2))}toJSON(){const t=super.toJSON();return function(t,e){if(e.shapes=[],Array.isArray(t))for(let i=0,n=t.length;i<n;i++){const n=t[i];e.shapes.push(n.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(t,e){const i=[];for(let n=0,r=t.shapes.length;n<r;n++){const r=e[t.shapes[n]];i.push(r)}return new Cl(i,t.curveSegments)}}class Ol extends Ui{constructor(t=1,e=32,i=16,n=0,r=2*Math.PI,s=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:r,thetaStart:s,thetaLength:o},e=Math.max(3,Math.floor(e)),i=Math.max(2,Math.floor(i));const a=Math.min(s+o,Math.PI);let l=0;const c=[],h=new ee,u=new ee,d=[],p=[],f=[],m=[];for(let d=0;d<=i;d++){const g=[],v=d/i;let y=0;0==d&&0==s?y=.5/e:d==i&&a==Math.PI&&(y=-.5/e);for(let i=0;i<=e;i++){const a=i/e;h.x=-t*Math.cos(n+a*r)*Math.sin(s+v*o),h.y=t*Math.cos(s+v*o),h.z=t*Math.sin(n+a*r)*Math.sin(s+v*o),p.push(h.x,h.y,h.z),u.copy(h).normalize(),f.push(u.x,u.y,u.z),m.push(a+y,1-v),g.push(l++)}c.push(g)}for(let t=0;t<i;t++)for(let n=0;n<e;n++){const e=c[t][n+1],r=c[t][n],o=c[t+1][n],l=c[t+1][n+1];(0!==t||s>0)&&d.push(e,r,l),(t!==i-1||a<Math.PI)&&d.push(r,o,l)}this.setIndex(d),this.setAttribute("position",new Oi(p,3)),this.setAttribute("normal",new Oi(f,3)),this.setAttribute("uv",new Oi(m,2))}static fromJSON(t){return new Ol(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class Pl extends ya{constructor(t=1,e=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Pl(t.radius,t.detail)}}class Il extends Ui{constructor(t=1,e=.4,i=8,n=6,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:n,arc:r},i=Math.floor(i),n=Math.floor(n);const s=[],o=[],a=[],l=[],c=new ee,h=new ee,u=new ee;for(let s=0;s<=i;s++)for(let d=0;d<=n;d++){const p=d/n*r,f=s/i*Math.PI*2;h.x=(t+e*Math.cos(f))*Math.cos(p),h.y=(t+e*Math.cos(f))*Math.sin(p),h.z=e*Math.sin(f),o.push(h.x,h.y,h.z),c.x=t*Math.cos(p),c.y=t*Math.sin(p),u.subVectors(h,c).normalize(),a.push(u.x,u.y,u.z),l.push(d/n),l.push(s/i)}for(let t=1;t<=i;t++)for(let e=1;e<=n;e++){const i=(n+1)*t+e-1,r=(n+1)*(t-1)+e-1,o=(n+1)*(t-1)+e,a=(n+1)*t+e;s.push(i,r,a),s.push(r,o,a)}this.setIndex(s),this.setAttribute("position",new Oi(o,3)),this.setAttribute("normal",new Oi(a,3)),this.setAttribute("uv",new Oi(l,2))}static fromJSON(t){return new Il(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class Dl extends Ui{constructor(t=1,e=.4,i=64,n=8,r=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:n,p:r,q:s},i=Math.floor(i),n=Math.floor(n);const o=[],a=[],l=[],c=[],h=new ee,u=new ee,d=new ee,p=new ee,f=new ee,m=new ee,g=new ee;for(let o=0;o<=i;++o){const y=o/i*r*Math.PI*2;v(y,r,s,t,d),v(y+.01,r,s,t,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let t=0;t<=n;++t){const r=t/n*Math.PI*2,s=-e*Math.cos(r),p=e*Math.sin(r);h.x=d.x+(s*g.x+p*f.x),h.y=d.y+(s*g.y+p*f.y),h.z=d.z+(s*g.z+p*f.z),a.push(h.x,h.y,h.z),u.subVectors(h,d).normalize(),l.push(u.x,u.y,u.z),c.push(o/i),c.push(t/n)}}for(let t=1;t<=i;t++)for(let e=1;e<=n;e++){const i=(n+1)*(t-1)+(e-1),r=(n+1)*t+(e-1),s=(n+1)*t+e,a=(n+1)*(t-1)+e;o.push(i,r,a),o.push(r,s,a)}function v(t,e,i,n,r){const s=Math.cos(t),o=Math.sin(t),a=i/e*t,l=Math.cos(a);r.x=n*(2+l)*.5*s,r.y=n*(2+l)*o*.5,r.z=n*Math.sin(a)*.5}this.setIndex(o),this.setAttribute("position",new Oi(a,3)),this.setAttribute("normal",new Oi(l,3)),this.setAttribute("uv",new Oi(c,2))}static fromJSON(t){return new Dl(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class Ll extends Ui{constructor(t=new ja(new ee(-1,-1,0),new ee(-1,1,0),new ee(1,1,0)),e=64,i=1,n=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:i,radialSegments:n,closed:r};const s=t.computeFrenetFrames(e,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const o=new ee,a=new ee,l=new Ct;let c=new ee;const h=[],u=[],d=[],p=[];function f(r){c=t.getPointAt(r/e,c);const l=s.normals[r],d=s.binormals[r];for(let t=0;t<=n;t++){const e=t/n*Math.PI*2,r=Math.sin(e),s=-Math.cos(e);a.x=s*l.x+r*d.x,a.y=s*l.y+r*d.y,a.z=s*l.z+r*d.z,a.normalize(),u.push(a.x,a.y,a.z),o.x=c.x+i*a.x,o.y=c.y+i*a.y,o.z=c.z+i*a.z,h.push(o.x,o.y,o.z)}}!function(){for(let t=0;t<e;t++)f(t);f(!1===r?e:0),function(){for(let t=0;t<=e;t++)for(let i=0;i<=n;i++)l.x=t/e,l.y=i/n,d.push(l.x,l.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=n;e++){const i=(n+1)*(t-1)+(e-1),r=(n+1)*t+(e-1),s=(n+1)*t+e,o=(n+1)*(t-1)+e;p.push(i,r,o),p.push(r,s,o)}}()}(),this.setIndex(p),this.setAttribute("position",new Oi(h,3)),this.setAttribute("normal",new Oi(u,3)),this.setAttribute("uv",new Oi(d,2))}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new Ll((new Va[t.path.type]).fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class Rl extends Ui{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},null!==t){const e=[],i=new Set,n=new ee,r=new ee;if(null!==t.index){const s=t.attributes.position,o=t.index;let a=t.groups;0===a.length&&(a=[{start:0,count:o.count,materialIndex:0}]);for(let t=0,l=a.length;t<l;++t){const l=a[t],c=l.start;for(let t=c,a=c+l.count;t<a;t+=3)for(let a=0;a<3;a++){const l=o.getX(t+a),c=o.getX(t+(a+1)%3);n.fromBufferAttribute(s,l),r.fromBufferAttribute(s,c),!0===Bl(n,r,i)&&(e.push(n.x,n.y,n.z),e.push(r.x,r.y,r.z))}}}else{const s=t.attributes.position;for(let t=0,o=s.count/3;t<o;t++)for(let o=0;o<3;o++){const a=3*t+o,l=3*t+(o+1)%3;n.fromBufferAttribute(s,a),r.fromBufferAttribute(s,l),!0===Bl(n,r,i)&&(e.push(n.x,n.y,n.z),e.push(r.x,r.y,r.z))}}this.setAttribute("position",new Oi(e,3))}}}function Bl(t,e,i){const n=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`;return!0!==i.has(n)&&!0!==i.has(r)&&(i.add(n),i.add(r),!0)}var Nl=Object.freeze({__proto__:null,BoxGeometry:sn,BoxBufferGeometry:sn,CircleGeometry:ma,CircleBufferGeometry:ma,ConeGeometry:va,ConeBufferGeometry:va,CylinderGeometry:ga,CylinderBufferGeometry:ga,DodecahedronGeometry:_a,DodecahedronBufferGeometry:_a,EdgesGeometry:Sa,ExtrudeGeometry:bl,ExtrudeBufferGeometry:bl,IcosahedronGeometry:Sl,IcosahedronBufferGeometry:Sl,LatheGeometry:Tl,LatheBufferGeometry:Tl,OctahedronGeometry:Al,OctahedronBufferGeometry:Al,PlaneGeometry:Tn,PlaneBufferGeometry:Tn,PolyhedronGeometry:ya,PolyhedronBufferGeometry:ya,RingGeometry:El,RingBufferGeometry:El,ShapeGeometry:Cl,ShapeBufferGeometry:Cl,SphereGeometry:Ol,SphereBufferGeometry:Ol,TetrahedronGeometry:Pl,TetrahedronBufferGeometry:Pl,TorusGeometry:Il,TorusBufferGeometry:Il,TorusKnotGeometry:Dl,TorusKnotBufferGeometry:Dl,TubeGeometry:Ll,TubeBufferGeometry:Ll,WireframeGeometry:Rl});class Fl extends gi{constructor(t){super(),this.type="ShadowMaterial",this.color=new zt(0),this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this}}Fl.prototype.isShadowMaterial=!0;class Ul extends cn{constructor(t){super(t),this.type="RawShaderMaterial"}}Ul.prototype.isRawShaderMaterial=!0;class Gl extends gi{constructor(t){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new zt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new zt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}Gl.prototype.isMeshStandardMaterial=!0;class zl extends Gl{constructor(t){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ct(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Mt(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenColor=new zt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new zt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new zt(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}zl.prototype.isMeshPhysicalMaterial=!0;class kl extends gi{constructor(t){super(),this.type="MeshPhongMaterial",this.color=new zt(16777215),this.specular=new zt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new zt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}kl.prototype.isMeshPhongMaterial=!0;class jl extends gi{constructor(t){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new zt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new zt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}jl.prototype.isMeshToonMaterial=!0;class Hl extends gi{constructor(t){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}Hl.prototype.isMeshNormalMaterial=!0;class Vl extends gi{constructor(t){super(),this.type="MeshLambertMaterial",this.color=new zt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new zt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}Vl.prototype.isMeshLambertMaterial=!0;class Wl extends gi{constructor(t){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new zt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this}}Wl.prototype.isMeshMatcapMaterial=!0;class ql extends Jo{constructor(t){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}ql.prototype.isLineDashedMaterial=!0;const Jl={ShadowMaterial:Fl,SpriteMaterial:ho,RawShaderMaterial:Ul,ShaderMaterial:cn,PointsMaterial:ra,MeshPhysicalMaterial:zl,MeshStandardMaterial:Gl,MeshPhongMaterial:kl,MeshToonMaterial:jl,MeshNormalMaterial:Hl,MeshLambertMaterial:Vl,MeshDepthMaterial:Hs,MeshDistanceMaterial:Vs,MeshBasicMaterial:vi,MeshMatcapMaterial:Wl,LineDashedMaterial:ql,LineBasicMaterial:Jo,Material:gi};gi.fromType=function(t){return new Jl[t]};const Xl={arraySlice:function(t,e,i){return Xl.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==i?i:t.length)):t.slice(e,i)},convertArray:function(t,e,i){return!t||!i&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){const e=t.length,i=new Array(e);for(let t=0;t!==e;++t)i[t]=t;return i.sort((function(e,i){return t[e]-t[i]})),i},sortedArray:function(t,e,i){const n=t.length,r=new t.constructor(n);for(let s=0,o=0;o!==n;++s){const n=i[s]*e;for(let i=0;i!==e;++i)r[o++]=t[n+i]}return r},flattenJSON:function(t,e,i,n){let r=1,s=t[0];for(;void 0!==s&&void 0===s[n];)s=t[r++];if(void 0===s)return;let o=s[n];if(void 0!==o)if(Array.isArray(o))do{o=s[n],void 0!==o&&(e.push(s.time),i.push.apply(i,o)),s=t[r++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[n],void 0!==o&&(e.push(s.time),o.toArray(i,i.length)),s=t[r++]}while(void 0!==s);else do{o=s[n],void 0!==o&&(e.push(s.time),i.push(o)),s=t[r++]}while(void 0!==s)},subclip:function(t,e,i,n,r=30){const s=t.clone();s.name=e;const o=[];for(let t=0;t<s.tracks.length;++t){const e=s.tracks[t],a=e.getValueSize(),l=[],c=[];for(let t=0;t<e.times.length;++t){const s=e.times[t]*r;if(!(s<i||s>=n)){l.push(e.times[t]);for(let i=0;i<a;++i)c.push(e.values[t*a+i])}}0!==l.length&&(e.times=Xl.convertArray(l,e.times.constructor),e.values=Xl.convertArray(c,e.values.constructor),o.push(e))}s.tracks=o;let a=1/0;for(let t=0;t<s.tracks.length;++t)a>s.tracks[t].times[0]&&(a=s.tracks[t].times[0]);for(let t=0;t<s.tracks.length;++t)s.tracks[t].shift(-1*a);return s.resetDuration(),s},makeClipAdditive:function(t,e=0,i=t,n=30){n<=0&&(n=30);const r=i.tracks.length,s=e/n;for(let e=0;e<r;++e){const n=i.tracks[e],r=n.ValueTypeName;if("bool"===r||"string"===r)continue;const o=t.tracks.find((function(t){return t.name===n.name&&t.ValueTypeName===r}));if(void 0===o)continue;let a=0;const l=n.getValueSize();n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let c=0;const h=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=h/3);const u=n.times.length-1;let d;if(s<=n.times[0]){const t=a,e=l-a;d=Xl.arraySlice(n.values,t,e)}else if(s>=n.times[u]){const t=u*l+a,e=t+l-a;d=Xl.arraySlice(n.values,t,e)}else{const t=n.createInterpolant(),e=a,i=l-a;t.evaluate(s),d=Xl.arraySlice(t.resultBuffer,e,i)}if("quaternion"===r){(new te).fromArray(d).normalize().conjugate().toArray(d)}const p=o.times.length;for(let t=0;t<p;++t){const e=t*h+c;if("quaternion"===r)te.multiplyQuaternionsFlat(o.values,e,d,0,o.values,e);else{const t=h-2*c;for(let i=0;i<t;++i)o.values[e+i]-=d[i]}}}return t.blendMode=at,t}};class Yl{constructor(t,e,i,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let i=this._cachedIndex,n=e[i],r=e[i-1];t:{e:{let s;i:{n:if(!(t<n)){for(let s=i+2;;){if(void 0===n){if(t<r)break n;return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,t,r)}if(i===s)break;if(r=n,n=e[++i],t<n)break e}s=e.length;break i}if(t>=r)break t;{const o=e[1];t<o&&(i=2,r=o);for(let s=i-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(i===s)break;if(n=r,r=e[--i-1],t>=r)break e}s=i,i=0}}for(;i<s;){const n=i+s>>>1;t<e[n]?s=n:i=n+1}if(n=e[i],r=e[i-1],void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(void 0===n)return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,r,t)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,t,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=t*n;for(let t=0;t!==n;++t)e[t]=i[r+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}Yl.prototype.beforeStart_=Yl.prototype.copySampleValue_,Yl.prototype.afterEnd_=Yl.prototype.copySampleValue_;class Zl extends Yl{constructor(t,e,i,n){super(t,e,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:nt,endingEnd:nt}}intervalChanged_(t,e,i){const n=this.parameterPositions;let r=t-2,s=t+1,o=n[r],a=n[s];if(void 0===o)switch(this.getSettings_().endingStart){case rt:r=t,o=2*e-i;break;case st:r=n.length-2,o=e+n[r]-n[r+1];break;default:r=t,o=i}if(void 0===a)switch(this.getSettings_().endingEnd){case rt:s=t,a=2*i-e;break;case st:s=1,a=i+n[1]-n[0];break;default:s=t-1,a=e}const l=.5*(i-e),c=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(a-i),this._offsetPrev=r*c,this._offsetNext=s*c}interpolate_(t,e,i,n){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(i-e)/(n-e),f=p*p,m=f*p,g=-u*m+2*u*f-u*p,v=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,_=d*m-d*f;for(let t=0;t!==o;++t)r[t]=g*s[c+t]+v*s[l+t]+y*s[a+t]+_*s[h+t];return r}}class Kl extends Yl{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=(i-e)/(n-e),h=1-c;for(let t=0;t!==o;++t)r[t]=s[l+t]*h+s[a+t]*c;return r}}class Ql extends Yl{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t){return this.copySampleValue_(t-1)}}class $l{constructor(t,e,i,n){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Xl.convertArray(e,this.TimeBufferType),this.values=Xl.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:Xl.convertArray(t.times,Array),values:Xl.convertArray(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(i.interpolation=e)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new Ql(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Kl(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new Zl(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case tt:e=this.InterpolantFactoryMethodDiscrete;break;case et:e=this.InterpolantFactoryMethodLinear;break;case it:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return tt;case this.InterpolantFactoryMethodLinear:return et;case this.InterpolantFactoryMethodSmooth:return it}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]*=t}return this}trim(t,e){const i=this.times,n=i.length;let r=0,s=n-1;for(;r!==n&&i[r]<t;)++r;for(;-1!==s&&i[s]>e;)--s;if(++s,0!==r||s!==n){r>=s&&(s=Math.max(s,1),r=s-1);const t=this.getValueSize();this.times=Xl.arraySlice(i,r,s),this.values=Xl.arraySlice(this.values,r*t,s*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,n=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let e=0;e!==r;e++){const n=i[e];if("number"==typeof n&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,n),t=!1;break}if(null!==s&&s>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,n,s),t=!1;break}s=n}if(void 0!==n&&Xl.isTypedArray(n))for(let e=0,i=n.length;e!==i;++e){const i=n[e];if(isNaN(i)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,i),t=!1;break}}return t}optimize(){const t=Xl.arraySlice(this.times),e=Xl.arraySlice(this.values),i=this.getValueSize(),n=this.getInterpolation()===it,r=t.length-1;let s=1;for(let o=1;o<r;++o){let r=!1;const a=t[o];if(a!==t[o+1]&&(1!==o||a!==t[0]))if(n)r=!0;else{const t=o*i,n=t-i,s=t+i;for(let o=0;o!==i;++o){const i=e[t+o];if(i!==e[n+o]||i!==e[s+o]){r=!0;break}}}if(r){if(o!==s){t[s]=t[o];const n=o*i,r=s*i;for(let t=0;t!==i;++t)e[r+t]=e[n+t]}++s}}if(r>0){t[s]=t[r];for(let t=r*i,n=s*i,o=0;o!==i;++o)e[n+o]=e[t+o];++s}return s!==t.length?(this.times=Xl.arraySlice(t,0,s),this.values=Xl.arraySlice(e,0,s*i)):(this.times=t,this.values=e),this}clone(){const t=Xl.arraySlice(this.times,0),e=Xl.arraySlice(this.values,0),i=new(0,this.constructor)(this.name,t,e);return i.createInterpolant=this.createInterpolant,i}}$l.prototype.TimeBufferType=Float32Array,$l.prototype.ValueBufferType=Float32Array,$l.prototype.DefaultInterpolation=et;class tc extends $l{}tc.prototype.ValueTypeName="bool",tc.prototype.ValueBufferType=Array,tc.prototype.DefaultInterpolation=tt,tc.prototype.InterpolantFactoryMethodLinear=void 0,tc.prototype.InterpolantFactoryMethodSmooth=void 0;class ec extends $l{}ec.prototype.ValueTypeName="color";class ic extends $l{}ic.prototype.ValueTypeName="number";class nc extends Yl{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(i-e)/(n-e);let l=t*o;for(let t=l+o;l!==t;l+=4)te.slerpFlat(r,0,s,l-o,s,l,a);return r}}class rc extends $l{InterpolantFactoryMethodLinear(t){return new nc(this.times,this.values,this.getValueSize(),t)}}rc.prototype.ValueTypeName="quaternion",rc.prototype.DefaultInterpolation=et,rc.prototype.InterpolantFactoryMethodSmooth=void 0;class sc extends $l{}sc.prototype.ValueTypeName="string",sc.prototype.ValueBufferType=Array,sc.prototype.DefaultInterpolation=tt,sc.prototype.InterpolantFactoryMethodLinear=void 0,sc.prototype.InterpolantFactoryMethodSmooth=void 0;class oc extends $l{}oc.prototype.ValueTypeName="vector";class ac{constructor(t,e=-1,i,n=2500){this.name=t,this.tracks=i,this.duration=e,this.blendMode=n,this.uuid=xt(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],i=t.tracks,n=1/(t.fps||1);for(let t=0,r=i.length;t!==r;++t)e.push(lc(i[t]).scale(n));const r=new this(t.name,t.duration,e,t.blendMode);return r.uuid=t.uuid,r}static toJSON(t){const e=[],i=t.tracks,n={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,n=i.length;t!==n;++t)e.push($l.toJSON(i[t]));return n}static CreateFromMorphTargetSequence(t,e,i,n){const r=e.length,s=[];for(let t=0;t<r;t++){let o=[],a=[];o.push((t+r-1)%r,t,(t+1)%r),a.push(0,1,0);const l=Xl.getKeyframeOrder(o);o=Xl.sortedArray(o,1,l),a=Xl.sortedArray(a,1,l),n||0!==o[0]||(o.push(r),a.push(a[0])),s.push(new ic(".morphTargetInfluences["+e[t].name+"]",o,a).scale(1/i))}return new this(t,-1,s)}static findByName(t,e){let i=t;if(!Array.isArray(t)){const e=t;i=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<i.length;t++)if(i[t].name===e)return i[t];return null}static CreateClipsFromMorphTargetSequences(t,e,i){const n={},r=/^([\w-]*?)([\d]+)$/;for(let e=0,i=t.length;e<i;e++){const i=t[e],s=i.name.match(r);if(s&&s.length>1){const t=s[1];let e=n[t];e||(n[t]=e=[]),e.push(i)}}const s=[];for(const t in n)s.push(this.CreateFromMorphTargetSequence(t,n[t],e,i));return s}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(t,e,i,n,r){if(0!==i.length){const s=[],o=[];Xl.flattenJSON(i,s,o,n),0!==s.length&&r.push(new t(e,s,o))}},n=[],r=t.name||"default",s=t.fps||30,o=t.blendMode;let a=t.length||-1;const l=t.hierarchy||[];for(let t=0;t<l.length;t++){const r=l[t].keys;if(r&&0!==r.length)if(r[0].morphTargets){const t={};let e;for(e=0;e<r.length;e++)if(r[e].morphTargets)for(let i=0;i<r[e].morphTargets.length;i++)t[r[e].morphTargets[i]]=-1;for(const i in t){const t=[],s=[];for(let n=0;n!==r[e].morphTargets.length;++n){const n=r[e];t.push(n.time),s.push(n.morphTarget===i?1:0)}n.push(new ic(".morphTargetInfluence["+i+"]",t,s))}a=t.length*s}else{const s=".bones["+e[t].name+"]";i(oc,s+".position",r,"pos",n),i(rc,s+".quaternion",r,"rot",n),i(oc,s+".scale",r,"scl",n)}}if(0===n.length)return null;return new this(r,a,n,o)}resetDuration(){let t=0;for(let e=0,i=this.tracks.length;e!==i;++e){const i=this.tracks[e];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function lc(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ic;case"vector":case"vector2":case"vector3":case"vector4":return oc;case"color":return ec;case"quaternion":return rc;case"bool":case"boolean":return tc;case"string":return sc}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],i=[];Xl.flattenJSON(t.keys,e,i,"value"),t.times=e,t.values=i}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const cc={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class hc{constructor(t,e,i){const n=this;let r,s=!1,o=0,a=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(t){a++,!1===s&&void 0!==n.onStart&&n.onStart(t,o,a),s=!0},this.itemEnd=function(t){o++,void 0!==n.onProgress&&n.onProgress(t,o,a),o===a&&(s=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)},this.resolveURL=function(t){return r?r(t):t},this.setURLModifier=function(t){return r=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,i=l.length;e<i;e+=2){const i=l[e],n=l[e+1];if(i.global&&(i.lastIndex=0),i.test(t))return n}return null}}}const uc=new hc;class dc{constructor(t){this.manager=void 0!==t?t:uc,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise((function(n,r){i.load(t,n,e,r)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const pc={};class fc extends dc{constructor(t){super(t)}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=cc.get(t);if(void 0!==r)return this.manager.itemStart(t),setTimeout((()=>{e&&e(r),this.manager.itemEnd(t)}),0),r;if(void 0!==pc[t])return void pc[t].push({onLoad:e,onProgress:i,onError:n});pc[t]=[],pc[t].push({onLoad:e,onProgress:i,onError:n});const s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,a=this.responseType;fetch(s).then((e=>{if(200===e.status||0===e.status){if(e.status,"undefined"==typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;const i=pc[t],n=e.body.getReader(),r=e.headers.get("Content-Length"),s=r?parseInt(r):0,o=0!==s;let a=0;const l=new ReadableStream({start(t){!function e(){n.read().then((({done:n,value:r})=>{if(n)t.close();else{a+=r.byteLength;const n=new ProgressEvent("progress",{lengthComputable:o,loaded:a,total:s});for(let t=0,e=i.length;t<e;t++){const e=i[t];e.onProgress&&e.onProgress(n)}t.enqueue(r),e()}}))}()}});return new Response(l)}throw Error(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`)})).then((t=>{switch(a){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((t=>(new DOMParser).parseFromString(t,o)));case"json":return t.json();default:if(void 0===o)return t.text();{const e=/charset="?([^;"\s]*)"?/i.exec(o),i=e&&e[1]?e[1].toLowerCase():void 0,n=new TextDecoder(i);return t.arrayBuffer().then((t=>n.decode(t)))}}})).then((e=>{cc.add(t,e);const i=pc[t];delete pc[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onLoad&&n.onLoad(e)}})).catch((e=>{const i=pc[t];if(void 0===i)throw this.manager.itemError(t),e;delete pc[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onError&&n.onError(e)}this.manager.itemError(t)})).finally((()=>{this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class mc extends dc{constructor(t){super(t)}load(t,e,i,n){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=cc.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;const o=Lt("img");function a(){c(),cc.add(t,this),e&&e(this),r.manager.itemEnd(t)}function l(e){c(),n&&n(e),r.manager.itemError(t),r.manager.itemEnd(t)}function c(){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",a,!1),o.addEventListener("error",l,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(t),o.src=t,o}}class gc extends dc{constructor(t){super(t)}load(t,e,i,n){const r=new fn,s=new mc(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let o=0;function a(i){s.load(t[i],(function(t){r.images[i]=t,o++,6===o&&(r.needsUpdate=!0,e&&e(r))}),void 0,n)}for(let e=0;e<t.length;++e)a(e);return r}}class vc extends dc{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new Fo,o=new fc(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(r.withCredentials),o.load(t,(function(t){const i=r.parse(t);i&&(void 0!==i.image?s.image=i.image:void 0!==i.data&&(s.image.width=i.width,s.image.height=i.height,s.image.data=i.data),s.wrapS=void 0!==i.wrapS?i.wrapS:d,s.wrapT=void 0!==i.wrapT?i.wrapT:d,s.magFilter=void 0!==i.magFilter?i.magFilter:v,s.minFilter=void 0!==i.minFilter?i.minFilter:v,s.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.encoding&&(s.encoding=i.encoding),void 0!==i.flipY&&(s.flipY=i.flipY),void 0!==i.format&&(s.format=i.format),void 0!==i.type&&(s.type=i.type),void 0!==i.mipmaps&&(s.mipmaps=i.mipmaps,s.minFilter=_),1===i.mipmapCount&&(s.minFilter=v),void 0!==i.generateMipmaps&&(s.generateMipmaps=i.generateMipmaps),s.needsUpdate=!0,e&&e(s,i))}),i,n),s}}class yc extends dc{constructor(t){super(t)}load(t,e,i,n){const r=new qt,s=new mc(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(t){r.image=t,r.needsUpdate=!0,void 0!==e&&e(r)}),i,n),r}}class _c extends ni{constructor(t,e=1){super(),this.type="Light",this.color=new zt(t),this.intensity=e}dispose(){}copy(t){return super.copy(t),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}_c.prototype.isLight=!0;class xc extends _c{constructor(t,e,i){super(t,i),this.type="HemisphereLight",this.position.copy(ni.DefaultUp),this.updateMatrix(),this.groundColor=new zt(e)}copy(t){return _c.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}xc.prototype.isHemisphereLight=!0;const Mc=new De,bc=new ee,wc=new ee;class Sc{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ct(512,512),this.map=null,this.mapPass=null,this.matrix=new De,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new bn,this._frameExtents=new Ct(1,1),this._viewportCount=1,this._viewports=[new Jt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,i=this.matrix;bc.setFromMatrixPosition(t.matrixWorld),e.position.copy(bc),wc.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(wc),e.updateMatrixWorld(),Mc.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Mc),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(e.projectionMatrix),i.multiply(e.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class Tc extends Sc{constructor(){super(new un(50,1,.5,500)),this.focus=1}updateMatrices(t){const e=this.camera,i=2*_t*t.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;i===e.fov&&n===e.aspect&&r===e.far||(e.fov=i,e.aspect=n,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}Tc.prototype.isSpotLightShadow=!0;class Ac extends _c{constructor(t,e,i=0,n=Math.PI/3,r=0,s=1){super(t,e),this.type="SpotLight",this.position.copy(ni.DefaultUp),this.updateMatrix(),this.target=new ni,this.distance=i,this.angle=n,this.penumbra=r,this.decay=s,this.shadow=new Tc}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}Ac.prototype.isSpotLight=!0;const Ec=new De,Cc=new ee,Oc=new ee;class Pc extends Sc{constructor(){super(new un(90,1,.5,500)),this._frameExtents=new Ct(4,2),this._viewportCount=6,this._viewports=[new Jt(2,1,1,1),new Jt(0,1,1,1),new Jt(3,1,1,1),new Jt(1,1,1,1),new Jt(3,0,1,1),new Jt(1,0,1,1)],this._cubeDirections=[new ee(1,0,0),new ee(-1,0,0),new ee(0,0,1),new ee(0,0,-1),new ee(0,1,0),new ee(0,-1,0)],this._cubeUps=[new ee(0,1,0),new ee(0,1,0),new ee(0,1,0),new ee(0,1,0),new ee(0,0,1),new ee(0,0,-1)]}updateMatrices(t,e=0){const i=this.camera,n=this.matrix,r=t.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),Cc.setFromMatrixPosition(t.matrixWorld),i.position.copy(Cc),Oc.copy(i.position),Oc.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(Oc),i.updateMatrixWorld(),n.makeTranslation(-Cc.x,-Cc.y,-Cc.z),Ec.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ec)}}Pc.prototype.isPointLightShadow=!0;class Ic extends _c{constructor(t,e,i=0,n=1){super(t,e),this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new Pc}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}Ic.prototype.isPointLight=!0;class Dc extends Sc{constructor(){super(new Bn(-5,5,5,-5,.5,500))}}Dc.prototype.isDirectionalLightShadow=!0;class Lc extends _c{constructor(t,e){super(t,e),this.type="DirectionalLight",this.position.copy(ni.DefaultUp),this.updateMatrix(),this.target=new ni,this.shadow=new Dc}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}Lc.prototype.isDirectionalLight=!0;class Rc extends _c{constructor(t,e){super(t,e),this.type="AmbientLight"}}Rc.prototype.isAmbientLight=!0;class Bc extends _c{constructor(t,e,i=10,n=10){super(t,e),this.type="RectAreaLight",this.width=i,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}Bc.prototype.isRectAreaLight=!0;class Nc{constructor(){this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new ee)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const i=t.x,n=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.282095),e.addScaledVector(s[1],.488603*n),e.addScaledVector(s[2],.488603*r),e.addScaledVector(s[3],.488603*i),e.addScaledVector(s[4],i*n*1.092548),e.addScaledVector(s[5],n*r*1.092548),e.addScaledVector(s[6],.315392*(3*r*r-1)),e.addScaledVector(s[7],i*r*1.092548),e.addScaledVector(s[8],.546274*(i*i-n*n)),e}getIrradianceAt(t,e){const i=t.x,n=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.886227),e.addScaledVector(s[1],1.023328*n),e.addScaledVector(s[2],1.023328*r),e.addScaledVector(s[3],1.023328*i),e.addScaledVector(s[4],.858086*i*n),e.addScaledVector(s[5],.858086*n*r),e.addScaledVector(s[6],.743125*r*r-.247708),e.addScaledVector(s[7],.858086*i*r),e.addScaledVector(s[8],.429043*(i*i-n*n)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(t.coefficients[i],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let i=0;i<9;i++)this.coefficients[i].lerp(t.coefficients[i],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].fromArray(t,e+3*n);return this}toArray(t=[],e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].toArray(t,e+3*n);return t}static getBasisAt(t,e){const i=t.x,n=t.y,r=t.z;e[0]=.282095,e[1]=.488603*n,e[2]=.488603*r,e[3]=.488603*i,e[4]=1.092548*i*n,e[5]=1.092548*n*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*i*r,e[8]=.546274*(i*i-n*n)}}Nc.prototype.isSphericalHarmonics3=!0;class Fc extends _c{constructor(t=new Nc,e=1){super(void 0,e),this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}Fc.prototype.isLightProbe=!0;class Uc extends dc{constructor(t){super(t),this.textures={}}load(t,e,i,n){const r=this,s=new fc(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,(function(i){try{e(r.parse(JSON.parse(i)))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}}),i,n)}parse(t){const e=this.textures;function i(t){return e[t],e[t]}const n=gi.fromType(t.type);if(void 0!==t.uuid&&(n.uuid=t.uuid),void 0!==t.name&&(n.name=t.name),void 0!==t.color&&void 0!==n.color&&n.color.setHex(t.color),void 0!==t.roughness&&(n.roughness=t.roughness),void 0!==t.metalness&&(n.metalness=t.metalness),void 0!==t.sheen&&(n.sheen=t.sheen),void 0!==t.sheenColor&&(n.sheenColor=(new zt).setHex(t.sheenColor)),void 0!==t.sheenRoughness&&(n.sheenRoughness=t.sheenRoughness),void 0!==t.emissive&&void 0!==n.emissive&&n.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==n.specular&&n.specular.setHex(t.specular),void 0!==t.specularIntensity&&(n.specularIntensity=t.specularIntensity),void 0!==t.specularColor&&void 0!==n.specularColor&&n.specularColor.setHex(t.specularColor),void 0!==t.shininess&&(n.shininess=t.shininess),void 0!==t.clearcoat&&(n.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(n.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.transmission&&(n.transmission=t.transmission),void 0!==t.thickness&&(n.thickness=t.thickness),void 0!==t.attenuationDistance&&(n.attenuationDistance=t.attenuationDistance),void 0!==t.attenuationColor&&void 0!==n.attenuationColor&&n.attenuationColor.setHex(t.attenuationColor),void 0!==t.fog&&(n.fog=t.fog),void 0!==t.flatShading&&(n.flatShading=t.flatShading),void 0!==t.blending&&(n.blending=t.blending),void 0!==t.combine&&(n.combine=t.combine),void 0!==t.side&&(n.side=t.side),void 0!==t.shadowSide&&(n.shadowSide=t.shadowSide),void 0!==t.opacity&&(n.opacity=t.opacity),void 0!==t.transparent&&(n.transparent=t.transparent),void 0!==t.alphaTest&&(n.alphaTest=t.alphaTest),void 0!==t.depthTest&&(n.depthTest=t.depthTest),void 0!==t.depthWrite&&(n.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(n.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(n.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(n.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(n.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(n.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(n.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(n.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(n.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(n.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(n.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(n.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(n.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(n.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(n.rotation=t.rotation),1!==t.linewidth&&(n.linewidth=t.linewidth),void 0!==t.dashSize&&(n.dashSize=t.dashSize),void 0!==t.gapSize&&(n.gapSize=t.gapSize),void 0!==t.scale&&(n.scale=t.scale),void 0!==t.polygonOffset&&(n.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(n.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(n.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.dithering&&(n.dithering=t.dithering),void 0!==t.alphaToCoverage&&(n.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(n.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.toneMapped&&(n.toneMapped=t.toneMapped),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?n.vertexColors=t.vertexColors>0:n.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const e in t.uniforms){const r=t.uniforms[e];switch(n.uniforms[e]={},r.type){case"t":n.uniforms[e].value=i(r.value);break;case"c":n.uniforms[e].value=(new zt).setHex(r.value);break;case"v2":n.uniforms[e].value=(new Ct).fromArray(r.value);break;case"v3":n.uniforms[e].value=(new ee).fromArray(r.value);break;case"v4":n.uniforms[e].value=(new Jt).fromArray(r.value);break;case"m3":n.uniforms[e].value=(new Ot).fromArray(r.value);break;case"m4":n.uniforms[e].value=(new De).fromArray(r.value);break;default:n.uniforms[e].value=r.value}}if(void 0!==t.defines&&(n.defines=t.defines),void 0!==t.vertexShader&&(n.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(n.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(const e in t.extensions)n.extensions[e]=t.extensions[e];if(void 0!==t.shading&&(n.flatShading=1===t.shading),void 0!==t.size&&(n.size=t.size),void 0!==t.sizeAttenuation&&(n.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(n.map=i(t.map)),void 0!==t.matcap&&(n.matcap=i(t.matcap)),void 0!==t.alphaMap&&(n.alphaMap=i(t.alphaMap)),void 0!==t.bumpMap&&(n.bumpMap=i(t.bumpMap)),void 0!==t.bumpScale&&(n.bumpScale=t.bumpScale),void 0!==t.normalMap&&(n.normalMap=i(t.normalMap)),void 0!==t.normalMapType&&(n.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),n.normalScale=(new Ct).fromArray(e)}return void 0!==t.displacementMap&&(n.displacementMap=i(t.displacementMap)),void 0!==t.displacementScale&&(n.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(n.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(n.roughnessMap=i(t.roughnessMap)),void 0!==t.metalnessMap&&(n.metalnessMap=i(t.metalnessMap)),void 0!==t.emissiveMap&&(n.emissiveMap=i(t.emissiveMap)),void 0!==t.emissiveIntensity&&(n.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(n.specularMap=i(t.specularMap)),void 0!==t.specularIntensityMap&&(n.specularIntensityMap=i(t.specularIntensityMap)),void 0!==t.specularColorMap&&(n.specularColorMap=i(t.specularColorMap)),void 0!==t.envMap&&(n.envMap=i(t.envMap)),void 0!==t.envMapIntensity&&(n.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(n.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(n.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(n.lightMap=i(t.lightMap)),void 0!==t.lightMapIntensity&&(n.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(n.aoMap=i(t.aoMap)),void 0!==t.aoMapIntensity&&(n.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(n.gradientMap=i(t.gradientMap)),void 0!==t.clearcoatMap&&(n.clearcoatMap=i(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(n.clearcoatRoughnessMap=i(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(n.clearcoatNormalMap=i(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(n.clearcoatNormalScale=(new Ct).fromArray(t.clearcoatNormalScale)),void 0!==t.transmissionMap&&(n.transmissionMap=i(t.transmissionMap)),void 0!==t.thicknessMap&&(n.thicknessMap=i(t.thicknessMap)),void 0!==t.sheenColorMap&&(n.sheenColorMap=i(t.sheenColorMap)),void 0!==t.sheenRoughnessMap&&(n.sheenRoughnessMap=i(t.sheenRoughnessMap)),n}setTextures(t){return this.textures=t,this}}class Gc{static decodeText(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let i=0,n=t.length;i<n;i++)e+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(e))}catch(t){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1)}static resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class zc extends Ui{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const t=super.toJSON(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}zc.prototype.isInstancedBufferGeometry=!0;class kc extends dc{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new fc(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,(function(i){try{e(r.parse(JSON.parse(i)))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}}),i,n)}parse(t){const e={},i={};function n(t,n){if(void 0!==e[n])return e[n];const r=t.interleavedBuffers[n],s=function(t,e){if(void 0!==i[e])return i[e];const n=t.arrayBuffers[e],r=new Uint32Array(n).buffer;return i[e]=r,r}(t,r.buffer),o=Dt(r.type,s),a=new ao(o,r.stride);return a.uuid=r.uuid,e[n]=a,a}const r=t.isInstancedBufferGeometry?new zc:new Ui,s=t.data.index;if(void 0!==s){const t=Dt(s.type,s.array);r.setIndex(new xi(t,1))}const o=t.data.attributes;for(const e in o){const i=o[e];let s;if(i.isInterleavedBufferAttribute){const e=n(t.data,i.data);s=new co(e,i.itemSize,i.offset,i.normalized)}else{const t=Dt(i.type,i.array);s=new(i.isInstancedBufferAttribute?ko:xi)(t,i.itemSize,i.normalized)}void 0!==i.name&&(s.name=i.name),void 0!==i.usage&&s.setUsage(i.usage),void 0!==i.updateRange&&(s.updateRange.offset=i.updateRange.offset,s.updateRange.count=i.updateRange.count),r.setAttribute(e,s)}const a=t.data.morphAttributes;if(a)for(const e in a){const i=a[e],s=[];for(let e=0,r=i.length;e<r;e++){const r=i[e];let o;if(r.isInterleavedBufferAttribute){const e=n(t.data,r.data);o=new co(e,r.itemSize,r.offset,r.normalized)}else{const t=Dt(r.type,r.array);o=new xi(t,r.itemSize,r.normalized)}void 0!==r.name&&(o.name=r.name),s.push(o)}r.morphAttributes[e]=s}t.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const l=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==l)for(let t=0,e=l.length;t!==e;++t){const e=l[t];r.addGroup(e.start,e.count,e.materialIndex)}const c=t.data.boundingSphere;if(void 0!==c){const t=new ee;void 0!==c.center&&t.fromArray(c.center),r.boundingSphere=new we(t,c.radius)}return t.name&&(r.name=t.name),t.userData&&(r.userData=t.userData),r}}const jc={UVMapping:r,CubeReflectionMapping:s,CubeRefractionMapping:o,EquirectangularReflectionMapping:a,EquirectangularRefractionMapping:l,CubeUVReflectionMapping:c,CubeUVRefractionMapping:h},Hc={RepeatWrapping:u,ClampToEdgeWrapping:d,MirroredRepeatWrapping:p},Vc={NearestFilter:f,NearestMipmapNearestFilter:m,NearestMipmapLinearFilter:g,LinearFilter:v,LinearMipmapNearestFilter:y,LinearMipmapLinearFilter:_};class Wc extends dc{constructor(t){super(t),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=cc.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(t,o).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(i){cc.add(t,i),e&&e(i),r.manager.itemEnd(t)})).catch((function(e){n&&n(e),r.manager.itemError(t),r.manager.itemEnd(t)})),r.manager.itemStart(t)}}let qc;Wc.prototype.isImageBitmapLoader=!0;const Jc={getContext:function(){return void 0===qc&&(qc=new(window.AudioContext||window.webkitAudioContext)),qc},setContext:function(t){qc=t}};class Xc extends dc{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new fc(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(i){try{const t=i.slice(0);Jc.getContext().decodeAudioData(t,(function(t){e(t)}))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}}),i,n)}}class Yc extends Fc{constructor(t,e,i=1){super(void 0,i);const n=(new zt).set(t),r=(new zt).set(e),s=new ee(n.r,n.g,n.b),o=new ee(r.r,r.g,r.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(o).multiplyScalar(a),this.sh.coefficients[1].copy(s).sub(o).multiplyScalar(l)}}Yc.prototype.isHemisphereLightProbe=!0;class Zc extends Fc{constructor(t,e=1){super(void 0,e);const i=(new zt).set(t);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}Zc.prototype.isAmbientLightProbe=!0;const Kc=new De,Qc=new De,$c=new De;class th{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=eh(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=eh();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function eh(){return("undefined"==typeof performance?Date:performance).now()}const ih=new ee,nh=new te,rh=new ee,sh=new ee;class oh extends ni{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return;if(!1===this.hasPlaybackControl)return;this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1!==this.hasPlaybackControl&&this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const ah=new ee,lh=new te,ch=new ee,hh=new ee;class uh{constructor(t,e=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let i=0;i<e.length;i++)t+=e[i];return t/e.length}}class dh{constructor(t,e,i){let n,r,s;switch(this.binding=t,this.valueSize=i,e){case"quaternion":n=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const i=this.buffer,n=this.valueSize,r=t*n+n;let s=this.cumulativeWeight;if(0===s){for(let t=0;t!==n;++t)i[r+t]=i[t];s=e}else{s+=e;const t=e/s;this._mixBufferRegion(i,r,0,t,n)}this.cumulativeWeight=s}accumulateAdditive(t){const e=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,n,0,t,i),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,i=this.buffer,n=t*e+e,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const t=e*this._origIndex;this._mixBufferRegion(i,n,t,1-r,e)}s>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*e,1,e);for(let t=e,r=e+e;t!==r;++t)if(i[t]!==i[t+e]){o.setValue(i,n);break}}saveOriginalState(){const t=this.binding,e=this.buffer,i=this.valueSize,n=i*this._origIndex;t.getValue(e,n);for(let t=i,r=n;t!==r;++t)e[t]=e[n+t%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let i=t;i<e;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[e+i]=this.buffer[t+i]}_select(t,e,i,n,r){if(n>=.5)for(let n=0;n!==r;++n)t[e+n]=t[i+n]}_slerp(t,e,i,n){te.slerpFlat(t,e,t,e,t,i,n)}_slerpAdditive(t,e,i,n,r){const s=this._workIndex*r;te.multiplyQuaternionsFlat(t,s,t,e,t,i),te.slerpFlat(t,e,t,e,t,s,n)}_lerp(t,e,i,n,r){const s=1-n;for(let o=0;o!==r;++o){const r=e+o;t[r]=t[r]*s+t[i+o]*n}}_lerpAdditive(t,e,i,n,r){for(let s=0;s!==r;++s){const r=e+s;t[r]=t[r]+t[i+s]*n}}}const ph="\\[\\]\\.:\\/",fh=new RegExp("[\\[\\]\\.:\\/]","g"),mh="[^\\[\\]\\.:\\/]",gh="[^"+ph.replace("\\.","")+"]",vh=/((?:WC+[\/:])*)/.source.replace("WC",mh),yh=/(WCOD+)?/.source.replace("WCOD",gh),_h=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",mh),xh=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",mh),Mh=new RegExp("^"+vh+yh+_h+xh+"$"),bh=["material","materials","bones"];class wh{constructor(t,e,i){this.path=e,this.parsedPath=i||wh.parseTrackName(e),this.node=wh.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,i){return t&&t.isAnimationObjectGroup?new wh.Composite(t,e,i):new wh(t,e,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(fh,"")}static parseTrackName(t){const e=Mh.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){const t=i.nodeName.substring(n+1);-1!==bh.indexOf(t)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=t)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(e);if(void 0!==i)return i}if(t.children){const i=function(t){for(let n=0;n<t.length;n++){const r=t[n];if(r.name===e||r.uuid===e)return r;const s=i(r.children);if(s)return s}return null},n=i(t.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)t[e++]=i[n]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,i=e.objectName,n=e.propertyName;let r=e.propertyIndex;if(t||(t=wh.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let n=e.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===n){n=e;break}break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==n){if(void 0===t[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[n]}}const s=t[n];if(void 0===s){const i=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+n+" but it wasn't found.",t)}let o=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}wh.Composite=class{constructor(t,e,i){const n=i||wh.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}getValue(t,e){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(t,e)}setValue(t,e){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}},wh.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},wh.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},wh.prototype.GetterByBindingType=[wh.prototype._getValue_direct,wh.prototype._getValue_array,wh.prototype._getValue_arrayElement,wh.prototype._getValue_toArray],wh.prototype.SetterByBindingTypeAndVersioning=[[wh.prototype._setValue_direct,wh.prototype._setValue_direct_setNeedsUpdate,wh.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[wh.prototype._setValue_array,wh.prototype._setValue_array_setNeedsUpdate,wh.prototype._setValue_array_setMatrixWorldNeedsUpdate],[wh.prototype._setValue_arrayElement,wh.prototype._setValue_arrayElement_setNeedsUpdate,wh.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[wh.prototype._setValue_fromArray,wh.prototype._setValue_fromArray_setNeedsUpdate,wh.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Sh{constructor(){this.uuid=xt(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let e=0,i=arguments.length;e!==i;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const t=this._objects,e=this._indicesByUUID,i=this._paths,n=this._parsedPaths,r=this._bindings,s=r.length;let o,a=t.length,l=this.nCachedObjects_;for(let c=0,h=arguments.length;c!==h;++c){const h=arguments[c],u=h.uuid;let d=e[u];if(void 0===d){d=a++,e[u]=d,t.push(h);for(let t=0,e=s;t!==e;++t)r[t].push(new wh(h,i[t],n[t]))}else if(d<l){o=t[d];const a=--l,c=t[a];e[c.uuid]=d,t[d]=c,e[u]=a,t[a]=h;for(let t=0,e=s;t!==e;++t){const e=r[t],s=e[a];let o=e[d];e[d]=s,void 0===o&&(o=new wh(h,i[t],n[t])),e[a]=o}}else t[d]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const t=this._objects,e=this._indicesByUUID,i=this._bindings,n=i.length;let r=this.nCachedObjects_;for(let s=0,o=arguments.length;s!==o;++s){const o=arguments[s],a=o.uuid,l=e[a];if(void 0!==l&&l>=r){const s=r++,c=t[s];e[c.uuid]=l,t[l]=c,e[a]=s,t[s]=o;for(let t=0,e=n;t!==e;++t){const e=i[t],n=e[s],r=e[l];e[l]=n,e[s]=r}}}this.nCachedObjects_=r}uncache(){const t=this._objects,e=this._indicesByUUID,i=this._bindings,n=i.length;let r=this.nCachedObjects_,s=t.length;for(let o=0,a=arguments.length;o!==a;++o){const a=arguments[o].uuid,l=e[a];if(void 0!==l)if(delete e[a],l<r){const o=--r,a=t[o],c=--s,h=t[c];e[a.uuid]=l,t[l]=a,e[h.uuid]=o,t[o]=h,t.pop();for(let t=0,e=n;t!==e;++t){const e=i[t],n=e[o],r=e[c];e[l]=n,e[o]=r,e.pop()}}else{const r=--s,o=t[r];r>0&&(e[o.uuid]=l),t[l]=o,t.pop();for(let t=0,e=n;t!==e;++t){const e=i[t];e[l]=e[r],e.pop()}}}this.nCachedObjects_=r}subscribe_(t,e){const i=this._bindingsIndicesByPath;let n=i[t];const r=this._bindings;if(void 0!==n)return r[n];const s=this._paths,o=this._parsedPaths,a=this._objects,l=a.length,c=this.nCachedObjects_,h=new Array(l);n=r.length,i[t]=n,s.push(t),o.push(e),r.push(h);for(let i=c,n=a.length;i!==n;++i){const n=a[i];h[i]=new wh(n,t,e)}return h}unsubscribe_(t){const e=this._bindingsIndicesByPath,i=e[t];if(void 0!==i){const n=this._paths,r=this._parsedPaths,s=this._bindings,o=s.length-1,a=s[o];e[t[o]]=i,s[i]=a,s.pop(),r[i]=r[o],r.pop(),n[i]=n[o],n.pop()}}}Sh.prototype.isAnimationObjectGroup=!0;class Th{constructor(t,e,i=null,n=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=i,this.blendMode=n;const r=e.tracks,s=r.length,o=new Array(s),a={endingStart:nt,endingEnd:nt};for(let t=0;t!==s;++t){const e=r[t].createInterpolant(null);o[t]=e,e.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){const i=this._clip.duration,n=t._clip.duration,r=n/i,s=i/n;t.warp(1,r,e),this.warp(s,1,e)}return this}crossFadeTo(t,e,i){return t.crossFadeFrom(this,e,i)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,i){const n=this._mixer,r=n.time,s=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=r,a[1]=r+i,l[0]=t/s,l[1]=e/s,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,i,n){if(!this.enabled)return void this._updateWeight(t);const r=this._startTime;if(null!==r){const n=(t-r)*i;if(n<0||0===i)return;this._startTime=null,e=i*n}e*=this._updateTimeScale(t);const s=this._updateTime(e),o=this._updateWeight(t);if(o>0){const t=this._interpolants,e=this._propertyBindings;if(this.blendMode===at)for(let i=0,n=t.length;i!==n;++i)t[i].evaluate(s),e[i].accumulateAdditive(o);else for(let i=0,r=t.length;i!==r;++i)t[i].evaluate(s),e[i].accumulate(n,o)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const i=this._weightInterpolant;if(null!==i){const n=i.evaluate(t)[0];e*=n,t>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const i=this._timeScaleInterpolant;if(null!==i){e*=i.evaluate(t)[0],t>i.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,i=this.loop;let n=this.time+t,r=this._loopCount;const s=2202===i;if(0===t)return-1===r?n:s&&1==(1&r)?e-n:n;if(2200===i){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(n>=e)n=e;else{if(!(n<0)){this.time=n;break t}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),n>=e||n<0){const i=Math.floor(n/e);n-=e*i,r+=Math.abs(i);const o=this.repetitions-r;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=t>0?e:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===o){const e=t<0;this._setEndings(e,!e,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=n;if(s&&1==(1&r))return e-n}return n}_setEndings(t,e,i){const n=this._interpolantSettings;i?(n.endingStart=rt,n.endingEnd=rt):(n.endingStart=t?this.zeroSlopeAtStart?rt:nt:st,n.endingEnd=e?this.zeroSlopeAtEnd?rt:nt:st)}_scheduleFading(t,e,i){const n=this._mixer,r=n.time;let s=this._weightInterpolant;null===s&&(s=n._lendControlInterpolant(),this._weightInterpolant=s);const o=s.parameterPositions,a=s.sampleValues;return o[0]=r,a[0]=e,o[1]=r+t,a[1]=i,this}}class Ah extends mt{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const i=t._localRoot||this._root,n=t._clip.tracks,r=n.length,s=t._propertyBindings,o=t._interpolants,a=i.uuid,l=this._bindingsByRootAndName;let c=l[a];void 0===c&&(c={},l[a]=c);for(let t=0;t!==r;++t){const r=n[t],l=r.name;let h=c[l];if(void 0!==h)++h.referenceCount,s[t]=h;else{if(h=s[t],void 0!==h){null===h._cacheIndex&&(++h.referenceCount,this._addInactiveBinding(h,a,l));continue}const n=e&&e._propertyBindings[t].binding.parsedPath;h=new dh(wh.create(i,l,n),r.ValueTypeName,r.getValueSize()),++h.referenceCount,this._addInactiveBinding(h,a,l),s[t]=h}o[t].resultBuffer=h.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,i=t._clip.uuid,n=this._actionsByClip[i];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,i,e)}const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,i){const n=this._actions,r=this._actionsByClip;let s=r[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=s;else{const e=s.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=n.length,n.push(t),s.actionByRoot[i]=t}_removeInactiveAction(t){const e=this._actions,i=e[e.length-1],n=t._cacheIndex;i._cacheIndex=n,e[n]=i,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,s=this._actionsByClip,o=s[r],a=o.knownActions,l=a[a.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),t._byClipCacheIndex=null;delete o.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete s[r],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.referenceCount&&this._removeInactiveBinding(i)}}_lendAction(t){const e=this._actions,i=t._cacheIndex,n=this._nActiveActions++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_takeBackAction(t){const e=this._actions,i=t._cacheIndex,n=--this._nActiveActions,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_addInactiveBinding(t,e,i){const n=this._bindingsByRootAndName,r=this._bindings;let s=n[e];void 0===s&&(s={},n[e]=s),s[i]=t,t._cacheIndex=r.length,r.push(t)}_removeInactiveBinding(t){const e=this._bindings,i=t.binding,n=i.rootNode.uuid,r=i.path,s=this._bindingsByRootAndName,o=s[n],a=e[e.length-1],l=t._cacheIndex;a._cacheIndex=l,e[l]=a,e.pop(),delete o[r],0===Object.keys(o).length&&delete s[n]}_lendBinding(t){const e=this._bindings,i=t._cacheIndex,n=this._nActiveBindings++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_takeBackBinding(t){const e=this._bindings,i=t._cacheIndex,n=--this._nActiveBindings,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let i=t[e];return void 0===i&&(i=new Kl(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=e,t[e]=i),i}_takeBackControlInterpolant(t){const e=this._controlInterpolants,i=t.__cacheIndex,n=--this._nActiveControlInterpolants,r=e[n];t.__cacheIndex=n,e[n]=t,r.__cacheIndex=i,e[i]=r}clipAction(t,e,i){const n=e||this._root,r=n.uuid;let s="string"==typeof t?ac.findByName(n,t):t;const o=null!==s?s.uuid:t,a=this._actionsByClip[o];let l=null;if(void 0===i&&(i=null!==s?s.blendMode:ot),void 0!==a){const t=a.actionByRoot[r];if(void 0!==t&&t.blendMode===i)return t;l=a.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const c=new Th(this,s,e,i);return this._bindAction(c,l),this._addInactiveAction(c,o,r),c}existingAction(t,e){const i=e||this._root,n=i.uuid,r="string"==typeof t?ac.findByName(i,t):t,s=r?r.uuid:t,o=this._actionsByClip[s];return void 0!==o&&o.actionByRoot[n]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,i=this._nActiveActions,n=this.time+=t,r=Math.sign(t),s=this._accuIndex^=1;for(let o=0;o!==i;++o){e[o]._update(n,t,r,s)}const o=this._bindings,a=this._nActiveBindings;for(let t=0;t!==a;++t)o[t].apply(s);return this}setTime(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,i=t.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){const t=r.knownActions;for(let i=0,n=t.length;i!==n;++i){const n=t[i];this._deactivateAction(n);const r=n._cacheIndex,s=e[e.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,s._cacheIndex=r,e[r]=s,e.pop(),this._removeInactiveBindingsForAction(n)}delete n[i]}}uncacheRoot(t){const e=t.uuid,i=this._actionsByClip;for(const t in i){const n=i[t].actionByRoot[e];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}const n=this._bindingsByRootAndName[e];if(void 0!==n)for(const t in n){const e=n[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(t,e){const i=this.existingAction(t,e);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}Ah.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class Eh{constructor(t){"string"==typeof t&&(t=arguments[1]),this.value=t}clone(){return new Eh(void 0===this.value.clone?this.value:this.value.clone())}}class Ch extends ao{constructor(t,e,i=1){super(t,e),this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}Ch.prototype.isInstancedInterleavedBuffer=!0;class Oh{constructor(t,e,i,n,r){this.buffer=t,this.type=e,this.itemSize=i,this.elementSize=n,this.count=r,this.version=0}set needsUpdate(t){!0===t&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,e){return this.type=t,this.elementSize=e,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}}Oh.prototype.isGLBufferAttribute=!0;function Ph(t,e){return t.distance-e.distance}function Ih(t,e,i,n){if(t.layers.test(e.layers)&&t.raycast(e,i),!0===n){const n=t.children;for(let t=0,r=n.length;t<r;t++)Ih(n[t],e,i,!0)}}const Dh=new Ct;class Lh{constructor(t=new Ct(1/0,1/0),e=new Ct(-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=Dh.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Dh.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}Lh.prototype.isBox2=!0;const Rh=new ee,Bh=new ee;class Nh{constructor(t=new ee,e=new ee){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){Rh.subVectors(t,this.start),Bh.subVectors(this.end,this.start);const i=Bh.dot(Bh);let n=Bh.dot(Rh)/i;return e&&(n=Mt(n,0,1)),n}closestPointToPoint(t,e,i){const n=this.closestPointToPointParameter(t,e);return this.delta(i).multiplyScalar(n).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const Fh=new ee;const Uh=new ee,Gh=new De,zh=new De;class kh extends ia{constructor(t){const e=jh(t),i=new Ui,n=[],r=[],s=new zt(0,0,1),o=new zt(0,1,0);for(let t=0;t<e.length;t++){const i=e[t];i.parent&&i.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),r.push(s.r,s.g,s.b),r.push(o.r,o.g,o.b))}i.setAttribute("position",new Oi(n,3)),i.setAttribute("color",new Oi(r,3));super(i,new Jo({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,i=this.geometry,n=i.getAttribute("position");zh.copy(this.root.matrixWorld).invert();for(let t=0,i=0;t<e.length;t++){const r=e[t];r.parent&&r.parent.isBone&&(Gh.multiplyMatrices(zh,r.matrixWorld),Uh.setFromMatrixPosition(Gh),n.setXYZ(i,Uh.x,Uh.y,Uh.z),Gh.multiplyMatrices(zh,r.parent.matrixWorld),Uh.setFromMatrixPosition(Gh),n.setXYZ(i+1,Uh.x,Uh.y,Uh.z),i+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}function jh(t){const e=[];!0===t.isBone&&e.push(t);for(let i=0;i<t.children.length;i++)e.push.apply(e,jh(t.children[i]));return e}const Hh=new ee,Vh=new zt,Wh=new zt;class qh extends ia{constructor(t=10,e=10,i=4473924,n=8947848){i=new zt(i),n=new zt(n);const r=e/2,s=t/e,o=t/2,a=[],l=[];for(let t=0,c=0,h=-o;t<=e;t++,h+=s){a.push(-o,0,h,o,0,h),a.push(h,0,-o,h,0,o);const e=t===r?i:n;e.toArray(l,c),c+=3,e.toArray(l,c),c+=3,e.toArray(l,c),c+=3,e.toArray(l,c),c+=3}const c=new Ui;c.setAttribute("position",new Oi(a,3)),c.setAttribute("color",new Oi(l,3));super(c,new Jo({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}const Jh=new ee,Xh=new ee,Yh=new ee;const Zh=new ee,Kh=new hn;function Qh(t,e,i,n,r,s,o){Zh.set(r,s,o).unproject(n);const a=e[t];if(void 0!==a){const t=i.getAttribute("position");for(let e=0,i=a.length;e<i;e++)t.setXYZ(a[e],Zh.x,Zh.y,Zh.z)}}const $h=new re;class tu extends ia{constructor(t,e=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),r=new Ui;r.setIndex(new xi(i,1)),r.setAttribute("position",new xi(n,3)),super(r,new Jo({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(void 0!==this.object&&$h.setFromObject(this.object),$h.isEmpty())return;const e=$h.min,i=$h.max,n=this.geometry.attributes.position,r=n.array;r[0]=i.x,r[1]=i.y,r[2]=i.z,r[3]=e.x,r[4]=i.y,r[5]=i.z,r[6]=e.x,r[7]=e.y,r[8]=i.z,r[9]=i.x,r[10]=e.y,r[11]=i.z,r[12]=i.x,r[13]=i.y,r[14]=e.z,r[15]=e.x,r[16]=i.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=i.x,r[22]=e.y,r[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t){return ia.prototype.copy.call(this,t),this.object=t.object,this}}const eu=new ee;let iu,nu;class ru extends ia{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=new Ui;i.setAttribute("position",new Oi(e,3)),i.setAttribute("color",new Oi([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(i,new Jo({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(t,e,i){const n=new zt,r=this.geometry.attributes.color.array;return n.set(t),n.toArray(r,0),n.toArray(r,3),n.set(e),n.toArray(r,6),n.toArray(r,9),n.set(i),n.toArray(r,12),n.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}const su=new Float32Array(1),ou=new Int32Array(su.buffer);Ta.create=function(t,e){return t.prototype=Object.create(Ta.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},qa.prototype.fromPoints=function(t){return this.setFromPoints(t)},qh.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},kh.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},dc.prototype.extractUrlBase=function(t){return Gc.extractUrlBase(t)},dc.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Lh.prototype.center=function(t){return this.getCenter(t)},Lh.prototype.empty=function(){return this.isEmpty()},Lh.prototype.isIntersectionBox=function(t){return this.intersectsBox(t)},Lh.prototype.size=function(t){return this.getSize(t)},re.prototype.center=function(t){return this.getCenter(t)},re.prototype.empty=function(){return this.isEmpty()},re.prototype.isIntersectionBox=function(t){return this.intersectsBox(t)},re.prototype.isIntersectionSphere=function(t){return this.intersectsSphere(t)},re.prototype.size=function(t){return this.getSize(t)},je.prototype.toVector3=function(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")},we.prototype.empty=function(){return this.isEmpty()},bn.prototype.setFromMatrix=function(t){return this.setFromProjectionMatrix(t)},Nh.prototype.center=function(t){return this.getCenter(t)},Ot.prototype.flattenToArrayOffset=function(t,e){return this.toArray(t,e)},Ot.prototype.multiplyVector3=function(t){return t.applyMatrix3(this)},Ot.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Ot.prototype.applyToBufferAttribute=function(t){return t.applyMatrix3(this)},Ot.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Ot.prototype.getInverse=function(t){return this.copy(t).invert()},De.prototype.extractPosition=function(t){return this.copyPosition(t)},De.prototype.flattenToArrayOffset=function(t,e){return this.toArray(t,e)},De.prototype.getPosition=function(){return(new ee).setFromMatrixColumn(this,3)},De.prototype.setRotationFromQuaternion=function(t){return this.makeRotationFromQuaternion(t)},De.prototype.multiplyToArray=function(){},De.prototype.multiplyVector3=function(t){return t.applyMatrix4(this)},De.prototype.multiplyVector4=function(t){return t.applyMatrix4(this)},De.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},De.prototype.rotateAxis=function(t){t.transformDirection(this)},De.prototype.crossVector=function(t){return t.applyMatrix4(this)},De.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},De.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},De.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},De.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},De.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},De.prototype.applyToBufferAttribute=function(t){return t.applyMatrix4(this)},De.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},De.prototype.makeFrustum=function(t,e,i,n,r,s){return this.makePerspective(t,e,n,i,r,s)},De.prototype.getInverse=function(t){return this.copy(t).invert()},_n.prototype.isIntersectionLine=function(t){return this.intersectsLine(t)},te.prototype.multiplyVector3=function(t){return t.applyQuaternion(this)},te.prototype.inverse=function(){return this.invert()},Ie.prototype.isIntersectionBox=function(t){return this.intersectsBox(t)},Ie.prototype.isIntersectionPlane=function(t){return this.intersectsPlane(t)},Ie.prototype.isIntersectionSphere=function(t){return this.intersectsSphere(t)},fi.prototype.area=function(){return this.getArea()},fi.prototype.barycoordFromPoint=function(t,e){return this.getBarycoord(t,e)},fi.prototype.midpoint=function(t){return this.getMidpoint(t)},fi.prototypenormal=function(t){return this.getNormal(t)},fi.prototype.plane=function(t){return this.getPlane(t)},fi.barycoordFromPoint=function(t,e,i,n,r){return fi.getBarycoord(t,e,i,n,r)},fi.normal=function(t,e,i,n){return fi.getNormal(t,e,i,n)},Ja.prototype.extractAllPoints=function(t){return this.extractPoints(t)},Ja.prototype.extrude=function(t){return new bl(this,t)},Ja.prototype.makeGeometry=function(t){return new Cl(this,t)},Ct.prototype.fromAttribute=function(t,e,i){return this.fromBufferAttribute(t,e,i)},Ct.prototype.distanceToManhattan=function(t){return this.manhattanDistanceTo(t)},Ct.prototype.lengthManhattan=function(){return this.manhattanLength()},ee.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},ee.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},ee.prototype.getPositionFromMatrix=function(t){return this.setFromMatrixPosition(t)},ee.prototype.getScaleFromMatrix=function(t){return this.setFromMatrixScale(t)},ee.prototype.getColumnFromMatrix=function(t,e){return this.setFromMatrixColumn(e,t)},ee.prototype.applyProjection=function(t){return this.applyMatrix4(t)},ee.prototype.fromAttribute=function(t,e,i){return this.fromBufferAttribute(t,e,i)},ee.prototype.distanceToManhattan=function(t){return this.manhattanDistanceTo(t)},ee.prototype.lengthManhattan=function(){return this.manhattanLength()},Jt.prototype.fromAttribute=function(t,e,i){return this.fromBufferAttribute(t,e,i)},Jt.prototype.lengthManhattan=function(){return this.manhattanLength()},ni.prototype.getChildByName=function(t){return this.getObjectByName(t)},ni.prototype.renderDepth=function(){},ni.prototype.translate=function(t,e){return this.translateOnAxis(e,t)},ni.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},ni.prototype.applyMatrix=function(t){return this.applyMatrix4(t)},Object.defineProperties(ni.prototype,{eulerOrder:{get:function(){return this.rotation.order},set:function(t){this.rotation.order=t}},useQuaternion:{get:function(){},set:function(){}}}),nn.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(nn.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Bo.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},un.prototype.setLens=function(t,e){void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(_c.prototype,{onlyShadow:{set:function(){}},shadowCameraFov:{set:function(t){this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){}},shadowBias:{set:function(t){this.shadow.bias=t}},shadowDarkness:{set:function(){}},shadowMapWidth:{set:function(t){this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){this.shadow.mapSize.height=t}}}),Object.defineProperties(xi.prototype,{length:{get:function(){return this.array.length}},dynamic:{get:function(){return this.usage===dt},set:function(){this.setUsage(dt)}}}),xi.prototype.setDynamic=function(t){return this.setUsage(!0===t?dt:ut),this},xi.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},xi.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Ui.prototype.addIndex=function(t){this.setIndex(t)},Ui.prototype.addAttribute=function(t,e){return e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(this.setIndex(e),this):this.setAttribute(t,e):this.setAttribute(t,new xi(arguments[1],arguments[2]))},Ui.prototype.addDrawCall=function(t,e,i){this.addGroup(t,e)},Ui.prototype.clearDrawCalls=function(){this.clearGroups()},Ui.prototype.computeOffsets=function(){},Ui.prototype.removeAttribute=function(t){return this.deleteAttribute(t)},Ui.prototype.applyMatrix=function(t){return this.applyMatrix4(t)},Object.defineProperties(Ui.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return this.groups}}}),ao.prototype.setDynamic=function(t){return this.setUsage(!0===t?dt:ut),this},ao.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},bl.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},bl.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},bl.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},oo.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Eh.prototype.onUpdate=function(){return this},Object.defineProperties(gi.prototype,{wrapAround:{get:function(){},set:function(){}},overdraw:{get:function(){},set:function(){}},wrapRGB:{get:function(){return new zt}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){this.type,this.flatShading=1===t}},stencilMask:{get:function(){return this.type,this.stencilFuncMask},set:function(t){this.type,this.stencilFuncMask=t}},vertexTangents:{get:function(){this.type},set:function(){this.type}}}),Object.defineProperties(cn.prototype,{derivatives:{get:function(){return this.extensions.derivatives},set:function(t){this.extensions.derivatives=t}}}),io.prototype.clearTarget=function(t,e,i,n){this.setRenderTarget(t),this.clear(e,i,n)},io.prototype.animate=function(t){this.setAnimationLoop(t)},io.prototype.getCurrentRenderTarget=function(){return this.getRenderTarget()},io.prototype.getMaxAnisotropy=function(){return this.capabilities.getMaxAnisotropy()},io.prototype.getPrecision=function(){return this.capabilities.precision},io.prototype.resetGLState=function(){return this.state.reset()},io.prototype.supportsFloatTextures=function(){return this.extensions.get("OES_texture_float")},io.prototype.supportsHalfFloatTextures=function(){return this.extensions.get("OES_texture_half_float")},io.prototype.supportsStandardDerivatives=function(){return this.extensions.get("OES_standard_derivatives")},io.prototype.supportsCompressedTextureS3TC=function(){return this.extensions.get("WEBGL_compressed_texture_s3tc")},io.prototype.supportsCompressedTexturePVRTC=function(){return this.extensions.get("WEBGL_compressed_texture_pvrtc")},io.prototype.supportsBlendMinMax=function(){return this.extensions.get("EXT_blend_minmax")},io.prototype.supportsVertexTextures=function(){return this.capabilities.vertexTextures},io.prototype.supportsInstancedArrays=function(){return this.extensions.get("ANGLE_instanced_arrays")},io.prototype.enableScissorTest=function(t){this.setScissorTest(t)},io.prototype.initMaterial=function(){},io.prototype.addPrePlugin=function(){},io.prototype.addPostPlugin=function(){},io.prototype.updateShadowMap=function(){},io.prototype.setFaceCulling=function(){},io.prototype.allocTextureUnit=function(){},io.prototype.setTexture=function(){},io.prototype.setTexture2D=function(){},io.prototype.setTextureCube=function(){},io.prototype.getActiveMipMapLevel=function(){return this.getActiveMipmapLevel()},Object.defineProperties(io.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){this.shadowMap.type=t}},shadowMapCullFace:{get:function(){},set:function(){}},context:{get:function(){return this.getContext()}},vr:{get:function(){return this.xr}},gammaInput:{get:function(){return!1},set:function(){}},gammaOutput:{get:function(){return!1},set:function(t){this.outputEncoding=!0===t?ct:lt}},toneMappingWhitePoint:{get:function(){return 1},set:function(){}},gammaFactor:{get:function(){return 2},set:function(){}}}),Object.defineProperties(Ws.prototype,{cullFace:{get:function(){},set:function(){}},renderReverseSided:{get:function(){},set:function(){}},renderSingleSided:{get:function(){},set:function(){}}}),Object.defineProperties(Xt.prototype,{wrapS:{get:function(){return this.texture.wrapS},set:function(t){this.texture.wrapS=t}},wrapT:{get:function(){return this.texture.wrapT},set:function(t){this.texture.wrapT=t}},magFilter:{get:function(){return this.texture.magFilter},set:function(t){this.texture.magFilter=t}},minFilter:{get:function(){return this.texture.minFilter},set:function(t){this.texture.minFilter=t}},anisotropy:{get:function(){return this.texture.anisotropy},set:function(t){this.texture.anisotropy=t}},offset:{get:function(){return this.texture.offset},set:function(t){this.texture.offset=t}},repeat:{get:function(){return this.texture.repeat},set:function(t){this.texture.repeat=t}},format:{get:function(){return this.texture.format},set:function(t){this.texture.format=t}},type:{get:function(){return this.texture.type},set:function(t){this.texture.type=t}},generateMipmaps:{get:function(){return this.texture.generateMipmaps},set:function(t){this.texture.generateMipmaps=t}}}),oh.prototype.load=function(t){const e=this;return(new Xc).load(t,(function(t){e.setBuffer(t)})),this},uh.prototype.getData=function(){return this.getFrequencyData()},pn.prototype.updateCubeMap=function(t,e){return this.update(t,e)},pn.prototype.clear=function(t,e,i,n){return this.renderTarget.clear(t,e,i,n)},jt.crossOrigin=void 0,jt.loadTexture=function(t,e,i,n){const r=new yc;r.setCrossOrigin(this.crossOrigin);const s=r.load(t,i,void 0,n);return e&&(s.mapping=e),s},jt.loadTextureCube=function(t,e,i,n){const r=new gc;r.setCrossOrigin(this.crossOrigin);const s=r.load(t,i,void 0,n);return e&&(s.mapping=e),s},jt.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},jt.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const au={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:i}})),"undefined"!=typeof window&&(window.__THREE__||(window.__THREE__=i)),e.ACESFilmicToneMapping=4,e.AddEquation=n,e.AddOperation=2,e.AdditiveAnimationBlendMode=at,e.AdditiveBlending=2,e.AlphaFormat=1021,e.AlwaysDepth=1,e.AlwaysStencilFunc=519,e.AmbientLight=Rc,e.AmbientLightProbe=Zc,e.AnimationClip=ac,e.AnimationLoader=class extends dc{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new fc(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(i){try{e(r.parse(JSON.parse(i)))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}}),i,n)}parse(t){const e=[];for(let i=0;i<t.length;i++){const n=ac.parse(t[i]);e.push(n)}return e}},e.AnimationMixer=Ah,e.AnimationObjectGroup=Sh,e.AnimationUtils=Xl,e.ArcCurve=Ea,e.ArrayCamera=Ys,e.ArrowHelper=class extends ni{constructor(t=new ee(0,0,1),e=new ee(0,0,0),i=1,n=16776960,r=.2*i,s=.2*r){super(),this.type="ArrowHelper",void 0===iu&&(iu=new Ui,iu.setAttribute("position",new Oi([0,0,0,0,1,0],3)),nu=new ga(0,.5,1,5,1),nu.translate(0,-.5,0)),this.position.copy(e),this.line=new $o(iu,new Jo({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new nn(nu,new vi({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(i,r,s)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{eu.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(eu,e)}}setLength(t,e=.2*t,i=.2*e){this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(i,e,i),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}},e.Audio=oh,e.AudioAnalyser=uh,e.AudioContext=Jc,e.AudioListener=class extends ni{constructor(){super(),this.type="AudioListener",this.context=Jc.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new th}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(ih,nh,rh),sh.set(0,0,-1).applyQuaternion(nh),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(ih.x,t),e.positionY.linearRampToValueAtTime(ih.y,t),e.positionZ.linearRampToValueAtTime(ih.z,t),e.forwardX.linearRampToValueAtTime(sh.x,t),e.forwardY.linearRampToValueAtTime(sh.y,t),e.forwardZ.linearRampToValueAtTime(sh.z,t),e.upX.linearRampToValueAtTime(i.x,t),e.upY.linearRampToValueAtTime(i.y,t),e.upZ.linearRampToValueAtTime(i.z,t)}else e.setPosition(ih.x,ih.y,ih.z),e.setOrientation(sh.x,sh.y,sh.z,i.x,i.y,i.z)}},e.AudioLoader=Xc,e.AxesHelper=ru,e.AxisHelper=function(t){return new ru(t)},e.BackSide=1,e.BasicDepthPacking=3200,e.BasicShadowMap=0,e.BinaryTextureLoader=function(t){return new vc(t)},e.Bone=No,e.BooleanKeyframeTrack=tc,e.BoundingBoxHelper=function(t,e){return new tu(t,e)},e.Box2=Lh,e.Box3=re,e.Box3Helper=class extends ia{constructor(t,e=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Ui;n.setIndex(new xi(i,1)),n.setAttribute("position",new Oi([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(n,new Jo({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}},e.BoxBufferGeometry=sn,e.BoxGeometry=sn,e.BoxHelper=tu,e.BufferAttribute=xi,e.BufferGeometry=Ui,e.BufferGeometryLoader=kc,e.ByteType=1010,e.Cache=cc,e.Camera=hn,e.CameraHelper=class extends ia{constructor(t){const e=new Ui,i=new Jo({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],r=[],s={},o=new zt(16755200),a=new zt(16711680),l=new zt(43775),c=new zt(16777215),h=new zt(3355443);function u(t,e,i){d(t,i),d(e,i)}function d(t,e){n.push(0,0,0),r.push(e.r,e.g,e.b),void 0===s[t]&&(s[t]=[]),s[t].push(n.length/3-1)}u("n1","n2",o),u("n2","n4",o),u("n4","n3",o),u("n3","n1",o),u("f1","f2",o),u("f2","f4",o),u("f4","f3",o),u("f3","f1",o),u("n1","f1",o),u("n2","f2",o),u("n3","f3",o),u("n4","f4",o),u("p","n1",a),u("p","n2",a),u("p","n3",a),u("p","n4",a),u("u1","u2",l),u("u2","u3",l),u("u3","u1",l),u("c","t",c),u("p","c",h),u("cn1","cn2",h),u("cn3","cn4",h),u("cf1","cf2",h),u("cf3","cf4",h),e.setAttribute("position",new Oi(n,3)),e.setAttribute("color",new Oi(r,3)),super(e,i),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){const t=this.geometry,e=this.pointMap;Kh.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Qh("c",e,t,Kh,0,0,-1),Qh("t",e,t,Kh,0,0,1),Qh("n1",e,t,Kh,-1,-1,-1),Qh("n2",e,t,Kh,1,-1,-1),Qh("n3",e,t,Kh,-1,1,-1),Qh("n4",e,t,Kh,1,1,-1),Qh("f1",e,t,Kh,-1,-1,1),Qh("f2",e,t,Kh,1,-1,1),Qh("f3",e,t,Kh,-1,1,1),Qh("f4",e,t,Kh,1,1,1),Qh("u1",e,t,Kh,.7,1.1,-1),Qh("u2",e,t,Kh,-.7,1.1,-1),Qh("u3",e,t,Kh,0,2,-1),Qh("cf1",e,t,Kh,-1,0,1),Qh("cf2",e,t,Kh,1,0,1),Qh("cf3",e,t,Kh,0,-1,1),Qh("cf4",e,t,Kh,0,1,1),Qh("cn1",e,t,Kh,-1,0,-1),Qh("cn2",e,t,Kh,1,0,-1),Qh("cn3",e,t,Kh,0,-1,-1),Qh("cn4",e,t,Kh,0,1,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},e.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},e.CanvasTexture=fa,e.CatmullRomCurve3=La,e.CineonToneMapping=3,e.CircleBufferGeometry=ma,e.CircleGeometry=ma,e.ClampToEdgeWrapping=d,e.Clock=th,e.Color=zt,e.ColorKeyframeTrack=ec,e.CompressedTexture=pa,e.CompressedTextureLoader=class extends dc{constructor(t){super(t)}load(t,e,i,n){const r=this,s=[],o=new pa,a=new fc(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(r.withCredentials);let l=0;function c(c){a.load(t[c],(function(t){const i=r.parse(t,!0);s[c]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},l+=1,6===l&&(1===i.mipmapCount&&(o.minFilter=v),o.image=s,o.format=i.format,o.needsUpdate=!0,e&&e(o))}),i,n)}if(Array.isArray(t))for(let e=0,i=t.length;e<i;++e)c(e);else a.load(t,(function(t){const i=r.parse(t,!0);if(i.isCubemap){const t=i.mipmaps.length/i.mipmapCount;for(let e=0;e<t;e++){s[e]={mipmaps:[]};for(let t=0;t<i.mipmapCount;t++)s[e].mipmaps.push(i.mipmaps[e*i.mipmapCount+t]),s[e].format=i.format,s[e].width=i.width,s[e].height=i.height}o.image=s}else o.image.width=i.width,o.image.height=i.height,o.mipmaps=i.mipmaps;1===i.mipmapCount&&(o.minFilter=v),o.format=i.format,o.needsUpdate=!0,e&&e(o)}),i,n);return o}},e.ConeBufferGeometry=va,e.ConeGeometry=va,e.CubeCamera=pn,e.CubeReflectionMapping=s,e.CubeRefractionMapping=o,e.CubeTexture=fn,e.CubeTextureLoader=gc,e.CubeUVReflectionMapping=c,e.CubeUVRefractionMapping=h,e.CubicBezierCurve=Fa,e.CubicBezierCurve3=Ua,e.CubicInterpolant=Zl,e.CullFaceBack=1,e.CullFaceFront=2,e.CullFaceFrontBack=3,e.CullFaceNone=0,e.Curve=Ta,e.CurvePath=Wa,e.CustomBlending=5,e.CustomToneMapping=5,e.CylinderBufferGeometry=ga,e.CylinderGeometry=ga,e.Cylindrical=class{constructor(t=1,e=0,i=0){return this.radius=t,this.theta=e,this.y=i,this}set(t,e,i){return this.radius=t,this.theta=e,this.y=i,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+i*i),this.theta=Math.atan2(t,i),this.y=e,this}clone(){return(new this.constructor).copy(this)}},e.Data3DTexture=Kt,e.DataArrayTexture=Yt,e.DataTexture=Fo,e.DataTexture2DArray=function(t,e,i,n){return new Yt(t,e,i,n)},e.DataTexture3D=function(t,e,i,n){return new Kt(t,e,i,n)},e.DataTextureLoader=vc,e.DataUtils=class{static toHalfFloat(t){t>65504&&(t=65504),su[0]=t;const e=ou[0];let i=e>>16&32768,n=e>>12&2047;const r=e>>23&255;return r<103?i:r>142?(i|=31744,i|=(255==r?0:1)&&8388607&e,i):r<113?(n|=2048,i|=(n>>114-r)+(n>>113-r&1),i):(i|=r-112<<10|n>>1,i+=1&n,i)}},e.DecrementStencilOp=7683,e.DecrementWrapStencilOp=34056,e.DefaultLoadingManager=uc,e.DepthFormat=E,e.DepthStencilFormat=C,e.DepthTexture=$s,e.DirectionalLight=Lc,e.DirectionalLightHelper=class extends ni{constructor(t,e,i){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===e&&(e=1);let n=new Ui;n.setAttribute("position",new Oi([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const r=new Jo({fog:!1,toneMapped:!1});this.lightPlane=new $o(n,r),this.add(this.lightPlane),n=new Ui,n.setAttribute("position",new Oi([0,0,0,0,0,1],3)),this.targetLine=new $o(n,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){Jh.setFromMatrixPosition(this.light.matrixWorld),Xh.setFromMatrixPosition(this.light.target.matrixWorld),Yh.subVectors(Xh,Jh),this.lightPlane.lookAt(Xh),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Xh),this.targetLine.scale.z=Yh.length()}},e.DiscreteInterpolant=Ql,e.DodecahedronBufferGeometry=_a,e.DodecahedronGeometry=_a,e.DoubleSide=2,e.DstAlphaFactor=206,e.DstColorFactor=208,e.DynamicBufferAttribute=function(t,e){return new xi(t,e).setUsage(dt)},e.DynamicCopyUsage=35050,e.DynamicDrawUsage=dt,e.DynamicReadUsage=35049,e.EdgesGeometry=Sa,e.EdgesHelper=function(t,e){return new ia(new Sa(t.geometry),new Jo({color:void 0!==e?e:16777215}))},e.EllipseCurve=Aa,e.EqualDepth=4,e.EqualStencilFunc=514,e.EquirectangularReflectionMapping=a,e.EquirectangularRefractionMapping=l,e.Euler=je,e.EventDispatcher=mt,e.ExtrudeBufferGeometry=bl,e.ExtrudeGeometry=bl,e.FaceColors=1,e.FileLoader=fc,e.FlatShading=1,e.Float16BufferAttribute=Ci,e.Float32Attribute=function(t,e){return new Oi(t,e)},e.Float32BufferAttribute=Oi,e.Float64Attribute=function(t,e){return new Pi(t,e)},e.Float64BufferAttribute=Pi,e.FloatType=w,e.Fog=so,e.FogExp2=ro,e.Font=function(){console.error("THREE.Font has been moved to /examples/jsm/loaders/FontLoader.js")},e.FontLoader=function(){console.error("THREE.FontLoader has been moved to /examples/jsm/loaders/FontLoader.js")},e.FramebufferTexture=da,e.FrontSide=0,e.Frustum=bn,e.GLBufferAttribute=Oh,e.GLSL1="100",e.GLSL3=pt,e.GreaterDepth=6,e.GreaterEqualDepth=5,e.GreaterEqualStencilFunc=518,e.GreaterStencilFunc=516,e.GridHelper=qh,e.Group=Zs,e.HalfFloatType=S,e.HemisphereLight=xc,e.HemisphereLightHelper=class extends ni{constructor(t,e,i){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;const n=new Al(e);n.rotateY(.5*Math.PI),this.material=new vi({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=n.getAttribute("position"),s=new Float32Array(3*r.count);n.setAttribute("color",new xi(s,3)),this.add(new nn(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");Vh.copy(this.light.color),Wh.copy(this.light.groundColor);for(let t=0,i=e.count;t<i;t++){const n=t<i/2?Vh:Wh;e.setXYZ(t,n.r,n.g,n.b)}e.needsUpdate=!0}t.lookAt(Hh.setFromMatrixPosition(this.light.matrixWorld).negate())}},e.HemisphereLightProbe=Yc,e.IcosahedronBufferGeometry=Sl,e.IcosahedronGeometry=Sl,e.ImageBitmapLoader=Wc,e.ImageLoader=mc,e.ImageUtils=jt,e.ImmediateRenderObject=function(){console.error("THREE.ImmediateRenderObject has been removed.")},e.IncrementStencilOp=7682,e.IncrementWrapStencilOp=34055,e.InstancedBufferAttribute=ko,e.InstancedBufferGeometry=zc,e.InstancedInterleavedBuffer=Ch,e.InstancedMesh=qo,e.Int16Attribute=function(t,e){return new Si(t,e)},e.Int16BufferAttribute=Si,e.Int32Attribute=function(t,e){return new Ai(t,e)},e.Int32BufferAttribute=Ai,e.Int8Attribute=function(t,e){return new Mi(t,e)},e.Int8BufferAttribute=Mi,e.IntType=1013,e.InterleavedBuffer=ao,e.InterleavedBufferAttribute=co,e.Interpolant=Yl,e.InterpolateDiscrete=tt,e.InterpolateLinear=et,e.InterpolateSmooth=it,e.InvertStencilOp=5386,e.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},e.KeepStencilOp=ht,e.KeyframeTrack=$l,e.LOD=Oo,e.LatheBufferGeometry=Tl,e.LatheGeometry=Tl,e.Layers=He,e.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},e.LessDepth=2,e.LessEqualDepth=3,e.LessEqualStencilFunc=515,e.LessStencilFunc=513,e.Light=_c,e.LightProbe=Fc,e.Line=$o,e.Line3=Nh,e.LineBasicMaterial=Jo,e.LineCurve=Ga,e.LineCurve3=za,e.LineDashedMaterial=ql,e.LineLoop=na,e.LinePieces=1,e.LineSegments=ia,e.LineStrip=0,e.LinearEncoding=lt,e.LinearFilter=v,e.LinearInterpolant=Kl,e.LinearMipMapLinearFilter=1008,e.LinearMipMapNearestFilter=1007,e.LinearMipmapLinearFilter=_,e.LinearMipmapNearestFilter=y,e.LinearToneMapping=1,e.Loader=dc,e.LoaderUtils=Gc,e.LoadingManager=hc,e.LoopOnce=2200,e.LoopPingPong=2202,e.LoopRepeat=2201,e.LuminanceAlphaFormat=1025,e.LuminanceFormat=1024,e.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},e.Material=gi,e.MaterialLoader=Uc,e.Math=Et,e.MathUtils=Et,e.Matrix3=Ot,e.Matrix4=De,e.MaxEquation=104,e.Mesh=nn,e.MeshBasicMaterial=vi,e.MeshDepthMaterial=Hs,e.MeshDistanceMaterial=Vs,e.MeshFaceMaterial=function(t){return t},e.MeshLambertMaterial=Vl,e.MeshMatcapMaterial=Wl,e.MeshNormalMaterial=Hl,e.MeshPhongMaterial=kl,e.MeshPhysicalMaterial=zl,e.MeshStandardMaterial=Gl,e.MeshToonMaterial=jl,e.MinEquation=103,e.MirroredRepeatWrapping=p,e.MixOperation=1,e.MultiMaterial=function(t=[]){return t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t},e.MultiplyBlending=4,e.MultiplyOperation=0,e.NearestFilter=f,e.NearestMipMapLinearFilter=1005,e.NearestMipMapNearestFilter=1004,e.NearestMipmapLinearFilter=g,e.NearestMipmapNearestFilter=m,e.NeverDepth=0,e.NeverStencilFunc=512,e.NoBlending=0,e.NoColors=0,e.NoToneMapping=0,e.NormalAnimationBlendMode=ot,e.NormalBlending=1,e.NotEqualDepth=7,e.NotEqualStencilFunc=517,e.NumberKeyframeTrack=ic,e.Object3D=ni,e.ObjectLoader=class extends dc{constructor(t){super(t)}load(t,e,i,n){const r=this,s=""===this.path?Gc.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||s;const o=new fc(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(i){let s=null;try{s=JSON.parse(i)}catch(e){return void 0!==n&&n(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}const o=s.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?r.parse(s,e):console.error("THREE.ObjectLoader: Can't load "+t)}),i,n)}async loadAsync(t,e){const i=""===this.path?Gc.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||i;const n=new fc(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials);const r=await n.loadAsync(t,e),s=JSON.parse(r),o=s.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+t);return await this.parseAsync(s)}parse(t,e){const i=this.parseAnimations(t.animations),n=this.parseShapes(t.shapes),r=this.parseGeometries(t.geometries,n),s=this.parseImages(t.images,(function(){void 0!==e&&e(l)})),o=this.parseTextures(t.textures,s),a=this.parseMaterials(t.materials,o),l=this.parseObject(t.object,r,a,o,i),c=this.parseSkeletons(t.skeletons,l);if(this.bindSkeletons(l,c),void 0!==e){let t=!1;for(const e in s)if(s[e]instanceof HTMLImageElement){t=!0;break}!1===t&&e(l)}return l}async parseAsync(t){const e=this.parseAnimations(t.animations),i=this.parseShapes(t.shapes),n=this.parseGeometries(t.geometries,i),r=await this.parseImagesAsync(t.images),s=this.parseTextures(t.textures,r),o=this.parseMaterials(t.materials,s),a=this.parseObject(t.object,n,o,s,e),l=this.parseSkeletons(t.skeletons,a);return this.bindSkeletons(a,l),a}parseShapes(t){const e={};if(void 0!==t)for(let i=0,n=t.length;i<n;i++){const n=(new Ja).fromJSON(t[i]);e[n.uuid]=n}return e}parseSkeletons(t,e){const i={},n={};if(e.traverse((function(t){t.isBone&&(n[t.uuid]=t)})),void 0!==t)for(let e=0,r=t.length;e<r;e++){const r=(new zo).fromJSON(t[e],n);i[r.uuid]=r}return i}parseGeometries(t,e){const i={};if(void 0!==t){const n=new kc;for(let r=0,s=t.length;r<s;r++){let s;const o=t[r];switch(o.type){case"BufferGeometry":case"InstancedBufferGeometry":s=n.parse(o);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:o.type in Nl?s=Nl[o.type].fromJSON(o,e):o.type}s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),!0===s.isBufferGeometry&&void 0!==o.userData&&(s.userData=o.userData),i[o.uuid]=s}}return i}parseMaterials(t,e){const i={},n={};if(void 0!==t){const r=new Uc;r.setTextures(e);for(let e=0,s=t.length;e<s;e++){const s=t[e];if("MultiMaterial"===s.type){const t=[];for(let e=0;e<s.materials.length;e++){const n=s.materials[e];void 0===i[n.uuid]&&(i[n.uuid]=r.parse(n)),t.push(i[n.uuid])}n[s.uuid]=t}else void 0===i[s.uuid]&&(i[s.uuid]=r.parse(s)),n[s.uuid]=i[s.uuid]}}return n}parseAnimations(t){const e={};if(void 0!==t)for(let i=0;i<t.length;i++){const n=t[i],r=ac.parse(n);e[r.uuid]=r}return e}parseImages(t,e){const i=this,n={};let r;function s(t){if("string"==typeof t){const e=t;return function(t){return i.manager.itemStart(t),r.load(t,(function(){i.manager.itemEnd(t)}),void 0,(function(){i.manager.itemError(t),i.manager.itemEnd(t)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:i.resourcePath+e)}return t.data?{data:Dt(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){const i=new hc(e);r=new mc(i),r.setCrossOrigin(this.crossOrigin);for(let e=0,i=t.length;e<i;e++){const i=t[e],r=i.url;if(Array.isArray(r)){const t=[];for(let e=0,i=r.length;e<i;e++){const i=s(r[e]);null!==i&&(i instanceof HTMLImageElement?t.push(i):t.push(new Fo(i.data,i.width,i.height)))}n[i.uuid]=new Ht(t)}else{const t=s(i.url);n[i.uuid]=new Ht(t)}}}return n}async parseImagesAsync(t){const e=this,i={};let n;async function r(t){if("string"==typeof t){const i=t,r=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(i)?i:e.resourcePath+i;return await n.loadAsync(r)}return t.data?{data:Dt(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){n=new mc(this.manager),n.setCrossOrigin(this.crossOrigin);for(let e=0,n=t.length;e<n;e++){const n=t[e],s=n.url;if(Array.isArray(s)){const t=[];for(let e=0,i=s.length;e<i;e++){const i=s[e],n=await r(i);null!==n&&(n instanceof HTMLImageElement?t.push(n):t.push(new Fo(n.data,n.width,n.height)))}i[n.uuid]=new Ht(t)}else{const t=await r(n.url);i[n.uuid]=new Ht(t)}}}return i}parseTextures(t,e){function i(t,e){return"number"==typeof t?t:e[t]}const n={};if(void 0!==t)for(let r=0,s=t.length;r<s;r++){const s=t[r];void 0===s.image&&s.uuid,void 0===e[s.image]&&s.image;const o=e[s.image],a=o.data;let l;Array.isArray(a)?(l=new fn,6===a.length&&(l.needsUpdate=!0)):(l=a&&a.data?new Fo:new qt,a&&(l.needsUpdate=!0)),l.source=o,l.uuid=s.uuid,void 0!==s.name&&(l.name=s.name),void 0!==s.mapping&&(l.mapping=i(s.mapping,jc)),void 0!==s.offset&&l.offset.fromArray(s.offset),void 0!==s.repeat&&l.repeat.fromArray(s.repeat),void 0!==s.center&&l.center.fromArray(s.center),void 0!==s.rotation&&(l.rotation=s.rotation),void 0!==s.wrap&&(l.wrapS=i(s.wrap[0],Hc),l.wrapT=i(s.wrap[1],Hc)),void 0!==s.format&&(l.format=s.format),void 0!==s.type&&(l.type=s.type),void 0!==s.encoding&&(l.encoding=s.encoding),void 0!==s.minFilter&&(l.minFilter=i(s.minFilter,Vc)),void 0!==s.magFilter&&(l.magFilter=i(s.magFilter,Vc)),void 0!==s.anisotropy&&(l.anisotropy=s.anisotropy),void 0!==s.flipY&&(l.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(l.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(l.unpackAlignment=s.unpackAlignment),void 0!==s.userData&&(l.userData=s.userData),n[s.uuid]=l}return n}parseObject(t,e,i,n,r){let s,o,a;function l(t){return e[t],e[t]}function c(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];i[r],e.push(i[r])}return e}return i[t],i[t]}}function h(t){return n[t],n[t]}switch(t.type){case"Scene":s=new oo,void 0!==t.background&&(Number.isInteger(t.background)?s.background=new zt(t.background):s.background=h(t.background)),void 0!==t.environment&&(s.environment=h(t.environment)),void 0!==t.fog&&("Fog"===t.fog.type?s.fog=new so(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(s.fog=new ro(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":s=new un(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(s.focus=t.focus),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.filmGauge&&(s.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(s.filmOffset=t.filmOffset),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"OrthographicCamera":s=new Bn(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"AmbientLight":s=new Rc(t.color,t.intensity);break;case"DirectionalLight":s=new Lc(t.color,t.intensity);break;case"PointLight":s=new Ic(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":s=new Bc(t.color,t.intensity,t.width,t.height);break;case"SpotLight":s=new Ac(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":s=new xc(t.color,t.groundColor,t.intensity);break;case"LightProbe":s=(new Fc).fromJSON(t);break;case"SkinnedMesh":o=l(t.geometry),a=c(t.material),s=new Bo(o,a),void 0!==t.bindMode&&(s.bindMode=t.bindMode),void 0!==t.bindMatrix&&s.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(s.skeleton=t.skeleton);break;case"Mesh":o=l(t.geometry),a=c(t.material),s=new nn(o,a);break;case"InstancedMesh":o=l(t.geometry),a=c(t.material);const e=t.count,i=t.instanceMatrix,n=t.instanceColor;s=new qo(o,a,e),s.instanceMatrix=new ko(new Float32Array(i.array),16),void 0!==n&&(s.instanceColor=new ko(new Float32Array(n.array),n.itemSize));break;case"LOD":s=new Oo;break;case"Line":s=new $o(l(t.geometry),c(t.material));break;case"LineLoop":s=new na(l(t.geometry),c(t.material));break;case"LineSegments":s=new ia(l(t.geometry),c(t.material));break;case"PointCloud":case"Points":s=new ca(l(t.geometry),c(t.material));break;case"Sprite":s=new To(c(t.material));break;case"Group":s=new Zs;break;case"Bone":s=new No;break;default:s=new ni}if(s.uuid=t.uuid,void 0!==t.name&&(s.name=t.name),void 0!==t.matrix?(s.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(s.matrixAutoUpdate=t.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(void 0!==t.position&&s.position.fromArray(t.position),void 0!==t.rotation&&s.rotation.fromArray(t.rotation),void 0!==t.quaternion&&s.quaternion.fromArray(t.quaternion),void 0!==t.scale&&s.scale.fromArray(t.scale)),void 0!==t.castShadow&&(s.castShadow=t.castShadow),void 0!==t.receiveShadow&&(s.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(s.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(s.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(s.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&s.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(s.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(s.visible=t.visible),void 0!==t.frustumCulled&&(s.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(s.renderOrder=t.renderOrder),void 0!==t.userData&&(s.userData=t.userData),void 0!==t.layers&&(s.layers.mask=t.layers),void 0!==t.children){const o=t.children;for(let t=0;t<o.length;t++)s.add(this.parseObject(o[t],e,i,n,r))}if(void 0!==t.animations){const e=t.animations;for(let t=0;t<e.length;t++){const i=e[t];s.animations.push(r[i])}}if("LOD"===t.type){void 0!==t.autoUpdate&&(s.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const i=e[t],n=s.getObjectByProperty("uuid",i.object);void 0!==n&&s.addLevel(n,i.distance)}}return s}bindSkeletons(t,e){0!==Object.keys(e).length&&t.traverse((function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){const i=e[t.skeleton];void 0===i?t.skeleton:t.bind(i,t.bindMatrix)}}))}setTexturePath(t){return this.setResourcePath(t)}},e.ObjectSpaceNormalMap=1,e.OctahedronBufferGeometry=Al,e.OctahedronGeometry=Al,e.OneFactor=201,e.OneMinusDstAlphaFactor=207,e.OneMinusDstColorFactor=209,e.OneMinusSrcAlphaFactor=205,e.OneMinusSrcColorFactor=203,e.OrthographicCamera=Bn,e.PCFShadowMap=1,e.PCFSoftShadowMap=2,e.PMREMGenerator=Vn,e.ParametricGeometry=function(){return console.error("THREE.ParametricGeometry has been moved to /examples/jsm/geometries/ParametricGeometry.js"),new Ui},e.Particle=function(t){return new To(t)},e.ParticleBasicMaterial=function(t){return new ra(t)},e.ParticleSystem=function(t,e){return new ca(t,e)},e.ParticleSystemMaterial=function(t){return new ra(t)},e.Path=qa,e.PerspectiveCamera=un,e.Plane=_n,e.PlaneBufferGeometry=Tn,e.PlaneGeometry=Tn,e.PlaneHelper=class extends $o{constructor(t,e=1,i=16776960){const n=i,r=new Ui;r.setAttribute("position",new Oi([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),r.computeBoundingSphere(),super(r,new Jo({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=e;const s=new Ui;s.setAttribute("position",new Oi([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),s.computeBoundingSphere(),this.add(new nn(s,new vi({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){let e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?1:0,this.lookAt(this.plane.normal),super.updateMatrixWorld(t)}},e.PointCloud=function(t,e){return new ca(t,e)},e.PointCloudMaterial=function(t){return new ra(t)},e.PointLight=Ic,e.PointLightHelper=class extends nn{constructor(t,e,i){super(new Ol(e,4,2),new vi({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.light.updateMatrixWorld(),this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},e.Points=ca,e.PointsMaterial=ra,e.PolarGridHelper=class extends ia{constructor(t=10,e=16,i=8,n=64,r=4473924,s=8947848){r=new zt(r),s=new zt(s);const o=[],a=[];for(let i=0;i<=e;i++){const n=i/e*(2*Math.PI),l=Math.sin(n)*t,c=Math.cos(n)*t;o.push(0,0,0),o.push(l,0,c);const h=1&i?r:s;a.push(h.r,h.g,h.b),a.push(h.r,h.g,h.b)}for(let e=0;e<=i;e++){const l=1&e?r:s,c=t-t/i*e;for(let t=0;t<n;t++){let e=t/n*(2*Math.PI),i=Math.sin(e)*c,r=Math.cos(e)*c;o.push(i,0,r),a.push(l.r,l.g,l.b),e=(t+1)/n*(2*Math.PI),i=Math.sin(e)*c,r=Math.cos(e)*c,o.push(i,0,r),a.push(l.r,l.g,l.b)}}const l=new Ui;l.setAttribute("position",new Oi(o,3)),l.setAttribute("color",new Oi(a,3));super(l,new Jo({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}},e.PolyhedronBufferGeometry=ya,e.PolyhedronGeometry=ya,e.PositionalAudio=class extends oh{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,i){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=i,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(ah,lh,ch),hh.set(0,0,1).applyQuaternion(lh);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(ah.x,t),e.positionY.linearRampToValueAtTime(ah.y,t),e.positionZ.linearRampToValueAtTime(ah.z,t),e.orientationX.linearRampToValueAtTime(hh.x,t),e.orientationY.linearRampToValueAtTime(hh.y,t),e.orientationZ.linearRampToValueAtTime(hh.z,t)}else e.setPosition(ah.x,ah.y,ah.z),e.setOrientation(hh.x,hh.y,hh.z)}},e.PropertyBinding=wh,e.PropertyMixer=dh,e.QuadraticBezierCurve=ka,e.QuadraticBezierCurve3=ja,e.Quaternion=te,e.QuaternionKeyframeTrack=rc,e.QuaternionLinearInterpolant=nc,e.REVISION=i,e.RGBADepthPacking=3201,e.RGBAFormat=A,e.RGBAIntegerFormat=1033,e.RGBA_ASTC_10x10_Format=Z,e.RGBA_ASTC_10x5_Format=J,e.RGBA_ASTC_10x6_Format=X,e.RGBA_ASTC_10x8_Format=Y,e.RGBA_ASTC_12x10_Format=K,e.RGBA_ASTC_12x12_Format=Q,e.RGBA_ASTC_4x4_Format=G,e.RGBA_ASTC_5x4_Format=z,e.RGBA_ASTC_5x5_Format=k,e.RGBA_ASTC_6x5_Format=j,e.RGBA_ASTC_6x6_Format=H,e.RGBA_ASTC_8x5_Format=V,e.RGBA_ASTC_8x6_Format=W,e.RGBA_ASTC_8x8_Format=q,e.RGBA_BPTC_Format=$,e.RGBA_ETC2_EAC_Format=U,e.RGBA_PVRTC_2BPPV1_Format=N,e.RGBA_PVRTC_4BPPV1_Format=B,e.RGBA_S3TC_DXT1_Format=P,e.RGBA_S3TC_DXT3_Format=I,e.RGBA_S3TC_DXT5_Format=D,e.RGBFormat=1022,e.RGB_ETC1_Format=36196,e.RGB_ETC2_Format=F,e.RGB_PVRTC_2BPPV1_Format=R,e.RGB_PVRTC_4BPPV1_Format=L,e.RGB_S3TC_DXT1_Format=O,e.RGFormat=1030,e.RGIntegerFormat=1031,e.RawShaderMaterial=Ul,e.Ray=Ie,e.Raycaster=class{constructor(t,e,i=0,n=1/0){this.ray=new Ie(t,e),this.near=i,this.far=n,this.camera=null,this.layers=new He,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!0,i=[]){return Ih(t,this,i,e),i.sort(Ph),i}intersectObjects(t,e=!0,i=[]){for(let n=0,r=t.length;n<r;n++)Ih(t[n],this,i,e);return i.sort(Ph),i}},e.RectAreaLight=Bc,e.RedFormat=1028,e.RedIntegerFormat=1029,e.ReinhardToneMapping=2,e.RepeatWrapping=u,e.ReplaceStencilOp=7681,e.ReverseSubtractEquation=102,e.RingBufferGeometry=El,e.RingGeometry=El,e.Scene=oo,e.SceneUtils=au,e.ShaderChunk=An,e.ShaderLib=Cn,e.ShaderMaterial=cn,e.ShadowMaterial=Fl,e.Shape=Ja,e.ShapeBufferGeometry=Cl,e.ShapeGeometry=Cl,e.ShapePath=class{constructor(){this.type="ShapePath",this.color=new zt,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new qa,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,i,n){return this.currentPath.quadraticCurveTo(t,e,i,n),this}bezierCurveTo(t,e,i,n,r,s){return this.currentPath.bezierCurveTo(t,e,i,n,r,s),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t,e){function i(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i],r=new Ja;r.curves=n.curves,e.push(r)}return e}function n(t,e){const i=e.length;let n=!1;for(let r=i-1,s=0;s<i;r=s++){let i=e[r],o=e[s],a=o.x-i.x,l=o.y-i.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(i=e[s],a=-a,o=e[r],l=-l),t.y<i.y||t.y>o.y)continue;if(t.y===i.y){if(t.x===i.x)return!0}else{const e=l*(t.x-i.x)-a*(t.y-i.y);if(0===e)return!0;if(e<0)continue;n=!n}}else{if(t.y!==i.y)continue;if(o.x<=t.x&&t.x<=i.x||i.x<=t.x&&t.x<=o.x)return!0}}return n}const r=_l.isClockWise,s=this.subPaths;if(0===s.length)return[];if(!0===e)return i(s);let o,a,l;const c=[];if(1===s.length)return a=s[0],l=new Ja,l.curves=a.curves,c.push(l),c;let h=!r(s[0].getPoints());h=t?!h:h;const u=[],d=[];let p,f,m=[],g=0;d[g]=void 0,m[g]=[];for(let e=0,i=s.length;e<i;e++)a=s[e],p=a.getPoints(),o=r(p),o=t?!o:o,o?(!h&&d[g]&&g++,d[g]={s:new Ja,p},d[g].s.curves=a.curves,h&&g++,m[g]=[]):m[g].push({h:a,p:p[0]});if(!d[0])return i(s);if(d.length>1){let t=!1,e=0;for(let t=0,e=d.length;t<e;t++)u[t]=[];for(let i=0,r=d.length;i<r;i++){const r=m[i];for(let s=0;s<r.length;s++){const o=r[s];let a=!0;for(let r=0;r<d.length;r++)n(o.p,d[r].p)&&(i!==r&&e++,a?(a=!1,u[r].push(o)):t=!0);a&&u[i].push(o)}}e>0&&!1===t&&(m=u)}for(let t=0,e=d.length;t<e;t++){l=d[t].s,c.push(l),f=m[t];for(let t=0,e=f.length;t<e;t++)l.holes.push(f[t].h)}return c}},e.ShapeUtils=_l,e.ShortType=1011,e.Skeleton=zo,e.SkeletonHelper=kh,e.SkinnedMesh=Bo,e.SmoothShading=2,e.Sphere=we,e.SphereBufferGeometry=Ol,e.SphereGeometry=Ol,e.Spherical=class{constructor(t=1,e=0,i=0){return this.radius=t,this.phi=e,this.theta=i,this}set(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(Mt(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}},e.SphericalHarmonics3=Nc,e.SplineCurve=Ha,e.SpotLight=Ac,e.SpotLightHelper=class extends ni{constructor(t,e){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;const i=new Ui,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,e=1,i=32;t<i;t++,e++){const r=t/i*Math.PI*2,s=e/i*Math.PI*2;n.push(Math.cos(r),Math.sin(r),1,Math.cos(s),Math.sin(s),1)}i.setAttribute("position",new Oi(n,3));const r=new Jo({fog:!1,toneMapped:!1});this.cone=new ia(i,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),Fh.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Fh),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},e.Sprite=To,e.SpriteMaterial=ho,e.SrcAlphaFactor=204,e.SrcAlphaSaturateFactor=210,e.SrcColorFactor=202,e.StaticCopyUsage=35046,e.StaticDrawUsage=ut,e.StaticReadUsage=35045,e.StereoCamera=class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new un,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new un,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep,$c.copy(t.projectionMatrix);const i=e.eyeSep/2,n=i*e.near/e.focus,r=e.near*Math.tan(yt*e.fov*.5)/e.zoom;let s,o;Qc.elements[12]=-i,Kc.elements[12]=i,s=-r*e.aspect+n,o=r*e.aspect+n,$c.elements[0]=2*e.near/(o-s),$c.elements[8]=(o+s)/(o-s),this.cameraL.projectionMatrix.copy($c),s=-r*e.aspect-n,o=r*e.aspect-n,$c.elements[0]=2*e.near/(o-s),$c.elements[8]=(o+s)/(o-s),this.cameraR.projectionMatrix.copy($c)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(Qc),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(Kc)}},e.StreamCopyUsage=35042,e.StreamDrawUsage=35040,e.StreamReadUsage=35041,e.StringKeyframeTrack=sc,e.SubtractEquation=101,e.SubtractiveBlending=3,e.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},e.TangentSpaceNormalMap=0,e.TetrahedronBufferGeometry=Pl,e.TetrahedronGeometry=Pl,e.TextGeometry=function(){return console.error("THREE.TextGeometry has been moved to /examples/jsm/geometries/TextGeometry.js"),new Ui},e.Texture=qt,e.TextureLoader=yc,e.TorusBufferGeometry=Il,e.TorusGeometry=Il,e.TorusKnotBufferGeometry=Dl,e.TorusKnotGeometry=Dl,e.Triangle=fi,e.TriangleFanDrawMode=2,e.TriangleStripDrawMode=1,e.TrianglesDrawMode=0,e.TubeBufferGeometry=Ll,e.TubeGeometry=Ll,e.UVMapping=r,e.Uint16Attribute=function(t,e){return new Ti(t,e)},e.Uint16BufferAttribute=Ti,e.Uint32Attribute=function(t,e){return new Ei(t,e)},e.Uint32BufferAttribute=Ei,e.Uint8Attribute=function(t,e){return new bi(t,e)},e.Uint8BufferAttribute=bi,e.Uint8ClampedAttribute=function(t,e){return new wi(t,e)},e.Uint8ClampedBufferAttribute=wi,e.Uniform=Eh,e.UniformsLib=En,e.UniformsUtils=ln,e.UnsignedByteType=x,e.UnsignedInt248Type=T,e.UnsignedIntType=b,e.UnsignedShort4444Type=1017,e.UnsignedShort5551Type=1018,e.UnsignedShortType=M,e.VSMShadowMap=3,e.Vector2=Ct,e.Vector3=ee,e.Vector4=Jt,e.VectorKeyframeTrack=oc,e.Vertex=function(t,e,i){return new ee(t,e,i)},e.VertexColors=2,e.VideoTexture=ua,e.WebGL1Renderer=no,e.WebGL3DRenderTarget=Qt,e.WebGLArrayRenderTarget=Zt,e.WebGLCubeRenderTarget=mn,e.WebGLMultipleRenderTargets=$t,e.WebGLMultisampleRenderTarget=function(t,e,i){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.');const n=new Xt(t,e,i);return n.samples=4,n},e.WebGLRenderTarget=Xt,e.WebGLRenderTargetCube=function(t,e,i){return new mn(t,i)},e.WebGLRenderer=io,e.WebGLUtils=Xs,e.WireframeGeometry=Rl,e.WireframeHelper=function(t,e){return new ia(new Rl(t.geometry),new Jo({color:void 0!==e?e:16777215}))},e.WrapAroundEnding=st,e.XHRLoader=function(t){return new fc(t)},e.ZeroCurvatureEnding=nt,e.ZeroFactor=200,e.ZeroSlopeEnding=rt,e.ZeroStencilOp=0,e._SRGBAFormat=ft,e.sRGBEncoding=ct},3306:(t,e,i)=>{"use strict";i.r(e),i.d(e,{GeoTransform:()=>Kl,Loader3DTiles:()=>ec,PointCloudColoring:()=>Yl,Shading:()=>Zl});var n=i(9477),r=i(1217);const s=new WeakMap;class o extends n.aNw{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,e,i,r){const s=new n.hH6(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(t=>{const i={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(t,i).then(e).catch(r)}),i,r)}decodeDracoFile(t,e,i,n){const r={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!i};this.decodeGeometry(t,r).then(e)}decodeGeometry(t,e){for(const t in e.attributeTypes){const i=e.attributeTypes[t];void 0!==i.BYTES_PER_ELEMENT&&(e.attributeTypes[t]=i.name)}const i=JSON.stringify(e);if(s.has(t)){const e=s.get(t);if(e.key===i)return e.promise;if(0===t.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n;const r=this.workerNextTaskID++,o=t.byteLength,a=this._getWorker(r,o).then((i=>(n=i,new Promise(((i,s)=>{n._callbacks[r]={resolve:i,reject:s},n.postMessage({type:"decode",id:r,taskConfig:e,buffer:t},[t])}))))).then((t=>this._createGeometry(t.geometry)));return a.catch((()=>!0)).then((()=>{n&&r&&this._releaseTask(n,r)})),s.set(t,{key:i,promise:a}),a}_createGeometry(t){const e=new n.u9r;t.index&&e.setIndex(new n.TlE(t.index.array,1));for(let i=0;i<t.attributes.length;i++){const r=t.attributes[i],s=r.name,o=r.array,a=r.itemSize;e.setAttribute(s,new n.TlE(o,a))}return e}_loadLibrary(t,e){const i=new n.hH6(this.manager);return i.setPath(this.decoderPath),i.setResponseType(e),i.setWithCredentials(this.withCredentials),new Promise(((e,n)=>{i.load(t,e,void 0,n)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,e=[];return t?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then((e=>{const i=e[0];t||(this.decoderConfig.wasmBinary=e[1]);const n=a.toString(),r=["/* draco decoder */",i,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([r]))})),this.decoderPending}_getWorker(t,e){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const t=new Worker(this.workerSourceURL);t._callbacks={},t._taskCosts={},t._taskLoad=0,t.postMessage({type:"init",decoderConfig:this.decoderConfig}),t.onmessage=function(e){const i=e.data;switch(i.type){case"decode":t._callbacks[i.id].resolve(i);break;case"error":t._callbacks[i.id].reject(i);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+i.type+'"')}},this.workerPool.push(t)}else this.workerPool.sort((function(t,e){return t._taskLoad>e._taskLoad?-1:1}));const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[t]=e,i._taskLoad+=e,i}))}_releaseTask(t,e){t._taskLoad-=t._taskCosts[e],delete t._callbacks[e],delete t._taskCosts[e]}debug(){this.workerPool.map((t=>t._taskLoad))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this}}function a(){let t,e;function i(t,e,i,n,r,s){const o=s.num_components(),a=i.num_points()*o,l=a*r.BYTES_PER_ELEMENT,c=function(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32}}(t,r),h=t._malloc(l);e.GetAttributeDataArrayForAllPoints(i,s,c,l,h);const u=new r(t.HEAPF32.buffer,h,a).slice();return t._free(h),{name:n,array:u,itemSize:o}}onmessage=function(n){const r=n.data;switch(r.type){case"init":t=r.decoderConfig,e=new Promise((function(e){t.onModuleLoaded=function(t){e({draco:t})},DracoDecoderModule(t)}));break;case"decode":const n=r.buffer,s=r.taskConfig;e.then((t=>{const e=t.draco,o=new e.Decoder,a=new e.DecoderBuffer;a.Init(new Int8Array(n),n.byteLength);try{const t=function(t,e,n,r){const s=r.attributeIDs,o=r.attributeTypes;let a,l;const c=e.GetEncodedGeometryType(n);if(c===t.TRIANGULAR_MESH)a=new t.Mesh,l=e.DecodeBufferToMesh(n,a);else{if(c!==t.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new t.PointCloud,l=e.DecodeBufferToPointCloud(n,a)}if(!l.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+l.error_msg());const h={index:null,attributes:[]};for(const n in s){const l=self[o[n]];let c,u;if(r.useUniqueIDs)u=s[n],c=e.GetAttributeByUniqueId(a,u);else{if(u=e.GetAttributeId(a,t[s[n]]),-1===u)continue;c=e.GetAttribute(a,u)}h.attributes.push(i(t,e,a,n,l,c))}c===t.TRIANGULAR_MESH&&(h.index=function(t,e,i){const n=3*i.num_faces(),r=4*n,s=t._malloc(r);e.GetTrianglesUInt32Array(i,r,s);const o=new Uint32Array(t.HEAPF32.buffer,s,n).slice();return t._free(s),{array:o,itemSize:1}}(t,e,a));return t.destroy(a),h}(e,o,a,s),n=t.attributes.map((t=>t.array.buffer));t.index&&n.push(t.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:t},n)}catch(t){console.error(t),self.postMessage({type:"error",id:r.id,error:t.message})}finally{e.destroy(a),e.destroy(o)}}))}}}class l{constructor(t=4){this.pool=t,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(t){if(!this.workers[t]){const e=this.workerCreator();e.addEventListener("message",this._onMessage.bind(this,t)),this.workers[t]=e}}_getIdleWorker(){for(let t=0;t<this.pool;t++)if(!(this.workerStatus&1<<t))return t;return-1}_onMessage(t,e){const i=this.workersResolve[t];if(i&&i(e),this.queue.length){const{resolve:e,msg:i,transfer:n}=this.queue.shift();this.workersResolve[t]=e,this.workers[t].postMessage(i,n)}else this.workerStatus^=1<<t}setWorkerCreator(t){this.workerCreator=t}setWorkerLimit(t){this.pool=t}postMessage(t,e){return new Promise((i=>{const n=this._getIdleWorker();-1!==n?(this._initWorker(n),this.workerStatus|=1<<n,this.workersResolve[n]=i,this.workers[n].postMessage(t,e)):this.queue.push({resolve:i,msg:t,transfer:e})}))}dispose(){this.workers.forEach((t=>t.terminate())),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const c=new WeakMap;class h extends n.aNw{constructor(t){super(t),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new l,this.workerSourceURL="",this.workerConfig=null}setTranscoderPath(t){return this.transcoderPath=t,this}setWorkerLimit(t){return this.workerPool.setWorkerLimit(t),this}detectSupport(t){return this.workerConfig={astcSupported:t.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:t.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:t.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:t.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:t.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:t.extensions.has("WEBGL_compressed_texture_pvrtc")||t.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},t.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const t=new n.hH6(this.manager);t.setPath(this.transcoderPath),t.setWithCredentials(this.withCredentials);const e=t.loadAsync("basis_transcoder.js"),i=new n.hH6(this.manager);i.setPath(this.transcoderPath),i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);const r=i.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([e,r]).then((([t,e])=>{const i=h.BasisWorker.toString(),n=["/* constants */","let _EngineFormat = "+JSON.stringify(h.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(h.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(h.BasisFormat),"/* basis_transcoder.js */",t,"/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([n])),this.transcoderBinary=e,this.workerPool.setWorkerCreator((()=>{const t=new Worker(this.workerSourceURL),e=this.transcoderBinary.slice(0);return t.postMessage({type:"init",config:this.workerConfig,transcoderBinary:e},[e]),t}))}))}return this.transcoderPending}load(t,e,i,r){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const s=new n.hH6(this.manager);s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials);const o=new n.EB7;return s.load(t,(t=>{if(c.has(t)){return c.get(t).promise.then(e).catch(r)}this._createTexture([t]).then((function(t){o.copy(t),o.needsUpdate=!0,e&&e(o)})).catch(r)}),i,r),o}_createTextureFrom(t){const{mipmaps:e,width:i,height:r,format:s,type:o,error:a,dfdTransferFn:l,dfdFlags:c}=t;if("error"===o)return Promise.reject(a);const h=new n.EB7(e,i,r,s,n.ywz);return h.minFilter=1===e.length?n.wem:n.D1R,h.magFilter=n.wem,h.generateMipmaps=!1,h.needsUpdate=!0,h.encoding=2===l?n.knz:n.rnI,h.premultiplyAlpha=!!(1&c),h}_createTexture(t,e={}){const i=e,n=this.init().then((()=>this.workerPool.postMessage({type:"transcode",buffers:t,taskConfig:i},t))).then((t=>this._createTextureFrom(t.data)));return c.set(t[0],{promise:n}),n}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}function u(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{l(n.next(t))}catch(t){s(t)}}function a(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((n=n.apply(t,e||[])).next())}))}function d(t,e){if(!t)throw new Error(e||"loader assertion failed.")}h.BasisFormat={ETC1S:0,UASTC_4x4:1},h.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},h.EngineFormat={RGBAFormat:n.wk1,RGBA_ASTC_4x4_Format:n.ptH,RGBA_BPTC_Format:n.bsb,RGBA_ETC2_EAC_Format:n.ekQ,RGBA_PVRTC_4BPPV1_Format:n.eaV,RGBA_S3TC_DXT5_Format:n.ILR,RGB_ETC1_Format:n.fto,RGB_ETC2_Format:n.l0P,RGB_PVRTC_4BPPV1_Format:n._AM,RGB_S3TC_DXT1_Format:n.wuA},h.BasisWorker=function(){let t,e,i;const n=_EngineFormat,r=_TranscoderFormat,s=_BasisFormat;self.addEventListener("message",(function(o){const h=o.data;switch(h.type){case"init":t=h.config,u=h.transcoderBinary,e=new Promise((t=>{i={wasmBinary:u,onRuntimeInitialized:t},BASIS(i)})).then((()=>{i.initializeBasis(),i.KTX2File}));break;case"transcode":e.then((()=>{try{const{width:e,height:o,hasAlpha:u,mipmaps:d,format:p,dfdTransferFn:f,dfdFlags:m}=function(e){const o=new i.KTX2File(new Uint8Array(e));function h(){o.close(),o.delete()}if(!o.isValid())throw h(),new Error("THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file");const u=o.isUASTC()?s.UASTC_4x4:s.ETC1S,d=o.getWidth(),p=o.getHeight(),f=o.getLevels(),m=o.getHasAlpha(),g=o.getDFDTransferFunc(),v=o.getDFDFlags(),{transcoderFormat:y,engineFormat:_}=function(e,i,o,h){let u,d;const p=e===s.ETC1S?a:l;for(let n=0;n<p.length;n++){const r=p[n];if(t[r.if]&&(r.basisFormat.includes(e)&&!(h&&r.transcoderFormat.length<2)&&(!r.needsPowerOfTwo||c(i)&&c(o))))return u=r.transcoderFormat[h?1:0],d=r.engineFormat[h?1:0],{transcoderFormat:u,engineFormat:d}}return u=r.RGBA32,d=n.RGBAFormat,{transcoderFormat:u,engineFormat:d}}(u,d,p,m);if(!d||!p||!f)throw h(),new Error("THREE.KTX2Loader:\tInvalid texture");if(!o.startTranscoding())throw h(),new Error("THREE.KTX2Loader: .startTranscoding failed");const x=[];for(let t=0;t<f;t++){const e=o.getImageLevelInfo(t,0,0),i=e.origWidth,n=e.origHeight,r=new Uint8Array(o.getImageTranscodedSizeInBytes(t,0,0,y));if(!o.transcodeImage(r,t,0,0,y,0,-1,-1))throw h(),new Error("THREE.KTX2Loader: .transcodeImage failed.");x.push({data:r,width:i,height:n})}return h(),{width:d,height:p,hasAlpha:m,mipmaps:x,format:_,dfdTransferFn:g,dfdFlags:v}}(h.buffers[0]),g=[];for(let t=0;t<d.length;++t)g.push(d[t].data.buffer);self.postMessage({type:"transcode",id:h.id,width:e,height:o,hasAlpha:u,mipmaps:d,format:p,dfdTransferFn:f,dfdFlags:m},g)}catch(t){console.error(t),self.postMessage({type:"error",id:h.id,error:t.message})}}))}var u}));const o=[{if:"astcSupported",basisFormat:[s.UASTC_4x4],transcoderFormat:[r.ASTC_4x4,r.ASTC_4x4],engineFormat:[n.RGBA_ASTC_4x4_Format,n.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.BC7_M5,r.BC7_M5],engineFormat:[n.RGBA_BPTC_Format,n.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.BC1,r.BC3],engineFormat:[n.RGB_S3TC_DXT1_Format,n.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.ETC1,r.ETC2],engineFormat:[n.RGB_ETC2_Format,n.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.ETC1],engineFormat:[n.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.PVRTC1_4_RGB,r.PVRTC1_4_RGBA],engineFormat:[n.RGB_PVRTC_4BPPV1_Format,n.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],a=o.sort((function(t,e){return t.priorityETC1S-e.priorityETC1S})),l=o.sort((function(t,e){return t.priorityUASTC-e.priorityUASTC}));function c(t){return t<=2||0==(t&t-1)&&0!==t}};const p=Boolean("object"!=typeof process||"[object process]"!==String(process)||process.browser),f="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);f&&parseFloat(f[1]);function m(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const g={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},v=g.global||g.self||g.window||{},y="object"!=typeof process||"[object process]"!==String(process)||process.browser,_="function"==typeof importScripts,x="undefined"!=typeof window&&void 0!==window.orientation,M="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);function b(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}M&&parseFloat(M[1]);class w{constructor(t,e){b(this,"name",void 0),b(this,"workerThread",void 0),b(this,"isRunning",void 0),b(this,"result",void 0),b(this,"_resolve",void 0),b(this,"_reject",void 0),this.name=t,this.workerThread=e,this.isRunning=!0,this._resolve=()=>{},this._reject=()=>{},this.result=new Promise(((t,e)=>{this._resolve=t,this._reject=e}))}postMessage(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e})}done(t){m(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){m(this.isRunning),this.isRunning=!1,this._reject(t)}}const S=new Map;function T(t){m(t.source&&!t.url||!t.source&&t.url);let e=S.get(t.source||t.url);return e||(t.url&&(e=function(t){if(!t.startsWith("http"))return t;return A((e=t,"try {\n  importScripts('".concat(e,"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}")));var e}(t.url),S.set(t.url,e)),t.source&&(e=A(t.source),S.set(t.source,e))),m(e),e}function A(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function E(t,e=!0,i){const n=i||new Set;if(t){if(C(t))n.add(t);else if(C(t.buffer))n.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"==typeof t)for(const i in t)E(t[i],e,n)}else;return void 0===i?Array.from(n):[]}function C(t){return!!t&&(t instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&t instanceof MessagePort||("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)))}const O=()=>{};class P{static isSupported(){return"undefined"!=typeof Worker}constructor(t){b(this,"name",void 0),b(this,"source",void 0),b(this,"url",void 0),b(this,"terminated",!1),b(this,"worker",void 0),b(this,"onMessage",void 0),b(this,"onError",void 0),b(this,"_loadableURL","");const{name:e,source:i,url:n}=t;m(i||n),this.name=e,this.source=i,this.url=n,this.onMessage=O,this.onError=t=>console.log(t),this.worker=this._createBrowserWorker()}destroy(){this.onMessage=O,this.onError=O,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(t,e){e=e||E(t),this.worker.postMessage(t,e)}_getErrorFromErrorEvent(t){let e="Failed to load ";return e+="worker ".concat(this.name," from ").concat(this.url,". "),t.message&&(e+="".concat(t.message," in ")),t.lineno&&(e+=":".concat(t.lineno,":").concat(t.colno)),new Error(e)}_createBrowserWorker(){this._loadableURL=T({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},t.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},t.onmessageerror=t=>console.error(t),t}}class I{constructor(t){b(this,"name","unnamed"),b(this,"source",void 0),b(this,"url",void 0),b(this,"maxConcurrency",1),b(this,"maxMobileConcurrency",1),b(this,"onDebug",(()=>{})),b(this,"reuseWorkers",!0),b(this,"props",{}),b(this,"jobQueue",[]),b(this,"idleQueue",[]),b(this,"count",0),b(this,"isDestroyed",!1),this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach((t=>t.destroy())),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},void 0!==t.name&&(this.name=t.name),void 0!==t.maxConcurrency&&(this.maxConcurrency=t.maxConcurrency),void 0!==t.maxMobileConcurrency&&(this.maxMobileConcurrency=t.maxMobileConcurrency),void 0!==t.reuseWorkers&&(this.reuseWorkers=t.reuseWorkers),void 0!==t.onDebug&&(this.onDebug=t.onDebug)}async startJob(t,e=((t,e,i)=>t.done(i)),i=((t,e)=>t.error(e))){const n=new Promise((n=>(this.jobQueue.push({name:t,onMessage:e,onError:i,onStart:n}),this)));return this._startQueuedJob(),await n}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();if(e){this.onDebug({message:"Starting job",name:e.name,workerThread:t,backlog:this.jobQueue.length});const i=new w(e.name,t);t.onMessage=t=>e.onMessage(i,t.type,t.payload),t.onError=t=>e.onError(i,t),e.onStart(i);try{await i.result}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new P({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return x?this.maxMobileConcurrency:this.maxConcurrency}}const D={maxConcurrency:3,maxMobileConcurrency:1,onDebug:()=>{},reuseWorkers:!0};class L{static isSupported(){return P.isSupported()}static getWorkerFarm(t={}){return L._workerFarm=L._workerFarm||new L({}),L._workerFarm.setProps(t),L._workerFarm}constructor(t){b(this,"props",void 0),b(this,"workerPools",new Map),this.props={...D},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy()}setProps(t){this.props={...this.props,...t};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:e,source:i,url:n}=t;let r=this.workerPools.get(e);return r||(r=new I({name:e,source:i,url:n}),r.setProps(this._getWorkerPoolProps()),this.workerPools.set(e,r)),r}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}b(L,"_workerFarm",void 0);var R={},B=Object.freeze(Object.assign(Object.create(null),R,{default:R}));const N="3.1.4",F={};async function U(t,e=null,i={}){return e&&(t=function(t,e,i){if(t.startsWith("http"))return t;const n=i.modules||{};if(n[t])return n[t];if(!y)return"modules/".concat(e,"/dist/libs/").concat(t);if(i.CDN)return m(i.CDN.startsWith("http")),"".concat(i.CDN,"/").concat(e,"@").concat(N,"/dist/libs/").concat(t);if(_)return"../src/libs/".concat(t);return"modules/".concat(e,"/src/libs/").concat(t)}(t,e,i)),F[t]=F[t]||async function(t){if(t.endsWith("wasm")){const e=await fetch(t);return await e.arrayBuffer()}if(!y)try{return B&&R.requireFromFile&&await R.requireFromFile(t)}catch{return null}if(_)return importScripts(t);const e=await fetch(t);return function(t,e){if(!y)return R.requireFromString&&R.requireFromString(t,e);if(_)return eval.call(v,t),null;const i=document.createElement("script");i.id=e;try{i.appendChild(document.createTextNode(t))}catch(e){i.text=t}return document.body.appendChild(i),null}(await e.text(),t)}(t),await F[t]}async function G(t,e,i,n,r){const s=t.id,o=function(t,e={}){const i=e[t.id]||{},n="".concat(t.id,"-worker.js");let r=i.workerUrl;if(r||"compression"!==t.id||(r=e.workerUrl),"test"===e._workerType&&(r="modules/".concat(t.module,"/dist/").concat(n)),!r){let e=t.version;"latest"===e&&(e="latest");const i=e?"@".concat(e):"";r="https://unpkg.com/@loaders.gl/".concat(t.module).concat(i,"/dist/").concat(n)}return m(r),r}(t,i),a=L.getWorkerFarm(i).getWorkerPool({name:s,url:o});i=JSON.parse(JSON.stringify(i));const l=await a.startJob("process-on-worker",z.bind(null,r));l.postMessage("process",{input:e,options:i});const c=await l.result;return await c.result}async function z(t,e,i,n){switch(i){case"done":e.done(n);break;case"error":e.error(new Error(n.error));break;case"process":const{id:r,input:s,options:o}=n;try{const i=await t(s,o);e.postMessage("done",{id:r,result:i})}catch(t){const i=t instanceof Error?t.message:"unknown error";e.postMessage("error",{id:r,error:i})}break;default:"parse-with-worker unknown message ".concat(i)}}function k(t,e,i){if(t.byteLength<=e+i)return"";const n=new DataView(t);let r="";for(let t=0;t<i;t++)r+=String.fromCharCode(n.getUint8(e+t));return r}function j(t){try{return JSON.parse(t)}catch(e){throw new Error('Failed to parse JSON from data starting with "'.concat(function(t,e=5){if("string"==typeof t)return t.slice(0,e);if(ArrayBuffer.isView(t))return k(t.buffer,t.byteOffset,e);if(t instanceof ArrayBuffer)return k(t,0,e);return""}(t),'"'))}}function H(t){return t&&"object"==typeof t&&t.isBuffer}function V(t){if(H(t))return function(t){if(H(t))return new Uint8Array(t.buffer,t.byteOffset,t.length).slice().buffer;return t}(t);if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return 0===t.byteOffset&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if("string"==typeof t){const e=t;return(new TextEncoder).encode(e).buffer}if(t&&"object"==typeof t&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function W(t,e,i){const n=void 0!==i?new Uint8Array(t).subarray(e,e+i):new Uint8Array(t).subarray(e);return new Uint8Array(n).buffer}function q(t,e){return d(t>=0),d(e>0),t+(e-1)&~(e-1)}function J(t,e,i){let n;if(t instanceof ArrayBuffer)n=new Uint8Array(t);else{const e=t.byteOffset,i=t.byteLength;n=new Uint8Array(t.buffer||t.arrayBuffer,e,i)}return e.set(n,i),i+q(n.byteLength,4)}async function X(t){const e=[];for await(const i of t)e.push(i);return function(...t){const e=t.map((t=>t instanceof ArrayBuffer?new Uint8Array(t):t)),i=e.reduce(((t,e)=>t+e.byteLength),0),n=new Uint8Array(i);let r=0;for(const t of e)n.set(t,r),r+=t.byteLength;return n.buffer}(...e)}function Y(){let t;if("undefined"!=typeof window&&window.performance)t=window.performance.now();else if("undefined"!=typeof process&&process.hrtime){const e=process.hrtime();t=1e3*e[0]+e[1]/1e6}else t=Date.now();return t}class Z{constructor(t,e){b(this,"name",void 0),b(this,"type",void 0),b(this,"sampleSize",1),b(this,"time",void 0),b(this,"count",void 0),b(this,"samples",void 0),b(this,"lastTiming",void 0),b(this,"lastSampleTime",void 0),b(this,"lastSampleCount",void 0),b(this,"_count",0),b(this,"_time",0),b(this,"_samples",0),b(this,"_startTime",0),b(this,"_timerPending",!1),this.name=t,this.type=e,this.reset()}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Y(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Y()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class K{constructor(t){b(this,"id",void 0),b(this,"stats",{}),this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t in this.stats)this.stats[t].reset();return this}forEach(t){for(const e in this.stats)t(this.stats[e])}getTable(){const t={};return this.forEach((e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}})),t}_initializeStats(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((t=>this._getOrCreate(t)))}_getOrCreate(t){if(!t||!t.name)return null;const{name:e,type:i}=t;return this.stats[e]||(this.stats[e]=t instanceof Z?t:new Z(e,i)),this.stats[e]}}const Q={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class ${constructor(t={}){b(this,"props",void 0),b(this,"stats",void 0),b(this,"activeRequestCount",0),b(this,"requestQueue",[]),b(this,"requestMap",new Map),b(this,"deferredUpdate",null),this.props={...Q,...t},this.stats=new K({id:this.props.id}),this.stats.get("Queued Requests"),this.stats.get("Active Requests"),this.stats.get("Cancelled Requests"),this.stats.get("Queued Requests Ever"),this.stats.get("Active Requests Ever")}scheduleRequest(t,e=(()=>0)){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const i={handle:t,priority:0,getPriority:e},n=new Promise((t=>(i.resolve=t,i)));return this.requestQueue.push(i),this.requestMap.set(t,n),this._issueNewRequests(),n}_issueRequest(t){const{handle:e,resolve:i}=t;let n=!1;const r=()=>{n||(n=!0,this.requestMap.delete(e),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,i?i({done:r}):Promise.resolve({done:r})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout((()=>this._issueNewRequestsAsync()),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==t){this._updateAllRequests();for(let e=0;e<t;++e){const t=this.requestQueue.shift();t&&this._issueRequest(t)}}}_updateAllRequests(){const t=this.requestQueue;for(let e=0;e<t.length;++e){const i=t[e];this._updateRequest(i)||(t.splice(e,1),this.requestMap.delete(i.handle),e--)}t.sort(((t,e)=>t.priority-e.priority))}_updateRequest(t){return t.priority=t.getPriority(t.handle),!(t.priority<0)||(t.resolve(null),!1)}}const tt={};function et(t){const e=t&&t.lastIndexOf("/");return e>=0?t.substr(0,e):""}const it=t=>"function"==typeof t,nt=t=>null!==t&&"object"==typeof t,rt=t=>nt(t)&&t.constructor==={}.constructor,st=t=>"undefined"!=typeof Response&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,ot=t=>"undefined"!=typeof Blob&&t instanceof Blob,at=t=>(t=>"undefined"!=typeof ReadableStream&&t instanceof ReadableStream||nt(t)&&it(t.tee)&&it(t.cancel)&&it(t.getReader))(t)||(t=>nt(t)&&it(t.read)&&it(t.pipe)&&(t=>"boolean"==typeof t)(t.readable))(t),lt=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,ct=/^([-\w.]+\/[-\w.+]+)/;function ht(t){const e=ct.exec(t);return e?e[1]:t}function ut(t){const e=lt.exec(t);return e?e[1]:""}const dt=/\?.*/;function pt(t){if(st(t)){const e=ft(t.url||"");return{url:e,type:ht(t.headers.get("content-type")||"")||ut(e)}}return ot(t)?{url:ft(t.name||""),type:t.type||""}:"string"==typeof t?{url:ft(t),type:ut(t)}:{url:"",type:""}}function ft(t){return t.replace(dt,"")}async function mt(t){if(st(t))return t;const e={},i=function(t){return st(t)?t.headers["content-length"]||-1:ot(t)?t.size:"string"==typeof t?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}(t);i>=0&&(e["content-length"]=String(i));const{url:n,type:r}=pt(t);r&&(e["content-type"]=r);const s=await async function(t){const e=5;if("string"==typeof t)return"data:,".concat(t.slice(0,e));if(t instanceof Blob){const e=t.slice(0,5);return await new Promise((t=>{const i=new FileReader;i.onload=e=>{var i;return t(null==e||null===(i=e.target)||void 0===i?void 0:i.result)},i.readAsDataURL(e)}))}if(t instanceof ArrayBuffer){const i=function(t){let e="";const i=new Uint8Array(t);for(let t=0;t<i.byteLength;t++)e+=String.fromCharCode(i[t]);return btoa(e)}(t.slice(0,e));return"data:base64,".concat(i)}return null}(t);s&&(e["x-first-bytes"]=s),"string"==typeof t&&(t=(new TextEncoder).encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:n}),o}async function gt(t,e){if("string"==typeof t){t=function(t){for(const e in tt)if(t.startsWith(e)){const i=tt[e];t=t.replace(e,i)}return t.startsWith("http://")||t.startsWith("https://")||(t="".concat("").concat(t)),t}(t);let i=e;return null!=e&&e.fetch&&"function"!=typeof(null==e?void 0:e.fetch)&&(i=e.fetch),await fetch(t,i)}return await mt(t)}function vt(){return!("object"==typeof process&&"[object process]"===String(process)&&!process.browser)||function(t){if("undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"==typeof process.versions&&Boolean(process.versions.electron))return!0;const e="object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent,i=t||e;return!!(i&&i.indexOf("Electron")>=0)}()}const yt={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document,process:"object"==typeof process&&process},_t=yt.window||yt.self||yt.global,xt=yt.process||{},Mt="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source";vt();class bt{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";b(this,"storage",void 0),b(this,"id",void 0),b(this,"config",{}),this.storage=function(t){try{const e=window[t],i="__storage_test__";return e.setItem(i,i),e.removeItem(i),e}catch(t){return null}}(i),this.id=t,this.config={},Object.assign(this.config,e),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){return this.config={},this.updateConfiguration(t)}updateConfiguration(t){if(Object.assign(this.config,t),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}return this}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}function wt(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600;const r=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>n&&(i=Math.min(i,n/t.width));const s=t.width*i,o=t.height*i,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(r,");"),"background-size:".concat(s,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),a]}let St;function Tt(t){return"string"==typeof t?St[t.toUpperCase()]||St.WHITE:t}function At(t,e){if(!t)throw new Error(e||"Assertion failed")}function Et(){let t;var e,i;if(vt&&"performance"in _t)t=null==_t||null===(e=_t.performance)||void 0===e||null===(i=e.now)||void 0===i?void 0:i.call(e);else if("hrtime"in xt){var n;const e=null==xt||null===(n=xt.hrtime)||void 0===n?void 0:n.call(xt);t=1e3*e[0]+e[1]/1e6}else t=Date.now();return t}!function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"}(St||(St={}));const Ct={debug:vt&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Ot={enabled:!0,level:0};function Pt(){}const It={},Dt={once:!0};class Lt{constructor(){let{id:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:""};b(this,"id",void 0),b(this,"VERSION",Mt),b(this,"_startTs",Et()),b(this,"_deltaTs",Et()),b(this,"_storage",void 0),b(this,"userData",{}),b(this,"LOG_THROTTLE_TIMEOUT",0),this.id=t,this._storage=new bt("__probe-".concat(this.id,"__"),Ot),this.userData={},this.timeStamp("".concat(this.id," started")),function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"];const i=Object.getPrototypeOf(t),n=Object.getOwnPropertyNames(i);for(const i of n)"function"==typeof t[i]&&(e.find((t=>i===t))||(t[i]=t[i].bind(t)))}(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Et()-this._startTs).toPrecision(10))}getDelta(){return Number((Et()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._storage.updateConfiguration({enabled:t}),this}setLevel(t){return this._storage.updateConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.updateConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):this._storage.config}assert(t,e){At(t,e)}warn(t){return this._getLogFunction(0,t,Ct.warn,arguments,Dt)}error(t){return this._getLogFunction(0,t,Ct.error,arguments)}deprecated(t,e){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(e,"` instead"))}removed(t,e){return this.error("`".concat(t,"` has been removed. Use `").concat(e,"` instead"))}probe(t,e){return this._getLogFunction(t,e,Ct.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,Ct.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];return this._getLogFunction(t,e,Ct.debug||Ct.info,arguments,Dt)}table(t,e,i){return e?this._getLogFunction(t,e,console.table||Pt,i&&[i],{tag:Nt(e)}):Pt}image(t){let{logLevel:e,priority:i,image:n,message:r="",scale:s=1}=t;return this._shouldLog(e||i)?vt?function(t){let{image:e,message:i="",scale:n=1}=t;if("string"==typeof e){const t=new Image;return t.onload=()=>{wt(t,i,n)},t.src=e,Pt}const r=e.nodeName||"";if("img"===r.toLowerCase())return wt(e,i,n),Pt;if("canvas"===r.toLowerCase()){const t=new Image;return t.onload=()=>console.log(...wt(t,i,n)),t.src=e.toDataURL(),Pt}return Pt}({image:n,message:r,scale:s}):function(t){let{image:e,message:i="",scale:n=1}=t,r=null;try{r=module.require("asciify-image")}catch(t){}if(r)return()=>r(e,{fit:"box",width:"".concat(Math.round(80*n),"%")}).then((t=>console.log(t)));return Pt}({image:n,message:r,scale:s}):Pt}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||Pt)}group(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1};const n=Bt({logLevel:t,message:e,opts:i}),{collapsed:r}=i;return n.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.group(t,e,Object.assign({},i,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||Pt)}withGroup(t,e,i){this.group(t,e)();try{i()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=Rt(t)}_getLogFunction(t,e,i,n,r){if(this._shouldLog(t)){r=Bt({logLevel:t,message:e,args:n,opts:r}),At(i=i||r.method),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=Et();const s=r.tag||r.message;if(r.once){if(It[s])return Pt;It[s]=Et()}return e=function(t,e,i){if("string"==typeof e){const o=i.time?function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;const i=Math.max(e-t.length,0);return"".concat(" ".repeat(i)).concat(t)}(function(t){let e;return e=t<10?"".concat(t.toFixed(2),"ms"):t<100?"".concat(t.toFixed(1),"ms"):t<1e3?"".concat(t.toFixed(0),"ms"):"".concat((t/1e3).toFixed(2),"s"),e}(i.total)):"";e=i.time?"".concat(t,": ").concat(o,"  ").concat(e):"".concat(t,": ").concat(e),n=e,r=i.color,s=i.background,vt||"string"!=typeof n||(r&&(r=Tt(r),n="[".concat(r,"m").concat(n,"[39m")),s&&(r=Tt(s),n="[".concat(s+10,"m").concat(n,"[49m"))),e=n}var n,r,s;return e}(this.id,r.message,r),i.bind(console,e,...r.args)}return Pt}}function Rt(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return At(Number.isFinite(e)&&e>=0),e}function Bt(t){const{logLevel:e,message:i}=t;t.logLevel=Rt(e);const n=t.args?Array.from(t.args):[];for(;n.length&&n.shift()!==i;);switch(typeof e){case"string":case"function":void 0!==i&&n.unshift(i),t.message=e;break;case"object":Object.assign(t,e)}"function"==typeof t.message&&(t.message=t.message());const r=typeof t.message;return At("string"===r||"object"===r),Object.assign(t,{args:n},t.opts)}function Nt(t){for(const e in t)for(const i in t[e])return i||"untitled";return"empty"}b(Lt,"VERSION",Mt);const Ft=new Lt({id:"loaders.gl"});class Ut{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}const Gt={fetch:null,mimeType:void 0,nothrow:!1,log:new class{constructor(){b(this,"console",void 0),this.console=console}log(...t){return this.console.log.bind(this.console,...t)}info(...t){return this.console.info.bind(this.console,...t)}warn(...t){return this.console.warn.bind(this.console,...t)}error(...t){return this.console.error.bind(this.console,...t)}},CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},zt={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function kt(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const jt=()=>{const t=kt();return t.globalOptions=t.globalOptions||{...Gt},t.globalOptions};function Ht(t,e,i,n){return i=i||[],function(t,e){Wt(t,null,Gt,zt,e);for(const i of e){const n=t&&t[i.id]||{},r=i.options&&i.options[i.id]||{},s=i.deprecatedOptions&&i.deprecatedOptions[i.id]||{};Wt(n,i.id,r,s,e)}}(t,i=Array.isArray(i)?i:[i]),function(t,e,i){const n={...t.options||{}};(function(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)})(n,i),null===n.log&&(n.log=new Ut);return Jt(n,jt()),Jt(n,e),n}(e,t,n)}function Vt(t,e){const i=jt(),n=t||i;return"function"==typeof n.fetch?n.fetch:nt(n.fetch)?t=>gt(t,n):null!=e&&e.fetch?null==e?void 0:e.fetch:gt}function Wt(t,e,i,n,r){const s=e||"Top level",o=e?"".concat(e,"."):"";for(const a in t){const l=!e&&nt(t[a]),c="baseUri"===a&&!e,h="workerUrl"===a&&e;if(!(a in i)&&!c&&!h)if(a in n)Ft.warn("".concat(s," loader option '").concat(o).concat(a,"' no longer supported, use '").concat(n[a],"'"))();else if(!l){const t=qt(a,r);Ft.warn("".concat(s," loader option '").concat(o).concat(a,"' not recognized. ").concat(t))()}}}function qt(t,e){const i=t.toLowerCase();let n="";for(const r of e)for(const e in r.options){if(t===e)return"Did you mean '".concat(r.id,".").concat(e,"'?");const s=e.toLowerCase();(i.startsWith(s)||s.startsWith(i))&&(n=n||"Did you mean '".concat(r.id,".").concat(e,"'?"))}return n}function Jt(t,e){for(const i in e)if(i in e){const n=e[i];rt(n)&&rt(t[i])?t[i]={...t[i],...e[i]}:t[i]=e[i]}}function Xt(t){var e;if(!t)return!1;Array.isArray(t)&&(t=t[0]);return Array.isArray(null===(e=t)||void 0===e?void 0:e.extensions)}function Yt(t){var e,i;let n;return d(t,"null loader"),d(Xt(t),"invalid loader"),Array.isArray(t)&&(n=t[1],t=t[0],t={...t,options:{...t.options,...n}}),(null!==(e=t)&&void 0!==e&&e.parseTextSync||null!==(i=t)&&void 0!==i&&i.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}function Zt(){return(()=>{const t=kt();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry})()}const Kt=/\.([^.]+)$/;function Qt(t,e=[],i,n){if(!$t(t))return null;if(e&&!Array.isArray(e))return Yt(e);let r=[];e&&(r=r.concat(e)),null!=i&&i.ignoreRegisteredLoaders||r.push(...Zt()),function(t){for(const e of t)Yt(e)}(r);const s=function(t,e,i,n){const{url:r,type:s}=pt(t),o=r||(null==n?void 0:n.url);let a=null;null!=i&&i.mimeType&&(a=ee(e,null==i?void 0:i.mimeType));return a=a||function(t,e){const i=e&&Kt.exec(e),n=i&&i[1];return n?function(t,e){e=e.toLowerCase();for(const i of t)for(const t of i.extensions)if(t.toLowerCase()===e)return i;return null}(t,n):null}(e,o),a=a||ee(e,s),a=a||function(t,e){if(!e)return null;for(const i of t)if("string"==typeof e){if(ie(e,i))return i}else if(ArrayBuffer.isView(e)){if(ne(e.buffer,e.byteOffset,i))return i}else if(e instanceof ArrayBuffer){if(ne(e,0,i))return i}return null}(e,t),a=a||ee(e,null==i?void 0:i.fallbackMimeType),a}(t,r,i,n);if(!(s||null!=i&&i.nothrow))throw new Error(te(t));return s}function $t(t){return!(t instanceof Response&&204===t.status)}function te(t){const{url:e,type:i}=pt(t);let n="No valid loader found (";n+=e?"".concat(function(t){const e=t&&t.lastIndexOf("/");return e>=0?t.substr(e+1):""}(e),", "):"no url provided, ",n+="MIME type: ".concat(i?'"'.concat(i,'"'):"not provided",", ");const r=t?function(t,e=5){if("string"==typeof t)return t.slice(0,e);if(ArrayBuffer.isView(t))return re(t.buffer,t.byteOffset,e);if(t instanceof ArrayBuffer){return re(t,0,e)}return""}(t):"";return n+=r?' first bytes: "'.concat(r,'"'):"first bytes: not available",n+=")",n}function ee(t,e){for(const i of t){if(i.mimeTypes&&i.mimeTypes.includes(e))return i;if(e==="application/x.".concat(i.id))return i}return null}function ie(t,e){if(e.testText)return e.testText(t);return(Array.isArray(e.tests)?e.tests:[e.tests]).some((e=>t.startsWith(e)))}function ne(t,e,i){return(Array.isArray(i.tests)?i.tests:[i.tests]).some((n=>function(t,e,i,n){if(n instanceof ArrayBuffer)return function(t,e,i){if(i=i||t.byteLength,t.byteLength<i||e.byteLength<i)return!1;const n=new Uint8Array(t),r=new Uint8Array(e);for(let t=0;t<n.length;++t)if(n[t]!==r[t])return!1;return!0}(n,t,n.byteLength);switch(typeof n){case"function":return n(t,i);case"string":return n===re(t,e,n.length);default:return!1}}(t,e,i,n)))}function re(t,e,i){if(t.byteLength<e+i)return"";const n=new DataView(t);let r="";for(let t=0;t<i;t++)r+=String.fromCharCode(n.getUint8(e+t));return r}const se=262144;function oe(t,e){return p?async function*(t,e){const i=t.getReader();let n;try{for(;;){const t=n||i.read();null!=e&&e._streamReadAhead&&(n=i.read());const{done:r,value:s}=await t;if(r)return;yield V(s)}}catch(t){i.releaseLock()}}(t,e):async function*(t,e){for await(const e of t)yield V(e)}(t)}function ae(t,e){if("string"==typeof t)return function*(t,e){const i=(null==e?void 0:e.chunkSize)||262144;let n=0;const r=new TextEncoder;for(;n<t.length;){const e=Math.min(t.length-n,i),s=t.slice(n,n+e);n+=e,yield r.encode(s)}}(t,e);if(t instanceof ArrayBuffer)return function*(t,e={}){const{chunkSize:i=se}=e;let n=0;for(;n<t.byteLength;){const e=Math.min(t.byteLength-n,i),r=new ArrayBuffer(e),s=new Uint8Array(t,n,e);new Uint8Array(r).set(s),n+=e,yield r}}(t,e);if(ot(t))return async function*(t,e){const i=(null==e?void 0:e.chunkSize)||1048576;let n=0;for(;n<t.size;){const e=n+i,r=await t.slice(n,e).arrayBuffer();n=e,yield r}}(t,e);if(at(t))return oe(t,e);if(st(t)){return oe(t.body,e)}throw new Error("makeIterator")}const le="Cannot convert supplied data type";async function ce(t,e,i){const n=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if("string"==typeof t||n)return function(t,e,i){if(e.text&&"string"==typeof t)return t;var n;if((n=t)&&"object"==typeof n&&n.isBuffer&&(t=t.buffer),t instanceof ArrayBuffer){const i=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let i=t.buffer;const n=t.byteLength||t.length;return 0===t.byteOffset&&n===i.byteLength||(i=i.slice(t.byteOffset,t.byteOffset+n)),i}throw new Error(le)}(t,e);if(ot(t)&&(t=await mt(t)),st(t)){const i=t;return await async function(t){if(!t.ok){const e=await async function(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const i=t.headers.get("Content-Type");let n=t.statusText;i.includes("application/json")&&(n+=" ".concat(await t.text())),e+=n,e=e.length>60?"".concat(e.slice(60),"..."):e}catch(t){}return e}(t);throw new Error(e)}}(i),e.binary?await i.arrayBuffer():await i.text()}if(at(t)&&(t=ae(t,i)),(r=t)&&"function"==typeof r[Symbol.iterator]||(t=>t&&"function"==typeof t[Symbol.asyncIterator])(t))return X(t);var r;throw new Error(le)}async function he(t,e,i,n){m(!n||"object"==typeof n),!e||Array.isArray(e)||Xt(e)||(n=void 0,i=e,e=void 0),t=await t,i=i||{};const{url:r}=pt(t),s=function(t,e){if(!e&&t&&!Array.isArray(t))return t;let i;if(t&&(i=Array.isArray(t)?t:[t]),e&&e.loaders){const t=Array.isArray(e.loaders)?e.loaders:[e.loaders];i=i?[...i,...t]:t}return i&&i.length?i:null}(e,n),o=await async function(t,e=[],i,n){if(!$t(t))return null;let r=Qt(t,e,{...i,nothrow:!0},n);if(r)return r;if(ot(t)&&(r=Qt(t=await t.slice(0,10).arrayBuffer(),e,i,n)),!(r||null!=i&&i.nothrow))throw new Error(te(t));return r}(t,s,i);return o?(n=function(t,e,i=null){if(i)return i;const n={fetch:Vt(e,t),...t};return Array.isArray(n.loaders)||(n.loaders=null),n}({url:r,parse:he,loaders:s},i=Ht(i,o,s,r),n),await async function(t,e,i,n){if(function(t,e="3.1.4"){m(t,"no worker provided");const i=t.version}(t),e=await ce(e,t,i),t.parseTextSync&&"string"==typeof e)return i.dataType="text",t.parseTextSync(e,i,n,t);if(function(t,e){return!!L.isSupported()&&t.worker&&(null==e?void 0:e.worker)}(t,i))return await G(t,e,i,0,he);if(t.parseText&&"string"==typeof e)return await t.parseText(e,i,n,t);if(t.parse)return await t.parse(e,i,n,t);throw m(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}(o,t,i,n)):null}async function ue(t,e,i,n){Array.isArray(e)||Xt(e)||(i=e,e=void 0);const r=Vt(i);let s=t;return"string"==typeof t&&(s=await r(t)),ot(t)&&(s=await r(t)),await he(s,e,i)}function de(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const pe=1/Math.PI*180,fe=1/180*Math.PI,me={};function ge(t,{precision:e=me.precision||4}={}){return t=function(t){return Math.round(t/me.EPSILON)*me.EPSILON}(t),"".concat(parseFloat(t.toPrecision(e)))}function ve(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function ye(t,e,i){if(ve(t)){i=i||((n=t).clone?n.clone():new Array(n.length));for(let n=0;n<i.length&&n<t.length;++n)i[n]=e(t[n],n,i);return i}var n;return e(t)}function _e(t){return function(t,e){return ye(t,(t=>t*fe),e)}(t)}function xe(t){return Me(t)}function Me(t,e){return ye(t,(t=>t*pe),e)}function be(t,e,i){const n=me.EPSILON;i&&(me.EPSILON=i);try{if(t===e)return!0;if(ve(t)&&ve(e)){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(!be(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):!(!Number.isFinite(t)||!Number.isFinite(e))&&Math.abs(t-e)<=me.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}finally{me.EPSILON=n}}me.EPSILON=1e-12,me.debug=!1,me.precision=4,me.printTypes=!1,me.printDegrees=!1,me.printRowMajor=!0;class we extends(function(t){function e(){var e=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}(Array)){get ELEMENTS(){return de(!1),0}clone(){return(new this.constructor).copy(this)}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}fromArray(t,e=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=t[i+e];return this.check()}to(t){return t===this?this:ve(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toArray(t=[],e=0){for(let i=0;i<this.ELEMENTS;++i)t[e+i]=this[i];return t}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(me)}formatString(t){let e="";for(let i=0;i<this.ELEMENTS;++i)e+=(i>0?", ":"")+ge(this[i],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!be(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,i){void 0===i&&(i=e,e=t,t=this);for(let n=0;n<this.ELEMENTS;++n){const r=t[n];this[n]=r+i*(e[n]-r)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],t[i]),e[i]);return this.check()}add(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]+=e[t];return this.check()}subtract(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]-=e[t];return this.check()}scale(t){if(Array.isArray(t))return this.multiply(t);for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.scale(1/t)}clampScalar(t,e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],t),e);return this.check()}multiplyByScalar(t){return this.scale(t)}get elements(){return this}check(){if(me.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}}function Se(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function Te(t,e,i=""){if(me.debug&&!function(t,e){if(t.length!==e)return!1;for(let e=0;e<t.length;++e)if(!Number.isFinite(t[e]))return!1;return!0}(t,e))throw new Error("math.gl: ".concat(i," some fields set to invalid numbers'"));return t}const Ae={};function Ee(t,e){Ae[t]||(Ae[t]=!0,"".concat(t," has been removed in version ").concat(e,", see upgrade guide for more information"))}class Ce extends we{get ELEMENTS(){return de(!1),0}copy(t){return de(!1),this}get x(){return this[0]}set x(t){this[0]=Se(t)}get y(){return this[1]}set y(t){this[1]=Se(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let i=0;i<this.ELEMENTS;++i){const n=this[i]-t[i];e+=n*n}return Se(e)}dot(t){let e=0;for(let i=0;i<this.ELEMENTS;++i)e+=this[i]*t[i];return Se(e)}normalize(){const t=this.magnitude();if(0!==t)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e[t];return this.check()}divide(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e[t];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return de(t>=0&&t<this.ELEMENTS,"index is out of range"),Se(this[t])}setComponent(t,e){return de(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}var Oe,Pe=1e-6,Ie="undefined"!=typeof Float32Array?Float32Array:Array;function De(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[3]*r+i[6],t[1]=i[1]*n+i[4]*r+i[7],t}function Le(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[4]*r+i[12],t[1]=i[1]*n+i[5]*r+i[13],t}function Re(t,e,i){const n=e[0],r=e[1],s=i[3]*n+i[7]*r||1;return t[0]=(i[0]*n+i[4]*r)/s,t[1]=(i[1]*n+i[5]*r)/s,t}function Be(t,e,i){const n=e[0],r=e[1],s=e[2],o=i[3]*n+i[7]*r+i[11]*s||1;return t[0]=(i[0]*n+i[4]*r+i[8]*s)/o,t[1]=(i[1]*n+i[5]*r+i[9]*s)/o,t[2]=(i[2]*n+i[6]*r+i[10]*s)/o,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),Oe=new Ie(2),Ie!=Float32Array&&(Oe[0]=0,Oe[1]=0);class Ne extends Ce{constructor(t=0,e=0){super(2),ve(t)&&1===arguments.length?this.copy(t):(me.debug&&(Se(t),Se(e)),this[0]=t,this[1]=e)}set(t,e){return this[0]=t,this[1]=e,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this.check()}fromObject(t){return me.debug&&(Se(t.x),Se(t.y)),this[0]=t.x,this[1]=t.y,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return Le(this,this,t),this.check()}transformAsVector(t){return Re(this,this,t),this.check()}transformByMatrix3(t){return De(this,this,t),this.check()}transformByMatrix2x3(t){return function(t,e,i){var n=e[0],r=e[1];t[0]=i[0]*n+i[2]*r+i[4],t[1]=i[1]*n+i[3]*r+i[5]}(this,this,t),this.check()}transformByMatrix2(t){return function(t,e,i){var n=e[0],r=e[1];t[0]=i[0]*n+i[2]*r,t[1]=i[1]*n+i[3]*r}(this,this,t),this.check()}}function Fe(){var t=new Ie(3);return Ie!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Ue(t){var e=t[0],i=t[1],n=t[2];return Math.hypot(e,i,n)}function Ge(t,e,i){var n=new Ie(3);return n[0]=t,n[1]=e,n[2]=i,n}function ze(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ke(t,e,i){var n=e[0],r=e[1],s=e[2],o=i[0],a=i[1],l=i[2];return t[0]=r*l-s*a,t[1]=s*o-n*l,t[2]=n*a-r*o,t}function je(t,e,i){var n=e[0],r=e[1],s=e[2],o=i[3]*n+i[7]*r+i[11]*s+i[15];return o=o||1,t[0]=(i[0]*n+i[4]*r+i[8]*s+i[12])/o,t[1]=(i[1]*n+i[5]*r+i[9]*s+i[13])/o,t[2]=(i[2]*n+i[6]*r+i[10]*s+i[14])/o,t}function He(t,e,i){var n=e[0],r=e[1],s=e[2];return t[0]=n*i[0]+r*i[3]+s*i[6],t[1]=n*i[1]+r*i[4]+s*i[7],t[2]=n*i[2]+r*i[5]+s*i[8],t}var Ve=Ue;!function(){var t=Fe()}();const We=[0,0,0],qe={};class Je extends Ce{static get ZERO(){return qe.ZERO=qe.ZERO||Object.freeze(new Je(0,0,0,0))}constructor(t=0,e=0,i=0){super(-0,-0,-0),1===arguments.length&&ve(t)?this.copy(t):(me.debug&&(Se(t),Se(e),Se(i)),this[0]=t,this[1]=e,this[2]=i)}set(t,e,i){return this[0]=t,this[1]=e,this[2]=i,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return me.debug&&(Se(t.x),Se(t.y),Se(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=Se(t)}angle(t){return function(t,e){var i=t[0],n=t[1],r=t[2],s=e[0],o=e[1],a=e[2],l=Math.sqrt(i*i+n*n+r*r)*Math.sqrt(s*s+o*o+a*a),c=l&&ze(t,e)/l;return Math.acos(Math.min(Math.max(c,-1),1))}(this,t)}cross(t){return ke(this,this,t),this.check()}rotateX({radians:t,origin:e=We}){return function(t,e,i,n){var r=[],s=[];r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],s[0]=r[0],s[1]=r[1]*Math.cos(n)-r[2]*Math.sin(n),s[2]=r[1]*Math.sin(n)+r[2]*Math.cos(n),t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2]}(this,this,e,t),this.check()}rotateY({radians:t,origin:e=We}){return function(t,e,i,n){var r=[],s=[];r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],s[0]=r[2]*Math.sin(n)+r[0]*Math.cos(n),s[1]=r[1],s[2]=r[2]*Math.cos(n)-r[0]*Math.sin(n),t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2]}(this,this,e,t),this.check()}rotateZ({radians:t,origin:e=We}){return function(t,e,i,n){var r=[],s=[];r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],s[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n),s[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n),s[2]=r[2],t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2]}(this,this,e,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return je(this,this,t),this.check()}transformAsVector(t){return Be(this,this,t),this.check()}transformByMatrix3(t){return He(this,this,t),this.check()}transformByMatrix2(t){return function(t,e,i){const n=e[0],r=e[1];t[0]=i[0]*n+i[2]*r,t[1]=i[1]*n+i[3]*r,t[2]=e[2]}(this,this,t),this.check()}transformByQuaternion(t){return function(t,e,i){var n=i[0],r=i[1],s=i[2],o=i[3],a=e[0],l=e[1],c=e[2],h=r*c-s*l,u=s*a-n*c,d=n*l-r*a,p=r*d-s*u,f=s*h-n*d,m=n*u-r*h,g=2*o;h*=g,u*=g,d*=g,p*=2,f*=2,m*=2,t[0]=a+h+p,t[1]=l+u+f,t[2]=c+d+m}(this,this,t),this.check()}}class Xe extends we{get ELEMENTS(){return de(!1),0}get RANK(){return de(!1),0}toString(){let t="[";if(me.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let i=0;i<this.RANK;++i)t+=" ".concat(this[i*this.RANK+e])}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=" ".concat(this[e])}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,i){return this[e*this.RANK+t]=Se(i),this}getColumn(t,e=new Array(this.RANK).fill(-0)){const i=t*this.RANK;for(let t=0;t<this.RANK;++t)e[t]=this[i+t];return e}setColumn(t,e){const i=t*this.RANK;for(let t=0;t<this.RANK;++t)this[i+t]=e[t];return this}}function Ye(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],u=e[8],d=i[0],p=i[1],f=i[2],m=i[3],g=i[4],v=i[5],y=i[6],_=i[7],x=i[8];return t[0]=d*n+p*o+f*c,t[1]=d*r+p*a+f*h,t[2]=d*s+p*l+f*u,t[3]=m*n+g*o+v*c,t[4]=m*r+g*a+v*h,t[5]=m*s+g*l+v*u,t[6]=y*n+_*o+x*c,t[7]=y*r+_*a+x*h,t[8]=y*s+_*l+x*u,t}function Ze(t,e,i){var n=i[0],r=i[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}const Ke=Object.freeze([1,0,0,0,1,0,0,0,1]),Qe=Object.freeze([0,0,0,0,0,0,0,0,0]),$e=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL1ROW0:3,COL1ROW1:4,COL1ROW2:5,COL2ROW0:6,COL2ROW1:7,COL2ROW2:8}),ti={};class ei extends Xe{static get IDENTITY(){return ti.IDENTITY=ti.IDENTITY||Object.freeze(new ei(Ke)),ti.IDENTITY}static get ZERO(){return ti.ZERO=ti.ZERO||Object.freeze(new ei(Qe)),ti.ZERO}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return $e}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}set(t,e,i,n,r,s,o,a,l){return this[0]=t,this[1]=e,this[2]=i,this[3]=n,this[4]=r,this[5]=s,this[6]=o,this[7]=a,this[8]=l,this.check()}setRowMajor(t,e,i,n,r,s,o,a,l){return this[0]=t,this[1]=n,this[2]=o,this[3]=e,this[4]=r,this[5]=a,this[6]=i,this[7]=s,this[8]=l,this.check()}determinant(){return function(t){var e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*s-o*l)+i*(-c*r+o*a)+n*(l*r-s*a)}(this)}identity(){return this.copy(Ke)}fromQuaternion(t){return function(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=i+i,a=n+n,l=r+r,c=i*o,h=n*o,u=n*a,d=r*o,p=r*a,f=r*l,m=s*o,g=s*a,v=s*l;t[0]=1-u-f,t[3]=h-v,t[6]=d+g,t[1]=h+v,t[4]=1-c-f,t[7]=p-m,t[2]=d-g,t[5]=p+m,t[8]=1-c-u}(this,t),this.check()}transpose(){return function(t,e){if(t===e){var i=e[1],n=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=n,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8]}(this,this),this.check()}invert(){return function(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],u=h*o-a*c,d=-h*s+a*l,p=c*s-o*l,f=i*u+n*d+r*p;f&&(f=1/f,t[0]=u*f,t[1]=(-h*n+r*c)*f,t[2]=(a*n-r*o)*f,t[3]=d*f,t[4]=(h*i-r*l)*f,t[5]=(-a*i+r*s)*f,t[6]=p*f,t[7]=(-c*i+n*l)*f,t[8]=(o*i-n*s)*f)}(this,this),this.check()}multiplyLeft(t){return Ye(this,t,this),this.check()}multiplyRight(t){return Ye(this,this,t),this.check()}rotate(t){return function(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],u=e[8],d=Math.sin(i),p=Math.cos(i);t[0]=p*n+d*o,t[1]=p*r+d*a,t[2]=p*s+d*l,t[3]=p*o-d*n,t[4]=p*a-d*r,t[5]=p*l-d*s,t[6]=c,t[7]=h,t[8]=u}(this,this,t),this.check()}scale(t){return Array.isArray(t)?Ze(this,this,t):Ze(this,this,[t,t,t]),this.check()}translate(t){return function(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],u=e[8],d=i[0],p=i[1];t[0]=n,t[1]=r,t[2]=s,t[3]=o,t[4]=a,t[5]=l,t[6]=d*n+p*o+c,t[7]=d*r+p*a+h,t[8]=d*s+p*l+u}(this,this,t),this.check()}transform(t,e){switch(t.length){case 2:e=De(e||[-0,-0],t,this);break;case 3:e=He(e||[-0,-0,-0],t,this);break;case 4:e=function(t,e,i){const n=e[0],r=e[1],s=e[2];return t[0]=i[0]*n+i[3]*r+i[6]*s,t[1]=i[1]*n+i[4]*r+i[7]*s,t[2]=i[2]*n+i[5]*r+i[8]*s,t[3]=e[3],t}(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Te(e,t.length),e}transformVector(t,e){return Ee("Matrix3.transformVector"),this.transform(t,e)}transformVector2(t,e){return Ee("Matrix3.transformVector"),this.transform(t,e)}transformVector3(t,e){return Ee("Matrix3.transformVector"),this.transform(t,e)}}function ii(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],u=e[8],d=e[9],p=e[10],f=e[11],m=e[12],g=e[13],v=e[14],y=e[15],_=i[0],x=i[1],M=i[2],b=i[3];return t[0]=_*n+x*a+M*u+b*m,t[1]=_*r+x*l+M*d+b*g,t[2]=_*s+x*c+M*p+b*v,t[3]=_*o+x*h+M*f+b*y,_=i[4],x=i[5],M=i[6],b=i[7],t[4]=_*n+x*a+M*u+b*m,t[5]=_*r+x*l+M*d+b*g,t[6]=_*s+x*c+M*p+b*v,t[7]=_*o+x*h+M*f+b*y,_=i[8],x=i[9],M=i[10],b=i[11],t[8]=_*n+x*a+M*u+b*m,t[9]=_*r+x*l+M*d+b*g,t[10]=_*s+x*c+M*p+b*v,t[11]=_*o+x*h+M*f+b*y,_=i[12],x=i[13],M=i[14],b=i[15],t[12]=_*n+x*a+M*u+b*m,t[13]=_*r+x*l+M*d+b*g,t[14]=_*s+x*c+M*p+b*v,t[15]=_*o+x*h+M*f+b*y,t}function ni(t,e,i){var n=i[0],r=i[1],s=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}!function(){var t=function(){var t=new Ie(4);return Ie!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}()}();const ri=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),si=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),oi=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL0ROW3:3,COL1ROW0:4,COL1ROW1:5,COL1ROW2:6,COL1ROW3:7,COL2ROW0:8,COL2ROW1:9,COL2ROW2:10,COL2ROW3:11,COL3ROW0:12,COL3ROW1:13,COL3ROW2:14,COL3ROW3:15}),ai={};class li extends Xe{static get IDENTITY(){return ai.IDENTITY=ai.IDENTITY||Object.freeze(new li(ri)),ai.IDENTITY}static get ZERO(){return ai.ZERO=ai.ZERO||Object.freeze(new li(si)),ai.ZERO}get INDICES(){return oi}get ELEMENTS(){return 16}get RANK(){return 4}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,i,n,r,s,o,a,l,c,h,u,d,p,f,m){return this[0]=t,this[1]=e,this[2]=i,this[3]=n,this[4]=r,this[5]=s,this[6]=o,this[7]=a,this[8]=l,this[9]=c,this[10]=h,this[11]=u,this[12]=d,this[13]=p,this[14]=f,this[15]=m,this.check()}setRowMajor(t,e,i,n,r,s,o,a,l,c,h,u,d,p,f,m){return this[0]=t,this[1]=r,this[2]=l,this[3]=d,this[4]=e,this[5]=s,this[6]=c,this[7]=p,this[8]=i,this[9]=o,this[10]=h,this[11]=f,this[12]=n,this[13]=a,this[14]=u,this[15]=m,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(ri)}fromQuaternion(t){return function(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=i+i,a=n+n,l=r+r,c=i*o,h=n*o,u=n*a,d=r*o,p=r*a,f=r*l,m=s*o,g=s*a,v=s*l;t[0]=1-u-f,t[1]=h+v,t[2]=d-g,t[3]=0,t[4]=h-v,t[5]=1-c-f,t[6]=p+m,t[7]=0,t[8]=d+g,t[9]=p-m,t[10]=1-c-u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this,t),this.check()}frustum({left:t,right:e,bottom:i,top:n,near:r,far:s}){return s===1/0?li._computeInfinitePerspectiveOffCenter(this,t,e,i,n,r):function(t,e,i,n,r,s,o){var a=1/(i-e),l=1/(r-n),c=1/(s-o);t[0]=2*s*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*l,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(r+n)*l,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0}(this,t,e,i,n,r,s),this.check()}static _computeInfinitePerspectiveOffCenter(t,e,i,n,r,s){const o=2*s/(i-e),a=2*s/(r-n),l=(i+e)/(i-e),c=(r+n)/(r-n),h=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=l,t[9]=c,t[10]=-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=h,t[15]=0,t}lookAt(t,e,i){return 1===arguments.length&&({eye:t,center:e,up:i}=t),function(t,e,i,n){var r,s,o,a,l,c,h,u,d,p,f=e[0],m=e[1],g=e[2],v=n[0],y=n[1],_=n[2],x=i[0],M=i[1],b=i[2];Math.abs(f-x)<Pe&&Math.abs(m-M)<Pe&&Math.abs(g-b)<Pe?function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(t):(h=f-x,u=m-M,d=g-b,r=y*(d*=p=1/Math.hypot(h,u,d))-_*(u*=p),s=_*(h*=p)-v*d,o=v*u-y*h,(p=Math.hypot(r,s,o))?(r*=p=1/p,s*=p,o*=p):(r=0,s=0,o=0),a=u*o-d*s,l=d*r-h*o,c=h*s-u*r,(p=Math.hypot(a,l,c))?(a*=p=1/p,l*=p,c*=p):(a=0,l=0,c=0),t[0]=r,t[1]=a,t[2]=h,t[3]=0,t[4]=s,t[5]=l,t[6]=u,t[7]=0,t[8]=o,t[9]=c,t[10]=d,t[11]=0,t[12]=-(r*f+s*m+o*g),t[13]=-(a*f+l*m+c*g),t[14]=-(h*f+u*m+d*g),t[15]=1)}(this,t,e=e||[0,0,0],i=i||[0,1,0]),this.check()}ortho({left:t,right:e,bottom:i,top:n,near:r=.1,far:s=500}){return function(t,e,i,n,r,s,o){var a=1/(e-i),l=1/(n-r),c=1/(s-o);t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(r+n)*l,t[14]=(o+s)*c,t[15]=1}(this,t,e,i,n,r,s),this.check()}orthographic({fovy:t=45*Math.PI/180,aspect:e=1,focalDistance:i=1,near:n=.1,far:r=500}){if(t>2*Math.PI)throw Error("radians");const s=t/2,o=i*Math.tan(s),a=o*e;return(new li).ortho({left:-a,right:a,bottom:-o,top:o,near:n,far:r})}perspective({fovy:t,fov:e=45*Math.PI/180,aspect:i=1,near:n=.1,far:r=500}={}){if((t=t||e)>2*Math.PI)throw Error("radians");return function(t,e,i,n,r){var s,o=1/Math.tan(e/2);t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(s=1/(n-r),t[10]=(r+n)*s,t[14]=2*r*n*s):(t[10]=-1,t[14]=-2*n)}(this,t,i,n,r),this.check()}determinant(){return function(t){var e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],u=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15];return(e*o-i*s)*(u*g-d*m)-(e*a-n*s)*(h*g-d*f)+(e*l-r*s)*(h*m-u*f)+(i*a-n*o)*(c*g-d*p)-(i*l-r*o)*(c*m-u*p)+(n*l-r*a)*(c*f-h*p)}(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t=[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=null){const i=this.getScale(e||[-0,-0,-0]),n=1/i[0],r=1/i[1],s=1/i[2];return t[0]=this[0]*n,t[1]=this[1]*r,t[2]=this[2]*s,t[3]=0,t[4]=this[4]*n,t[5]=this[5]*r,t[6]=this[6]*s,t[7]=0,t[8]=this[8]*n,t[9]=this[9]*r,t[10]=this[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t=[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=null){const i=this.getScale(e||[-0,-0,-0]),n=1/i[0],r=1/i[1],s=1/i[2];return t[0]=this[0]*n,t[1]=this[1]*r,t[2]=this[2]*s,t[3]=this[4]*n,t[4]=this[5]*r,t[5]=this[6]*s,t[6]=this[8]*n,t[7]=this[9]*r,t[8]=this[10]*s,t}transpose(){return function(t,e){if(t===e){var i=e[1],n=e[2],r=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=s,t[11]=e[14],t[12]=r,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15]}(this,this),this.check()}invert(){return function(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],u=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],v=e[15],y=i*a-n*o,_=i*l-r*o,x=i*c-s*o,M=n*l-r*a,b=n*c-s*a,w=r*c-s*l,S=h*m-u*f,T=h*g-d*f,A=h*v-p*f,E=u*g-d*m,C=u*v-p*m,O=d*v-p*g,P=y*O-_*C+x*E+M*A-b*T+w*S;P&&(P=1/P,t[0]=(a*O-l*C+c*E)*P,t[1]=(r*C-n*O-s*E)*P,t[2]=(m*w-g*b+v*M)*P,t[3]=(d*b-u*w-p*M)*P,t[4]=(l*A-o*O-c*T)*P,t[5]=(i*O-r*A+s*T)*P,t[6]=(g*x-f*w-v*_)*P,t[7]=(h*w-d*x+p*_)*P,t[8]=(o*C-a*A+c*S)*P,t[9]=(n*A-i*C-s*S)*P,t[10]=(f*b-m*x+v*y)*P,t[11]=(u*x-h*b-p*y)*P,t[12]=(a*T-o*E-l*S)*P,t[13]=(i*E-n*T+r*S)*P,t[14]=(m*_-f*M-g*y)*P,t[15]=(h*M-u*_+d*y)*P)}(this,this),this.check()}multiplyLeft(t){return ii(this,t,this),this.check()}multiplyRight(t){return ii(this,this,t),this.check()}rotateX(t){return function(t,e,i){var n=Math.sin(i),r=Math.cos(i),s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],u=e[10],d=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*r+c*n,t[5]=o*r+h*n,t[6]=a*r+u*n,t[7]=l*r+d*n,t[8]=c*r-s*n,t[9]=h*r-o*n,t[10]=u*r-a*n,t[11]=d*r-l*n}(this,this,t),this.check()}rotateY(t){return function(t,e,i){var n=Math.sin(i),r=Math.cos(i),s=e[0],o=e[1],a=e[2],l=e[3],c=e[8],h=e[9],u=e[10],d=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r-c*n,t[1]=o*r-h*n,t[2]=a*r-u*n,t[3]=l*r-d*n,t[8]=s*n+c*r,t[9]=o*n+h*r,t[10]=a*n+u*r,t[11]=l*n+d*r}(this,this,t),this.check()}rotateZ(t){return function(t,e,i){var n=Math.sin(i),r=Math.cos(i),s=e[0],o=e[1],a=e[2],l=e[3],c=e[4],h=e[5],u=e[6],d=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r+c*n,t[1]=o*r+h*n,t[2]=a*r+u*n,t[3]=l*r+d*n,t[4]=c*r-s*n,t[5]=h*r-o*n,t[6]=u*r-a*n,t[7]=d*r-l*n}(this,this,t),this.check()}rotateXYZ([t,e,i]){return this.rotateX(t).rotateY(e).rotateZ(i)}rotateAxis(t,e){return function(t,e,i,n){var r,s,o,a,l,c,h,u,d,p,f,m,g,v,y,_,x,M,b,w,S,T,A,E,C=n[0],O=n[1],P=n[2],I=Math.hypot(C,O,P);I<Pe||(C*=I=1/I,O*=I,P*=I,r=Math.sin(i),o=1-(s=Math.cos(i)),a=e[0],l=e[1],c=e[2],h=e[3],u=e[4],d=e[5],p=e[6],f=e[7],m=e[8],g=e[9],v=e[10],y=e[11],_=C*C*o+s,x=O*C*o+P*r,M=P*C*o-O*r,b=C*O*o-P*r,w=O*O*o+s,S=P*O*o+C*r,T=C*P*o+O*r,A=O*P*o-C*r,E=P*P*o+s,t[0]=a*_+u*x+m*M,t[1]=l*_+d*x+g*M,t[2]=c*_+p*x+v*M,t[3]=h*_+f*x+y*M,t[4]=a*b+u*w+m*S,t[5]=l*b+d*w+g*S,t[6]=c*b+p*w+v*S,t[7]=h*b+f*w+y*S,t[8]=a*T+u*A+m*E,t[9]=l*T+d*A+g*E,t[10]=c*T+p*A+v*E,t[11]=h*T+f*A+y*E,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(this,this,t,e),this.check()}scale(t){return Array.isArray(t)?ni(this,this,t):ni(this,this,[t,t,t]),this.check()}translate(t){return function(t,e,i){var n,r,s,o,a,l,c,h,u,d,p,f,m=i[0],g=i[1],v=i[2];e===t?(t[12]=e[0]*m+e[4]*g+e[8]*v+e[12],t[13]=e[1]*m+e[5]*g+e[9]*v+e[13],t[14]=e[2]*m+e[6]*g+e[10]*v+e[14],t[15]=e[3]*m+e[7]*g+e[11]*v+e[15]):(n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],u=e[8],d=e[9],p=e[10],f=e[11],t[0]=n,t[1]=r,t[2]=s,t[3]=o,t[4]=a,t[5]=l,t[6]=c,t[7]=h,t[8]=u,t[9]=d,t[10]=p,t[11]=f,t[12]=n*m+a*g+u*v+e[12],t[13]=r*m+l*g+d*v+e[13],t[14]=s*m+c*g+p*v+e[14],t[15]=o*m+h*g+f*v+e[15])}(this,this,t),this.check()}transform(t,e){return 4===t.length?(e=function(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3];return t[0]=i[0]*n+i[4]*r+i[8]*s+i[12]*o,t[1]=i[1]*n+i[5]*r+i[9]*s+i[13]*o,t[2]=i[2]*n+i[6]*r+i[10]*s+i[14]*o,t[3]=i[3]*n+i[7]*r+i[11]*s+i[15]*o,t}(e||[-0,-0,-0,-0],t,this),Te(e,4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:i}=t;switch(i){case 2:e=Le(e||[-0,-0],t,this);break;case 3:e=je(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Te(e,t.length),e}transformAsVector(t,e){switch(t.length){case 2:e=Re(e||[-0,-0],t,this);break;case 3:e=Be(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Te(e,t.length),e}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,i){return this.identity().translate([t,e,i])}transformPoint(t,e){return Ee("Matrix4.transformPoint","3.0"),this.transformAsPoint(t,e)}transformVector(t,e){return Ee("Matrix4.transformVector","3.0"),this.transformAsPoint(t,e)}transformDirection(t,e){return Ee("Matrix4.transformDirection","3.0"),this.transformAsVector(t,e)}}function ci(){var t=new Ie(4);return Ie!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function hi(t,e,i){i*=.5;var n=Math.sin(i);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(i),t}function ui(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=i[0],l=i[1],c=i[2],h=i[3];return t[0]=n*h+o*a+r*c-s*l,t[1]=r*h+o*l+s*a-n*c,t[2]=s*h+o*c+n*l-r*a,t[3]=o*h-n*a-r*l-s*c,t}function di(t,e,i,n){var r,s,o,a,l,c=e[0],h=e[1],u=e[2],d=e[3],p=i[0],f=i[1],m=i[2],g=i[3];return(s=c*p+h*f+u*m+d*g)<0&&(s=-s,p=-p,f=-f,m=-m,g=-g),1-s>Pe?(r=Math.acos(s),o=Math.sin(r),a=Math.sin((1-n)*r)/o,l=Math.sin(n*r)/o):(a=1-n,l=n),t[0]=a*c+l*p,t[1]=a*h+l*f,t[2]=a*u+l*m,t[3]=a*d+l*g,t}function pi(t,e){var i,n=e[0]+e[4]+e[8];if(n>0)i=Math.sqrt(n+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);var s=(r+1)%3,o=(r+2)%3;i=Math.sqrt(e[3*r+r]-e[3*s+s]-e[3*o+o]+1),t[r]=.5*i,i=.5/i,t[3]=(e[3*s+o]-e[3*o+s])*i,t[s]=(e[3*s+r]+e[3*r+s])*i,t[o]=(e[3*o+r]+e[3*r+o])*i}return t}var fi,mi,gi,vi=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},yi=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},_i=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},xi=function(t,e,i,n){var r=e[0],s=e[1],o=e[2],a=e[3];return t[0]=r+n*(i[0]-r),t[1]=s+n*(i[1]-s),t[2]=o+n*(i[2]-o),t[3]=a+n*(i[3]-a),t},Mi=function(t){var e=t[0],i=t[1],n=t[2],r=t[3];return Math.hypot(e,i,n,r)},bi=function(t){var e=t[0],i=t[1],n=t[2],r=t[3];return e*e+i*i+n*n+r*r},wi=function(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=i*i+n*n+r*r+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=i*o,t[1]=n*o,t[2]=r*o,t[3]=s*o,t},Si=(fi=Fe(),mi=Ge(1,0,0),gi=Ge(0,1,0),function(t,e,i){var n=ze(e,i);return n<-.999999?(ke(fi,mi,e),Ve(fi)<1e-6&&ke(fi,gi,e),function(t,e){var i=e[0],n=e[1],r=e[2],s=i*i+n*n+r*r;s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s}(fi,fi),hi(t,fi,Math.PI),t):n>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(ke(fi,e,i),t[0]=fi[0],t[1]=fi[1],t[2]=fi[2],t[3]=1+n,wi(t,t))});ci(),ci(),function(){var t=new Ie(9);Ie!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1}();const Ti=[0,0,0,1];class Ai extends we{constructor(t=0,e=0,i=0,n=1){super(-0,-0,-0,-0),Array.isArray(t)&&1===arguments.length?this.copy(t):this.set(t,e,i,n)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,e,i,n){return this[0]=t,this[1]=e,this[2]=i,this[3]=n,this.check()}fromMatrix3(t){return pi(this,t),this.check()}identity(){return function(t){t[0]=0,t[1]=0,t[2]=0,t[3]=1}(this),this.check()}fromAxisRotation(t,e){return hi(this,t,e),this.check()}setAxisAngle(t,e){return this.fromAxisRotation(t,e)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=Se(t)}get y(){return this[1]}set y(t){this[1]=Se(t)}get z(){return this[2]}set z(t){this[2]=Se(t)}get w(){return this[3]}set w(t){this[3]=Se(t)}len(){return Mi(this)}lengthSquared(){return bi(this)}dot(t,e){if(void 0!==e)throw new Error("Quaternion.dot only takes one argument");return _i(this,t)}rotationTo(t,e){return Si(this,t,e),this.check()}add(t,e){if(void 0!==e)throw new Error("Quaternion.add only takes one argument");return vi(this,this,t),this.check()}calculateW(){return function(t,e){var i=e[0],n=e[1],r=e[2];t[0]=i,t[1]=n,t[2]=r,t[3]=Math.sqrt(Math.abs(1-i*i-n*n-r*r))}(this,this),this.check()}conjugate(){return function(t,e){t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3]}(this,this),this.check()}invert(){return function(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=i*i+n*n+r*r+s*s,a=o?1/o:0;t[0]=-i*a,t[1]=-n*a,t[2]=-r*a,t[3]=s*a}(this,this),this.check()}lerp(t,e,i){return xi(this,t,e,i),this.check()}multiplyRight(t,e){return de(!e),ui(this,this,t),this.check()}multiplyLeft(t,e){return de(!e),ui(this,t,this),this.check()}normalize(){const t=this.len(),e=t>0?1/t:0;return this[0]=this[0]*e,this[1]=this[1]*e,this[2]=this[2]*e,this[3]=this[3]*e,0===t&&(this[3]=1),this.check()}rotateX(t){return function(t,e,i){i*=.5;var n=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);t[0]=n*l+o*a,t[1]=r*l+s*a,t[2]=s*l-r*a,t[3]=o*l-n*a}(this,this,t),this.check()}rotateY(t){return function(t,e,i){i*=.5;var n=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);t[0]=n*l-s*a,t[1]=r*l+o*a,t[2]=s*l+n*a,t[3]=o*l-r*a}(this,this,t),this.check()}rotateZ(t){return function(t,e,i){i*=.5;var n=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);t[0]=n*l+r*a,t[1]=r*l-n*a,t[2]=s*l+o*a,t[3]=o*l-s*a}(this,this,t),this.check()}scale(t){return yi(this,this,t),this.check()}slerp(t,e,i){switch(arguments.length){case 1:({start:t=Ti,target:e,ratio:i}=arguments[0]);break;case 2:[e,i]=arguments,t=this}return di(this,t,e,i),this.check()}transformVector4(t,e=t){return function(t,e,i){var n=e[0],r=e[1],s=e[2],o=i[0],a=i[1],l=i[2],c=i[3],h=c*n+a*s-l*r,u=c*r+l*n-o*s,d=c*s+o*r-a*n,p=-o*n-a*r-l*s;t[0]=h*c+p*-o+u*-l-d*-a,t[1]=u*c+p*-a+d*-o-h*-l,t[2]=d*c+p*-l+h*-a-u*-o,t[3]=e[3]}(e,t,this),Te(e,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,e){return this.setAxisAngle(t,e)}premultiply(t,e){return this.multiplyLeft(t,e)}multiply(t,e){return this.multiplyRight(t,e)}}var Ei=.1,Ci=1e-12,Oi=1e-15;Math.PI,Math.PI,Math.PI,Math.PI;const Pi=t=>t,Ii=new Je;function Di(t,e=Ii){return function(t,e,i=Pi){return ve(t)?(e[0]=i(t[0]),e[1]=i(t[1]),e[2]=t[2]):"longitude"in t?(e[0]=i(t.longitude),e[1]=i(t.latitude),e[2]=t.height):(e[0]=i(t.x),e[1]=i(t.y),e[2]=t.z),e}(t,e,me._cartographicRadians?Pi:_e)}function Li(t,e){return function(t,e,i=Pi){return ve(e)?(e[0]=i(t[0]),e[1]=i(t[1]),e[2]=t[2]):"longitude"in e?(e.longitude=i(t[0]),e.latitude=i(t[1]),e.height=t[2]):(e.x=i(t[0]),e.y=i(t[1]),e.z=t[2]),e}(t,e,me._cartographicRadians?Pi:xe)}const Ri=new Je,Bi=new Je,Ni=new Je;const Fi=new Je,Ui={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},Gi={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},zi={east:new Je,north:new Je,up:new Je,west:new Je,south:new Je,down:new Je},ki=new Je,ji=new Je,Hi=new Je;function Vi(t,e,i,n,r,s){const o=Ui[e]&&Ui[e][i];let a,l,c;de(o&&(!n||n===o));const h=Fi.copy(r);if(be(h.x,0,1e-14)&&be(h.y,0,1e-14)){const t=Math.sign(h.z);a=ki.fromArray(Gi[e]),"east"!==e&&"west"!==e&&a.scale(t),l=ji.fromArray(Gi[i]),"east"!==i&&"west"!==i&&l.scale(t),c=Hi.fromArray(Gi[n]),"east"!==n&&"west"!==n&&c.scale(t)}else{const{up:r,east:s,north:o}=zi;s.set(-h.y,h.x,0).normalize(),t.geodeticSurfaceNormal(h,r),o.copy(r).cross(s);const{down:u,west:d,south:p}=zi;u.copy(r).scale(-1),d.copy(s).scale(-1),p.copy(o).scale(-1),a=zi[e],l=zi[i],c=zi[n]}return s[0]=a.x,s[1]=a.y,s[2]=a.z,s[3]=0,s[4]=l.x,s[5]=l.y,s[6]=l.z,s[7]=0,s[8]=c.x,s[9]=c.y,s[10]=c.z,s[11]=0,s[12]=h.x,s[13]=h.y,s[14]=h.z,s[15]=1,s}const Wi=new Je,qi=new Je,Ji=new Je,Xi=new Je,Yi=new Je,Zi=new Je;let Ki;class Qi{static get WGS84(){return Ki=Ki||new Qi(6378137,6378137,6356752.314245179),Ki}constructor(t=0,e=0,i=0){de(t>=0),de(e>=0),de(i>=0),this.radii=new Je(t,e,i),this.radiiSquared=new Je(t*t,e*e,i*i),this.radiiToTheFourth=new Je(t*t*t*t,e*e*e*e,i*i*i*i),this.oneOverRadii=new Je(0===t?0:1/t,0===e?0:1/e,0===i?0:1/i),this.oneOverRadiiSquared=new Je(0===t?0:1/(t*t),0===e?0:1/(e*e),0===i?0:1/(i*i)),this.minimumRadius=Math.min(t,e,i),this.maximumRadius=Math.max(t,e,i),this.centerToleranceSquared=Ei,0!==this.radiiSquared.z&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(t){return this===t||Boolean(t&&this.radii.equals(t.radii))}toString(){return this.radii.toString()}cartographicToCartesian(t,e=[0,0,0]){const i=qi,n=Ji,[,,r]=t;this.geodeticSurfaceNormalCartographic(t,i),n.copy(this.radiiSquared).scale(i);const s=Math.sqrt(i.dot(n));return n.scale(1/s),i.scale(r),n.add(i),n.to(e)}cartesianToCartographic(t,e=[0,0,0]){Zi.from(t);const i=this.scaleToGeodeticSurface(Zi,Xi);if(!i)return;const n=this.geodeticSurfaceNormal(i,qi),r=Yi;r.copy(Zi).subtract(i);return Li([Math.atan2(n.y,n.x),Math.asin(n.z),Math.sign(ze(r,Zi))*Ue(r)],e)}eastNorthUpToFixedFrame(t,e=new li){return Vi(this,"east","north","up",t,e)}localFrameToFixedFrame(t,e,i,n,r=new li){return Vi(this,t,e,i,n,r)}geocentricSurfaceNormal(t,e=[0,0,0]){return Wi.from(t).normalize().to(e)}geodeticSurfaceNormalCartographic(t,e=[0,0,0]){const i=Di(t),n=i[0],r=i[1],s=Math.cos(r);return Wi.set(s*Math.cos(n),s*Math.sin(n),Math.sin(r)).normalize(),Wi.to(e)}geodeticSurfaceNormal(t,e=[0,0,0]){return Wi.from(t).scale(this.oneOverRadiiSquared).normalize().to(e)}scaleToGeodeticSurface(t,e){return function(t,e,i=new Je){const{oneOverRadii:n,oneOverRadiiSquared:r,centerToleranceSquared:s}=e;Ri.from(t);const o=t.x,a=t.y,l=t.z,c=n.x,h=n.y,u=n.z,d=o*o*c*c,p=a*a*h*h,f=l*l*u*u,m=d+p+f,g=Math.sqrt(1/m);if(!Number.isFinite(g))return;const v=Bi;if(v.copy(t).scale(g),m<s)return v.to(i);const y=r.x,_=r.y,x=r.z,M=Ni;M.set(v.x*y*2,v.y*_*2,v.z*x*2);let b,w,S,T,A=(1-g)*t.len()/(.5*M.len()),E=0;do{A-=E,b=1/(1+A*y),w=1/(1+A*_),S=1/(1+A*x);const t=b*b,e=w*w,i=S*S;T=d*t+p*e+f*i-1,E=T/(-2*(d*(t*b)*y+p*(e*w)*_+f*(i*S)*x))}while(Math.abs(T)>Ci);return Ri.scale([b,w,S]).to(i)}(t,this,e)}scaleToGeocentricSurface(t,e=[0,0,0]){Xi.from(t);const i=Xi.x,n=Xi.y,r=Xi.z,s=this.oneOverRadiiSquared,o=1/Math.sqrt(i*i*s.x+n*n*s.y+r*r*s.z);return Xi.multiplyScalar(o).to(e)}transformPositionToScaledSpace(t,e=[0,0,0]){return Xi.from(t).scale(this.oneOverRadii).to(e)}transformPositionFromScaledSpace(t,e=[0,0,0]){return Xi.from(t).scale(this.radii).to(e)}getSurfaceNormalIntersectionWithZAxis(t,e=0,i=[0,0,0]){de(be(this.radii.x,this.radii.y,Oi)),de(this.radii.z>0),Xi.from(t);const n=Xi.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(n)>=this.radii.z-e))return Xi.set(0,0,n).to(i)}}class $i{constructor(t,e,i){b(this,"item",void 0),b(this,"previous",void 0),b(this,"next",void 0),this.item=t,this.previous=e,this.next=i}}class tn{constructor(){b(this,"head",null),b(this,"tail",null),b(this,"_length",0)}get length(){return this._length}add(t){const e=new $i(t,this.tail,null);return this.tail?(this.tail.next=e,this.tail=e):(this.head=e,this.tail=e),++this._length,e}remove(t){t&&(t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,--this._length)}splice(t,e){t!==e&&(this.remove(e),this._insert(t,e))}_insert(t,e){const i=t.next;t.next=e,this.tail===t?this.tail=e:i.previous=e,e.next=i,e.previous=t,++this._length}}function en(t){return null!=t}class nn{constructor(){b(this,"_list",void 0),b(this,"_sentinel",void 0),b(this,"_trimTiles",void 0),this._list=new tn,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(t){const e=t._cacheNode;en(e)&&this._list.splice(this._sentinel,e)}add(t,e,i){en(e._cacheNode)||(e._cacheNode=this._list.add(e),i&&i(t,e))}unloadTile(t,e,i){const n=e._cacheNode;en(n)&&(this._list.remove(n),e._cacheNode=void 0,i&&i(t,e))}unloadTiles(t,e){const i=this._trimTiles;this._trimTiles=!1;const n=this._list,r=1024*t.maximumMemoryUsage*1024,s=this._sentinel;let o=n.head;for(;o!==s&&(t.gpuMemoryUsageInBytes>r||i);){const i=o.item;o=o.next,this.unloadTile(t,i,e)}}trim(){this._trimTiles=!0}}const rn=Object.freeze({OUTSIDE:-1,INTERSECTING:0,INSIDE:1});new Je,new Je;const sn=new Je,on=new Je;class an{constructor(t=[0,0,0],e=0){this.radius=-0,this.center=new Je,this.fromCenterRadius(t,e)}fromCenterRadius(t,e){return this.center.from(t),this.radius=e,this}fromCornerPoints(t,e){return e=sn.from(e),this.center=(new Je).from(t).add(e).scale(.5),this.radius=this.center.distance(e),this}equals(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new an(this.center,this.radius)}union(t){const e=this.center,i=this.radius,n=t.center,r=t.radius,s=sn.copy(n).subtract(e),o=s.magnitude();if(i>=o+r)return this.clone();if(r>=o+i)return t.clone();const a=.5*(i+o+r);return on.copy(s).scale((-i+a)/o).add(e),this.center.copy(on),this.radius=a,this}expand(t){const e=(t=sn.from(t)).subtract(this.center).magnitude();return e>this.radius&&(this.radius=e),this}transform(t){this.center.transform(t);const e=function(t,e){var i=e[0],n=e[1],r=e[2],s=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10];return t[0]=Math.hypot(i,n,r),t[1]=Math.hypot(s,o,a),t[2]=Math.hypot(l,c,h),t}(sn,t);return this.radius=Math.max(e[0],Math.max(e[1],e[2]))*this.radius,this}distanceSquaredTo(t){const e=this.distanceTo(t);return e*e}distanceTo(t){const e=(t=sn.from(t)).subtract(this.center);return Math.max(0,e.len()-this.radius)}intersectPlane(t){const e=this.center,i=this.radius,n=t.normal.dot(e)+t.distance;return n<-i?rn.OUTSIDE:n<i?rn.INTERSECTING:rn.INSIDE}}const ln=new Je,cn=new Je,hn=new Je,un=new Je,dn=new Je,pn=new Je,fn=new Je,mn=0,gn=1,vn=2,yn=3,_n=4,xn=5,Mn=6,bn=7,wn=8;class Sn{constructor(t=[0,0,0],e=[0,0,0,0,0,0,0,0,0]){this.center=(new Je).from(t),this.halfAxes=new ei(e)}get halfSize(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return[new Je(t).len(),new Je(e).len(),new Je(i).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),n=new Je(t).normalize(),r=new Je(e).normalize(),s=new Je(i).normalize();return(new Ai).fromMatrix3(new ei([...n,...r,...s]))}fromCenterHalfSizeQuaternion(t,e,i){const n=new Ai(i),r=(new ei).fromQuaternion(n);return r[0]=r[0]*e[0],r[1]=r[1]*e[0],r[2]=r[2]*e[0],r[3]=r[3]*e[1],r[4]=r[4]*e[1],r[5]=r[5]*e[1],r[6]=r[6]*e[2],r[7]=r[7]*e[2],r[8]=r[8]*e[2],this.center=(new Je).from(t),this.halfAxes=r,this}clone(){return new Sn(this.center,this.halfAxes)}equals(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(t=new an){const e=this.halfAxes,i=e.getColumn(0,hn),n=e.getColumn(1,un),r=e.getColumn(2,dn),s=ln.copy(i).add(n).add(r);return t.center.copy(this.center),t.radius=s.magnitude(),t}intersectPlane(t){const e=this.center,i=t.normal,n=this.halfAxes,r=i.x,s=i.y,o=i.z,a=Math.abs(r*n[mn]+s*n[gn]+o*n[vn])+Math.abs(r*n[yn]+s*n[_n]+o*n[xn])+Math.abs(r*n[Mn]+s*n[bn]+o*n[wn]),l=i.dot(e)+t.distance;return l<=-a?rn.OUTSIDE:l>=a?rn.INSIDE:rn.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const e=cn.from(t).subtract(this.center),i=this.halfAxes,n=i.getColumn(0,hn),r=i.getColumn(1,un),s=i.getColumn(2,dn),o=n.magnitude(),a=r.magnitude(),l=s.magnitude();n.normalize(),r.normalize(),s.normalize();let c,h=0;return c=Math.abs(e.dot(n))-o,c>0&&(h+=c*c),c=Math.abs(e.dot(r))-a,c>0&&(h+=c*c),c=Math.abs(e.dot(s))-l,c>0&&(h+=c*c),h}computePlaneDistances(t,e,i=[-0,-0]){let n=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;const s=this.center,o=this.halfAxes,a=o.getColumn(0,hn),l=o.getColumn(1,un),c=o.getColumn(2,dn),h=pn.copy(a).add(l).add(c).add(s),u=fn.copy(h).subtract(t);let d=e.dot(u);return n=Math.min(d,n),r=Math.max(d,r),h.copy(s).add(a).add(l).subtract(c),u.copy(h).subtract(t),d=e.dot(u),n=Math.min(d,n),r=Math.max(d,r),h.copy(s).add(a).subtract(l).add(c),u.copy(h).subtract(t),d=e.dot(u),n=Math.min(d,n),r=Math.max(d,r),h.copy(s).add(a).subtract(l).subtract(c),u.copy(h).subtract(t),d=e.dot(u),n=Math.min(d,n),r=Math.max(d,r),s.copy(h).subtract(a).add(l).add(c),u.copy(h).subtract(t),d=e.dot(u),n=Math.min(d,n),r=Math.max(d,r),s.copy(h).subtract(a).add(l).subtract(c),u.copy(h).subtract(t),d=e.dot(u),n=Math.min(d,n),r=Math.max(d,r),s.copy(h).subtract(a).subtract(l).add(c),u.copy(h).subtract(t),d=e.dot(u),n=Math.min(d,n),r=Math.max(d,r),s.copy(h).subtract(a).subtract(l).subtract(c),u.copy(h).subtract(t),d=e.dot(u),n=Math.min(d,n),r=Math.max(d,r),i[0]=n,i[1]=r,i}transform(t){this.center.transformAsPoint(t);const e=this.halfAxes.getColumn(0,hn);e.transformAsPoint(t);const i=this.halfAxes.getColumn(1,un);i.transformAsPoint(t);const n=this.halfAxes.getColumn(2,dn);return n.transformAsPoint(t),this.halfAxes=new ei([...e,...i,...n]),this}getTransform(){throw new Error("not implemented")}}const Tn=new Je,An=new Je;class En{constructor(t=[0,0,1],e=0){this.normal=new Je,this.distance=-0,this.fromNormalDistance(t,e)}fromNormalDistance(t,e){return de(Number.isFinite(e)),this.normal.from(t).normalize(),this.distance=e,this}fromPointNormal(t,e){t=Tn.from(t),this.normal.from(e).normalize();const i=-this.normal.dot(t);return this.distance=i,this}fromCoefficients(t,e,i,n){return this.normal.set(t,e,i),de(be(this.normal.len(),1)),this.distance=n,this}clone(t){return new En(this.normal,this.distance)}equals(t){return be(this.distance,t.distance)&&be(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const e=An.copy(this.normal).transformAsVector(t).normalize(),i=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(i,e)}projectPointOntoPlane(t,e=[0,0,0]){t=Tn.from(t);const i=this.getPointDistance(t),n=An.copy(this.normal).scale(i);return t.subtract(n).to(e)}}const Cn=[new Je([1,0,0]),new Je([0,1,0]),new Je([0,0,1])],On=new Je,Pn=new Je;new En(new Je(1,0,0),0);class In{static get MASK_OUTSIDE(){return 4294967295}static get MASK_INSIDE(){return 0}static get MASK_INDETERMINATE(){return 2147483647}constructor(t=[]){this.planes=t,de(this.planes.every((t=>t instanceof En)))}fromBoundingSphere(t){this.planes.length=2*Cn.length;const e=t.center,i=t.radius;let n=0;for(const t of Cn){let r=this.planes[n],s=this.planes[n+1];r||(r=this.planes[n]=new En),s||(s=this.planes[n+1]=new En);const o=On.copy(t).scale(-i).add(e);t.dot(o),r.fromPointNormal(o,t);const a=On.copy(t).scale(i).add(e),l=Pn.copy(t).negate();l.dot(a),s.fromPointNormal(a,l),n+=2}return this}computeVisibility(t){de(t);let e=rn.INSIDE;for(const i of this.planes){switch(t.intersectPlane(i)){case rn.OUTSIDE:return rn.OUTSIDE;case rn.INTERSECTING:e=rn.INTERSECTING}}return e}computeVisibilityWithPlaneMask(t,e){if(de(t,"boundingVolume is required."),de(Number.isFinite(e),"parentPlaneMask is required."),e===In.MASK_OUTSIDE||e===In.MASK_INSIDE)return e;let i=In.MASK_INSIDE;const n=this.planes;for(let r=0;r<this.planes.length;++r){const s=r<31?1<<r:0;if(r<31&&0==(e&s))continue;const o=n[r],a=t.intersectPlane(o);if(a===rn.OUTSIDE)return In.MASK_OUTSIDE;a===rn.INTERSECTING&&(i|=s)}return i}}const Dn=new Je,Ln=new Je,Rn=new Je,Bn=new Je,Nn=new Je;class Fn{constructor(t={}){t={near:1,far:5e8,...t},this.left=t.left,this._left=void 0,this.right=t.right,this._right=void 0,this.top=t.top,this._top=void 0,this.bottom=t.bottom,this._bottom=void 0,this.near=t.near,this._near=this.near,this.far=t.far,this._far=this.far,this._cullingVolume=new In([new En,new En,new En,new En,new En,new En]),this._perspectiveMatrix=new li,this._infinitePerspective=new li}clone(){return new Fn({right:this.right,left:this.left,top:this.top,bottom:this.bottom,near:this.near,far:this.far})}equals(t){return t&&t instanceof Fn&&this.right===t.right&&this.left===t.left&&this.top===t.top&&this.bottom===t.bottom&&this.near===t.near&&this.far===t.far}get projectionMatrix(){return Un(this),this._perspectiveMatrix}get infiniteProjectionMatrix(){return Un(this),this._infinitePerspective}computeCullingVolume(t,e,i){de(t,"position is required."),de(e,"direction is required."),de(i,"up is required.");const n=this._cullingVolume.planes;i=Dn.copy(i).normalize();const r=Ln.copy(e).cross(i).normalize(),s=Rn.copy(e).multiplyByScalar(this.near).add(t),o=Bn.copy(e).multiplyByScalar(this.far).add(t);let a=Nn;return a.copy(r).multiplyByScalar(this.left).add(s).subtract(t).cross(i),n[0].fromPointNormal(t,a),a.copy(r).multiplyByScalar(this.right).add(s).subtract(t).cross(i).negate(),n[1].fromPointNormal(t,a),a.copy(i).multiplyByScalar(this.bottom).add(s).subtract(t).cross(r).negate(),n[2].fromPointNormal(t,a),a.copy(i).multiplyByScalar(this.top).add(s).subtract(t).cross(r),n[3].fromPointNormal(t,a),a=(new Je).copy(e),n[4].fromPointNormal(s,a),a.negate(),n[5].fromPointNormal(o,a),this._cullingVolume}getPixelDimensions(t,e,i,n){Un(this),de(Number.isFinite(t)&&Number.isFinite(e)),de(t>0),de(e>0),de(i>0),de(n);const r=1/this.near;let s=this.top*r;const o=2*i*s/e;s=this.right*r;const a=2*i*s/t;return n.x=a,n.y=o,n}}function Un(t){de(Number.isFinite(t.right)&&Number.isFinite(t.left)&&Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.near)&&Number.isFinite(t.far));const{top:e,bottom:i,right:n,left:r,near:s,far:o}=t;e===t._top&&i===t._bottom&&r===t._left&&n===t._right&&s===t._near&&o===t._far||(de(t.near>0&&t.near<t.far,"near must be greater than zero and less than far."),t._left=r,t._right=n,t._top=e,t._bottom=i,t._near=s,t._far=o,t._perspectiveMatrix=(new li).frustum({left:r,right:n,bottom:i,top:e,near:s,far:o}),t._infinitePerspective=(new li).frustum({left:r,right:n,bottom:i,top:e,near:s,far:1/0}))}class Gn{constructor(t={}){t={near:1,far:5e8,xOffset:0,yOffset:0,...t},this._offCenterFrustum=new Fn,this.fov=t.fov,this._fov=void 0,this._fovy=void 0,this._sseDenominator=void 0,this.aspectRatio=t.aspectRatio,this._aspectRatio=void 0,this.near=t.near,this._near=this.near,this.far=t.far,this._far=this.far,this.xOffset=t.xOffset,this._xOffset=this.xOffset,this.yOffset=t.yOffset,this._yOffset=this.yOffset}clone(){return new Gn({aspectRatio:this.aspectRatio,fov:this.fov,near:this.near,far:this.far})}equals(t){return null!=t&&t instanceof Gn&&(zn(this),zn(t),this.fov===t.fov&&this.aspectRatio===t.aspectRatio&&this.near===t.near&&this.far===t.far&&this._offCenterFrustum.equals(t._offCenterFrustum))}get projectionMatrix(){return zn(this),this._offCenterFrustum.projectionMatrix}get infiniteProjectionMatrix(){return zn(this),this._offCenterFrustum.infiniteProjectionMatrix}get fovy(){return zn(this),this._fovy}get sseDenominator(){return zn(this),this._sseDenominator}computeCullingVolume(t,e,i){return zn(this),this._offCenterFrustum.computeCullingVolume(t,e,i)}getPixelDimensions(t,e,i,n){return zn(this),this._offCenterFrustum.getPixelDimensions(t,e,i,n)}}function zn(t){de(Number.isFinite(t.fov)&&Number.isFinite(t.aspectRatio)&&Number.isFinite(t.near)&&Number.isFinite(t.far));const e=t._offCenterFrustum;t.fov===t._fov&&t.aspectRatio===t._aspectRatio&&t.near===t._near&&t.far===t._far&&t.xOffset===t._xOffset&&t.yOffset===t._yOffset||(de(t.fov>=0&&t.fov<Math.PI),de(t.aspectRatio>0),de(t.near>=0&&t.near<t.far),t._aspectRatio=t.aspectRatio,t._fov=t.fov,t._fovy=t.aspectRatio<=1?t.fov:2*Math.atan(Math.tan(.5*t.fov)/t.aspectRatio),t._near=t.near,t._far=t.far,t._sseDenominator=2*Math.tan(.5*t._fovy),t._xOffset=t.xOffset,t._yOffset=t.yOffset,e.top=t.near*Math.tan(.5*t._fovy),e.bottom=-e.top,e.right=t.aspectRatio*e.top,e.left=-e.right,e.near=t.near,e.far=t.far,e.right+=t.xOffset,e.left+=t.xOffset,e.top+=t.yOffset,e.bottom+=t.yOffset)}new Je,new Je,new Je,new Je,new Je,new Je,new Je,new Je,new Je,new Je,new Je,new Je,new ei,new ei,new ei,new ei,new ei,new Je,new Je,new Je,new Je,new Je,new ei,new ei,new ei;const kn=new Je,jn=new Je,Hn=new In([new En,new En,new En,new En,new En,new En]);function Vn(t,e){const{cameraDirection:i,cameraUp:n,height:r}=t,{metersPerUnit:s}=t.distanceScales,o=t.unprojectPosition(t.center),a=Qi.WGS84.cartographicToCartesian(o,new Je),l=Qi.WGS84.eastNorthUpToFixedFrame(a),c=t.unprojectPosition(t.cameraPosition),h=Qi.WGS84.cartographicToCartesian(c,new Je),u=new Je(l.transformAsVector(new Je(i).scale(s))).normalize(),d=new Je(l.transformAsVector(new Je(n).scale(s))).normalize();return function(t,e){const i=t.getFrustumPlanes();let n=0;for(const r in i){const s=i[r],o=s.normal.dot(t.center);jn.copy(s.normal).scale(s.distance-o).add(t.center);const a=t.unprojectPosition(jn),l=Qi.WGS84.cartographicToCartesian(a,new Je);Hn.planes[n++].fromPointNormal(l,kn.copy(e).subtract(l))}}(t,a),{camera:{position:h,direction:u,up:d},viewport:t,height:r,cullingVolume:Hn,frameNumber:e,sseDenominator:1.15}}const Wn=6356752.314245179,qn=new Je;function Jn(t){const{halfAxes:e,radius:i,width:n,height:r}=t;if(e){const t=function(t){t.getColumn(0,qn);const e=t.getColumn(1),i=t.getColumn(2),n=qn.add(e).add(i);return n.len()}(e);return Math.log2(Wn/t)}if(i)return Math.log2(Wn/i);if(r&&n){return(Math.log2(6378137/n)+Math.log2(6378137/r))/2}return 1}const Xn=0,Yn=1,Zn=3,Kn=4,Qn=5,$n=1,tr=2,er="empty",ir="scenegraph",nr="pointcloud",rr="mesh",sr="I3S",or="TILES3D",ar="geometricError",lr=1;function cr(t){return null!=t}const hr=new Je,ur=new Je,dr=new Je;function pr(t,e,i){if(d(t,"3D Tile: boundingVolume must be defined"),t.box)return function(t,e,i){const n=new Je(t[0],t[1],t[2]);e.transform(n,n);let r=[];if(10===t.length){const e=t.slice(3,6),i=new Ai;i.fromArray(t,6);const n=new Je([1,0,0]),s=new Je([0,1,0]),o=new Je([0,0,1]);n.transformByQuaternion(i),n.scale(e[0]),s.transformByQuaternion(i),s.scale(e[1]),o.transformByQuaternion(i),o.scale(e[2]),r=[...n.toArray(),...s.toArray(),...o.toArray()]}else r=[...t.slice(3,6),...t.slice(6,9),...t.slice(9,12)];const s=e.transformAsVector(r.slice(0,3)),o=e.transformAsVector(r.slice(3,6)),a=e.transformAsVector(r.slice(6,9)),l=new ei([s[0],s[1],s[2],o[0],o[1],o[2],a[0],a[1],a[2]]);if(cr(i))return i.center=n,i.halfAxes=l,i;return new Sn(n,l)}(t.box,e,i);if(t.region){const[e,i,n,r,s,o]=t.region,a=Qi.WGS84.cartographicToCartesian([Me(e),Me(r),s],ur),l=Qi.WGS84.cartographicToCartesian([Me(n),Me(i),o],dr),c=(new Je).addVectors(a,l).multiplyScalar(.5),h=(new Je).subVectors(a,l).len()/2;return fr([c[0],c[1],c[2],h],new li)}if(t.sphere)return fr(t.sphere,e,i);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function fr(t,e,i){const n=new Je(t[0],t[1],t[2]);e.transform(n,n);const r=e.getScale(hr),s=Math.max(Math.max(r[0],r[1]),r[2]),o=t[3]*s;return cr(i)?(i.center=n,i.radius=o,i):new an(n,o)}function mr(t,e){if(t.dynamicScreenSpaceError&&t.dynamicScreenSpaceErrorComputedDensity){const i=t.dynamicScreenSpaceErrorComputedDensity,n=t.dynamicScreenSpaceErrorFactor,r=function(t,e){const i=t*e;return 1-Math.exp(-i*i)}(e,i)*n;return r}return 0}function gr(t,e){const i=e.viewport,n=i.constructor,{longitude:r,latitude:s,height:o,width:a,bearing:l,zoom:c}=i,h=new n({longitude:r,latitude:s,height:o,width:a,bearing:l,zoom:c,pitch:0}),u=t.header.mbs[1],d=t.header.mbs[0],p=t.header.mbs[2],f=t.header.mbs[3],m=[...t.boundingVolume.center],g=h.unprojectPosition(h.cameraPosition),v=Qi.WGS84.cartographicToCartesian(g,new Je),y=new Je(v).subtract(m).normalize(),_=new li;Qi.WGS84.eastNorthUpToFixedFrame(m,_);const x=new li(_).invert(),M=new Je(v).transform(x),b=Math.sqrt(M[0]*M[0]+M[1]*M[1]),w=b*b/M[2],S=new Je([M[0],M[1],w]).transform(_),T=new Je(S).subtract(m).normalize(),A=y.cross(T).normalize().scale(f),E=new Je(m).add(A),C=Qi.WGS84.cartesianToCartographic(E),O=h.project([d,u,p]),P=h.project(C);return new Je(O).subtract(P).magnitude()}new Je,new Je,new li,new Je,new Je,new Je;class vr{constructor(t=0){b(this,"_map",new Map),b(this,"_array",void 0),b(this,"_length",void 0),this._array=new Array(t),this._length=t}get length(){return this._length}set length(t){this._length=t,t>this._array.length&&(this._array.length=t)}get values(){return this._array}get(t){return d(t<this._array.length),this._array[t]}set(t,e){d(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=e,this._map.set(e,t)}delete(t){const e=this._map.get(t);e>=0&&(this._array.splice(e,1),this._map.delete(t),this.length--)}peek(){return this._array[this._length-1]}push(t){if(!this._map.has(t)){const e=this.length++;this._array[e]=t,this._map.set(t,e)}}pop(){const t=this._array[--this.length];return this._map.delete(t),t}reserve(t){d(t>=0),t>this._array.length&&(this._array.length=t)}resize(t){d(t>=0),this.length=t}trim(t){null==t&&(t=this.length),this._array.length=t}reset(){this._array=[],this._map=new Map,this._length=0}find(t){return this._map.has(t)}}const yr={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class _r{constructor(t){b(this,"options",void 0),b(this,"root",void 0),b(this,"requestedTiles",void 0),b(this,"selectedTiles",void 0),b(this,"emptyTiles",void 0),b(this,"_traversalStack",void 0),b(this,"_emptyTraversalStack",void 0),b(this,"_frameNumber",void 0),this.options={...yr,...t},this._traversalStack=new vr,this._emptyTraversalStack=new vr,this._frameNumber=null,this.root=null,this.selectedTiles={},this.requestedTiles={},this.emptyTiles={}}traverse(t,e,i){this.root=t,this.options={...this.options,...i},this.reset(),this.updateTile(t,e),this._frameNumber=e.frameNumber,this.executeTraversal(t,e)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(t,e){const i=this._traversalStack;for(t._selectionDepth=1,i.push(t);i.length>0;){const t=i.pop();let n=!1;this.canTraverse(t,e)&&(this.updateChildTiles(t,e),n=this.updateAndPushChildren(t,e,i,t.hasRenderContent?t._selectionDepth+1:t._selectionDepth));const r=t.parent,s=Boolean(!r||r._shouldRefine),o=!n;t.hasRenderContent?t.refine===$n?(this.loadTile(t,e),this.selectTile(t,e)):t.refine===tr&&(this.loadTile(t,e),o&&this.selectTile(t,e)):(this.emptyTiles[t.id]=t,this.loadTile(t,e),o&&this.selectTile(t,e)),this.touchTile(t,e),t._shouldRefine=n&&s}this.options.onTraversalEnd(e)}updateChildTiles(t,e){const i=t.children;for(const t of i)this.updateTile(t,e);return!0}updateAndPushChildren(t,e,i,n){const{loadSiblings:r,skipLevelOfDetail:s}=this.options,o=t.children;o.sort(this.compareDistanceToCamera.bind(this));const a=t.refine===tr&&t.hasRenderContent&&!s;let l=!1,c=!0;for(const t of o)if(t._selectionDepth=n,t.isVisibleAndInRequestVolume?(i.find(t)&&i.delete(t),i.push(t),l=!0):(a||r)&&(this.loadTile(t,e),this.touchTile(t,e)),a){let i;if(i=!!t._inRequestVolume&&(t.hasRenderContent?t.contentAvailable:this.executeEmptyTraversal(t,e)),c=c&&i,!c)return!1}return l||(c=!1),c}updateTile(t,e){this.updateTileVisibility(t,e)}selectTile(t,e){this.shouldSelectTile(t)&&(t._selectedFrame=e.frameNumber,this.selectedTiles[t.id]=t)}loadTile(t,e){this.shouldLoadTile(t)&&(t._requestedFrame=e.frameNumber,t._priority=t._getPriority(),this.requestedTiles[t.id]=t)}touchTile(t,e){t.tileset._cache.touch(t),t._touchedFrame=e.frameNumber}canTraverse(t,e,i=!1,n=!1){return!!t.hasChildren&&(t.hasTilesetContent?!t.contentExpired:!(!n&&!t.isVisibleAndInRequestVolume)&&this.shouldRefine(t,e,i))}shouldLoadTile(t){return t.hasUnloadedContent||t.contentExpired}shouldSelectTile(t){return t.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(t,e,i){let n=t._screenSpaceError;return i&&(n=t.getScreenSpaceError(e,!0)),n>this.options.maximumScreenSpaceError}updateTileVisibility(t,e){const i=[];if(this.options.viewportTraversersMap)for(const t in this.options.viewportTraversersMap){this.options.viewportTraversersMap[t]===e.viewport.id&&i.push(t)}else i.push(e.viewport.id);t.updateVisibility(e,i)}compareDistanceToCamera(t,e){return t._distanceToCamera-e._distanceToCamera}anyChildrenVisible(t,e){let i=!1;for(const n of t.children)n.updateVisibility(e),i=i||n.isVisibleAndInRequestVolume;return i}executeEmptyTraversal(t,e){let i=!0;const n=this._emptyTraversalStack;for(n.push(t);n.length>0&&i;){const t=n.pop();this.updateTile(t,e),t.isVisibleAndInRequestVolume||this.loadTile(t,e),this.touchTile(t,e);if(!t.hasRenderContent&&this.canTraverse(t,e,!1,!0)){const e=t.children;for(const t of e)n.find(t)&&n.delete(t),n.push(t)}else t.contentAvailable||(i=!1)}return i}}const xr=new Je;class Mr{constructor(t,e,i,n=""){b(this,"tileset",void 0),b(this,"header",void 0),b(this,"id",void 0),b(this,"url",void 0),b(this,"parent",void 0),b(this,"refine",void 0),b(this,"type",void 0),b(this,"contentUrl",void 0),b(this,"lodMetricType",void 0),b(this,"lodMetricValue",void 0),b(this,"boundingVolume",void 0),b(this,"content",void 0),b(this,"contentState",void 0),b(this,"gpuMemoryUsageInBytes",void 0),b(this,"children",void 0),b(this,"depth",void 0),b(this,"viewportIds",void 0),b(this,"transform",void 0),b(this,"extensions",void 0),b(this,"userData",void 0),b(this,"computedTransform",void 0),b(this,"hasEmptyContent",void 0),b(this,"hasTilesetContent",void 0),b(this,"traverser",void 0),b(this,"_cacheNode",void 0),b(this,"_frameNumber",void 0),b(this,"_lodJudge",void 0),b(this,"_expireDate",void 0),b(this,"_expiredContent",void 0),b(this,"_shouldRefine",void 0),b(this,"_distanceToCamera",void 0),b(this,"_centerZDepth",void 0),b(this,"_screenSpaceError",void 0),b(this,"_visibilityPlaneMask",void 0),b(this,"_visible",void 0),b(this,"_inRequestVolume",void 0),b(this,"_stackLength",void 0),b(this,"_selectionDepth",void 0),b(this,"_touchedFrame",void 0),b(this,"_visitedFrame",void 0),b(this,"_selectedFrame",void 0),b(this,"_requestedFrame",void 0),b(this,"_priority",void 0),b(this,"_contentBoundingVolume",void 0),b(this,"_viewerRequestVolume",void 0),b(this,"_initialTransform",void 0),this.header=e,this.tileset=t,this.id=n||e.id,this.url=e.url,this.parent=i,this.refine=this._getRefine(e.refine),this.type=e.type,this.contentUrl=e.contentUrl,this.lodMetricType="geometricError",this.lodMetricValue=0,this.boundingVolume=null,this.content=null,this.contentState=Xn,this.gpuMemoryUsageInBytes=0,this.children=[],this.hasEmptyContent=!1,this.hasTilesetContent=!1,this.depth=0,this.viewportIds=[],this.userData={},this.extensions=null,this._priority=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._screenSpaceError=0,this._cacheNode=null,this._frameNumber=null,this._cacheNode=null,this.traverser=new _r({}),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._initialTransform=new li,this.transform=new li,this._initializeLodMetric(e),this._initializeTransforms(e),this._initializeBoundingVolumes(e),this._initializeContent(e),this._initializeRenderingState(e),this._lodJudge=null,this._expireDate=null,this._expiredContent=null,Object.seal(this)}destroy(){this.header=null}isDestroyed(){return null===this.header}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===Zn||this.hasEmptyContent}get contentAvailable(){return Boolean(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===Xn}get contentExpired(){return this.contentState===Kn}get contentFailed(){return this.contentState===Qn}getScreenSpaceError(t,e){switch(this.tileset.type){case sr:return gr(this,t);case or:return function(t,e,i){const n=t.tileset,r=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,s=i?r:t.lodMetricValue;if(0===s)return 0;const o=Math.max(t._distanceToCamera,1e-7),{height:a,sseDenominator:l}=e,{viewDistanceScale:c}=n.options;let h=s*a*(c||1)/(o*l);return h-=mr(n,o),h}(this,t,e);default:throw new Error("Unsupported tileset type")}}_getPriority(){const t=this.tileset._traverser,{skipLevelOfDetail:e}=t.options,i=this.refine===$n||e;if(i&&!this.isVisible&&void 0!==this._visible)return-1;if(this.tileset._frameNumber-this._touchedFrame>=1)return-1;if(this.contentState===Xn)return-1;const n=this.parent,r=n&&(!i||0===this._screenSpaceError||n.hasTilesetContent)?n._screenSpaceError:this._screenSpaceError,s=t.root?t.root._screenSpaceError:0;return Math.max(s-r,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=Yn;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!t)return this.contentState=Xn,!1;try{const e=this.tileset.getTileUrl(this.contentUrl),i=this.tileset.loader,n={...this.tileset.loadOptions,[i.id]:{...this.tileset.loadOptions[i.id],isTileset:"json"===this.type,...this._getLoaderSpecificOptions(i.id)}};return this.content=await ue(e,i,n),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=Zn,this._onContentLoaded(),!0}catch(t){throw this.contentState=Qn,t}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=Xn,!0}updateVisibility(t,e){if(this._frameNumber===t.frameNumber)return;const i=this.parent,n=i?i._visibilityPlaneMask:In.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const t=i?i.computedTransform:this.tileset.modelMatrix;this._updateTransform(t)}this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,n),this._visible=this._visibilityPlaneMask!==In.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._frameNumber=t.frameNumber,this.viewportIds=e}visibility(t,e){const{cullingVolume:i}=t,{boundingVolume:n}=this;return i.computeVisibilityWithPlaneMask(n,e)}contentVisibility(){return!0}distanceToTile(t){const e=this.boundingVolume;return Math.sqrt(Math.max(e.distanceSquaredTo(t.camera.position),0))}cameraSpaceZDepth({camera:t}){const e=this.boundingVolume;return xr.subVectors(e.center,t.position),t.direction.dot(xr)}insideViewerRequestVolume(t){const e=this._viewerRequestVolume;return!e||e.distanceSquaredTo(t.camera.position)<=0}updateExpiration(){if(null!=this._expireDate&&this.contentReady&&!this.hasEmptyContent){const t=Date.now();Date.lessThan(this._expireDate,t)&&(this.contentState=Kn,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(t){this.lodMetricType="lodMetricType"in t?t.lodMetricType:this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,this.lodMetricValue="lodMetricValue"in t?t.lodMetricValue:this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue}_initializeTransforms(t){this.transform=t.transform?new li(t.transform):new li;const e=this.parent,i=this.tileset,n=e&&e.computedTransform?e.computedTransform.clone():i.modelMatrix.clone();this.computedTransform=new li(n).multiplyRight(this.transform);const r=e&&e._initialTransform?e._initialTransform.clone():new li;this._initialTransform=new li(r).multiplyRight(this.transform)}_initializeBoundingVolumes(t){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(t)}_initializeContent(t){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=Xn,this.hasTilesetContent=!1,t.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(t){this.depth=t.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=In.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(t){return t||this.parent&&this.parent.refine||tr}_isTileset(){return-1!==this.contentUrl.indexOf(".json")}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0}this._isTileset()&&(this.hasTilesetContent=!0)}_updateBoundingVolume(t){this.boundingVolume=pr(t.boundingVolume,this.computedTransform,this.boundingVolume);const e=t.content;e&&(e.boundingVolume&&(this._contentBoundingVolume=pr(e.boundingVolume,this.computedTransform,this._contentBoundingVolume)),t.viewerRequestVolume&&(this._viewerRequestVolume=pr(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(t=new li){const e=t.clone().multiplyRight(this.transform);!e.equals(this.computedTransform)&&(this.computedTransform=e,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(t){return"i3s"===t?{...this.tileset.options.i3s,tile:this.header,tileset:this.tileset.tileset,isTileHeader:!1}:{assetGltfUpAxis:(e=this.tileset.tileset).asset&&e.asset.gltfUpAxis||"Y"};var e}}class br extends _r{compareDistanceToCamera(t,e){return 0===e._distanceToCamera&&0===t._distanceToCamera?e._centerZDepth-t._centerZDepth:e._distanceToCamera-t._distanceToCamera}updateTileVisibility(t,e){if(super.updateTileVisibility(t,e),!t.isVisibleAndInRequestVolume)return;const i=t.children.length>0;if(t.hasTilesetContent&&i){const i=t.children[0];return this.updateTileVisibility(i,e),void(t._visible=i._visible)}if(this.meetsScreenSpaceErrorEarly(t,e))return void(t._visible=!1);const n=t.refine===tr,r=t._optimChildrenWithinParent===lr;n&&r&&i&&!this.anyChildrenVisible(t,e)&&(t._visible=!1)}meetsScreenSpaceErrorEarly(t,e){const{parent:i}=t;return!(!i||i.hasTilesetContent||i.refine!==$n)&&!this.shouldRefine(t,e,!0)}}const wr="REQUESTED",Sr="COMPLETED",Tr="ERROR";class Ar{constructor(){b(this,"_statusMap",void 0),this._statusMap={}}add(t,e,i,n){this._statusMap[e]||(this._statusMap[e]={request:t,callback:i,key:e,frameState:n,status:wr},t().then((t=>{this._statusMap[e].status=Sr,this._statusMap[e].callback(t,n)})).catch((t=>{this._statusMap[e].status=Tr,i(t)})))}update(t,e){this._statusMap[t]&&(this._statusMap[t].frameState=e)}find(t){return this._statusMap[t]}}class Er extends _r{constructor(t){super(t),b(this,"_tileManager",void 0),this._tileManager=new Ar}shouldRefine(t,e){return t._lodJudge=function(t,e){if(0===t.lodMetricValue||isNaN(t.lodMetricValue))return"DIG";const i=2*gr(t,e);return i<2?"OUT":!t.header.children||i<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}(t,e),"DIG"===t._lodJudge}updateChildTiles(t,e){const i=t.header.children||[],n=t.children,r=t.tileset;for(const s of i){const i="".concat(s.id,"-").concat(e.viewport.id),o=n&&n.find((t=>t.id===i));if(o)o&&this.updateTile(o,e);else{let n=()=>this._loadTile(s.id,r);this._tileManager.find(i)?this._tileManager.update(i,e):(r.tileset.nodePages&&(n=()=>r.tileset.nodePagesTile.formTileFromNodePages(s.id)),this._tileManager.add(n,i,(e=>this._onTileLoad(e,t,i)),e))}}return!1}async _loadTile(t,e){const{loader:i}=e,n=e.getTileUrl("".concat(e.url,"/nodes/").concat(t)),r={...e.loadOptions,i3s:{...e.loadOptions.i3s,isTileHeader:!0,loadContent:!1}};return await ue(n,i,r)}_onTileLoad(t,e,i){const n=new Mr(e.tileset,t,e,i);e.children.push(n);const r=this._tileManager.find(n.id).frameState;this.updateTile(n,r),this._frameNumber===r.frameNumber&&this.executeTraversal(n,r)}}const Cr={description:"",ellipsoid:Qi.WGS84,modelMatrix:new li,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:t=>t,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},Or="Tiles In Tileset(s)",Pr="Tiles In Memory",Ir="Tiles In View",Dr="Tiles To Render",Lr="Tiles Loaded",Rr="Tiles Loading",Br="Tiles Unloaded",Nr="Failed Tile Loads",Fr="Points",Ur="Tile Memory Use";class Gr{constructor(t,e){b(this,"options",void 0),b(this,"loadOptions",void 0),b(this,"type",void 0),b(this,"tileset",void 0),b(this,"loader",void 0),b(this,"url",void 0),b(this,"basePath",void 0),b(this,"modelMatrix",void 0),b(this,"ellipsoid",void 0),b(this,"lodMetricType",void 0),b(this,"lodMetricValue",void 0),b(this,"refine",void 0),b(this,"root",void 0),b(this,"roots",void 0),b(this,"asset",void 0),b(this,"description",void 0),b(this,"properties",void 0),b(this,"extras",void 0),b(this,"attributions",void 0),b(this,"credits",void 0),b(this,"stats",void 0),b(this,"traverseCounter",void 0),b(this,"geometricError",void 0),b(this,"selectedTiles",void 0),b(this,"cartographicCenter",void 0),b(this,"cartesianCenter",void 0),b(this,"zoom",void 0),b(this,"boundingVolume",void 0),b(this,"gpuMemoryUsageInBytes",void 0),b(this,"dynamicScreenSpaceErrorComputedDensity",void 0),b(this,"_traverser",void 0),b(this,"_cache",void 0),b(this,"_requestScheduler",void 0),b(this,"_frameNumber",void 0),b(this,"_queryParamsString",void 0),b(this,"_queryParams",void 0),b(this,"_extensionsUsed",void 0),b(this,"_tiles",void 0),b(this,"_pendingCount",void 0),b(this,"lastUpdatedVieports",void 0),b(this,"_requestedTiles",void 0),b(this,"_emptyTiles",void 0),b(this,"frameStateData",void 0),b(this,"maximumMemoryUsage",void 0),d(t),this.options={...Cr,...e},this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||et(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.loadOptions=this.options.loadOptions||{},this.root=null,this.roots={},this.cartographicCenter=null,this.cartesianCenter=null,this.zoom=1,this.boundingVolume=null,this.traverseCounter=0,this.geometricError=0,this._traverser=this._initializeTraverser(),this._cache=new nn,this._requestScheduler=new $({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this._frameNumber=0,this._pendingCount=0,this._tiles={},this.selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this.frameStateData={},this.lastUpdatedVieports=null,this._queryParams={},this._queryParamsString="",this.maximumMemoryUsage=this.options.maximumMemoryUsage||32,this.gpuMemoryUsageInBytes=0,this.stats=new K({id:this.url}),this._initializeStats(),this._extensionsUsed=void 0,this.dynamicScreenSpaceErrorComputedDensity=0,this.extras=null,this.asset={},this.credits={},this.description=this.options.description||"",this._initializeTileSet(t)}destroy(){this._destroy()}isLoaded(){return 0===this._pendingCount&&0!==this._frameNumber}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return this._queryParamsString||(this._queryParamsString=function(t){const e=[];for(const i of Object.keys(t))e.push("".concat(i,"=").concat(t[i]));switch(e.length){case 0:return"";case 1:return"?".concat(e[0]);default:return"?".concat(e.join("&"))}}(this._queryParams)),this._queryParamsString}setProps(t){this.options={...this.options,...t}}setOptions(t){this.options={...this.options,...t}}getTileUrl(t){return t.startsWith("data:")?t:"".concat(t).concat(this.queryParams)}hasExtension(t){return Boolean(this._extensionsUsed&&this._extensionsUsed.indexOf(t)>-1)}update(t){if("loadTiles"in this.options&&!this.options.loadTiles)return;if(this.traverseCounter>0)return;!t&&this.lastUpdatedVieports?t=this.lastUpdatedVieports:this.lastUpdatedVieports=t,t instanceof Array||(t=[t]),this._cache.reset(),this._frameNumber++,this.traverseCounter=t.length;const e=[];for(const i of t){const t=i.id;this._needTraverse(t)?e.push(t):this.traverseCounter--}for(const i of t){const t=i.id;if(this.roots[t]||(this.roots[t]=this._initializeTileHeaders(this.tileset,null)),!e.includes(t))continue;const n=Vn(i,this._frameNumber);this._traverser.traverse(this.roots[t],n,this.options)}}_needTraverse(t){let e=t;return this.options.viewportTraversersMap&&(e=this.options.viewportTraversersMap[t]),e===t}_onTraversalEnd(t){const e=t.viewport.id;this.frameStateData[e]||(this.frameStateData[e]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const i=this.frameStateData[e],n=Object.values(this._traverser.selectedTiles);i.selectedTiles=n,i._requestedTiles=Object.values(this._traverser.requestedTiles),i._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,this.traverseCounter>0||this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const t in this.frameStateData){const e=this.frameStateData[t];this.selectedTiles=this.selectedTiles.concat(e.selectedTiles),this._requestedTiles=this._requestedTiles.concat(e._requestedTiles),this._emptyTiles=this._emptyTiles.concat(e._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const t of this.selectedTiles)this._tiles[t.id]=t;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(t,e){if(t.length!==e.length)return!0;const i=new Set(t.map((t=>t.id))),n=new Set(e.map((t=>t.id)));let r=t.filter((t=>!n.has(t.id))).length>0;return r=r||e.filter((t=>!i.has(t.id))).length>0,r}_loadTiles(){for(const t of this._requestedTiles)t.contentUnloaded&&this._loadTile(t)}_unloadTiles(){this._cache.unloadTiles(this,((t,e)=>t._unloadTile(e)))}_updateStats(){let t=0,e=0;for(const i of this.selectedTiles)i.contentAvailable&&i.content&&(t++,i.content.pointCount&&(e+=i.content.pointCount));this.stats.get(Ir).count=this.selectedTiles.length,this.stats.get(Dr).count=t,this.stats.get(Fr).count=e}_initializeTileSet(t){this.root=this._initializeTileHeaders(t,null),this.type===or&&this._initializeCesiumTileset(t),this.type===sr&&this._initializeI3STileset(),this._calculateViewProps()}_calculateViewProps(){const t=this.root;d(t);const{center:e}=t.boundingVolume;if(!e)return this.cartographicCenter=new Je,void(this.zoom=1);this.cartographicCenter=Qi.WGS84.cartesianToCartographic(e,new Je),this.cartesianCenter=e,this.zoom=Jn(t.boundingVolume)}_initializeStats(){this.stats.get(Or),this.stats.get(Rr),this.stats.get(Pr),this.stats.get(Ir),this.stats.get(Dr),this.stats.get(Lr),this.stats.get(Br),this.stats.get(Nr),this.stats.get(Fr,"memory"),this.stats.get(Ur,"memory")}_initializeTileHeaders(t,e){const i=new Mr(this,t.root,e);if(e&&(e.children.push(i),i.depth=e.depth+1),this.type===or){const t=[];for(t.push(i);t.length>0;){const e=t.pop();this.stats.get(Or).incrementCount();const i=e.header.children||[];for(const n of i){const i=new Mr(this,n,e);e.children.push(i),i.depth=e.depth+1,t.push(i)}}}return i}_initializeTraverser(){let t;switch(this.type){case or:t=br;break;case sr:t=Er;break;default:t=_r}return new t({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(t){this._destroySubtree(t)}async _loadTile(t){let e;try{this._onStartTileLoading(),e=await t.loadContent()}catch(e){this._onTileLoadError(t,e)}finally{this._onEndTileLoading(),this._onTileLoad(t,e)}}_onTileLoadError(t,e){this.stats.get(Nr).incrementCount();const i=e.message||e.toString(),n=t.url;console.error("A 3D tile failed to load: ".concat(t.url," ").concat(i)),this.options.onTileError(t,i,n)}_onTileLoad(t,e){e&&(t&&t.content&&function(t,e){d(t),d(e);const{rtcCenter:i,gltfUpAxis:n}=e,{computedTransform:r,boundingVolume:{center:s}}=t;let o=new li(r);switch(i&&o.translate(i),n){case"Z":break;case"Y":const t=(new li).rotateX(Math.PI/2);o=o.multiplyRight(t);break;case"X":const e=(new li).rotateY(-Math.PI/2);o=o.multiplyRight(e)}e.isQuantized&&o.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const a=new Je(s);e.cartesianModelMatrix=o,e.cartesianOrigin=a;const l=Qi.WGS84.cartesianToCartographic(a,new Je),c=Qi.WGS84.eastNorthUpToFixedFrame(a).invert();e.cartographicModelMatrix=c.multiplyRight(o),e.cartographicOrigin=l,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}(t,t.content),this._addTileToCache(t),this.options.onTileLoad(t))}_onStartTileLoading(){this._pendingCount++,this.stats.get(Rr).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(Rr).decrementCount()}_addTileToCache(t){this._cache.add(this,t,(e=>e._updateCacheStats(t)))}_updateCacheStats(t){this.stats.get(Lr).incrementCount(),this.stats.get(Pr).incrementCount(),this.gpuMemoryUsageInBytes+=t.content.byteLength||0,this.stats.get(Ur).count=this.gpuMemoryUsageInBytes}_unloadTile(t){this.gpuMemoryUsageInBytes-=t.content&&t.content.byteLength||0,this.stats.get(Pr).decrementCount(),this.stats.get(Br).incrementCount(),this.stats.get(Ur).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}_destroy(){const t=[];for(this.root&&t.push(this.root);t.length>0;){const e=t.pop();for(const i of e.children)t.push(i);this._destroyTile(e)}this.root=null}_destroySubtree(t){const e=t,i=[];for(i.push(e);i.length>0;){t=i.pop();for(const e of t.children)i.push(e);t!==e&&this._destroyTile(t)}e.children=[]}_destroyTile(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}_initializeCesiumTileset(t){if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==this.asset.version)throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed,this.extras=t.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const zr="3.1.4",kr="cmpt",jr="pnts",Hr="b3dm",Vr="i3dm",Wr="glTF";function qr(t,e,i){d(t instanceof ArrayBuffer);const n=new TextDecoder("utf8"),r=new Uint8Array(t,e,i);return n.decode(r)}const Jr={name:"Draco",id:"draco",module:"draco",shapes:["mesh"],version:"3.1.4",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:"object"==typeof WebAssembly?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};class Xr{constructor(t,e){b(this,"fields",void 0),b(this,"metadata",void 0),function(t,e){if(!t)throw new Error(e||"loader assertion failed.")}(Array.isArray(t)),function(t){const e={};for(const i of t)e[i.name]&&i.name,e[i.name]=!0}(t),this.fields=t,this.metadata=e||new Map}compareTo(t){if(this.metadata!==t.metadata)return!1;if(this.fields.length!==t.fields.length)return!1;for(let e=0;e<this.fields.length;++e)if(!this.fields[e].compareTo(t.fields[e]))return!1;return!0}select(...t){const e=Object.create(null);for(const i of t)e[i]=!0;const i=this.fields.filter((t=>e[t.name]));return new Xr(i,this.metadata)}selectAt(...t){const e=t.map((t=>this.fields[t])).filter(Boolean);return new Xr(e,this.metadata)}assign(t){let e,i=this.metadata;if(t instanceof Xr){const n=t;e=n.fields,i=Yr(Yr(new Map,this.metadata),n.metadata)}else e=t;const n=Object.create(null);for(const t of this.fields)n[t.name]=t;for(const t of e)n[t.name]=t;const r=Object.values(n);return new Xr(r,i)}}function Yr(t,e){return new Map([...t||new Map,...e||new Map])}class Zr{constructor(t,e,i=!1,n=new Map){b(this,"name",void 0),b(this,"type",void 0),b(this,"nullable",void 0),b(this,"metadata",void 0),this.name=t,this.type=e,this.nullable=i,this.metadata=n}get typeId(){return this.type&&this.type.typeId}clone(){return new Zr(this.name,this.type,this.nullable,this.metadata)}compareTo(t){return this.name===t.name&&this.type===t.type&&this.nullable===t.nullable&&this.metadata===t.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}let Kr,Qr,$r,ts;!function(t){t[t.NONE=0]="NONE",t[t.Null=1]="Null",t[t.Int=2]="Int",t[t.Float=3]="Float",t[t.Binary=4]="Binary",t[t.Utf8=5]="Utf8",t[t.Bool=6]="Bool",t[t.Decimal=7]="Decimal",t[t.Date=8]="Date",t[t.Time=9]="Time",t[t.Timestamp=10]="Timestamp",t[t.Interval=11]="Interval",t[t.List=12]="List",t[t.Struct=13]="Struct",t[t.Union=14]="Union",t[t.FixedSizeBinary=15]="FixedSizeBinary",t[t.FixedSizeList=16]="FixedSizeList",t[t.Map=17]="Map",t[t.Dictionary=-1]="Dictionary",t[t.Int8=-2]="Int8",t[t.Int16=-3]="Int16",t[t.Int32=-4]="Int32",t[t.Int64=-5]="Int64",t[t.Uint8=-6]="Uint8",t[t.Uint16=-7]="Uint16",t[t.Uint32=-8]="Uint32",t[t.Uint64=-9]="Uint64",t[t.Float16=-10]="Float16",t[t.Float32=-11]="Float32",t[t.Float64=-12]="Float64",t[t.DateDay=-13]="DateDay",t[t.DateMillisecond=-14]="DateMillisecond",t[t.TimestampSecond=-15]="TimestampSecond",t[t.TimestampMillisecond=-16]="TimestampMillisecond",t[t.TimestampMicrosecond=-17]="TimestampMicrosecond",t[t.TimestampNanosecond=-18]="TimestampNanosecond",t[t.TimeSecond=-19]="TimeSecond",t[t.TimeMillisecond=-20]="TimeMillisecond",t[t.TimeMicrosecond=-21]="TimeMicrosecond",t[t.TimeNanosecond=-22]="TimeNanosecond",t[t.DenseUnion=-23]="DenseUnion",t[t.SparseUnion=-24]="SparseUnion",t[t.IntervalDayTime=-25]="IntervalDayTime",t[t.IntervalYearMonth=-26]="IntervalYearMonth"}(Kr||(Kr={}));class es{static isNull(t){return t&&t.typeId===Kr.Null}static isInt(t){return t&&t.typeId===Kr.Int}static isFloat(t){return t&&t.typeId===Kr.Float}static isBinary(t){return t&&t.typeId===Kr.Binary}static isUtf8(t){return t&&t.typeId===Kr.Utf8}static isBool(t){return t&&t.typeId===Kr.Bool}static isDecimal(t){return t&&t.typeId===Kr.Decimal}static isDate(t){return t&&t.typeId===Kr.Date}static isTime(t){return t&&t.typeId===Kr.Time}static isTimestamp(t){return t&&t.typeId===Kr.Timestamp}static isInterval(t){return t&&t.typeId===Kr.Interval}static isList(t){return t&&t.typeId===Kr.List}static isStruct(t){return t&&t.typeId===Kr.Struct}static isUnion(t){return t&&t.typeId===Kr.Union}static isFixedSizeBinary(t){return t&&t.typeId===Kr.FixedSizeBinary}static isFixedSizeList(t){return t&&t.typeId===Kr.FixedSizeList}static isMap(t){return t&&t.typeId===Kr.Map}static isDictionary(t){return t&&t.typeId===Kr.Dictionary}get typeId(){return Kr.NONE}compareTo(t){return this===t}}Qr=Symbol.toStringTag;class is extends es{constructor(t,e){super(),b(this,"isSigned",void 0),b(this,"bitWidth",void 0),this.isSigned=t,this.bitWidth=e}get typeId(){return Kr.Int}get[Qr](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class ns extends is{constructor(){super(!0,8)}}class rs extends is{constructor(){super(!0,16)}}class ss extends is{constructor(){super(!0,32)}}class os extends is{constructor(){super(!1,8)}}class as extends is{constructor(){super(!1,16)}}class ls extends is{constructor(){super(!1,32)}}const cs=32,hs=64;$r=Symbol.toStringTag;class us extends es{constructor(t){super(),b(this,"precision",void 0),this.precision=t}get typeId(){return Kr.Float}get[$r](){return"Float"}toString(){return"Float".concat(this.precision)}}class ds extends us{constructor(){super(cs)}}class ps extends us{constructor(){super(hs)}}ts=Symbol.toStringTag;class fs extends es{constructor(t,e){super(),b(this,"listSize",void 0),b(this,"children",void 0),this.listSize=t,this.children=[e]}get typeId(){return Kr.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[ts](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}function ms(t,e,i){const n=function(t){switch(t.constructor){case Int8Array:return new ns;case Uint8Array:return new os;case Int16Array:return new rs;case Uint16Array:return new as;case Int32Array:return new ss;case Uint32Array:return new ls;case Float32Array:return new ds;case Float64Array:return new ps;default:throw new Error("array type not supported")}}(e.value),r=i||function(t){const e=new Map;"byteOffset"in t&&e.set("byteOffset",t.byteOffset.toString(10));"byteStride"in t&&e.set("byteStride",t.byteStride.toString(10));"normalized"in t&&e.set("normalized",t.normalized.toString());return e}(e);return new Zr(t,new fs(e.size,new Zr("value",n)),!1,r)}function gs(t,e,i){return ms(t,e,i?vs(i.metadata):void 0)}function vs(t){const e=new Map;for(const i in t)e.set("".concat(i,".string"),JSON.stringify(t[i]));return e}const ys={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},_s={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array};class xs{constructor(t){b(this,"draco",void 0),b(this,"decoder",void 0),b(this,"metadataQuerier",void 0),this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t,e={}){const i=new this.draco.DecoderBuffer;i.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(e);const n=this.decoder.GetEncodedGeometryType(i),r=n===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let t;switch(n){case this.draco.TRIANGULAR_MESH:t=this.decoder.DecodeBufferToMesh(i,r);break;case this.draco.POINT_CLOUD:t=this.decoder.DecodeBufferToPointCloud(i,r);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!t.ok()||!r.ptr){const e="DRACO decompression failed: ".concat(t.error_msg());throw new Error(e)}const s=this._getDracoLoaderData(r,n,e),o=this._getMeshData(r,s,e),a=function(t){let e=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,o=-1/0;const a=t.POSITION?t.POSITION.value:[],l=a&&a.length;for(let t=0;t<l;t+=3){const l=a[t],c=a[t+1],h=a[t+2];e=l<e?l:e,i=c<i?c:i,n=h<n?h:n,r=l>r?l:r,s=c>s?c:s,o=h>o?h:o}return[[e,i,n],[r,s,o]]}(o.attributes),l=function(t,e,i){const n=vs(e.metadata),r=[],s=function(t){const e={};for(const i in t){const n=t[i];e[n.name||"undefined"]=n}return e}(e.attributes);for(const e in t){const i=gs(e,t[e],s[e]);r.push(i)}if(i){const t=gs("indices",i);r.push(t)}return new Xr(r,n)}(o.attributes,s,o.indices);return{loader:"draco",loaderData:s,header:{vertexCount:r.num_points(),boundingBox:a},...o,schema:l}}finally{this.draco.destroy(i),r&&this.draco.destroy(r)}}_getDracoLoaderData(t,e,i){const n=this._getTopLevelMetadata(t),r=this._getDracoAttributes(t,i);return{geometry_type:e,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:n,attributes:r}}_getDracoAttributes(t,e){const i={};for(let n=0;n<t.num_attributes();n++){const r=this.decoder.GetAttribute(t,n),s=this._getAttributeMetadata(t,n);i[r.unique_id()]={unique_id:r.unique_id(),attribute_type:r.attribute_type(),data_type:r.data_type(),num_components:r.num_components(),byte_offset:r.byte_offset(),byte_stride:r.byte_stride(),normalized:r.normalized(),attribute_index:n,metadata:s};const o=this._getQuantizationTransform(r,e);o&&(i[r.unique_id()].quantization_transform=o);const a=this._getOctahedronTransform(r,e);a&&(i[r.unique_id()].octahedron_transform=a)}return i}_getMeshData(t,e,i){const n=this._getMeshAttributes(e,t,i);if(!n.POSITION)throw new Error("DRACO: No position attribute found.");return t instanceof this.draco.Mesh?"triangle-strip"===i.topology?{topology:"triangle-strip",mode:4,attributes:n,indices:{value:this._getTriangleStripIndices(t),size:1}}:{topology:"triangle-list",mode:5,attributes:n,indices:{value:this._getTriangleListIndices(t),size:1}}:{topology:"point-list",mode:0,attributes:n}}_getMeshAttributes(t,e,i){const n={};for(const r of Object.values(t.attributes)){const t=this._deduceAttributeName(r,i);r.name=t;const{value:s,size:o}=this._getAttributeValues(e,r);n[t]={value:s,size:o,byteOffset:r.byte_offset,byteStride:r.byte_stride,normalized:r.normalized}}return n}_getTriangleListIndices(t){const e=3*t.num_faces(),i=4*e,n=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(t,i,n),new Uint32Array(this.draco.HEAPF32.buffer,n,e).slice()}finally{this.draco._free(n)}}_getTriangleStripIndices(t){const e=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,e),function(t){const e=t.size(),i=new Int32Array(e);for(let n=0;n<e;n++)i[n]=t.GetValue(n);return i}(e)}finally{this.draco.destroy(e)}}_getAttributeValues(t,e){const i=_s[e.data_type],n=e.num_components,r=t.num_points()*n,s=r*i.BYTES_PER_ELEMENT,o=function(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}(this.draco,i);let a;const l=this.draco._malloc(s);try{const n=this.decoder.GetAttribute(t,e.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,n,o,s,l),a=new i(this.draco.HEAPF32.buffer,l,r).slice()}finally{this.draco._free(l)}return{value:a,size:n}}_deduceAttributeName(t,e){const i=t.unique_id;for(const[t,n]of Object.entries(e.extraAttributes||{}))if(n===i)return t;const n=t.attribute_type;for(const t in ys){if(this.draco[t]===n)return ys[t]}const r=e.attributeNameEntry||"name";return t.metadata[r]?t.metadata[r].string:"CUSTOM_ATTRIBUTE_".concat(i)}_getTopLevelMetadata(t){const e=this.decoder.GetMetadata(t);return this._getDracoMetadata(e)}_getAttributeMetadata(t,e){const i=this.decoder.GetAttributeMetadata(t,e);return this._getDracoMetadata(i)}_getDracoMetadata(t){if(!t||!t.ptr)return{};const e={},i=this.metadataQuerier.NumEntries(t);for(let n=0;n<i;n++){const i=this.metadataQuerier.GetEntryName(t,n);e[i]=this._getDracoMetadataField(t,i)}return e}_getDracoMetadataField(t,e){const i=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,e,i);const n=function(t){const e=t.size(),i=new Int32Array(e);for(let n=0;n<e;n++)i[n]=t.GetValue(n);return i}(i);return{int:this.metadataQuerier.GetIntEntry(t,e),string:this.metadataQuerier.GetStringEntry(t,e),double:this.metadataQuerier.GetDoubleEntry(t,e),intArray:n}}finally{this.draco.destroy(i)}}_disableAttributeTransforms(t){const{quantizedAttributes:e=[],octahedronAttributes:i=[]}=t,n=[...e,...i];for(const t of n)this.decoder.SkipAttributeTransform(this.draco[t])}_getQuantizationTransform(t,e){const{quantizedAttributes:i=[]}=e,n=t.attribute_type();if(i.map((t=>this.decoder[t])).includes(n)){const e=new this.draco.AttributeQuantizationTransform;try{if(e.InitFromAttribute(t))return{quantization_bits:e.quantization_bits(),range:e.range(),min_values:new Float32Array([1,2,3]).map((t=>e.min_value(t)))}}finally{this.draco.destroy(e)}}return null}_getOctahedronTransform(t,e){const{octahedronAttributes:i=[]}=e,n=t.attribute_type();if(i.map((t=>this.decoder[t])).includes(n)){const e=new this.draco.AttributeQuantizationTransform;try{if(e.InitFromAttribute(t))return{quantization_bits:e.quantization_bits()}}finally{this.draco.destroy(e)}}return null}}const Ms="1.4.1",bs="https://www.gstatic.com/draco/versioned/decoders/".concat(Ms,"/draco_decoder.js"),ws="https://www.gstatic.com/draco/versioned/decoders/".concat(Ms,"/draco_wasm_wrapper.js"),Ss="https://www.gstatic.com/draco/versioned/decoders/".concat(Ms,"/draco_decoder.wasm");let Ts;async function As(t){const e=t.modules||{};return Ts=e.draco3d?Ts||e.draco3d.createDecoderModule({}).then((t=>({draco:t}))):Ts||async function(t){let e,i;if("js"===(t.draco&&t.draco.decoderType))e=await U(bs,"draco",t);else[e,i]=await Promise.all([await U(ws,"draco",t),await U(Ss,"draco",t)]);return e=e||globalThis.DracoDecoderModule,await function(t,e){const i={};e&&(i.wasmBinary=e);return new Promise((e=>{t({...i,onModuleLoaded:t=>e({draco:t})})}))}(e,i)}(t),await Ts}const Es={...Jr,parse:async function(t,e){const{draco:i}=await As(e),n=new xs(i);try{return n.parseSync(t,null==e?void 0:e.draco)}finally{n.destroy()}}};const Cs={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},Os={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,...Cs},Ps={[Cs.DOUBLE]:Float64Array,[Cs.FLOAT]:Float32Array,[Cs.UNSIGNED_SHORT]:Uint16Array,[Cs.UNSIGNED_INT]:Uint32Array,[Cs.UNSIGNED_BYTE]:Uint8Array,[Cs.BYTE]:Int8Array,[Cs.SHORT]:Int16Array,[Cs.INT]:Int32Array},Is={DOUBLE:Cs.DOUBLE,FLOAT:Cs.FLOAT,UNSIGNED_SHORT:Cs.UNSIGNED_SHORT,UNSIGNED_INT:Cs.UNSIGNED_INT,UNSIGNED_BYTE:Cs.UNSIGNED_BYTE,BYTE:Cs.BYTE,SHORT:Cs.SHORT,INT:Cs.INT},Ds="Failed to convert GL type";class Ls{static fromTypedArray(t){t=ArrayBuffer.isView(t)?t.constructor:t;for(const e in Ps){if(Ps[e]===t)return e}throw new Error(Ds)}static fromName(t){const e=Is[t];if(!e)throw new Error(Ds);return e}static getArrayType(t){switch(t){case Cs.UNSIGNED_SHORT_5_6_5:case Cs.UNSIGNED_SHORT_4_4_4_4:case Cs.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const e=Ps[t];if(!e)throw new Error(Ds);return e}}static getByteSize(t){return Ls.getArrayType(t).BYTES_PER_ELEMENT}static validate(t){return Boolean(Ls.getArrayType(t))}static createTypedArray(t,e,i=0,n){void 0===n&&(n=(e.byteLength-i)/Ls.getByteSize(t));return new(Ls.getArrayType(t))(e,i,n)}}function Rs(t,e=[0,0,0]){const i=t>>11&31,n=t>>5&63,r=31&t;return e[0]=i<<3,e[1]=n<<2,e[2]=r<<3,e}function Bs(t,e=255){return function(t,e,i){return ye(t,(t=>Math.max(e,Math.min(i,t))))}(t,0,e)/e*2-1}function Ns(t){return t<0?-1:1}function Fs(t,e,i,n){if(function(t,e){if(!t)throw new Error("math.gl assertion failed. ".concat(e))}(n),t<0||t>i||e<0||e>i)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(i));if(n.x=Bs(t,i),n.y=Bs(e,i),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){const t=n.x;n.x=(1-Math.abs(n.y))*Ns(t),n.y=(1-Math.abs(t))*Ns(n.y)}return n.normalize()}new Ne,new Je,new Ne,new Ne;class Us{constructor(t,e){b(this,"json",void 0),b(this,"buffer",void 0),b(this,"featuresLength",0),b(this,"_cachedTypedArrays",{}),this.json=t,this.buffer=e}getExtension(t){return this.json.extensions&&this.json.extensions[t]}hasProperty(t){return Boolean(this.json[t])}getGlobalProperty(t,e=Os.UNSIGNED_INT,i=1){const n=this.json[t];return n&&Number.isFinite(n.byteOffset)?this._getTypedArrayFromBinary(t,e,i,1,n.byteOffset):n}getPropertyArray(t,e,i){const n=this.json[t];return n&&Number.isFinite(n.byteOffset)?("componentType"in n&&(e=Ls.fromName(n.componentType)),this._getTypedArrayFromBinary(t,e,i,this.featuresLength,n.byteOffset)):this._getTypedArrayFromArray(t,e,n)}getProperty(t,e,i,n,r){const s=this.json[t];if(!s)return s;const o=this.getPropertyArray(t,e,i);if(1===i)return o[n];for(let t=0;t<i;++t)r[t]=o[i*n+t];return r}_getTypedArrayFromBinary(t,e,i,n,r){const s=this._cachedTypedArrays;let o=s[t];return o||(o=Ls.createTypedArray(e,this.buffer.buffer,this.buffer.byteOffset+r,n*i),s[t]=o),o}_getTypedArrayFromArray(t,e,i){const n=this._cachedTypedArrays;let r=n[t];return r||(r=Ls.createTypedArray(e,i),n[t]=r),r}}const Gs={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},zs={SCALAR:(t,e)=>t[e],VEC2:(t,e)=>[t[2*e+0],t[2*e+1]],VEC3:(t,e)=>[t[3*e+0],t[3*e+1],t[3*e+2]],VEC4:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT2:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT3:(t,e)=>[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]],MAT4:(t,e)=>[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]},ks={SCALAR:(t,e,i)=>{e[i]=t},VEC2:(t,e,i)=>{e[2*i+0]=t[0],e[2*i+1]=t[1]},VEC3:(t,e,i)=>{e[3*i+0]=t[0],e[3*i+1]=t[1],e[3*i+2]=t[2]},VEC4:(t,e,i)=>{e[4*i+0]=t[0],e[4*i+1]=t[1],e[4*i+2]=t[2],e[4*i+3]=t[3]},MAT2:(t,e,i)=>{e[4*i+0]=t[0],e[4*i+1]=t[1],e[4*i+2]=t[2],e[4*i+3]=t[3]},MAT3:(t,e,i)=>{e[9*i+0]=t[0],e[9*i+1]=t[1],e[9*i+2]=t[2],e[9*i+3]=t[3],e[9*i+4]=t[4],e[9*i+5]=t[5],e[9*i+6]=t[6],e[9*i+7]=t[7],e[9*i+8]=t[8],e[9*i+9]=t[9]},MAT4:(t,e,i)=>{e[16*i+0]=t[0],e[16*i+1]=t[1],e[16*i+2]=t[2],e[16*i+3]=t[3],e[16*i+4]=t[4],e[16*i+5]=t[5],e[16*i+6]=t[6],e[16*i+7]=t[7],e[16*i+8]=t[8],e[16*i+9]=t[9],e[16*i+10]=t[10],e[16*i+11]=t[11],e[16*i+12]=t[12],e[16*i+13]=t[13],e[16*i+14]=t[14],e[16*i+15]=t[15]}};const js=t=>void 0!==t;function Hs(t,e,i){if(!e)return null;let n=t.getExtension("3DTILES_batch_table_hierarchy");const r=e.HIERARCHY;return r&&(e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=r,n=r),n?function(t,e){let i,n,r;const s=t.instancesLength,o=t.classes;let a,l=t.classIds,c=t.parentCounts,h=t.parentIds,u=s;js(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,r=getBinaryAccessor(l),l=r.createArrayBufferView(e.buffer,e.byteOffset+l.byteOffset,s));if(js(c))for(js(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,r=getBinaryAccessor(c),c=r.createArrayBufferView(e.buffer,e.byteOffset+c.byteOffset,s)),a=new Uint16Array(s),u=0,i=0;i<s;++i)a[i]=u,u+=c[i];js(h)&&js(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,r=getBinaryAccessor(h),h=r.createArrayBufferView(e.buffer,e.byteOffset+h.byteOffset,u));const d=o.length;for(i=0;i<d;++i){const t=o[i].length,n=o[i].instances,r=getBinaryProperties(t,n,e);o[i].instances=combine(r,n)}const p=new Array(d).fill(0),f=new Uint16Array(s);for(i=0;i<s;++i)n=l[i],f[i]=p[n],++p[n];const m={classes:o,classIds:l,classIndexes:f,parentCounts:c,parentIndexes:a,parentIds:h};return function(t){const e=t.classIds.length;for(let i=0;i<e;++i)Ws(t,i,stack)}(m),m}(n,i):null}function Vs(t,e,i){if(!t)return;const n=t.parentCounts;return t.parentIds?i(t,e):n>0?function(t,e,i){const n=t.classIds,r=t.parentCounts,s=t.parentIds,o=t.parentIndexes,a=n.length,l=scratchVisited;l.length=Math.max(l.length,a);const c=++marker,h=scratchStack;h.length=0,h.push(e);for(;h.length>0;){if(l[e=h.pop()]===c)continue;l[e]=c;const n=i(t,e);if(js(n))return n;const a=r[e],u=o[e];for(let t=0;t<a;++t){const i=s[u+t];i!==e&&h.push(i)}}return null}(t,e,i):function(t,e,i){let n=!0;for(;n;){const r=i(t,e);if(js(r))return r;const s=t.parentIds[e];n=s!==e,e=s}throw new Error("traverseHierarchySingleParent")}(t,e,i)}function Ws(t,e,i){const n=t.parentCounts,r=t.parentIds,s=t.parentIndexes,o=t.classIds.length;if(!js(r))return;assert(e<o,"Parent index ".concat(e," exceeds the total number of instances: ").concat(o)),assert(-1===i.indexOf(e),"Circular dependency detected in the batch table hierarchy."),i.push(e);const a=js(n)?n[e]:1,l=js(n)?s[e]:e;for(let n=0;n<a;++n){const s=r[l+n];s!==e&&Ws(t,s,i)}i.pop(e)}function qs(t){return null!=t}const Js=(t,e)=>t,Xs={HIERARCHY:!0,extensions:!0,extras:!0};class Ys{constructor(t,e,i,n={}){var r;b(this,"json",void 0),b(this,"binary",void 0),b(this,"featureCount",void 0),b(this,"_extensions",void 0),b(this,"_properties",void 0),b(this,"_binaryProperties",void 0),b(this,"_hierarchy",void 0),d(i>=0),this.json=t||{},this.binary=e,this.featureCount=i,this._extensions=(null===(r=this.json)||void 0===r?void 0:r.extensions)||{},this._properties={};for(const t in this.json)Xs[t]||(this._properties[t]=this.json[t]);this._binaryProperties=this._initializeBinaryProperties(),n["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=Hs(this,this.json,this.binary))}getExtension(t){return this.json&&this.json.extensions&&this.json.extensions[t]}memorySizeInBytes(){return 0}isClass(t,e){if(this._checkBatchId(t),d("string"==typeof e,e),this._hierarchy){return qs(Vs(this._hierarchy,t,((t,i)=>{const n=t.classIds[i];return t.classes[n].name===e})))}return!1}isExactClass(t,e){return d("string"==typeof e,e),this.getExactClassName(t)===e}getExactClassName(t){if(this._checkBatchId(t),this._hierarchy){const e=this._hierarchy.classIds[t];return this._hierarchy.classes[e].name}}hasProperty(t,e){return this._checkBatchId(t),d("string"==typeof e,e),qs(this._properties[e])||this._hasPropertyInHierarchy(t,e)}getPropertyNames(t,e){this._checkBatchId(t),(e=qs(e)?e:[]).length=0;const i=Object.keys(this._properties);return e.push(...i),this._hierarchy&&this._getPropertyNamesInHierarchy(t,e),e}getProperty(t,e){if(this._checkBatchId(t),d("string"==typeof e,e),this._binaryProperties){const i=this._binaryProperties[e];if(qs(i))return this._getBinaryProperty(i,t)}const i=this._properties[e];if(qs(i))return Js(i[t]);if(this._hierarchy){const i=this._getHierarchyProperty(t,e);if(qs(i))return i}}setProperty(t,e,i){const n=this.featureCount;if(this._checkBatchId(t),d("string"==typeof e,e),this._binaryProperties){const n=this._binaryProperties[e];if(n)return void this._setBinaryProperty(n,t,i)}if(this._hierarchy&&this._setHierarchyProperty(this,t,e,i))return;let r=this._properties[e];qs(r)||(this._properties[e]=new Array(n),r=this._properties[e]),r[t]=Js(i)}_checkBatchId(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(t,e){return t.unpack(t.typedArray,e)}_setBinaryProperty(t,e,i){t.pack(i,t.typedArray,e)}_initializeBinaryProperties(){let t=null;for(const e in this._properties){const i=this._properties[e],n=this._initializeBinaryProperty(e,i);n&&(t=t||{},t[e]=n)}return t}_initializeBinaryProperty(t,e){if("byteOffset"in e){const i=e;d(this.binary,"Property ".concat(t," requires a batch table binary.")),d(i.type,"Property ".concat(t," requires a type."));const n=function(t,e,i,n){const{componentType:r}=t;d(t.componentType);const s="string"==typeof r?Ls.fromName(r):r,o=Gs[t.type],a=zs[t.type],l=ks[t.type];return i+=t.byteOffset,{values:Ls.createTypedArray(s,e,i,o*n),type:s,size:o,unpacker:a,packer:l}}(i,this.binary.buffer,0|this.binary.byteOffset,this.featureCount);return{typedArray:n.values,componentCount:n.size,unpack:n.unpacker,pack:n.packer}}return null}_hasPropertyInHierarchy(t,e){if(!this._hierarchy)return!1;const i=Vs(this._hierarchy,t,((t,i)=>{const n=t.classIds[i];return qs(t.classes[n].instances[e])}));return qs(i)}_getPropertyNamesInHierarchy(t,e){Vs(this._hierarchy,t,((t,i)=>{const n=t.classIds[i],r=t.classes[n].instances;for(const t in r)r.hasOwnProperty(t)&&-1===e.indexOf(t)&&e.push(t)}))}_getHierarchyProperty(t,e){return Vs(this._hierarchy,t,((t,i)=>{const n=t.classIds[i],r=t.classes[n],s=t.classIndexes[i],o=r.instances[e];return qs(o)?qs(o.typedArray)?this._getBinaryProperty(o,s):Js(o[s]):null}))}_setHierarchyProperty(t,e,i,n){const r=Vs(this._hierarchy,e,((t,r)=>{const s=t.classIds[r],o=t.classes[s],a=t.classIndexes[r],l=o.instances[i];return!!qs(l)&&(d(r===e,'Inherited property "'.concat(i,'" is read-only.')),qs(l.typedArray)?this._setBinaryProperty(l,a,n):l[a]=Js(n),!0)}));return qs(r)}}function Zs(t,e,i=0){const n=new DataView(e);if(t.magic=n.getUint32(i,!0),i+=4,t.version=n.getUint32(i,!0),i+=4,t.byteLength=n.getUint32(i,!0),i+=4,1!==t.version)throw new Error("3D Tile Version ".concat(t.version," not supported"));return i}function Ks(t,e,i){const n=new DataView(e);let r;t.header=t.header||{};let s=n.getUint32(i,!0);i+=4;let o=n.getUint32(i,!0);i+=4;let a=n.getUint32(i,!0);i+=4;let l=n.getUint32(i,!0);return i+=4,a>=570425344?(i-=8,r=s,a=o,l=0,s=0,o=0):l>=570425344&&(i-=4,r=a,a=s,l=o,s=0,o=0),t.header.featureTableJsonByteLength=s,t.header.featureTableBinaryByteLength=o,t.header.batchTableJsonByteLength=a,t.header.batchTableBinaryByteLength=l,t.header.batchLength=r,i}function Qs(t,e,i,n){return i=function(t,e,i,n){const{featureTableJsonByteLength:r,featureTableBinaryByteLength:s,batchLength:o}=t.header;if(t.featureTableJson={BATCH_LENGTH:o||0},r>0){const n=qr(e,i,r);t.featureTableJson=JSON.parse(n)}return i+=r,t.featureTableBinary=new Uint8Array(e,i,s),i+=s}(t,e,i),i=function(t,e,i,n){const{batchTableJsonByteLength:r,batchTableBinaryByteLength:s}=t.header;if(r>0){const n=qr(e,i,r);t.batchTableJson=JSON.parse(n),i+=r,s>0&&(t.batchTableBinary=new Uint8Array(e,i,s),t.batchTableBinary=new Uint8Array(t.batchTableBinary),i+=s)}return i}(t,e,i),i}function $s(t,e,i){if(!(e||t&&t.batchIds&&i))return null;const{batchIds:n,isRGB565:r,pointCount:s}=t;if(n&&i){const t=new Uint8ClampedArray(3*s);for(let e=0;e<s;e++){const r=n[e],s=i.getProperty(r,"dimensions").map((t=>255*t));t[3*e]=s[0],t[3*e+1]=s[1],t[3*e+2]=s[2]}return{type:Os.UNSIGNED_BYTE,value:t,size:3,normalized:!0}}if(r){const t=new Uint8ClampedArray(3*s);for(let i=0;i<s;i++){const n=Rs(e[i]);t[3*i]=n[0],t[3*i+1]=n[1],t[3*i+2]=n[2]}return{type:Os.UNSIGNED_BYTE,value:t,size:3,normalized:!0}}return e&&e.length===3*s?{type:Os.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:Os.UNSIGNED_BYTE,value:e,size:4,normalized:!0}}const to=new Je;function eo(t,e,i){return t.isQuantized?i["3d-tiles"]&&i["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,function(t,e){const i=new Je,n=new Float32Array(3*t.pointCount);for(let r=0;r<t.pointCount;r++)i.set(e[3*r],e[3*r+1],e[3*r+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(n,3*r);return n}(t,e)):{type:Os.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}async function io(t,e,i,n,r){i=Qs(t,e,i=Ks(t,e,i=Zs(t,e,i))),function(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}(t);const{featureTable:s,batchTable:o}=function(t){const e=new Us(t.featureTableJson,t.featureTableBinary),i=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(i))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=i,t.featuresLength=i,t.pointsLength=i,t.pointCount=i,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",Os.FLOAT,3);const n=function(t,e){let i=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",Os.UNSIGNED_SHORT,1),t.batchIds)){const n=e.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:r,batchTableBinary:s}=t;i=new Ys(r,s,n)}return i}(t,e);return{featureTable:e,batchTable:n}}(t);return await async function(t,e,i,n,r){let s,o,a;const l=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];l&&(a=l.properties);const c=e.getExtension("3DTILES_draco_point_compression");if(c){o=c.properties;const e=c.byteOffset,i=c.byteLength;if(!o||!Number.isFinite(e)||!i)throw new Error("Draco properties, byteOffset, and byteLength must be defined");s=t.featureTableBinary.slice(e,e+i),t.hasPositions=Number.isFinite(o.POSITION),t.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),t.hasNormals=Number.isFinite(o.NORMAL),t.hasBatchIds=Number.isFinite(o.BATCH_ID),t.isTranslucent=Number.isFinite(o.RGBA)}if(!s)return!0;const h={buffer:s,properties:{...o,...a},featureTableProperties:o,batchTableProperties:a,dequantizeInShader:!1};return await async function(t,e,i,n){const{parse:r}=n,s={...i,draco:{...i.draco,extraAttributes:e.batchTableProperties||{}}};delete s["3d-tiles"];const o=await r(e.buffer,Es,s),a=o.attributes.POSITION&&o.attributes.POSITION.value,l=o.attributes.COLOR_0&&o.attributes.COLOR_0.value,c=o.attributes.NORMAL&&o.attributes.NORMAL.value,h=o.attributes.BATCH_ID&&o.attributes.BATCH_ID.value,u=a&&o.attributes.POSITION.value.quantization,d=c&&o.attributes.NORMAL.value.quantization;if(u){const e=o.POSITION.data.quantization,i=e.range;t.quantizedVolumeScale=new Je(i,i,i),t.quantizedVolumeOffset=new Je(e.minValues),t.quantizedRange=(1<<e.quantizationBits)-1,t.isQuantizedDraco=!0}d&&(t.octEncodedRange=(1<<o.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);const p={};if(e.batchTableProperties)for(const t of Object.keys(e.batchTableProperties))o.attributes[t]&&o.attributes[t].value&&(p[t.toLowerCase()]=o.attributes[t].value);t.attributes={positions:a,colors:$s(t,l,void 0),normals:c,batchIds:h,...p}}(t,h,n,r)}(t,s,0,n,r),function(t,e,i){if(!t.attributes.positions)if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",Os.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const n=e.getPropertyArray("POSITION_QUANTIZED",Os.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65535,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Os.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Os.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=eo(t,n,i)}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}(t,s,n),function(t,e,i){if(!t.attributes.colors){let n=null;e.hasProperty("RGBA")?(n=e.getPropertyArray("RGBA",Os.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?n=e.getPropertyArray("RGB",Os.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(n=e.getPropertyArray("RGB565",Os.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=$s(t,n,i)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",Os.UNSIGNED_BYTE,4))}(t,s,o),function(t,e){if(!t.attributes.normals){let i=null;e.hasProperty("NORMAL")?i=e.getPropertyArray("NORMAL",Os.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(i=e.getPropertyArray("NORMAL_OCT16P",Os.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=function(t,e){if(!e)return null;if(t.isOctEncoded16P){const r=new Float32Array(3*t.pointsLength);for(let s=0;s<t.pointsLength;s++)i=e[2*s],n=e[2*s+1],Fs(i,n,255,to),to.toArray(r,3*s);return{type:Os.FLOAT,size:2,value:r}}var i,n;return{type:Os.FLOAT,size:2,value:e}}(t,i)}}(t,s),i}const no="3.1.4",ro="https://unpkg.com/@loaders.gl/textures@".concat(no,"/dist/libs/basis_encoder.wasm"),so="https://unpkg.com/@loaders.gl/textures@".concat(no,"/dist/libs/basis_encoder.js");let oo,ao;async function lo(t){const e=t.modules||{};return e.basis?e.basis:(oo=oo||async function(t){let e=null,i=null;return[e,i]=await Promise.all([await U("basis_transcoder.js","textures",t),await U("basis_transcoder.wasm","textures",t)]),e=e||globalThis.BASIS,await function(t,e){const i={};e&&(i.wasmBinary=e);return new Promise((e=>{t(i).then((t=>{const{BasisFile:i,initializeBasis:n}=t;n(),e({BasisFile:i})}))}))}(e,i)}(t),await oo)}async function co(t){const e=t.modules||{};return e.basisEncoder?e.basisEncoder:(ao=ao||async function(t){let e=null,i=null;return[e,i]=await Promise.all([await U(so,"textures",t),await U(ro,"textures",t)]),e=e||globalThis.BASIS,await function(t,e){const i={};e&&(i.wasmBinary=e);return new Promise((e=>{t(i).then((t=>{const{BasisFile:i,KTX2File:n,initializeBasis:r,BasisEncoder:s}=t;r(),e({BasisFile:i,KTX2File:n,BasisEncoder:s})}))}))}(e,i)}(t),await ao)}const ho=33776,uo=33779,po=35840,fo=35842,mo=36196,go=37808,vo=["","WEBKIT_","MOZ_"],yo={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let _o=null;function xo(t){if(!_o){t=t||function(){try{return document.createElement("canvas").getContext("webgl")}catch(t){return null}}()||void 0,_o=new Set;for(const e of vo)for(const i in yo)if(t&&t.getExtension("".concat(e).concat(i))){const t=yo[i];_o.add(t)}}return _o}var Mo,bo,wo,So,To,Ao,Eo,Co,Oo;(Oo=Mo||(Mo={}))[Oo.NONE=0]="NONE",Oo[Oo.BASISLZ=1]="BASISLZ",Oo[Oo.ZSTD=2]="ZSTD",Oo[Oo.ZLIB=3]="ZLIB",function(t){t[t.BASICFORMAT=0]="BASICFORMAT"}(bo||(bo={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.ETC1S=163]="ETC1S",t[t.UASTC=166]="UASTC"}(wo||(wo={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.SRGB=1]="SRGB"}(So||(So={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.LINEAR=1]="LINEAR",t[t.SRGB=2]="SRGB",t[t.ITU=3]="ITU",t[t.NTSC=4]="NTSC",t[t.SLOG=5]="SLOG",t[t.SLOG2=6]="SLOG2"}(To||(To={})),function(t){t[t.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",t[t.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(Ao||(Ao={})),function(t){t[t.RGB=0]="RGB",t[t.RRR=3]="RRR",t[t.GGG=4]="GGG",t[t.AAA=15]="AAA"}(Eo||(Eo={})),function(t){t[t.RGB=0]="RGB",t[t.RGBA=3]="RGBA",t[t.RRR=4]="RRR",t[t.RRRG=5]="RRRG"}(Co||(Co={}));const Po=[171,75,84,88,32,50,48,187,13,10,26,10];const Io={etc1:{basisFormat:0,compressed:!0,format:mo},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:ho},bc3:{basisFormat:3,compressed:!0,format:uo},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:po},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:fo},"astc-4x4":{basisFormat:10,compressed:!0,format:go},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};function Do(t,e,i){const n=new t(new Uint8Array(e));try{if(!n.startTranscoding())return null;const t=n.getNumImages(),e=[];for(let r=0;r<t;r++){const t=n.getNumLevels(r),s=[];for(let e=0;e<t;e++)s.push(Lo(n,r,e,i));e.push(s)}return e}finally{n.close(),n.delete()}}function Lo(t,e,i,n){const r=t.getImageWidth(e,i),s=t.getImageHeight(e,i),o=t.getHasAlpha(),{compressed:a,format:l,basisFormat:c}=No(n,o),h=t.getImageTranscodedSizeInBytes(e,i,c),u=new Uint8Array(h);return t.transcodeImage(u,e,i,c,0,0)?{width:r,height:s,data:u,compressed:a,hasAlpha:o,format:l}:null}function Ro(t,e,i){const n=new t(new Uint8Array(e));try{if(!n.startTranscoding())return null;const t=n.getLevels(),e=[];for(let r=0;r<t;r++){e.push(Bo(n,r,i));break}return e}finally{n.close(),n.delete()}}function Bo(t,e,i){const{alphaFlag:n,height:r,width:s}=t.getImageLevelInfo(e,0,0),{compressed:o,format:a,basisFormat:l}=No(i,n),c=t.getImageTranscodedSizeInBytes(e,0,0,l),h=new Uint8Array(c);return t.transcodeImage(h,e,0,0,l,0,-1,-1)?{width:s,height:r,data:h,compressed:o,alphaFlag:n,format:a}:null}function No(t,e){let i=t&&t.basis&&t.basis.format;return"auto"===i&&(i=Fo()),"object"==typeof i&&(i=e?i.alpha:i.noAlpha),i=i.toLowerCase(),Io[i]}function Fo(){const t=xo();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}const Uo={...{name:"Basis",id:"basis",module:"textures",version:"3.1.4",worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},parse:async function(t,e){if("auto"===e.basis.containerFormat){if(function(t){const e=new Uint8Array(t);return!(e.byteLength<Po.length||e[0]!==Po[0]||e[1]!==Po[1]||e[2]!==Po[2]||e[3]!==Po[3]||e[4]!==Po[4]||e[5]!==Po[5]||e[6]!==Po[6]||e[7]!==Po[7]||e[8]!==Po[8]||e[9]!==Po[9]||e[10]!==Po[10]||e[11]!==Po[11])}(t)){return Ro((await co(e)).KTX2File,t,e)}const{BasisFile:i}=await lo(e);return Do(i,t,e)}if("encoder"===e.basis.module){const i=await co(e);return"ktx2"===e.basis.containerFormat?Ro(i.KTX2File,t,e):Do(i.BasisFile,t,e)}{const{BasisFile:i}=await lo(e);return Do(i,t,e)}}},{_parseImageNode:Go}=globalThis,zo="undefined"!=typeof Image,ko="undefined"!=typeof ImageBitmap,jo=Boolean(Go),Ho=!!p||jo;function Vo(t){const e=function(t){if("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap)return"imagebitmap";if("undefined"!=typeof Image&&t instanceof Image)return"image";if(t&&"object"==typeof t&&t.data&&t.width&&t.height)return"data";return null}(t);if(!e)throw new Error("Not an image");return e}const Wo=/^data:image\/svg\+xml/,qo=/\.svg((\?|#).*)?$/;function Jo(t){return t&&(Wo.test(t)||qo.test(t))}function Xo(t,e){if(Jo(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function Yo(t,e,i){const n=function(t,e){if(Jo(e)){let e=(new TextDecoder).decode(t);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(e=unescape(encodeURIComponent(e)))}catch(t){throw new Error(t.message)}return"data:image/svg+xml;base64,".concat(btoa(e))}return Xo(t,e)}(t,i),r=self.URL||self.webkitURL,s="string"!=typeof n&&r.createObjectURL(n);try{return await async function(t,e){const i=new Image;if(i.src=t,e.image&&e.image.decode&&i.decode)return await i.decode(),i;return await new Promise(((e,n)=>{try{i.onload=()=>e(i),i.onerror=e=>n(new Error("Could not load image ".concat(t,": ").concat(e)))}catch(t){n(t)}}))}(s||n,e)}finally{s&&r.revokeObjectURL(s)}}const Zo={};let Ko=!0;async function Qo(t,e,i){let n;if(Jo(i)){n=await Yo(t,e,i)}else n=Xo(t,i);const r=e&&e.imagebitmap;return await async function(t,e=null){!function(t){for(const e in t||Zo)return!1;return!0}(e)&&Ko||(e=null);if(e)try{return await createImageBitmap(t,e)}catch(t){Ko=!1}return await createImageBitmap(t)}(n,r)}const $o=!1,ta=!0;function ea(t){const e=ia(t);return function(t){const e=ia(t);if(!(e.byteLength>=24&&2303741511===e.getUint32(0,$o)))return null;return{mimeType:"image/png",width:e.getUint32(16,$o),height:e.getUint32(20,$o)}}(e)||function(t){const e=ia(t);if(!(e.byteLength>=3&&65496===e.getUint16(0,$o)&&255===e.getUint8(2)))return null;const{tableMarkers:i,sofMarkers:n}=function(){const t=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)t.add(e);const e=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:t,sofMarkers:e}}();let r=2;for(;r+9<e.byteLength;){const t=e.getUint16(r,$o);if(n.has(t))return{mimeType:"image/jpeg",height:e.getUint16(r+5,$o),width:e.getUint16(r+7,$o)};if(!i.has(t))return null;r+=2,r+=e.getUint16(r,$o)}return null}(e)||function(t){const e=ia(t);if(!(e.byteLength>=10&&1195984440===e.getUint32(0,$o)))return null;return{mimeType:"image/gif",width:e.getUint16(6,ta),height:e.getUint16(8,ta)}}(e)||function(t){const e=ia(t);if(!(e.byteLength>=14&&16973===e.getUint16(0,$o)&&e.getUint32(2,ta)===e.byteLength))return null;return{mimeType:"image/bmp",width:e.getUint32(18,ta),height:e.getUint32(22,ta)}}(e)}function ia(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}const na={id:"image",module:"images",name:"Images",version:"3.1.4",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg"],parse:async function(t,e,i){const n=((e=e||{}).image||{}).type||"auto",{url:r}=i||{};let s;switch(function(t){switch(t){case"auto":case"data":return function(){if(ko)return"imagebitmap";if(zo)return"image";if(Ho)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(t){switch(t){case"auto":return ko||zo||Ho;case"imagebitmap":return ko;case"image":return zo;case"data":return Ho;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}(t),t}}(n)){case"imagebitmap":s=await Qo(t,e,r);break;case"image":s=await Yo(t,e,r);break;case"data":s=await async function(t,e){const{mimeType:i}=ea(t)||{},n=globalThis._parseImageNode;return d(n),await n(t,i)}(t);break;default:d(!1)}return"data"===n&&(s=function(t){switch(Vo(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),i=e.getContext("2d");if(!i)throw new Error("getImageData");return e.width=t.width,e.height=t.height,i.drawImage(t,0,0),i.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}(s)),s},tests:[t=>Boolean(ea(new DataView(t)))],options:{image:{type:"auto",decode:!0}}},ra=["image/png","image/jpeg","image/gif"],sa={};function oa(t){return void 0===sa[t]&&(sa[t]=function(t){switch(t){case"image/webp":return function(){if(!p)return!1;try{return 0===document.createElement("canvas").toDataURL("image/webp").indexOf("data:image/webp")}catch{return!1}}();case"image/svg":return p;default:if(!p){const{_parseImageNode:e}=globalThis;return Boolean(e)&&ra.includes(t)}return!0}}(t)),sa[t]}function aa(t,e){if(!t)throw new Error(e||"assert failed: gltf")}function la(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const i=e.baseUri||e.uri;if(!i)throw new Error("'baseUri' must be provided to resolve relative url ".concat(t));return i.substr(0,i.lastIndexOf("/")+1)+t}const ca=["SCALAR","VEC2","VEC3","VEC4"],ha=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],ua=new Map(ha),da={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},pa={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},fa={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function ma(t){return ca[t-1]||ca[0]}function ga(t){const e=ua.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function va(t,e){const i=fa[t.componentType],n=da[t.type],r=pa[t.componentType],s=t.count*n,o=t.count*n*r;return aa(o>=0&&o<=e.byteLength),{ArrayType:i,length:s,byteLength:o}}const ya={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class _a{constructor(t){b(this,"gltf",void 0),b(this,"sourceBuffers",void 0),b(this,"byteLength",void 0),this.gltf=t||{json:{...ya},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(t){return this.json[t]}getExtraData(t){return(this.json.extras||{})[t]}getExtension(t){const e=this.getUsedExtensions().find((e=>e===t)),i=this.json.extensions||{};return e?i[t]||!0:null}getRequiredExtension(t){return this.getRequiredExtensions().find((e=>e===t))?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getObjectExtension(t,e){return(t.extensions||{})[e]}getScene(t){return this.getObject("scenes",t)}getNode(t){return this.getObject("nodes",t)}getSkin(t){return this.getObject("skins",t)}getMesh(t){return this.getObject("meshes",t)}getMaterial(t){return this.getObject("materials",t)}getAccessor(t){return this.getObject("accessors",t)}getTexture(t){return this.getObject("textures",t)}getSampler(t){return this.getObject("samplers",t)}getImage(t){return this.getObject("images",t)}getBufferView(t){return this.getObject("bufferViews",t)}getBuffer(t){return this.getObject("buffers",t)}getObject(t,e){if("object"==typeof e)return e;const i=this.json[t]&&this.json[t][e];if(!i)throw new Error("glTF file error: Could not find ".concat(t,"[").concat(e,"]"));return i}getTypedArrayForBufferView(t){const e=(t=this.getBufferView(t)).buffer,i=this.gltf.buffers[e];aa(i);const n=(t.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,n,t.byteLength)}getTypedArrayForAccessor(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),i=this.getBuffer(e.buffer).data,{ArrayType:n,length:r}=va(t,e);return new n(i,e.byteOffset+t.byteOffset,r)}getTypedArrayForImageData(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),i=this.getBuffer(e.buffer).data,n=e.byteOffset||0;return new Uint8Array(i,n,e.byteLength)}addApplicationData(t,e){return this.json[t]=e,this}addExtraData(t,e){return this.json.extras=this.json.extras||{},this.json.extras[t]=e,this}addObjectExtension(t,e,i){return t.extensions=t.extensions||{},t.extensions[e]=i,this.registerUsedExtension(e),this}setObjectExtension(t,e,i){(t.extensions||{})[e]=i}removeObjectExtension(t,e){const i=t.extensions||{},n=i[e];return delete i[e],n}addExtension(t,e={}){return aa(e),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=e,this.registerUsedExtension(t),e}addRequiredExtension(t,e={}){return aa(e),this.addExtension(t,e),this.registerRequiredExtension(t),e}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find((e=>e===t))||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find((e=>e===t))||this.json.extensionsRequired.push(t)}removeExtension(t){this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t),this.json.extensions&&delete this.json.extensions[t]}setDefaultScene(t){this.json.scene=t}addScene(t){const{nodeIndices:e}=t;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:e}),this.json.scenes.length-1}addNode(t){const{meshIndex:e,matrix:i}=t;this.json.nodes=this.json.nodes||[];const n={mesh:e};return i&&(n.matrix=i),this.json.nodes.push(n),this.json.nodes.length-1}addMesh(t){const{attributes:e,indices:i,material:n,mode:r=4}=t,s={primitives:[{attributes:this._addAttributes(e),mode:r}]};if(i){const t=this._addIndices(i);s.primitives[0].indices=t}return Number.isFinite(n)&&(s.primitives[0].material=n),this.json.meshes=this.json.meshes||[],this.json.meshes.push(s),this.json.meshes.length-1}addPointCloud(t){const e={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(e),this.json.meshes.length-1}addImage(t,e){const i=ea(t),n=e||(null==i?void 0:i.mimeType),r={bufferView:this.addBufferView(t),mimeType:n};return this.json.images=this.json.images||[],this.json.images.push(r),this.json.images.length-1}addBufferView(t){const e=t.byteLength;aa(Number.isFinite(e)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);const i={buffer:0,byteOffset:this.byteLength,byteLength:e};return this.byteLength+=q(e,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(i),this.json.bufferViews.length-1}addAccessor(t,e){const i={bufferView:t,type:ma(e.size),componentType:e.componentType,count:e.count,max:e.max,min:e.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(i),this.json.accessors.length-1}addBinaryBuffer(t,e={size:3}){const i=this.addBufferView(t);let n={min:e.min,max:e.max};n.min&&n.max||(n=this._getAccessorMinMax(t,e.size));const r={size:e.size,componentType:ga(t),count:Math.round(t.length/e.size),min:n.min,max:n.max};return this.addAccessor(i,Object.assign(r,e))}addTexture(t){const{imageIndex:e}=t,i={source:e};return this.json.textures=this.json.textures||[],this.json.textures.push(i),this.json.textures.length-1}addMaterial(t){return this.json.materials=this.json.materials||[],this.json.materials.push(t),this.json.materials.length-1}createBinaryChunk(){var t,e;this.gltf.buffers=[];const i=this.byteLength,n=new ArrayBuffer(i),r=new Uint8Array(n);let s=0;for(const t of this.sourceBuffers||[])s=J(t,r,s);null!==(t=this.json)&&void 0!==t&&null!==(e=t.buffers)&&void 0!==e&&e[0]?this.json.buffers[0].byteLength=i:this.json.buffers=[{byteLength:i}],this.gltf.binary=n,this.sourceBuffers=[n]}_removeStringFromArray(t,e){let i=!0;for(;i;){const n=t.indexOf(e);n>-1?t.splice(n,1):i=!1}}_addAttributes(t={}){const e={};for(const i in t){const n=t[i],r=this._getGltfAttributeName(i),s=this.addBinaryBuffer(n.value,n);e[r]=s}return e}_addIndices(t){return this.addBinaryBuffer(t,{size:1})}_getGltfAttributeName(t){switch(t.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return t}}_getAccessorMinMax(t,e){const i={min:null,max:null};if(t.length<e)return i;i.min=[],i.max=[];const n=t.subarray(0,e);for(const t of n)i.min.push(t),i.max.push(t);for(let n=e;n<t.length;n+=e)for(let r=0;r<e;r++)i.min[0+r]=Math.min(i.min[0+r],t[n+r]),i.max[0+r]=Math.max(i.max[0+r],t[n+r]);return i}}const xa="object"!=typeof WebAssembly,Ma="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",ba="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",wa=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),Sa=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),Ta={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Aa={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function Ea(t,e,i,n,r,s="NONE"){const o=await async function(){Ca||(Ca=async function(){let t=Ma;WebAssembly.validate(wa)&&(t=ba);const e=await WebAssembly.instantiate(function(t){const e=new Uint8Array(t.length);for(let i=0;i<t.length;++i){const n=t.charCodeAt(i);e[i]=n>96?n-71:n>64?n-65:n>47?n+4:n>46?63:62}let i=0;for(let n=0;n<t.length;++n)e[i++]=e[n]<60?Sa[e[n]]:64*(e[n]-60)+e[++n];return e.buffer.slice(0,i)}(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}());return Ca}();!function(t,e,i,n,r,s,o){const a=t.exports.sbrk,l=n+3&-4,c=a(l*r),h=a(s.length),u=new Uint8Array(t.exports.memory.buffer);u.set(s,h);const d=e(c,n,r,h,s.length);0===d&&o&&o(c,l,r);if(i.set(u.subarray(c,c+n*r)),a(c-a(0)),0!==d)throw new Error("Malformed buffer data: ".concat(d))}(o,o.exports[Aa[r]],t,e,i,n,o.exports[Ta[s||"NONE"]])}let Ca;const Oa="EXT_meshopt_compression";async function Pa(t,e){const i=t.getObjectExtension(e,Oa);if(i){const t=e.buffer,{byteOffset:n=0,byteLength:r=0,byteStride:s,count:o,mode:a,filter:l="NONE"}=i,c=new Uint8Array(t,n,r),h=new ArrayBuffer(o*s);return await Ea(new Uint8Array(h),o,s,c,a,l),h}return null}var Ia=Object.freeze({__proto__:null,name:"EXT_meshopt_compression",preprocess:function(t){if(new _a(t).getRequiredExtensions().includes(Oa)&&!xa)throw new Error("gltf: Required extension ".concat(Oa," not supported by browser"))},decode:async function(t,e){var i;const n=new _a(t);if(null==e||null===(i=e.gltf)||void 0===i||!i.decompressMeshes)return;const r=[];for(const e of t.json.bufferViews||[])r.push(Pa(n,e));await Promise.all(r),n.removeExtension(Oa)}});const Da="EXT_texture_webp";var La=Object.freeze({__proto__:null,name:"EXT_texture_webp",preprocess:function(t,e){const i=new _a(t);if(!oa("image/webp")){if(i.getRequiredExtensions().includes(Da))throw new Error("gltf: Required extension ".concat(Da," not supported by browser"));return}const{json:n}=i;for(const t of n.textures||[]){const e=i.getObjectExtension(t,Da);e&&(t.source=e.source),i.removeObjectExtension(t,Da)}i.removeExtension(Da)}});const Ra="KHR_texture_basisu";var Ba=Object.freeze({__proto__:null,name:"KHR_texture_basisu",preprocess:function(t,e){const i=new _a(t),{json:n}=i;for(const t of n.textures||[]){const e=i.getObjectExtension(t,Ra);e&&(t.source=e.source),i.removeObjectExtension(t,Ra)}i.removeExtension(Ra)}});function Na(t){const{buffer:e,size:i,count:n}=function(t){let e=t,i=1,n=0;t&&t.value&&(e=t.value,i=t.size||1);e&&(ArrayBuffer.isView(e)||(e=function(t,e,i=!1){if(!t)return null;if(Array.isArray(t))return new e(t);if(i&&!(t instanceof e))return new e(t);return t}(e,Float32Array)),n=e.length/i);return{buffer:e,size:i,count:n}}(t);return{value:e,size:i,byteOffset:0,count:n,type:ma(i),componentType:ga(e)}}const Fa="KHR_draco_mesh_compression";async function Ua(t,e,i,n){const r=t.getObjectExtension(e,Fa);if(!r)return;const s=t.getTypedArrayForBufferView(r.bufferView),o=W(s.buffer,s.byteOffset),{parse:a}=n,l={...i};delete l["3d-tiles"];const c=await a(o,Es,l,n),h=function(t){const e={};for(const i in t){const n=t[i];if("indices"!==i){const t=Na(n);e[i]=t}}return e}(c.attributes);for(const[i,n]of Object.entries(h))if(i in e.attributes){const r=e.attributes[i],s=t.getAccessor(r);null!=s&&s.min&&null!=s&&s.max&&(n.min=s.min,n.max=s.max)}e.attributes=h,c.indices&&(e.indices=Na(c.indices)),function(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}(e)}function Ga(t,e,i=4,n,r){var s;if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=n.DracoWriter.encodeSync({attributes:t}),a=null==r||null===(s=r.parseSync)||void 0===s?void 0:s.call(r,{attributes:t}),l=n._addFauxAttributes(a.attributes),c=n.addBufferView(o);return{primitives:[{attributes:l,mode:i,extensions:{[Fa]:{bufferView:c,attributes:l}}}]}}function*za(t){for(const e of t.json.meshes||[])for(const t of e.primitives)yield t}var ka=Object.freeze({__proto__:null,name:"KHR_draco_mesh_compression",preprocess:function(t,e,i){const n=new _a(t);for(const t of za(n))n.getObjectExtension(t,Fa)},decode:async function(t,e,i){var n;if(null==e||null===(n=e.gltf)||void 0===n||!n.decompressMeshes)return;const r=new _a(t),s=[];for(const t of za(r))r.getObjectExtension(t,Fa)&&s.push(Ua(r,t,e,i));await Promise.all(s),r.removeExtension(Fa)},encode:function(t,e={}){const i=new _a(t);for(const t of i.json.meshes||[])Ga(t),i.addRequiredExtension(Fa)}});const ja="KHR_lights_punctual";var Ha=Object.freeze({__proto__:null,name:"KHR_lights_punctual",decode:async function(t){const e=new _a(t),{json:i}=e,n=e.getExtension(ja);n&&(e.json.lights=n.lights,e.removeExtension(ja));for(const t of i.nodes||[]){const i=e.getObjectExtension(t,ja);i&&(t.light=i.light),e.removeObjectExtension(t,ja)}},encode:async function(t){const e=new _a(t),{json:i}=e;if(i.lights){const t=e.addExtension(ja);aa(!t.lights),t.lights=i.lights,delete i.lights}if(e.json.lights){for(const t of e.json.lights){const i=t.node;e.addObjectExtension(i,ja,t)}delete e.json.lights}}});const Va="KHR_materials_unlit";const Wa="KHR_techniques_webgl";function qa(t,e){const i=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach((e=>{t.uniforms[e].value&&!(e in i)&&(i[e]=t.uniforms[e].value)})),Object.keys(i).forEach((t=>{"object"==typeof i[t]&&void 0!==i[t].index&&(i[t].texture=e.getTexture(i[t].index))})),i}const Ja=[Ia,La,Ba,ka,Ha,Object.freeze({__proto__:null,name:"KHR_materials_unlit",decode:async function(t){const e=new _a(t),{json:i}=e;e.removeExtension(Va);for(const t of i.materials||[]){t.extensions&&t.extensions.KHR_materials_unlit&&(t.unlit=!0),e.removeObjectExtension(t,Va)}},encode:function(t){const e=new _a(t),{json:i}=e;if(e.materials)for(const t of i.materials||[])t.unlit&&(delete t.unlit,e.addObjectExtension(t,Va,{}),e.addExtension(Va))}}),Object.freeze({__proto__:null,name:"KHR_techniques_webgl",decode:async function(t){const e=new _a(t),{json:i}=e,n=e.getExtension(Wa);if(n){const t=function(t,e){const{programs:i=[],shaders:n=[],techniques:r=[]}=t,s=new TextDecoder;return n.forEach((t=>{if(!Number.isFinite(t.bufferView))throw new Error("KHR_techniques_webgl: no shader code");t.code=s.decode(e.getTypedArrayForBufferView(t.bufferView))})),i.forEach((t=>{t.fragmentShader=n[t.fragmentShader],t.vertexShader=n[t.vertexShader]})),r.forEach((t=>{t.program=i[t.program]})),r}(n,e);for(const n of i.materials||[]){const i=e.getObjectExtension(n,Wa);i&&(n.technique=Object.assign({},i,t[i.technique]),n.technique.values=qa(n.technique,e)),e.removeObjectExtension(n,Wa)}e.removeExtension(Wa)}},encode:async function(t,e){}})];function Xa(t,e){var i;const n=(null==e||null===(i=e.gltf)||void 0===i?void 0:i.excludeExtensions)||{};return!(t in n&&!n[t])}const Ya="KHR_binary_glTF";const Za={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},Ka={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class Qa{constructor(){b(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),b(this,"json",void 0)}normalize(t,e){this.json=t.json;const i=t.json;switch(i.asset&&i.asset.version){case"2.0":return;case void 0:case"1.0":break;default:return void"glTF: Unknown version ".concat(i.asset.version)}if(!e.normalize)throw new Error("glTF v1 is not supported.");this._addAsset(i),this._convertTopLevelObjectsToArrays(i),function(t){const e=new _a(t),{json:i}=e;for(const t of i.images||[]){const i=e.getObjectExtension(t,Ya);i&&Object.assign(t,i),e.removeObjectExtension(t,Ya)}i.buffers&&i.buffers[0]&&delete i.buffers[0].uri,e.removeExtension(Ya)}(t),this._convertObjectIdsToArrayIndices(i),this._updateObjects(i),this._updateMaterial(i)}_addAsset(t){t.asset=t.asset||{},t.asset.version="2.0",t.asset.generator=t.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(t){for(const e in Za)this._convertTopLevelObjectToArray(t,e)}_convertTopLevelObjectToArray(t,e){const i=t[e];if(i&&!Array.isArray(i)){t[e]=[];for(const n in i){const r=i[n];r.id=r.id||n;const s=t[e].length;t[e].push(r),this.idToIndexMap[e][n]=s}}}_convertObjectIdsToArrayIndices(t){for(const e in Za)this._convertIdsToIndices(t,e);"scene"in t&&(t.scene=this._convertIdToIndex(t.scene,"scene"));for(const e of t.textures)this._convertTextureIds(e);for(const e of t.meshes)this._convertMeshIds(e);for(const e of t.nodes)this._convertNodeIds(e);for(const e of t.scenes)this._convertSceneIds(e)}_convertTextureIds(t){t.source&&(t.source=this._convertIdToIndex(t.source,"image"))}_convertMeshIds(t){for(const e of t.primitives){const{attributes:t,indices:i,material:n}=e;for(const e in t)t[e]=this._convertIdToIndex(t[e],"accessor");i&&(e.indices=this._convertIdToIndex(i,"accessor")),n&&(e.material=this._convertIdToIndex(n,"material"))}}_convertNodeIds(t){t.children&&(t.children=t.children.map((t=>this._convertIdToIndex(t,"node")))),t.meshes&&(t.meshes=t.meshes.map((t=>this._convertIdToIndex(t,"mesh"))))}_convertSceneIds(t){t.nodes&&(t.nodes=t.nodes.map((t=>this._convertIdToIndex(t,"node"))))}_convertIdsToIndices(t,e){t[e]||("gltf v1: json doesn't contain attribute ".concat(e),t[e]=[]);for(const i of t[e])for(const t in i){const e=i[t],n=this._convertIdToIndex(e,t);i[t]=n}}_convertIdToIndex(t,e){const i=Ka[e];if(i in this.idToIndexMap){const n=this.idToIndexMap[i][t];if(!Number.isFinite(n))throw new Error("gltf v1: failed to resolve ".concat(e," with id ").concat(t));return n}return t}_updateObjects(t){for(const t of this.json.buffers)delete t.type}_updateMaterial(t){for(const e of t.materials){e.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const i=e.values&&e.values.tex,n=t.textures.findIndex((t=>t.id===i));-1!==n&&(e.pbrMetallicRoughness.baseColorTexture={index:n})}}}const $a={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},tl={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},el=10240,il=10241,nl=10242,rl=10243,sl=10497,ol={magFilter:el,minFilter:il,wrapS:nl,wrapT:rl},al={[el]:9729,[il]:9986,[nl]:sl,[rl]:sl};class ll{constructor(){b(this,"baseUri",""),b(this,"json",{}),b(this,"buffers",[]),b(this,"images",[])}postProcess(t,e={}){const{json:i,buffers:n=[],images:r=[],baseUri:s=""}=t;return aa(i),this.baseUri=s,this.json=i,this.buffers=n,this.images=r,this._resolveTree(this.json,e),this.json}_resolveTree(t,e={}){t.bufferViews&&(t.bufferViews=t.bufferViews.map(((t,e)=>this._resolveBufferView(t,e)))),t.images&&(t.images=t.images.map(((t,e)=>this._resolveImage(t,e)))),t.samplers&&(t.samplers=t.samplers.map(((t,e)=>this._resolveSampler(t,e)))),t.textures&&(t.textures=t.textures.map(((t,e)=>this._resolveTexture(t,e)))),t.accessors&&(t.accessors=t.accessors.map(((t,e)=>this._resolveAccessor(t,e)))),t.materials&&(t.materials=t.materials.map(((t,e)=>this._resolveMaterial(t,e)))),t.meshes&&(t.meshes=t.meshes.map(((t,e)=>this._resolveMesh(t,e)))),t.nodes&&(t.nodes=t.nodes.map(((t,e)=>this._resolveNode(t,e)))),t.skins&&(t.skins=t.skins.map(((t,e)=>this._resolveSkin(t,e)))),t.scenes&&(t.scenes=t.scenes.map(((t,e)=>this._resolveScene(t,e)))),void 0!==t.scene&&(t.scene=t.scenes[this.json.scene])}getScene(t){return this._get("scenes",t)}getNode(t){return this._get("nodes",t)}getSkin(t){return this._get("skins",t)}getMesh(t){return this._get("meshes",t)}getMaterial(t){return this._get("materials",t)}getAccessor(t){return this._get("accessors",t)}getCamera(t){return null}getTexture(t){return this._get("textures",t)}getSampler(t){return this._get("samplers",t)}getImage(t){return this._get("images",t)}getBufferView(t){return this._get("bufferViews",t)}getBuffer(t){return this._get("buffers",t)}_get(t,e){if("object"==typeof e)return e;const i=this.json[t]&&this.json[t][e];return i||"glTF file error: Could not find ".concat(t,"[").concat(e,"]"),i}_resolveScene(t,e){return t.id=t.id||"scene-".concat(e),t.nodes=(t.nodes||[]).map((t=>this.getNode(t))),t}_resolveNode(t,e){return t.id=t.id||"node-".concat(e),t.children&&(t.children=t.children.map((t=>this.getNode(t)))),void 0!==t.mesh?t.mesh=this.getMesh(t.mesh):void 0!==t.meshes&&t.meshes.length&&(t.mesh=t.meshes.reduce(((t,e)=>{const i=this.getMesh(e);return t.id=i.id,t.primitives=t.primitives.concat(i.primitives),t}),{primitives:[]})),void 0!==t.camera&&(t.camera=this.getCamera(t.camera)),void 0!==t.skin&&(t.skin=this.getSkin(t.skin)),t}_resolveSkin(t,e){return t.id=t.id||"skin-".concat(e),t.inverseBindMatrices=this.getAccessor(t.inverseBindMatrices),t}_resolveMesh(t,e){return t.id=t.id||"mesh-".concat(e),t.primitives&&(t.primitives=t.primitives.map((t=>{const e=(t={...t}).attributes;t.attributes={};for(const i in e)t.attributes[i]=this.getAccessor(e[i]);return void 0!==t.indices&&(t.indices=this.getAccessor(t.indices)),void 0!==t.material&&(t.material=this.getMaterial(t.material)),t}))),t}_resolveMaterial(t,e){if(t.id=t.id||"material-".concat(e),t.normalTexture&&(t.normalTexture={...t.normalTexture},t.normalTexture.texture=this.getTexture(t.normalTexture.index)),t.occlusionTexture&&(t.occlustionTexture={...t.occlustionTexture},t.occlusionTexture.texture=this.getTexture(t.occlusionTexture.index)),t.emissiveTexture&&(t.emmisiveTexture={...t.emmisiveTexture},t.emissiveTexture.texture=this.getTexture(t.emissiveTexture.index)),t.emissiveFactor||(t.emissiveFactor=t.emmisiveTexture?[1,1,1]:[0,0,0]),t.pbrMetallicRoughness){t.pbrMetallicRoughness={...t.pbrMetallicRoughness};const e=t.pbrMetallicRoughness;e.baseColorTexture&&(e.baseColorTexture={...e.baseColorTexture},e.baseColorTexture.texture=this.getTexture(e.baseColorTexture.index)),e.metallicRoughnessTexture&&(e.metallicRoughnessTexture={...e.metallicRoughnessTexture},e.metallicRoughnessTexture.texture=this.getTexture(e.metallicRoughnessTexture.index))}return t}_resolveAccessor(t,e){var i,n;if(t.id=t.id||"accessor-".concat(e),void 0!==t.bufferView&&(t.bufferView=this.getBufferView(t.bufferView)),t.bytesPerComponent=(i=t.componentType,tl[i]),t.components=(n=t.type,$a[n]),t.bytesPerElement=t.bytesPerComponent*t.components,t.bufferView){const e=t.bufferView.buffer,{ArrayType:i,byteLength:n}=va(t,t.bufferView),r=(t.bufferView.byteOffset||0)+(t.byteOffset||0)+e.byteOffset;let s=e.arrayBuffer.slice(r,r+n);t.bufferView.byteStride&&(s=this._getValueFromInterleavedBuffer(e,r,t.bufferView.byteStride,t.bytesPerElement,t.count)),t.value=new i(s)}return t}_getValueFromInterleavedBuffer(t,e,i,n,r){const s=new Uint8Array(r*n);for(let o=0;o<r;o++){const r=e+o*i;s.set(new Uint8Array(t.arrayBuffer.slice(r,r+n)),o*n)}return s.buffer}_resolveTexture(t,e){return t.id=t.id||"texture-".concat(e),t.sampler="sampler"in t?this.getSampler(t.sampler):al,t.source=this.getImage(t.source),t}_resolveSampler(t,e){t.id=t.id||"sampler-".concat(e),t.parameters={};for(const e in t){const i=this._enumSamplerParameter(e);void 0!==i&&(t.parameters[i]=t[e])}return t}_enumSamplerParameter(t){return ol[t]}_resolveImage(t,e){t.id=t.id||"image-".concat(e),void 0!==t.bufferView&&(t.bufferView=this.getBufferView(t.bufferView));const i=this.images[e];return i&&(t.image=i),t}_resolveBufferView(t,e){const i=t.buffer,n={id:"bufferView-".concat(e),...t,buffer:this.buffers[i]},r=this.buffers[i].arrayBuffer;let s=this.buffers[i].byteOffset||0;return"byteOffset"in t&&(s+=t.byteOffset),n.data=new Uint8Array(r,s,t.byteLength),n}_resolveCamera(t,e){return t.id=t.id||"camera-".concat(e),t.perspective,t.orthographic,t}}const cl=1735152710,hl=1313821514,ul=5130562,dl=!0;function pl(t,e,i=0,n={}){const r=new DataView(e),s=function(t,e=0){return"".concat(String.fromCharCode(t.getUint8(e+0))).concat(String.fromCharCode(t.getUint8(e+1))).concat(String.fromCharCode(t.getUint8(e+2))).concat(String.fromCharCode(t.getUint8(e+3)))}(r,i+0),o=r.getUint32(i+4,dl),a=r.getUint32(i+8,dl);switch(Object.assign(t,{header:{byteOffset:i,byteLength:a,hasBinChunk:!1},type:s,version:o,json:{},binChunks:[]}),i+=12,t.version){case 1:return function(t,e,i){d(t.header.byteLength>20);const n=e.getUint32(i+0,dl),r=e.getUint32(i+4,dl);return i+=8,d(0===r),fl(t,e,i,n),i+=n,i+=ml(t,e,i,t.header.byteLength)}(t,r,i);case 2:return function(t,e,i,n){return d(t.header.byteLength>20),function(t,e,i,n){for(;i+8<=t.header.byteLength;){const r=e.getUint32(i+0,dl),s=e.getUint32(i+4,dl);switch(i+=8,s){case hl:fl(t,e,i,r);break;case ul:ml(t,e,i,r);break;case 0:n.strict||fl(t,e,i,r);break;case 1:n.strict||ml(t,e,i,r)}i+=q(r,4)}}(t,e,i,n),i+t.header.byteLength}(t,r,i,{});default:throw new Error("Invalid GLB version ".concat(t.version,". Only supports v1 and v2."))}}function fl(t,e,i,n){const r=new Uint8Array(e.buffer,i,n),s=new TextDecoder("utf8").decode(r);return t.json=JSON.parse(s),q(n,4)}function ml(t,e,i,n){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:i,byteLength:n,arrayBuffer:e.buffer}),q(n,4)}async function gl(t,e,i=0,n,r){var s,o,a,l;!function(t,e,i,n){n.uri&&(t.baseUri=n.uri);if(e instanceof ArrayBuffer&&!function(t,e=0,i={}){const n=new DataView(t),{magic:r=cl}=i,s=n.getUint32(e,!1);return s===r||s===cl}(e,i,n)){e=(new TextDecoder).decode(e)}if("string"==typeof e)t.json=j(e);else if(e instanceof ArrayBuffer){const r={};i=pl(r,e,i,n.glb),aa("glTF"===r.type,"Invalid GLB magic string ".concat(r.type)),t._glb=r,t.json=r.json}else aa(!1,"GLTF: must be ArrayBuffer or string");const r=t.json.buffers||[];if(t.buffers=new Array(r.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:e}=t._glb;t.buffers[0]={arrayBuffer:e[0].arrayBuffer,byteOffset:e[0].byteOffset,byteLength:e[0].byteLength}}const s=t.json.images||[];t.images=new Array(s.length).fill({})}(t,e,i,n),function(t,e={}){(new Qa).normalize(t,e)}(t,{normalize:null==n||null===(s=n.gltf)||void 0===s?void 0:s.normalize}),function(t,e={},i){const n=Ja.filter((t=>Xa(t.name,e)));for(const s of n){var r;null===(r=s.preprocess)||void 0===r||r.call(s,t,e,i)}}(t,n,r);const c=[];if(null!=n&&null!==(o=n.gltf)&&void 0!==o&&o.loadBuffers&&t.json.buffers&&await async function(t,e,i){const n=t.json.buffers||[];for(let o=0;o<n.length;++o){const a=n[o];if(a.uri){var r,s;const{fetch:n}=i;aa(n);const l=la(a.uri,e),c=await(null==i||null===(r=i.fetch)||void 0===r?void 0:r.call(i,l)),h=await(null==c||null===(s=c.arrayBuffer)||void 0===s?void 0:s.call(c));t.buffers[o]={arrayBuffer:h,byteOffset:0,byteLength:h.byteLength},delete a.uri}}}(t,n,r),null!=n&&null!==(a=n.gltf)&&void 0!==a&&a.loadImages){const e=async function(t,e,i){const n=function(t){const e=new Set,i=t.json.textures||[];for(const t of i)void 0!==t.source&&e.add(t.source);return Array.from(e).sort()}(t),r=t.json.images||[],s=[];for(const o of n)s.push(vl(t,r[o],o,e,i));return await Promise.all(s)}(t,n,r);c.push(e)}const h=async function(t,e={},i){const n=Ja.filter((t=>Xa(t.name,e)));for(const s of n){var r;await(null===(r=s.decode)||void 0===r?void 0:r.call(s,t,e,i))}}(t,n,r);return c.push(h),await Promise.all(c),null!=n&&null!==(l=n.gltf)&&void 0!==l&&l.postProcess?function(t,e){return(new ll).postProcess(t,e)}(t,n):t}async function vl(t,e,i,n,r){const{fetch:s,parse:o}=r;let a;if(e.uri){const t=la(e.uri,n),i=await s(t);a=await i.arrayBuffer()}if(Number.isFinite(e.bufferView)){const i=function(t,e,i){const n=t.bufferViews[i];aa(n);const r=e[n.buffer];aa(r);const s=(n.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,s,n.byteLength)}(t.json,t.buffers,e.bufferView);a=W(i.buffer,i.byteOffset,i.byteLength)}aa(a,"glTF image has no data");let l=await o(a,[na,Uo],{mimeType:e.mimeType,basis:n.basis||{format:Fo()}},r);l&&l[0]&&(l={compressed:!0,mipmaps:!1,width:l[0].width,height:l[0].height,data:l}),t.images=t.images||[],t.images[i]=l}const yl={name:"glTF",id:"gltf",module:"gltf",version:"3.1.4",extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:async function(t,e={},i){(e={...yl.options,...e}).gltf={...yl.options.gltf,...e.gltf};const{byteOffset:n=0}=e;return await gl({},t,n,e,i)},options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};const _l=0,xl=1;function Ml(t,e,i,n){t.rotateYtoZ=!0;const r=t.byteOffset+t.byteLength-i;if(0===r)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=W(e,i,r),t.gltfByteOffset=0,t.gltfByteLength=r,i%4==0||"".concat(t.type,": embedded glb is not aligned to a 4-byte boundary."),t.byteOffset+t.byteLength}async function bl(t,e,i,n){const r=i["3d-tiles"]||{};if(function(t,e,i){switch(e){case _l:const e=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),i=(new TextDecoder).decode(e);t.gltfUrl=i.replace(/[\s\0]+$/,""),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case xl:break;default:throw new Error("b3dm: Illegal glTF format field")}}(t,e),r.loadGLTF){const{parse:e,fetch:r}=n;t.gltfUrl&&(t.gltfArrayBuffer=await r(t.gltfUrl,i),t.gltfByteOffset=0),t.gltfArrayBuffer&&(t.gltf=await e(t.gltfArrayBuffer,yl,i,n),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength)}}async function wl(t,e,i,n,r){var s;i=function(t,e,i,n,r){i=Zs(t,e,i),i=Ks(t,e,i),i=Qs(t,e,i),i=Ml(t,e,i,n);const s=new Us(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=s.getGlobalProperty("RTC_CENTER",Os.FLOAT,3),i}(t,e,i,n),await bl(t,xl,n,r);const o=null==t||null===(s=t.gltf)||void 0===s?void 0:s.extensions;return o&&o.CESIUM_RTC&&(t.rtcCenter=o.CESIUM_RTC.center),i}async function Sl(t,e,i,n,r){return i=function(t,e,i,n,r){if(i=Zs(t,e,i),1!==t.version)throw new Error("Instanced 3D Model version ".concat(t.version," is not supported"));i=Ks(t,e,i);const s=new DataView(e);if(t.gltfFormat=s.getUint32(i,!0),i=Qs(t,e,i+=4),i=Ml(t,e,i,n),0===t.featureTableJsonByteLength)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const o=new Us(t.featureTableJson,t.featureTableBinary),a=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=a,!Number.isFinite(a))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=o.getGlobalProperty("RTC_CENTER",Os.FLOAT,3);new Ys(t.batchTableJson,t.batchTableBinary,a);return function(t,e,i,n){const r=[new Array(n),t._batchTable][0],s=new Je;new Je,new Je,new Je;const o=new ei,a=new Ai,l=new Je,c={},h=new li,u=[],d=[],p=new Je,f=new Je;for(let i=0;i<n;i++){let n;if(e.hasProperty("POSITION"))n=e.getProperty("POSITION",Os.FLOAT,3,i,s);else if(e.hasProperty("POSITION_QUANTIZED")){n=e.getProperty("POSITION_QUANTIZED",Os.UNSIGNED_SHORT,3,i,s);const t=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Os.FLOAT,3,p);if(!t)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const r=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Os.FLOAT,3,f);if(!r)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const o=65535;for(let e=0;e<3;e++)n[e]=n[e]/o*r[e]+t[e]}if(!n)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(s.copy(n),c.translation=s,t.normalUp=e.getProperty("NORMAL_UP",Os.FLOAT,3,i,u),t.normalRight=e.getProperty("NORMAL_RIGHT",Os.FLOAT,3,i,d),t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",Os.UNSIGNED_SHORT,2,u),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",Os.UNSIGNED_SHORT,2,d),t.octNormalUp){if(!t.octNormalRight)throw new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");throw new Error("i3dm: oct-encoded orientation not implemented")}t.eastNorthUp?(Qi.WGS84.eastNorthUpToFixedFrame(s,h),h.getRotationMatrix3(o)):o.identity()}a.fromMatrix3(o),c.rotation=a,l.set(1,1,1);const m=e.getProperty("SCALE",Os.FLOAT,1,i);Number.isFinite(m)&&l.multiplyByScalar(m);const g=e.getProperty("SCALE_NON_UNIFORM",Os.FLOAT,3,i,u);g&&l.scale(g),c.scale=l;let v=e.getProperty("BATCH_ID",Os.UNSIGNED_SHORT,1,i);void 0===v&&(v=i);const y=(new li).fromQuaternion(c.rotation);h.identity(),h.translate(c.translation),h.multiplyRight(y),h.scale(c.scale);const _=h.clone();r[i]={modelMatrix:_,batchId:v}}t.instances=r}(t,o,0,a),i}(t,e,i,n),await bl(t,t.gltfFormat,n,r),i}async function Tl(t,e=0,i,n,r={}){switch(r.byteOffset=e,r.type=function(t,e=0){const i=new DataView(t);return"".concat(String.fromCharCode(i.getUint8(e+0))).concat(String.fromCharCode(i.getUint8(e+1))).concat(String.fromCharCode(i.getUint8(e+2))).concat(String.fromCharCode(i.getUint8(e+3)))}(t,e),r.type){case kr:return await async function(t,e,i,n,r,s){i=Zs(t,e,i);const o=new DataView(e);for(t.tilesLength=o.getUint32(i,!0),i+=4,t.tiles=[];t.tiles.length<t.tilesLength&&t.byteLength-i>12;){const o={};t.tiles.push(o),i=await s(e,i,n,r,o)}return i}(r,t,e,i,n,Tl);case Hr:return await wl(r,t,e,i,n);case Wr:return await async function(t,e,i,n){t.rotateYtoZ=!0,t.gltfUpAxis=i["3d-tiles"]&&i["3d-tiles"].assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y";const{parse:r}=n;t.gltf=await r(e,yl,i,n)}(r,t,i,n);case Vr:return await Sl(r,t,e,i,n);case jr:return await io(r,t,e,i,n);default:throw new Error("3DTileLoader: unknown type ".concat(r.type))}}async function Al(t,e,i){const n=t[e].bufferView,r=t.bufferViews[n],s=t.buffers[r.buffer];if(s.uri){const t=await gt(s.uri),e=await t.arrayBuffer();return new Uint8Array(e,r.byteOffset,r.byteLength)}return new Uint8Array(i,r.byteOffset,r.byteLength)}function El(t){const e=new DataView(t);return e.getUint32(0,!0)+2**32*e.getUint32(4,!0)}const Cl={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:zr,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:async function(t){if(1952609651!==new Uint32Array(t.slice(0,4))[0])throw new Error("Wrong subtree file magic number");if(1!==new Uint32Array(t.slice(4,8))[0])throw new Error("Wrong subtree file verson, must be 1");const e=El(t.slice(8,16)),i=new Uint8Array(t,24,e),n=new TextDecoder("utf8").decode(i),r=JSON.parse(n),s=El(t.slice(16,24));let o=new ArrayBuffer(0);return s&&(o=t.slice(24+e)),"bufferView"in r.tileAvailability&&(r.tileAvailability.explicitBitstream=await Al(r,"tileAvailability",o)),"bufferView"in r.contentAvailability&&(r.contentAvailability.explicitBitstream=await Al(r,"contentAvailability",o)),"bufferView"in r.childSubtreeAvailability&&(r.childSubtreeAvailability.explicitBitstream=await Al(r,"childSubtreeAvailability",o)),r},options:{}},Ol={QUADTREE:4,OCTREE:8};async function Pl(t,e,i={mortonIndex:0,x:0,y:0,z:0},n=0,r=0,s={level:0,mortonIndex:0,x:0,y:0,z:0}){const{subdivisionScheme:o,subtreeLevels:a,maximumLevel:l,contentUrlTemplate:c,subtreesUriTemplate:h,basePath:u}=e,d={children:[],lodMetricValue:0,contentUrl:""},p=Ol[o],f=1&n,m=n>>1&1,g=n>>2&1,v=(p**r-1)/(p-1);let y=Ll(i.mortonIndex,n),_=v+y,x=Ll(i.x,f),M=Ll(i.y,m),b=Ll(i.z,g),w=!1;r+1>a&&(w=Il(t.childSubtreeAvailability,y));const S=Ll(s.x,x),T=Ll(s.y,M),A=Ll(s.z,b),E=r+s.level;if(w){const e=Rl("".concat(u,"/").concat(h),E,S,T,A);t=await ue(e,Cl),s.mortonIndex=y,s.x=x,s.y=M,s.z=b,s.level=r,y=0,_=0,x=0,M=0,b=0,r=0}if(!Il(t.tileAvailability,_)||r>l)return d;Il(t.contentAvailability,_)&&(d.contentUrl=Rl(c,E,S,T,A));const C=r+1,O={mortonIndex:y,x,y:M,z:b};for(let i=0;i<p;i++){const n=await Pl(t,e,O,i,C,s);if(n.contentUrl||n.children.length){const t=Dl(n,E+1,{childTileX:x,childTileY:M,childTileZ:b},e);d.children.push(t)}}return d}function Il(t,e){return"constant"in t?Boolean(t.constant):!!t.explicitBitstream&&function(t,e){const i=Math.floor(t/8),n=t%8;return 1==(e[i]>>n&1)}(e,t.explicitBitstream)}function Dl(t,e,i,n){const{basePath:r,refine:s,getRefine:o,lodMetricType:a,getTileType:l,rootLodMetricValue:c,rootBoundingVolume:h}=n,u=t.contentUrl&&t.contentUrl.replace("".concat(r,"/"),""),d=c/2**e,p=function(t,e,i){if(e.region){const{childTileX:n,childTileY:r,childTileZ:s}=i,[o,a,l,c,h,u]=e.region,d=2**t,p=(l-o)/d,f=(c-a)/d,m=(u-h)/d,[g,v]=[o+p*n,o+p*(n+1)],[y,_]=[a+f*r,a+f*(r+1)],[x,M]=[h+m*s,h+m*(s+1)];return{region:[g,y,v,_,x,M]}}return null}(e,h,i);return{children:t.children,contentUrl:t.contentUrl,content:{uri:u},id:t.contentUrl,refine:o(s),type:l(t),lodMetricType:a,lodMetricValue:d,boundingVolume:p}}function Ll(t,e){return parseInt(t.toString(2)+e.toString(2),2)}function Rl(t,e,i,n,r){const s=function(t){const e={};for(const i in t)e["{".concat(i,"}")]=t[i];return e}({level:e,x:i,y:n,z:r});return t.replace(/{level}|{x}|{y}|{z}/gi,(t=>s[t]))}function Bl(t){if(!t.contentUrl)return er;const e=t.contentUrl.split(".").pop();switch(e){case"pnts":return nr;case"i3dm":case"b3dm":case"glb":case"gltf":return ir;default:return e}}function Nl(t){switch(t){case"REPLACE":case"replace":return tr;case"ADD":case"add":return $n;default:return t}}function Fl(t,e){if(!t)return null;if(t.content){const i=t.content.uri||t.content.url;t.contentUrl="".concat(e.basePath,"/").concat(i)}return t.id=t.contentUrl,t.lodMetricType=ar,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform,t.type=Bl(t),t.refine=Nl(t.refine),t}async function Ul(t){if(!t.root)return null;const e=t.basePath,i=t.root.extensions["3DTILES_implicit_tiling"],{subdivisionScheme:n,maximumLevel:r,subtreeLevels:s,subtrees:{uri:o}}=i,a=Rl(o,0,0,0,0),l="".concat(e,"/").concat(a),c=await ue(l,Cl),h="".concat(e,"/").concat(t.root.content.uri),u=t.root.refine,d=t.root.geometricError,p=t.root.boundingVolume,f={contentUrlTemplate:h,subtreesUriTemplate:o,subdivisionScheme:n,subtreeLevels:s,maximumLevel:r,refine:u,basePath:e,lodMetricType:ar,rootLodMetricValue:d,rootBoundingVolume:p,getTileType:Bl,getRefine:Nl};return await async function(t,e,i){if(!t)return null;t.lodMetricType=ar,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform;const{children:n,contentUrl:r}=await Pl(e,i);r&&(t.contentUrl=r,t.content={uri:r.replace("".concat(i.basePath,"/"),"")});return t.refine=Nl(t.refine),t.type=Bl(t),t.children=n,t.id=t.contentUrl,t}(t.root,c,f)}const Gl="3DTILES_implicit_tiling",zl={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:zr,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:async function(t,e,i){const n=e["3d-tiles"]||{};let r;r="auto"===n.isTileset?i.url&&-1!==i.url.indexOf(".json"):n.isTileset;t=r?await async function(t,e,i){var n;const r=JSON.parse((new TextDecoder).decode(t));return r.loader=e.loader||zl,r.url=i.url,r.basePath=function(t){return et(t.url)}(r),r.root=function(t){var e,i;return(null==t||null===(e=t.extensionsRequired)||void 0===e?void 0:e.includes(Gl))&&(null==t||null===(i=t.extensionsUsed)||void 0===i?void 0:i.includes(Gl))}(r)?await Ul(r):function(t){const e=t.basePath,i=Fl(t.root,t),n=[];for(n.push(i);n.length>0;){const t=(n.pop()||{}).children||[];for(const i of t)Fl(i,{basePath:e}),n.push(i)}return i}(r),r.type=or,r.lodMetricType=ar,r.lodMetricValue=(null===(n=r.root)||void 0===n?void 0:n.lodMetricValue)||0,r}(t,e,i):await async function(t,e,i){const n={content:{featureIds:null}},r=0;return await Tl(t,r,e,i,n.content),n.content}(t,e,i);return t},options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};const kl="https://api.cesium.com/v1/assets";async function jl(t,e){if(!e){const i=await async function(t){d(t);const e=kl,i={Authorization:"Bearer ".concat(t)},n=await gt(e,{fetch:{headers:i}});if(!n.ok)throw new Error(n.statusText);return await n.json()}(t);for(const t of i.items)"3DTILES"===t.type&&(e=t.id)}const i=await async function(t,e){d(t,e);const i={Authorization:"Bearer ".concat(t)},n="".concat(kl,"/").concat(e);let r=await gt("".concat(n),{fetch:{headers:i}});if(!r.ok)throw new Error(r.statusText);let s=await r.json();if(r=await gt("".concat(n,"/endpoint"),{fetch:{headers:i}}),!r.ok)throw new Error(r.statusText);const o=await r.json();return s={...s,...o},s}(t,e),{type:n,url:r}=i;return d("3DTILES"===n&&r),i.headers={Authorization:"Bearer ".concat(i.accessToken)},i}const Hl={...zl,id:"cesium-ion",name:"Cesium Ion",preload:async function(t,e={}){e=e["cesium-ion"]||{};const{accessToken:i}=e;let n=e.assetId;if(!Number.isFinite(n)){const e=t.match(/\/([0-9]+)\/tileset.json/);n=e&&e[1]}return jl(i,n)},parse:async(t,e,i)=>((e={...e})["3d-tiles"]=e["cesium-ion"],e.loader=Hl,zl.parse(t,e,i)),options:{"cesium-ion":{...zl.options["3d-tiles"],accessToken:null}}};function Vl(t){const e=64,i=document.createElement("canvas");i.width=e,i.height=e;const r=i.getContext("2d");r.rect(0,0,e,e);const s=r.createLinearGradient(0,0,e,e);for(let e=0;e<t.length;e++){const i=t[e];s.addColorStop(i[0],"#"+i[1].getHexString())}r.fillStyle=s,r.fill();const o=new n.ROQ(i);return o.needsUpdate=!0,o.minFilter=n.wem,o.wrapS=n.rpg,o.wrapT=n.rpg,o.repeat.set(2,2),o}function Wl(t){t.updateMatrix(),t.updateMatrixWorld(),t.matrixWorldInverse.copy(t.matrixWorld).invert();const e=new n.iWj;return e.setFromProjectionMatrix((new n.yGw).multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse)),e}function ql(t){const{boundingVolume:e}=t;let i=0;t.content&&(i=Math.min(t.content.byteLength/5e5,1));const r=new n.Ilk(i,1,0),s=new n.DvJ(1,1,1),o=new n.yGw;e.halfAxes?o.copy(Jl(e.halfAxes)):e.radius&&s.scale(2*e.radius,2*e.radius,2*e.radius),s.applyMatrix4(o);const a=new n.TOt(s),l=new n.ejS(a,new n.nls({color:r}));return l.position.copy(new n.Pa4(...e.center)),l}function Jl(t){const e=t;return(new n.yGw).fromArray([2*e[0],2*e[1],2*e[2],0,2*e[3],2*e[4],2*e[5],0,2*e[6],2*e[7],2*e[8],0,0,0,0,1])}const Xl={SPECTRAL:[[0,new n.Ilk(.3686,.3098,.6353)],[.1,new n.Ilk(.1961,.5333,.7412)],[.2,new n.Ilk(.4,.7608,.6471)],[.3,new n.Ilk(.6706,.8667,.6431)],[.4,new n.Ilk(.902,.9608,.5961)],[.5,new n.Ilk(1,1,.749)],[.6,new n.Ilk(.9961,.8784,.5451)],[.7,new n.Ilk(.9922,.6824,.3804)],[.8,new n.Ilk(.9569,.4275,.2627)],[.9,new n.Ilk(.8353,.2431,.3098)],[1,new n.Ilk(.6196,.0039,.2588)]],PLASMA:[[0,new n.Ilk(.241,.015,.61)],[.1,new n.Ilk(.387,.001,.654)],[.2,new n.Ilk(.524,.025,.653)],[.3,new n.Ilk(.651,.125,.596)],[.4,new n.Ilk(.752,.227,.513)],[.5,new n.Ilk(.837,.329,.431)],[.6,new n.Ilk(.907,.435,.353)],[.7,new n.Ilk(.963,.554,.272)],[.8,new n.Ilk(.992,.681,.195)],[.9,new n.Ilk(.987,.822,.144)],[1,new n.Ilk(.94,.975,.131)]],YELLOW_GREEN:[[0,new n.Ilk(.1647,.2824,.3451)],[.1,new n.Ilk(.1338,.3555,.4227)],[.2,new n.Ilk(.061,.4319,.4864)],[.3,new n.Ilk(0,.5099,.5319)],[.4,new n.Ilk(0,.5881,.5569)],[.5,new n.Ilk(.137,.665,.5614)],[.6,new n.Ilk(.2906,.7395,.5477)],[.7,new n.Ilk(.4453,.8099,.5201)],[.8,new n.Ilk(.6102,.8748,.485)],[.9,new n.Ilk(.7883,.9323,.4514)],[1,new n.Ilk(.9804,.9804,.4314)]],VIRIDIS:[[0,new n.Ilk(.267,.005,.329)],[.1,new n.Ilk(.283,.141,.458)],[.2,new n.Ilk(.254,.265,.53)],[.3,new n.Ilk(.207,.372,.553)],[.4,new n.Ilk(.164,.471,.558)],[.5,new n.Ilk(.128,.567,.551)],[.6,new n.Ilk(.135,.659,.518)],[.7,new n.Ilk(.267,.749,.441)],[.8,new n.Ilk(.478,.821,.318)],[.9,new n.Ilk(.741,.873,.15)],[1,new n.Ilk(.993,.906,.144)]],INFERNO:[[0,new n.Ilk(.077,.042,.206)],[.1,new n.Ilk(.225,.036,.388)],[.2,new n.Ilk(.373,.074,.432)],[.3,new n.Ilk(.522,.128,.42)],[.4,new n.Ilk(.665,.182,.37)],[.5,new n.Ilk(.797,.255,.287)],[.6,new n.Ilk(.902,.364,.184)],[.7,new n.Ilk(.969,.516,.063)],[.8,new n.Ilk(.988,.683,.072)],[.9,new n.Ilk(.961,.859,.298)],[1,new n.Ilk(.988,.998,.645)]],GRAYSCALE:[[0,new n.Ilk(0,0,0)],[1,new n.Ilk(1,1,1)]],TURBO:[[0,new n.Ilk(.18995,.07176,.23217)],[.07,new n.Ilk(.25107,.25237,.63374)],[.13,new n.Ilk(.27628,.42118,.89123)],[.2,new n.Ilk(.25862,.57958,.99876)],[.27,new n.Ilk(.15844,.73551,.92305)],[.33,new n.Ilk(.09267,.86554,.7623)],[.4,new n.Ilk(.19659,.94901,.59466)],[.47,new n.Ilk(.42778,.99419,.38575)],[.53,new n.Ilk(.64362,.98999,.23356)],[.6,new n.Ilk(.80473,.92452,.20459)],[.67,new n.Ilk(.93301,.81236,.22667)],[.73,new n.Ilk(.99314,.67408,.20348)],[.8,new n.Ilk(.9836,.49291,.12849)],[.87,new n.Ilk(.92105,.31489,.05475)],[.93,new n.Ilk(.81608,.18462,.01809)],[1,new n.Ilk(.66449,.08436,.00424)]],RAINBOW:[[0,new n.Ilk(.278,0,.714)],[1/6,new n.Ilk(0,0,1)],[2/6,new n.Ilk(0,1,1)],[.5,new n.Ilk(0,1,0)],[4/6,new n.Ilk(1,1,0)],[5/6,new n.Ilk(1,.64,0)],[1,new n.Ilk(1,0,0)]],CONTOUR:[[0,new n.Ilk(0,0,0)],[.03,new n.Ilk(0,0,0)],[.04,new n.Ilk(1,1,1)],[1,new n.Ilk(1,1,1)]]};var Yl,Zl,Kl;!function(t){t[t.Intensity=1]="Intensity",t[t.Classification=2]="Classification",t[t.Elevation=3]="Elevation",t[t.RGB=4]="RGB",t[t.White=5]="White"}(Yl||(Yl={})),function(t){t[t.FlatTexture=1]="FlatTexture",t[t.ShadedTexture=2]="ShadedTexture",t[t.ShadedNoTexture=3]="ShadedNoTexture"}(Zl||(Zl={})),function(t){t[t.Reset=1]="Reset",t[t.Mercator=2]="Mercator",t[t.WGS84Cartesian=3]="WGS84Cartesian"}(Kl||(Kl={}));const Ql="undefined"!=typeof document?Vl(Xl.RAINBOW):null,$l="undefined"!=typeof document?Vl(Xl.GRAYSCALE):null,tc={throttleRequests:!0,maxRequests:64,updateInterval:.1,maxConcurrency:1,maximumScreenSpaceError:16,maximumMemoryUsage:32,viewDistanceScale:1,skipLevelOfDetail:!1,updateTransforms:!0,shading:Zl.FlatTexture,transparent:!1,pointCloudColoring:Yl.White,pointSize:1,worker:!0,wireframe:!1,debug:!1,basisTranscoderPath:null,dracoDecoderPath:null,material:null,computeNormals:!1,shaderCallback:null,geoTransform:Kl.Reset,preloadTilesCount:null};class ec{static load(t){return u(this,void 0,void 0,(function*(){const e=Object.assign(Object.assign({},tc),t.options),{url:i}=t,s=e.updateInterval,a={};if(e.cesiumIONToken){a["cesium-ion"]={accessToken:e.cesiumIONToken};const t=yield Hl.preload(i,a);a.fetch={headers:t.headers}}t.loadingManager&&t.loadingManager.itemStart(i);const l=yield ue(i,zl,Object.assign({},a)),c={},d={},p=[],f=new n.ZAu,m=new n.ZAu;e.debug||(m.visible=!1);const g={pointSize:{type:"f",value:e.pointSize},gradient:{type:"t",value:Ql},grayscale:{type:"t",value:$l},rootCenter:{type:"vec3",value:new n.Pa4},rootNormal:{type:"vec3",value:new n.Pa4},coloring:{type:"i",value:e.pointCloudColoring},hideGround:{type:"b",value:!0},elevationRange:{type:"vec2",value:new n.FM8(0,400)},maxIntensity:{type:"f",value:1},intensityContrast:{type:"f",value:1},alpha:{type:"f",value:1}},v=new n.jyz({uniforms:g,vertexShader:"\n  varying vec3 vColor;\n  uniform sampler2D gradient;\n  uniform sampler2D grayscale;\n  attribute float intensity;\n  attribute float classification;\n  uniform vec3 rootCenter;\n  uniform vec3 rootNormal;\n  uniform vec2 elevationRange;\n  uniform int coloring;\n  uniform bool hideGround;\n  uniform float maxIntensity;\n  uniform float intensityContrast;\n  uniform float pointSize;\n\n  #ifdef USE_COLOR\n  vec3 getRGB() {\n      vec3 rgb = color;\n      return rgb;\n  }\n  #endif\n\n  vec3 getElevation(){\n    vec4 world = modelMatrix * vec4( position, 1.0 );\n    float diff = abs(dot(rootNormal, (vec3(world) - rootCenter)));\n    float w = max(diff - elevationRange.x,0.0) / max(elevationRange.y - elevationRange.x,1.0);\n    vec3 cElevation = texture2D(gradient, vec2(w,1.0-w)).rgb;\n\n    return cElevation;\n  }\n\n  vec3 getIntensity(){\n    // TODO: real contrast enhancement. Check https://github.com/yuki-koyama/enhancer/blob/master/shaders/enhancer.fs\n    float intmod = pow(intensity, intensityContrast);\n    vec3 cIntensity = texture2D(grayscale, vec2(intmod / maxIntensity ,1.0-(intmod / maxIntensity))).rgb;\n    return cIntensity;\n  }\n\n  vec3 getClassification(){\n    float classNormalized = classification / 255.0;\n    vec3 cClassification = texture2D(gradient, vec2(classNormalized * 5.0,1.0-classNormalized * 5.0)).rgb;\n    return cClassification;\n  }\n\n  vec3 getColor(){\n      vec3 color;\n      if (hideGround && classification == 2.0) {\n         return vec3(0.0, 0.0, 0.0);               \n      }\n\n      if (coloring == 1) {\n        color = getIntensity();\n      }\n      else if (coloring == 2) {\n        color = getClassification();\n      } else if (coloring == 3) {\n        color = getElevation();\n      } \n      #ifdef USE_COLOR\n      else if (coloring == 4) {\n        color = getRGB();\n      }\n      #endif\n      else {\n        color = vec3(1.0, 1.0, 1.0);\n      }\n      return color;\n  }\n\n  void main() {\n      vColor = getColor();\n\n      gl_PointSize = pointSize;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n  }\n",fragmentShader:"\n  varying vec3 vColor;\n  uniform float alpha;\n\n  void main() {\n    if (vColor == vec3(0.0, 0.0, 0.0)) {\n      discard;\n    } else {\n      gl_FragColor = vec4( vColor, alpha);\n    }\n  }\n",transparent:e.transparent,vertexColors:!0});let y=null,_=null;const x=new r.GLTFLoader;let M,b;e.basisTranscoderPath&&(M=new h,M.detectSupport(t.renderer),M.setTranscoderPath(e.basisTranscoderPath+"/"),M.setWorkerLimit(1),x.setKTX2Loader(M)),e.dracoDecoderPath&&(b=new o,b.setDecoderPath(e.dracoDecoderPath+"/"),b.setWorkerLimit(e.maxConcurrency),x.setDRACOLoader(b));const w=new n.vBJ({transparent:e.transparent}),S={maximumMemoryUsage:e.maximumMemoryUsage,maximumScreenSpaceError:e.maximumScreenSpaceError,viewDistanceScale:e.viewDistanceScale,skipLevelOfDetail:e.skipLevelOfDetail,updateTransforms:e.updateTransforms,throttleRequests:e.throttleRequests,maxRequests:e.maxRequests,contentLoader:t=>u(this,void 0,void 0,(function*(){let i=null;switch(t.type){case nr:i=function(t,e,i,r){const s={rtc_center:t.content.rtcCenter,points:t.content.attributes.positions,intensities:t.content.attributes.intensity,classifications:t.content.attributes.classification,rgb:null,rgba:null},{colors:o}=t.content.attributes;o&&3===o.size&&(s.rgb=o.value);o&&4===o.size&&(s.rgba=o.value);const a=new n.u9r;a.setAttribute("position",new n.a$l(s.points,3));const l=(new n.yGw).fromArray(t.computedTransform).premultiply(r);s.rgba?a.setAttribute("color",new n.a$l(s.rgba,4)):s.rgb&&a.setAttribute("color",new n.WTc(s.rgb,3,!0));s.intensities&&a.setAttribute("intensity",new n.TlE(s.intensities,1,!0));s.classifications&&a.setAttribute("classification",new n.WTc(s.classifications,1,!1));const c=new n.woe(a,i.material||e);if(s.rtc_center){const t=s.rtc_center;l.multiply((new n.yGw).makeTranslation(t[0],t[1],t[2]))}return c.applyMatrix4(l),c}(t,v,e,U);break;case ir:case rr:i=yield function(t,e,i,r,s){return u(this,void 0,void 0,(function*(){return new Promise(((o,a)=>{var l;const c=(new n.yGw).makeRotationAxis(new n.Pa4(1,0,0),Math.PI/2),h="Z"!==(null===(l=e.tileset.asset)||void 0===l?void 0:l.gltfUpAxis),u=(new n.yGw).fromArray(e.computedTransform).premultiply(s);h&&u.multiply(c),t.parse(e.content.gltfArrayBuffer,e.contentUrl?e.contentUrl.substr(0,e.contentUrl.lastIndexOf("/")+1):"",(t=>{const e=t.scenes[0];e.applyMatrix4(u),e.traverse((t=>{if("Mesh"==t.type){const e=t,n=e.material,s=n.map;r.material?(e.material=r.material.clone(),n.dispose()):r.shading==Zl.FlatTexture&&(e.material=i.clone(),n.dispose()),r.shading!=Zl.ShadedNoTexture?"ShaderMaterial"==e.material.type?e.material.uniforms.map={value:s}:e.material.map=s:(s&&s.dispose(),e.material.map=null),r.shaderCallback&&(e.onBeforeRender=r.shaderCallback),e.material.wireframe=r.wireframe,r.computeNormals&&e.geometry.computeVertexNormals()}})),o(e)}),(t=>{a(new Error(`error parsing gltf in tile ${e.id}: ${t}`))}))}))}))}(x,t,w,e,U)}if(i&&(i.visible=!1,c[t.id]=i,f.add(c[t.id]),e.debug)){const e=ql(t);m.add(e),d[t.id]=e}})),onTileLoad:t=>u(this,void 0,void 0,(function*(){T&&(!O&&(null==t?void 0:t.depth)<=5&&G(t),T._frameNumber++,k(T,c,_,y))})),onTileUnload:t=>{p.push(t)},onTileError:(t,e)=>{console.error("Tile error",t.id,e)}},T=new Gr(l,Object.assign(Object.assign({},S),{loadOptions:Object.assign(Object.assign({},a),{maxConcurrency:e.maxConcurrency,worker:e.worker,gltf:{loadImages:!1},"3d-tiles":{loadGLTF:!1}})})),A=new n.yGw,E=new n.yGw,C=new n.Pa4;let O=!1;if(T.root.boundingVolume&&(T.root.header.boundingVolume.region&&(e.geoTransform=Kl.WGS84Cartesian),E.setPosition(T.root.boundingVolume.center[0],T.root.boundingVolume.center[1],T.root.boundingVolume.center[2])),e.debug){const t=ql(T.root);m.add(t),d[T.root.id]=t}let P=!1,I=!1;g.rootCenter.value.copy(C),g.rootNormal.value.copy(new n.Pa4(0,0,1).normalize()),T.stats.get("Loader concurrency").count=e.maxConcurrency,T.stats.get("Maximum SSE").count=e.maximumScreenSpaceError,T.stats.get("Maximum mem usage").count=e.maximumMemoryUsage;let D=0,L=null,R=null;const B=new n.Pa4(1/0,1/0,1/0);let N=null;f.updateMatrixWorld(!0);const F=(new n.yGw).copy(f.matrixWorld),U=(new n.yGw).copy(F).invert();if(G(T.root),z(),e.debug&&(d[T.root.id].applyMatrix4(A),m.matrixWorld.copy(f.matrixWorld)),e.geoTransform==Kl.Mercator){const t=function(t,e){const i=2*Math.PI*6378137/2,r=e*i/180;let s=Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180);return s=s*i/180,new n.FM8(r,s)}(T.cartographicCenter[1],T.cartographicCenter[0]);C.set(t.x,0,-t.y),f.position.copy(C),f.rotation.set(-Math.PI/2,0,0),f.updateMatrixWorld(!0)}else e.geoTransform==Kl.WGS84Cartesian&&(f.applyMatrix4(E),f.updateMatrixWorld(!0),C.copy(f.position));function G(t){if(!t.boundingVolume.halfAxes)return;const e=t.boundingVolume.halfAxes,i=(new n.yGw).extractRotation(Jl(e)).premultiply((new n.yGw).extractRotation(U));if(!(new n.USm).setFromRotationMatrix(i).equals(new n.USm)){O=!0;const t=new n.Pa4(E.elements[12],E.elements[13],E.elements[14]);E.extractRotation(i),E.setPosition(t),z()}}function z(){e.geoTransform!=Kl.WGS84Cartesian&&(A.copy(E).invert(),A.premultiply(F),A.copy(F).multiply((new n.yGw).copy(E).invert()),T.modelMatrix=new li(A.toArray()))}function k(i,r,s,o){if(P)return;if(!N||o.aspect!=R){const t=new Gn({fov:o.fov/180*Math.PI,aspectRatio:o.aspect,near:o.near,far:o.far});N=t.sseDenominator,R=o.aspect,e.debug}const a=Wl(o).planes.map((t=>new En(t.normal.toArray(),t.constant))),l=new In(a),c=new n.FM8;s.getSize(c);const h={camera:{position:B.toArray()},height:c.y,frameNumber:i._frameNumber,sseDenominator:N,cullingVolume:l,viewport:{id:0}};i._cache.reset(),i._traverser.traverse(i.root,h,i.options);for(const t of i.tiles)t.selected?r[t.id]?r[t.id].visible=!0:console.error("TILE SELECTED BUT NOT LOADED!!",t.id):r[t.id]&&(r[t.id].visible=!1);for(;p.length>0;){const t=p.pop();r[t.id]&&t.contentState==Xn&&(f.remove(r[t.id]),nc(r[t.id]),delete r[t.id]),d[t.id]&&(nc(d[t.id]),m.remove(d[t.id]),delete d[t.id])}const u=i.stats.get("Tiles Loaded").count,g=i.stats.get("Tiles Loading").count;return t.onProgress&&t.onProgress(u,u+g),t.loadingManager&&!I&&0==g&&(null==e.preloadTilesCount||u>=e.preloadTilesCount)&&(I=!0,t.loadingManager.itemEnd(t.url)),h}return{model:f,runtime:{getTileset:()=>T,getStats:()=>T.stats,showTiles:t=>{m.visible=t},setWireframe:t=>{e.wireframe=t,f.traverse((e=>{e instanceof n.Kj0&&(e.material.wireframe=t)}))},setDebug:t=>{e.debug=t,m.visible=t},setShading:t=>{e.shading=t},getTileBoxes:()=>m,setViewDistanceScale:t=>{T.options.viewDistanceScale=t,T._frameNumber++,k(T,c,_,y)},setHideGround:t=>{g.hideGround.value=t},setPointCloudColoring:t=>{g.coloring.value=t},setElevationRange:t=>{g.elevationRange.value.set(t[0],t[1])},setMaxIntensity:t=>{g.maxIntensity.value=t},setIntensityContrast:t=>{g.intensityContrast.value=t},setPointAlpha:t=>{g.alpha.value=t},getLatLongHeightFromPosition:t=>{const e=T.ellipsoid.cartesianToCartographic((new n.Pa4).copy(t).applyMatrix4((new n.yGw).copy(A).invert()).toArray());return{lat:e[1],long:e[0],height:e[2]}},getPositionFromLatLongHeight:t=>{const e=T.ellipsoid.cartographicToCartesian([t.long,t.lat,t.height]);return new n.Pa4(...e).applyMatrix4(A)},getCameraFrustum:t=>{const e=Wl(t).planes.map((t=>new En(t.normal.toArray(),t.constant))).map((t=>function(t){const e=new n.ZAu,i=new n._12(10,5),r=new n.Pa4(...t.projectPointOntoPlane([0,0,0])),s=new n.Pa4(t.normal.x,t.normal.y,t.normal.z),o=(new n.Pa4).copy(r).add(s);i.lookAt(o),i.translate(r.x,r.y,r.z);const a=new n.vBJ({color:65535,side:n.ehD}),l=new n.Kj0(i,a),c=new n.tGC(s,r,5,16776960);return e.add(c),e.add(l),e}(t))),i=new n.ZAu;for(const t of e)i.add(t);return i},update:function(t,i,r){if(y=r,_=i,D+=t,T&&D>=s){if(!F.equals(f.matrixWorld)){D=0,F.copy(f.matrixWorld),z();const t=(new n.Pa4).setFromMatrixPosition(F);g.rootCenter.value.copy(t),g.rootNormal.value.copy(new n.Pa4(0,0,1).applyMatrix4(F).normalize()),U.copy(F).invert(),e.debug&&(d[T.root.id].matrixWorld.copy(A),d[T.root.id].applyMatrix4(F))}if(null==L)L=(new n.yGw).copy(r.matrixWorld);else{!(r.matrixWorld.equals(L)&&r.aspect==R)&&(D=0,T._frameNumber++,r.getWorldPosition(B),L.copy(r.matrixWorld),k(T,c,i,r))}}},dispose:function(){for(P=!0,T._destroy();f.children.length>0;){const t=f.children[0];nc(t),f.remove(t)}for(;m.children.length>0;){const t=m.children[0];m.remove(t),t.geometry.dispose(),t.material.dispose()}M&&M.dispose(),b&&b.dispose()}}}}))}}function ic(t){var e,i,n,r;(null===(e=null==t?void 0:t.uniforms)||void 0===e?void 0:e.map)?null===(n=null===(i=null==t?void 0:t.uniforms)||void 0===i?void 0:i.map.value)||void 0===n||n.dispose():t.map&&(null===(r=t.map)||void 0===r||r.dispose()),t.dispose()}function nc(t){t.traverse((t=>{if(t.isMesh)if(t.geometry.dispose(),t.material.isMaterial)ic(t.material);else for(const e of t.material)ic(e)}));for(let e=t.children.length-1;e>=0;e--){const i=t.children[e];t.remove(i)}}},9477:(t,e,i)=>{"use strict";i.d(e,{D1R:()=>M,DvJ:()=>Ui,EB7:()=>ko,EJi:()=>Qa,F5T:()=>ii,FM8:()=>_t,FvO:()=>bc,ILR:()=>R,IOt:()=>tt,Ilk:()=>Ot,Kj0:()=>Ni,M8C:()=>yt,N$j:()=>uo,NMF:()=>H,OdW:()=>go,OoA:()=>m,Ox3:()=>Vl,PMe:()=>Fl,Pa4:()=>kt,QRU:()=>Kl,ROQ:()=>jo,Syv:()=>j,TOt:()=>Xo,TUj:()=>xc,TUv:()=>ho,T_1:()=>Lc,TlE:()=>oi,Tme:()=>He,TyD:()=>g,USm:()=>Ce,UY4:()=>Ro,UlW:()=>Z,VLJ:()=>Ec,Vkp:()=>xt,WTc:()=>ai,Wid:()=>Ka,Wl3:()=>r,WwZ:()=>Y,YLQ:()=>v,ZAu:()=>Ps,Zp0:()=>Yl,ZzF:()=>Vt,_12:()=>sn,_AM:()=>B,_C8:()=>al,_fP:()=>zt,a$l:()=>hi,aH4:()=>y,aLr:()=>ce,aNw:()=>Sl,blk:()=>Lo,bnF:()=>ga,bsb:()=>k,cPb:()=>Vi,cek:()=>jl,dUE:()=>fl,dpR:()=>Ol,eaV:()=>N,ehD:()=>s,ejS:()=>Do,ekQ:()=>G,fto:()=>F,hH6:()=>Al,iDF:()=>ja,iKG:()=>mn,iLg:()=>gl,iMs:()=>gc,iUV:()=>pc,iWj:()=>en,jyz:()=>ji,kB5:()=>js,knz:()=>$,l0P:()=>U,m7l:()=>_l,nls:()=>wo,ptH:()=>z,qyh:()=>x,rnI:()=>Q,rpg:()=>p,tEQ:()=>wl,tGC:()=>Ic,u9r:()=>yi,uWy:()=>f,vBJ:()=>ni,vpT:()=>zs,wem:()=>_,wk1:()=>C,woe:()=>Go,wuA:()=>I,x12:()=>Oo,xEZ:()=>Bt,xo$:()=>Xa,xoR:()=>$a,y$t:()=>ma,y8_:()=>Dc,yC1:()=>yl,yGw:()=>ye,ywz:()=>b,z$h:()=>K});const n="138",r=0,s=2,o=100,a=301,l=302,c=303,h=304,u=306,d=307,p=1e3,f=1001,m=1002,g=1003,v=1004,y=1005,_=1006,x=1007,M=1008,b=1009,w=1012,S=1014,T=1015,A=1016,E=1020,C=1023,O=1026,P=1027,I=33776,D=33777,L=33778,R=33779,B=35840,N=35842,F=36196,U=37492,G=37496,z=37808,k=36492,j=2300,H=2301,V=2302,W=2400,q=2401,J=2402,X=2500,Y=0,Z=1,K=2,Q=3e3,$=3001,tt=0,et=7680,it=35044,nt=35048,rt="300 es",st=1035;class ot{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const i=this._listeners[t];if(void 0!==i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const i=e.slice(0);for(let e=0,n=i.length;e<n;e++)i[e].call(this,t);t.target=null}}}const at=[];for(let t=0;t<256;t++)at[t]=(t<16?"0":"")+t.toString(16);let lt=1234567;const ct=Math.PI/180,ht=180/Math.PI;function ut(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(at[255&t]+at[t>>8&255]+at[t>>16&255]+at[t>>24&255]+"-"+at[255&e]+at[e>>8&255]+"-"+at[e>>16&15|64]+at[e>>24&255]+"-"+at[63&i|128]+at[i>>8&255]+"-"+at[i>>16&255]+at[i>>24&255]+at[255&n]+at[n>>8&255]+at[n>>16&255]+at[n>>24&255]).toUpperCase()}function dt(t,e,i){return Math.max(e,Math.min(i,t))}function pt(t,e){return(t%e+e)%e}function ft(t,e,i){return(1-i)*t+i*e}function mt(t){return 0==(t&t-1)&&0!==t}function gt(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function vt(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}var yt=Object.freeze({__proto__:null,DEG2RAD:ct,RAD2DEG:ht,generateUUID:ut,clamp:dt,euclideanModulo:pt,mapLinear:function(t,e,i,n,r){return n+(t-e)*(r-n)/(i-e)},inverseLerp:function(t,e,i){return t!==e?(i-t)/(e-t):0},lerp:ft,damp:function(t,e,i,n){return ft(t,e,1-Math.exp(-i*n))},pingpong:function(t,e=1){return e-Math.abs(pt(t,2*e)-e)},smoothstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*(3-2*t)},smootherstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){return void 0!==t&&(lt=t%2147483647),lt=16807*lt%2147483647,(lt-1)/2147483646},degToRad:function(t){return t*ct},radToDeg:function(t){return t*ht},isPowerOfTwo:mt,ceilPowerOfTwo:gt,floorPowerOfTwo:vt,setQuaternionFromProperEuler:function(t,e,i,n,r){const s=Math.cos,o=Math.sin,a=s(i/2),l=o(i/2),c=s((e+n)/2),h=o((e+n)/2),u=s((e-n)/2),d=o((e-n)/2),p=s((n-e)/2),f=o((n-e)/2);switch(r){case"XYX":t.set(a*h,l*u,l*d,a*c);break;case"YZY":t.set(l*d,a*h,l*u,a*c);break;case"ZXZ":t.set(l*u,l*d,a*h,a*c);break;case"XZX":t.set(a*h,l*f,l*p,a*c);break;case"YXY":t.set(l*p,a*h,l*f,a*c);break;case"ZYZ":t.set(l*f,l*p,a*h,a*c)}}});class _t{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?this.addVectors(t,e):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?this.subVectors(t,e):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,i){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),n=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*i-s*n+t.x,this.y=r*n+s*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}_t.prototype.isVector2=!0;class xt{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,n,r,s,o,a,l){const c=this.elements;return c[0]=t,c[1]=n,c[2]=o,c[3]=e,c[4]=r,c[5]=a,c[6]=i,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,r=this.elements,s=i[0],o=i[3],a=i[6],l=i[1],c=i[4],h=i[7],u=i[2],d=i[5],p=i[8],f=n[0],m=n[3],g=n[6],v=n[1],y=n[4],_=n[7],x=n[2],M=n[5],b=n[8];return r[0]=s*f+o*v+a*x,r[3]=s*m+o*y+a*M,r[6]=s*g+o*_+a*b,r[1]=l*f+c*v+h*x,r[4]=l*m+c*y+h*M,r[7]=l*g+c*_+h*b,r[2]=u*f+d*v+p*x,r[5]=u*m+d*y+p*M,r[8]=u*g+d*_+p*b,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*s*c-e*o*l-i*r*c+i*o*a+n*r*l-n*s*a}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=c*s-o*l,u=o*a-c*r,d=l*r-s*a,p=e*h+i*u+n*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=h*f,t[1]=(n*l-c*i)*f,t[2]=(o*i-n*s)*f,t[3]=u*f,t[4]=(c*e-n*a)*f,t[5]=(n*r-o*e)*f,t[6]=d*f,t[7]=(i*a-l*e)*f,t[8]=(s*e-i*r)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,n,r,s,o){const a=Math.cos(r),l=Math.sin(r);return this.set(i*a,i*l,-i*(a*s+l*o)+s+t,-n*l,n*a,-n*(-l*s+a*o)+o+e,0,0,1),this}scale(t,e){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.elements,r=n[0],s=n[3],o=n[6],a=n[1],l=n[4],c=n[7];return n[0]=e*r+i*a,n[3]=e*s+i*l,n[6]=e*o+i*c,n[1]=-i*r+e*a,n[4]=-i*s+e*l,n[7]=-i*o+e*c,this}translate(t,e){const i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<9;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}function Mt(t){for(let e=t.length-1;e>=0;--e)if(t[e]>65535)return!0;return!1}xt.prototype.isMatrix3=!0;Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;function bt(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}const wt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},St={h:0,s:0,l:0},Tt={h:0,s:0,l:0};function At(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}function Et(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Ct(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}class Ot{constructor(t,e,i){return void 0===e&&void 0===i?this.set(t):this.setRGB(t,e,i)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}setRGB(t,e,i){return this.r=t,this.g=e,this.b=i,this}setHSL(t,e,i){if(t=pt(t,1),e=dt(e,0,1),i=dt(i,0,1),0===e)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+e):i+e-i*e,r=2*i-n;this.r=At(r,n,t+1/3),this.g=At(r,n,t),this.b=At(r,n,t-1/3)}return this}setStyle(t){function e(t){void 0!==t&&parseFloat(t)}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t;const n=i[1],r=i[2];switch(n){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,e(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,e(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r)){const i=parseFloat(t[1])/360,n=parseInt(t[2],10)/100,r=parseInt(t[3],10)/100;return e(t[4]),this.setHSL(i,n,r)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=i[1],e=t.length;if(3===e)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,this;if(6===e)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}setColorName(t){const e=wt[t.toLowerCase()];return void 0!==e&&this.setHex(e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Et(t.r),this.g=Et(t.g),this.b=Et(t.b),this}copyLinearToSRGB(t){return this.r=Ct(t.r),this.g=Ct(t.g),this.b=Ct(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){const e=this.r,i=this.g,n=this.b,r=Math.max(e,i,n),s=Math.min(e,i,n);let o,a;const l=(s+r)/2;if(s===r)o=0,a=0;else{const t=r-s;switch(a=l<=.5?t/(r+s):t/(2-r-s),r){case e:o=(i-n)/t+(i<n?6:0);break;case i:o=(n-e)/t+2;break;case n:o=(e-i)/t+4}o/=6}return t.h=o,t.s=a,t.l=l,t}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(t,e,i){return this.getHSL(St),St.h+=t,St.s+=e,St.l+=i,this.setHSL(St.h,St.s,St.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(St),t.getHSL(Tt);const i=ft(St.h,Tt.h,e),n=ft(St.s,Tt.s,e),r=ft(St.l,Tt.l,e);return this.setHSL(i,n,r),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}let Pt;Ot.NAMES=wt,Ot.prototype.isColor=!0,Ot.prototype.r=1,Ot.prototype.g=1,Ot.prototype.b=1;class It{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Pt&&(Pt=bt("canvas")),Pt.width=t.width,Pt.height=t.height;const i=Pt.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=Pt}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=bt("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const n=i.getImageData(0,0,t.width,t.height),r=n.data;for(let t=0;t<r.length;t++)r[t]=255*Et(r[t]/255);return i.putImageData(n,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*Et(e[t]/255)):e[t]=Et(e[t]);return{data:e,width:t.width,height:t.height}}return t}}class Dt{constructor(t=null){this.uuid=ut(),this.data=t,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(null!==n){let t;if(Array.isArray(n)){t=[];for(let e=0,i=n.length;e<i;e++)n[e].isDataTexture?t.push(Lt(n[e].image)):t.push(Lt(n[e]))}else t=Lt(n);i.url=t}return e||(t.images[this.uuid]=i),i}}function Lt(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?It.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:{}}Dt.prototype.isSource=!0;let Rt=0;class Bt extends ot{constructor(t=Bt.DEFAULT_IMAGE,e=Bt.DEFAULT_MAPPING,i=f,n=f,r=_,s=M,o=C,a=b,l=1,c=Q){super(),Object.defineProperty(this,"id",{value:Rt++}),this.uuid=ut(),this.name="",this.source=new Dt(t),this.mipmaps=[],this.mapping=e,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new _t(0,0),this.repeat=new _t(1,1),this.center=new _t(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new xt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case p:t.x=t.x-Math.floor(t.x);break;case f:t.x=t.x<0?0:1;break;case m:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case p:t.y=t.y-Math.floor(t.y);break;case f:t.y=t.y<0?0:1;break;case m:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}}Bt.DEFAULT_IMAGE=null,Bt.DEFAULT_MAPPING=300,Bt.prototype.isTexture=!0;class Nt{constructor(t=0,e=0,i=0,n=1){this.x=t,this.y=e,this.z=i,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?this.addVectors(t,e):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?this.subVectors(t,e):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,r=this.w,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*n+s[12]*r,this.y=s[1]*e+s[5]*i+s[9]*n+s[13]*r,this.z=s[2]*e+s[6]*i+s[10]*n+s[14]*r,this.w=s[3]*e+s[7]*i+s[11]*n+s[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,n,r;const s=.01,o=.1,a=t.elements,l=a[0],c=a[4],h=a[8],u=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(c-u)<s&&Math.abs(h-f)<s&&Math.abs(p-m)<s){if(Math.abs(c+u)<o&&Math.abs(h+f)<o&&Math.abs(p+m)<o&&Math.abs(l+d+g-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,a=(d+1)/2,v=(g+1)/2,y=(c+u)/4,_=(h+f)/4,x=(p+m)/4;return t>a&&t>v?t<s?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(t),n=y/i,r=_/i):a>v?a<s?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(a),i=y/n,r=x/n):v<s?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(v),i=_/r,n=x/r),this.set(i,n,r,e),this}let v=Math.sqrt((m-p)*(m-p)+(h-f)*(h-f)+(u-c)*(u-c));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(h-f)/v,this.z=(u-c)/v,this.w=Math.acos((l+d+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,i){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}Nt.prototype.isVector4=!0;class Ft extends ot{constructor(t,e,i={}){super(),this.width=t,this.height=e,this.depth=1,this.scissor=new Nt(0,0,t,e),this.scissorTest=!1,this.viewport=new Nt(0,0,t,e);const n={width:t,height:e,depth:1};this.texture=new Bt(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:_,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,this.samples=void 0!==i.samples?i.samples:0}setSize(t,e,i=1){this.width===t&&this.height===e&&this.depth===i||(this.width=t,this.height=e,this.depth=i,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.image=Object.assign({},t.texture.image),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}Ft.prototype.isWebGLRenderTarget=!0;class Ut extends Bt{constructor(t=null,e=1,i=1,n=1){super(null),this.image={data:t,width:e,height:i,depth:n},this.magFilter=g,this.minFilter=g,this.wrapR=f,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Ut.prototype.isDataArrayTexture=!0;(class extends Ft{constructor(t,e,i){super(t,e),this.depth=i,this.texture=new Ut(null,t,e,i),this.texture.isRenderTargetTexture=!0}}).prototype.isWebGLArrayRenderTarget=!0;class Gt extends Bt{constructor(t=null,e=1,i=1,n=1){super(null),this.image={data:t,width:e,height:i,depth:n},this.magFilter=g,this.minFilter=g,this.wrapR=f,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Gt.prototype.isData3DTexture=!0;(class extends Ft{constructor(t,e,i){super(t,e),this.depth=i,this.texture=new Gt(null,t,e,i),this.texture.isRenderTargetTexture=!0}}).prototype.isWebGL3DRenderTarget=!0;(class extends Ft{constructor(t,e,i,n={}){super(t,e,n);const r=this.texture;this.texture=[];for(let t=0;t<i;t++)this.texture[t]=r.clone(),this.texture[t].isRenderTargetTexture=!0}setSize(t,e,i=1){if(this.width!==t||this.height!==e||this.depth!==i){this.width=t,this.height=e,this.depth=i;for(let n=0,r=this.texture.length;n<r;n++)this.texture[n].image.width=t,this.texture[n].image.height=e,this.texture[n].image.depth=i;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this.texture.length=0;for(let e=0,i=t.texture.length;e<i;e++)this.texture[e]=t.texture[e].clone();return this}}).prototype.isWebGLMultipleRenderTargets=!0;class zt{constructor(t=0,e=0,i=0,n=1){this._x=t,this._y=e,this._z=i,this._w=n}static slerp(t,e,i,n){return i.slerpQuaternions(t,e,n)}static slerpFlat(t,e,i,n,r,s,o){let a=i[n+0],l=i[n+1],c=i[n+2],h=i[n+3];const u=r[s+0],d=r[s+1],p=r[s+2],f=r[s+3];if(0===o)return t[e+0]=a,t[e+1]=l,t[e+2]=c,void(t[e+3]=h);if(1===o)return t[e+0]=u,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(h!==f||a!==u||l!==d||c!==p){let t=1-o;const e=a*u+l*d+c*p+h*f,i=e>=0?1:-1,n=1-e*e;if(n>Number.EPSILON){const r=Math.sqrt(n),s=Math.atan2(r,e*i);t=Math.sin(t*s)/r,o=Math.sin(o*s)/r}const r=o*i;if(a=a*t+u*r,l=l*t+d*r,c=c*t+p*r,h=h*t+f*r,t===1-o){const t=1/Math.sqrt(a*a+l*l+c*c+h*h);a*=t,l*=t,c*=t,h*=t}}t[e]=a,t[e+1]=l,t[e+2]=c,t[e+3]=h}static multiplyQuaternionsFlat(t,e,i,n,r,s){const o=i[n],a=i[n+1],l=i[n+2],c=i[n+3],h=r[s],u=r[s+1],d=r[s+2],p=r[s+3];return t[e]=o*p+c*h+a*d-l*u,t[e+1]=a*p+c*u+l*h-o*d,t[e+2]=l*p+c*d+o*u-a*h,t[e+3]=c*p-o*h-a*u-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=t._x,n=t._y,r=t._z,s=t._order,o=Math.cos,a=Math.sin,l=o(i/2),c=o(n/2),h=o(r/2),u=a(i/2),d=a(n/2),p=a(r/2);switch(s){case"XYZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"YXZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"ZXY":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"ZYX":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"YZX":this._x=u*c*h+l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h-u*d*p;break;case"XZY":this._x=u*c*h-l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h+u*d*p}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],n=e[4],r=e[8],s=e[1],o=e[5],a=e[9],l=e[2],c=e[6],h=e[10],u=i+o+h;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(c-a)*t,this._y=(r-l)*t,this._z=(s-n)*t}else if(i>o&&i>h){const t=2*Math.sqrt(1+i-o-h);this._w=(c-a)/t,this._x=.25*t,this._y=(n+s)/t,this._z=(r+l)/t}else if(o>h){const t=2*Math.sqrt(1+o-i-h);this._w=(r-l)/t,this._x=(n+s)/t,this._y=.25*t,this._z=(a+c)/t}else{const t=2*Math.sqrt(1+h-i-o);this._w=(s-n)/t,this._x=(r+l)/t,this._y=(a+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(dt(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const n=Math.min(1,e/i);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?this.multiplyQuaternions(t,e):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,n=t._y,r=t._z,s=t._w,o=e._x,a=e._y,l=e._z,c=e._w;return this._x=i*c+s*o+n*l-r*a,this._y=n*c+s*a+r*o-i*l,this._z=r*c+s*l+i*a-n*o,this._w=s*c-i*o-n*a-r*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const i=this._x,n=this._y,r=this._z,s=this._w;let o=s*t._w+i*t._x+n*t._y+r*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=i,this._y=n,this._z=r,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*i+e*this._x,this._y=t*n+e*this._y,this._z=t*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,o),h=Math.sin((1-e)*c)/l,u=Math.sin(e*c)/l;return this._w=s*h+this._w*u,this._x=i*h+this._x*u,this._y=n*h+this._y*u,this._z=r*h+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),n=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(n),i*Math.sin(r),i*Math.cos(r),e*Math.sin(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}zt.prototype.isQuaternion=!0;class kt{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?this.addVectors(t,e):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?this.subVectors(t,e):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?this.multiplyVectors(t,e):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Ht.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Ht.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*n,this.y=r[1]*e+r[4]*i+r[7]*n,this.z=r[2]*e+r[5]*i+r[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,r=t.elements,s=1/(r[3]*e+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*n+r[12])*s,this.y=(r[1]*e+r[5]*i+r[9]*n+r[13])*s,this.z=(r[2]*e+r[6]*i+r[10]*n+r[14])*s,this}applyQuaternion(t){const e=this.x,i=this.y,n=this.z,r=t.x,s=t.y,o=t.z,a=t.w,l=a*e+s*n-o*i,c=a*i+o*e-r*n,h=a*n+r*i-s*e,u=-r*e-s*i-o*n;return this.x=l*a+u*-r+c*-o-h*-s,this.y=c*a+u*-s+h*-r-l*-o,this.z=h*a+u*-o+l*-s-c*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n,this.y=r[1]*e+r[5]*i+r[9]*n,this.z=r[2]*e+r[6]*i+r[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t,e){return void 0!==e?this.crossVectors(t,e):this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,n=t.y,r=t.z,s=e.x,o=e.y,a=e.z;return this.x=n*a-r*o,this.y=r*s-i*a,this.z=i*o-n*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return jt.copy(this).projectOnVector(t),this.sub(jt)}reflect(t){return this.sub(jt.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(dt(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const n=Math.sin(e)*t;return this.x=n*Math.sin(i),this.y=Math.cos(e)*t,this.z=n*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,i){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}kt.prototype.isVector3=!0;const jt=new kt,Ht=new zt;class Vt{constructor(t=new kt(1/0,1/0,1/0),e=new kt(-1/0,-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,l=t.length;a<l;a+=3){const l=t[a],c=t[a+1],h=t[a+2];l<e&&(e=l),c<i&&(i=c),h<n&&(n=h),l>r&&(r=l),c>s&&(s=c),h>o&&(o=h)}return this.min.set(e,i,n),this.max.set(r,s,o),this}setFromBufferAttribute(t){let e=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,l=t.count;a<l;a++){const l=t.getX(a),c=t.getY(a),h=t.getZ(a);l<e&&(e=l),c<i&&(i=c),h<n&&(n=h),l>r&&(r=l),c>s&&(s=c),h>o&&(o=h)}return this.min.set(e,i,n),this.max.set(r,s,o),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=qt.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const i=t.geometry;if(void 0!==i)if(e&&null!=i.attributes&&void 0!==i.attributes.position){const e=i.attributes.position;for(let i=0,n=e.count;i<n;i++)qt.fromBufferAttribute(e,i).applyMatrix4(t.matrixWorld),this.expandByPoint(qt)}else null===i.boundingBox&&i.computeBoundingBox(),Jt.copy(i.boundingBox),Jt.applyMatrix4(t.matrixWorld),this.union(Jt);const n=t.children;for(let t=0,i=n.length;t<i;t++)this.expandByObject(n[t],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,qt),qt.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(te),ee.subVectors(this.max,te),Xt.subVectors(t.a,te),Yt.subVectors(t.b,te),Zt.subVectors(t.c,te),Kt.subVectors(Yt,Xt),Qt.subVectors(Zt,Yt),$t.subVectors(Xt,Zt);let e=[0,-Kt.z,Kt.y,0,-Qt.z,Qt.y,0,-$t.z,$t.y,Kt.z,0,-Kt.x,Qt.z,0,-Qt.x,$t.z,0,-$t.x,-Kt.y,Kt.x,0,-Qt.y,Qt.x,0,-$t.y,$t.x,0];return!!re(e,Xt,Yt,Zt,ee)&&(e=[1,0,0,0,1,0,0,0,1],!!re(e,Xt,Yt,Zt,ee)&&(ie.crossVectors(Kt,Qt),e=[ie.x,ie.y,ie.z],re(e,Xt,Yt,Zt,ee)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return qt.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=.5*this.getSize(qt).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(Wt[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Wt[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Wt[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Wt[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Wt[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Wt[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Wt[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Wt[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Wt)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}Vt.prototype.isBox3=!0;const Wt=[new kt,new kt,new kt,new kt,new kt,new kt,new kt,new kt],qt=new kt,Jt=new Vt,Xt=new kt,Yt=new kt,Zt=new kt,Kt=new kt,Qt=new kt,$t=new kt,te=new kt,ee=new kt,ie=new kt,ne=new kt;function re(t,e,i,n,r){for(let s=0,o=t.length-3;s<=o;s+=3){ne.fromArray(t,s);const o=r.x*Math.abs(ne.x)+r.y*Math.abs(ne.y)+r.z*Math.abs(ne.z),a=e.dot(ne),l=i.dot(ne),c=n.dot(ne);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>o)return!1}return!0}const se=new Vt,oe=new kt,ae=new kt,le=new kt;class ce{constructor(t=new kt,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;void 0!==e?i.copy(e):se.setFromPoints(t).getCenter(i);let n=0;for(let e=0,r=t.length;e<r;e++)n=Math.max(n,i.distanceToSquared(t[e]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){le.subVectors(t,this.center);const e=le.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),i=.5*(t-this.radius);this.center.add(le.multiplyScalar(i/t)),this.radius+=i}return this}union(t){return!0===this.center.equals(t.center)?ae.set(0,0,1).multiplyScalar(t.radius):ae.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(oe.copy(t.center).add(ae)),this.expandByPoint(oe.copy(t.center).sub(ae)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const he=new kt,ue=new kt,de=new kt,pe=new kt,fe=new kt,me=new kt,ge=new kt;class ve{constructor(t=new kt,e=new kt(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,he)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=he.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(he.copy(this.direction).multiplyScalar(e).add(this.origin),he.distanceToSquared(t))}distanceSqToSegment(t,e,i,n){ue.copy(t).add(e).multiplyScalar(.5),de.copy(e).sub(t).normalize(),pe.copy(this.origin).sub(ue);const r=.5*t.distanceTo(e),s=-this.direction.dot(de),o=pe.dot(this.direction),a=-pe.dot(de),l=pe.lengthSq(),c=Math.abs(1-s*s);let h,u,d,p;if(c>0)if(h=s*a-o,u=s*o-a,p=r*c,h>=0)if(u>=-p)if(u<=p){const t=1/c;h*=t,u*=t,d=h*(h+s*u+2*o)+u*(s*h+u+2*a)+l}else u=r,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+l;else u=-r,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+l;else u<=-p?(h=Math.max(0,-(-s*r+o)),u=h>0?-r:Math.min(Math.max(-r,-a),r),d=-h*h+u*(u+2*a)+l):u<=p?(h=0,u=Math.min(Math.max(-r,-a),r),d=u*(u+2*a)+l):(h=Math.max(0,-(s*r+o)),u=h>0?r:Math.min(Math.max(-r,-a),r),d=-h*h+u*(u+2*a)+l);else u=s>0?-r:r,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+l;return i&&i.copy(this.direction).multiplyScalar(h).add(this.origin),n&&n.copy(de).multiplyScalar(u).add(ue),d}intersectSphere(t,e){he.subVectors(t.center,this.origin);const i=he.dot(this.direction),n=he.dot(he)-i*i,r=t.radius*t.radius;if(n>r)return null;const s=Math.sqrt(r-n),o=i-s,a=i+s;return o<0&&a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return null===i?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,n,r,s,o,a;const l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return l>=0?(i=(t.min.x-u.x)*l,n=(t.max.x-u.x)*l):(i=(t.max.x-u.x)*l,n=(t.min.x-u.x)*l),c>=0?(r=(t.min.y-u.y)*c,s=(t.max.y-u.y)*c):(r=(t.max.y-u.y)*c,s=(t.min.y-u.y)*c),i>s||r>n?null:((r>i||i!=i)&&(i=r),(s<n||n!=n)&&(n=s),h>=0?(o=(t.min.z-u.z)*h,a=(t.max.z-u.z)*h):(o=(t.max.z-u.z)*h,a=(t.min.z-u.z)*h),i>a||o>n?null:((o>i||i!=i)&&(i=o),(a<n||n!=n)&&(n=a),n<0?null:this.at(i>=0?i:n,e)))}intersectsBox(t){return null!==this.intersectBox(t,he)}intersectTriangle(t,e,i,n,r){fe.subVectors(e,t),me.subVectors(i,t),ge.crossVectors(fe,me);let s,o=this.direction.dot(ge);if(o>0){if(n)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}pe.subVectors(this.origin,t);const a=s*this.direction.dot(me.crossVectors(pe,me));if(a<0)return null;const l=s*this.direction.dot(fe.cross(pe));if(l<0)return null;if(a+l>o)return null;const c=-s*pe.dot(ge);return c<0?null:this.at(c/o,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class ye{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,n,r,s,o,a,l,c,h,u,d,p,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=n,g[1]=r,g[5]=s,g[9]=o,g[13]=a,g[2]=l,g[6]=c,g[10]=h,g[14]=u,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new ye).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,n=1/_e.setFromMatrixColumn(t,0).length(),r=1/_e.setFromMatrixColumn(t,1).length(),s=1/_e.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=0,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=0,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,i=t.x,n=t.y,r=t.z,s=Math.cos(i),o=Math.sin(i),a=Math.cos(n),l=Math.sin(n),c=Math.cos(r),h=Math.sin(r);if("XYZ"===t.order){const t=s*c,i=s*h,n=o*c,r=o*h;e[0]=a*c,e[4]=-a*h,e[8]=l,e[1]=i+n*l,e[5]=t-r*l,e[9]=-o*a,e[2]=r-t*l,e[6]=n+i*l,e[10]=s*a}else if("YXZ"===t.order){const t=a*c,i=a*h,n=l*c,r=l*h;e[0]=t+r*o,e[4]=n*o-i,e[8]=s*l,e[1]=s*h,e[5]=s*c,e[9]=-o,e[2]=i*o-n,e[6]=r+t*o,e[10]=s*a}else if("ZXY"===t.order){const t=a*c,i=a*h,n=l*c,r=l*h;e[0]=t-r*o,e[4]=-s*h,e[8]=n+i*o,e[1]=i+n*o,e[5]=s*c,e[9]=r-t*o,e[2]=-s*l,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){const t=s*c,i=s*h,n=o*c,r=o*h;e[0]=a*c,e[4]=n*l-i,e[8]=t*l+r,e[1]=a*h,e[5]=r*l+t,e[9]=i*l-n,e[2]=-l,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){const t=s*a,i=s*l,n=o*a,r=o*l;e[0]=a*c,e[4]=r-t*h,e[8]=n*h+i,e[1]=h,e[5]=s*c,e[9]=-o*c,e[2]=-l*c,e[6]=i*h+n,e[10]=t-r*h}else if("XZY"===t.order){const t=s*a,i=s*l,n=o*a,r=o*l;e[0]=a*c,e[4]=-h,e[8]=l*c,e[1]=t*h+r,e[5]=s*c,e[9]=i*h-n,e[2]=n*h-i,e[6]=o*c,e[10]=r*h+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Me,t,be)}lookAt(t,e,i){const n=this.elements;return Te.subVectors(t,e),0===Te.lengthSq()&&(Te.z=1),Te.normalize(),we.crossVectors(i,Te),0===we.lengthSq()&&(1===Math.abs(i.z)?Te.x+=1e-4:Te.z+=1e-4,Te.normalize(),we.crossVectors(i,Te)),we.normalize(),Se.crossVectors(Te,we),n[0]=we.x,n[4]=Se.x,n[8]=Te.x,n[1]=we.y,n[5]=Se.y,n[9]=Te.y,n[2]=we.z,n[6]=Se.z,n[10]=Te.z,this}multiply(t,e){return void 0!==e?this.multiplyMatrices(t,e):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,r=this.elements,s=i[0],o=i[4],a=i[8],l=i[12],c=i[1],h=i[5],u=i[9],d=i[13],p=i[2],f=i[6],m=i[10],g=i[14],v=i[3],y=i[7],_=i[11],x=i[15],M=n[0],b=n[4],w=n[8],S=n[12],T=n[1],A=n[5],E=n[9],C=n[13],O=n[2],P=n[6],I=n[10],D=n[14],L=n[3],R=n[7],B=n[11],N=n[15];return r[0]=s*M+o*T+a*O+l*L,r[4]=s*b+o*A+a*P+l*R,r[8]=s*w+o*E+a*I+l*B,r[12]=s*S+o*C+a*D+l*N,r[1]=c*M+h*T+u*O+d*L,r[5]=c*b+h*A+u*P+d*R,r[9]=c*w+h*E+u*I+d*B,r[13]=c*S+h*C+u*D+d*N,r[2]=p*M+f*T+m*O+g*L,r[6]=p*b+f*A+m*P+g*R,r[10]=p*w+f*E+m*I+g*B,r[14]=p*S+f*C+m*D+g*N,r[3]=v*M+y*T+_*O+x*L,r[7]=v*b+y*A+_*P+x*R,r[11]=v*w+y*E+_*I+x*B,r[15]=v*S+y*C+_*D+x*N,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],n=t[8],r=t[12],s=t[1],o=t[5],a=t[9],l=t[13],c=t[2],h=t[6],u=t[10],d=t[14];return t[3]*(+r*a*h-n*l*h-r*o*u+i*l*u+n*o*d-i*a*d)+t[7]*(+e*a*d-e*l*u+r*s*u-n*s*d+n*l*c-r*a*c)+t[11]*(+e*l*h-e*o*d-r*s*h+i*s*d+r*o*c-i*l*c)+t[15]*(-n*o*c-e*a*h+e*o*u+n*s*h-i*s*u+i*a*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],u=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],v=h*m*l-f*u*l+f*a*d-o*m*d-h*a*g+o*u*g,y=p*u*l-c*m*l-p*a*d+s*m*d+c*a*g-s*u*g,_=c*f*l-p*h*l+p*o*d-s*f*d-c*o*g+s*h*g,x=p*h*a-c*f*a-p*o*u+s*f*u+c*o*m-s*h*m,M=e*v+i*y+n*_+r*x;if(0===M)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const b=1/M;return t[0]=v*b,t[1]=(f*u*r-h*m*r-f*n*d+i*m*d+h*n*g-i*u*g)*b,t[2]=(o*m*r-f*a*r+f*n*l-i*m*l-o*n*g+i*a*g)*b,t[3]=(h*a*r-o*u*r-h*n*l+i*u*l+o*n*d-i*a*d)*b,t[4]=y*b,t[5]=(c*m*r-p*u*r+p*n*d-e*m*d-c*n*g+e*u*g)*b,t[6]=(p*a*r-s*m*r-p*n*l+e*m*l+s*n*g-e*a*g)*b,t[7]=(s*u*r-c*a*r+c*n*l-e*u*l-s*n*d+e*a*d)*b,t[8]=_*b,t[9]=(p*h*r-c*f*r-p*i*d+e*f*d+c*i*g-e*h*g)*b,t[10]=(s*f*r-p*o*r+p*i*l-e*f*l-s*i*g+e*o*g)*b,t[11]=(c*o*r-s*h*r-c*i*l+e*h*l+s*i*d-e*o*d)*b,t[12]=x*b,t[13]=(c*f*n-p*h*n+p*i*u-e*f*u-c*i*m+e*h*m)*b,t[14]=(p*o*n-s*f*n-p*i*a+e*f*a+s*i*m-e*o*m)*b,t[15]=(s*h*n-c*o*n+c*i*a-e*h*a-s*i*u+e*o*u)*b,this}scale(t){const e=this.elements,i=t.x,n=t.y,r=t.z;return e[0]*=i,e[4]*=n,e[8]*=r,e[1]*=i,e[5]*=n,e[9]*=r,e[2]*=i,e[6]*=n,e[10]*=r,e[3]*=i,e[7]*=n,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),n=Math.sin(e),r=1-i,s=t.x,o=t.y,a=t.z,l=r*s,c=r*o;return this.set(l*s+i,l*o-n*a,l*a+n*o,0,l*o+n*a,c*o+i,c*a-n*s,0,l*a-n*o,c*a+n*s,r*a*a+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,n,r,s){return this.set(1,i,r,0,t,1,s,0,e,n,1,0,0,0,0,1),this}compose(t,e,i){const n=this.elements,r=e._x,s=e._y,o=e._z,a=e._w,l=r+r,c=s+s,h=o+o,u=r*l,d=r*c,p=r*h,f=s*c,m=s*h,g=o*h,v=a*l,y=a*c,_=a*h,x=i.x,M=i.y,b=i.z;return n[0]=(1-(f+g))*x,n[1]=(d+_)*x,n[2]=(p-y)*x,n[3]=0,n[4]=(d-_)*M,n[5]=(1-(u+g))*M,n[6]=(m+v)*M,n[7]=0,n[8]=(p+y)*b,n[9]=(m-v)*b,n[10]=(1-(u+f))*b,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,i){const n=this.elements;let r=_e.set(n[0],n[1],n[2]).length();const s=_e.set(n[4],n[5],n[6]).length(),o=_e.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),t.x=n[12],t.y=n[13],t.z=n[14],xe.copy(this);const a=1/r,l=1/s,c=1/o;return xe.elements[0]*=a,xe.elements[1]*=a,xe.elements[2]*=a,xe.elements[4]*=l,xe.elements[5]*=l,xe.elements[6]*=l,xe.elements[8]*=c,xe.elements[9]*=c,xe.elements[10]*=c,e.setFromRotationMatrix(xe),i.x=r,i.y=s,i.z=o,this}makePerspective(t,e,i,n,r,s){const o=this.elements,a=2*r/(e-t),l=2*r/(i-n),c=(e+t)/(e-t),h=(i+n)/(i-n),u=-(s+r)/(s-r),d=-2*s*r/(s-r);return o[0]=a,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=u,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,i,n,r,s){const o=this.elements,a=1/(e-t),l=1/(i-n),c=1/(s-r),h=(e+t)*a,u=(i+n)*l,d=(s+r)*c;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-u,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<16;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}ye.prototype.isMatrix4=!0;const _e=new kt,xe=new ye,Me=new kt(0,0,0),be=new kt(1,1,1),we=new kt,Se=new kt,Te=new kt,Ae=new ye,Ee=new zt;class Ce{constructor(t=0,e=0,i=0,n=Ce.DefaultOrder){this._x=t,this._y=e,this._z=i,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,n=this._order){return this._x=t,this._y=e,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const n=t.elements,r=n[0],s=n[4],o=n[8],a=n[1],l=n[5],c=n[9],h=n[2],u=n[6],d=n[10];switch(e){case"XYZ":this._y=Math.asin(dt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-dt(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-h,r),this._z=0);break;case"ZXY":this._x=Math.asin(dt(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(a,r));break;case"ZYX":this._y=Math.asin(-dt(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(dt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,r)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-dt(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-c,d),this._y=0)}return this._order=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return Ae.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Ae,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Ee.setFromEuler(this),this.setFromQuaternion(Ee,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Ce.prototype.isEuler=!0,Ce.DefaultOrder="XYZ",Ce.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Oe{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}let Pe=0;const Ie=new kt,De=new zt,Le=new ye,Re=new kt,Be=new kt,Ne=new kt,Fe=new zt,Ue=new kt(1,0,0),Ge=new kt(0,1,0),ze=new kt(0,0,1),ke={type:"added"},je={type:"removed"};class He extends ot{constructor(){super(),Object.defineProperty(this,"id",{value:Pe++}),this.uuid=ut(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=He.DefaultUp.clone();const t=new kt,e=new Ce,i=new zt,n=new kt(1,1,1);e._onChange((function(){i.setFromEuler(e,!1)})),i._onChange((function(){e.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new ye},normalMatrix:{value:new xt}}),this.matrix=new ye,this.matrixWorld=new ye,this.matrixAutoUpdate=He.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Oe,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return De.setFromAxisAngle(t,e),this.quaternion.multiply(De),this}rotateOnWorldAxis(t,e){return De.setFromAxisAngle(t,e),this.quaternion.premultiply(De),this}rotateX(t){return this.rotateOnAxis(Ue,t)}rotateY(t){return this.rotateOnAxis(Ge,t)}rotateZ(t){return this.rotateOnAxis(ze,t)}translateOnAxis(t,e){return Ie.copy(t).applyQuaternion(this.quaternion),this.position.add(Ie.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Ue,t)}translateY(t){return this.translateOnAxis(Ge,t)}translateZ(t){return this.translateOnAxis(ze,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(Le.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?Re.copy(t):Re.set(t,e,i);const n=this.parent;this.updateWorldMatrix(!0,!1),Be.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Le.lookAt(Be,Re,this.up):Le.lookAt(Re,Be,this.up),this.quaternion.setFromRotationMatrix(Le),n&&(Le.extractRotation(n.matrixWorld),De.setFromRotationMatrix(Le),this.quaternion.premultiply(De.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(ke)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(je)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(je)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),Le.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Le.multiply(t.parent.matrixWorld)),t.applyMatrix4(Le),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectByProperty(t,e);if(void 0!==n)return n}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Be,t,Ne),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Be,Fe,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].updateMatrixWorld(t)}updateWorldMatrix(t,e){const i=this.parent;if(!0===t&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,i=t.length;e<i;e++)t[e].updateWorldMatrix(!1,!0)}}toJSON(t){const e=void 0===t||"string"==typeof t,i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};function r(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const i=e.shapes;if(Array.isArray(i))for(let e=0,n=i.length;e<n;e++){const n=i[e];r(t.shapes,n)}else r(t.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let i=0,n=this.material.length;i<n;i++)e.push(r(t.materials,this.material[i]));n.material=e}else n.material=r(t.materials,this.material);if(this.children.length>0){n.children=[];for(let e=0;e<this.children.length;e++)n.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let e=0;e<this.animations.length;e++){const i=this.animations[e];n.animations.push(r(t.animations,i))}}if(e){const e=s(t.geometries),n=s(t.materials),r=s(t.textures),o=s(t.images),a=s(t.shapes),l=s(t.skeletons),c=s(t.animations),h=s(t.nodes);e.length>0&&(i.geometries=e),n.length>0&&(i.materials=n),r.length>0&&(i.textures=r),o.length>0&&(i.images=o),a.length>0&&(i.shapes=a),l.length>0&&(i.skeletons=l),c.length>0&&(i.animations=c),h.length>0&&(i.nodes=h)}return i.object=n,i;function s(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const i=t.children[e];this.add(i.clone())}return this}}He.DefaultUp=new kt(0,1,0),He.DefaultMatrixAutoUpdate=!0,He.prototype.isObject3D=!0;const Ve=new kt,We=new kt,qe=new kt,Je=new kt,Xe=new kt,Ye=new kt,Ze=new kt,Ke=new kt,Qe=new kt,$e=new kt;class ti{constructor(t=new kt,e=new kt,i=new kt){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,n){n.subVectors(i,e),Ve.subVectors(t,e),n.cross(Ve);const r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(t,e,i,n,r){Ve.subVectors(n,e),We.subVectors(i,e),qe.subVectors(t,e);const s=Ve.dot(Ve),o=Ve.dot(We),a=Ve.dot(qe),l=We.dot(We),c=We.dot(qe),h=s*l-o*o;if(0===h)return r.set(-2,-1,-1);const u=1/h,d=(l*a-o*c)*u,p=(s*c-o*a)*u;return r.set(1-d-p,p,d)}static containsPoint(t,e,i,n){return this.getBarycoord(t,e,i,n,Je),Je.x>=0&&Je.y>=0&&Je.x+Je.y<=1}static getUV(t,e,i,n,r,s,o,a){return this.getBarycoord(t,e,i,n,Je),a.set(0,0),a.addScaledVector(r,Je.x),a.addScaledVector(s,Je.y),a.addScaledVector(o,Je.z),a}static isFrontFacing(t,e,i,n){return Ve.subVectors(i,e),We.subVectors(t,e),Ve.cross(We).dot(n)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this}setFromAttributeAndIndices(t,e,i,n){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Ve.subVectors(this.c,this.b),We.subVectors(this.a,this.b),.5*Ve.cross(We).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return ti.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return ti.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,n,r){return ti.getUV(t,this.a,this.b,this.c,e,i,n,r)}containsPoint(t){return ti.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return ti.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,n=this.b,r=this.c;let s,o;Xe.subVectors(n,i),Ye.subVectors(r,i),Ke.subVectors(t,i);const a=Xe.dot(Ke),l=Ye.dot(Ke);if(a<=0&&l<=0)return e.copy(i);Qe.subVectors(t,n);const c=Xe.dot(Qe),h=Ye.dot(Qe);if(c>=0&&h<=c)return e.copy(n);const u=a*h-c*l;if(u<=0&&a>=0&&c<=0)return s=a/(a-c),e.copy(i).addScaledVector(Xe,s);$e.subVectors(t,r);const d=Xe.dot($e),p=Ye.dot($e);if(p>=0&&d<=p)return e.copy(r);const f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return o=l/(l-p),e.copy(i).addScaledVector(Ye,o);const m=c*p-d*h;if(m<=0&&h-c>=0&&d-p>=0)return Ze.subVectors(r,n),o=(h-c)/(h-c+(d-p)),e.copy(n).addScaledVector(Ze,o);const g=1/(m+f+u);return s=f*g,o=u*g,e.copy(i).addScaledVector(Xe,s).addScaledVector(Ye,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let ei=0;class ii extends ot{constructor(){super(),Object.defineProperty(this,"id",{value:ei++}),this.uuid=ut(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=r,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=o,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=et,this.stencilZFail=et,this.stencilZPass=et,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const i=t[e];if(void 0===i)continue;if("shading"===e){this.type,this.flatShading=1===i;continue}const n=this[e];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]=i:this.type}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),this.side!==r&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),e){const e=n(t.textures),r=n(t.images);e.length>0&&(i.textures=e),r.length>0&&(i.images=r)}return i}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(null!==e){const t=e.length;i=new Array(t);for(let n=0;n!==t;++n)i[n]=e[n].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}ii.prototype.isMaterial=!0,ii.fromType=function(){return null};class ni extends ii{constructor(t){super(),this.type="MeshBasicMaterial",this.color=new Ot(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}ni.prototype.isMeshBasicMaterial=!0;const ri=new kt,si=new _t;class oi{constructor(t,e,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===i,this.usage=it,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[t+n]=e.array[i+n];return this}copyArray(t){return this.array.set(t),this}copyColorsArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(r=new Ot),e[i++]=r.r,e[i++]=r.g,e[i++]=r.b}return this}copyVector2sArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(r=new _t),e[i++]=r.x,e[i++]=r.y}return this}copyVector3sArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(r=new kt),e[i++]=r.x,e[i++]=r.y,e[i++]=r.z}return this}copyVector4sArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(r=new Nt),e[i++]=r.x,e[i++]=r.y,e[i++]=r.z,e[i++]=r.w}return this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,i=this.count;e<i;e++)si.fromBufferAttribute(this,e),si.applyMatrix3(t),this.setXY(e,si.x,si.y);else if(3===this.itemSize)for(let e=0,i=this.count;e<i;e++)ri.fromBufferAttribute(this,e),ri.applyMatrix3(t),this.setXYZ(e,ri.x,ri.y,ri.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)ri.x=this.getX(e),ri.y=this.getY(e),ri.z=this.getZ(e),ri.applyMatrix4(t),this.setXYZ(e,ri.x,ri.y,ri.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)ri.x=this.getX(e),ri.y=this.getY(e),ri.z=this.getZ(e),ri.applyNormalMatrix(t),this.setXYZ(e,ri.x,ri.y,ri.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)ri.x=this.getX(e),ri.y=this.getY(e),ri.z=this.getZ(e),ri.transformDirection(t),this.setXYZ(e,ri.x,ri.y,ri.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){return this.array[t*this.itemSize]}setX(t,e){return this.array[t*this.itemSize]=e,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,e){return this.array[t*this.itemSize+1]=e,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,e){return this.array[t*this.itemSize+2]=e,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,e){return this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this}setXYZW(t,e,i,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==it&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t}}oi.prototype.isBufferAttribute=!0;class ai extends oi{constructor(t,e,i){super(new Uint8Array(t),e,i)}}class li extends oi{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class ci extends oi{constructor(t,e,i){super(new Uint32Array(t),e,i)}}(class extends oi{constructor(t,e,i){super(new Uint16Array(t),e,i)}}).prototype.isFloat16BufferAttribute=!0;class hi extends oi{constructor(t,e,i){super(new Float32Array(t),e,i)}}let ui=0;const di=new ye,pi=new He,fi=new kt,mi=new Vt,gi=new Vt,vi=new kt;class yi extends ot{constructor(){super(),Object.defineProperty(this,"id",{value:ui++}),this.uuid=ut(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Mt(t)?ci:li)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const e=(new xt).getNormalMatrix(t);i.applyNormalMatrix(e),i.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(t),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return di.makeRotationFromQuaternion(t),this.applyMatrix4(di),this}rotateX(t){return di.makeRotationX(t),this.applyMatrix4(di),this}rotateY(t){return di.makeRotationY(t),this.applyMatrix4(di),this}rotateZ(t){return di.makeRotationZ(t),this.applyMatrix4(di),this}translate(t,e,i){return di.makeTranslation(t,e,i),this.applyMatrix4(di),this}scale(t,e,i){return di.makeScale(t,e,i),this.applyMatrix4(di),this}lookAt(t){return pi.lookAt(t),pi.updateMatrix(),this.applyMatrix4(pi.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(fi).negate(),this.translate(fi.x,fi.y,fi.z),this}setFromPoints(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i];e.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new hi(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Vt);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new kt(-1/0,-1/0,-1/0),new kt(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];mi.setFromBufferAttribute(i),this.morphTargetsRelative?(vi.addVectors(this.boundingBox.min,mi.min),this.boundingBox.expandByPoint(vi),vi.addVectors(this.boundingBox.max,mi.max),this.boundingBox.expandByPoint(vi)):(this.boundingBox.expandByPoint(mi.min),this.boundingBox.expandByPoint(mi.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new ce);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new kt,1/0);if(t){const i=this.boundingSphere.center;if(mi.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];gi.setFromBufferAttribute(i),this.morphTargetsRelative?(vi.addVectors(mi.min,gi.min),mi.expandByPoint(vi),vi.addVectors(mi.max,gi.max),mi.expandByPoint(vi)):(mi.expandByPoint(gi.min),mi.expandByPoint(gi.max))}mi.getCenter(i);let n=0;for(let e=0,r=t.count;e<r;e++)vi.fromBufferAttribute(t,e),n=Math.max(n,i.distanceToSquared(vi));if(e)for(let r=0,s=e.length;r<s;r++){const s=e[r],o=this.morphTargetsRelative;for(let e=0,r=s.count;e<r;e++)vi.fromBufferAttribute(s,e),o&&(fi.fromBufferAttribute(t,e),vi.add(fi)),n=Math.max(n,i.distanceToSquared(vi))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=t.array,n=e.position.array,r=e.normal.array,s=e.uv.array,o=n.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new oi(new Float32Array(4*o),4));const a=this.getAttribute("tangent").array,l=[],c=[];for(let t=0;t<o;t++)l[t]=new kt,c[t]=new kt;const h=new kt,u=new kt,d=new kt,p=new _t,f=new _t,m=new _t,g=new kt,v=new kt;function y(t,e,i){h.fromArray(n,3*t),u.fromArray(n,3*e),d.fromArray(n,3*i),p.fromArray(s,2*t),f.fromArray(s,2*e),m.fromArray(s,2*i),u.sub(h),d.sub(h),f.sub(p),m.sub(p);const r=1/(f.x*m.y-m.x*f.y);isFinite(r)&&(g.copy(u).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(r),v.copy(d).multiplyScalar(f.x).addScaledVector(u,-m.x).multiplyScalar(r),l[t].add(g),l[e].add(g),l[i].add(g),c[t].add(v),c[e].add(v),c[i].add(v))}let _=this.groups;0===_.length&&(_=[{start:0,count:i.length}]);for(let t=0,e=_.length;t<e;++t){const e=_[t],n=e.start;for(let t=n,r=n+e.count;t<r;t+=3)y(i[t+0],i[t+1],i[t+2])}const x=new kt,M=new kt,b=new kt,w=new kt;function S(t){b.fromArray(r,3*t),w.copy(b);const e=l[t];x.copy(e),x.sub(b.multiplyScalar(b.dot(e))).normalize(),M.crossVectors(w,e);const i=M.dot(c[t])<0?-1:1;a[4*t]=x.x,a[4*t+1]=x.y,a[4*t+2]=x.z,a[4*t+3]=i}for(let t=0,e=_.length;t<e;++t){const e=_[t],n=e.start;for(let t=n,r=n+e.count;t<r;t+=3)S(i[t+0]),S(i[t+1]),S(i[t+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let i=this.getAttribute("normal");if(void 0===i)i=new oi(new Float32Array(3*e.count),3),this.setAttribute("normal",i);else for(let t=0,e=i.count;t<e;t++)i.setXYZ(t,0,0,0);const n=new kt,r=new kt,s=new kt,o=new kt,a=new kt,l=new kt,c=new kt,h=new kt;if(t)for(let u=0,d=t.count;u<d;u+=3){const d=t.getX(u+0),p=t.getX(u+1),f=t.getX(u+2);n.fromBufferAttribute(e,d),r.fromBufferAttribute(e,p),s.fromBufferAttribute(e,f),c.subVectors(s,r),h.subVectors(n,r),c.cross(h),o.fromBufferAttribute(i,d),a.fromBufferAttribute(i,p),l.fromBufferAttribute(i,f),o.add(c),a.add(c),l.add(c),i.setXYZ(d,o.x,o.y,o.z),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,o=e.count;t<o;t+=3)n.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),c.subVectors(s,r),h.subVectors(n,r),c.cross(h),i.setXYZ(t+0,c.x,c.y,c.z),i.setXYZ(t+1,c.x,c.y,c.z),i.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0);const i=this.attributes;for(const n in i){if(void 0===t.attributes[n])continue;const r=i[n].array,s=t.attributes[n],o=s.array,a=s.itemSize*e,l=Math.min(o.length,r.length-a);for(let t=0,e=a;t<l;t++,e++)r[e]=o[t]}return this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)vi.fromBufferAttribute(t,e),vi.normalize(),t.setXYZ(e,vi.x,vi.y,vi.z)}toNonIndexed(){function t(t,e){const i=t.array,n=t.itemSize,r=t.normalized,s=new i.constructor(e.length*n);let o=0,a=0;for(let r=0,l=e.length;r<l;r++){o=t.isInterleavedBufferAttribute?e[r]*t.data.stride+t.offset:e[r]*n;for(let t=0;t<n;t++)s[a++]=i[o++]}return new oi(s,n,r)}if(null===this.index)return this;const e=new yi,i=this.index.array,n=this.attributes;for(const r in n){const s=t(n[r],i);e.setAttribute(r,s)}const r=this.morphAttributes;for(const n in r){const s=[],o=r[n];for(let e=0,n=o.length;e<n;e++){const n=t(o[e],i);s.push(n)}e.morphAttributes[n]=s}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let t=0,i=s.length;t<i;t++){const i=s[t];e.addGroup(i.start,i.count,i.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const i in e)void 0!==e[i]&&(t[i]=e[i]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const e in i){const n=i[e];t.data.attributes[e]=n.toJSON(t.data)}const n={};let r=!1;for(const e in this.morphAttributes){const i=this.morphAttributes[e],s=[];for(let e=0,n=i.length;e<n;e++){const n=i[e];s.push(n.toJSON(t.data))}s.length>0&&(n[e]=s,r=!0)}r&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;null!==i&&this.setIndex(i.clone(e));const n=t.attributes;for(const t in n){const i=n[t];this.setAttribute(t,i.clone(e))}const r=t.morphAttributes;for(const t in r){const i=[],n=r[t];for(let t=0,r=n.length;t<r;t++)i.push(n[t].clone(e));this.morphAttributes[t]=i}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;t<e;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,void 0!==t.parameters&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}yi.prototype.isBufferGeometry=!0;const _i=new ye,xi=new ve,Mi=new ce,bi=new kt,wi=new kt,Si=new kt,Ti=new kt,Ai=new kt,Ei=new kt,Ci=new kt,Oi=new kt,Pi=new kt,Ii=new _t,Di=new _t,Li=new _t,Ri=new kt,Bi=new kt;class Ni extends He{constructor(t=new yi,e=new ni){super(),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(t,e){const i=this.geometry,n=this.material,r=this.matrixWorld;if(void 0===n)return;if(null===i.boundingSphere&&i.computeBoundingSphere(),Mi.copy(i.boundingSphere),Mi.applyMatrix4(r),!1===t.ray.intersectsSphere(Mi))return;if(_i.copy(r).invert(),xi.copy(t.ray).applyMatrix4(_i),null!==i.boundingBox&&!1===xi.intersectsBox(i.boundingBox))return;let s;if(i.isBufferGeometry){const r=i.index,o=i.attributes.position,a=i.morphAttributes.position,l=i.morphTargetsRelative,c=i.attributes.uv,h=i.attributes.uv2,u=i.groups,d=i.drawRange;if(null!==r)if(Array.isArray(n))for(let i=0,p=u.length;i<p;i++){const p=u[i],f=n[p.materialIndex];for(let i=Math.max(p.start,d.start),n=Math.min(r.count,Math.min(p.start+p.count,d.start+d.count));i<n;i+=3){const n=r.getX(i),u=r.getX(i+1),d=r.getX(i+2);s=Fi(this,f,t,xi,o,a,l,c,h,n,u,d),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=p.materialIndex,e.push(s))}}else{for(let i=Math.max(0,d.start),u=Math.min(r.count,d.start+d.count);i<u;i+=3){const u=r.getX(i),d=r.getX(i+1),p=r.getX(i+2);s=Fi(this,n,t,xi,o,a,l,c,h,u,d,p),s&&(s.faceIndex=Math.floor(i/3),e.push(s))}}else if(void 0!==o)if(Array.isArray(n))for(let i=0,r=u.length;i<r;i++){const r=u[i],p=n[r.materialIndex];for(let i=Math.max(r.start,d.start),n=Math.min(o.count,Math.min(r.start+r.count,d.start+d.count));i<n;i+=3){s=Fi(this,p,t,xi,o,a,l,c,h,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=r.materialIndex,e.push(s))}}else{for(let i=Math.max(0,d.start),r=Math.min(o.count,d.start+d.count);i<r;i+=3){s=Fi(this,n,t,xi,o,a,l,c,h,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),e.push(s))}}}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function Fi(t,e,i,n,r,o,a,l,c,h,u,d){bi.fromBufferAttribute(r,h),wi.fromBufferAttribute(r,u),Si.fromBufferAttribute(r,d);const p=t.morphTargetInfluences;if(o&&p){Ci.set(0,0,0),Oi.set(0,0,0),Pi.set(0,0,0);for(let t=0,e=o.length;t<e;t++){const e=p[t],i=o[t];0!==e&&(Ti.fromBufferAttribute(i,h),Ai.fromBufferAttribute(i,u),Ei.fromBufferAttribute(i,d),a?(Ci.addScaledVector(Ti,e),Oi.addScaledVector(Ai,e),Pi.addScaledVector(Ei,e)):(Ci.addScaledVector(Ti.sub(bi),e),Oi.addScaledVector(Ai.sub(wi),e),Pi.addScaledVector(Ei.sub(Si),e)))}bi.add(Ci),wi.add(Oi),Si.add(Pi)}t.isSkinnedMesh&&(t.boneTransform(h,bi),t.boneTransform(u,wi),t.boneTransform(d,Si));const f=function(t,e,i,n,r,o,a,l){let c;if(c=1===e.side?n.intersectTriangle(a,o,r,!0,l):n.intersectTriangle(r,o,a,e.side!==s,l),null===c)return null;Bi.copy(l),Bi.applyMatrix4(t.matrixWorld);const h=i.ray.origin.distanceTo(Bi);return h<i.near||h>i.far?null:{distance:h,point:Bi.clone(),object:t}}(t,e,i,n,bi,wi,Si,Ri);if(f){l&&(Ii.fromBufferAttribute(l,h),Di.fromBufferAttribute(l,u),Li.fromBufferAttribute(l,d),f.uv=ti.getUV(Ri,bi,wi,Si,Ii,Di,Li,new _t)),c&&(Ii.fromBufferAttribute(c,h),Di.fromBufferAttribute(c,u),Li.fromBufferAttribute(c,d),f.uv2=ti.getUV(Ri,bi,wi,Si,Ii,Di,Li,new _t));const t={a:h,b:u,c:d,normal:new kt,materialIndex:0};ti.getNormal(bi,wi,Si,t.normal),f.face=t}return f}Ni.prototype.isMesh=!0;class Ui extends yi{constructor(t=1,e=1,i=1,n=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:r,depthSegments:s};const o=this;n=Math.floor(n),r=Math.floor(r),s=Math.floor(s);const a=[],l=[],c=[],h=[];let u=0,d=0;function p(t,e,i,n,r,s,p,f,m,g,v){const y=s/m,_=p/g,x=s/2,M=p/2,b=f/2,w=m+1,S=g+1;let T=0,A=0;const E=new kt;for(let s=0;s<S;s++){const o=s*_-M;for(let a=0;a<w;a++){const u=a*y-x;E[t]=u*n,E[e]=o*r,E[i]=b,l.push(E.x,E.y,E.z),E[t]=0,E[e]=0,E[i]=f>0?1:-1,c.push(E.x,E.y,E.z),h.push(a/m),h.push(1-s/g),T+=1}}for(let t=0;t<g;t++)for(let e=0;e<m;e++){const i=u+e+w*t,n=u+e+w*(t+1),r=u+(e+1)+w*(t+1),s=u+(e+1)+w*t;a.push(i,n,s),a.push(n,r,s),A+=6}o.addGroup(d,A,v),d+=A,u+=T}p("z","y","x",-1,-1,i,e,t,s,r,0),p("z","y","x",1,-1,i,e,-t,s,r,1),p("x","z","y",1,1,t,i,e,n,s,2),p("x","z","y",1,-1,t,i,-e,n,s,3),p("x","y","z",1,-1,t,e,i,n,r,4),p("x","y","z",-1,-1,t,e,-i,n,r,5),this.setIndex(a),this.setAttribute("position",new hi(l,3)),this.setAttribute("normal",new hi(c,3)),this.setAttribute("uv",new hi(h,2))}static fromJSON(t){return new Ui(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Gi(t){const e={};for(const i in t){e[i]={};for(const n in t[i]){const r=t[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?e[i][n]=r.clone():Array.isArray(r)?e[i][n]=r.slice():e[i][n]=r}}return e}function zi(t){const e={};for(let i=0;i<t.length;i++){const n=Gi(t[i]);for(const t in n)e[t]=n[t]}return e}const ki={clone:Gi,merge:zi};class ji extends ii{constructor(t){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Gi(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?e.uniforms[i]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[i]={type:"m4",value:n.toArray()}:e.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const i={};for(const t in this.extensions)!0===this.extensions[t]&&(i[t]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}}ji.prototype.isShaderMaterial=!0;class Hi extends He{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new ye,this.projectionMatrix=new ye,this.projectionMatrixInverse=new ye}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}Hi.prototype.isCamera=!0;class Vi extends Hi{constructor(t=50,e=1,i=.1,n=2e3){super(),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*ht*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*ct*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*ht*Math.atan(Math.tan(.5*ct*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,n,r,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*ct*this.fov)/this.zoom,i=2*e,n=this.aspect*i,r=-.5*n;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,o=s.fullHeight;r+=s.offsetX*n/t,e-=s.offsetY*i/o,n*=s.width/t,i*=s.height/o}const o=this.filmOffset;0!==o&&(r+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,e,e-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}Vi.prototype.isPerspectiveCamera=!0;const Wi=90;class qi extends He{constructor(t,e,i){if(super(),this.type="CubeCamera",!0!==i.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=i;const n=new Vi(Wi,1,t,e);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new kt(1,0,0)),this.add(n);const r=new Vi(Wi,1,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new kt(-1,0,0)),this.add(r);const s=new Vi(Wi,1,t,e);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new kt(0,1,0)),this.add(s);const o=new Vi(Wi,1,t,e);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new kt(0,-1,0)),this.add(o);const a=new Vi(Wi,1,t,e);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new kt(0,0,1)),this.add(a);const l=new Vi(Wi,1,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new kt(0,0,-1)),this.add(l)}update(t,e){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget,[n,r,s,o,a,l]=this.children,c=t.xr.enabled,h=t.getRenderTarget();t.xr.enabled=!1;const u=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(e,n),t.setRenderTarget(i,1),t.render(e,r),t.setRenderTarget(i,2),t.render(e,s),t.setRenderTarget(i,3),t.render(e,o),t.setRenderTarget(i,4),t.render(e,a),i.texture.generateMipmaps=u,t.setRenderTarget(i,5),t.render(e,l),t.setRenderTarget(h),t.xr.enabled=c,i.texture.needsPMREMUpdate=!0}}class Ji extends Bt{constructor(t,e,i,n,r,s,o,l,c,h){super(t=void 0!==t?t:[],e=void 0!==e?e:a,i,n,r,s,o,l,c,h),this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}Ji.prototype.isCubeTexture=!0;class Xi extends Ft{constructor(t,e={}){super(t,t,e);const i={width:t,height:t,depth:1},n=[i,i,i,i,i,i];this.texture=new Ji(n,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:_}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.format=C,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},n=new Ui(5,5,5),r=new ji({name:"CubemapFromEquirect",uniforms:Gi(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:1,blending:0});r.uniforms.tEquirect.value=e;const s=new Ni(n,r),o=e.minFilter;e.minFilter===M&&(e.minFilter=_);return new qi(1,10,this).update(t,s),e.minFilter=o,s.geometry.dispose(),s.material.dispose(),this}clear(t,e,i,n){const r=t.getRenderTarget();for(let r=0;r<6;r++)t.setRenderTarget(this,r),t.clear(e,i,n);t.setRenderTarget(r)}}Xi.prototype.isWebGLCubeRenderTarget=!0;const Yi=new kt,Zi=new kt,Ki=new xt;class Qi{constructor(t=new kt(1,0,0),e=0){this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const n=Yi.subVectors(i,e).cross(Zi.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){const i=t.delta(Yi),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:e.copy(i).multiplyScalar(r).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||Ki.getNormalMatrix(t),n=this.coplanarPoint(Yi).applyMatrix4(t),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}Qi.prototype.isPlane=!0;const $i=new ce,tn=new kt;class en{constructor(t=new Qi,e=new Qi,i=new Qi,n=new Qi,r=new Qi,s=new Qi){this.planes=[t,e,i,n,r,s]}set(t,e,i,n,r,s){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(i),o[3].copy(n),o[4].copy(r),o[5].copy(s),this}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){const e=this.planes,i=t.elements,n=i[0],r=i[1],s=i[2],o=i[3],a=i[4],l=i[5],c=i[6],h=i[7],u=i[8],d=i[9],p=i[10],f=i[11],m=i[12],g=i[13],v=i[14],y=i[15];return e[0].setComponents(o-n,h-a,f-u,y-m).normalize(),e[1].setComponents(o+n,h+a,f+u,y+m).normalize(),e[2].setComponents(o+r,h+l,f+d,y+g).normalize(),e[3].setComponents(o-r,h-l,f-d,y-g).normalize(),e[4].setComponents(o-s,h-c,f-p,y-v).normalize(),e[5].setComponents(o+s,h+c,f+p,y+v).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),$i.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere($i)}intersectsSprite(t){return $i.center.set(0,0,0),$i.radius=.7071067811865476,$i.applyMatrix4(t.matrixWorld),this.intersectsSphere($i)}intersectsSphere(t){const e=this.planes,i=t.center,n=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(i)<n)return!1}return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const n=e[i];if(tn.x=n.normal.x>0?t.max.x:t.min.x,tn.y=n.normal.y>0?t.max.y:t.min.y,tn.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(tn)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function nn(){let t=null,e=!1,i=null,n=null;function r(e,s){i(e,s),n=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==i&&(n=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(t){i=t},setContext:function(e){t=e}}}function rn(t,e){const i=e.isWebGL2,n=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),n.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const i=n.get(e);i&&(t.deleteBuffer(i.buffer),n.delete(e))},update:function(e,r){if(e.isGLBufferAttribute){const t=n.get(e);return void((!t||t.version<e.version)&&n.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const s=n.get(e);void 0===s?n.set(e,function(e,n){const r=e.array,s=e.usage,o=t.createBuffer();let a;if(t.bindBuffer(n,o),t.bufferData(n,r,s),e.onUploadCallback(),r instanceof Float32Array)a=5126;else if(r instanceof Uint16Array)if(e.isFloat16BufferAttribute){if(!i)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");a=5131}else a=5123;else if(r instanceof Int16Array)a=5122;else if(r instanceof Uint32Array)a=5125;else if(r instanceof Int32Array)a=5124;else if(r instanceof Int8Array)a=5120;else if(r instanceof Uint8Array)a=5121;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);a=5121}return{buffer:o,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}(e,r)):s.version<e.version&&(!function(e,n,r){const s=n.array,o=n.updateRange;t.bindBuffer(r,e),-1===o.count?t.bufferSubData(r,0,s):(i?t.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s,o.offset,o.count):t.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s.subarray(o.offset,o.offset+o.count)),o.count=-1)}(s.buffer,e,r),s.version=e.version)}}}class sn extends yi{constructor(t=1,e=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n};const r=t/2,s=e/2,o=Math.floor(i),a=Math.floor(n),l=o+1,c=a+1,h=t/o,u=e/a,d=[],p=[],f=[],m=[];for(let t=0;t<c;t++){const e=t*u-s;for(let i=0;i<l;i++){const n=i*h-r;p.push(n,-e,0),f.push(0,0,1),m.push(i/o),m.push(1-t/a)}}for(let t=0;t<a;t++)for(let e=0;e<o;e++){const i=e+l*t,n=e+l*(t+1),r=e+1+l*(t+1),s=e+1+l*t;d.push(i,n,s),d.push(n,r,s)}this.setIndex(d),this.setAttribute("position",new hi(p,3)),this.setAttribute("normal",new hi(f,3)),this.setAttribute("uv",new hi(m,2))}static fromJSON(t){return new sn(t.width,t.height,t.widthSegments,t.heightSegments)}}const on={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 ) + 0.5;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ]\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform vec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tfloat texelIndex = float( vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset );\n\t\t\tfloat y = floor( texelIndex / morphTargetsTextureSize.x );\n\t\t\tfloat x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tvec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );\n\t\t\treturn texture( morphTargetsTexture, morphUV );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},an={common:{diffuse:{value:new Ot(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new xt},uv2Transform:{value:new xt},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new _t(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ot(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ot(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new xt}},sprite:{diffuse:{value:new Ot(16777215)},opacity:{value:1},center:{value:new _t(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new xt}}},ln={basic:{uniforms:zi([an.common,an.specularmap,an.envmap,an.aomap,an.lightmap,an.fog]),vertexShader:on.meshbasic_vert,fragmentShader:on.meshbasic_frag},lambert:{uniforms:zi([an.common,an.specularmap,an.envmap,an.aomap,an.lightmap,an.emissivemap,an.fog,an.lights,{emissive:{value:new Ot(0)}}]),vertexShader:on.meshlambert_vert,fragmentShader:on.meshlambert_frag},phong:{uniforms:zi([an.common,an.specularmap,an.envmap,an.aomap,an.lightmap,an.emissivemap,an.bumpmap,an.normalmap,an.displacementmap,an.fog,an.lights,{emissive:{value:new Ot(0)},specular:{value:new Ot(1118481)},shininess:{value:30}}]),vertexShader:on.meshphong_vert,fragmentShader:on.meshphong_frag},standard:{uniforms:zi([an.common,an.envmap,an.aomap,an.lightmap,an.emissivemap,an.bumpmap,an.normalmap,an.displacementmap,an.roughnessmap,an.metalnessmap,an.fog,an.lights,{emissive:{value:new Ot(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:on.meshphysical_vert,fragmentShader:on.meshphysical_frag},toon:{uniforms:zi([an.common,an.aomap,an.lightmap,an.emissivemap,an.bumpmap,an.normalmap,an.displacementmap,an.gradientmap,an.fog,an.lights,{emissive:{value:new Ot(0)}}]),vertexShader:on.meshtoon_vert,fragmentShader:on.meshtoon_frag},matcap:{uniforms:zi([an.common,an.bumpmap,an.normalmap,an.displacementmap,an.fog,{matcap:{value:null}}]),vertexShader:on.meshmatcap_vert,fragmentShader:on.meshmatcap_frag},points:{uniforms:zi([an.points,an.fog]),vertexShader:on.points_vert,fragmentShader:on.points_frag},dashed:{uniforms:zi([an.common,an.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:on.linedashed_vert,fragmentShader:on.linedashed_frag},depth:{uniforms:zi([an.common,an.displacementmap]),vertexShader:on.depth_vert,fragmentShader:on.depth_frag},normal:{uniforms:zi([an.common,an.bumpmap,an.normalmap,an.displacementmap,{opacity:{value:1}}]),vertexShader:on.meshnormal_vert,fragmentShader:on.meshnormal_frag},sprite:{uniforms:zi([an.sprite,an.fog]),vertexShader:on.sprite_vert,fragmentShader:on.sprite_frag},background:{uniforms:{uvTransform:{value:new xt},t2D:{value:null}},vertexShader:on.background_vert,fragmentShader:on.background_frag},cube:{uniforms:zi([an.envmap,{opacity:{value:1}}]),vertexShader:on.cube_vert,fragmentShader:on.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:on.equirect_vert,fragmentShader:on.equirect_frag},distanceRGBA:{uniforms:zi([an.common,an.displacementmap,{referencePosition:{value:new kt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:on.distanceRGBA_vert,fragmentShader:on.distanceRGBA_frag},shadow:{uniforms:zi([an.lights,an.fog,{color:{value:new Ot(0)},opacity:{value:1}}]),vertexShader:on.shadow_vert,fragmentShader:on.shadow_frag}};function cn(t,e,i,n,s,o){const a=new Ot(0);let l,c,h=!0===s?0:1,d=null,p=0,f=null;function m(t,e){i.buffers.color.setClear(t.r,t.g,t.b,e,o)}return{getClearColor:function(){return a},setClearColor:function(t,e=1){a.set(t),h=e,m(a,h)},getClearAlpha:function(){return h},setClearAlpha:function(t){h=t,m(a,h)},render:function(i,s){let o=!1,g=!0===s.isScene?s.background:null;g&&g.isTexture&&(g=e.get(g));const v=t.xr,y=v.getSession&&v.getSession();y&&"additive"===y.environmentBlendMode&&(g=null),null===g?m(a,h):g&&g.isColor&&(m(g,1),o=!0),(t.autoClear||o)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),g&&(g.isCubeTexture||g.mapping===u)?(void 0===c&&(c=new Ni(new Ui(1,1,1),new ji({name:"BackgroundCubeMaterial",uniforms:Gi(ln.cube.uniforms),vertexShader:ln.cube.vertexShader,fragmentShader:ln.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(t,e,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(c)),c.material.uniforms.envMap.value=g,c.material.uniforms.flipEnvMap.value=g.isCubeTexture&&!1===g.isRenderTargetTexture?-1:1,d===g&&p===g.version&&f===t.toneMapping||(c.material.needsUpdate=!0,d=g,p=g.version,f=t.toneMapping),i.unshift(c,c.geometry,c.material,0,0,null)):g&&g.isTexture&&(void 0===l&&(l=new Ni(new sn(2,2),new ji({name:"BackgroundMaterial",uniforms:Gi(ln.background.uniforms),vertexShader:ln.background.vertexShader,fragmentShader:ln.background.fragmentShader,side:r,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(l)),l.material.uniforms.t2D.value=g,!0===g.matrixAutoUpdate&&g.updateMatrix(),l.material.uniforms.uvTransform.value.copy(g.matrix),d===g&&p===g.version&&f===t.toneMapping||(l.material.needsUpdate=!0,d=g,p=g.version,f=t.toneMapping),i.unshift(l,l.geometry,l.material,0,0,null))}}}function hn(t,e,i,n){const r=t.getParameter(34921),s=n.isWebGL2?null:e.get("OES_vertex_array_object"),o=n.isWebGL2||null!==s,a={},l=d(null);let c=l;function h(e){return n.isWebGL2?t.bindVertexArray(e):s.bindVertexArrayOES(e)}function u(e){return n.isWebGL2?t.deleteVertexArray(e):s.deleteVertexArrayOES(e)}function d(t){const e=[],i=[],n=[];for(let t=0;t<r;t++)e[t]=0,i[t]=0,n[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:i,attributeDivisors:n,object:t,attributes:{},index:null}}function p(){const t=c.newAttributes;for(let e=0,i=t.length;e<i;e++)t[e]=0}function f(t){m(t,0)}function m(i,r){const s=c.newAttributes,o=c.enabledAttributes,a=c.attributeDivisors;if(s[i]=1,0===o[i]&&(t.enableVertexAttribArray(i),o[i]=1),a[i]!==r){(n.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,r),a[i]=r}}function g(){const e=c.newAttributes,i=c.enabledAttributes;for(let n=0,r=i.length;n<r;n++)i[n]!==e[n]&&(t.disableVertexAttribArray(n),i[n]=0)}function v(e,i,r,s,o,a){!0!==n.isWebGL2||5124!==r&&5125!==r?t.vertexAttribPointer(e,i,r,s,o,a):t.vertexAttribIPointer(e,i,r,o,a)}function y(){_(),c!==l&&(c=l,h(c.object))}function _(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,u,y,_){let x=!1;if(o){const e=function(e,i,r){const o=!0===r.wireframe;let l=a[e.id];void 0===l&&(l={},a[e.id]=l);let c=l[i.id];void 0===c&&(c={},l[i.id]=c);let h=c[o];void 0===h&&(h=d(n.isWebGL2?t.createVertexArray():s.createVertexArrayOES()),c[o]=h);return h}(y,u,l);c!==e&&(c=e,h(c.object)),x=function(t,e){const i=c.attributes,n=t.attributes;let r=0;for(const t in n){const e=i[t],s=n[t];if(void 0===e)return!0;if(e.attribute!==s)return!0;if(e.data!==s.data)return!0;r++}return c.attributesNum!==r||c.index!==e}(y,_),x&&function(t,e){const i={},n=t.attributes;let r=0;for(const t in n){const e=n[t],s={};s.attribute=e,e.data&&(s.data=e.data),i[t]=s,r++}c.attributes=i,c.attributesNum=r,c.index=e}(y,_)}else{const t=!0===l.wireframe;c.geometry===y.id&&c.program===u.id&&c.wireframe===t||(c.geometry=y.id,c.program=u.id,c.wireframe=t,x=!0)}!0===r.isInstancedMesh&&(x=!0),null!==_&&i.update(_,34963),x&&(!function(r,s,o,a){if(!1===n.isWebGL2&&(r.isInstancedMesh||a.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;p();const l=a.attributes,c=o.getAttributes(),h=s.defaultAttributeValues;for(const e in c){const n=c[e];if(n.location>=0){let s=l[e];if(void 0===s&&("instanceMatrix"===e&&r.instanceMatrix&&(s=r.instanceMatrix),"instanceColor"===e&&r.instanceColor&&(s=r.instanceColor)),void 0!==s){const e=s.normalized,o=s.itemSize,l=i.get(s);if(void 0===l)continue;const c=l.buffer,h=l.type,u=l.bytesPerElement;if(s.isInterleavedBufferAttribute){const i=s.data,l=i.stride,d=s.offset;if(i.isInstancedInterleavedBuffer){for(let t=0;t<n.locationSize;t++)m(n.location+t,i.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let t=0;t<n.locationSize;t++)f(n.location+t);t.bindBuffer(34962,c);for(let t=0;t<n.locationSize;t++)v(n.location+t,o/n.locationSize,h,e,l*u,(d+o/n.locationSize*t)*u)}else{if(s.isInstancedBufferAttribute){for(let t=0;t<n.locationSize;t++)m(n.location+t,s.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let t=0;t<n.locationSize;t++)f(n.location+t);t.bindBuffer(34962,c);for(let t=0;t<n.locationSize;t++)v(n.location+t,o/n.locationSize,h,e,o*u,o/n.locationSize*t*u)}}else if(void 0!==h){const i=h[e];if(void 0!==i)switch(i.length){case 2:t.vertexAttrib2fv(n.location,i);break;case 3:t.vertexAttrib3fv(n.location,i);break;case 4:t.vertexAttrib4fv(n.location,i);break;default:t.vertexAttrib1fv(n.location,i)}}}}g()}(r,l,u,y),null!==_&&t.bindBuffer(34963,i.get(_).buffer))},reset:y,resetDefaultState:_,dispose:function(){y();for(const t in a){const e=a[t];for(const t in e){const i=e[t];for(const t in i)u(i[t].object),delete i[t];delete e[t]}delete a[t]}},releaseStatesOfGeometry:function(t){if(void 0===a[t.id])return;const e=a[t.id];for(const t in e){const i=e[t];for(const t in i)u(i[t].object),delete i[t];delete e[t]}delete a[t.id]},releaseStatesOfProgram:function(t){for(const e in a){const i=a[e];if(void 0===i[t.id])continue;const n=i[t.id];for(const t in n)u(n[t].object),delete n[t];delete i[t.id]}},initAttributes:p,enableAttribute:f,disableUnusedAttributes:g}}function un(t,e,i,n){const r=n.isWebGL2;let s;this.setMode=function(t){s=t},this.render=function(e,n){t.drawArrays(s,e,n),i.update(n,s,1)},this.renderInstances=function(n,o,a){if(0===a)return;let l,c;if(r)l=t,c="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](s,n,o,a),i.update(o,s,a)}}function dn(t,e,i){let n;function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let o=void 0!==i.precision?i.precision:"highp";const a=r(o);a!==o&&(o=a);const l=s||e.has("WEBGL_draw_buffers"),c=!0===i.logarithmicDepthBuffer,h=t.getParameter(34930),u=t.getParameter(35660),d=t.getParameter(3379),p=t.getParameter(34076),f=t.getParameter(34921),m=t.getParameter(36347),g=t.getParameter(36348),v=t.getParameter(36349),y=u>0,_=s||e.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===e.has("EXT_texture_filter_anisotropic")){const i=e.get("EXT_texture_filter_anisotropic");n=t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:c,maxTextures:h,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:_,floatVertexTextures:y&&_,maxSamples:s?t.getParameter(36183):0}}function pn(t){const e=this;let i=null,n=0,r=!1,s=!1;const o=new Qi,a=new xt,l={value:null,needsUpdate:!1};function c(){l.value!==i&&(l.value=i,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function h(t,i,n,r){const s=null!==t?t.length:0;let c=null;if(0!==s){if(c=l.value,!0!==r||null===c){const e=n+4*s,r=i.matrixWorldInverse;a.getNormalMatrix(r),(null===c||c.length<e)&&(c=new Float32Array(e));for(let e=0,i=n;e!==s;++e,i+=4)o.copy(t[e]).applyMatrix4(r,a),o.normal.toArray(c,i),c[i+3]=o.constant}l.value=c,l.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,s){const o=0!==t.length||e||0!==n||r;return r=e,i=h(t,s,0),n=t.length,o},this.beginShadows=function(){s=!0,h(null)},this.endShadows=function(){s=!1,c()},this.setState=function(e,o,a){const u=e.clippingPlanes,d=e.clipIntersection,p=e.clipShadows,f=t.get(e);if(!r||null===u||0===u.length||s&&!p)s?h(null):c();else{const t=s?0:n,e=4*t;let r=f.clippingState||null;l.value=r,r=h(u,o,e,a);for(let t=0;t!==e;++t)r[t]=i[t];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function fn(t){let e=new WeakMap;function i(t,e){return e===c?t.mapping=a:e===h&&(t.mapping=l),t}function n(t){const i=t.target;i.removeEventListener("dispose",n);const r=e.get(i);void 0!==r&&(e.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){const s=r.mapping;if(s===c||s===h){if(e.has(r)){return i(e.get(r).texture,r.mapping)}{const s=r.image;if(s&&s.height>0){const o=new Xi(s.height/2);return o.fromEquirectangularTexture(t,r),e.set(r,o),r.addEventListener("dispose",n),i(o.texture,r.mapping)}return null}}}return r},dispose:function(){e=new WeakMap}}}ln.physical={uniforms:zi([ln.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new _t(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new Ot(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new _t},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Ot(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Ot(1,1,1)},specularColorMap:{value:null}}]),vertexShader:on.meshphysical_vert,fragmentShader:on.meshphysical_frag};class mn extends Hi{constructor(t=-1,e=1,i=1,n=-1,r=.1,s=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=n,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,i,n,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let r=i-t,s=i+t,o=n+e,a=n-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=t*this.view.offsetX,s=r+t*this.view.width,o-=e*this.view.offsetY,a=o-e*this.view.height}this.projectionMatrix.makeOrthographic(r,s,o,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}mn.prototype.isOrthographicCamera=!0;const gn=[.125,.215,.35,.446,.526,.582],vn=20,yn=new mn,_n=new Ot;let xn=null;const Mn=(1+Math.sqrt(5))/2,bn=1/Mn,wn=[new kt(1,1,1),new kt(-1,1,1),new kt(1,1,-1),new kt(-1,1,-1),new kt(0,Mn,bn),new kt(0,Mn,-bn),new kt(bn,0,Mn),new kt(-bn,0,Mn),new kt(Mn,bn,0),new kt(-Mn,bn,0)];class Sn{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,n=100){xn=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(t,i,n,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Cn(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=En(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(xn),t.scissorTest=!1,An(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===a||t.mapping===l?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),xn=this._renderer.getRenderTarget();const i=e||this._allocateTargets();return this._textureToCubeUV(t,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize-32,i={magFilter:_,minFilter:_,generateMipmaps:!1,type:A,format:C,encoding:Q,depthBuffer:!1},n=Tn(t,e,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Tn(t,e,i);const{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(t){const e=[],i=[],n=[];let r=t;const s=t-4+1+gn.length;for(let o=0;o<s;o++){const s=Math.pow(2,r);i.push(s);let a=1/s;o>t-4?a=gn[o-t+4-1]:0===o&&(a=0),n.push(a);const l=1/(s-1),c=-l/2,h=1+l/2,u=[c,c,h,c,h,h,c,c,h,h,c,h],d=6,p=6,f=3,m=2,g=1,v=new Float32Array(f*p*d),y=new Float32Array(m*p*d),_=new Float32Array(g*p*d);for(let t=0;t<d;t++){const e=t%3*2/3-1,i=t>2?0:-1,n=[e,i,0,e+2/3,i,0,e+2/3,i+1,0,e,i,0,e+2/3,i+1,0,e,i+1,0];v.set(n,f*p*t),y.set(u,m*p*t);const r=[t,t,t,t,t,t];_.set(r,g*p*t)}const x=new yi;x.setAttribute("position",new oi(v,f)),x.setAttribute("uv",new oi(y,m)),x.setAttribute("faceIndex",new oi(_,g)),e.push(x),r>4&&r--}return{lodPlanes:e,sizeLods:i,sigmas:n}}(n)),this._blurMaterial=function(t,e,i){const n=new Float32Array(vn),r=new kt(0,1,0);return new ji({name:"SphericalGaussianBlur",defines:{n:vn,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:On(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(n,t,e)}return n}_compileMaterial(t){const e=new Ni(this._lodPlanes[0],t);this._renderer.compile(e,yn)}_sceneToCubeUV(t,e,i,n){const r=new Vi(90,1,e,i),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,c=a.toneMapping;a.getClearColor(_n),a.toneMapping=0,a.autoClear=!1;const h=new ni({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),u=new Ni(new Ui,h);let d=!1;const p=t.background;p?p.isColor&&(h.color.copy(p),t.background=null,d=!0):(h.color.copy(_n),d=!0);for(let e=0;e<6;e++){const i=e%3;0===i?(r.up.set(0,s[e],0),r.lookAt(o[e],0,0)):1===i?(r.up.set(0,0,s[e]),r.lookAt(0,o[e],0)):(r.up.set(0,s[e],0),r.lookAt(0,0,o[e]));const l=this._cubeSize;An(n,i*l,e>2?l:0,l,l),a.setRenderTarget(n),d&&a.render(u,r),a.render(t,r)}u.geometry.dispose(),u.material.dispose(),a.toneMapping=c,a.autoClear=l,t.background=p}_textureToCubeUV(t,e){const i=this._renderer,n=t.mapping===a||t.mapping===l;n?(null===this._cubemapMaterial&&(this._cubemapMaterial=Cn()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=En());const r=n?this._cubemapMaterial:this._equirectMaterial,s=new Ni(this._lodPlanes[0],r);r.uniforms.envMap.value=t;const o=this._cubeSize;An(e,0,0,3*o,2*o),i.setRenderTarget(e),i.render(s,yn)}_applyPMREM(t){const e=this._renderer,i=e.autoClear;e.autoClear=!1;for(let e=1;e<this._lodPlanes.length;e++){const i=Math.sqrt(this._sigmas[e]*this._sigmas[e]-this._sigmas[e-1]*this._sigmas[e-1]),n=wn[(e-1)%wn.length];this._blur(t,e-1,e,i,n)}e.autoClear=i}_blur(t,e,i,n,r){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,i,n,"latitudinal",r),this._halfBlur(s,t,i,i,n,"longitudinal",r)}_halfBlur(t,e,i,n,r,s,o){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new Ni(this._lodPlanes[n],l),h=l.uniforms,u=this._sizeLods[i]-1,d=isFinite(r)?Math.PI/(2*u):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):vn,m=[];let g=0;for(let t=0;t<vn;++t){const e=t/p,i=Math.exp(-e*e/2);m.push(i),0===t?g+=i:t<f&&(g+=2*i)}for(let t=0;t<m.length;t++)m[t]=m[t]/g;h.envMap.value=t.texture,h.samples.value=f,h.weights.value=m,h.latitudinal.value="latitudinal"===s,o&&(h.poleAxis.value=o);const{_lodMax:v}=this;h.dTheta.value=d,h.mipInt.value=v-i;const y=this._sizeLods[n];An(e,3*y*(n>v-4?n-v+4:0),4*(this._cubeSize-y),3*y,2*y),a.setRenderTarget(e),a.render(c,yn)}}function Tn(t,e,i){const n=new Ft(t,e,i);return n.texture.mapping=u,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function An(t,e,i,n,r){t.viewport.set(e,i,n,r),t.scissor.set(e,i,n,r)}function En(){return new ji({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:On(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Cn(){return new ji({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:On(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function On(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function Pn(t){let e=new WeakMap,i=null;function n(t){const i=t.target;i.removeEventListener("dispose",n);const r=e.get(i);void 0!==r&&(e.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping,o=s===c||s===h,u=s===a||s===l;if(o||u){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;let n=e.get(r);return null===i&&(i=new Sn(t)),n=o?i.fromEquirectangular(r,n):i.fromCubemap(r,n),e.set(r,n),n.texture}if(e.has(r))return e.get(r).texture;{const s=r.image;if(o&&s&&s.height>0||u&&s&&function(t){let e=0;const i=6;for(let n=0;n<i;n++)void 0!==t[n]&&e++;return e===i}(s)){null===i&&(i=new Sn(t));const s=o?i.fromEquirectangular(r):i.fromCubemap(r);return e.set(r,s),r.addEventListener("dispose",n),s.texture}return null}}}return r},dispose:function(){e=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function In(t){const e={};function i(i){if(void 0!==e[i])return e[i];let n;switch(i){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(i)}return e[i]=n,n}return{has:function(t){return null!==i(t)},init:function(t){t.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(t){const e=i(t);return e}}}function Dn(t,e,i,n){const r={},s=new WeakMap;function o(t){const a=t.target;null!==a.index&&e.remove(a.index);for(const t in a.attributes)e.remove(a.attributes[t]);a.removeEventListener("dispose",o),delete r[a.id];const l=s.get(a);l&&(e.remove(l),s.delete(a)),n.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,i.memory.geometries--}function a(t){const i=[],n=t.index,r=t.attributes.position;let o=0;if(null!==n){const t=n.array;o=n.version;for(let e=0,n=t.length;e<n;e+=3){const n=t[e+0],r=t[e+1],s=t[e+2];i.push(n,r,r,s,s,n)}}else{const t=r.array;o=r.version;for(let e=0,n=t.length/3-1;e<n;e+=3){const t=e+0,n=e+1,r=e+2;i.push(t,n,n,r,r,t)}}const a=new(Mt(i)?ci:li)(i,1);a.version=o;const l=s.get(t);l&&e.remove(l),s.set(t,a)}return{get:function(t,e){return!0===r[e.id]||(e.addEventListener("dispose",o),r[e.id]=!0,i.memory.geometries++),e},update:function(t){const i=t.attributes;for(const t in i)e.update(i[t],34962);const n=t.morphAttributes;for(const t in n){const i=n[t];for(let t=0,n=i.length;t<n;t++)e.update(i[t],34962)}},getWireframeAttribute:function(t){const e=s.get(t);if(e){const i=t.index;null!==i&&e.version<i.version&&a(t)}else a(t);return s.get(t)}}}function Ln(t,e,i,n){const r=n.isWebGL2;let s,o,a;this.setMode=function(t){s=t},this.setIndex=function(t){o=t.type,a=t.bytesPerElement},this.render=function(e,n){t.drawElements(s,n,o,e*a),i.update(n,s,1)},this.renderInstances=function(n,l,c){if(0===c)return;let h,u;if(r)h=t,u="drawElementsInstanced";else if(h=e.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",null===h)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[u](s,l,o,n*a,c),i.update(l,s,c)}}function Rn(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,i,n){switch(e.calls++,i){case 4:e.triangles+=n*(t/3);break;case 1:e.lines+=n*(t/2);break;case 3:e.lines+=n*(t-1);break;case 2:e.lines+=n*t;break;case 0:e.points+=n*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function Bn(t,e){return t[0]-e[0]}function Nn(t,e){return Math.abs(e[1])-Math.abs(t[1])}function Fn(t,e){let i=1;const n=e.isInterleavedBufferAttribute?e.data.array:e.array;n instanceof Int8Array?i=127:n instanceof Int16Array?i=32767:n instanceof Int32Array?i=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",n),t.divideScalar(i)}function Un(t,e,i){const n={},r=new Float32Array(8),s=new WeakMap,o=new Nt,a=[];for(let t=0;t<8;t++)a[t]=[t,0];return{update:function(l,c,h,u){const d=l.morphTargetInfluences;if(!0===e.isWebGL2){const p=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,f=void 0!==p?p.length:0;let m=s.get(c);if(void 0===m||m.count!==f){void 0!==m&&m.texture.dispose();const y=void 0!==c.morphAttributes.position,_=void 0!==c.morphAttributes.normal,x=void 0!==c.morphAttributes.color,M=c.morphAttributes.position||[],b=c.morphAttributes.normal||[],w=c.morphAttributes.color||[];let S=0;!0===y&&(S=1),!0===_&&(S=2),!0===x&&(S=3);let A=c.attributes.position.count*S,E=1;A>e.maxTextureSize&&(E=Math.ceil(A/e.maxTextureSize),A=e.maxTextureSize);const O=new Float32Array(A*E*4*f),P=new Ut(O,A,E,f);P.format=C,P.type=T,P.needsUpdate=!0;const I=4*S;for(let L=0;L<f;L++){const R=M[L],B=b[L],N=w[L],F=A*E*4*L;for(let U=0;U<R.count;U++){const G=U*I;!0===y&&(o.fromBufferAttribute(R,U),!0===R.normalized&&Fn(o,R),O[F+G+0]=o.x,O[F+G+1]=o.y,O[F+G+2]=o.z,O[F+G+3]=0),!0===_&&(o.fromBufferAttribute(B,U),!0===B.normalized&&Fn(o,B),O[F+G+4]=o.x,O[F+G+5]=o.y,O[F+G+6]=o.z,O[F+G+7]=0),!0===x&&(o.fromBufferAttribute(N,U),!0===N.normalized&&Fn(o,B),O[F+G+8]=o.x,O[F+G+9]=o.y,O[F+G+10]=o.z,O[F+G+11]=4===N.itemSize?o.w:1)}}function D(){P.dispose(),s.delete(c),c.removeEventListener("dispose",D)}m={count:f,texture:P,size:new _t(A,E)},s.set(c,m),c.addEventListener("dispose",D)}let g=0;for(let z=0;z<d.length;z++)g+=d[z];const v=c.morphTargetsRelative?1:1-g;u.getUniforms().setValue(t,"morphTargetBaseInfluence",v),u.getUniforms().setValue(t,"morphTargetInfluences",d),u.getUniforms().setValue(t,"morphTargetsTexture",m.texture,i),u.getUniforms().setValue(t,"morphTargetsTextureSize",m.size)}else{const k=void 0===d?0:d.length;let j=n[c.id];if(void 0===j||j.length!==k){j=[];for(let J=0;J<k;J++)j[J]=[J,0];n[c.id]=j}for(let X=0;X<k;X++){const Y=j[X];Y[0]=X,Y[1]=d[X]}j.sort(Nn);for(let Z=0;Z<8;Z++)Z<k&&j[Z][1]?(a[Z][0]=j[Z][0],a[Z][1]=j[Z][1]):(a[Z][0]=Number.MAX_SAFE_INTEGER,a[Z][1]=0);a.sort(Bn);const H=c.morphAttributes.position,V=c.morphAttributes.normal;let W=0;for(let K=0;K<8;K++){const Q=a[K],$=Q[0],tt=Q[1];$!==Number.MAX_SAFE_INTEGER&&tt?(H&&c.getAttribute("morphTarget"+K)!==H[$]&&c.setAttribute("morphTarget"+K,H[$]),V&&c.getAttribute("morphNormal"+K)!==V[$]&&c.setAttribute("morphNormal"+K,V[$]),r[K]=tt,W+=tt):(H&&!0===c.hasAttribute("morphTarget"+K)&&c.deleteAttribute("morphTarget"+K),V&&!0===c.hasAttribute("morphNormal"+K)&&c.deleteAttribute("morphNormal"+K),r[K]=0)}const q=c.morphTargetsRelative?1:1-W;u.getUniforms().setValue(t,"morphTargetBaseInfluence",q),u.getUniforms().setValue(t,"morphTargetInfluences",r)}}}}function Gn(t,e,i,n){let r=new WeakMap;function s(t){const e=t.target;e.removeEventListener("dispose",s),i.remove(e.instanceMatrix),null!==e.instanceColor&&i.remove(e.instanceColor)}return{update:function(t){const o=n.render.frame,a=t.geometry,l=e.get(t,a);return r.get(l)!==o&&(e.update(l),r.set(l,o)),t.isInstancedMesh&&(!1===t.hasEventListener("dispose",s)&&t.addEventListener("dispose",s),i.update(t.instanceMatrix,34962),null!==t.instanceColor&&i.update(t.instanceColor,34962)),l},dispose:function(){r=new WeakMap}}}const zn=new Bt,kn=new Ut,jn=new Gt,Hn=new Ji,Vn=[],Wn=[],qn=new Float32Array(16),Jn=new Float32Array(9),Xn=new Float32Array(4);function Yn(t,e,i){const n=t[0];if(n<=0||n>0)return t;const r=e*i;let s=Vn[r];if(void 0===s&&(s=new Float32Array(r),Vn[r]=s),0!==e){n.toArray(s,0);for(let n=1,r=0;n!==e;++n)r+=i,t[n].toArray(s,r)}return s}function Zn(t,e){if(t.length!==e.length)return!1;for(let i=0,n=t.length;i<n;i++)if(t[i]!==e[i])return!1;return!0}function Kn(t,e){for(let i=0,n=e.length;i<n;i++)t[i]=e[i]}function Qn(t,e){let i=Wn[e];void 0===i&&(i=new Int32Array(e),Wn[e]=i);for(let n=0;n!==e;++n)i[n]=t.allocateTextureUnit();return i}function $n(t,e){const i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function tr(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(Zn(i,e))return;t.uniform2fv(this.addr,e),Kn(i,e)}}function er(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(void 0!==e.r)i[0]===e.r&&i[1]===e.g&&i[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(Zn(i,e))return;t.uniform3fv(this.addr,e),Kn(i,e)}}function ir(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(Zn(i,e))return;t.uniform4fv(this.addr,e),Kn(i,e)}}function nr(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(Zn(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),Kn(i,e)}else{if(Zn(i,n))return;Xn.set(n),t.uniformMatrix2fv(this.addr,!1,Xn),Kn(i,n)}}function rr(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(Zn(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),Kn(i,e)}else{if(Zn(i,n))return;Jn.set(n),t.uniformMatrix3fv(this.addr,!1,Jn),Kn(i,n)}}function sr(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(Zn(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),Kn(i,e)}else{if(Zn(i,n))return;qn.set(n),t.uniformMatrix4fv(this.addr,!1,qn),Kn(i,n)}}function or(t,e){const i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function ar(t,e){const i=this.cache;Zn(i,e)||(t.uniform2iv(this.addr,e),Kn(i,e))}function lr(t,e){const i=this.cache;Zn(i,e)||(t.uniform3iv(this.addr,e),Kn(i,e))}function cr(t,e){const i=this.cache;Zn(i,e)||(t.uniform4iv(this.addr,e),Kn(i,e))}function hr(t,e){const i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function ur(t,e){const i=this.cache;Zn(i,e)||(t.uniform2uiv(this.addr,e),Kn(i,e))}function dr(t,e){const i=this.cache;Zn(i,e)||(t.uniform3uiv(this.addr,e),Kn(i,e))}function pr(t,e){const i=this.cache;Zn(i,e)||(t.uniform4uiv(this.addr,e),Kn(i,e))}function fr(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture2D(e||zn,r)}function mr(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(e||jn,r)}function gr(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTextureCube(e||Hn,r)}function vr(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(e||kn,r)}function yr(t,e){t.uniform1fv(this.addr,e)}function _r(t,e){const i=Yn(e,this.size,2);t.uniform2fv(this.addr,i)}function xr(t,e){const i=Yn(e,this.size,3);t.uniform3fv(this.addr,i)}function Mr(t,e){const i=Yn(e,this.size,4);t.uniform4fv(this.addr,i)}function br(t,e){const i=Yn(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function wr(t,e){const i=Yn(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function Sr(t,e){const i=Yn(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function Tr(t,e){t.uniform1iv(this.addr,e)}function Ar(t,e){t.uniform2iv(this.addr,e)}function Er(t,e){t.uniform3iv(this.addr,e)}function Cr(t,e){t.uniform4iv(this.addr,e)}function Or(t,e){t.uniform1uiv(this.addr,e)}function Pr(t,e){t.uniform2uiv(this.addr,e)}function Ir(t,e){t.uniform3uiv(this.addr,e)}function Dr(t,e){t.uniform4uiv(this.addr,e)}function Lr(t,e,i){const n=e.length,r=Qn(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.setTexture2D(e[t]||zn,r[t])}function Rr(t,e,i){const n=e.length,r=Qn(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.setTexture3D(e[t]||jn,r[t])}function Br(t,e,i){const n=e.length,r=Qn(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.setTextureCube(e[t]||Hn,r[t])}function Nr(t,e,i){const n=e.length,r=Qn(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.setTexture2DArray(e[t]||kn,r[t])}function Fr(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=function(t){switch(t){case 5126:return $n;case 35664:return tr;case 35665:return er;case 35666:return ir;case 35674:return nr;case 35675:return rr;case 35676:return sr;case 5124:case 35670:return or;case 35667:case 35671:return ar;case 35668:case 35672:return lr;case 35669:case 35673:return cr;case 5125:return hr;case 36294:return ur;case 36295:return dr;case 36296:return pr;case 35678:case 36198:case 36298:case 36306:case 35682:return fr;case 35679:case 36299:case 36307:return mr;case 35680:case 36300:case 36308:case 36293:return gr;case 36289:case 36303:case 36311:case 36292:return vr}}(e.type)}function Ur(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return yr;case 35664:return _r;case 35665:return xr;case 35666:return Mr;case 35674:return br;case 35675:return wr;case 35676:return Sr;case 5124:case 35670:return Tr;case 35667:case 35671:return Ar;case 35668:case 35672:return Er;case 35669:case 35673:return Cr;case 5125:return Or;case 36294:return Pr;case 36295:return Ir;case 36296:return Dr;case 35678:case 36198:case 36298:case 36306:case 35682:return Lr;case 35679:case 36299:case 36307:return Rr;case 35680:case 36300:case 36308:case 36293:return Br;case 36289:case 36303:case 36311:case 36292:return Nr}}(e.type)}function Gr(t){this.id=t,this.seq=[],this.map={}}Ur.prototype.updateCache=function(t){const e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),Kn(e,t)},Gr.prototype.setValue=function(t,e,i){const n=this.seq;for(let r=0,s=n.length;r!==s;++r){const s=n[r];s.setValue(t,e[s.id],i)}};const zr=/(\w+)(\])?(\[|\.)?/g;function kr(t,e){t.seq.push(e),t.map[e.id]=e}function jr(t,e,i){const n=t.name,r=n.length;for(zr.lastIndex=0;;){const s=zr.exec(n),o=zr.lastIndex;let a=s[1];const l="]"===s[2],c=s[3];if(l&&(a|=0),void 0===c||"["===c&&o+2===r){kr(i,void 0===c?new Fr(a,t,e):new Ur(a,t,e));break}{let t=i.map[a];void 0===t&&(t=new Gr(a),kr(i,t)),i=t}}}function Hr(t,e){this.seq=[],this.map={};const i=t.getProgramParameter(e,35718);for(let n=0;n<i;++n){const i=t.getActiveUniform(e,n);jr(i,t.getUniformLocation(e,i.name),this)}}function Vr(t,e,i){const n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),n}Hr.prototype.setValue=function(t,e,i,n){const r=this.map[e];void 0!==r&&r.setValue(t,i,n)},Hr.prototype.setOptional=function(t,e,i){const n=e[i];void 0!==n&&this.setValue(t,i,n)},Hr.upload=function(t,e,i,n){for(let r=0,s=e.length;r!==s;++r){const s=e[r],o=i[s.id];!1!==o.needsUpdate&&s.setValue(t,o.value,n)}},Hr.seqWithValue=function(t,e){const i=[];for(let n=0,r=t.length;n!==r;++n){const r=t[n];r.id in e&&i.push(r)}return i};let Wr=0;function qr(t,e,i){const n=t.getShaderParameter(e,35713),r=t.getShaderInfoLog(e).trim();return n&&""===r?"":i.toUpperCase()+"\n\n"+r+"\n\n"+function(t){const e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}(t.getShaderSource(e))}function Jr(t,e){const i=function(t){switch(t){case Q:return["Linear","( value )"];case $:return["sRGB","( value )"];default:return["Linear","( value )"]}}(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function Xr(t,e){let i;switch(e){case 1:default:i="Linear";break;case 2:i="Reinhard";break;case 3:i="OptimizedCineon";break;case 4:i="ACESFilmic";break;case 5:i="Custom"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function Yr(t){return""!==t}function Zr(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Kr(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Qr=/^[ \t]*#include +<([\w\d./]+)>/gm;function $r(t){return t.replace(Qr,ts)}function ts(t,e){const i=on[e];if(void 0===i)throw new Error("Can not resolve #include <"+e+">");return $r(i)}const es=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,is=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function ns(t){return t.replace(is,ss).replace(es,rs)}function rs(t,e,i,n){return ss(t,e,i,n)}function ss(t,e,i,n){let r="";for(let t=parseInt(e);t<parseInt(i);t++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return r}function os(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function as(t,e,i,n){const r=t.getContext(),s=i.defines;let o=i.vertexShader,c=i.fragmentShader;const h=function(t){let e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(i),p=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case a:case l:e="ENVMAP_TYPE_CUBE";break;case u:case d:e="ENVMAP_TYPE_CUBE_UV"}return e}(i),f=function(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case l:case d:e="ENVMAP_MODE_REFRACTION"}return e}(i),m=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(i),g=function(t){const e=t.envMapCubeUVHeight;if(null===e)return null;const i=Math.log2(e/32+1)+3,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:n,maxMip:i}}(i),v=i.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Yr).join("\n")}(i),y=function(t){const e=[];for(const i in t){const n=t[i];!1!==n&&e.push("#define "+i+" "+n)}return e.join("\n")}(s),_=r.createProgram();let x,M,b=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(x=[y].filter(Yr).join("\n"),x.length>0&&(x+="\n"),M=[v,y].filter(Yr).join("\n"),M.length>0&&(M+="\n")):(x=[os(i),"#define SHADER_NAME "+i.shaderName,y,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+f:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+h:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Yr).join("\n"),M=[v,os(i),"#define SHADER_NAME "+i.shaderName,y,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+p:"",i.envMap?"#define "+f:"",i.envMap?"#define "+m:"",g?"#define CUBEUV_TEXEL_WIDTH "+g.texelWidth:"",g?"#define CUBEUV_TEXEL_HEIGHT "+g.texelHeight:"",g?"#define CUBEUV_MAX_MIP "+g.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+h:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==i.toneMapping?"#define TONE_MAPPING":"",0!==i.toneMapping?on.tonemapping_pars_fragment:"",0!==i.toneMapping?Xr("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",on.encodings_pars_fragment,Jr("linearToOutputTexel",i.outputEncoding),i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(Yr).join("\n")),o=$r(o),o=Zr(o,i),o=Kr(o,i),c=$r(c),c=Zr(c,i),c=Kr(c,i),o=ns(o),c=ns(c),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(b="#version 300 es\n",x=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+x,M=["#define varying in",i.glslVersion===rt?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===rt?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+M);const w=b+M+c,S=Vr(r,35633,b+x+o),T=Vr(r,35632,w);if(r.attachShader(_,S),r.attachShader(_,T),void 0!==i.index0AttributeName?r.bindAttribLocation(_,0,i.index0AttributeName):!0===i.morphTargets&&r.bindAttribLocation(_,0,"position"),r.linkProgram(_),t.debug.checkShaderErrors){const t=r.getProgramInfoLog(_).trim(),e=r.getShaderInfoLog(S).trim(),i=r.getShaderInfoLog(T).trim();let n=!0,s=!0;if(!1===r.getProgramParameter(_,35714)){n=!1;const e=qr(r,S,"vertex"),i=qr(r,T,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(_,35715)+"\n\nProgram Info Log: "+t+"\n"+e+"\n"+i)}else""!==t||""!==e&&""!==i||(s=!1);s&&(this.diagnostics={runnable:n,programLog:t,vertexShader:{log:e,prefix:x},fragmentShader:{log:i,prefix:M}})}let A,E;return r.deleteShader(S),r.deleteShader(T),this.getUniforms=function(){return void 0===A&&(A=new Hr(r,_)),A},this.getAttributes=function(){return void 0===E&&(E=function(t,e){const i={},n=t.getProgramParameter(e,35721);for(let r=0;r<n;r++){const n=t.getActiveAttrib(e,r),s=n.name;let o=1;35674===n.type&&(o=2),35675===n.type&&(o=3),35676===n.type&&(o=4),i[s]={type:n.type,location:t.getAttribLocation(e,s),locationSize:o}}return i}(r,_)),E},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(_),this.program=void 0},this.name=i.shaderName,this.id=Wr++,this.cacheKey=e,this.usedTimes=1,this.program=_,this.vertexShader=S,this.fragmentShader=T,this}let ls=0;class cs{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,i=t.fragmentShader,n=this._getShaderStage(e),r=this._getShaderStage(i),s=this._getShaderCacheForMaterial(t);return!1===s.has(n)&&(s.add(n),n.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const t of e)t.usedTimes--,0===t.usedTimes&&this.shaderCache.delete(t);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;return!1===e.has(t)&&e.set(t,new Set),e.get(t)}_getShaderStage(t){const e=this.shaderCache;if(!1===e.has(t)){const i=new hs;e.set(t,i)}return e.get(t)}}class hs{constructor(){this.id=ls++,this.usedTimes=0}}function us(t,e,i,n,r,o,a){const l=new Oe,c=new cs,h=[],p=r.isWebGL2,f=r.logarithmicDepthBuffer,m=r.floatVertexTextures,g=r.maxVertexUniforms,v=r.vertexTextures;let y=r.precision;const _={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(o,l,h,x,M){const b=x.fog,w=M.geometry,S=o.isMeshStandardMaterial?x.environment:null,T=(o.isMeshStandardMaterial?i:e).get(o.envMap||S),A=!T||T.mapping!==u&&T.mapping!==d?null:T.image.height,E=_[o.type],C=M.isSkinnedMesh?function(t){const e=t.skeleton.bones;if(m)return 1024;{const t=g,i=Math.floor((t-20)/4),n=Math.min(i,e.length);return n<e.length?(e.length,0):n}}(M):0;null!==o.precision&&(y=r.getMaxPrecision(o.precision),y!==o.precision&&o.precision);const O=w.morphAttributes.position||w.morphAttributes.normal||w.morphAttributes.color,P=void 0!==O?O.length:0;let I,D,L,R,B=0;if(void 0!==w.morphAttributes.position&&(B=1),void 0!==w.morphAttributes.normal&&(B=2),void 0!==w.morphAttributes.color&&(B=3),E){const t=ln[E];I=t.vertexShader,D=t.fragmentShader}else I=o.vertexShader,D=o.fragmentShader,c.update(o),L=c.getVertexShaderID(o),R=c.getFragmentShaderID(o);const N=t.getRenderTarget(),F=o.alphaTest>0,U=o.clearcoat>0;return{isWebGL2:p,shaderID:E,shaderName:o.type,vertexShader:I,fragmentShader:D,defines:o.defines,customVertexShaderID:L,customFragmentShaderID:R,isRawShaderMaterial:!0===o.isRawShaderMaterial,glslVersion:o.glslVersion,precision:y,instancing:!0===M.isInstancedMesh,instancingColor:!0===M.isInstancedMesh&&null!==M.instanceColor,supportsVertexTextures:v,outputEncoding:null===N?t.outputEncoding:!0===N.isXRRenderTarget?N.texture.encoding:Q,map:!!o.map,matcap:!!o.matcap,envMap:!!T,envMapMode:T&&T.mapping,envMapCubeUVHeight:A,lightMap:!!o.lightMap,aoMap:!!o.aoMap,emissiveMap:!!o.emissiveMap,bumpMap:!!o.bumpMap,normalMap:!!o.normalMap,objectSpaceNormalMap:1===o.normalMapType,tangentSpaceNormalMap:o.normalMapType===tt,decodeVideoTexture:!!o.map&&!0===o.map.isVideoTexture&&o.map.encoding===$,clearcoat:U,clearcoatMap:U&&!!o.clearcoatMap,clearcoatRoughnessMap:U&&!!o.clearcoatRoughnessMap,clearcoatNormalMap:U&&!!o.clearcoatNormalMap,displacementMap:!!o.displacementMap,roughnessMap:!!o.roughnessMap,metalnessMap:!!o.metalnessMap,specularMap:!!o.specularMap,specularIntensityMap:!!o.specularIntensityMap,specularColorMap:!!o.specularColorMap,opaque:!1===o.transparent&&1===o.blending,alphaMap:!!o.alphaMap,alphaTest:F,gradientMap:!!o.gradientMap,sheen:o.sheen>0,sheenColorMap:!!o.sheenColorMap,sheenRoughnessMap:!!o.sheenRoughnessMap,transmission:o.transmission>0,transmissionMap:!!o.transmissionMap,thicknessMap:!!o.thicknessMap,combine:o.combine,vertexTangents:!!o.normalMap&&!!w.attributes.tangent,vertexColors:o.vertexColors,vertexAlphas:!0===o.vertexColors&&!!w.attributes.color&&4===w.attributes.color.itemSize,vertexUvs:!!(o.map||o.bumpMap||o.normalMap||o.specularMap||o.alphaMap||o.emissiveMap||o.roughnessMap||o.metalnessMap||o.clearcoatMap||o.clearcoatRoughnessMap||o.clearcoatNormalMap||o.displacementMap||o.transmissionMap||o.thicknessMap||o.specularIntensityMap||o.specularColorMap||o.sheenColorMap||o.sheenRoughnessMap),uvsVertexOnly:!(o.map||o.bumpMap||o.normalMap||o.specularMap||o.alphaMap||o.emissiveMap||o.roughnessMap||o.metalnessMap||o.clearcoatNormalMap||o.transmission>0||o.transmissionMap||o.thicknessMap||o.specularIntensityMap||o.specularColorMap||o.sheen>0||o.sheenColorMap||o.sheenRoughnessMap||!o.displacementMap),fog:!!b,useFog:o.fog,fogExp2:b&&b.isFogExp2,flatShading:!!o.flatShading,sizeAttenuation:o.sizeAttenuation,logarithmicDepthBuffer:f,skinning:!0===M.isSkinnedMesh&&C>0,maxBones:C,useVertexTexture:m,morphTargets:void 0!==w.morphAttributes.position,morphNormals:void 0!==w.morphAttributes.normal,morphColors:void 0!==w.morphAttributes.color,morphTargetsCount:P,morphTextureStride:B,numDirLights:l.directional.length,numPointLights:l.point.length,numSpotLights:l.spot.length,numRectAreaLights:l.rectArea.length,numHemiLights:l.hemi.length,numDirLightShadows:l.directionalShadowMap.length,numPointLightShadows:l.pointShadowMap.length,numSpotLightShadows:l.spotShadowMap.length,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:o.dithering,shadowMapEnabled:t.shadowMap.enabled&&h.length>0,shadowMapType:t.shadowMap.type,toneMapping:o.toneMapped?t.toneMapping:0,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:o.premultipliedAlpha,doubleSided:o.side===s,flipSided:1===o.side,depthPacking:void 0!==o.depthPacking&&o.depthPacking,index0AttributeName:o.index0AttributeName,extensionDerivatives:o.extensions&&o.extensions.derivatives,extensionFragDepth:o.extensions&&o.extensions.fragDepth,extensionDrawBuffers:o.extensions&&o.extensions.drawBuffers,extensionShaderTextureLOD:o.extensions&&o.extensions.shaderTextureLOD,rendererExtensionFragDepth:p||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:p||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:p||n.has("EXT_shader_texture_lod"),customProgramCacheKey:o.customProgramCacheKey()}},getProgramCacheKey:function(e){const i=[];if(e.shaderID?i.push(e.shaderID):(i.push(e.customVertexShaderID),i.push(e.customFragmentShaderID)),void 0!==e.defines)for(const t in e.defines)i.push(t),i.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(!function(t,e){t.push(e.precision),t.push(e.outputEncoding),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.combine),t.push(e.vertexUvs),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.maxBones),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection)}(i,e),function(t,e){l.disableAll(),e.isWebGL2&&l.enable(0);e.supportsVertexTextures&&l.enable(1);e.instancing&&l.enable(2);e.instancingColor&&l.enable(3);e.map&&l.enable(4);e.matcap&&l.enable(5);e.envMap&&l.enable(6);e.lightMap&&l.enable(7);e.aoMap&&l.enable(8);e.emissiveMap&&l.enable(9);e.bumpMap&&l.enable(10);e.normalMap&&l.enable(11);e.objectSpaceNormalMap&&l.enable(12);e.tangentSpaceNormalMap&&l.enable(13);e.clearcoat&&l.enable(14);e.clearcoatMap&&l.enable(15);e.clearcoatRoughnessMap&&l.enable(16);e.clearcoatNormalMap&&l.enable(17);e.displacementMap&&l.enable(18);e.specularMap&&l.enable(19);e.roughnessMap&&l.enable(20);e.metalnessMap&&l.enable(21);e.gradientMap&&l.enable(22);e.alphaMap&&l.enable(23);e.alphaTest&&l.enable(24);e.vertexColors&&l.enable(25);e.vertexAlphas&&l.enable(26);e.vertexUvs&&l.enable(27);e.vertexTangents&&l.enable(28);e.uvsVertexOnly&&l.enable(29);e.fog&&l.enable(30);t.push(l.mask),l.disableAll(),e.useFog&&l.enable(0);e.flatShading&&l.enable(1);e.logarithmicDepthBuffer&&l.enable(2);e.skinning&&l.enable(3);e.useVertexTexture&&l.enable(4);e.morphTargets&&l.enable(5);e.morphNormals&&l.enable(6);e.morphColors&&l.enable(7);e.premultipliedAlpha&&l.enable(8);e.shadowMapEnabled&&l.enable(9);e.physicallyCorrectLights&&l.enable(10);e.doubleSided&&l.enable(11);e.flipSided&&l.enable(12);e.depthPacking&&l.enable(13);e.dithering&&l.enable(14);e.specularIntensityMap&&l.enable(15);e.specularColorMap&&l.enable(16);e.transmission&&l.enable(17);e.transmissionMap&&l.enable(18);e.thicknessMap&&l.enable(19);e.sheen&&l.enable(20);e.sheenColorMap&&l.enable(21);e.sheenRoughnessMap&&l.enable(22);e.decodeVideoTexture&&l.enable(23);e.opaque&&l.enable(24);t.push(l.mask)}(i,e),i.push(t.outputEncoding)),i.push(e.customProgramCacheKey),i.join()},getUniforms:function(t){const e=_[t.type];let i;if(e){const t=ln[e];i=ki.clone(t.uniforms)}else i=t.uniforms;return i},acquireProgram:function(e,i){let n;for(let t=0,e=h.length;t<e;t++){const e=h[t];if(e.cacheKey===i){n=e,++n.usedTimes;break}}return void 0===n&&(n=new as(t,i,e,o),h.push(n)),n},releaseProgram:function(t){if(0==--t.usedTimes){const e=h.indexOf(t);h[e]=h[h.length-1],h.pop(),t.destroy()}},releaseShaderCache:function(t){c.remove(t)},programs:h,dispose:function(){c.dispose()}}}function ds(){let t=new WeakMap;return{get:function(e){let i=t.get(e);return void 0===i&&(i={},t.set(e,i)),i},remove:function(e){t.delete(e)},update:function(e,i,n){t.get(e)[i]=n},dispose:function(){t=new WeakMap}}}function ps(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function fs(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function ms(){const t=[];let e=0;const i=[],n=[],r=[];function s(i,n,r,s,o,a){let l=t[e];return void 0===l?(l={id:i.id,object:i,geometry:n,material:r,groupOrder:s,renderOrder:i.renderOrder,z:o,group:a},t[e]=l):(l.id=i.id,l.object=i,l.geometry=n,l.material=r,l.groupOrder=s,l.renderOrder=i.renderOrder,l.z=o,l.group=a),e++,l}return{opaque:i,transmissive:n,transparent:r,init:function(){e=0,i.length=0,n.length=0,r.length=0},push:function(t,e,o,a,l,c){const h=s(t,e,o,a,l,c);o.transmission>0?n.push(h):!0===o.transparent?r.push(h):i.push(h)},unshift:function(t,e,o,a,l,c){const h=s(t,e,o,a,l,c);o.transmission>0?n.unshift(h):!0===o.transparent?r.unshift(h):i.unshift(h)},finish:function(){for(let i=e,n=t.length;i<n;i++){const e=t[i];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(t,e){i.length>1&&i.sort(t||ps),n.length>1&&n.sort(e||fs),r.length>1&&r.sort(e||fs)}}}function gs(){let t=new WeakMap;return{get:function(e,i){let n;return!1===t.has(e)?(n=new ms,t.set(e,[n])):i>=t.get(e).length?(n=new ms,t.get(e).push(n)):n=t.get(e)[i],n},dispose:function(){t=new WeakMap}}}function vs(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new kt,color:new Ot};break;case"SpotLight":i={position:new kt,direction:new kt,color:new Ot,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new kt,color:new Ot,distance:0,decay:0};break;case"HemisphereLight":i={direction:new kt,skyColor:new Ot,groundColor:new Ot};break;case"RectAreaLight":i={color:new Ot,position:new kt,halfWidth:new kt,halfHeight:new kt}}return t[e.id]=i,i}}}let ys=0;function _s(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function xs(t,e){const i=new vs,n=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new _t};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new _t,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=i,i}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let t=0;t<9;t++)r.probe.push(new kt);const s=new kt,o=new ye,a=new ye;return{setup:function(s,o){let a=0,l=0,c=0;for(let t=0;t<9;t++)r.probe[t].set(0,0,0);let h=0,u=0,d=0,p=0,f=0,m=0,g=0,v=0;s.sort(_s);const y=!0!==o?Math.PI:1;for(let t=0,e=s.length;t<e;t++){const e=s[t],o=e.color,_=e.intensity,x=e.distance,M=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)a+=o.r*_*y,l+=o.g*_*y,c+=o.b*_*y;else if(e.isLightProbe)for(let t=0;t<9;t++)r.probe[t].addScaledVector(e.sh.coefficients[t],_);else if(e.isDirectionalLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*y),e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,r.directionalShadow[h]=i,r.directionalShadowMap[h]=M,r.directionalShadowMatrix[h]=e.shadow.matrix,m++}r.directional[h]=t,h++}else if(e.isSpotLight){const t=i.get(e);if(t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(o).multiplyScalar(_*y),t.distance=x,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,r.spotShadow[d]=i,r.spotShadowMap[d]=M,r.spotShadowMatrix[d]=e.shadow.matrix,v++}r.spot[d]=t,d++}else if(e.isRectAreaLight){const t=i.get(e);t.color.copy(o).multiplyScalar(_),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),r.rectArea[p]=t,p++}else if(e.isPointLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*y),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,i.shadowCameraNear=t.camera.near,i.shadowCameraFar=t.camera.far,r.pointShadow[u]=i,r.pointShadowMap[u]=M,r.pointShadowMatrix[u]=e.shadow.matrix,g++}r.point[u]=t,u++}else if(e.isHemisphereLight){const t=i.get(e);t.skyColor.copy(e.color).multiplyScalar(_*y),t.groundColor.copy(e.groundColor).multiplyScalar(_*y),r.hemi[f]=t,f++}}p>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(r.rectAreaLTC1=an.LTC_FLOAT_1,r.rectAreaLTC2=an.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=an.LTC_HALF_1,r.rectAreaLTC2=an.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=a,r.ambient[1]=l,r.ambient[2]=c;const _=r.hash;_.directionalLength===h&&_.pointLength===u&&_.spotLength===d&&_.rectAreaLength===p&&_.hemiLength===f&&_.numDirectionalShadows===m&&_.numPointShadows===g&&_.numSpotShadows===v||(r.directional.length=h,r.spot.length=d,r.rectArea.length=p,r.point.length=u,r.hemi.length=f,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=v,r.spotShadowMap.length=v,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=g,r.spotShadowMatrix.length=v,_.directionalLength=h,_.pointLength=u,_.spotLength=d,_.rectAreaLength=p,_.hemiLength=f,_.numDirectionalShadows=m,_.numPointShadows=g,_.numSpotShadows=v,r.version=ys++)},setupView:function(t,e){let i=0,n=0,l=0,c=0,h=0;const u=e.matrixWorldInverse;for(let e=0,d=t.length;e<d;e++){const d=t[e];if(d.isDirectionalLight){const t=r.directional[i];t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(u),i++}else if(d.isSpotLight){const t=r.spot[l];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(u),l++}else if(d.isRectAreaLight){const t=r.rectArea[c];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),a.identity(),o.copy(d.matrixWorld),o.premultiply(u),a.extractRotation(o),t.halfWidth.set(.5*d.width,0,0),t.halfHeight.set(0,.5*d.height,0),t.halfWidth.applyMatrix4(a),t.halfHeight.applyMatrix4(a),c++}else if(d.isPointLight){const t=r.point[n];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),n++}else if(d.isHemisphereLight){const t=r.hemi[h];t.direction.setFromMatrixPosition(d.matrixWorld),t.direction.transformDirection(u),t.direction.normalize(),h++}}},state:r}}function Ms(t,e){const i=new xs(t,e),n=[],r=[];return{init:function(){n.length=0,r.length=0},state:{lightsArray:n,shadowsArray:r,lights:i},setupLights:function(t){i.setup(n,t)},setupLightsView:function(t){i.setupView(n,t)},pushLight:function(t){n.push(t)},pushShadow:function(t){r.push(t)}}}function bs(t,e){let i=new WeakMap;return{get:function(n,r=0){let s;return!1===i.has(n)?(s=new Ms(t,e),i.set(n,[s])):r>=i.get(n).length?(s=new Ms(t,e),i.get(n).push(s)):s=i.get(n)[r],s},dispose:function(){i=new WeakMap}}}class ws extends ii{constructor(t){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}ws.prototype.isMeshDepthMaterial=!0;class Ss extends ii{constructor(t){super(),this.type="MeshDistanceMaterial",this.referencePosition=new kt,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}Ss.prototype.isMeshDistanceMaterial=!0;function Ts(t,e,i){let n=new en;const o=new _t,a=new _t,l=new Nt,c=new ws({depthPacking:3201}),h=new Ss,u={},d=i.maxTextureSize,p={0:1,1:r,2:s},f=new ji({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new _t},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),m=f.clone();m.defines.HORIZONTAL_PASS=1;const v=new yi;v.setAttribute("position",new oi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const y=new Ni(v,f),x=this;function M(i,n){const r=e.update(y);f.defines.VSM_SAMPLES!==i.blurSamples&&(f.defines.VSM_SAMPLES=i.blurSamples,m.defines.VSM_SAMPLES=i.blurSamples,f.needsUpdate=!0,m.needsUpdate=!0),f.uniforms.shadow_pass.value=i.map.texture,f.uniforms.resolution.value=i.mapSize,f.uniforms.radius.value=i.radius,t.setRenderTarget(i.mapPass),t.clear(),t.renderBufferDirect(n,null,r,f,y,null),m.uniforms.shadow_pass.value=i.mapPass.texture,m.uniforms.resolution.value=i.mapSize,m.uniforms.radius.value=i.radius,t.setRenderTarget(i.map),t.clear(),t.renderBufferDirect(n,null,r,m,y,null)}function b(e,i,n,r,s,o){let a=null;const l=!0===n.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(a=void 0!==l?l:!0===n.isPointLight?h:c,t.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&i.alphaTest>0){const t=a.uuid,e=i.uuid;let n=u[t];void 0===n&&(n={},u[t]=n);let r=n[e];void 0===r&&(r=a.clone(),n[e]=r),a=r}return a.visible=i.visible,a.wireframe=i.wireframe,a.side=3===o?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:p[i.side],a.alphaMap=i.alphaMap,a.alphaTest=i.alphaTest,a.clipShadows=i.clipShadows,a.clippingPlanes=i.clippingPlanes,a.clipIntersection=i.clipIntersection,a.displacementMap=i.displacementMap,a.displacementScale=i.displacementScale,a.displacementBias=i.displacementBias,a.wireframeLinewidth=i.wireframeLinewidth,a.linewidth=i.linewidth,!0===n.isPointLight&&!0===a.isMeshDistanceMaterial&&(a.referencePosition.setFromMatrixPosition(n.matrixWorld),a.nearDistance=r,a.farDistance=s),a}function w(i,r,s,o,a){if(!1===i.visible)return;if(i.layers.test(r.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&3===a)&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,i.matrixWorld);const n=e.update(i),r=i.material;if(Array.isArray(r)){const e=n.groups;for(let l=0,c=e.length;l<c;l++){const c=e[l],h=r[c.materialIndex];if(h&&h.visible){const e=b(i,h,o,s.near,s.far,a);t.renderBufferDirect(s,null,n,e,i,c)}}}else if(r.visible){const e=b(i,r,o,s.near,s.far,a);t.renderBufferDirect(s,null,n,e,i,null)}}const l=i.children;for(let t=0,e=l.length;t<e;t++)w(l[t],r,s,o,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(e,i,r){if(!1===x.enabled)return;if(!1===x.autoUpdate&&!1===x.needsUpdate)return;if(0===e.length)return;const s=t.getRenderTarget(),c=t.getActiveCubeFace(),h=t.getActiveMipmapLevel(),u=t.state;u.setBlending(0),u.buffers.color.setClear(1,1,1,1),u.buffers.depth.setTest(!0),u.setScissorTest(!1);for(let s=0,c=e.length;s<c;s++){const c=e[s],h=c.shadow;if(void 0===h)continue;if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;o.copy(h.mapSize);const p=h.getFrameExtents();if(o.multiply(p),a.copy(h.mapSize),(o.x>d||o.y>d)&&(o.x>d&&(a.x=Math.floor(d/p.x),o.x=a.x*p.x,h.mapSize.x=a.x),o.y>d&&(a.y=Math.floor(d/p.y),o.y=a.y*p.y,h.mapSize.y=a.y)),null===h.map&&!h.isPointLightShadow&&3===this.type){const t={minFilter:_,magFilter:_,format:C};h.map=new Ft(o.x,o.y,t),h.map.texture.name=c.name+".shadowMap",h.mapPass=new Ft(o.x,o.y,t),h.camera.updateProjectionMatrix()}if(null===h.map){const t={minFilter:g,magFilter:g,format:C};h.map=new Ft(o.x,o.y,t),h.map.texture.name=c.name+".shadowMap",h.camera.updateProjectionMatrix()}t.setRenderTarget(h.map),t.clear();const f=h.getViewportCount();for(let t=0;t<f;t++){const e=h.getViewport(t);l.set(a.x*e.x,a.y*e.y,a.x*e.z,a.y*e.w),u.viewport(l),h.updateMatrices(c,t),n=h.getFrustum(),w(i,r,h.camera,c,this.type)}h.isPointLightShadow||3!==this.type||M(h,r),h.needsUpdate=!1}x.needsUpdate=!1,t.setRenderTarget(s,c,h)}}function As(t,e,i){const n=i.isWebGL2;const r=new function(){let e=!1;const i=new Nt;let n=null;const r=new Nt(0,0,0,0);return{setMask:function(i){n===i||e||(t.colorMask(i,i,i,i),n=i)},setLocked:function(t){e=t},setClear:function(e,n,s,o,a){!0===a&&(e*=o,n*=o,s*=o),i.set(e,n,s,o),!1===r.equals(i)&&(t.clearColor(e,n,s,o),r.copy(i))},reset:function(){e=!1,n=null,r.set(-1,0,0,0)}}},a=new function(){let e=!1,i=null,n=null,r=null;return{setTest:function(t){t?z(2929):k(2929)},setMask:function(n){i===n||e||(t.depthMask(n),i=n)},setFunc:function(e){if(n!==e){if(e)switch(e){case 0:t.depthFunc(512);break;case 1:t.depthFunc(519);break;case 2:t.depthFunc(513);break;case 3:default:t.depthFunc(515);break;case 4:t.depthFunc(514);break;case 5:t.depthFunc(518);break;case 6:t.depthFunc(516);break;case 7:t.depthFunc(517)}else t.depthFunc(515);n=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,i=null,n=null,r=null}}},l=new function(){let e=!1,i=null,n=null,r=null,s=null,o=null,a=null,l=null,c=null;return{setTest:function(t){e||(t?z(2960):k(2960))},setMask:function(n){i===n||e||(t.stencilMask(n),i=n)},setFunc:function(e,i,o){n===e&&r===i&&s===o||(t.stencilFunc(e,i,o),n=e,r=i,s=o)},setOp:function(e,i,n){o===e&&a===i&&l===n||(t.stencilOp(e,i,n),o=e,a=i,l=n)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,i=null,n=null,r=null,s=null,o=null,a=null,l=null,c=null}}};let c={},h={},u=new WeakMap,d=[],p=null,f=!1,m=null,g=null,v=null,y=null,_=null,x=null,M=null,b=!1,w=null,S=null,T=null,A=null,E=null;const C=t.getParameter(35661);let O=!1,P=0;const I=t.getParameter(7938);-1!==I.indexOf("WebGL")?(P=parseFloat(/^WebGL (\d)/.exec(I)[1]),O=P>=1):-1!==I.indexOf("OpenGL ES")&&(P=parseFloat(/^OpenGL ES (\d)/.exec(I)[1]),O=P>=2);let D=null,L={};const R=t.getParameter(3088),B=t.getParameter(2978),N=(new Nt).fromArray(R),F=(new Nt).fromArray(B);function U(e,i,n){const r=new Uint8Array(4),s=t.createTexture();t.bindTexture(e,s),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let e=0;e<n;e++)t.texImage2D(i+e,0,6408,1,1,0,6408,5121,r);return s}const G={};function z(e){!0!==c[e]&&(t.enable(e),c[e]=!0)}function k(e){!1!==c[e]&&(t.disable(e),c[e]=!1)}G[3553]=U(3553,3553,1),G[34067]=U(34067,34069,6),r.setClear(0,0,0,1),a.setClear(1),l.setClear(0),z(2929),a.setFunc(3),W(!1),q(1),z(2884),V(0);const j={[o]:32774,101:32778,102:32779};if(n)j[103]=32775,j[104]=32776;else{const t=e.get("EXT_blend_minmax");null!==t&&(j[103]=t.MIN_EXT,j[104]=t.MAX_EXT)}const H={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function V(e,i,n,r,s,a,l,c){if(0!==e){if(!1===f&&(z(3042),f=!0),5===e)s=s||i,a=a||n,l=l||r,i===g&&s===_||(t.blendEquationSeparate(j[i],j[s]),g=i,_=s),n===v&&r===y&&a===x&&l===M||(t.blendFuncSeparate(H[n],H[r],H[a],H[l]),v=n,y=r,x=a,M=l),m=e,b=null;else if(e!==m||c!==b){if(g===o&&_===o||(t.blendEquation(32774),g=o,_=o),c)switch(e){case 1:t.blendFuncSeparate(1,771,1,771);break;case 2:t.blendFunc(1,1);break;case 3:t.blendFuncSeparate(0,769,0,1);break;case 4:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(770,771,1,771);break;case 2:t.blendFunc(770,1);break;case 3:t.blendFuncSeparate(0,769,0,1);break;case 4:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}v=null,y=null,x=null,M=null,m=e,b=c}}else!0===f&&(k(3042),f=!1)}function W(e){w!==e&&(e?t.frontFace(2304):t.frontFace(2305),w=e)}function q(e){0!==e?(z(2884),e!==S&&(1===e?t.cullFace(1029):2===e?t.cullFace(1028):t.cullFace(1032))):k(2884),S=e}function J(e,i,n){e?(z(32823),A===i&&E===n||(t.polygonOffset(i,n),A=i,E=n)):k(32823)}function X(e){void 0===e&&(e=33984+C-1),D!==e&&(t.activeTexture(e),D=e)}return{buffers:{color:r,depth:a,stencil:l},enable:z,disable:k,bindFramebuffer:function(e,i){return h[e]!==i&&(t.bindFramebuffer(e,i),h[e]=i,n&&(36009===e&&(h[36160]=i),36160===e&&(h[36009]=i)),!0)},drawBuffers:function(n,r){let s=d,o=!1;if(n)if(s=u.get(r),void 0===s&&(s=[],u.set(r,s)),n.isWebGLMultipleRenderTargets){const t=n.texture;if(s.length!==t.length||36064!==s[0]){for(let e=0,i=t.length;e<i;e++)s[e]=36064+e;s.length=t.length,o=!0}}else 36064!==s[0]&&(s[0]=36064,o=!0);else 1029!==s[0]&&(s[0]=1029,o=!0);o&&(i.isWebGL2?t.drawBuffers(s):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(s))},useProgram:function(e){return p!==e&&(t.useProgram(e),p=e,!0)},setBlending:V,setMaterial:function(t,e){t.side===s?k(2884):z(2884);let i=1===t.side;e&&(i=!i),W(i),1===t.blending&&!1===t.transparent?V(0):V(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),a.setFunc(t.depthFunc),a.setTest(t.depthTest),a.setMask(t.depthWrite),r.setMask(t.colorWrite);const n=t.stencilWrite;l.setTest(n),n&&(l.setMask(t.stencilWriteMask),l.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),l.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),J(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?z(32926):k(32926)},setFlipSided:W,setCullFace:q,setLineWidth:function(e){e!==T&&(O&&t.lineWidth(e),T=e)},setPolygonOffset:J,setScissorTest:function(t){t?z(3089):k(3089)},activeTexture:X,bindTexture:function(e,i){null===D&&X();let n=L[D];void 0===n&&(n={type:void 0,texture:void 0},L[D]=n),n.type===e&&n.texture===i||(t.bindTexture(e,i||G[e]),n.type=e,n.texture=i)},unbindTexture:function(){const e=L[D];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage2D:function(){try{t.texStorage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{t.texStorage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{t.texSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{t.texSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===N.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),N.copy(e))},viewport:function(e){!1===F.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),F.copy(e))},reset:function(){t.disable(3042),t.disable(2884),t.disable(2929),t.disable(32823),t.disable(3089),t.disable(2960),t.disable(32926),t.blendEquation(32774),t.blendFunc(1,0),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(513),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(519,0,4294967295),t.stencilOp(7680,7680,7680),t.clearStencil(0),t.cullFace(1029),t.frontFace(2305),t.polygonOffset(0,0),t.activeTexture(33984),t.bindFramebuffer(36160,null),!0===n&&(t.bindFramebuffer(36009,null),t.bindFramebuffer(36008,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),c={},D=null,L={},h={},u=new WeakMap,d=[],p=null,f=!1,m=null,g=null,v=null,y=null,_=null,x=null,M=null,b=!1,w=null,S=null,T=null,A=null,E=null,N.set(0,0,t.canvas.width,t.canvas.height),F.set(0,0,t.canvas.width,t.canvas.height),r.reset(),a.reset(),l.reset()}}}function Es(t,e,i,n,r,s,o){const a=r.isWebGL2,l=(r.maxTextures,r.maxCubemapSize),c=r.maxTextureSize,h=r.maxSamples,u=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,d=new WeakMap;let b;const I=new WeakMap;let D=!1;try{D="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function L(t,e){return D?new OffscreenCanvas(t,e):bt("canvas")}function R(t,e,i,n){let r=1;if((t.width>n||t.height>n)&&(r=n/Math.max(t.width,t.height)),r<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const n=e?vt:Math.floor,s=n(r*t.width),o=n(r*t.height);void 0===b&&(b=L(s,o));const a=i?L(s,o):b;a.width=s,a.height=o;return a.getContext("2d").drawImage(t,0,0,s,o),t.width,t.height,a}return"data"in t&&(t.width,t.height),t}return t}function B(t){return mt(t.width)&&mt(t.height)}function N(t,e){return t.generateMipmaps&&e&&t.minFilter!==g&&t.minFilter!==_}function F(e){t.generateMipmap(e)}function U(i,n,r,s,o=!1){if(!1===a)return n;if(null!==i&&void 0!==t[i])return t[i];let l=n;return 6403===n&&(5126===r&&(l=33326),5131===r&&(l=33325),5121===r&&(l=33321)),33319===n&&(5126===r&&(l=33328),5131===r&&(l=33327),5121===r&&(l=33323)),6408===n&&(5126===r&&(l=34836),5131===r&&(l=34842),5121===r&&(l=s===$&&!1===o?35907:32856),32819===r&&(l=32854),32820===r&&(l=32855)),33325!==l&&33326!==l&&33327!==l&&33328!==l&&34842!==l&&34836!==l||e.get("EXT_color_buffer_float"),l}function G(t,e,i){return!0===N(t,i)||t.isFramebufferTexture&&t.minFilter!==g&&t.minFilter!==_?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function z(t){return t===g||t===v||t===y?9728:9729}function k(t){const e=t.target;e.removeEventListener("dispose",k),function(t){const e=n.get(t);if(void 0===e.__webglInit)return;const i=t.source,r=I.get(i);if(r){const n=r[e.__cacheKey];n.usedTimes--,0===n.usedTimes&&H(t),0===Object.keys(r).length&&I.delete(i)}n.remove(t)}(e),e.isVideoTexture&&d.delete(e)}function j(e){const i=e.target;i.removeEventListener("dispose",j),function(e){const i=e.texture,r=n.get(e),s=n.get(i);void 0!==s.__webglTexture&&(t.deleteTexture(s.__webglTexture),o.memory.textures--);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)t.deleteFramebuffer(r.__webglFramebuffer[e]),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer[e]);else t.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&t.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer&&t.deleteRenderbuffer(r.__webglColorRenderbuffer),r.__webglDepthRenderbuffer&&t.deleteRenderbuffer(r.__webglDepthRenderbuffer);if(e.isWebGLMultipleRenderTargets)for(let e=0,r=i.length;e<r;e++){const r=n.get(i[e]);r.__webglTexture&&(t.deleteTexture(r.__webglTexture),o.memory.textures--),n.remove(i[e])}n.remove(i),n.remove(e)}(i)}function H(e){const i=n.get(e);t.deleteTexture(i.__webglTexture);const r=e.source;delete I.get(r)[i.__cacheKey],o.memory.textures--}let V=0;function W(t,e){const r=n.get(t);if(t.isVideoTexture&&function(t){const e=o.render.frame;d.get(t)!==e&&(d.set(t,e),t.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&r.__version!==t.version){const i=t.image;if(null===i);else if(!1!==i.complete)return void Z(r,t,e)}i.activeTexture(33984+e),i.bindTexture(3553,r.__webglTexture)}const q={[p]:10497,[f]:33071,[m]:33648},J={[g]:9728,[v]:9984,[y]:9986,[_]:9729,[x]:9985,[M]:9987};function X(i,s,o){if(o?(t.texParameteri(i,10242,q[s.wrapS]),t.texParameteri(i,10243,q[s.wrapT]),32879!==i&&35866!==i||t.texParameteri(i,32882,q[s.wrapR]),t.texParameteri(i,10240,J[s.magFilter]),t.texParameteri(i,10241,J[s.minFilter])):(t.texParameteri(i,10242,33071),t.texParameteri(i,10243,33071),32879!==i&&35866!==i||t.texParameteri(i,32882,33071),s.wrapS!==f||s.wrapT,t.texParameteri(i,10240,z(s.magFilter)),t.texParameteri(i,10241,z(s.minFilter)),s.minFilter!==g&&s.minFilter),!0===e.has("EXT_texture_filter_anisotropic")){const o=e.get("EXT_texture_filter_anisotropic");if(s.type===T&&!1===e.has("OES_texture_float_linear"))return;if(!1===a&&s.type===A&&!1===e.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||n.get(s).__currentAnisotropy)&&(t.texParameterf(i,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),n.get(s).__currentAnisotropy=s.anisotropy)}}function Y(e,i){let n=!1;void 0===e.__webglInit&&(e.__webglInit=!0,i.addEventListener("dispose",k));const r=i.source;let s=I.get(r);void 0===s&&(s={},I.set(r,s));const a=function(t){const e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.encoding),e.join()}(i);if(a!==e.__cacheKey){void 0===s[a]&&(s[a]={texture:t.createTexture(),usedTimes:0},o.memory.textures++,n=!0),s[a].usedTimes++;const r=s[e.__cacheKey];void 0!==r&&(s[e.__cacheKey].usedTimes--,0===r.usedTimes&&H(i)),e.__cacheKey=a,e.__webglTexture=s[a].texture}return n}function Z(e,n,r){let o=3553;n.isDataArrayTexture&&(o=35866),n.isData3DTexture&&(o=32879);const l=Y(e,n),h=n.source;if(i.activeTexture(33984+r),i.bindTexture(o,e.__webglTexture),h.version!==h.__currentVersion||!0===l){t.pixelStorei(37440,n.flipY),t.pixelStorei(37441,n.premultiplyAlpha),t.pixelStorei(3317,n.unpackAlignment),t.pixelStorei(37443,0);const r=function(t){return!a&&(t.wrapS!==f||t.wrapT!==f||t.minFilter!==g&&t.minFilter!==_)}(n)&&!1===B(n.image);let l=R(n.image,r,!1,c);l=rt(n,l);const u=B(l)||a,d=s.convert(n.format,n.encoding);let p,m=s.convert(n.type),v=U(n.internalFormat,d,m,n.encoding,n.isVideoTexture);X(o,n,u);const y=n.mipmaps,x=a&&!0!==n.isVideoTexture,M=void 0===e.__version,b=G(n,l,u);if(n.isDepthTexture)v=6402,a?v=n.type===T?36012:n.type===S?33190:n.type===E?35056:33189:n.type===T&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),n.format===O&&6402===v&&n.type!==w&&n.type!==S&&(n.type=w,m=s.convert(n.type)),n.format===P&&6402===v&&(v=34041,n.type!==E&&(n.type=E,m=s.convert(n.type))),x&&M?i.texStorage2D(3553,1,v,l.width,l.height):i.texImage2D(3553,0,v,l.width,l.height,0,d,m,null);else if(n.isDataTexture)if(y.length>0&&u){x&&M&&i.texStorage2D(3553,b,v,y[0].width,y[0].height);for(let t=0,e=y.length;t<e;t++)p=y[t],x?i.texSubImage2D(3553,t,0,0,p.width,p.height,d,m,p.data):i.texImage2D(3553,t,v,p.width,p.height,0,d,m,p.data);n.generateMipmaps=!1}else x?(M&&i.texStorage2D(3553,b,v,l.width,l.height),i.texSubImage2D(3553,0,0,0,l.width,l.height,d,m,l.data)):i.texImage2D(3553,0,v,l.width,l.height,0,d,m,l.data);else if(n.isCompressedTexture){x&&M&&i.texStorage2D(3553,b,v,y[0].width,y[0].height);for(let t=0,e=y.length;t<e;t++)p=y[t],n.format!==C?null!==d&&(x?i.compressedTexSubImage2D(3553,t,0,0,p.width,p.height,d,p.data):i.compressedTexImage2D(3553,t,v,p.width,p.height,0,p.data)):x?i.texSubImage2D(3553,t,0,0,p.width,p.height,d,m,p.data):i.texImage2D(3553,t,v,p.width,p.height,0,d,m,p.data)}else if(n.isDataArrayTexture)x?(M&&i.texStorage3D(35866,b,v,l.width,l.height,l.depth),i.texSubImage3D(35866,0,0,0,0,l.width,l.height,l.depth,d,m,l.data)):i.texImage3D(35866,0,v,l.width,l.height,l.depth,0,d,m,l.data);else if(n.isData3DTexture)x?(M&&i.texStorage3D(32879,b,v,l.width,l.height,l.depth),i.texSubImage3D(32879,0,0,0,0,l.width,l.height,l.depth,d,m,l.data)):i.texImage3D(32879,0,v,l.width,l.height,l.depth,0,d,m,l.data);else if(n.isFramebufferTexture)x&&M?i.texStorage2D(3553,b,v,l.width,l.height):i.texImage2D(3553,0,v,l.width,l.height,0,d,m,null);else if(y.length>0&&u){x&&M&&i.texStorage2D(3553,b,v,y[0].width,y[0].height);for(let t=0,e=y.length;t<e;t++)p=y[t],x?i.texSubImage2D(3553,t,0,0,d,m,p):i.texImage2D(3553,t,v,d,m,p);n.generateMipmaps=!1}else x?(M&&i.texStorage2D(3553,b,v,l.width,l.height),i.texSubImage2D(3553,0,0,0,d,m,l)):i.texImage2D(3553,0,v,d,m,l);N(n,u)&&F(o),h.__currentVersion=h.version,n.onUpdate&&n.onUpdate(n)}e.__version=n.version}function K(e,r,o,a,l){const c=s.convert(o.format,o.encoding),h=s.convert(o.type),d=U(o.internalFormat,c,h,o.encoding);n.get(r).__hasExternalTextures||(32879===l||35866===l?i.texImage3D(l,0,d,r.width,r.height,r.depth,0,c,h,null):i.texImage2D(l,0,d,r.width,r.height,0,c,h,null)),i.bindFramebuffer(36160,e),nt(r)?u.framebufferTexture2DMultisampleEXT(36160,a,l,n.get(o).__webglTexture,0,it(r)):t.framebufferTexture2D(36160,a,l,n.get(o).__webglTexture,0),i.bindFramebuffer(36160,null)}function tt(e,i,n){if(t.bindRenderbuffer(36161,e),i.depthBuffer&&!i.stencilBuffer){let r=33189;if(n||nt(i)){const e=i.depthTexture;e&&e.isDepthTexture&&(e.type===T?r=36012:e.type===S&&(r=33190));const n=it(i);nt(i)?u.renderbufferStorageMultisampleEXT(36161,n,r,i.width,i.height):t.renderbufferStorageMultisample(36161,n,r,i.width,i.height)}else t.renderbufferStorage(36161,r,i.width,i.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(i.depthBuffer&&i.stencilBuffer){const r=it(i);n&&!1===nt(i)?t.renderbufferStorageMultisample(36161,r,35056,i.width,i.height):nt(i)?u.renderbufferStorageMultisampleEXT(36161,r,35056,i.width,i.height):t.renderbufferStorage(36161,34041,i.width,i.height),t.framebufferRenderbuffer(36160,33306,36161,e)}else{const e=!0===i.isWebGLMultipleRenderTargets?i.texture[0]:i.texture,r=s.convert(e.format,e.encoding),o=s.convert(e.type),a=U(e.internalFormat,r,o,e.encoding),l=it(i);n&&!1===nt(i)?t.renderbufferStorageMultisample(36161,l,a,i.width,i.height):nt(i)?u.renderbufferStorageMultisampleEXT(36161,l,a,i.width,i.height):t.renderbufferStorage(36161,a,i.width,i.height)}t.bindRenderbuffer(36161,null)}function et(e){const r=n.get(e),s=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),W(r.depthTexture,0);const s=n.get(r.depthTexture).__webglTexture,o=it(r);if(r.depthTexture.format===O)nt(r)?u.framebufferTexture2DMultisampleEXT(36160,36096,3553,s,0,o):t.framebufferTexture2D(36160,36096,3553,s,0);else{if(r.depthTexture.format!==P)throw new Error("Unknown depthTexture format");nt(r)?u.framebufferTexture2DMultisampleEXT(36160,33306,3553,s,0,o):t.framebufferTexture2D(36160,33306,3553,s,0)}}(r.__webglFramebuffer,e)}else if(s){r.__webglDepthbuffer=[];for(let n=0;n<6;n++)i.bindFramebuffer(36160,r.__webglFramebuffer[n]),r.__webglDepthbuffer[n]=t.createRenderbuffer(),tt(r.__webglDepthbuffer[n],e,!1)}else i.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),tt(r.__webglDepthbuffer,e,!1);i.bindFramebuffer(36160,null)}function it(t){return Math.min(h,t.samples)}function nt(t){const i=n.get(t);return a&&t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==i.__useRenderToTexture}function rt(t,i){const n=t.encoding,r=t.format;t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||t.format===st||n!==Q&&(n===$?!1===a&&(!0===e.has("EXT_sRGB")&&r===C?(t.format=st,t.minFilter=_,t.generateMipmaps=!1):i=It.sRGBToLinear(i)):console.error("THREE.WebGLTextures: Unsupported texture encoding:",n)),i}this.allocateTextureUnit=function(){const t=V;return V+=1,t},this.resetTextureUnits=function(){V=0},this.setTexture2D=W,this.setTexture2DArray=function(t,e){const r=n.get(t);t.version>0&&r.__version!==t.version?Z(r,t,e):(i.activeTexture(33984+e),i.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(t,e){const r=n.get(t);t.version>0&&r.__version!==t.version?Z(r,t,e):(i.activeTexture(33984+e),i.bindTexture(32879,r.__webglTexture))},this.setTextureCube=function(e,r){const o=n.get(e);e.version>0&&o.__version!==e.version?function(e,n,r){if(6!==n.image.length)return;const o=Y(e,n),c=n.source;if(i.activeTexture(33984+r),i.bindTexture(34067,e.__webglTexture),c.version!==c.__currentVersion||!0===o){t.pixelStorei(37440,n.flipY),t.pixelStorei(37441,n.premultiplyAlpha),t.pixelStorei(3317,n.unpackAlignment),t.pixelStorei(37443,0);const r=n.isCompressedTexture||n.image[0].isCompressedTexture,o=n.image[0]&&n.image[0].isDataTexture,h=[];for(let t=0;t<6;t++)h[t]=r||o?o?n.image[t].image:n.image[t]:R(n.image[t],!1,!0,l),h[t]=rt(n,h[t]);const u=h[0],d=B(u)||a,p=s.convert(n.format,n.encoding),f=s.convert(n.type),m=U(n.internalFormat,p,f,n.encoding),g=a&&!0!==n.isVideoTexture,v=void 0===e.__version;let y,_=G(n,u,d);if(X(34067,n,d),r){g&&v&&i.texStorage2D(34067,_,m,u.width,u.height);for(let t=0;t<6;t++){y=h[t].mipmaps;for(let e=0;e<y.length;e++){const r=y[e];n.format!==C?null!==p&&(g?i.compressedTexSubImage2D(34069+t,e,0,0,r.width,r.height,p,r.data):i.compressedTexImage2D(34069+t,e,m,r.width,r.height,0,r.data)):g?i.texSubImage2D(34069+t,e,0,0,r.width,r.height,p,f,r.data):i.texImage2D(34069+t,e,m,r.width,r.height,0,p,f,r.data)}}}else{y=n.mipmaps,g&&v&&(y.length>0&&_++,i.texStorage2D(34067,_,m,h[0].width,h[0].height));for(let t=0;t<6;t++)if(o){g?i.texSubImage2D(34069+t,0,0,0,h[t].width,h[t].height,p,f,h[t].data):i.texImage2D(34069+t,0,m,h[t].width,h[t].height,0,p,f,h[t].data);for(let e=0;e<y.length;e++){const n=y[e].image[t].image;g?i.texSubImage2D(34069+t,e+1,0,0,n.width,n.height,p,f,n.data):i.texImage2D(34069+t,e+1,m,n.width,n.height,0,p,f,n.data)}}else{g?i.texSubImage2D(34069+t,0,0,0,p,f,h[t]):i.texImage2D(34069+t,0,m,p,f,h[t]);for(let e=0;e<y.length;e++){const n=y[e];g?i.texSubImage2D(34069+t,e+1,0,0,p,f,n.image[t]):i.texImage2D(34069+t,e+1,m,p,f,n.image[t])}}}N(n,d)&&F(34067),c.__currentVersion=c.version,n.onUpdate&&n.onUpdate(n)}e.__version=n.version}(o,e,r):(i.activeTexture(33984+r),i.bindTexture(34067,o.__webglTexture))},this.rebindTextures=function(t,e,i){const r=n.get(t);void 0!==e&&K(r.__webglFramebuffer,t,t.texture,36064,3553),void 0!==i&&et(t)},this.setupRenderTarget=function(e){const l=e.texture,c=n.get(e),h=n.get(l);e.addEventListener("dispose",j),!0!==e.isWebGLMultipleRenderTargets&&(void 0===h.__webglTexture&&(h.__webglTexture=t.createTexture()),h.__version=l.version,o.memory.textures++);const u=!0===e.isWebGLCubeRenderTarget,d=!0===e.isWebGLMultipleRenderTargets,p=B(e)||a;if(u){c.__webglFramebuffer=[];for(let e=0;e<6;e++)c.__webglFramebuffer[e]=t.createFramebuffer()}else if(c.__webglFramebuffer=t.createFramebuffer(),d){if(r.drawBuffers){const i=e.texture;for(let e=0,r=i.length;e<r;e++){const r=n.get(i[e]);void 0===r.__webglTexture&&(r.__webglTexture=t.createTexture(),o.memory.textures++)}}}else if(a&&e.samples>0&&!1===nt(e)){c.__webglMultisampledFramebuffer=t.createFramebuffer(),c.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,c.__webglColorRenderbuffer);const n=s.convert(l.format,l.encoding),r=s.convert(l.type),o=U(l.internalFormat,n,r,l.encoding),a=it(e);t.renderbufferStorageMultisample(36161,a,o,e.width,e.height),i.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,c.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(c.__webglDepthRenderbuffer=t.createRenderbuffer(),tt(c.__webglDepthRenderbuffer,e,!0)),i.bindFramebuffer(36160,null)}if(u){i.bindTexture(34067,h.__webglTexture),X(34067,l,p);for(let t=0;t<6;t++)K(c.__webglFramebuffer[t],e,l,36064,34069+t);N(l,p)&&F(34067),i.unbindTexture()}else if(d){const t=e.texture;for(let r=0,s=t.length;r<s;r++){const s=t[r],o=n.get(s);i.bindTexture(3553,o.__webglTexture),X(3553,s,p),K(c.__webglFramebuffer,e,s,36064+r,3553),N(s,p)&&F(3553)}i.unbindTexture()}else{let t=3553;(e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(a?t=e.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(t,h.__webglTexture),X(t,l,p),K(c.__webglFramebuffer,e,l,36064,t),N(l,p)&&F(t),i.unbindTexture()}e.depthBuffer&&et(e)},this.updateRenderTargetMipmap=function(t){const e=B(t)||a,r=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let s=0,o=r.length;s<o;s++){const o=r[s];if(N(o,e)){const e=t.isWebGLCubeRenderTarget?34067:3553,r=n.get(o).__webglTexture;i.bindTexture(e,r),F(e),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(a&&e.samples>0&&!1===nt(e)){const r=e.width,s=e.height;let o=16384;const a=[36064],l=e.stencilBuffer?33306:36096;e.depthBuffer&&a.push(l);const c=n.get(e),h=void 0!==c.__ignoreDepthValues&&c.__ignoreDepthValues;!1===h&&(e.depthBuffer&&(o|=256),e.stencilBuffer&&(o|=1024)),i.bindFramebuffer(36008,c.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,c.__webglFramebuffer),!0===h&&(t.invalidateFramebuffer(36008,[l]),t.invalidateFramebuffer(36009,[l])),t.blitFramebuffer(0,0,r,s,0,0,r,s,o,9728),t.invalidateFramebuffer(36008,a),i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,c.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=et,this.setupFrameBufferTexture=K,this.useMultisampledRTT=nt}function Cs(t,e,i){const n=i.isWebGL2;return{convert:function(t,i=null){let r;if(t===b)return 5121;if(1017===t)return 32819;if(1018===t)return 32820;if(1010===t)return 5120;if(1011===t)return 5122;if(t===w)return 5123;if(1013===t)return 5124;if(t===S)return 5125;if(t===T)return 5126;if(t===A)return n?5131:(r=e.get("OES_texture_half_float"),null!==r?r.HALF_FLOAT_OES:null);if(1021===t)return 6406;if(t===C)return 6408;if(1024===t)return 6409;if(1025===t)return 6410;if(t===O)return 6402;if(t===P)return 34041;if(1028===t)return 6403;if(1022===t)return 6408;if(t===st)return r=e.get("EXT_sRGB"),null!==r?r.SRGB_ALPHA_EXT:null;if(1029===t)return 36244;if(1030===t)return 33319;if(1031===t)return 33320;if(1033===t)return 36249;if(t===I||t===D||t===L||t===R)if(i===$){if(r=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===r)return null;if(t===I)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(t===D)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(t===L)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(t===R)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(r=e.get("WEBGL_compressed_texture_s3tc"),null===r)return null;if(t===I)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===D)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===L)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===R)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===B||35841===t||t===N||35843===t){if(r=e.get("WEBGL_compressed_texture_pvrtc"),null===r)return null;if(t===B)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===t)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===N)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===t)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t===F)return r=e.get("WEBGL_compressed_texture_etc1"),null!==r?r.COMPRESSED_RGB_ETC1_WEBGL:null;if(t===U||t===G){if(r=e.get("WEBGL_compressed_texture_etc"),null===r)return null;if(t===U)return i===$?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(t===G)return i===$?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}if(t===z||37809===t||37810===t||37811===t||37812===t||37813===t||37814===t||37815===t||37816===t||37817===t||37818===t||37819===t||37820===t||37821===t){if(r=e.get("WEBGL_compressed_texture_astc"),null===r)return null;if(t===z)return i===$?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===t)return i===$?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===t)return i===$?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===t)return i===$?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===t)return i===$?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===t)return i===$?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===t)return i===$?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===t)return i===$?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===t)return i===$?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===t)return i===$?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===t)return i===$?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===t)return i===$?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===t)return i===$?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===t)return i===$?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}if(t===k){if(r=e.get("EXT_texture_compression_bptc"),null===r)return null;if(t===k)return i===$?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT}return t===E?n?34042:(r=e.get("WEBGL_depth_texture"),null!==r?r.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class Os extends Vi{constructor(t=[]){super(),this.cameras=t}}Os.prototype.isArrayCamera=!0;class Ps extends He{constructor(){super(),this.type="Group"}}Ps.prototype.isGroup=!0;const Is={type:"move"};class Ds{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Ps,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Ps,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new kt,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new kt),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Ps,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new kt,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new kt),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,i){let n=null,r=null,s=null;const o=this._targetRay,a=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState)if(null!==o&&(n=e.getPose(t.targetRaySpace,i),null!==n&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Is))),l&&t.hand){s=!0;for(const n of t.hand.values()){const t=e.getJointPose(n,i);if(void 0===l.joints[n.jointName]){const t=new Ps;t.matrixAutoUpdate=!1,t.visible=!1,l.joints[n.jointName]=t,l.add(t)}const r=l.joints[n.jointName];null!==t&&(r.matrix.fromArray(t.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=t.radius),r.visible=null!==t}const n=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],o=n.position.distanceTo(r.position),a=.02,c=.005;l.inputState.pinching&&o>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&o<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==a&&t.gripSpace&&(r=e.getPose(t.gripSpace,i),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1));return null!==o&&(o.visible=null!==n),null!==a&&(a.visible=null!==r),null!==l&&(l.visible=null!==s),this}}class Ls extends Bt{constructor(t,e,i,n,r,s,o,a,l,c){if((c=void 0!==c?c:O)!==O&&c!==P)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===O&&(i=w),void 0===i&&c===P&&(i=E),super(null,n,r,s,o,a,c,i,l),this.image={width:t,height:e},this.magFilter=void 0!==o?o:g,this.minFilter=void 0!==a?a:g,this.flipY=!1,this.generateMipmaps=!1}}Ls.prototype.isDepthTexture=!0;class Rs extends ot{constructor(t,e){super();const i=this;let n=null,r=1,s=null,o="local-floor",a=null,l=null,c=null,h=null,u=null;const d=e.getContextAttributes();let p=null,f=null;const m=[],g=new Map,v=new Vi;v.layers.enable(1),v.viewport=new Nt;const y=new Vi;y.layers.enable(2),y.viewport=new Nt;const _=[v,y],x=new Os;x.layers.enable(1),x.layers.enable(2);let M=null,S=null;function T(t){const e=g.get(t.inputSource);e&&e.dispatchEvent({type:t.type,data:t.inputSource})}function A(){g.forEach((function(t,e){t.disconnect(e)})),g.clear(),M=null,S=null,t.setRenderTarget(p),h=null,c=null,l=null,n=null,f=null,N.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function I(t){const e=n.inputSources;for(let t=0;t<m.length;t++)g.set(e[t],m[t]);for(let e=0;e<t.removed.length;e++){const i=t.removed[e],n=g.get(i);n&&(n.dispatchEvent({type:"disconnected",data:i}),g.delete(i))}for(let e=0;e<t.added.length;e++){const i=t.added[e],n=g.get(i);n&&n.dispatchEvent({type:"connected",data:i})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=m[t];return void 0===e&&(e=new Ds,m[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=m[t];return void 0===e&&(e=new Ds,m[t]=e),e.getGripSpace()},this.getHand=function(t){let e=m[t];return void 0===e&&(e=new Ds,m[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){r=t,i.isPresenting},this.setReferenceSpaceType=function(t){o=t,i.isPresenting},this.getReferenceSpace=function(){return s},this.getBaseLayer=function(){return null!==c?c:h},this.getBinding=function(){return l},this.getFrame=function(){return u},this.getSession=function(){return n},this.setSession=async function(a){if(n=a,null!==n){if(p=t.getRenderTarget(),n.addEventListener("select",T),n.addEventListener("selectstart",T),n.addEventListener("selectend",T),n.addEventListener("squeeze",T),n.addEventListener("squeezestart",T),n.addEventListener("squeezeend",T),n.addEventListener("end",A),n.addEventListener("inputsourceschange",I),!0!==d.xrCompatible&&await e.makeXRCompatible(),void 0===n.renderState.layers||!1===t.capabilities.isWebGL2){const i={antialias:void 0!==n.renderState.layers||d.antialias,alpha:d.alpha,depth:d.depth,stencil:d.stencil,framebufferScaleFactor:r};h=new XRWebGLLayer(n,e,i),n.updateRenderState({baseLayer:h}),f=new Ft(h.framebufferWidth,h.framebufferHeight,{format:C,type:b,encoding:t.outputEncoding})}else{let i=null,s=null,o=null;d.depth&&(o=d.stencil?35056:33190,i=d.stencil?P:O,s=d.stencil?E:w);const a={colorFormat:t.outputEncoding===$?35907:32856,depthFormat:o,scaleFactor:r};l=new XRWebGLBinding(n,e),c=l.createProjectionLayer(a),n.updateRenderState({layers:[c]}),f=new Ft(c.textureWidth,c.textureHeight,{format:C,type:b,depthTexture:new Ls(c.textureWidth,c.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,i),stencilBuffer:d.stencil,encoding:t.outputEncoding,samples:d.antialias?4:0});t.properties.get(f).__ignoreDepthValues=c.ignoreDepthValues}f.isXRRenderTarget=!0,this.setFoveation(1),s=await n.requestReferenceSpace(o),N.setContext(n),N.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};const D=new kt,L=new kt;function R(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===n)return;x.near=y.near=v.near=t.near,x.far=y.far=v.far=t.far,M===x.near&&S===x.far||(n.updateRenderState({depthNear:x.near,depthFar:x.far}),M=x.near,S=x.far);const e=t.parent,i=x.cameras;R(x,e);for(let t=0;t<i.length;t++)R(i[t],e);x.matrixWorld.decompose(x.position,x.quaternion,x.scale),t.position.copy(x.position),t.quaternion.copy(x.quaternion),t.scale.copy(x.scale),t.matrix.copy(x.matrix),t.matrixWorld.copy(x.matrixWorld);const r=t.children;for(let t=0,e=r.length;t<e;t++)r[t].updateMatrixWorld(!0);2===i.length?function(t,e,i){D.setFromMatrixPosition(e.matrixWorld),L.setFromMatrixPosition(i.matrixWorld);const n=D.distanceTo(L),r=e.projectionMatrix.elements,s=i.projectionMatrix.elements,o=r[14]/(r[10]-1),a=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],h=(r[8]-1)/r[0],u=(s[8]+1)/s[0],d=o*h,p=o*u,f=n/(-h+u),m=f*-h;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const g=o+f,v=a+f,y=d-m,_=p+(n-m),x=l*a/v*g,M=c*a/v*g;t.projectionMatrix.makePerspective(y,_,x,M,g,v)}(x,v,y):x.projectionMatrix.copy(v.projectionMatrix)},this.getCamera=function(){return x},this.getFoveation=function(){return null!==c?c.fixedFoveation:null!==h?h.fixedFoveation:void 0},this.setFoveation=function(t){null!==c&&(c.fixedFoveation=t),null!==h&&void 0!==h.fixedFoveation&&(h.fixedFoveation=t)};let B=null;const N=new nn;N.setAnimationLoop((function(e,i){if(a=i.getViewerPose(s),u=i,null!==a){const e=a.views;null!==h&&(t.setRenderTargetFramebuffer(f,h.framebuffer),t.setRenderTarget(f));let i=!1;e.length!==x.cameras.length&&(x.cameras.length=0,i=!0);for(let n=0;n<e.length;n++){const r=e[n];let s=null;if(null!==h)s=h.getViewport(r);else{const e=l.getViewSubImage(c,r);s=e.viewport,0===n&&(t.setRenderTargetTextures(f,e.colorTexture,c.ignoreDepthValues?void 0:e.depthStencilTexture),t.setRenderTarget(f))}const o=_[n];o.matrix.fromArray(r.transform.matrix),o.projectionMatrix.fromArray(r.projectionMatrix),o.viewport.set(s.x,s.y,s.width,s.height),0===n&&x.matrix.copy(o.matrix),!0===i&&x.cameras.push(o)}}const r=n.inputSources;for(let t=0;t<m.length;t++){const e=m[t],n=r[t];e.update(n,i,s)}B&&B(e,i),u=null})),this.setAnimationLoop=function(t){B=t},this.dispose=function(){}}}function Bs(t){function e(e,i){e.opacity.value=i.opacity,i.color&&e.diffuse.value.copy(i.color),i.emissive&&e.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(e.map.value=i.map),i.alphaMap&&(e.alphaMap.value=i.alphaMap),i.specularMap&&(e.specularMap.value=i.specularMap),i.alphaTest>0&&(e.alphaTest.value=i.alphaTest);const n=t.get(i).envMap;let r,s;n&&(e.envMap.value=n,e.flipEnvMap.value=n.isCubeTexture&&!1===n.isRenderTargetTexture?-1:1,e.reflectivity.value=i.reflectivity,e.ior.value=i.ior,e.refractionRatio.value=i.refractionRatio),i.lightMap&&(e.lightMap.value=i.lightMap,e.lightMapIntensity.value=i.lightMapIntensity),i.aoMap&&(e.aoMap.value=i.aoMap,e.aoMapIntensity.value=i.aoMapIntensity),i.map?r=i.map:i.specularMap?r=i.specularMap:i.displacementMap?r=i.displacementMap:i.normalMap?r=i.normalMap:i.bumpMap?r=i.bumpMap:i.roughnessMap?r=i.roughnessMap:i.metalnessMap?r=i.metalnessMap:i.alphaMap?r=i.alphaMap:i.emissiveMap?r=i.emissiveMap:i.clearcoatMap?r=i.clearcoatMap:i.clearcoatNormalMap?r=i.clearcoatNormalMap:i.clearcoatRoughnessMap?r=i.clearcoatRoughnessMap:i.specularIntensityMap?r=i.specularIntensityMap:i.specularColorMap?r=i.specularColorMap:i.transmissionMap?r=i.transmissionMap:i.thicknessMap?r=i.thicknessMap:i.sheenColorMap?r=i.sheenColorMap:i.sheenRoughnessMap&&(r=i.sheenRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix)),i.aoMap?s=i.aoMap:i.lightMap&&(s=i.lightMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),e.uv2Transform.value.copy(s.matrix))}function i(e,i){e.roughness.value=i.roughness,e.metalness.value=i.metalness,i.roughnessMap&&(e.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(e.metalnessMap.value=i.metalnessMap),i.emissiveMap&&(e.emissiveMap.value=i.emissiveMap),i.bumpMap&&(e.bumpMap.value=i.bumpMap,e.bumpScale.value=i.bumpScale,1===i.side&&(e.bumpScale.value*=-1)),i.normalMap&&(e.normalMap.value=i.normalMap,e.normalScale.value.copy(i.normalScale),1===i.side&&e.normalScale.value.negate()),i.displacementMap&&(e.displacementMap.value=i.displacementMap,e.displacementScale.value=i.displacementScale,e.displacementBias.value=i.displacementBias);t.get(i).envMap&&(e.envMapIntensity.value=i.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,n,r,s,o){n.isMeshBasicMaterial?e(t,n):n.isMeshLambertMaterial?(e(t,n),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(t,n)):n.isMeshToonMaterial?(e(t,n),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap);e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshPhongMaterial?(e(t,n),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshStandardMaterial?(e(t,n),n.isMeshPhysicalMaterial?function(t,e,n){i(t,e),t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap));e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,1===e.side&&t.clearcoatNormalScale.value.negate()));e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=n.texture,t.transmissionSamplerSize.value.set(n.width,n.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor));t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap);e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap)}(t,n,o):i(t,n)):n.isMeshMatcapMaterial?(e(t,n),function(t,e){e.matcap&&(t.matcap.value=e.matcap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshDepthMaterial?(e(t,n),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshDistanceMaterial?(e(t,n),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias);t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,n)):n.isMeshNormalMaterial?(e(t,n),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,n),n.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,n)):n.isPointsMaterial?function(t,e,i,n){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*i,t.scale.value=.5*n,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);e.alphaTest>0&&(t.alphaTest.value=e.alphaTest);let r;e.map?r=e.map:e.alphaMap&&(r=e.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}(t,n,r,s):n.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);e.alphaTest>0&&(t.alphaTest.value=e.alphaTest);let i;e.map?i=e.map:e.alphaMap&&(i=e.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}(t,n):n.isShadowMaterial?(t.color.value.copy(n.color),t.opacity.value=n.opacity):n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)}}}function Ns(t={}){const e=void 0!==t.canvas?t.canvas:function(){const t=bt("canvas");return t.style.display="block",t}(),i=void 0!==t.context?t.context:null,n=void 0===t.depth||t.depth,o=void 0===t.stencil||t.stencil,a=void 0!==t.antialias&&t.antialias,l=void 0===t.premultipliedAlpha||t.premultipliedAlpha,c=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,h=void 0!==t.powerPreference?t.powerPreference:"default",u=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let d;d=void 0!==t.context?i.getContextAttributes().alpha:void 0!==t.alpha&&t.alpha;let p=null,f=null;const m=[],g=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Q,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const v=this;let y=!1,_=0,x=0,w=null,S=-1,E=null;const O=new Nt,P=new Nt;let I=null,D=e.width,L=e.height,R=1,B=null,N=null;const F=new Nt(0,0,D,L),U=new Nt(0,0,D,L);let G=!1;const z=new en;let k=!1,j=!1,H=null;const V=new ye,W=new _t,q=new kt,J={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function X(){return null===w?R:1}let Y,Z,K,$,tt,et,it,nt,rt,st,ot,at,lt,ct,ht,ut,dt,pt,ft,mt,gt,yt,xt,Mt=i;function wt(t,i){for(let n=0;n<t.length;n++){const r=t[n],s=e.getContext(r,i);if(null!==s)return s}return null}try{const t={alpha:!0,depth:n,stencil:o,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:h,failIfMajorPerformanceCaveat:u};if("setAttribute"in e&&e.setAttribute("data-engine","three.js r138"),e.addEventListener("webglcontextlost",At,!1),e.addEventListener("webglcontextrestored",Et,!1),null===Mt){const e=["webgl2","webgl","experimental-webgl"];if(!0===v.isWebGL1Renderer&&e.shift(),Mt=wt(e,t),null===Mt)throw wt(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===Mt.getShaderPrecisionFormat&&(Mt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function St(){Y=new In(Mt),Z=new dn(Mt,Y,t),Y.init(Z),yt=new Cs(Mt,Y,Z),K=new As(Mt,Y,Z),$=new Rn(Mt),tt=new ds,et=new Es(Mt,Y,K,tt,Z,yt,$),it=new fn(v),nt=new Pn(v),rt=new rn(Mt,Z),xt=new hn(Mt,Y,rt,Z),st=new Dn(Mt,rt,$,xt),ot=new Gn(Mt,st,rt,$),ft=new Un(Mt,Z,et),ut=new pn(tt),at=new us(v,it,nt,Y,Z,xt,ut),lt=new Bs(tt),ct=new gs,ht=new bs(Y,Z),pt=new cn(v,it,K,ot,d,l),dt=new Ts(v,ot,Z),mt=new un(Mt,Y,$,Z),gt=new Ln(Mt,Y,$,Z),$.programs=at.programs,v.capabilities=Z,v.extensions=Y,v.properties=tt,v.renderLists=ct,v.shadowMap=dt,v.state=K,v.info=$}St();const Tt=new Rs(v,Mt);function At(t){t.preventDefault(),y=!0}function Et(){y=!1;const t=$.autoReset,e=dt.enabled,i=dt.autoUpdate,n=dt.needsUpdate,r=dt.type;St(),$.autoReset=t,dt.enabled=e,dt.autoUpdate=i,dt.needsUpdate=n,dt.type=r}function Ct(t){const e=t.target;e.removeEventListener("dispose",Ct),function(t){(function(t){const e=tt.get(t).programs;void 0!==e&&(e.forEach((function(t){at.releaseProgram(t)})),t.isShaderMaterial&&at.releaseShaderCache(t))})(t),tt.remove(t)}(e)}this.xr=Tt,this.getContext=function(){return Mt},this.getContextAttributes=function(){return Mt.getContextAttributes()},this.forceContextLoss=function(){const t=Y.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=Y.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return R},this.setPixelRatio=function(t){void 0!==t&&(R=t,this.setSize(D,L,!1))},this.getSize=function(t){return t.set(D,L)},this.setSize=function(t,i,n){Tt.isPresenting||(D=t,L=i,e.width=Math.floor(t*R),e.height=Math.floor(i*R),!1!==n&&(e.style.width=t+"px",e.style.height=i+"px"),this.setViewport(0,0,t,i))},this.getDrawingBufferSize=function(t){return t.set(D*R,L*R).floor()},this.setDrawingBufferSize=function(t,i,n){D=t,L=i,R=n,e.width=Math.floor(t*n),e.height=Math.floor(i*n),this.setViewport(0,0,t,i)},this.getCurrentViewport=function(t){return t.copy(O)},this.getViewport=function(t){return t.copy(F)},this.setViewport=function(t,e,i,n){t.isVector4?F.set(t.x,t.y,t.z,t.w):F.set(t,e,i,n),K.viewport(O.copy(F).multiplyScalar(R).floor())},this.getScissor=function(t){return t.copy(U)},this.setScissor=function(t,e,i,n){t.isVector4?U.set(t.x,t.y,t.z,t.w):U.set(t,e,i,n),K.scissor(P.copy(U).multiplyScalar(R).floor())},this.getScissorTest=function(){return G},this.setScissorTest=function(t){K.setScissorTest(G=t)},this.setOpaqueSort=function(t){B=t},this.setTransparentSort=function(t){N=t},this.getClearColor=function(t){return t.copy(pt.getClearColor())},this.setClearColor=function(){pt.setClearColor.apply(pt,arguments)},this.getClearAlpha=function(){return pt.getClearAlpha()},this.setClearAlpha=function(){pt.setClearAlpha.apply(pt,arguments)},this.clear=function(t=!0,e=!0,i=!0){let n=0;t&&(n|=16384),e&&(n|=256),i&&(n|=1024),Mt.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",At,!1),e.removeEventListener("webglcontextrestored",Et,!1),ct.dispose(),ht.dispose(),tt.dispose(),it.dispose(),nt.dispose(),ot.dispose(),xt.dispose(),at.dispose(),Tt.dispose(),Tt.removeEventListener("sessionstart",Pt),Tt.removeEventListener("sessionend",It),H&&(H.dispose(),H=null),Dt.stop()},this.renderBufferDirect=function(t,e,i,n,r,s){null===e&&(e=J);const o=r.isMesh&&r.matrixWorld.determinant()<0,a=function(t,e,i,n,r){!0!==e.isScene&&(e=J);et.resetTextureUnits();const s=e.fog,o=n.isMeshStandardMaterial?e.environment:null,a=null===w?v.outputEncoding:!0===w.isXRRenderTarget?w.texture.encoding:Q,l=(n.isMeshStandardMaterial?nt:it).get(n.envMap||o),c=!0===n.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,h=!!n.normalMap&&!!i.attributes.tangent,u=!!i.morphAttributes.position,d=!!i.morphAttributes.normal,p=!!i.morphAttributes.color,m=n.toneMapped?v.toneMapping:0,g=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,y=void 0!==g?g.length:0,_=tt.get(n),x=f.state.lights;if(!0===k&&(!0===j||t!==E)){const e=t===E&&n.id===S;ut.setState(n,t,e)}let M=!1;n.version===_.__version?_.needsLights&&_.lightsStateVersion!==x.state.version||_.outputEncoding!==a||r.isInstancedMesh&&!1===_.instancing?M=!0:r.isInstancedMesh||!0!==_.instancing?r.isSkinnedMesh&&!1===_.skinning?M=!0:r.isSkinnedMesh||!0!==_.skinning?_.envMap!==l||n.fog&&_.fog!==s?M=!0:void 0===_.numClippingPlanes||_.numClippingPlanes===ut.numPlanes&&_.numIntersection===ut.numIntersection?(_.vertexAlphas!==c||_.vertexTangents!==h||_.morphTargets!==u||_.morphNormals!==d||_.morphColors!==p||_.toneMapping!==m||!0===Z.isWebGL2&&_.morphTargetsCount!==y)&&(M=!0):M=!0:M=!0:M=!0:(M=!0,_.__version=n.version);let b=_.currentProgram;!0===M&&(b=Gt(n,e,r));let T=!1,A=!1,C=!1;const O=b.getUniforms(),P=_.uniforms;K.useProgram(b.program)&&(T=!0,A=!0,C=!0);n.id!==S&&(S=n.id,A=!0);if(T||E!==t){if(O.setValue(Mt,"projectionMatrix",t.projectionMatrix),Z.logarithmicDepthBuffer&&O.setValue(Mt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),E!==t&&(E=t,A=!0,C=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const e=O.map.cameraPosition;void 0!==e&&e.setValue(Mt,q.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&O.setValue(Mt,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||r.isSkinnedMesh)&&O.setValue(Mt,"viewMatrix",t.matrixWorldInverse)}if(r.isSkinnedMesh){O.setOptional(Mt,r,"bindMatrix"),O.setOptional(Mt,r,"bindMatrixInverse");const t=r.skeleton;t&&(Z.floatVertexTextures?(null===t.boneTexture&&t.computeBoneTexture(),O.setValue(Mt,"boneTexture",t.boneTexture,et),O.setValue(Mt,"boneTextureSize",t.boneTextureSize)):O.setOptional(Mt,t,"boneMatrices"))}const I=i.morphAttributes;(void 0!==I.position||void 0!==I.normal||void 0!==I.color&&!0===Z.isWebGL2)&&ft.update(r,i,n,b);(A||_.receiveShadow!==r.receiveShadow)&&(_.receiveShadow=r.receiveShadow,O.setValue(Mt,"receiveShadow",r.receiveShadow));A&&(O.setValue(Mt,"toneMappingExposure",v.toneMappingExposure),_.needsLights&&(B=C,(D=P).ambientLightColor.needsUpdate=B,D.lightProbe.needsUpdate=B,D.directionalLights.needsUpdate=B,D.directionalLightShadows.needsUpdate=B,D.pointLights.needsUpdate=B,D.pointLightShadows.needsUpdate=B,D.spotLights.needsUpdate=B,D.spotLightShadows.needsUpdate=B,D.rectAreaLights.needsUpdate=B,D.hemisphereLights.needsUpdate=B),s&&n.fog&&lt.refreshFogUniforms(P,s),lt.refreshMaterialUniforms(P,n,R,L,H),Hr.upload(Mt,_.uniformsList,P,et));var D,B;n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(Hr.upload(Mt,_.uniformsList,P,et),n.uniformsNeedUpdate=!1);n.isSpriteMaterial&&O.setValue(Mt,"center",r.center);return O.setValue(Mt,"modelViewMatrix",r.modelViewMatrix),O.setValue(Mt,"normalMatrix",r.normalMatrix),O.setValue(Mt,"modelMatrix",r.matrixWorld),b}(t,e,i,n,r);K.setMaterial(n,o);let l=i.index;const c=i.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let h,u=1;!0===n.wireframe&&(l=st.getWireframeAttribute(i),u=2),xt.setup(r,n,a,i,l);let d=mt;null!==l&&(h=rt.get(l),d=gt,d.setIndex(h));const p=null!==l?l.count:c.count,m=i.drawRange.start*u,g=i.drawRange.count*u,y=null!==s?s.start*u:0,_=null!==s?s.count*u:1/0,x=Math.max(m,y),M=Math.min(p,m+g,y+_)-1,b=Math.max(0,M-x+1);if(0!==b){if(r.isMesh)!0===n.wireframe?(K.setLineWidth(n.wireframeLinewidth*X()),d.setMode(1)):d.setMode(4);else if(r.isLine){let t=n.linewidth;void 0===t&&(t=1),K.setLineWidth(t*X()),r.isLineSegments?d.setMode(1):r.isLineLoop?d.setMode(2):d.setMode(3)}else r.isPoints?d.setMode(0):r.isSprite&&d.setMode(4);if(r.isInstancedMesh)d.renderInstances(x,b,r.count);else if(i.isInstancedBufferGeometry){const t=Math.min(i.instanceCount,i._maxInstanceCount);d.renderInstances(x,b,t)}else d.render(x,b)}},this.compile=function(t,e){f=ht.get(t),f.init(),g.push(f),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(f.pushLight(t),t.castShadow&&f.pushShadow(t))})),f.setupLights(v.physicallyCorrectLights),t.traverse((function(e){const i=e.material;if(i)if(Array.isArray(i))for(let n=0;n<i.length;n++){Gt(i[n],t,e)}else Gt(i,t,e)})),g.pop(),f=null};let Ot=null;function Pt(){Dt.stop()}function It(){Dt.start()}const Dt=new nn;function Lt(t,e,i,n){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)i=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)f.pushLight(t),t.castShadow&&f.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||z.intersectsSprite(t)){n&&q.setFromMatrixPosition(t.matrixWorld).applyMatrix4(V);const e=ot.update(t),r=t.material;r.visible&&p.push(t,e,r,i,q.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==$.render.frame&&(t.skeleton.update(),t.skeleton.frame=$.render.frame),!t.frustumCulled||z.intersectsObject(t))){n&&q.setFromMatrixPosition(t.matrixWorld).applyMatrix4(V);const e=ot.update(t),r=t.material;if(Array.isArray(r)){const n=e.groups;for(let s=0,o=n.length;s<o;s++){const o=n[s],a=r[o.materialIndex];a&&a.visible&&p.push(t,e,a,i,q.z,o)}}else r.visible&&p.push(t,e,r,i,q.z,null)}const r=t.children;for(let t=0,s=r.length;t<s;t++)Lt(r[t],e,i,n)}function Rt(t,e,i,n){const r=t.opaque,s=t.transmissive,o=t.transparent;f.setupLightsView(i),s.length>0&&function(t,e,i){const n=Z.isWebGL2;null===H&&(H=new Ft(1,1,{generateMipmaps:!0,type:null!==yt.convert(A)?A:b,minFilter:M,samples:n&&!0===a?4:0}));v.getDrawingBufferSize(W),n?H.setSize(W.x,W.y):H.setSize(vt(W.x),vt(W.y));const r=v.getRenderTarget();v.setRenderTarget(H),v.clear();const s=v.toneMapping;v.toneMapping=0,Bt(t,e,i),v.toneMapping=s,et.updateMultisampleRenderTarget(H),et.updateRenderTargetMipmap(H),v.setRenderTarget(r)}(r,e,i),n&&K.viewport(O.copy(n)),r.length>0&&Bt(r,e,i),s.length>0&&Bt(s,e,i),o.length>0&&Bt(o,e,i),K.buffers.depth.setTest(!0),K.buffers.depth.setMask(!0),K.buffers.color.setMask(!0),K.setPolygonOffset(!1)}function Bt(t,e,i){const n=!0===e.isScene?e.overrideMaterial:null;for(let r=0,s=t.length;r<s;r++){const s=t[r],o=s.object,a=s.geometry,l=null===n?s.material:n,c=s.group;o.layers.test(i.layers)&&Ut(o,e,i,a,l,c)}}function Ut(t,e,i,n,o,a){t.onBeforeRender(v,e,i,n,o,a),t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),o.onBeforeRender(v,e,i,n,t,a),!0===o.transparent&&o.side===s?(o.side=1,o.needsUpdate=!0,v.renderBufferDirect(i,e,n,o,t,a),o.side=r,o.needsUpdate=!0,v.renderBufferDirect(i,e,n,o,t,a),o.side=s):v.renderBufferDirect(i,e,n,o,t,a),t.onAfterRender(v,e,i,n,o,a)}function Gt(t,e,i){!0!==e.isScene&&(e=J);const n=tt.get(t),r=f.state.lights,s=f.state.shadowsArray,o=r.state.version,a=at.getParameters(t,r.state,s,e,i),l=at.getProgramCacheKey(a);let c=n.programs;n.environment=t.isMeshStandardMaterial?e.environment:null,n.fog=e.fog,n.envMap=(t.isMeshStandardMaterial?nt:it).get(t.envMap||n.environment),void 0===c&&(t.addEventListener("dispose",Ct),c=new Map,n.programs=c);let h=c.get(l);if(void 0!==h){if(n.currentProgram===h&&n.lightsStateVersion===o)return zt(t,a),h}else a.uniforms=at.getUniforms(t),t.onBuild(i,a,v),t.onBeforeCompile(a,v),h=at.acquireProgram(a,l),c.set(l,h),n.uniforms=a.uniforms;const u=n.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(u.clippingPlanes=ut.uniform),zt(t,a),n.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),n.lightsStateVersion=o,n.needsLights&&(u.ambientLightColor.value=r.state.ambient,u.lightProbe.value=r.state.probe,u.directionalLights.value=r.state.directional,u.directionalLightShadows.value=r.state.directionalShadow,u.spotLights.value=r.state.spot,u.spotLightShadows.value=r.state.spotShadow,u.rectAreaLights.value=r.state.rectArea,u.ltc_1.value=r.state.rectAreaLTC1,u.ltc_2.value=r.state.rectAreaLTC2,u.pointLights.value=r.state.point,u.pointLightShadows.value=r.state.pointShadow,u.hemisphereLights.value=r.state.hemi,u.directionalShadowMap.value=r.state.directionalShadowMap,u.directionalShadowMatrix.value=r.state.directionalShadowMatrix,u.spotShadowMap.value=r.state.spotShadowMap,u.spotShadowMatrix.value=r.state.spotShadowMatrix,u.pointShadowMap.value=r.state.pointShadowMap,u.pointShadowMatrix.value=r.state.pointShadowMatrix);const d=h.getUniforms(),p=Hr.seqWithValue(d.seq,u);return n.currentProgram=h,n.uniformsList=p,h}function zt(t,e){const i=tt.get(t);i.outputEncoding=e.outputEncoding,i.instancing=e.instancing,i.skinning=e.skinning,i.morphTargets=e.morphTargets,i.morphNormals=e.morphNormals,i.morphColors=e.morphColors,i.morphTargetsCount=e.morphTargetsCount,i.numClippingPlanes=e.numClippingPlanes,i.numIntersection=e.numClipIntersection,i.vertexAlphas=e.vertexAlphas,i.vertexTangents=e.vertexTangents,i.toneMapping=e.toneMapping}Dt.setAnimationLoop((function(t){Ot&&Ot(t)})),"undefined"!=typeof window&&Dt.setContext(window),this.setAnimationLoop=function(t){Ot=t,Tt.setAnimationLoop(t),null===t?Dt.stop():Dt.start()},Tt.addEventListener("sessionstart",Pt),Tt.addEventListener("sessionend",It),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===y)return;!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===Tt.enabled&&!0===Tt.isPresenting&&(!0===Tt.cameraAutoUpdate&&Tt.updateCamera(e),e=Tt.getCamera()),!0===t.isScene&&t.onBeforeRender(v,t,e,w),f=ht.get(t,g.length),f.init(),g.push(f),V.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),z.setFromProjectionMatrix(V),j=this.localClippingEnabled,k=ut.init(this.clippingPlanes,j,e),p=ct.get(t,m.length),p.init(),m.push(p),Lt(t,e,0,v.sortObjects),p.finish(),!0===v.sortObjects&&p.sort(B,N),!0===k&&ut.beginShadows();const i=f.state.shadowsArray;if(dt.render(i,t,e),!0===k&&ut.endShadows(),!0===this.info.autoReset&&this.info.reset(),pt.render(p,t),f.setupLights(v.physicallyCorrectLights),e.isArrayCamera){const i=e.cameras;for(let e=0,n=i.length;e<n;e++){const n=i[e];Rt(p,t,n,n.viewport)}}else Rt(p,t,e);null!==w&&(et.updateMultisampleRenderTarget(w),et.updateRenderTargetMipmap(w)),!0===t.isScene&&t.onAfterRender(v,t,e),xt.resetDefaultState(),S=-1,E=null,g.pop(),f=g.length>0?g[g.length-1]:null,m.pop(),p=m.length>0?m[m.length-1]:null},this.getActiveCubeFace=function(){return _},this.getActiveMipmapLevel=function(){return x},this.getRenderTarget=function(){return w},this.setRenderTargetTextures=function(t,e,i){tt.get(t.texture).__webglTexture=e,tt.get(t.depthTexture).__webglTexture=i;const n=tt.get(t);n.__hasExternalTextures=!0,n.__hasExternalTextures&&(n.__autoAllocateDepthBuffer=void 0===i,n.__autoAllocateDepthBuffer||!0===Y.has("WEBGL_multisampled_render_to_texture")&&(n.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(t,e){const i=tt.get(t);i.__webglFramebuffer=e,i.__useDefaultFramebuffer=void 0===e},this.setRenderTarget=function(t,e=0,i=0){w=t,_=e,x=i;let n=!0;if(t){const e=tt.get(t);void 0!==e.__useDefaultFramebuffer?(K.bindFramebuffer(36160,null),n=!1):void 0===e.__webglFramebuffer?et.setupRenderTarget(t):e.__hasExternalTextures&&et.rebindTextures(t,tt.get(t.texture).__webglTexture,tt.get(t.depthTexture).__webglTexture)}let r=null,s=!1,o=!1;if(t){const i=t.texture;(i.isData3DTexture||i.isDataArrayTexture)&&(o=!0);const n=tt.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=n[e],s=!0):r=Z.isWebGL2&&t.samples>0&&!1===et.useMultisampledRTT(t)?tt.get(t).__webglMultisampledFramebuffer:n,O.copy(t.viewport),P.copy(t.scissor),I=t.scissorTest}else O.copy(F).multiplyScalar(R).floor(),P.copy(U).multiplyScalar(R).floor(),I=G;if(K.bindFramebuffer(36160,r)&&Z.drawBuffers&&n&&K.drawBuffers(t,r),K.viewport(O),K.scissor(P),K.setScissorTest(I),s){const n=tt.get(t.texture);Mt.framebufferTexture2D(36160,36064,34069+e,n.__webglTexture,i)}else if(o){const n=tt.get(t.texture),r=e||0;Mt.framebufferTextureLayer(36160,36064,n.__webglTexture,i||0,r)}S=-1},this.readRenderTargetPixels=function(t,e,i,n,r,s,o){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=tt.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){K.bindFramebuffer(36160,a);try{const o=t.texture,a=o.format,l=o.type;if(a!==C&&yt.convert(a)!==Mt.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===A&&(Y.has("EXT_color_buffer_half_float")||Z.isWebGL2&&Y.has("EXT_color_buffer_float"));if(!(l===b||yt.convert(l)===Mt.getParameter(35738)||l===T&&(Z.isWebGL2||Y.has("OES_texture_float")||Y.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===Mt.checkFramebufferStatus(36160)?e>=0&&e<=t.width-n&&i>=0&&i<=t.height-r&&Mt.readPixels(e,i,n,r,yt.convert(a),yt.convert(l),s):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const t=null!==w?tt.get(w).__webglFramebuffer:null;K.bindFramebuffer(36160,t)}}},this.copyFramebufferToTexture=function(t,e,i=0){if(!0!==e.isFramebufferTexture)return void console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");const n=Math.pow(2,-i),r=Math.floor(e.image.width*n),s=Math.floor(e.image.height*n);et.setTexture2D(e,0),Mt.copyTexSubImage2D(3553,i,0,0,t.x,t.y,r,s),K.unbindTexture()},this.copyTextureToTexture=function(t,e,i,n=0){const r=e.image.width,s=e.image.height,o=yt.convert(i.format),a=yt.convert(i.type);et.setTexture2D(i,0),Mt.pixelStorei(37440,i.flipY),Mt.pixelStorei(37441,i.premultiplyAlpha),Mt.pixelStorei(3317,i.unpackAlignment),e.isDataTexture?Mt.texSubImage2D(3553,n,t.x,t.y,r,s,o,a,e.image.data):e.isCompressedTexture?Mt.compressedTexSubImage2D(3553,n,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,o,e.mipmaps[0].data):Mt.texSubImage2D(3553,n,t.x,t.y,o,a,e.image),0===n&&i.generateMipmaps&&Mt.generateMipmap(3553),K.unbindTexture()},this.copyTextureToTexture3D=function(t,e,i,n,r=0){if(v.isWebGL1Renderer)return;const s=t.max.x-t.min.x+1,o=t.max.y-t.min.y+1,a=t.max.z-t.min.z+1,l=yt.convert(n.format),c=yt.convert(n.type);let h;if(n.isData3DTexture)et.setTexture3D(n,0),h=32879;else{if(!n.isDataArrayTexture)return;et.setTexture2DArray(n,0),h=35866}Mt.pixelStorei(37440,n.flipY),Mt.pixelStorei(37441,n.premultiplyAlpha),Mt.pixelStorei(3317,n.unpackAlignment);const u=Mt.getParameter(3314),d=Mt.getParameter(32878),p=Mt.getParameter(3316),f=Mt.getParameter(3315),m=Mt.getParameter(32877),g=i.isCompressedTexture?i.mipmaps[0]:i.image;Mt.pixelStorei(3314,g.width),Mt.pixelStorei(32878,g.height),Mt.pixelStorei(3316,t.min.x),Mt.pixelStorei(3315,t.min.y),Mt.pixelStorei(32877,t.min.z),i.isDataTexture||i.isData3DTexture?Mt.texSubImage3D(h,r,e.x,e.y,e.z,s,o,a,l,c,g.data):i.isCompressedTexture?Mt.compressedTexSubImage3D(h,r,e.x,e.y,e.z,s,o,a,l,g.data):Mt.texSubImage3D(h,r,e.x,e.y,e.z,s,o,a,l,c,g),Mt.pixelStorei(3314,u),Mt.pixelStorei(32878,d),Mt.pixelStorei(3316,p),Mt.pixelStorei(3315,f),Mt.pixelStorei(32877,m),0===r&&n.generateMipmaps&&Mt.generateMipmap(h),K.unbindTexture()},this.initTexture=function(t){et.setTexture2D(t,0),K.unbindTexture()},this.resetState=function(){_=0,x=0,w=null,K.reset(),xt.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Ns.prototype.isWebGLRenderer=!0;(class extends Ns{}).prototype.isWebGL1Renderer=!0;class Fs{constructor(t,e=25e-5){this.name="",this.color=new Ot(t),this.density=e}clone(){return new Fs(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}Fs.prototype.isFogExp2=!0;class Us{constructor(t,e=1,i=1e3){this.name="",this.color=new Ot(t),this.near=e,this.far=i}clone(){return new Us(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}Us.prototype.isFog=!0;class Gs extends He{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}Gs.prototype.isScene=!0;class zs{constructor(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=it,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=ut()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let n=0,r=this.stride;n<r;n++)this.array[t+n]=e.array[i+n];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ut()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ut()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}zs.prototype.isInterleavedBuffer=!0;const ks=new kt;class js{constructor(t,e,i,n=!1){this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=!0===n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)ks.x=this.getX(e),ks.y=this.getY(e),ks.z=this.getZ(e),ks.applyMatrix4(t),this.setXYZ(e,ks.x,ks.y,ks.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)ks.x=this.getX(e),ks.y=this.getY(e),ks.z=this.getZ(e),ks.applyNormalMatrix(t),this.setXYZ(e,ks.x,ks.y,ks.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)ks.x=this.getX(e),ks.y=this.getY(e),ks.z=this.getZ(e),ks.transformDirection(t),this.setXYZ(e,ks.x,ks.y,ks.z);return this}setX(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){return this.data.array[t*this.data.stride+this.offset]}getY(t){return this.data.array[t*this.data.stride+this.offset+1]}getZ(t){return this.data.array[t*this.data.stride+this.offset+2]}getW(t){return this.data.array[t*this.data.stride+this.offset+3]}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this}setXYZW(t,e,i,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this.data.array[t+3]=r,this}clone(t){if(void 0===t){const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return new oi(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new js(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}js.prototype.isInterleavedBufferAttribute=!0;class Hs extends ii{constructor(t){super(),this.type="SpriteMaterial",this.color=new Ot(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this}}let Vs;Hs.prototype.isSpriteMaterial=!0;const Ws=new kt,qs=new kt,Js=new kt,Xs=new _t,Ys=new _t,Zs=new ye,Ks=new kt,Qs=new kt,$s=new kt,to=new _t,eo=new _t,io=new _t;class no extends He{constructor(t){if(super(),this.type="Sprite",void 0===Vs){Vs=new yi;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new zs(t,5);Vs.setIndex([0,1,2,0,2,3]),Vs.setAttribute("position",new js(e,3,0,!1)),Vs.setAttribute("uv",new js(e,2,3,!1))}this.geometry=Vs,this.material=void 0!==t?t:new Hs,this.center=new _t(.5,.5)}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),qs.setFromMatrixScale(this.matrixWorld),Zs.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),Js.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&qs.multiplyScalar(-Js.z);const i=this.material.rotation;let n,r;0!==i&&(r=Math.cos(i),n=Math.sin(i));const s=this.center;ro(Ks.set(-.5,-.5,0),Js,s,qs,n,r),ro(Qs.set(.5,-.5,0),Js,s,qs,n,r),ro($s.set(.5,.5,0),Js,s,qs,n,r),to.set(0,0),eo.set(1,0),io.set(1,1);let o=t.ray.intersectTriangle(Ks,Qs,$s,!1,Ws);if(null===o&&(ro(Qs.set(-.5,.5,0),Js,s,qs,n,r),eo.set(0,1),o=t.ray.intersectTriangle(Ks,$s,Qs,!1,Ws),null===o))return;const a=t.ray.origin.distanceTo(Ws);a<t.near||a>t.far||e.push({distance:a,point:Ws.clone(),uv:ti.getUV(Ws,Ks,Qs,$s,to,eo,io,new _t),face:null,object:this})}copy(t){return super.copy(t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}function ro(t,e,i,n,r,s){Xs.subVectors(t,i).addScalar(.5).multiply(n),void 0!==r?(Ys.x=s*Xs.x-r*Xs.y,Ys.y=r*Xs.x+s*Xs.y):Ys.copy(Xs),t.copy(e),t.x+=Ys.x,t.y+=Ys.y,t.applyMatrix4(Zs)}no.prototype.isSprite=!0;const so=new kt,oo=new Nt,ao=new Nt,lo=new kt,co=new ye;class ho extends Ni{constructor(t,e){super(t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new ye,this.bindMatrixInverse=new ye}copy(t){return super.copy(t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Nt,e=this.geometry.attributes.skinWeight;for(let i=0,n=e.count;i<n;i++){t.x=e.getX(i),t.y=e.getY(i),t.z=e.getZ(i),t.w=e.getW(i);const n=1/t.manhattanLength();n!==1/0?t.multiplyScalar(n):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():this.bindMode}boneTransform(t,e){const i=this.skeleton,n=this.geometry;oo.fromBufferAttribute(n.attributes.skinIndex,t),ao.fromBufferAttribute(n.attributes.skinWeight,t),so.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const n=ao.getComponent(t);if(0!==n){const r=oo.getComponent(t);co.multiplyMatrices(i.bones[r].matrixWorld,i.boneInverses[r]),e.addScaledVector(lo.copy(so).applyMatrix4(co),n)}}return e.applyMatrix4(this.bindMatrixInverse)}}ho.prototype.isSkinnedMesh=!0;class uo extends He{constructor(){super(),this.type="Bone"}}uo.prototype.isBone=!0;class po extends Bt{constructor(t=null,e=1,i=1,n,r,s,o,a,l=g,c=g,h,u){super(null,s,o,a,l,c,n,r,h,u),this.image={data:t,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}po.prototype.isDataTexture=!0;const fo=new ye,mo=new ye;class go{constructor(t=[],e=[]){this.uuid=ut(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new ye)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new ye;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let n=0,r=t.length;n<r;n++){const r=t[n]?t[n].matrixWorld:mo;fo.multiplyMatrices(r,e[n]),fo.toArray(i,16*n)}null!==n&&(n.needsUpdate=!0)}clone(){return new go(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=gt(t),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const i=new po(e,t,t,C,T);return i.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=i,this.boneTextureSize=t,this}getBoneByName(t){for(let e=0,i=this.bones.length;e<i;e++){const i=this.bones[e];if(i.name===t)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let i=0,n=t.bones.length;i<n;i++){const n=t.bones[i];let r=e[n];void 0===r&&(r=new uo),this.bones.push(r),this.boneInverses.push((new ye).fromArray(t.boneInverses[i]))}return this.init(),this}toJSON(){const t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,i=this.boneInverses;for(let n=0,r=e.length;n<r;n++){const r=e[n];t.bones.push(r.uuid);const s=i[n];t.boneInverses.push(s.toArray())}return t}}class vo extends oi{constructor(t,e,i,n=1){"number"==typeof i&&(n=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(t,e,i),this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}vo.prototype.isInstancedBufferAttribute=!0;const yo=new ye,_o=new ye,xo=[],Mo=new Ni;class bo extends Ni{constructor(t,e,i){super(t,e),this.instanceMatrix=new vo(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(t){return super.copy(t),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}raycast(t,e){const i=this.matrixWorld,n=this.count;if(Mo.geometry=this.geometry,Mo.material=this.material,void 0!==Mo.material)for(let r=0;r<n;r++){this.getMatrixAt(r,yo),_o.multiplyMatrices(i,yo),Mo.matrixWorld=_o,Mo.raycast(t,xo);for(let t=0,i=xo.length;t<i;t++){const i=xo[t];i.instanceId=r,i.object=this,e.push(i)}xo.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new vo(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}bo.prototype.isInstancedMesh=!0;class wo extends ii{constructor(t){super(),this.type="LineBasicMaterial",this.color=new Ot(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this}}wo.prototype.isLineBasicMaterial=!0;const So=new kt,To=new kt,Ao=new ye,Eo=new ve,Co=new ce;class Oo extends He{constructor(t=new yi,e=new wo){super(),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry){if(null===t.index){const e=t.attributes.position,i=[0];for(let t=1,n=e.count;t<n;t++)So.fromBufferAttribute(e,t-1),To.fromBufferAttribute(e,t),i[t]=i[t-1],i[t]+=So.distanceTo(To);t.setAttribute("lineDistance",new hi(i,1))}}else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,r=t.params.Line.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Co.copy(i.boundingSphere),Co.applyMatrix4(n),Co.radius+=r,!1===t.ray.intersectsSphere(Co))return;Ao.copy(n).invert(),Eo.copy(t.ray).applyMatrix4(Ao);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=new kt,c=new kt,h=new kt,u=new kt,d=this.isLineSegments?2:1;if(i.isBufferGeometry){const n=i.index,r=i.attributes.position;if(null!==n){for(let i=Math.max(0,s.start),o=Math.min(n.count,s.start+s.count)-1;i<o;i+=d){const s=n.getX(i),o=n.getX(i+1);l.fromBufferAttribute(r,s),c.fromBufferAttribute(r,o);if(Eo.distanceSqToSegment(l,c,u,h)>a)continue;u.applyMatrix4(this.matrixWorld);const d=t.ray.origin.distanceTo(u);d<t.near||d>t.far||e.push({distance:d,point:h.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else{for(let i=Math.max(0,s.start),n=Math.min(r.count,s.start+s.count)-1;i<n;i+=d){l.fromBufferAttribute(r,i),c.fromBufferAttribute(r,i+1);if(Eo.distanceSqToSegment(l,c,u,h)>a)continue;u.applyMatrix4(this.matrixWorld);const n=t.ray.origin.distanceTo(u);n<t.near||n>t.far||e.push({distance:n,point:h.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}else i.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Oo.prototype.isLine=!0;const Po=new kt,Io=new kt;class Do extends Oo{constructor(t,e){super(t,e),this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry){if(null===t.index){const e=t.attributes.position,i=[];for(let t=0,n=e.count;t<n;t+=2)Po.fromBufferAttribute(e,t),Io.fromBufferAttribute(e,t+1),i[t]=0===t?0:i[t-1],i[t+1]=i[t]+Po.distanceTo(Io);t.setAttribute("lineDistance",new hi(i,1))}}else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}Do.prototype.isLineSegments=!0;class Lo extends Oo{constructor(t,e){super(t,e),this.type="LineLoop"}}Lo.prototype.isLineLoop=!0;class Ro extends ii{constructor(t){super(),this.type="PointsMaterial",this.color=new Ot(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this}}Ro.prototype.isPointsMaterial=!0;const Bo=new ye,No=new ve,Fo=new ce,Uo=new kt;class Go extends He{constructor(t=new yi,e=new Ro){super(),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,r=t.params.Points.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Fo.copy(i.boundingSphere),Fo.applyMatrix4(n),Fo.radius+=r,!1===t.ray.intersectsSphere(Fo))return;Bo.copy(n).invert(),No.copy(t.ray).applyMatrix4(Bo);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o;if(i.isBufferGeometry){const r=i.index,o=i.attributes.position;if(null!==r){for(let i=Math.max(0,s.start),l=Math.min(r.count,s.start+s.count);i<l;i++){const s=r.getX(i);Uo.fromBufferAttribute(o,s),zo(Uo,s,a,n,t,e,this)}}else{for(let i=Math.max(0,s.start),r=Math.min(o.count,s.start+s.count);i<r;i++)Uo.fromBufferAttribute(o,i),zo(Uo,i,a,n,t,e,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function zo(t,e,i,n,r,s,o){const a=No.distanceSqToPoint(t);if(a<i){const i=new kt;No.closestPointToPoint(t,i),i.applyMatrix4(n);const l=r.ray.origin.distanceTo(i);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:i,index:e,face:null,object:o})}}Go.prototype.isPoints=!0;(class extends Bt{constructor(t,e,i,n,r,s,o,a,l){super(t,e,i,n,r,s,o,a,l),this.minFilter=void 0!==s?s:_,this.magFilter=void 0!==r?r:_,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){c.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!1==="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}).prototype.isVideoTexture=!0;(class extends Bt{constructor(t,e,i){super({width:t,height:e}),this.format=i,this.magFilter=g,this.minFilter=g,this.generateMipmaps=!1,this.needsUpdate=!0}}).prototype.isFramebufferTexture=!0;class ko extends Bt{constructor(t,e,i,n,r,s,o,a,l,c,h,u){super(null,s,o,a,l,c,n,r,h,u),this.image={width:e,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}ko.prototype.isCompressedTexture=!0;class jo extends Bt{constructor(t,e,i,n,r,s,o,a,l){super(t,e,i,n,r,s,o,a,l),this.needsUpdate=!0}}jo.prototype.isCanvasTexture=!0;class Ho extends yi{constructor(t=1,e=1,i=1,n=8,r=1,s=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a};const l=this;n=Math.floor(n),r=Math.floor(r);const c=[],h=[],u=[],d=[];let p=0;const f=[],m=i/2;let g=0;function v(i){const r=p,s=new _t,f=new kt;let v=0;const y=!0===i?t:e,_=!0===i?1:-1;for(let t=1;t<=n;t++)h.push(0,m*_,0),u.push(0,_,0),d.push(.5,.5),p++;const x=p;for(let t=0;t<=n;t++){const e=t/n*a+o,i=Math.cos(e),r=Math.sin(e);f.x=y*r,f.y=m*_,f.z=y*i,h.push(f.x,f.y,f.z),u.push(0,_,0),s.x=.5*i+.5,s.y=.5*r*_+.5,d.push(s.x,s.y),p++}for(let t=0;t<n;t++){const e=r+t,n=x+t;!0===i?c.push(n,n+1,e):c.push(n+1,n,e),v+=3}l.addGroup(g,v,!0===i?1:2),g+=v}!function(){const s=new kt,v=new kt;let y=0;const _=(e-t)/i;for(let l=0;l<=r;l++){const c=[],g=l/r,y=g*(e-t)+t;for(let t=0;t<=n;t++){const e=t/n,r=e*a+o,l=Math.sin(r),f=Math.cos(r);v.x=y*l,v.y=-g*i+m,v.z=y*f,h.push(v.x,v.y,v.z),s.set(l,_,f).normalize(),u.push(s.x,s.y,s.z),d.push(e,1-g),c.push(p++)}f.push(c)}for(let t=0;t<n;t++)for(let e=0;e<r;e++){const i=f[e][t],n=f[e+1][t],r=f[e+1][t+1],s=f[e][t+1];c.push(i,n,s),c.push(n,r,s),y+=6}l.addGroup(g,y,0),g+=y}(),!1===s&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new hi(h,3)),this.setAttribute("normal",new hi(u,3)),this.setAttribute("uv",new hi(d,2))}static fromJSON(t){return new Ho(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}const Vo=new kt,Wo=new kt,qo=new kt,Jo=new ti;class Xo extends yi{constructor(t=null,e=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:e},null!==t){const i=4,n=Math.pow(10,i),r=Math.cos(ct*e),s=t.getIndex(),o=t.getAttribute("position"),a=s?s.count:o.count,l=[0,0,0],c=["a","b","c"],h=new Array(3),u={},d=[];for(let t=0;t<a;t+=3){s?(l[0]=s.getX(t),l[1]=s.getX(t+1),l[2]=s.getX(t+2)):(l[0]=t,l[1]=t+1,l[2]=t+2);const{a:e,b:i,c:a}=Jo;if(e.fromBufferAttribute(o,l[0]),i.fromBufferAttribute(o,l[1]),a.fromBufferAttribute(o,l[2]),Jo.getNormal(qo),h[0]=`${Math.round(e.x*n)},${Math.round(e.y*n)},${Math.round(e.z*n)}`,h[1]=`${Math.round(i.x*n)},${Math.round(i.y*n)},${Math.round(i.z*n)}`,h[2]=`${Math.round(a.x*n)},${Math.round(a.y*n)},${Math.round(a.z*n)}`,h[0]!==h[1]&&h[1]!==h[2]&&h[2]!==h[0])for(let t=0;t<3;t++){const e=(t+1)%3,i=h[t],n=h[e],s=Jo[c[t]],o=Jo[c[e]],a=`${i}_${n}`,p=`${n}_${i}`;p in u&&u[p]?(qo.dot(u[p].normal)<=r&&(d.push(s.x,s.y,s.z),d.push(o.x,o.y,o.z)),u[p]=null):a in u||(u[a]={index0:l[t],index1:l[e],normal:qo.clone()})}}for(const t in u)if(u[t]){const{index0:e,index1:i}=u[t];Vo.fromBufferAttribute(o,e),Wo.fromBufferAttribute(o,i),d.push(Vo.x,Vo.y,Vo.z),d.push(Wo.x,Wo.y,Wo.z)}this.setAttribute("position",new hi(d,3))}}}class Yo{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return null}getPointAt(t,e){const i=this.getUtoTmapping(t);return this.getPoint(i,e)}getPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return e}getSpacedPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let i,n=this.getPoint(0),r=0;e.push(0);for(let s=1;s<=t;s++)i=this.getPoint(s/t),r+=i.distanceTo(n),e.push(r),n=i;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const i=this.getLengths();let n=0;const r=i.length;let s;s=e||t*i[r-1];let o,a=0,l=r-1;for(;a<=l;)if(n=Math.floor(a+(l-a)/2),o=i[n]-s,o<0)a=n+1;else{if(!(o>0)){l=n;break}l=n-1}if(n=l,i[n]===s)return n/(r-1);const c=i[n];return(n+(s-c)/(i[n+1]-c))/(r-1)}getTangent(t,e){const i=1e-4;let n=t-i,r=t+i;n<0&&(n=0),r>1&&(r=1);const s=this.getPoint(n),o=this.getPoint(r),a=e||(s.isVector2?new _t:new kt);return a.copy(o).sub(s).normalize(),a}getTangentAt(t,e){const i=this.getUtoTmapping(t);return this.getTangent(i,e)}computeFrenetFrames(t,e){const i=new kt,n=[],r=[],s=[],o=new kt,a=new ye;for(let e=0;e<=t;e++){const i=e/t;n[e]=this.getTangentAt(i,new kt)}r[0]=new kt,s[0]=new kt;let l=Number.MAX_VALUE;const c=Math.abs(n[0].x),h=Math.abs(n[0].y),u=Math.abs(n[0].z);c<=l&&(l=c,i.set(1,0,0)),h<=l&&(l=h,i.set(0,1,0)),u<=l&&i.set(0,0,1),o.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],o),s[0].crossVectors(n[0],r[0]);for(let e=1;e<=t;e++){if(r[e]=r[e-1].clone(),s[e]=s[e-1].clone(),o.crossVectors(n[e-1],n[e]),o.length()>Number.EPSILON){o.normalize();const t=Math.acos(dt(n[e-1].dot(n[e]),-1,1));r[e].applyMatrix4(a.makeRotationAxis(o,t))}s[e].crossVectors(n[e],r[e])}if(!0===e){let e=Math.acos(dt(r[0].dot(r[t]),-1,1));e/=t,n[0].dot(o.crossVectors(r[0],r[t]))>0&&(e=-e);for(let i=1;i<=t;i++)r[i].applyMatrix4(a.makeRotationAxis(n[i],e*i)),s[i].crossVectors(n[i],r[i])}return{tangents:n,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class Zo extends Yo{constructor(t=0,e=0,i=1,n=1,r=0,s=2*Math.PI,o=!1,a=0){super(),this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=o,this.aRotation=a}getPoint(t,e){const i=e||new _t,n=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=s?0:n),!0!==this.aClockwise||s||(r===n?r=-n:r-=n);const o=this.aStartAngle+t*r;let a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),i=a-this.aX,n=l-this.aY;a=i*t-n*e+this.aX,l=i*e+n*t+this.aY}return i.set(a,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}Zo.prototype.isEllipseCurve=!0;class Ko extends Zo{constructor(t,e,i,n,r,s){super(t,e,i,i,n,r,s),this.type="ArcCurve"}}function Qo(){let t=0,e=0,i=0,n=0;function r(r,s,o,a){t=r,e=o,i=-3*r+3*s-2*o-a,n=2*r-2*s+o+a}return{initCatmullRom:function(t,e,i,n,s){r(e,i,s*(i-t),s*(n-e))},initNonuniformCatmullRom:function(t,e,i,n,s,o,a){let l=(e-t)/s-(i-t)/(s+o)+(i-e)/o,c=(i-e)/o-(n-e)/(o+a)+(n-i)/a;l*=o,c*=o,r(e,i,l,c)},calc:function(r){const s=r*r;return t+e*r+i*s+n*(s*r)}}}Ko.prototype.isArcCurve=!0;const $o=new kt,ta=new Qo,ea=new Qo,ia=new Qo;class na extends Yo{constructor(t=[],e=!1,i="centripetal",n=.5){super(),this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=i,this.tension=n}getPoint(t,e=new kt){const i=e,n=this.points,r=n.length,s=(r-(this.closed?0:1))*t;let o,a,l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===c&&l===r-1&&(l=r-2,c=1),this.closed||l>0?o=n[(l-1)%r]:($o.subVectors(n[0],n[1]).add(n[0]),o=$o);const h=n[l%r],u=n[(l+1)%r];if(this.closed||l+2<r?a=n[(l+2)%r]:($o.subVectors(n[r-1],n[r-2]).add(n[r-1]),a=$o),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(o.distanceToSquared(h),t),i=Math.pow(h.distanceToSquared(u),t),n=Math.pow(u.distanceToSquared(a),t);i<1e-4&&(i=1),e<1e-4&&(e=i),n<1e-4&&(n=i),ta.initNonuniformCatmullRom(o.x,h.x,u.x,a.x,e,i,n),ea.initNonuniformCatmullRom(o.y,h.y,u.y,a.y,e,i,n),ia.initNonuniformCatmullRom(o.z,h.z,u.z,a.z,e,i,n)}else"catmullrom"===this.curveType&&(ta.initCatmullRom(o.x,h.x,u.x,a.x,this.tension),ea.initCatmullRom(o.y,h.y,u.y,a.y,this.tension),ia.initCatmullRom(o.z,h.z,u.z,a.z,this.tension));return i.set(ta.calc(c),ea.calc(c),ia.calc(c)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new kt).fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function ra(t,e,i,n,r){const s=.5*(n-e),o=.5*(r-i),a=t*t;return(2*i-2*n+s+o)*(t*a)+(-3*i+3*n-2*s-o)*a+s*t+i}function sa(t,e,i,n){return function(t,e){const i=1-t;return i*i*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,i)+function(t,e){return t*t*e}(t,n)}function oa(t,e,i,n,r){return function(t,e){const i=1-t;return i*i*i*e}(t,e)+function(t,e){const i=1-t;return 3*i*i*t*e}(t,i)+function(t,e){return 3*(1-t)*t*t*e}(t,n)+function(t,e){return t*t*t*e}(t,r)}na.prototype.isCatmullRomCurve3=!0;class aa extends Yo{constructor(t=new _t,e=new _t,i=new _t,n=new _t){super(),this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new _t){const i=e,n=this.v0,r=this.v1,s=this.v2,o=this.v3;return i.set(oa(t,n.x,r.x,s.x,o.x),oa(t,n.y,r.y,s.y,o.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}aa.prototype.isCubicBezierCurve=!0;class la extends Yo{constructor(t=new kt,e=new kt,i=new kt,n=new kt){super(),this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new kt){const i=e,n=this.v0,r=this.v1,s=this.v2,o=this.v3;return i.set(oa(t,n.x,r.x,s.x,o.x),oa(t,n.y,r.y,s.y,o.y),oa(t,n.z,r.z,s.z,o.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}la.prototype.isCubicBezierCurve3=!0;class ca extends Yo{constructor(t=new _t,e=new _t){super(),this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new _t){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){const i=e||new _t;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}ca.prototype.isLineCurve=!0;class ha extends Yo{constructor(t=new _t,e=new _t,i=new _t){super(),this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new _t){const i=e,n=this.v0,r=this.v1,s=this.v2;return i.set(sa(t,n.x,r.x,s.x),sa(t,n.y,r.y,s.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}ha.prototype.isQuadraticBezierCurve=!0;class ua extends Yo{constructor(t=new kt,e=new kt,i=new kt){super(),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new kt){const i=e,n=this.v0,r=this.v1,s=this.v2;return i.set(sa(t,n.x,r.x,s.x),sa(t,n.y,r.y,s.y),sa(t,n.z,r.z,s.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}ua.prototype.isQuadraticBezierCurve3=!0;class da extends Yo{constructor(t=[]){super(),this.type="SplineCurve",this.points=t}getPoint(t,e=new _t){const i=e,n=this.points,r=(n.length-1)*t,s=Math.floor(r),o=r-s,a=n[0===s?s:s-1],l=n[s],c=n[s>n.length-2?n.length-1:s+1],h=n[s>n.length-3?n.length-1:s+2];return i.set(ra(o,a.x,l.x,c.x,h.x),ra(o,a.y,l.y,c.y,h.y)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new _t).fromArray(i))}return this}}da.prototype.isSplineCurve=!0;var pa=Object.freeze({__proto__:null,ArcCurve:Ko,CatmullRomCurve3:na,CubicBezierCurve:aa,CubicBezierCurve3:la,EllipseCurve:Zo,LineCurve:ca,LineCurve3:class extends Yo{constructor(t=new kt,e=new kt){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=t,this.v2=e}getPoint(t,e=new kt){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},QuadraticBezierCurve:ha,QuadraticBezierCurve3:ua,SplineCurve:da});class fa extends Yo{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new ca(e,t))}getPoint(t,e){const i=t*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=i){const t=n[r]-i,s=this.curves[r],o=s.getLength(),a=0===o?0:1-t/o;return s.getPointAt(a,e)}r++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let i=0,n=this.curves.length;i<n;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let i;for(let n=0,r=this.curves;n<r.length;n++){const s=r[n],o=s.isEllipseCurve?2*t:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?t*s.points.length:t,a=s.getPoints(o);for(let t=0;t<a.length;t++){const n=a[t];i&&i.equals(n)||(e.push(n),i=n)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,i=this.curves.length;e<i;e++){const i=this.curves[e];t.curves.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push((new pa[i.type]).fromJSON(i))}return this}}class ma extends fa{constructor(t){super(),this.type="Path",this.currentPoint=new _t,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const i=new ca(this.currentPoint.clone(),new _t(t,e));return this.curves.push(i),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,i,n){const r=new ha(this.currentPoint.clone(),new _t(t,e),new _t(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this}bezierCurveTo(t,e,i,n,r,s){const o=new aa(this.currentPoint.clone(),new _t(t,e),new _t(i,n),new _t(r,s));return this.curves.push(o),this.currentPoint.set(r,s),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),i=new da(e);return this.curves.push(i),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,i,n,r,s){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+o,e+a,i,n,r,s),this}absarc(t,e,i,n,r,s){return this.absellipse(t,e,i,i,n,r,s),this}ellipse(t,e,i,n,r,s,o,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,e+c,i,n,r,s,o,a),this}absellipse(t,e,i,n,r,s,o,a){const l=new Zo(t,e,i,n,r,s,o,a);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class ga extends ma{constructor(t){super(t),this.uuid=ut(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let i=0,n=this.holes.length;i<n;i++)e[i]=this.holes[i].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,i=this.holes.length;e<i;e++){const i=this.holes[e];t.holes.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push((new ma).fromJSON(i))}return this}}const va=function(t,e,i=2){const n=e&&e.length,r=n?e[0]*i:t.length;let s=ya(t,0,r,i,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,c,h,u,d,p;if(n&&(s=function(t,e,i,n){const r=[];let s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*n,l=s<o-1?e[s+1]*n:t.length,c=ya(t,a,l,n,!1),c===c.next&&(c.steiner=!0),r.push(Oa(c));for(r.sort(Ta),s=0;s<r.length;s++)Aa(r[s],i),i=_a(i,i.next);return i}(t,e,s,i)),t.length>80*i){a=c=t[0],l=h=t[1];for(let e=i;e<r;e+=i)u=t[e],d=t[e+1],u<a&&(a=u),d<l&&(l=d),u>c&&(c=u),d>h&&(h=d);p=Math.max(c-a,h-l),p=0!==p?1/p:0}return xa(s,o,i,a,l,p),o};function ya(t,e,i,n,r){let s,o;if(r===function(t,e,i,n){let r=0;for(let s=e,o=i-n;s<i;s+=n)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}(t,e,i,n)>0)for(s=e;s<i;s+=n)o=Ga(s,t[s],t[s+1],o);else for(s=i-n;s>=e;s-=n)o=Ga(s,t[s],t[s+1],o);return o&&La(o,o.next)&&(za(o),o=o.next),o}function _a(t,e){if(!t)return t;e||(e=t);let i,n=t;do{if(i=!1,n.steiner||!La(n,n.next)&&0!==Da(n.prev,n,n.next))n=n.next;else{if(za(n),n=e=n.prev,n===n.next)break;i=!0}}while(i||n!==e);return e}function xa(t,e,i,n,r,s,o){if(!t)return;!o&&s&&function(t,e,i,n){let r=t;do{null===r.z&&(r.z=Ca(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,i,n,r,s,o,a,l,c=1;do{for(i=t,t=null,s=null,o=0;i;){for(o++,n=i,a=0,e=0;e<c&&(a++,n=n.nextZ,n);e++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}s.nextZ=null,c*=2}while(o>1)}(r)}(t,n,r,s);let a,l,c=t;for(;t.prev!==t.next;)if(a=t.prev,l=t.next,s?ba(t,n,r,s):Ma(t))e.push(a.i/i),e.push(t.i/i),e.push(l.i/i),za(t),t=l.next,c=l.next;else if((t=l)===c){o?1===o?xa(t=wa(_a(t),e,i),e,i,n,r,s,2):2===o&&Sa(t,e,i,n,r,s):xa(_a(t),e,i,n,r,s,1);break}}function Ma(t){const e=t.prev,i=t,n=t.next;if(Da(e,i,n)>=0)return!1;let r=t.next.next;for(;r!==t.prev;){if(Pa(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&Da(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function ba(t,e,i,n){const r=t.prev,s=t,o=t.next;if(Da(r,s,o)>=0)return!1;const a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,l=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,c=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,h=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,u=Ca(a,l,e,i,n),d=Ca(c,h,e,i,n);let p=t.prevZ,f=t.nextZ;for(;p&&p.z>=u&&f&&f.z<=d;){if(p!==t.prev&&p!==t.next&&Pa(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&Da(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==t.prev&&f!==t.next&&Pa(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&Da(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=u;){if(p!==t.prev&&p!==t.next&&Pa(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&Da(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==t.prev&&f!==t.next&&Pa(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&Da(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function wa(t,e,i){let n=t;do{const r=n.prev,s=n.next.next;!La(r,s)&&Ra(r,n,n.next,s)&&Fa(r,s)&&Fa(s,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(s.i/i),za(n),za(n.next),n=t=s),n=n.next}while(n!==t);return _a(n)}function Sa(t,e,i,n,r,s){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&Ia(o,t)){let a=Ua(o,t);return o=_a(o,o.next),a=_a(a,a.next),xa(o,e,i,n,r,s),void xa(a,e,i,n,r,s)}t=t.next}o=o.next}while(o!==t)}function Ta(t,e){return t.x-e.x}function Aa(t,e){if(e=function(t,e){let i=e;const n=t.x,r=t.y;let s,o=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const t=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=n&&t>o){if(o=t,t===n){if(r===i.y)return i;if(r===i.next.y)return i.next}s=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!s)return null;if(n===o)return s;const a=s,l=s.x,c=s.y;let h,u=1/0;i=s;do{n>=i.x&&i.x>=l&&n!==i.x&&Pa(r<c?n:o,r,l,c,r<c?o:n,r,i.x,i.y)&&(h=Math.abs(r-i.y)/(n-i.x),Fa(i,t)&&(h<u||h===u&&(i.x>s.x||i.x===s.x&&Ea(s,i)))&&(s=i,u=h)),i=i.next}while(i!==a);return s}(t,e),e){const i=Ua(e,t);_a(e,e.next),_a(i,i.next)}}function Ea(t,e){return Da(t.prev,t,e.prev)<0&&Da(e.next,t,t.next)<0}function Ca(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Oa(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function Pa(t,e,i,n,r,s,o,a){return(r-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(n-a)-(i-o)*(e-a)>=0&&(i-o)*(s-a)-(r-o)*(n-a)>=0}function Ia(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&Ra(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(Fa(t,e)&&Fa(e,t)&&function(t,e){let i=t,n=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(Da(t.prev,t,e.prev)||Da(t,e.prev,e))||La(t,e)&&Da(t.prev,t,t.next)>0&&Da(e.prev,e,e.next)>0)}function Da(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function La(t,e){return t.x===e.x&&t.y===e.y}function Ra(t,e,i,n){const r=Na(Da(t,e,i)),s=Na(Da(t,e,n)),o=Na(Da(i,n,t)),a=Na(Da(i,n,e));return r!==s&&o!==a||(!(0!==r||!Ba(t,i,e))||(!(0!==s||!Ba(t,n,e))||(!(0!==o||!Ba(i,t,n))||!(0!==a||!Ba(i,e,n)))))}function Ba(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function Na(t){return t>0?1:t<0?-1:0}function Fa(t,e){return Da(t.prev,t,t.next)<0?Da(t,e,t.next)>=0&&Da(t,t.prev,e)>=0:Da(t,e,t.prev)<0||Da(t,t.next,e)<0}function Ua(t,e){const i=new ka(t.i,t.x,t.y),n=new ka(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function Ga(t,e,i,n){const r=new ka(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function za(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function ka(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class ja{static area(t){const e=t.length;let i=0;for(let n=e-1,r=0;r<e;n=r++)i+=t[n].x*t[r].y-t[r].x*t[n].y;return.5*i}static isClockWise(t){return ja.area(t)<0}static triangulateShape(t,e){const i=[],n=[],r=[];Ha(t),Va(i,t);let s=t.length;e.forEach(Ha);for(let t=0;t<e.length;t++)n.push(s),s+=e[t].length,Va(i,e[t]);const o=va(i,n);for(let t=0;t<o.length;t+=3)r.push(o.slice(t,t+3));return r}}function Ha(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function Va(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}class Wa extends yi{constructor(t=new ga([new _t(.5,.5),new _t(-.5,.5),new _t(-.5,-.5),new _t(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const i=this,n=[],r=[];for(let e=0,i=t.length;e<i;e++){s(t[e])}function s(t){const s=[],o=void 0!==e.curveSegments?e.curveSegments:12,a=void 0!==e.steps?e.steps:1;let l=void 0!==e.depth?e.depth:1,c=void 0===e.bevelEnabled||e.bevelEnabled,h=void 0!==e.bevelThickness?e.bevelThickness:.2,u=void 0!==e.bevelSize?e.bevelSize:h-.1,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3;const f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:qa;void 0!==e.amount&&(l=e.amount);let g,v,y,_,x,M=!1;f&&(g=f.getSpacedPoints(a),M=!0,c=!1,v=f.computeFrenetFrames(a,!1),y=new kt,_=new kt,x=new kt),c||(p=0,h=0,u=0,d=0);const b=t.extractPoints(o);let w=b.shape;const S=b.holes;if(!ja.isClockWise(w)){w=w.reverse();for(let t=0,e=S.length;t<e;t++){const e=S[t];ja.isClockWise(e)&&(S[t]=e.reverse())}}const T=ja.triangulateShape(w,S),A=w;for(let t=0,e=S.length;t<e;t++){const e=S[t];w=w.concat(e)}function E(t,e,i){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(i).add(t)}const C=w.length,O=T.length;function P(t,e,i){let n,r,s;const o=t.x-e.x,a=t.y-e.y,l=i.x-t.x,c=i.y-t.y,h=o*o+a*a,u=o*c-a*l;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(h),d=Math.sqrt(l*l+c*c),p=e.x-a/u,f=e.y+o/u,m=((i.x-c/d-p)*c-(i.y+l/d-f)*l)/(o*c-a*l);n=p+o*m-t.x,r=f+a*m-t.y;const g=n*n+r*r;if(g<=2)return new _t(n,r);s=Math.sqrt(g/2)}else{let t=!1;o>Number.EPSILON?l>Number.EPSILON&&(t=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(a)===Math.sign(c)&&(t=!0),t?(n=-a,r=o,s=Math.sqrt(h)):(n=o,r=a,s=Math.sqrt(h/2))}return new _t(n/s,r/s)}const I=[];for(let t=0,e=A.length,i=e-1,n=t+1;t<e;t++,i++,n++)i===e&&(i=0),n===e&&(n=0),I[t]=P(A[t],A[i],A[n]);const D=[];let L,R=I.concat();for(let t=0,e=S.length;t<e;t++){const e=S[t];L=[];for(let t=0,i=e.length,n=i-1,r=t+1;t<i;t++,n++,r++)n===i&&(n=0),r===i&&(r=0),L[t]=P(e[t],e[n],e[r]);D.push(L),R=R.concat(L)}for(let t=0;t<p;t++){const e=t/p,i=h*Math.cos(e*Math.PI/2),n=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=A.length;t<e;t++){const e=E(A[t],I[t],n);F(e.x,e.y,-i)}for(let t=0,e=S.length;t<e;t++){const e=S[t];L=D[t];for(let t=0,r=e.length;t<r;t++){const r=E(e[t],L[t],n);F(r.x,r.y,-i)}}}const B=u+d;for(let t=0;t<C;t++){const e=c?E(w[t],R[t],B):w[t];M?(_.copy(v.normals[0]).multiplyScalar(e.x),y.copy(v.binormals[0]).multiplyScalar(e.y),x.copy(g[0]).add(_).add(y),F(x.x,x.y,x.z)):F(e.x,e.y,0)}for(let t=1;t<=a;t++)for(let e=0;e<C;e++){const i=c?E(w[e],R[e],B):w[e];M?(_.copy(v.normals[t]).multiplyScalar(i.x),y.copy(v.binormals[t]).multiplyScalar(i.y),x.copy(g[t]).add(_).add(y),F(x.x,x.y,x.z)):F(i.x,i.y,l/a*t)}for(let t=p-1;t>=0;t--){const e=t/p,i=h*Math.cos(e*Math.PI/2),n=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=A.length;t<e;t++){const e=E(A[t],I[t],n);F(e.x,e.y,l+i)}for(let t=0,e=S.length;t<e;t++){const e=S[t];L=D[t];for(let t=0,r=e.length;t<r;t++){const r=E(e[t],L[t],n);M?F(r.x,r.y+g[a-1].y,g[a-1].x+i):F(r.x,r.y,l+i)}}}function N(t,e){let i=t.length;for(;--i>=0;){const n=i;let r=i-1;r<0&&(r=t.length-1);for(let t=0,i=a+2*p;t<i;t++){const i=C*t,s=C*(t+1);G(e+n+i,e+r+i,e+r+s,e+n+s)}}}function F(t,e,i){s.push(t),s.push(e),s.push(i)}function U(t,e,r){z(t),z(e),z(r);const s=n.length/3,o=m.generateTopUV(i,n,s-3,s-2,s-1);k(o[0]),k(o[1]),k(o[2])}function G(t,e,r,s){z(t),z(e),z(s),z(e),z(r),z(s);const o=n.length/3,a=m.generateSideWallUV(i,n,o-6,o-3,o-2,o-1);k(a[0]),k(a[1]),k(a[3]),k(a[1]),k(a[2]),k(a[3])}function z(t){n.push(s[3*t+0]),n.push(s[3*t+1]),n.push(s[3*t+2])}function k(t){r.push(t.x),r.push(t.y)}!function(){const t=n.length/3;if(c){let t=0,e=C*t;for(let t=0;t<O;t++){const i=T[t];U(i[2]+e,i[1]+e,i[0]+e)}t=a+2*p,e=C*t;for(let t=0;t<O;t++){const i=T[t];U(i[0]+e,i[1]+e,i[2]+e)}}else{for(let t=0;t<O;t++){const e=T[t];U(e[2],e[1],e[0])}for(let t=0;t<O;t++){const e=T[t];U(e[0]+C*a,e[1]+C*a,e[2]+C*a)}}i.addGroup(t,n.length/3-t,0)}(),function(){const t=n.length/3;let e=0;N(A,e),e+=A.length;for(let t=0,i=S.length;t<i;t++){const i=S[t];N(i,e),e+=i.length}i.addGroup(t,n.length/3-t,1)}()}this.setAttribute("position",new hi(n,3)),this.setAttribute("uv",new hi(r,2)),this.computeVertexNormals()}toJSON(){const t=super.toJSON();return function(t,e,i){if(i.shapes=[],Array.isArray(t))for(let e=0,n=t.length;e<n;e++){const n=t[e];i.shapes.push(n.uuid)}else i.shapes.push(t.uuid);void 0!==e.extrudePath&&(i.options.extrudePath=e.extrudePath.toJSON());return i}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const i=[];for(let n=0,r=t.shapes.length;n<r;n++){const r=e[t.shapes[n]];i.push(r)}const n=t.options.extrudePath;return void 0!==n&&(t.options.extrudePath=(new pa[n.type]).fromJSON(n)),new Wa(i,t.options)}}const qa={generateTopUV:function(t,e,i,n,r){const s=e[3*i],o=e[3*i+1],a=e[3*n],l=e[3*n+1],c=e[3*r],h=e[3*r+1];return[new _t(s,o),new _t(a,l),new _t(c,h)]},generateSideWallUV:function(t,e,i,n,r,s){const o=e[3*i],a=e[3*i+1],l=e[3*i+2],c=e[3*n],h=e[3*n+1],u=e[3*n+2],d=e[3*r],p=e[3*r+1],f=e[3*r+2],m=e[3*s],g=e[3*s+1],v=e[3*s+2];return Math.abs(a-h)<Math.abs(o-c)?[new _t(o,1-l),new _t(c,1-u),new _t(d,1-f),new _t(m,1-v)]:[new _t(a,1-l),new _t(h,1-u),new _t(p,1-f),new _t(g,1-v)]}};class Ja extends yi{constructor(t=new ga([new _t(0,.5),new _t(-.5,-.5),new _t(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const i=[],n=[],r=[],s=[];let o=0,a=0;if(!1===Array.isArray(t))l(t);else for(let e=0;e<t.length;e++)l(t[e]),this.addGroup(o,a,e),o+=a,a=0;function l(t){const o=n.length/3,l=t.extractPoints(e);let c=l.shape;const h=l.holes;!1===ja.isClockWise(c)&&(c=c.reverse());for(let t=0,e=h.length;t<e;t++){const e=h[t];!0===ja.isClockWise(e)&&(h[t]=e.reverse())}const u=ja.triangulateShape(c,h);for(let t=0,e=h.length;t<e;t++){const e=h[t];c=c.concat(e)}for(let t=0,e=c.length;t<e;t++){const e=c[t];n.push(e.x,e.y,0),r.push(0,0,1),s.push(e.x,e.y)}for(let t=0,e=u.length;t<e;t++){const e=u[t],n=e[0]+o,r=e[1]+o,s=e[2]+o;i.push(n,r,s),a+=3}}this.setIndex(i),this.setAttribute("position",new hi(n,3)),this.setAttribute("normal",new hi(r,3)),this.setAttribute("uv",new hi(s,2))}toJSON(){const t=super.toJSON();return function(t,e){if(e.shapes=[],Array.isArray(t))for(let i=0,n=t.length;i<n;i++){const n=t[i];e.shapes.push(n.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(t,e){const i=[];for(let n=0,r=t.shapes.length;n<r;n++){const r=e[t.shapes[n]];i.push(r)}return new Ja(i,t.curveSegments)}}class Xa extends yi{constructor(t=1,e=32,i=16,n=0,r=2*Math.PI,s=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:r,thetaStart:s,thetaLength:o},e=Math.max(3,Math.floor(e)),i=Math.max(2,Math.floor(i));const a=Math.min(s+o,Math.PI);let l=0;const c=[],h=new kt,u=new kt,d=[],p=[],f=[],m=[];for(let d=0;d<=i;d++){const g=[],v=d/i;let y=0;0==d&&0==s?y=.5/e:d==i&&a==Math.PI&&(y=-.5/e);for(let i=0;i<=e;i++){const a=i/e;h.x=-t*Math.cos(n+a*r)*Math.sin(s+v*o),h.y=t*Math.cos(s+v*o),h.z=t*Math.sin(n+a*r)*Math.sin(s+v*o),p.push(h.x,h.y,h.z),u.copy(h).normalize(),f.push(u.x,u.y,u.z),m.push(a+y,1-v),g.push(l++)}c.push(g)}for(let t=0;t<i;t++)for(let n=0;n<e;n++){const e=c[t][n+1],r=c[t][n],o=c[t+1][n],l=c[t+1][n+1];(0!==t||s>0)&&d.push(e,r,l),(t!==i-1||a<Math.PI)&&d.push(r,o,l)}this.setIndex(d),this.setAttribute("position",new hi(p,3)),this.setAttribute("normal",new hi(f,3)),this.setAttribute("uv",new hi(m,2))}static fromJSON(t){return new Xa(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class Ya extends ii{constructor(t){super(),this.type="ShadowMaterial",this.color=new Ot(0),this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this}}Ya.prototype.isShadowMaterial=!0;class Za extends ji{constructor(t){super(t),this.type="RawShaderMaterial"}}Za.prototype.isRawShaderMaterial=!0;class Ka extends ii{constructor(t){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ot(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ot(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tt,this.normalScale=new _t(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}Ka.prototype.isMeshStandardMaterial=!0;class Qa extends Ka{constructor(t){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new _t(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return dt(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenColor=new Ot(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Ot(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Ot(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}Qa.prototype.isMeshPhysicalMaterial=!0;class $a extends ii{constructor(t){super(),this.type="MeshPhongMaterial",this.color=new Ot(16777215),this.specular=new Ot(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ot(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tt,this.normalScale=new _t(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}$a.prototype.isMeshPhongMaterial=!0;class tl extends ii{constructor(t){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ot(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ot(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tt,this.normalScale=new _t(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}tl.prototype.isMeshToonMaterial=!0;class el extends ii{constructor(t){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tt,this.normalScale=new _t(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}el.prototype.isMeshNormalMaterial=!0;class il extends ii{constructor(t){super(),this.type="MeshLambertMaterial",this.color=new Ot(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ot(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}il.prototype.isMeshLambertMaterial=!0;class nl extends ii{constructor(t){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ot(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tt,this.normalScale=new _t(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this}}nl.prototype.isMeshMatcapMaterial=!0;class rl extends wo{constructor(t){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}rl.prototype.isLineDashedMaterial=!0;const sl={ShadowMaterial:Ya,SpriteMaterial:Hs,RawShaderMaterial:Za,ShaderMaterial:ji,PointsMaterial:Ro,MeshPhysicalMaterial:Qa,MeshStandardMaterial:Ka,MeshPhongMaterial:$a,MeshToonMaterial:tl,MeshNormalMaterial:el,MeshLambertMaterial:il,MeshDepthMaterial:ws,MeshDistanceMaterial:Ss,MeshBasicMaterial:ni,MeshMatcapMaterial:nl,LineDashedMaterial:rl,LineBasicMaterial:wo,Material:ii};ii.fromType=function(t){return new sl[t]};const ol={arraySlice:function(t,e,i){return ol.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==i?i:t.length)):t.slice(e,i)},convertArray:function(t,e,i){return!t||!i&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){const e=t.length,i=new Array(e);for(let t=0;t!==e;++t)i[t]=t;return i.sort((function(e,i){return t[e]-t[i]})),i},sortedArray:function(t,e,i){const n=t.length,r=new t.constructor(n);for(let s=0,o=0;o!==n;++s){const n=i[s]*e;for(let i=0;i!==e;++i)r[o++]=t[n+i]}return r},flattenJSON:function(t,e,i,n){let r=1,s=t[0];for(;void 0!==s&&void 0===s[n];)s=t[r++];if(void 0===s)return;let o=s[n];if(void 0!==o)if(Array.isArray(o))do{o=s[n],void 0!==o&&(e.push(s.time),i.push.apply(i,o)),s=t[r++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[n],void 0!==o&&(e.push(s.time),o.toArray(i,i.length)),s=t[r++]}while(void 0!==s);else do{o=s[n],void 0!==o&&(e.push(s.time),i.push(o)),s=t[r++]}while(void 0!==s)},subclip:function(t,e,i,n,r=30){const s=t.clone();s.name=e;const o=[];for(let t=0;t<s.tracks.length;++t){const e=s.tracks[t],a=e.getValueSize(),l=[],c=[];for(let t=0;t<e.times.length;++t){const s=e.times[t]*r;if(!(s<i||s>=n)){l.push(e.times[t]);for(let i=0;i<a;++i)c.push(e.values[t*a+i])}}0!==l.length&&(e.times=ol.convertArray(l,e.times.constructor),e.values=ol.convertArray(c,e.values.constructor),o.push(e))}s.tracks=o;let a=1/0;for(let t=0;t<s.tracks.length;++t)a>s.tracks[t].times[0]&&(a=s.tracks[t].times[0]);for(let t=0;t<s.tracks.length;++t)s.tracks[t].shift(-1*a);return s.resetDuration(),s},makeClipAdditive:function(t,e=0,i=t,n=30){n<=0&&(n=30);const r=i.tracks.length,s=e/n;for(let e=0;e<r;++e){const n=i.tracks[e],r=n.ValueTypeName;if("bool"===r||"string"===r)continue;const o=t.tracks.find((function(t){return t.name===n.name&&t.ValueTypeName===r}));if(void 0===o)continue;let a=0;const l=n.getValueSize();n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let c=0;const h=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=h/3);const u=n.times.length-1;let d;if(s<=n.times[0]){const t=a,e=l-a;d=ol.arraySlice(n.values,t,e)}else if(s>=n.times[u]){const t=u*l+a,e=t+l-a;d=ol.arraySlice(n.values,t,e)}else{const t=n.createInterpolant(),e=a,i=l-a;t.evaluate(s),d=ol.arraySlice(t.resultBuffer,e,i)}if("quaternion"===r){(new zt).fromArray(d).normalize().conjugate().toArray(d)}const p=o.times.length;for(let t=0;t<p;++t){const e=t*h+c;if("quaternion"===r)zt.multiplyQuaternionsFlat(o.values,e,d,0,o.values,e);else{const t=h-2*c;for(let i=0;i<t;++i)o.values[e+i]-=d[i]}}}return t.blendMode=2501,t}};class al{constructor(t,e,i,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let i=this._cachedIndex,n=e[i],r=e[i-1];t:{e:{let s;i:{n:if(!(t<n)){for(let s=i+2;;){if(void 0===n){if(t<r)break n;return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,t,r)}if(i===s)break;if(r=n,n=e[++i],t<n)break e}s=e.length;break i}if(t>=r)break t;{const o=e[1];t<o&&(i=2,r=o);for(let s=i-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(i===s)break;if(n=r,r=e[--i-1],t>=r)break e}s=i,i=0}}for(;i<s;){const n=i+s>>>1;t<e[n]?s=n:i=n+1}if(n=e[i],r=e[i-1],void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(void 0===n)return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,r,t)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,t,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=t*n;for(let t=0;t!==n;++t)e[t]=i[r+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}al.prototype.beforeStart_=al.prototype.copySampleValue_,al.prototype.afterEnd_=al.prototype.copySampleValue_;class ll extends al{constructor(t,e,i,n){super(t,e,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:W,endingEnd:W}}intervalChanged_(t,e,i){const n=this.parameterPositions;let r=t-2,s=t+1,o=n[r],a=n[s];if(void 0===o)switch(this.getSettings_().endingStart){case q:r=t,o=2*e-i;break;case J:r=n.length-2,o=e+n[r]-n[r+1];break;default:r=t,o=i}if(void 0===a)switch(this.getSettings_().endingEnd){case q:s=t,a=2*i-e;break;case J:s=1,a=i+n[1]-n[0];break;default:s=t-1,a=e}const l=.5*(i-e),c=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(a-i),this._offsetPrev=r*c,this._offsetNext=s*c}interpolate_(t,e,i,n){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(i-e)/(n-e),f=p*p,m=f*p,g=-u*m+2*u*f-u*p,v=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,_=d*m-d*f;for(let t=0;t!==o;++t)r[t]=g*s[c+t]+v*s[l+t]+y*s[a+t]+_*s[h+t];return r}}class cl extends al{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=(i-e)/(n-e),h=1-c;for(let t=0;t!==o;++t)r[t]=s[l+t]*h+s[a+t]*c;return r}}class hl extends al{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t){return this.copySampleValue_(t-1)}}class ul{constructor(t,e,i,n){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=ol.convertArray(e,this.TimeBufferType),this.values=ol.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:ol.convertArray(t.times,Array),values:ol.convertArray(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(i.interpolation=e)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new hl(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new cl(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new ll(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case j:e=this.InterpolantFactoryMethodDiscrete;break;case H:e=this.InterpolantFactoryMethodLinear;break;case V:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return j;case this.InterpolantFactoryMethodLinear:return H;case this.InterpolantFactoryMethodSmooth:return V}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]*=t}return this}trim(t,e){const i=this.times,n=i.length;let r=0,s=n-1;for(;r!==n&&i[r]<t;)++r;for(;-1!==s&&i[s]>e;)--s;if(++s,0!==r||s!==n){r>=s&&(s=Math.max(s,1),r=s-1);const t=this.getValueSize();this.times=ol.arraySlice(i,r,s),this.values=ol.arraySlice(this.values,r*t,s*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,n=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let e=0;e!==r;e++){const n=i[e];if("number"==typeof n&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,n),t=!1;break}if(null!==s&&s>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,n,s),t=!1;break}s=n}if(void 0!==n&&ol.isTypedArray(n))for(let e=0,i=n.length;e!==i;++e){const i=n[e];if(isNaN(i)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,i),t=!1;break}}return t}optimize(){const t=ol.arraySlice(this.times),e=ol.arraySlice(this.values),i=this.getValueSize(),n=this.getInterpolation()===V,r=t.length-1;let s=1;for(let o=1;o<r;++o){let r=!1;const a=t[o];if(a!==t[o+1]&&(1!==o||a!==t[0]))if(n)r=!0;else{const t=o*i,n=t-i,s=t+i;for(let o=0;o!==i;++o){const i=e[t+o];if(i!==e[n+o]||i!==e[s+o]){r=!0;break}}}if(r){if(o!==s){t[s]=t[o];const n=o*i,r=s*i;for(let t=0;t!==i;++t)e[r+t]=e[n+t]}++s}}if(r>0){t[s]=t[r];for(let t=r*i,n=s*i,o=0;o!==i;++o)e[n+o]=e[t+o];++s}return s!==t.length?(this.times=ol.arraySlice(t,0,s),this.values=ol.arraySlice(e,0,s*i)):(this.times=t,this.values=e),this}clone(){const t=ol.arraySlice(this.times,0),e=ol.arraySlice(this.values,0),i=new(0,this.constructor)(this.name,t,e);return i.createInterpolant=this.createInterpolant,i}}ul.prototype.TimeBufferType=Float32Array,ul.prototype.ValueBufferType=Float32Array,ul.prototype.DefaultInterpolation=H;class dl extends ul{}dl.prototype.ValueTypeName="bool",dl.prototype.ValueBufferType=Array,dl.prototype.DefaultInterpolation=j,dl.prototype.InterpolantFactoryMethodLinear=void 0,dl.prototype.InterpolantFactoryMethodSmooth=void 0;class pl extends ul{}pl.prototype.ValueTypeName="color";class fl extends ul{}fl.prototype.ValueTypeName="number";class ml extends al{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(i-e)/(n-e);let l=t*o;for(let t=l+o;l!==t;l+=4)zt.slerpFlat(r,0,s,l-o,s,l,a);return r}}class gl extends ul{InterpolantFactoryMethodLinear(t){return new ml(this.times,this.values,this.getValueSize(),t)}}gl.prototype.ValueTypeName="quaternion",gl.prototype.DefaultInterpolation=H,gl.prototype.InterpolantFactoryMethodSmooth=void 0;class vl extends ul{}vl.prototype.ValueTypeName="string",vl.prototype.ValueBufferType=Array,vl.prototype.DefaultInterpolation=j,vl.prototype.InterpolantFactoryMethodLinear=void 0,vl.prototype.InterpolantFactoryMethodSmooth=void 0;class yl extends ul{}yl.prototype.ValueTypeName="vector";class _l{constructor(t,e=-1,i,n=2500){this.name=t,this.tracks=i,this.duration=e,this.blendMode=n,this.uuid=ut(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],i=t.tracks,n=1/(t.fps||1);for(let t=0,r=i.length;t!==r;++t)e.push(xl(i[t]).scale(n));const r=new this(t.name,t.duration,e,t.blendMode);return r.uuid=t.uuid,r}static toJSON(t){const e=[],i=t.tracks,n={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,n=i.length;t!==n;++t)e.push(ul.toJSON(i[t]));return n}static CreateFromMorphTargetSequence(t,e,i,n){const r=e.length,s=[];for(let t=0;t<r;t++){let o=[],a=[];o.push((t+r-1)%r,t,(t+1)%r),a.push(0,1,0);const l=ol.getKeyframeOrder(o);o=ol.sortedArray(o,1,l),a=ol.sortedArray(a,1,l),n||0!==o[0]||(o.push(r),a.push(a[0])),s.push(new fl(".morphTargetInfluences["+e[t].name+"]",o,a).scale(1/i))}return new this(t,-1,s)}static findByName(t,e){let i=t;if(!Array.isArray(t)){const e=t;i=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<i.length;t++)if(i[t].name===e)return i[t];return null}static CreateClipsFromMorphTargetSequences(t,e,i){const n={},r=/^([\w-]*?)([\d]+)$/;for(let e=0,i=t.length;e<i;e++){const i=t[e],s=i.name.match(r);if(s&&s.length>1){const t=s[1];let e=n[t];e||(n[t]=e=[]),e.push(i)}}const s=[];for(const t in n)s.push(this.CreateFromMorphTargetSequence(t,n[t],e,i));return s}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(t,e,i,n,r){if(0!==i.length){const s=[],o=[];ol.flattenJSON(i,s,o,n),0!==s.length&&r.push(new t(e,s,o))}},n=[],r=t.name||"default",s=t.fps||30,o=t.blendMode;let a=t.length||-1;const l=t.hierarchy||[];for(let t=0;t<l.length;t++){const r=l[t].keys;if(r&&0!==r.length)if(r[0].morphTargets){const t={};let e;for(e=0;e<r.length;e++)if(r[e].morphTargets)for(let i=0;i<r[e].morphTargets.length;i++)t[r[e].morphTargets[i]]=-1;for(const i in t){const t=[],s=[];for(let n=0;n!==r[e].morphTargets.length;++n){const n=r[e];t.push(n.time),s.push(n.morphTarget===i?1:0)}n.push(new fl(".morphTargetInfluence["+i+"]",t,s))}a=t.length*s}else{const s=".bones["+e[t].name+"]";i(yl,s+".position",r,"pos",n),i(gl,s+".quaternion",r,"rot",n),i(yl,s+".scale",r,"scl",n)}}if(0===n.length)return null;return new this(r,a,n,o)}resetDuration(){let t=0;for(let e=0,i=this.tracks.length;e!==i;++e){const i=this.tracks[e];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function xl(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return fl;case"vector":case"vector2":case"vector3":case"vector4":return yl;case"color":return pl;case"quaternion":return gl;case"bool":case"boolean":return dl;case"string":return vl}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],i=[];ol.flattenJSON(t.keys,e,i,"value"),t.times=e,t.values=i}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const Ml={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class bl{constructor(t,e,i){const n=this;let r,s=!1,o=0,a=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(t){a++,!1===s&&void 0!==n.onStart&&n.onStart(t,o,a),s=!0},this.itemEnd=function(t){o++,void 0!==n.onProgress&&n.onProgress(t,o,a),o===a&&(s=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)},this.resolveURL=function(t){return r?r(t):t},this.setURLModifier=function(t){return r=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,i=l.length;e<i;e+=2){const i=l[e],n=l[e+1];if(i.global&&(i.lastIndex=0),i.test(t))return n}return null}}}const wl=new bl;class Sl{constructor(t){this.manager=void 0!==t?t:wl,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise((function(n,r){i.load(t,n,e,r)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const Tl={};class Al extends Sl{constructor(t){super(t)}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=Ml.get(t);if(void 0!==r)return this.manager.itemStart(t),setTimeout((()=>{e&&e(r),this.manager.itemEnd(t)}),0),r;if(void 0!==Tl[t])return void Tl[t].push({onLoad:e,onProgress:i,onError:n});Tl[t]=[],Tl[t].push({onLoad:e,onProgress:i,onError:n});const s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,a=this.responseType;fetch(s).then((e=>{if(200===e.status||0===e.status){if(e.status,"undefined"==typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;const i=Tl[t],n=e.body.getReader(),r=e.headers.get("Content-Length"),s=r?parseInt(r):0,o=0!==s;let a=0;const l=new ReadableStream({start(t){!function e(){n.read().then((({done:n,value:r})=>{if(n)t.close();else{a+=r.byteLength;const n=new ProgressEvent("progress",{lengthComputable:o,loaded:a,total:s});for(let t=0,e=i.length;t<e;t++){const e=i[t];e.onProgress&&e.onProgress(n)}t.enqueue(r),e()}}))}()}});return new Response(l)}throw Error(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`)})).then((t=>{switch(a){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((t=>(new DOMParser).parseFromString(t,o)));case"json":return t.json();default:if(void 0===o)return t.text();{const e=/charset="?([^;"\s]*)"?/i.exec(o),i=e&&e[1]?e[1].toLowerCase():void 0,n=new TextDecoder(i);return t.arrayBuffer().then((t=>n.decode(t)))}}})).then((e=>{Ml.add(t,e);const i=Tl[t];delete Tl[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onLoad&&n.onLoad(e)}})).catch((e=>{const i=Tl[t];if(void 0===i)throw this.manager.itemError(t),e;delete Tl[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onError&&n.onError(e)}this.manager.itemError(t)})).finally((()=>{this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class El extends Sl{constructor(t){super(t)}load(t,e,i,n){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=Ml.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;const o=bt("img");function a(){c(),Ml.add(t,this),e&&e(this),r.manager.itemEnd(t)}function l(e){c(),n&&n(e),r.manager.itemError(t),r.manager.itemEnd(t)}function c(){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",a,!1),o.addEventListener("error",l,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(t),o.src=t,o}}class Cl extends Sl{constructor(t){super(t)}load(t,e,i,n){const r=new Ji,s=new El(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let o=0;function a(i){s.load(t[i],(function(t){r.images[i]=t,o++,6===o&&(r.needsUpdate=!0,e&&e(r))}),void 0,n)}for(let e=0;e<t.length;++e)a(e);return r}}class Ol extends Sl{constructor(t){super(t)}load(t,e,i,n){const r=new Bt,s=new El(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(t){r.image=t,r.needsUpdate=!0,void 0!==e&&e(r)}),i,n),r}}class Pl extends He{constructor(t,e=1){super(),this.type="Light",this.color=new Ot(t),this.intensity=e}dispose(){}copy(t){return super.copy(t),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}Pl.prototype.isLight=!0;class Il extends Pl{constructor(t,e,i){super(t,i),this.type="HemisphereLight",this.position.copy(He.DefaultUp),this.updateMatrix(),this.groundColor=new Ot(e)}copy(t){return Pl.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}Il.prototype.isHemisphereLight=!0;const Dl=new ye,Ll=new kt,Rl=new kt;class Bl{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new _t(512,512),this.map=null,this.mapPass=null,this.matrix=new ye,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new en,this._frameExtents=new _t(1,1),this._viewportCount=1,this._viewports=[new Nt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,i=this.matrix;Ll.setFromMatrixPosition(t.matrixWorld),e.position.copy(Ll),Rl.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(Rl),e.updateMatrixWorld(),Dl.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Dl),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(e.projectionMatrix),i.multiply(e.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class Nl extends Bl{constructor(){super(new Vi(50,1,.5,500)),this.focus=1}updateMatrices(t){const e=this.camera,i=2*ht*t.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;i===e.fov&&n===e.aspect&&r===e.far||(e.fov=i,e.aspect=n,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}Nl.prototype.isSpotLightShadow=!0;class Fl extends Pl{constructor(t,e,i=0,n=Math.PI/3,r=0,s=1){super(t,e),this.type="SpotLight",this.position.copy(He.DefaultUp),this.updateMatrix(),this.target=new He,this.distance=i,this.angle=n,this.penumbra=r,this.decay=s,this.shadow=new Nl}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}Fl.prototype.isSpotLight=!0;const Ul=new ye,Gl=new kt,zl=new kt;class kl extends Bl{constructor(){super(new Vi(90,1,.5,500)),this._frameExtents=new _t(4,2),this._viewportCount=6,this._viewports=[new Nt(2,1,1,1),new Nt(0,1,1,1),new Nt(3,1,1,1),new Nt(1,1,1,1),new Nt(3,0,1,1),new Nt(1,0,1,1)],this._cubeDirections=[new kt(1,0,0),new kt(-1,0,0),new kt(0,0,1),new kt(0,0,-1),new kt(0,1,0),new kt(0,-1,0)],this._cubeUps=[new kt(0,1,0),new kt(0,1,0),new kt(0,1,0),new kt(0,1,0),new kt(0,0,1),new kt(0,0,-1)]}updateMatrices(t,e=0){const i=this.camera,n=this.matrix,r=t.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),Gl.setFromMatrixPosition(t.matrixWorld),i.position.copy(Gl),zl.copy(i.position),zl.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(zl),i.updateMatrixWorld(),n.makeTranslation(-Gl.x,-Gl.y,-Gl.z),Ul.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ul)}}kl.prototype.isPointLightShadow=!0;class jl extends Pl{constructor(t,e,i=0,n=1){super(t,e),this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new kl}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}jl.prototype.isPointLight=!0;class Hl extends Bl{constructor(){super(new mn(-5,5,5,-5,.5,500))}}Hl.prototype.isDirectionalLightShadow=!0;class Vl extends Pl{constructor(t,e){super(t,e),this.type="DirectionalLight",this.position.copy(He.DefaultUp),this.updateMatrix(),this.target=new He,this.shadow=new Hl}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}Vl.prototype.isDirectionalLight=!0;class Wl extends Pl{constructor(t,e){super(t,e),this.type="AmbientLight"}}Wl.prototype.isAmbientLight=!0;class ql extends Pl{constructor(t,e,i=10,n=10){super(t,e),this.type="RectAreaLight",this.width=i,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}ql.prototype.isRectAreaLight=!0;class Jl{constructor(){this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new kt)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const i=t.x,n=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.282095),e.addScaledVector(s[1],.488603*n),e.addScaledVector(s[2],.488603*r),e.addScaledVector(s[3],.488603*i),e.addScaledVector(s[4],i*n*1.092548),e.addScaledVector(s[5],n*r*1.092548),e.addScaledVector(s[6],.315392*(3*r*r-1)),e.addScaledVector(s[7],i*r*1.092548),e.addScaledVector(s[8],.546274*(i*i-n*n)),e}getIrradianceAt(t,e){const i=t.x,n=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.886227),e.addScaledVector(s[1],1.023328*n),e.addScaledVector(s[2],1.023328*r),e.addScaledVector(s[3],1.023328*i),e.addScaledVector(s[4],.858086*i*n),e.addScaledVector(s[5],.858086*n*r),e.addScaledVector(s[6],.743125*r*r-.247708),e.addScaledVector(s[7],.858086*i*r),e.addScaledVector(s[8],.429043*(i*i-n*n)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(t.coefficients[i],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let i=0;i<9;i++)this.coefficients[i].lerp(t.coefficients[i],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].fromArray(t,e+3*n);return this}toArray(t=[],e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].toArray(t,e+3*n);return t}static getBasisAt(t,e){const i=t.x,n=t.y,r=t.z;e[0]=.282095,e[1]=.488603*n,e[2]=.488603*r,e[3]=.488603*i,e[4]=1.092548*i*n,e[5]=1.092548*n*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*i*r,e[8]=.546274*(i*i-n*n)}}Jl.prototype.isSphericalHarmonics3=!0;class Xl extends Pl{constructor(t=new Jl,e=1){super(void 0,e),this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}Xl.prototype.isLightProbe=!0;class Yl{static decodeText(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let i=0,n=t.length;i<n;i++)e+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(e))}catch(t){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1)}static resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class Zl extends yi{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const t=super.toJSON(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}Zl.prototype.isInstancedBufferGeometry=!0;class Kl extends Sl{constructor(t){super(t),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=Ml.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(t,o).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(i){Ml.add(t,i),e&&e(i),r.manager.itemEnd(t)})).catch((function(e){n&&n(e),r.manager.itemError(t),r.manager.itemEnd(t)})),r.manager.itemStart(t)}}let Ql;Kl.prototype.isImageBitmapLoader=!0;const $l=function(){return void 0===Ql&&(Ql=new(window.AudioContext||window.webkitAudioContext)),Ql};class tc extends Sl{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new Al(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(i){try{const t=i.slice(0);$l().decodeAudioData(t,(function(t){e(t)}))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}}),i,n)}}(class extends Xl{constructor(t,e,i=1){super(void 0,i);const n=(new Ot).set(t),r=(new Ot).set(e),s=new kt(n.r,n.g,n.b),o=new kt(r.r,r.g,r.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(o).multiplyScalar(a),this.sh.coefficients[1].copy(s).sub(o).multiplyScalar(l)}}).prototype.isHemisphereLightProbe=!0;(class extends Xl{constructor(t,e=1){super(void 0,e);const i=(new Ot).set(t);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}).prototype.isAmbientLightProbe=!0;class ec extends He{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return;if(!1===this.hasPlaybackControl)return;this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1!==this.hasPlaybackControl&&this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}class ic{constructor(t,e,i){let n,r,s;switch(this.binding=t,this.valueSize=i,e){case"quaternion":n=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const i=this.buffer,n=this.valueSize,r=t*n+n;let s=this.cumulativeWeight;if(0===s){for(let t=0;t!==n;++t)i[r+t]=i[t];s=e}else{s+=e;const t=e/s;this._mixBufferRegion(i,r,0,t,n)}this.cumulativeWeight=s}accumulateAdditive(t){const e=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,n,0,t,i),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,i=this.buffer,n=t*e+e,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const t=e*this._origIndex;this._mixBufferRegion(i,n,t,1-r,e)}s>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*e,1,e);for(let t=e,r=e+e;t!==r;++t)if(i[t]!==i[t+e]){o.setValue(i,n);break}}saveOriginalState(){const t=this.binding,e=this.buffer,i=this.valueSize,n=i*this._origIndex;t.getValue(e,n);for(let t=i,r=n;t!==r;++t)e[t]=e[n+t%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let i=t;i<e;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[e+i]=this.buffer[t+i]}_select(t,e,i,n,r){if(n>=.5)for(let n=0;n!==r;++n)t[e+n]=t[i+n]}_slerp(t,e,i,n){zt.slerpFlat(t,e,t,e,t,i,n)}_slerpAdditive(t,e,i,n,r){const s=this._workIndex*r;zt.multiplyQuaternionsFlat(t,s,t,e,t,i),zt.slerpFlat(t,e,t,e,t,s,n)}_lerp(t,e,i,n,r){const s=1-n;for(let o=0;o!==r;++o){const r=e+o;t[r]=t[r]*s+t[i+o]*n}}_lerpAdditive(t,e,i,n,r){for(let s=0;s!==r;++s){const r=e+s;t[r]=t[r]+t[i+s]*n}}}const nc="\\[\\]\\.:\\/",rc=new RegExp("[\\[\\]\\.:\\/]","g"),sc="[^\\[\\]\\.:\\/]",oc="[^"+nc.replace("\\.","")+"]",ac=/((?:WC+[\/:])*)/.source.replace("WC",sc),lc=/(WCOD+)?/.source.replace("WCOD",oc),cc=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",sc),hc=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",sc),uc=new RegExp("^"+ac+lc+cc+hc+"$"),dc=["material","materials","bones"];class pc{constructor(t,e,i){this.path=e,this.parsedPath=i||pc.parseTrackName(e),this.node=pc.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,i){return t&&t.isAnimationObjectGroup?new pc.Composite(t,e,i):new pc(t,e,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(rc,"")}static parseTrackName(t){const e=uc.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){const t=i.nodeName.substring(n+1);-1!==dc.indexOf(t)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=t)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(e);if(void 0!==i)return i}if(t.children){const i=function(t){for(let n=0;n<t.length;n++){const r=t[n];if(r.name===e||r.uuid===e)return r;const s=i(r.children);if(s)return s}return null},n=i(t.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)t[e++]=i[n]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,i=e.objectName,n=e.propertyName;let r=e.propertyIndex;if(t||(t=pc.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let n=e.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===n){n=e;break}break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==n){if(void 0===t[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[n]}}const s=t[n];if(void 0===s){const i=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+n+" but it wasn't found.",t)}let o=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}pc.Composite=class{constructor(t,e,i){const n=i||pc.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}getValue(t,e){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(t,e)}setValue(t,e){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}},pc.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},pc.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},pc.prototype.GetterByBindingType=[pc.prototype._getValue_direct,pc.prototype._getValue_array,pc.prototype._getValue_arrayElement,pc.prototype._getValue_toArray],pc.prototype.SetterByBindingTypeAndVersioning=[[pc.prototype._setValue_direct,pc.prototype._setValue_direct_setNeedsUpdate,pc.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[pc.prototype._setValue_array,pc.prototype._setValue_array_setNeedsUpdate,pc.prototype._setValue_array_setMatrixWorldNeedsUpdate],[pc.prototype._setValue_arrayElement,pc.prototype._setValue_arrayElement_setNeedsUpdate,pc.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[pc.prototype._setValue_fromArray,pc.prototype._setValue_fromArray_setNeedsUpdate,pc.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class fc{constructor(t,e,i=null,n=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=i,this.blendMode=n;const r=e.tracks,s=r.length,o=new Array(s),a={endingStart:W,endingEnd:W};for(let t=0;t!==s;++t){const e=r[t].createInterpolant(null);o[t]=e,e.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){const i=this._clip.duration,n=t._clip.duration,r=n/i,s=i/n;t.warp(1,r,e),this.warp(s,1,e)}return this}crossFadeTo(t,e,i){return t.crossFadeFrom(this,e,i)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,i){const n=this._mixer,r=n.time,s=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=r,a[1]=r+i,l[0]=t/s,l[1]=e/s,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,i,n){if(!this.enabled)return void this._updateWeight(t);const r=this._startTime;if(null!==r){const n=(t-r)*i;if(n<0||0===i)return;this._startTime=null,e=i*n}e*=this._updateTimeScale(t);const s=this._updateTime(e),o=this._updateWeight(t);if(o>0){const t=this._interpolants,e=this._propertyBindings;if(2501===this.blendMode)for(let i=0,n=t.length;i!==n;++i)t[i].evaluate(s),e[i].accumulateAdditive(o);else for(let i=0,r=t.length;i!==r;++i)t[i].evaluate(s),e[i].accumulate(n,o)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const i=this._weightInterpolant;if(null!==i){const n=i.evaluate(t)[0];e*=n,t>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const i=this._timeScaleInterpolant;if(null!==i){e*=i.evaluate(t)[0],t>i.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,i=this.loop;let n=this.time+t,r=this._loopCount;const s=2202===i;if(0===t)return-1===r?n:s&&1==(1&r)?e-n:n;if(2200===i){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(n>=e)n=e;else{if(!(n<0)){this.time=n;break t}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),n>=e||n<0){const i=Math.floor(n/e);n-=e*i,r+=Math.abs(i);const o=this.repetitions-r;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=t>0?e:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===o){const e=t<0;this._setEndings(e,!e,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=n;if(s&&1==(1&r))return e-n}return n}_setEndings(t,e,i){const n=this._interpolantSettings;i?(n.endingStart=q,n.endingEnd=q):(n.endingStart=t?this.zeroSlopeAtStart?q:W:J,n.endingEnd=e?this.zeroSlopeAtEnd?q:W:J)}_scheduleFading(t,e,i){const n=this._mixer,r=n.time;let s=this._weightInterpolant;null===s&&(s=n._lendControlInterpolant(),this._weightInterpolant=s);const o=s.parameterPositions,a=s.sampleValues;return o[0]=r,a[0]=e,o[1]=r+t,a[1]=i,this}}(class extends ot{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const i=t._localRoot||this._root,n=t._clip.tracks,r=n.length,s=t._propertyBindings,o=t._interpolants,a=i.uuid,l=this._bindingsByRootAndName;let c=l[a];void 0===c&&(c={},l[a]=c);for(let t=0;t!==r;++t){const r=n[t],l=r.name;let h=c[l];if(void 0!==h)++h.referenceCount,s[t]=h;else{if(h=s[t],void 0!==h){null===h._cacheIndex&&(++h.referenceCount,this._addInactiveBinding(h,a,l));continue}const n=e&&e._propertyBindings[t].binding.parsedPath;h=new ic(pc.create(i,l,n),r.ValueTypeName,r.getValueSize()),++h.referenceCount,this._addInactiveBinding(h,a,l),s[t]=h}o[t].resultBuffer=h.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,i=t._clip.uuid,n=this._actionsByClip[i];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,i,e)}const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,i){const n=this._actions,r=this._actionsByClip;let s=r[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=s;else{const e=s.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=n.length,n.push(t),s.actionByRoot[i]=t}_removeInactiveAction(t){const e=this._actions,i=e[e.length-1],n=t._cacheIndex;i._cacheIndex=n,e[n]=i,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,s=this._actionsByClip,o=s[r],a=o.knownActions,l=a[a.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),t._byClipCacheIndex=null;delete o.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete s[r],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.referenceCount&&this._removeInactiveBinding(i)}}_lendAction(t){const e=this._actions,i=t._cacheIndex,n=this._nActiveActions++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_takeBackAction(t){const e=this._actions,i=t._cacheIndex,n=--this._nActiveActions,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_addInactiveBinding(t,e,i){const n=this._bindingsByRootAndName,r=this._bindings;let s=n[e];void 0===s&&(s={},n[e]=s),s[i]=t,t._cacheIndex=r.length,r.push(t)}_removeInactiveBinding(t){const e=this._bindings,i=t.binding,n=i.rootNode.uuid,r=i.path,s=this._bindingsByRootAndName,o=s[n],a=e[e.length-1],l=t._cacheIndex;a._cacheIndex=l,e[l]=a,e.pop(),delete o[r],0===Object.keys(o).length&&delete s[n]}_lendBinding(t){const e=this._bindings,i=t._cacheIndex,n=this._nActiveBindings++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_takeBackBinding(t){const e=this._bindings,i=t._cacheIndex,n=--this._nActiveBindings,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let i=t[e];return void 0===i&&(i=new cl(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=e,t[e]=i),i}_takeBackControlInterpolant(t){const e=this._controlInterpolants,i=t.__cacheIndex,n=--this._nActiveControlInterpolants,r=e[n];t.__cacheIndex=n,e[n]=t,r.__cacheIndex=i,e[i]=r}clipAction(t,e,i){const n=e||this._root,r=n.uuid;let s="string"==typeof t?_l.findByName(n,t):t;const o=null!==s?s.uuid:t,a=this._actionsByClip[o];let l=null;if(void 0===i&&(i=null!==s?s.blendMode:X),void 0!==a){const t=a.actionByRoot[r];if(void 0!==t&&t.blendMode===i)return t;l=a.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const c=new fc(this,s,e,i);return this._bindAction(c,l),this._addInactiveAction(c,o,r),c}existingAction(t,e){const i=e||this._root,n=i.uuid,r="string"==typeof t?_l.findByName(i,t):t,s=r?r.uuid:t,o=this._actionsByClip[s];return void 0!==o&&o.actionByRoot[n]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,i=this._nActiveActions,n=this.time+=t,r=Math.sign(t),s=this._accuIndex^=1;for(let o=0;o!==i;++o){e[o]._update(n,t,r,s)}const o=this._bindings,a=this._nActiveBindings;for(let t=0;t!==a;++t)o[t].apply(s);return this}setTime(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,i=t.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){const t=r.knownActions;for(let i=0,n=t.length;i!==n;++i){const n=t[i];this._deactivateAction(n);const r=n._cacheIndex,s=e[e.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,s._cacheIndex=r,e[r]=s,e.pop(),this._removeInactiveBindingsForAction(n)}delete n[i]}}uncacheRoot(t){const e=t.uuid,i=this._actionsByClip;for(const t in i){const n=i[t].actionByRoot[e];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}const n=this._bindingsByRootAndName[e];if(void 0!==n)for(const t in n){const e=n[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(t,e){const i=this.existingAction(t,e);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}).prototype._controlInterpolantsResultBuffer=new Float32Array(1);class mc{constructor(t){"string"==typeof t&&(t=arguments[1]),this.value=t}clone(){return new mc(void 0===this.value.clone?this.value:this.value.clone())}}(class extends zs{constructor(t,e,i=1){super(t,e),this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}).prototype.isInstancedInterleavedBuffer=!0;class gc{constructor(t,e,i=0,n=1/0){this.ray=new ve(t,e),this.near=i,this.far=n,this.camera=null,this.layers=new Oe,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!0,i=[]){return yc(t,this,i,e),i.sort(vc),i}intersectObjects(t,e=!0,i=[]){for(let n=0,r=t.length;n<r;n++)yc(t[n],this,i,e);return i.sort(vc),i}}function vc(t,e){return t.distance-e.distance}function yc(t,e,i,n){if(t.layers.test(e.layers)&&t.raycast(e,i),!0===n){const n=t.children;for(let t=0,r=n.length;t<r;t++)yc(n[t],e,i,!0)}}const _c=new _t;class xc{constructor(t=new _t(1/0,1/0),e=new _t(-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=_c.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return _c.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}xc.prototype.isBox2=!0;const Mc=new kt;class bc extends He{constructor(t,e){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;const i=new yi,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,e=1,i=32;t<i;t++,e++){const r=t/i*Math.PI*2,s=e/i*Math.PI*2;n.push(Math.cos(r),Math.sin(r),1,Math.cos(s),Math.sin(s),1)}i.setAttribute("position",new hi(n,3));const r=new wo({fog:!1,toneMapped:!1});this.cone=new Do(i,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),Mc.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Mc),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const wc=new kt,Sc=new ye,Tc=new ye;function Ac(t){const e=[];!0===t.isBone&&e.push(t);for(let i=0;i<t.children.length;i++)e.push.apply(e,Ac(t.children[i]));return e}class Ec extends Do{constructor(t=10,e=10,i=4473924,n=8947848){i=new Ot(i),n=new Ot(n);const r=e/2,s=t/e,o=t/2,a=[],l=[];for(let t=0,c=0,h=-o;t<=e;t++,h+=s){a.push(-o,0,h,o,0,h),a.push(h,0,-o,h,0,o);const e=t===r?i:n;e.toArray(l,c),c+=3,e.toArray(l,c),c+=3,e.toArray(l,c),c+=3,e.toArray(l,c),c+=3}const c=new yi;c.setAttribute("position",new hi(a,3)),c.setAttribute("color",new hi(l,3));super(c,new wo({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}const Cc=new kt;let Oc,Pc;class Ic extends He{constructor(t=new kt(0,0,1),e=new kt(0,0,0),i=1,n=16776960,r=.2*i,s=.2*r){super(),this.type="ArrowHelper",void 0===Oc&&(Oc=new yi,Oc.setAttribute("position",new hi([0,0,0,0,1,0],3)),Pc=new Ho(0,.5,1,5,1),Pc.translate(0,-.5,0)),this.position.copy(e),this.line=new Oo(Oc,new wo({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ni(Pc,new ni({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(i,r,s)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{Cc.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(Cc,e)}}setLength(t,e=.2*t,i=.2*e){this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(i,e,i),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}}class Dc extends Do{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=new yi;i.setAttribute("position",new hi(e,3)),i.setAttribute("color",new hi([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(i,new wo({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(t,e,i){const n=new Ot,r=this.geometry.attributes.color.array;return n.set(t),n.toArray(r,0),n.toArray(r,3),n.set(e),n.toArray(r,6),n.toArray(r,9),n.set(i),n.toArray(r,12),n.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Lc{constructor(){this.type="ShapePath",this.color=new Ot,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new ma,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,i,n){return this.currentPath.quadraticCurveTo(t,e,i,n),this}bezierCurveTo(t,e,i,n,r,s){return this.currentPath.bezierCurveTo(t,e,i,n,r,s),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t,e){function i(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i],r=new ga;r.curves=n.curves,e.push(r)}return e}function n(t,e){const i=e.length;let n=!1;for(let r=i-1,s=0;s<i;r=s++){let i=e[r],o=e[s],a=o.x-i.x,l=o.y-i.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(i=e[s],a=-a,o=e[r],l=-l),t.y<i.y||t.y>o.y)continue;if(t.y===i.y){if(t.x===i.x)return!0}else{const e=l*(t.x-i.x)-a*(t.y-i.y);if(0===e)return!0;if(e<0)continue;n=!n}}else{if(t.y!==i.y)continue;if(o.x<=t.x&&t.x<=i.x||i.x<=t.x&&t.x<=o.x)return!0}}return n}const r=ja.isClockWise,s=this.subPaths;if(0===s.length)return[];if(!0===e)return i(s);let o,a,l;const c=[];if(1===s.length)return a=s[0],l=new ga,l.curves=a.curves,c.push(l),c;let h=!r(s[0].getPoints());h=t?!h:h;const u=[],d=[];let p,f,m=[],g=0;d[g]=void 0,m[g]=[];for(let e=0,i=s.length;e<i;e++)a=s[e],p=a.getPoints(),o=r(p),o=t?!o:o,o?(!h&&d[g]&&g++,d[g]={s:new ga,p},d[g].s.curves=a.curves,h&&g++,m[g]=[]):m[g].push({h:a,p:p[0]});if(!d[0])return i(s);if(d.length>1){let t=!1,e=0;for(let t=0,e=d.length;t<e;t++)u[t]=[];for(let i=0,r=d.length;i<r;i++){const r=m[i];for(let s=0;s<r.length;s++){const o=r[s];let a=!0;for(let r=0;r<d.length;r++)n(o.p,d[r].p)&&(i!==r&&e++,a?(a=!1,u[r].push(o)):t=!0);a&&u[i].push(o)}}e>0&&!1===t&&(m=u)}for(let t=0,e=d.length;t<e;t++){l=d[t].s,c.push(l),f=m[t];for(let t=0,e=f.length;t<e;t++)l.holes.push(f[t].h)}return c}}const Rc=new Float32Array(1);new Int32Array(Rc.buffer);Yo.create=function(t,e){return t.prototype=Object.create(Yo.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},ma.prototype.fromPoints=function(t){return this.setFromPoints(t)},Ec.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},class extends Do{constructor(t){const e=Ac(t),i=new yi,n=[],r=[],s=new Ot(0,0,1),o=new Ot(0,1,0);for(let t=0;t<e.length;t++){const i=e[t];i.parent&&i.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),r.push(s.r,s.g,s.b),r.push(o.r,o.g,o.b))}i.setAttribute("position",new hi(n,3)),i.setAttribute("color",new hi(r,3));super(i,new wo({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,i=this.geometry,n=i.getAttribute("position");Tc.copy(this.root.matrixWorld).invert();for(let t=0,i=0;t<e.length;t++){const r=e[t];r.parent&&r.parent.isBone&&(Sc.multiplyMatrices(Tc,r.matrixWorld),wc.setFromMatrixPosition(Sc),n.setXYZ(i,wc.x,wc.y,wc.z),Sc.multiplyMatrices(Tc,r.parent.matrixWorld),wc.setFromMatrixPosition(Sc),n.setXYZ(i+1,wc.x,wc.y,wc.z),i+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Sl.prototype.extractUrlBase=function(t){return Yl.extractUrlBase(t)},Sl.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},xc.prototype.center=function(t){return this.getCenter(t)},xc.prototype.empty=function(){return this.isEmpty()},xc.prototype.isIntersectionBox=function(t){return this.intersectsBox(t)},xc.prototype.size=function(t){return this.getSize(t)},Vt.prototype.center=function(t){return this.getCenter(t)},Vt.prototype.empty=function(){return this.isEmpty()},Vt.prototype.isIntersectionBox=function(t){return this.intersectsBox(t)},Vt.prototype.isIntersectionSphere=function(t){return this.intersectsSphere(t)},Vt.prototype.size=function(t){return this.getSize(t)},Ce.prototype.toVector3=function(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")},ce.prototype.empty=function(){return this.isEmpty()},en.prototype.setFromMatrix=function(t){return this.setFromProjectionMatrix(t)},xt.prototype.flattenToArrayOffset=function(t,e){return this.toArray(t,e)},xt.prototype.multiplyVector3=function(t){return t.applyMatrix3(this)},xt.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},xt.prototype.applyToBufferAttribute=function(t){return t.applyMatrix3(this)},xt.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},xt.prototype.getInverse=function(t){return this.copy(t).invert()},ye.prototype.extractPosition=function(t){return this.copyPosition(t)},ye.prototype.flattenToArrayOffset=function(t,e){return this.toArray(t,e)},ye.prototype.getPosition=function(){return(new kt).setFromMatrixColumn(this,3)},ye.prototype.setRotationFromQuaternion=function(t){return this.makeRotationFromQuaternion(t)},ye.prototype.multiplyToArray=function(){},ye.prototype.multiplyVector3=function(t){return t.applyMatrix4(this)},ye.prototype.multiplyVector4=function(t){return t.applyMatrix4(this)},ye.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},ye.prototype.rotateAxis=function(t){t.transformDirection(this)},ye.prototype.crossVector=function(t){return t.applyMatrix4(this)},ye.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},ye.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},ye.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},ye.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},ye.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},ye.prototype.applyToBufferAttribute=function(t){return t.applyMatrix4(this)},ye.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},ye.prototype.makeFrustum=function(t,e,i,n,r,s){return this.makePerspective(t,e,n,i,r,s)},ye.prototype.getInverse=function(t){return this.copy(t).invert()},Qi.prototype.isIntersectionLine=function(t){return this.intersectsLine(t)},zt.prototype.multiplyVector3=function(t){return t.applyQuaternion(this)},zt.prototype.inverse=function(){return this.invert()},ve.prototype.isIntersectionBox=function(t){return this.intersectsBox(t)},ve.prototype.isIntersectionPlane=function(t){return this.intersectsPlane(t)},ve.prototype.isIntersectionSphere=function(t){return this.intersectsSphere(t)},ti.prototype.area=function(){return this.getArea()},ti.prototype.barycoordFromPoint=function(t,e){return this.getBarycoord(t,e)},ti.prototype.midpoint=function(t){return this.getMidpoint(t)},ti.prototypenormal=function(t){return this.getNormal(t)},ti.prototype.plane=function(t){return this.getPlane(t)},ti.barycoordFromPoint=function(t,e,i,n,r){return ti.getBarycoord(t,e,i,n,r)},ti.normal=function(t,e,i,n){return ti.getNormal(t,e,i,n)},ga.prototype.extractAllPoints=function(t){return this.extractPoints(t)},ga.prototype.extrude=function(t){return new Wa(this,t)},ga.prototype.makeGeometry=function(t){return new Ja(this,t)},_t.prototype.fromAttribute=function(t,e,i){return this.fromBufferAttribute(t,e,i)},_t.prototype.distanceToManhattan=function(t){return this.manhattanDistanceTo(t)},_t.prototype.lengthManhattan=function(){return this.manhattanLength()},kt.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},kt.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},kt.prototype.getPositionFromMatrix=function(t){return this.setFromMatrixPosition(t)},kt.prototype.getScaleFromMatrix=function(t){return this.setFromMatrixScale(t)},kt.prototype.getColumnFromMatrix=function(t,e){return this.setFromMatrixColumn(e,t)},kt.prototype.applyProjection=function(t){return this.applyMatrix4(t)},kt.prototype.fromAttribute=function(t,e,i){return this.fromBufferAttribute(t,e,i)},kt.prototype.distanceToManhattan=function(t){return this.manhattanDistanceTo(t)},kt.prototype.lengthManhattan=function(){return this.manhattanLength()},Nt.prototype.fromAttribute=function(t,e,i){return this.fromBufferAttribute(t,e,i)},Nt.prototype.lengthManhattan=function(){return this.manhattanLength()},He.prototype.getChildByName=function(t){return this.getObjectByName(t)},He.prototype.renderDepth=function(){},He.prototype.translate=function(t,e){return this.translateOnAxis(e,t)},He.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},He.prototype.applyMatrix=function(t){return this.applyMatrix4(t)},Object.defineProperties(He.prototype,{eulerOrder:{get:function(){return this.rotation.order},set:function(t){this.rotation.order=t}},useQuaternion:{get:function(){},set:function(){}}}),Ni.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(Ni.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),Y},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),ho.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Vi.prototype.setLens=function(t,e){void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(Pl.prototype,{onlyShadow:{set:function(){}},shadowCameraFov:{set:function(t){this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){}},shadowBias:{set:function(t){this.shadow.bias=t}},shadowDarkness:{set:function(){}},shadowMapWidth:{set:function(t){this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){this.shadow.mapSize.height=t}}}),Object.defineProperties(oi.prototype,{length:{get:function(){return this.array.length}},dynamic:{get:function(){return this.usage===nt},set:function(){this.setUsage(nt)}}}),oi.prototype.setDynamic=function(t){return this.setUsage(!0===t?nt:it),this},oi.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},oi.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},yi.prototype.addIndex=function(t){this.setIndex(t)},yi.prototype.addAttribute=function(t,e){return e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(this.setIndex(e),this):this.setAttribute(t,e):this.setAttribute(t,new oi(arguments[1],arguments[2]))},yi.prototype.addDrawCall=function(t,e,i){this.addGroup(t,e)},yi.prototype.clearDrawCalls=function(){this.clearGroups()},yi.prototype.computeOffsets=function(){},yi.prototype.removeAttribute=function(t){return this.deleteAttribute(t)},yi.prototype.applyMatrix=function(t){return this.applyMatrix4(t)},Object.defineProperties(yi.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return this.groups}}}),zs.prototype.setDynamic=function(t){return this.setUsage(!0===t?nt:it),this},zs.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Wa.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},Wa.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},Wa.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},Gs.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},mc.prototype.onUpdate=function(){return this},Object.defineProperties(ii.prototype,{wrapAround:{get:function(){},set:function(){}},overdraw:{get:function(){},set:function(){}},wrapRGB:{get:function(){return new Ot}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){this.type,this.flatShading=1===t}},stencilMask:{get:function(){return this.type,this.stencilFuncMask},set:function(t){this.type,this.stencilFuncMask=t}},vertexTangents:{get:function(){this.type},set:function(){this.type}}}),Object.defineProperties(ji.prototype,{derivatives:{get:function(){return this.extensions.derivatives},set:function(t){this.extensions.derivatives=t}}}),Ns.prototype.clearTarget=function(t,e,i,n){this.setRenderTarget(t),this.clear(e,i,n)},Ns.prototype.animate=function(t){this.setAnimationLoop(t)},Ns.prototype.getCurrentRenderTarget=function(){return this.getRenderTarget()},Ns.prototype.getMaxAnisotropy=function(){return this.capabilities.getMaxAnisotropy()},Ns.prototype.getPrecision=function(){return this.capabilities.precision},Ns.prototype.resetGLState=function(){return this.state.reset()},Ns.prototype.supportsFloatTextures=function(){return this.extensions.get("OES_texture_float")},Ns.prototype.supportsHalfFloatTextures=function(){return this.extensions.get("OES_texture_half_float")},Ns.prototype.supportsStandardDerivatives=function(){return this.extensions.get("OES_standard_derivatives")},Ns.prototype.supportsCompressedTextureS3TC=function(){return this.extensions.get("WEBGL_compressed_texture_s3tc")},Ns.prototype.supportsCompressedTexturePVRTC=function(){return this.extensions.get("WEBGL_compressed_texture_pvrtc")},Ns.prototype.supportsBlendMinMax=function(){return this.extensions.get("EXT_blend_minmax")},Ns.prototype.supportsVertexTextures=function(){return this.capabilities.vertexTextures},Ns.prototype.supportsInstancedArrays=function(){return this.extensions.get("ANGLE_instanced_arrays")},Ns.prototype.enableScissorTest=function(t){this.setScissorTest(t)},Ns.prototype.initMaterial=function(){},Ns.prototype.addPrePlugin=function(){},Ns.prototype.addPostPlugin=function(){},Ns.prototype.updateShadowMap=function(){},Ns.prototype.setFaceCulling=function(){},Ns.prototype.allocTextureUnit=function(){},Ns.prototype.setTexture=function(){},Ns.prototype.setTexture2D=function(){},Ns.prototype.setTextureCube=function(){},Ns.prototype.getActiveMipMapLevel=function(){return this.getActiveMipmapLevel()},Object.defineProperties(Ns.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){this.shadowMap.type=t}},shadowMapCullFace:{get:function(){},set:function(){}},context:{get:function(){return this.getContext()}},vr:{get:function(){return this.xr}},gammaInput:{get:function(){return!1},set:function(){}},gammaOutput:{get:function(){return!1},set:function(t){this.outputEncoding=!0===t?$:Q}},toneMappingWhitePoint:{get:function(){return 1},set:function(){}},gammaFactor:{get:function(){return 2},set:function(){}}}),Object.defineProperties(Ts.prototype,{cullFace:{get:function(){},set:function(){}},renderReverseSided:{get:function(){},set:function(){}},renderSingleSided:{get:function(){},set:function(){}}}),Object.defineProperties(Ft.prototype,{wrapS:{get:function(){return this.texture.wrapS},set:function(t){this.texture.wrapS=t}},wrapT:{get:function(){return this.texture.wrapT},set:function(t){this.texture.wrapT=t}},magFilter:{get:function(){return this.texture.magFilter},set:function(t){this.texture.magFilter=t}},minFilter:{get:function(){return this.texture.minFilter},set:function(t){this.texture.minFilter=t}},anisotropy:{get:function(){return this.texture.anisotropy},set:function(t){this.texture.anisotropy=t}},offset:{get:function(){return this.texture.offset},set:function(t){this.texture.offset=t}},repeat:{get:function(){return this.texture.repeat},set:function(t){this.texture.repeat=t}},format:{get:function(){return this.texture.format},set:function(t){this.texture.format=t}},type:{get:function(){return this.texture.type},set:function(t){this.texture.type=t}},generateMipmaps:{get:function(){return this.texture.generateMipmaps},set:function(t){this.texture.generateMipmaps=t}}}),ec.prototype.load=function(t){const e=this;return(new tc).load(t,(function(t){e.setBuffer(t)})),this},qi.prototype.updateCubeMap=function(t,e){return this.update(t,e)},qi.prototype.clear=function(t,e,i,n){return this.renderTarget.clear(t,e,i,n)},It.crossOrigin=void 0,It.loadTexture=function(t,e,i,n){const r=new Ol;r.setCrossOrigin(this.crossOrigin);const s=r.load(t,i,void 0,n);return e&&(s.mapping=e),s},It.loadTextureCube=function(t,e,i,n){const r=new Cl;r.setCrossOrigin(this.crossOrigin);const s=r.load(t,i,void 0,n);return e&&(s.mapping=e),s},It.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},It.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:n}})),"undefined"!=typeof window&&(window.__THREE__||(window.__THREE__=n))},5079:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>r});var n=function(){var t=0,e=document.createElement("div");function i(t){return e.appendChild(t.dom),t}function r(i){for(var n=0;n<e.children.length;n++)e.children[n].style.display=n===i?"block":"none";t=i}e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",(function(i){i.preventDefault(),r(++t%e.children.length)}),!1);var s=(performance||Date).now(),o=s,a=0,l=i(new n.Panel("FPS","#0ff","#002")),c=i(new n.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=i(new n.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:e,addPanel:i,showPanel:r,begin:function(){s=(performance||Date).now()},end:function(){a++;var t=(performance||Date).now();if(c.update(t-s,200),t>=o+1e3&&(l.update(1e3*a/(t-o),100),o=t,a=0,h)){var e=performance.memory;h.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){s=this.end()},domElement:e,setMode:r}};n.Panel=function(t,e,i){var n=1/0,r=0,s=Math.round,o=s(window.devicePixelRatio||1),a=80*o,l=48*o,c=3*o,h=2*o,u=3*o,d=15*o,p=74*o,f=30*o,m=document.createElement("canvas");m.width=a,m.height=l,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*o+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=i,g.fillRect(0,0,a,l),g.fillStyle=e,g.fillText(t,c,h),g.fillRect(u,d,p,f),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(u,d,p,f),{dom:m,update:function(l,v){n=Math.min(n,l),r=Math.max(r,l),g.fillStyle=i,g.globalAlpha=1,g.fillRect(0,0,a,d),g.fillStyle=e,g.fillText(s(l)+" "+t+" ("+s(n)+"-"+s(r)+")",c,h),g.drawImage(m,u+o,d,p-o,f,u,d,p-o,f),g.fillRect(u+p-o,d,o,f),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(u+p-o,d,o,s((1-l/v)*f))}}};const r=n},1217:(t,e,i)=>{"use strict";i.r(e),i.d(e,{GLTFLoader:()=>r});var n=i(9477);class r extends n.aNw{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(t){return new c(t)})),this.register((function(t){return new m(t)})),this.register((function(t){return new g(t)})),this.register((function(t){return new h(t)})),this.register((function(t){return new u(t)})),this.register((function(t){return new d(t)})),this.register((function(t){return new p(t)})),this.register((function(t){return new f(t)})),this.register((function(t){return new a(t)})),this.register((function(t){return new v(t)}))}load(t,e,i,r){const s=this;let o;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:n.Zp0.extractUrlBase(t),this.manager.itemStart(t);const a=function(e){r?r(e):console.error(e),s.manager.itemError(t),s.manager.itemEnd(t)},l=new n.hH6(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(t,(function(i){try{s.parse(i,o,(function(i){e(i),s.manager.itemEnd(t)}),a)}catch(t){a(t)}}),i,a)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this}unregister(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,i,r){let s;const a={},c={};if("string"==typeof t)s=t;else{if(n.Zp0.decodeText(new Uint8Array(t,0,4))===y){try{a[o.KHR_BINARY_GLTF]=new M(t)}catch(t){return void(r&&r(t))}s=a[o.KHR_BINARY_GLTF].content}else s=n.Zp0.decodeText(new Uint8Array(t))}const h=JSON.parse(s);if(void 0===h.asset||h.asset.version[0]<2)return void(r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const u=new $(h,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(let t=0;t<this.pluginCallbacks.length;t++){const e=this.pluginCallbacks[t](u);c[e.name]=e,a[e.name]=!0}if(h.extensionsUsed)for(let t=0;t<h.extensionsUsed.length;++t){const e=h.extensionsUsed[t],i=h.extensionsRequired||[];switch(e){case o.KHR_MATERIALS_UNLIT:a[e]=new l;break;case o.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:a[e]=new T;break;case o.KHR_DRACO_MESH_COMPRESSION:a[e]=new b(h,this.dracoLoader);break;case o.KHR_TEXTURE_TRANSFORM:a[e]=new w;break;case o.KHR_MESH_QUANTIZATION:a[e]=new A;break;default:i.indexOf(e)>=0&&c[e]}}u.setExtensions(a),u.setPlugins(c),u.parse(i,r)}parseAsync(t,e){const i=this;return new Promise((function(n,r){i.parse(t,e,n,r)}))}}function s(){let t={};return{get:function(e){return t[e]},add:function(e,i){t[e]=i},remove:function(e){delete t[e]},removeAll:function(){t={}}}}const o={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class a{constructor(t){this.parser=t,this.name=o.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,e=this.parser.json.nodes||[];for(let i=0,n=e.length;i<n;i++){const n=e[i];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&t._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(t){const e=this.parser,i="light:"+t;let r=e.cache.get(i);if(r)return r;const s=e.json,o=((s.extensions&&s.extensions[this.name]||{}).lights||[])[t];let a;const l=new n.Ilk(16777215);void 0!==o.color&&l.fromArray(o.color);const c=void 0!==o.range?o.range:0;switch(o.type){case"directional":a=new n.Ox3(l),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new n.cek(l),a.distance=c;break;case"spot":a=new n.PMe(l),a.distance=c,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,a.angle=o.spot.outerConeAngle,a.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return a.position.set(0,0,0),a.decay=2,void 0!==o.intensity&&(a.intensity=o.intensity),a.name=e.createUniqueName(o.name||"light_"+t),r=Promise.resolve(a),e.cache.add(i,r),r}createNodeAttachment(t){const e=this,i=this.parser,n=i.json.nodes[t],r=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then((function(t){return i._getNodeRef(e.cache,r,t)}))}}class l{constructor(){this.name=o.KHR_MATERIALS_UNLIT}getMaterialType(){return n.vBJ}extendParams(t,e,i){const r=[];t.color=new n.Ilk(1,1,1),t.opacity=1;const s=e.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const e=s.baseColorFactor;t.color.fromArray(e),t.opacity=e[3]}void 0!==s.baseColorTexture&&r.push(i.assignTexture(t,"map",s.baseColorTexture))}return Promise.all(r)}}class c{constructor(t){this.parser=t,this.name=o.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?n.EJi:null}extendMaterialParams(t,e){const i=this.parser,r=i.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];if(void 0!==o.clearcoatFactor&&(e.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&s.push(i.assignTexture(e,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(e.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&s.push(i.assignTexture(e,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(s.push(i.assignTexture(e,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){const t=o.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new n.FM8(t,t)}return Promise.all(s)}}class h{constructor(t){this.parser=t,this.name=o.KHR_MATERIALS_SHEEN}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?n.EJi:null}extendMaterialParams(t,e){const i=this.parser,r=i.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[];e.sheenColor=new n.Ilk(0,0,0),e.sheenRoughness=0,e.sheen=1;const o=r.extensions[this.name];return void 0!==o.sheenColorFactor&&e.sheenColor.fromArray(o.sheenColorFactor),void 0!==o.sheenRoughnessFactor&&(e.sheenRoughness=o.sheenRoughnessFactor),void 0!==o.sheenColorTexture&&s.push(i.assignTexture(e,"sheenColorMap",o.sheenColorTexture)),void 0!==o.sheenRoughnessTexture&&s.push(i.assignTexture(e,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(s)}}class u{constructor(t){this.parser=t,this.name=o.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?n.EJi:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],s=n.extensions[this.name];return void 0!==s.transmissionFactor&&(e.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&r.push(i.assignTexture(e,"transmissionMap",s.transmissionTexture)),Promise.all(r)}}class d{constructor(t){this.parser=t,this.name=o.KHR_MATERIALS_VOLUME}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?n.EJi:null}extendMaterialParams(t,e){const i=this.parser,r=i.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];e.thickness=void 0!==o.thicknessFactor?o.thicknessFactor:0,void 0!==o.thicknessTexture&&s.push(i.assignTexture(e,"thicknessMap",o.thicknessTexture)),e.attenuationDistance=o.attenuationDistance||0;const a=o.attenuationColor||[1,1,1];return e.attenuationColor=new n.Ilk(a[0],a[1],a[2]),Promise.all(s)}}class p{constructor(t){this.parser=t,this.name=o.KHR_MATERIALS_IOR}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?n.EJi:null}extendMaterialParams(t,e){const i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=i.extensions[this.name];return e.ior=void 0!==n.ior?n.ior:1.5,Promise.resolve()}}class f{constructor(t){this.parser=t,this.name=o.KHR_MATERIALS_SPECULAR}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?n.EJi:null}extendMaterialParams(t,e){const i=this.parser,r=i.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];e.specularIntensity=void 0!==o.specularFactor?o.specularFactor:1,void 0!==o.specularTexture&&s.push(i.assignTexture(e,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return e.specularColor=new n.Ilk(a[0],a[1],a[2]),void 0!==o.specularColorTexture&&s.push(i.assignTexture(e,"specularColorMap",o.specularColorTexture).then((function(t){t.encoding=n.knz}))),Promise.all(s)}}class m{constructor(t){this.parser=t,this.name=o.KHR_TEXTURE_BASISU}loadTexture(t){const e=this.parser,i=e.json,n=i.textures[t];if(!n.extensions||!n.extensions[this.name])return null;const r=n.extensions[this.name],s=e.options.ktx2Loader;if(!s){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,r.source,s)}}class g{constructor(t){this.parser=t,this.name=o.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const e=this.name,i=this.parser,n=i.json,r=n.textures[t];if(!r.extensions||!r.extensions[e])return null;const s=r.extensions[e],o=n.images[s.source];let a=i.textureLoader;if(o.uri){const t=i.options.manager.getHandler(o.uri);null!==t&&(a=t)}return this.detectSupport().then((function(r){if(r)return i.loadTextureImage(t,o,a);if(n.extensionsRequired&&n.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(t)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(t){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(1===e.height)}}))),this.isSupported}}class v{constructor(t){this.name=o.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const e=this.parser.json,i=e.bufferViews[t];if(i.extensions&&i.extensions[this.name]){const t=i.extensions[this.name],n=this.parser.getDependency("buffer",t.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([n,r.ready]).then((function(e){const i=t.byteOffset||0,n=t.byteLength||0,s=t.count,o=t.byteStride,a=new ArrayBuffer(s*o),l=new Uint8Array(e[0],i,n);return r.decodeGltfBuffer(new Uint8Array(a),s,o,l,t.mode,t.filter),a}))}return null}}const y="glTF",_=1313821514,x=5130562;class M{constructor(t){this.name=o.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(t,0,12);if(this.header={magic:n.Zp0.decodeText(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==y)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-12,r=new DataView(t,12);let s=0;for(;s<i;){const e=r.getUint32(s,!0);s+=4;const i=r.getUint32(s,!0);if(s+=4,i===_){const i=new Uint8Array(t,12+s,e);this.content=n.Zp0.decodeText(i)}else if(i===x){const i=12+s;this.body=t.slice(i,i+e)}s+=e}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class b{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=o.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){const i=this.json,n=this.dracoLoader,r=t.extensions[this.name].bufferView,s=t.extensions[this.name].attributes,o={},a={},l={};for(const t in s){const e=k[t]||t.toLowerCase();o[e]=s[t]}for(const e in t.attributes){const n=k[e]||e.toLowerCase();if(void 0!==s[e]){const r=i.accessors[t.attributes[e]],s=F[r.componentType];l[n]=s,a[n]=!0===r.normalized}}return e.getDependency("bufferView",r).then((function(t){return new Promise((function(e){n.decodeDracoFile(t,(function(t){for(const e in t.attributes){const i=t.attributes[e],n=a[e];void 0!==n&&(i.normalized=n)}e(t)}),o,l)}))}))}}class w{constructor(){this.name=o.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return void 0!==e.texCoord&&this.name,void 0===e.offset&&void 0===e.rotation&&void 0===e.scale||(t=t.clone(),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}}class S extends n.Wid{constructor(t){super(),this.isGLTFSpecularGlossinessMaterial=!0;const e=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),i=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),r=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),s=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),a={specular:{value:(new n.Ilk).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(t){for(const e in a)t.uniforms[e]=a[e];t.fragmentShader=t.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",e).replace("#include <metalnessmap_pars_fragment>",i).replace("#include <roughnessmap_fragment>",r).replace("#include <metalnessmap_fragment>",s).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(t){a.specular.value=t}},specularMap:{get:function(){return a.specularMap.value},set:function(t){a.specularMap.value=t,t?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(t){a.glossiness.value=t}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(t){a.glossinessMap.value=t,t?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}copy(t){return super.copy(t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class T{constructor(){this.name=o.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return S}extendParams(t,e,i){const r=e.extensions[this.name];t.color=new n.Ilk(1,1,1),t.opacity=1;const s=[];if(Array.isArray(r.diffuseFactor)){const e=r.diffuseFactor;t.color.fromArray(e),t.opacity=e[3]}if(void 0!==r.diffuseTexture&&s.push(i.assignTexture(t,"map",r.diffuseTexture)),t.emissive=new n.Ilk(0,0,0),t.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,t.specular=new n.Ilk(1,1,1),Array.isArray(r.specularFactor)&&t.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){const e=r.specularGlossinessTexture;s.push(i.assignTexture(t,"glossinessMap",e)),s.push(i.assignTexture(t,"specularMap",e))}return Promise.all(s)}createMaterial(t){const e=new S(t);return e.fog=!0,e.color=t.color,e.map=void 0===t.map?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=void 0===t.aoMap?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=1,e.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,e.bumpMap=void 0===t.bumpMap?null:t.bumpMap,e.bumpScale=1,e.normalMap=void 0===t.normalMap?null:t.normalMap,e.normalMapType=n.IOt,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=void 0===t.specularMap?null:t.specularMap,e.specular=t.specular,e.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=void 0===t.envMap?null:t.envMap,e.envMapIntensity=1,e.refractionRatio=.98,e}}class A{constructor(){this.name=o.KHR_MESH_QUANTIZATION}}class E extends n._C8{constructor(t,e,i,n){super(t,e,i,n)}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=t*n*3+n;for(let t=0;t!==n;t++)e[t]=i[r+t];return e}}E.prototype.beforeStart_=E.prototype.copySampleValue_,E.prototype.afterEnd_=E.prototype.copySampleValue_,E.prototype.interpolate_=function(t,e,i,n){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=2*o,l=3*o,c=n-e,h=(i-e)/c,u=h*h,d=u*h,p=t*l,f=p-l,m=-2*d+3*u,g=d-u,v=1-m,y=g-u+h;for(let t=0;t!==o;t++){const e=s[f+t+o],i=s[f+t+a]*c,n=s[p+t+o],l=s[p+t]*c;r[t]=v*e+y*i+m*n+g*l}return r};const C=new n._fP;class O extends E{interpolate_(t,e,i,n){const r=super.interpolate_(t,e,i,n);return C.fromArray(r).normalize().toArray(r),r}}const P=0,I=1,D=2,L=3,R=4,B=5,N=6,F={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},U={9728:n.TyD,9729:n.wem,9984:n.YLQ,9985:n.qyh,9986:n.aH4,9987:n.D1R},G={33071:n.uWy,33648:n.OoA,10497:n.rpg},z={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},k={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},j={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},H={CUBICSPLINE:void 0,LINEAR:n.NMF,STEP:n.Syv},V="OPAQUE",W="MASK",q="BLEND";function J(t,e,i){for(const n in i.extensions)void 0===t[n]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=i.extensions[n])}function X(t,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(t.userData,e.extras):e.extras)}function Y(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(let i=0,n=e.weights.length;i<n;i++)t.morphTargetInfluences[i]=e.weights[i];if(e.extras&&Array.isArray(e.extras.targetNames)){const i=e.extras.targetNames;if(t.morphTargetInfluences.length===i.length){t.morphTargetDictionary={};for(let e=0,n=i.length;e<n;e++)t.morphTargetDictionary[i[e]]=e}}}function Z(t){const e=t.extensions&&t.extensions[o.KHR_DRACO_MESH_COMPRESSION];let i;return i=e?"draco:"+e.bufferView+":"+e.indices+":"+K(e.attributes):t.indices+":"+K(t.attributes)+":"+t.mode,i}function K(t){let e="";const i=Object.keys(t).sort();for(let n=0,r=i.length;n<r;n++)e+=i[n]+":"+t[i[n]]+";";return e}function Q(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class ${constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new s,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox|^((?!chrome|android).)*safari/i.test(navigator.userAgent)?this.textureLoader=new n.QRU(this.options.manager):this.textureLoader=new n.dpR(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new n.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){const i=this,n=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll((function(t){return t._markDefs&&t._markDefs()})),Promise.all(this._invokeAll((function(t){return t.beforeRoot&&t.beforeRoot()}))).then((function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])})).then((function(e){const s={scene:e[0][n.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:n.asset,parser:i,userData:{}};J(r,s,n),X(s,n),Promise.all(i._invokeAll((function(t){return t.afterRoot&&t.afterRoot(s)}))).then((function(){t(s)}))})).catch(e)}_markDefs(){const t=this.json.nodes||[],e=this.json.skins||[],i=this.json.meshes||[];for(let i=0,n=e.length;i<n;i++){const n=e[i].joints;for(let e=0,i=n.length;e<i;e++)t[n[e]].isBone=!0}for(let e=0,n=t.length;e<n;e++){const n=t[e];void 0!==n.mesh&&(this._addNodeRef(this.meshCache,n.mesh),void 0!==n.skin&&(i[n.mesh].isSkinnedMesh=!0)),void 0!==n.camera&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(t,e){void 0!==e&&(void 0===t.refs[e]&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,i){if(t.refs[e]<=1)return i;const n=i.clone(),r=(t,e)=>{const i=this.associations.get(t);null!=i&&this.associations.set(e,i);for(const[i,n]of t.children.entries())r(n,e.children[i])};return r(i,n),n.name+="_instance_"+t.uses[e]++,n}_invokeOne(t){const e=Object.values(this.plugins);e.push(this);for(let i=0;i<e.length;i++){const n=t(e[i]);if(n)return n}return null}_invokeAll(t){const e=Object.values(this.plugins);e.unshift(this);const i=[];for(let n=0;n<e.length;n++){const r=t(e[n]);r&&i.push(r)}return i}getDependency(t,e){const i=t+":"+e;let n=this.cache.get(i);if(!n){switch(t){case"scene":n=this.loadScene(e);break;case"node":n=this.loadNode(e);break;case"mesh":n=this._invokeOne((function(t){return t.loadMesh&&t.loadMesh(e)}));break;case"accessor":n=this.loadAccessor(e);break;case"bufferView":n=this._invokeOne((function(t){return t.loadBufferView&&t.loadBufferView(e)}));break;case"buffer":n=this.loadBuffer(e);break;case"material":n=this._invokeOne((function(t){return t.loadMaterial&&t.loadMaterial(e)}));break;case"texture":n=this._invokeOne((function(t){return t.loadTexture&&t.loadTexture(e)}));break;case"skin":n=this.loadSkin(e);break;case"animation":n=this.loadAnimation(e);break;case"camera":n=this.loadCamera(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(i,n)}return n}getDependencies(t){let e=this.cache.get(t);if(!e){const i=this,n=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(n.map((function(e,n){return i.getDependency(t,n)}))),this.cache.add(t,e)}return e}loadBuffer(t){const e=this.json.buffers[t],i=this.fileLoader;if(e.type&&"arraybuffer"!==e.type)throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(void 0===e.uri&&0===t)return Promise.resolve(this.extensions[o.KHR_BINARY_GLTF].body);const r=this.options;return new Promise((function(t,s){i.load(n.Zp0.resolveURL(e.uri,r.path),t,void 0,(function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))}))}))}loadBufferView(t){const e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then((function(t){const i=e.byteLength||0,n=e.byteOffset||0;return t.slice(n,n+i)}))}loadAccessor(t){const e=this,i=this.json,r=this.json.accessors[t];if(void 0===r.bufferView&&void 0===r.sparse)return Promise.resolve(null);const s=[];return void 0!==r.bufferView?s.push(this.getDependency("bufferView",r.bufferView)):s.push(null),void 0!==r.sparse&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then((function(t){const s=t[0],o=z[r.type],a=F[r.componentType],l=a.BYTES_PER_ELEMENT,c=l*o,h=r.byteOffset||0,u=void 0!==r.bufferView?i.bufferViews[r.bufferView].byteStride:void 0,d=!0===r.normalized;let p,f;if(u&&u!==c){const t=Math.floor(h/u),i="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+t+":"+r.count;let c=e.cache.get(i);c||(p=new a(s,t*u,r.count*u/l),c=new n.vpT(p,u/l),e.cache.add(i,c)),f=new n.kB5(c,o,h%u/l,d)}else p=null===s?new a(r.count*o):new a(s,h,r.count*o),f=new n.TlE(p,o,d);if(void 0!==r.sparse){const e=z.SCALAR,i=F[r.sparse.indices.componentType],l=r.sparse.indices.byteOffset||0,c=r.sparse.values.byteOffset||0,h=new i(t[1],l,r.sparse.count*e),u=new a(t[2],c,r.sparse.count*o);null!==s&&(f=new n.TlE(f.array.slice(),f.itemSize,f.normalized));for(let t=0,e=h.length;t<e;t++){const e=h[t];if(f.setX(e,u[t*o]),o>=2&&f.setY(e,u[t*o+1]),o>=3&&f.setZ(e,u[t*o+2]),o>=4&&f.setW(e,u[t*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return f}))}loadTexture(t){const e=this.json,i=this.options,n=e.textures[t].source,r=e.images[n];let s=this.textureLoader;if(r.uri){const t=i.manager.getHandler(r.uri);null!==t&&(s=t)}return this.loadTextureImage(t,n,s)}loadTextureImage(t,e,i){const r=this,s=this.json,o=s.textures[t],a=s.images[e],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(e,i).then((function(e){e.flipY=!1,o.name&&(e.name=o.name);const i=(s.samplers||{})[o.sampler]||{};return e.magFilter=U[i.magFilter]||n.wem,e.minFilter=U[i.minFilter]||n.D1R,e.wrapS=G[i.wrapS]||n.rpg,e.wrapT=G[i.wrapT]||n.rpg,r.associations.set(e,{textures:t}),e})).catch((function(){return null}));return this.textureCache[l]=c,c}loadImageSource(t,e){const i=this,r=this.json,s=this.options;if(void 0!==this.sourceCache[t])return this.sourceCache[t].then((function(t){return t.clone()})).catch((function(t){throw t}));const o=r.images[t],a=self.URL||self.webkitURL;let l=o.uri||"",c=!1;if(void 0!==o.bufferView)l=i.getDependency("bufferView",o.bufferView).then((function(t){c=!0;const e=new Blob([t],{type:o.mimeType});return l=a.createObjectURL(e),l}));else if(void 0===o.uri)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const h=Promise.resolve(l).then((function(t){return new Promise((function(i,r){let o=i;!0===e.isImageBitmapLoader&&(o=function(t){const e=new n.xEZ(t);e.needsUpdate=!0,i(e)}),e.load(n.Zp0.resolveURL(t,s.path),o,void 0,r)}))})).then((function(t){var e;return!0===c&&a.revokeObjectURL(l),t.userData.mimeType=o.mimeType||((e=o.uri).search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/)?"image/jpeg":e.search(/\.webp($|\?)/i)>0||0===e.search(/^data\:image\/webp/)?"image/webp":"image/png"),t})).catch((function(t){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),t}));return this.sourceCache[t]=h,h}assignTexture(t,e,i){const n=this;return this.getDependency("texture",i.index).then((function(r){if(void 0===i.texCoord||0==i.texCoord||"aoMap"===e&&1==i.texCoord||i.texCoord,n.extensions[o.KHR_TEXTURE_TRANSFORM]){const t=void 0!==i.extensions?i.extensions[o.KHR_TEXTURE_TRANSFORM]:void 0;if(t){const e=n.associations.get(r);r=n.extensions[o.KHR_TEXTURE_TRANSFORM].extendTexture(r,t),n.associations.set(r,e)}}return t[e]=r,r}))}assignFinalMaterial(t){const e=t.geometry;let i=t.material;const r=void 0===e.attributes.tangent,s=void 0!==e.attributes.color,o=void 0===e.attributes.normal;if(t.isPoints){const t="PointsMaterial:"+i.uuid;let e=this.cache.get(t);e||(e=new n.UY4,n.F5T.prototype.copy.call(e,i),e.color.copy(i.color),e.map=i.map,e.sizeAttenuation=!1,this.cache.add(t,e)),i=e}else if(t.isLine){const t="LineBasicMaterial:"+i.uuid;let e=this.cache.get(t);e||(e=new n.nls,n.F5T.prototype.copy.call(e,i),e.color.copy(i.color),this.cache.add(t,e)),i=e}if(r||s||o){let t="ClonedMaterial:"+i.uuid+":";i.isGLTFSpecularGlossinessMaterial&&(t+="specular-glossiness:"),r&&(t+="derivative-tangents:"),s&&(t+="vertex-colors:"),o&&(t+="flat-shading:");let e=this.cache.get(t);e||(e=i.clone(),s&&(e.vertexColors=!0),o&&(e.flatShading=!0),r&&(e.normalScale&&(e.normalScale.y*=-1),e.clearcoatNormalScale&&(e.clearcoatNormalScale.y*=-1)),this.cache.add(t,e),this.associations.set(e,this.associations.get(i))),i=e}i.aoMap&&void 0===e.attributes.uv2&&void 0!==e.attributes.uv&&e.setAttribute("uv2",e.attributes.uv),t.material=i}getMaterialType(){return n.Wid}loadMaterial(t){const e=this,i=this.json,r=this.extensions,s=i.materials[t];let a;const l={},c=s.extensions||{},h=[];if(c[o.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const t=r[o.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];a=t.getMaterialType(),h.push(t.extendParams(l,s,e))}else if(c[o.KHR_MATERIALS_UNLIT]){const t=r[o.KHR_MATERIALS_UNLIT];a=t.getMaterialType(),h.push(t.extendParams(l,s,e))}else{const i=s.pbrMetallicRoughness||{};if(l.color=new n.Ilk(1,1,1),l.opacity=1,Array.isArray(i.baseColorFactor)){const t=i.baseColorFactor;l.color.fromArray(t),l.opacity=t[3]}void 0!==i.baseColorTexture&&h.push(e.assignTexture(l,"map",i.baseColorTexture)),l.metalness=void 0!==i.metallicFactor?i.metallicFactor:1,l.roughness=void 0!==i.roughnessFactor?i.roughnessFactor:1,void 0!==i.metallicRoughnessTexture&&(h.push(e.assignTexture(l,"metalnessMap",i.metallicRoughnessTexture)),h.push(e.assignTexture(l,"roughnessMap",i.metallicRoughnessTexture))),a=this._invokeOne((function(e){return e.getMaterialType&&e.getMaterialType(t)})),h.push(Promise.all(this._invokeAll((function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,l)}))))}!0===s.doubleSided&&(l.side=n.ehD);const u=s.alphaMode||V;if(u===q?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,u===W&&(l.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&a!==n.vBJ&&(h.push(e.assignTexture(l,"normalMap",s.normalTexture)),l.normalScale=new n.FM8(1,1),void 0!==s.normalTexture.scale)){const t=s.normalTexture.scale;l.normalScale.set(t,t)}return void 0!==s.occlusionTexture&&a!==n.vBJ&&(h.push(e.assignTexture(l,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(l.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&a!==n.vBJ&&(l.emissive=(new n.Ilk).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&a!==n.vBJ&&h.push(e.assignTexture(l,"emissiveMap",s.emissiveTexture)),Promise.all(h).then((function(){let i;return i=a===S?r[o.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(l):new a(l),s.name&&(i.name=s.name),i.map&&(i.map.encoding=n.knz),i.emissiveMap&&(i.emissiveMap.encoding=n.knz),i.sheenColorMap&&(i.sheenColorMap.encoding=n.knz),i.specularColorMap&&(i.specularColorMap.encoding=n.knz),i.specularMap&&(i.specularMap.encoding=n.knz),X(i,s),e.associations.set(i,{materials:t}),s.extensions&&J(r,i,s),i}))}createUniqueName(t){const e=n.iUV.sanitizeNodeName(t||"");let i=e;for(let t=1;this.nodeNamesUsed[i];++t)i=e+"_"+t;return this.nodeNamesUsed[i]=!0,i}loadGeometries(t){const e=this,i=this.extensions,r=this.primitiveCache;function s(t){return i[o.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,e).then((function(i){return et(i,t,e)}))}const a=[];for(let i=0,l=t.length;i<l;i++){const l=t[i],c=Z(l),h=r[c];if(h)a.push(h.promise);else{let t;t=l.extensions&&l.extensions[o.KHR_DRACO_MESH_COMPRESSION]?s(l):et(new n.u9r,l,e),r[c]={primitive:l,promise:t},a.push(t)}}return Promise.all(a)}loadMesh(t){const e=this,i=this.json,r=this.extensions,s=i.meshes[t],o=s.primitives,a=[];for(let t=0,e=o.length;t<e;t++){const e=void 0===o[t].material?(void 0===(l=this.cache).DefaultMaterial&&(l.DefaultMaterial=new n.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:n.Wl3})),l.DefaultMaterial):this.getDependency("material",o[t].material);a.push(e)}var l;return a.push(e.loadGeometries(o)),Promise.all(a).then((function(i){const a=i.slice(0,i.length-1),l=i[i.length-1],c=[];for(let i=0,h=l.length;i<h;i++){const h=l[i],u=o[i];let d;const p=a[i];if(u.mode===R||u.mode===B||u.mode===N||void 0===u.mode)d=!0===s.isSkinnedMesh?new n.TUv(h,p):new n.Kj0(h,p),!0!==d.isSkinnedMesh||d.geometry.attributes.skinWeight.normalized||d.normalizeSkinWeights(),u.mode===B?d.geometry=it(d.geometry,n.UlW):u.mode===N&&(d.geometry=it(d.geometry,n.z$h));else if(u.mode===I)d=new n.ejS(h,p);else if(u.mode===L)d=new n.x12(h,p);else if(u.mode===D)d=new n.blk(h,p);else{if(u.mode!==P)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+u.mode);d=new n.woe(h,p)}Object.keys(d.geometry.morphAttributes).length>0&&Y(d,s),d.name=e.createUniqueName(s.name||"mesh_"+t),X(d,s),u.extensions&&J(r,d,u),e.assignFinalMaterial(d),c.push(d)}for(let i=0,n=c.length;i<n;i++)e.associations.set(c[i],{meshes:t,primitives:i});if(1===c.length)return c[0];const h=new n.ZAu;e.associations.set(h,{meshes:t});for(let t=0,e=c.length;t<e;t++)h.add(c[t]);return h}))}loadCamera(t){let e;const i=this.json.cameras[t],r=i[i.type];if(r)return"perspective"===i.type?e=new n.cPb(n.M8C.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===i.type&&(e=new n.iKG(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),i.name&&(e.name=this.createUniqueName(i.name)),X(e,i),Promise.resolve(e)}loadSkin(t){const e=this.json.skins[t],i={joints:e.joints};return void 0===e.inverseBindMatrices?Promise.resolve(i):this.getDependency("accessor",e.inverseBindMatrices).then((function(t){return i.inverseBindMatrices=t,i}))}loadAnimation(t){const e=this.json.animations[t],i=[],r=[],s=[],o=[],a=[];for(let t=0,n=e.channels.length;t<n;t++){const n=e.channels[t],l=e.samplers[n.sampler],c=n.target,h=void 0!==c.node?c.node:c.id,u=void 0!==e.parameters?e.parameters[l.input]:l.input,d=void 0!==e.parameters?e.parameters[l.output]:l.output;i.push(this.getDependency("node",h)),r.push(this.getDependency("accessor",u)),s.push(this.getDependency("accessor",d)),o.push(l),a.push(c)}return Promise.all([Promise.all(i),Promise.all(r),Promise.all(s),Promise.all(o),Promise.all(a)]).then((function(i){const r=i[0],s=i[1],o=i[2],a=i[3],l=i[4],c=[];for(let t=0,e=r.length;t<e;t++){const e=r[t],i=s[t],h=o[t],u=a[t],d=l[t];if(void 0===e)continue;let p;switch(e.updateMatrix(),e.matrixAutoUpdate=!0,j[d.path]){case j.weights:p=n.dUE;break;case j.rotation:p=n.iLg;break;default:p=n.yC1}const f=e.name?e.name:e.uuid,m=void 0!==u.interpolation?H[u.interpolation]:n.NMF,g=[];j[d.path]===j.weights?e.traverse((function(t){t.morphTargetInfluences&&g.push(t.name?t.name:t.uuid)})):g.push(f);let v=h.array;if(h.normalized){const t=Q(v.constructor),e=new Float32Array(v.length);for(let i=0,n=v.length;i<n;i++)e[i]=v[i]*t;v=e}for(let t=0,e=g.length;t<e;t++){const e=new p(g[t]+"."+j[d.path],i.array,v,m);"CUBICSPLINE"===u.interpolation&&(e.createInterpolant=function(t){return new(this instanceof n.iLg?O:E)(this.times,this.values,this.getValueSize()/3,t)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(e)}}const h=e.name?e.name:"animation_"+t;return new n.m7l(h,void 0,c)}))}createNodeMesh(t){const e=this.json,i=this,n=e.nodes[t];return void 0===n.mesh?null:i.getDependency("mesh",n.mesh).then((function(t){const e=i._getNodeRef(i.meshCache,n.mesh,t);return void 0!==n.weights&&e.traverse((function(t){if(t.isMesh)for(let e=0,i=n.weights.length;e<i;e++)t.morphTargetInfluences[e]=n.weights[e]})),e}))}loadNode(t){const e=this.json,i=this.extensions,r=this,s=e.nodes[t],o=s.name?r.createUniqueName(s.name):"";return function(){const e=[],i=r._invokeOne((function(e){return e.createNodeMesh&&e.createNodeMesh(t)}));return i&&e.push(i),void 0!==s.camera&&e.push(r.getDependency("camera",s.camera).then((function(t){return r._getNodeRef(r.cameraCache,s.camera,t)}))),r._invokeAll((function(e){return e.createNodeAttachment&&e.createNodeAttachment(t)})).forEach((function(t){e.push(t)})),Promise.all(e)}().then((function(e){let a;if(a=!0===s.isBone?new n.N$j:e.length>1?new n.ZAu:1===e.length?e[0]:new n.Tme,a!==e[0])for(let t=0,i=e.length;t<i;t++)a.add(e[t]);if(s.name&&(a.userData.name=s.name,a.name=o),X(a,s),s.extensions&&J(i,a,s),void 0!==s.matrix){const t=new n.yGw;t.fromArray(s.matrix),a.applyMatrix4(t)}else void 0!==s.translation&&a.position.fromArray(s.translation),void 0!==s.rotation&&a.quaternion.fromArray(s.rotation),void 0!==s.scale&&a.scale.fromArray(s.scale);return r.associations.has(a)||r.associations.set(a,{}),r.associations.get(a).nodes=t,a}))}loadScene(t){const e=this.json,i=this.extensions,r=this.json.scenes[t],s=this,o=new n.ZAu;r.name&&(o.name=s.createUniqueName(r.name)),X(o,r),r.extensions&&J(i,o,r);const a=r.nodes||[],l=[];for(let t=0,i=a.length;t<i;t++)l.push(tt(a[t],o,e,s));return Promise.all(l).then((function(){return s.associations=(t=>{const e=new Map;for(const[t,i]of s.associations)(t instanceof n.F5T||t instanceof n.xEZ)&&e.set(t,i);return t.traverse((t=>{const i=s.associations.get(t);null!=i&&e.set(t,i)})),e})(o),o}))}}function tt(t,e,i,r){const s=i.nodes[t];return r.getDependency("node",t).then((function(t){if(void 0===s.skin)return t;let e;return r.getDependency("skin",s.skin).then((function(t){e=t;const i=[];for(let t=0,n=e.joints.length;t<n;t++)i.push(r.getDependency("node",e.joints[t]));return Promise.all(i)})).then((function(i){return t.traverse((function(t){if(!t.isMesh)return;const r=[],s=[];for(let t=0,o=i.length;t<o;t++){const o=i[t];if(o){r.push(o);const i=new n.yGw;void 0!==e.inverseBindMatrices&&i.fromArray(e.inverseBindMatrices.array,16*t),s.push(i)}else e.joints[t]}t.bind(new n.OdW(r,s),t.matrixWorld)})),t}))})).then((function(t){e.add(t);const n=[];if(s.children){const e=s.children;for(let s=0,o=e.length;s<o;s++){const o=e[s];n.push(tt(o,t,i,r))}}return Promise.all(n)}))}function et(t,e,i){const r=e.attributes,s=[];function o(e,n){return i.getDependency("accessor",e).then((function(e){t.setAttribute(n,e)}))}for(const e in r){const i=k[e]||e.toLowerCase();i in t.attributes||s.push(o(r[e],i))}if(void 0!==e.indices&&!t.index){const n=i.getDependency("accessor",e.indices).then((function(e){t.setIndex(e)}));s.push(n)}return X(t,e),function(t,e,i){const r=e.attributes,s=new n.ZzF;if(void 0===r.POSITION)return;{const t=i.json.accessors[r.POSITION],e=t.min,o=t.max;if(void 0===e||void 0===o)return;if(s.set(new n.Pa4(e[0],e[1],e[2]),new n.Pa4(o[0],o[1],o[2])),t.normalized){const e=Q(F[t.componentType]);s.min.multiplyScalar(e),s.max.multiplyScalar(e)}}const o=e.targets;if(void 0!==o){const t=new n.Pa4,e=new n.Pa4;for(let n=0,r=o.length;n<r;n++){const r=o[n];if(void 0!==r.POSITION){const n=i.json.accessors[r.POSITION],s=n.min,o=n.max;if(void 0!==s&&void 0!==o){if(e.setX(Math.max(Math.abs(s[0]),Math.abs(o[0]))),e.setY(Math.max(Math.abs(s[1]),Math.abs(o[1]))),e.setZ(Math.max(Math.abs(s[2]),Math.abs(o[2]))),n.normalized){const t=Q(F[n.componentType]);e.multiplyScalar(t)}t.max(e)}}}s.expandByVector(t)}t.boundingBox=s;const a=new n.aLr;s.getCenter(a.center),a.radius=s.min.distanceTo(s.max)/2,t.boundingSphere=a}(t,e,i),Promise.all(s).then((function(){return void 0!==e.targets?function(t,e,i){let n=!1,r=!1,s=!1;for(let t=0,i=e.length;t<i;t++){const i=e[t];if(void 0!==i.POSITION&&(n=!0),void 0!==i.NORMAL&&(r=!0),void 0!==i.COLOR_0&&(s=!0),n&&r&&s)break}if(!n&&!r&&!s)return Promise.resolve(t);const o=[],a=[],l=[];for(let c=0,h=e.length;c<h;c++){const h=e[c];if(n){const e=void 0!==h.POSITION?i.getDependency("accessor",h.POSITION):t.attributes.position;o.push(e)}if(r){const e=void 0!==h.NORMAL?i.getDependency("accessor",h.NORMAL):t.attributes.normal;a.push(e)}if(s){const e=void 0!==h.COLOR_0?i.getDependency("accessor",h.COLOR_0):t.attributes.color;l.push(e)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then((function(e){const i=e[0],o=e[1],a=e[2];return n&&(t.morphAttributes.position=i),r&&(t.morphAttributes.normal=o),s&&(t.morphAttributes.color=a),t.morphTargetsRelative=!0,t}))}(t,e.targets,i):t}))}function it(t,e){let i=t.getIndex();if(null===i){const e=[],n=t.getAttribute("position");if(void 0===n)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(let t=0;t<n.count;t++)e.push(t);t.setIndex(e),i=t.getIndex()}const r=i.count-2,s=[];if(e===n.z$h)for(let t=1;t<=r;t++)s.push(i.getX(0)),s.push(i.getX(t)),s.push(i.getX(t+1));else for(let t=0;t<r;t++)t%2==0?(s.push(i.getX(t)),s.push(i.getX(t+1)),s.push(i.getX(t+2))):(s.push(i.getX(t+2)),s.push(i.getX(t+1)),s.push(i.getX(t)));s.length/3!==r&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=t.clone();return o.setIndex(s),o}},6023:(t,e,i)=>{"use strict";i.r(e),i.d(e,{MTLLoader:()=>r});var n=i(9477);class r extends n.aNw{constructor(t){super(t)}load(t,e,i,r){const s=this,o=""===this.path?n.Zp0.extractUrlBase(t):this.path,a=new n.hH6(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,(function(i){try{e(s.parse(i,o))}catch(e){r?r(e):console.error(e),s.manager.itemError(t)}}),i,r)}setMaterialOptions(t){return this.materialOptions=t,this}parse(t,e){const i=t.split("\n");let n={};const r=/\s+/,o={};for(let t=0;t<i.length;t++){let e=i[t];if(e=e.trim(),0===e.length||"#"===e.charAt(0))continue;const s=e.indexOf(" ");let a=s>=0?e.substring(0,s):e;a=a.toLowerCase();let l=s>=0?e.substring(s+1):"";if(l=l.trim(),"newmtl"===a)n={name:l},o[l]=n;else if("ka"===a||"kd"===a||"ks"===a||"ke"===a){const t=l.split(r,3);n[a]=[parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2])]}else n[a]=l}const a=new s(this.resourcePath||e,this.materialOptions);return a.setCrossOrigin(this.crossOrigin),a.setManager(this.manager),a.setMaterials(o),a}}class s{constructor(t="",e={}){this.baseUrl=t,this.options=e,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=void 0!==this.options.side?this.options.side:n.Wl3,this.wrap=void 0!==this.options.wrap?this.options.wrap:n.rpg}setCrossOrigin(t){return this.crossOrigin=t,this}setManager(t){this.manager=t}setMaterials(t){this.materialsInfo=this.convert(t),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(t){if(!this.options)return t;const e={};for(const i in t){const n=t[i],r={};e[i]=r;for(const t in n){let e=!0,i=n[t];const s=t.toLowerCase();switch(s){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(i=[i[0]/255,i[1]/255,i[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===i[0]&&0===i[1]&&0===i[2]&&(e=!1)}e&&(r[s]=i)}}return e}preload(){for(const t in this.materialsInfo)this.create(t)}getIndex(t){return this.nameLookup[t]}getAsArray(){let t=0;for(const e in this.materialsInfo)this.materialsArray[t]=this.create(e),this.nameLookup[e]=t,t++;return this.materialsArray}create(t){return void 0===this.materials[t]&&this.createMaterial_(t),this.materials[t]}createMaterial_(t){const e=this,i=this.materialsInfo[t],r={name:t,side:this.side};function s(t,i){if(r[t])return;const s=e.getTextureParams(i,r),o=e.loadTexture((a=e.baseUrl,"string"!=typeof(l=s.url)||""===l?"":/^https?:\/\//i.test(l)?l:a+l));var a,l;o.repeat.copy(s.scale),o.offset.copy(s.offset),o.wrapS=e.wrap,o.wrapT=e.wrap,"map"!==t&&"emissiveMap"!==t||(o.encoding=n.knz),r[t]=o}for(const t in i){const e=i[t];let o;if(""!==e)switch(t.toLowerCase()){case"kd":r.color=(new n.Ilk).fromArray(e).convertSRGBToLinear();break;case"ks":r.specular=(new n.Ilk).fromArray(e).convertSRGBToLinear();break;case"ke":r.emissive=(new n.Ilk).fromArray(e).convertSRGBToLinear();break;case"map_kd":s("map",e);break;case"map_ks":s("specularMap",e);break;case"map_ke":s("emissiveMap",e);break;case"norm":s("normalMap",e);break;case"map_bump":case"bump":s("bumpMap",e);break;case"map_d":s("alphaMap",e),r.transparent=!0;break;case"ns":r.shininess=parseFloat(e);break;case"d":o=parseFloat(e),o<1&&(r.opacity=o,r.transparent=!0);break;case"tr":o=parseFloat(e),this.options&&this.options.invertTrProperty&&(o=1-o),o>0&&(r.opacity=1-o,r.transparent=!0)}}return this.materials[t]=new n.xoR(r),this.materials[t]}getTextureParams(t,e){const i={scale:new n.FM8(1,1),offset:new n.FM8(0,0)},r=t.split(/\s+/);let s;return s=r.indexOf("-bm"),s>=0&&(e.bumpScale=parseFloat(r[s+1]),r.splice(s,2)),s=r.indexOf("-s"),s>=0&&(i.scale.set(parseFloat(r[s+1]),parseFloat(r[s+2])),r.splice(s,4)),s=r.indexOf("-o"),s>=0&&(i.offset.set(parseFloat(r[s+1]),parseFloat(r[s+2])),r.splice(s,4)),i.url=r.join(" ").trim(),i}loadTexture(t,e,i,r,s){const o=void 0!==this.manager?this.manager:n.tEQ;let a=o.getHandler(t);null===a&&(a=new n.dpR(o)),a.setCrossOrigin&&a.setCrossOrigin(this.crossOrigin);const l=a.load(t,i,r,s);return void 0!==e&&(l.mapping=e),l}}},7011:(t,e,i)=>{"use strict";i.r(e),i.d(e,{OBJLoader:()=>m});var n=i(9477);const r=/^[og]\s*(.+)?/,s=/^mtllib /,o=/^usemtl /,a=/^usemap /,l=new n.Pa4,c=new n.Pa4,h=new n.Pa4,u=new n.Pa4,d=new n.Pa4,p=new n.Ilk;function f(){const t={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(t,e){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=t,void(this.object.fromDeclaration=!1!==e);const i=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:!1!==e,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(t,e){const i=this._finalize(!1);i&&(i.inherited||i.groupCount<=0)&&this.materials.splice(i.index,1);const n={index:this.materials.length,name:t||"",mtllib:Array.isArray(e)&&e.length>0?e[e.length-1]:"",smooth:void 0!==i?i.smooth:this.smooth,groupStart:void 0!==i?i.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(t){const e={index:"number"==typeof t?t:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return e.clone=this.clone.bind(e),e}};return this.materials.push(n),n},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(t){const e=this.currentMaterial();if(e&&-1===e.groupEnd&&(e.groupEnd=this.geometry.vertices.length/3,e.groupCount=e.groupEnd-e.groupStart,e.inherited=!1),t&&this.materials.length>1)for(let t=this.materials.length-1;t>=0;t--)this.materials[t].groupCount<=0&&this.materials.splice(t,1);return t&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),e}},i&&i.name&&"function"==typeof i.clone){const t=i.clone(0);t.inherited=!0,this.object.materials.push(t)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(t,e){const i=parseInt(t,10);return 3*(i>=0?i-1:i+e/3)},parseNormalIndex:function(t,e){const i=parseInt(t,10);return 3*(i>=0?i-1:i+e/3)},parseUVIndex:function(t,e){const i=parseInt(t,10);return 2*(i>=0?i-1:i+e/2)},addVertex:function(t,e,i){const n=this.vertices,r=this.object.geometry.vertices;r.push(n[t+0],n[t+1],n[t+2]),r.push(n[e+0],n[e+1],n[e+2]),r.push(n[i+0],n[i+1],n[i+2])},addVertexPoint:function(t){const e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addVertexLine:function(t){const e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addNormal:function(t,e,i){const n=this.normals,r=this.object.geometry.normals;r.push(n[t+0],n[t+1],n[t+2]),r.push(n[e+0],n[e+1],n[e+2]),r.push(n[i+0],n[i+1],n[i+2])},addFaceNormal:function(t,e,i){const n=this.vertices,r=this.object.geometry.normals;l.fromArray(n,t),c.fromArray(n,e),h.fromArray(n,i),d.subVectors(h,c),u.subVectors(l,c),d.cross(u),d.normalize(),r.push(d.x,d.y,d.z),r.push(d.x,d.y,d.z),r.push(d.x,d.y,d.z)},addColor:function(t,e,i){const n=this.colors,r=this.object.geometry.colors;void 0!==n[t]&&r.push(n[t+0],n[t+1],n[t+2]),void 0!==n[e]&&r.push(n[e+0],n[e+1],n[e+2]),void 0!==n[i]&&r.push(n[i+0],n[i+1],n[i+2])},addUV:function(t,e,i){const n=this.uvs,r=this.object.geometry.uvs;r.push(n[t+0],n[t+1]),r.push(n[e+0],n[e+1]),r.push(n[i+0],n[i+1])},addDefaultUV:function(){const t=this.object.geometry.uvs;t.push(0,0),t.push(0,0),t.push(0,0)},addUVLine:function(t){const e=this.uvs;this.object.geometry.uvs.push(e[t+0],e[t+1])},addFace:function(t,e,i,n,r,s,o,a,l){const c=this.vertices.length;let h=this.parseVertexIndex(t,c),u=this.parseVertexIndex(e,c),d=this.parseVertexIndex(i,c);if(this.addVertex(h,u,d),this.addColor(h,u,d),void 0!==o&&""!==o){const t=this.normals.length;h=this.parseNormalIndex(o,t),u=this.parseNormalIndex(a,t),d=this.parseNormalIndex(l,t),this.addNormal(h,u,d)}else this.addFaceNormal(h,u,d);if(void 0!==n&&""!==n){const t=this.uvs.length;h=this.parseUVIndex(n,t),u=this.parseUVIndex(r,t),d=this.parseUVIndex(s,t),this.addUV(h,u,d),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(t){this.object.geometry.type="Points";const e=this.vertices.length;for(let i=0,n=t.length;i<n;i++){const n=this.parseVertexIndex(t[i],e);this.addVertexPoint(n),this.addColor(n)}},addLineGeometry:function(t,e){this.object.geometry.type="Line";const i=this.vertices.length,n=this.uvs.length;for(let e=0,n=t.length;e<n;e++)this.addVertexLine(this.parseVertexIndex(t[e],i));for(let t=0,i=e.length;t<i;t++)this.addUVLine(this.parseUVIndex(e[t],n))}};return t.startObject("",!1),t}class m extends n.aNw{constructor(t){super(t),this.materials=null}load(t,e,i,r){const s=this,o=new n.hH6(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(i){try{e(s.parse(i))}catch(e){r?r(e):console.error(e),s.manager.itemError(t)}}),i,r)}setMaterials(t){return this.materials=t,this}parse(t){const e=new f;-1!==t.indexOf("\r\n")&&(t=t.replace(/\r\n/g,"\n")),-1!==t.indexOf("\\\n")&&(t=t.replace(/\\\n/g,""));const i=t.split("\n");let l="",c="",h=0,u=[];const d="function"==typeof"".trimLeft;for(let t=0,n=i.length;t<n;t++)if(l=i[t],l=d?l.trimLeft():l.trim(),h=l.length,0!==h&&(c=l.charAt(0),"#"!==c))if("v"===c){const t=l.split(/\s+/);switch(t[0]){case"v":e.vertices.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])),t.length>=7?(p.setRGB(parseFloat(t[4]),parseFloat(t[5]),parseFloat(t[6])).convertSRGBToLinear(),e.colors.push(p.r,p.g,p.b)):e.colors.push(void 0,void 0,void 0);break;case"vn":e.normals.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]));break;case"vt":e.uvs.push(parseFloat(t[1]),parseFloat(t[2]))}}else if("f"===c){const t=l.slice(1).trim().split(/\s+/),i=[];for(let e=0,n=t.length;e<n;e++){const n=t[e];if(n.length>0){const t=n.split("/");i.push(t)}}const n=i[0];for(let t=1,r=i.length-1;t<r;t++){const r=i[t],s=i[t+1];e.addFace(n[0],r[0],s[0],n[1],r[1],s[1],n[2],r[2],s[2])}}else if("l"===c){const t=l.substring(1).trim().split(" ");let i=[];const n=[];if(-1===l.indexOf("/"))i=t;else for(let e=0,r=t.length;e<r;e++){const r=t[e].split("/");""!==r[0]&&i.push(r[0]),""!==r[1]&&n.push(r[1])}e.addLineGeometry(i,n)}else if("p"===c){const t=l.slice(1).trim().split(" ");e.addPointGeometry(t)}else if(null!==(u=r.exec(l))){const t=(" "+u[0].slice(1).trim()).slice(1);e.startObject(t)}else if(o.test(l))e.object.startMaterial(l.substring(7).trim(),e.materialLibraries);else if(s.test(l))e.materialLibraries.push(l.substring(7).trim());else if(a.test(l));else if("s"===c){if(u=l.split(" "),u.length>1){const t=u[1].trim().toLowerCase();e.object.smooth="0"!==t&&"off"!==t}else e.object.smooth=!0;const t=e.object.currentMaterial();t&&(t.smooth=e.object.smooth)}else if("\0"===l)continue;e.finalize();const m=new n.ZAu;m.materialLibraries=[].concat(e.materialLibraries);if(!0===!(1===e.objects.length&&0===e.objects[0].geometry.vertices.length))for(let t=0,i=e.objects.length;t<i;t++){const i=e.objects[t],r=i.geometry,s=i.materials,o="Line"===r.type,a="Points"===r.type;let l=!1;if(0===r.vertices.length)continue;const c=new n.u9r;c.setAttribute("position",new n.a$l(r.vertices,3)),r.normals.length>0&&c.setAttribute("normal",new n.a$l(r.normals,3)),r.colors.length>0&&(l=!0,c.setAttribute("color",new n.a$l(r.colors,3))),!0===r.hasUVIndices&&c.setAttribute("uv",new n.a$l(r.uvs,2));const h=[];for(let t=0,i=s.length;t<i;t++){const i=s[t],r=i.name+"_"+i.smooth+"_"+l;let c=e.materials[r];if(null!==this.materials)if(c=this.materials.create(i.name),!o||!c||c instanceof n.nls){if(a&&c&&!(c instanceof n.UY4)){const t=new n.UY4({size:10,sizeAttenuation:!1});n.F5T.prototype.copy.call(t,c),t.color.copy(c.color),t.map=c.map,c=t}}else{const t=new n.nls;n.F5T.prototype.copy.call(t,c),t.color.copy(c.color),c=t}void 0===c&&(c=o?new n.nls:a?new n.UY4({size:1,sizeAttenuation:!1}):new n.xoR,c.name=i.name,c.flatShading=!i.smooth,c.vertexColors=l,e.materials[r]=c),h.push(c)}let u;if(h.length>1){for(let t=0,e=s.length;t<e;t++){const e=s[t];c.addGroup(e.groupStart,e.groupCount,t)}u=o?new n.ejS(c,h):a?new n.woe(c,h):new n.Kj0(c,h)}else u=o?new n.ejS(c,h[0]):a?new n.woe(c,h[0]):new n.Kj0(c,h[0]);u.name=i.name,m.add(u)}else if(e.vertices.length>0){const t=new n.UY4({size:1,sizeAttenuation:!1}),i=new n.u9r;i.setAttribute("position",new n.a$l(e.vertices,3)),e.colors.length>0&&void 0!==e.colors[0]&&(i.setAttribute("color",new n.a$l(e.colors,3)),t.vertexColors=!0);const r=new n.woe(i,t);m.add(r)}return m}}},1367:(t,e,i)=>{"use strict";i.r(e),i.d(e,{SVGLoader:()=>r});var n=i(9477);class r extends n.aNw{constructor(t){super(t),this.defaultDPI=90,this.defaultUnit="px"}load(t,e,i,r){const s=this,o=new n.hH6(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(t,(function(i){try{e(s.parse(i))}catch(e){r?r(e):console.error(e),s.manager.itemError(t)}}),i,r)}parse(t){const e=this;function i(t,e,i,n,s,o,a,l){if(0==e||0==i)return void t.lineTo(l.x,l.y);n=n*Math.PI/180,e=Math.abs(e),i=Math.abs(i);const c=(a.x-l.x)/2,h=(a.y-l.y)/2,u=Math.cos(n)*c+Math.sin(n)*h,d=-Math.sin(n)*c+Math.cos(n)*h;let p=e*e,f=i*i;const m=u*u,g=d*d,v=m/p+g/f;if(v>1){const t=Math.sqrt(v);p=(e*=t)*e,f=(i*=t)*i}const y=p*g+f*m,_=(p*f-y)/y;let x=Math.sqrt(Math.max(0,_));s===o&&(x=-x);const M=x*e*d/i,b=-x*i*u/e,w=Math.cos(n)*M-Math.sin(n)*b+(a.x+l.x)/2,S=Math.sin(n)*M+Math.cos(n)*b+(a.y+l.y)/2,T=r(1,0,(u-M)/e,(d-b)/i),A=r((u-M)/e,(d-b)/i,(-u-M)/e,(-d-b)/i)%(2*Math.PI);t.currentPath.absellipse(w,S,e,i,T,T+A,0===o,n)}function r(t,e,i,n){const r=t*i+e*n,s=Math.sqrt(t*t+e*e)*Math.sqrt(i*i+n*n);let o=Math.acos(Math.max(-1,Math.min(1,r/s)));return t*n-e*i<0&&(o=-o),o}function s(t,e){e=Object.assign({},e);let i={};if(t.hasAttribute("class")){const e=t.getAttribute("class").split(/\s/).filter(Boolean).map((t=>t.trim()));for(let t=0;t<e.length;t++)i=Object.assign(i,f["."+e[t]])}function n(n,r,s){void 0===s&&(s=function(t){return t.startsWith("url"),t}),t.hasAttribute(n)&&(e[r]=s(t.getAttribute(n))),i[n]&&(e[r]=s(i[n])),t.style&&""!==t.style[n]&&(e[r]=s(t.style[n]))}function r(t){return Math.max(0,Math.min(1,h(t)))}function s(t){return Math.max(0,h(t))}return t.hasAttribute("id")&&(i=Object.assign(i,f["#"+t.getAttribute("id")])),n("fill","fill"),n("fill-opacity","fillOpacity",r),n("fill-rule","fillRule"),n("opacity","opacity",r),n("stroke","stroke"),n("stroke-opacity","strokeOpacity",r),n("stroke-width","strokeWidth",s),n("stroke-linejoin","strokeLineJoin"),n("stroke-linecap","strokeLineCap"),n("stroke-miterlimit","strokeMiterLimit",s),n("visibility","visibility"),e}function o(t,e){return t-(e-t)}function a(t,e,i){if("string"!=typeof t)throw new TypeError("Invalid input: "+typeof t);const n={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/};let r=0,s=!0,o="",a="";const l=[];function c(t,e,i){const n=new SyntaxError('Unexpected character "'+t+'" at index '+e+".");throw n.partial=i,n}function h(){""!==o&&(""===a?l.push(Number(o)):l.push(Number(o)*Math.pow(10,Number(a)))),o="",a=""}let u;const d=t.length;for(let p=0;p<d;p++)if(u=t[p],Array.isArray(e)&&e.includes(l.length%i)&&n.FLAGS.test(u))r=1,o=u,h();else{if(0===r){if(n.WHITESPACE.test(u))continue;if(n.DIGIT.test(u)||n.SIGN.test(u)){r=1,o=u;continue}if(n.POINT.test(u)){r=2,o=u;continue}n.COMMA.test(u)&&(s&&c(u,p,l),s=!0)}if(1===r){if(n.DIGIT.test(u)){o+=u;continue}if(n.POINT.test(u)){o+=u,r=2;continue}if(n.EXP.test(u)){r=3;continue}n.SIGN.test(u)&&1===o.length&&n.SIGN.test(o[0])&&c(u,p,l)}if(2===r){if(n.DIGIT.test(u)){o+=u;continue}if(n.EXP.test(u)){r=3;continue}n.POINT.test(u)&&"."===o[o.length-1]&&c(u,p,l)}if(3===r){if(n.DIGIT.test(u)){a+=u;continue}if(n.SIGN.test(u)){if(""===a){a+=u;continue}1===a.length&&n.SIGN.test(a)&&c(u,p,l)}}n.WHITESPACE.test(u)?(h(),r=0,s=!1):n.COMMA.test(u)?(h(),r=0,s=!0):n.SIGN.test(u)?(h(),r=1,o=u):n.POINT.test(u)?(h(),r=2,o=u):c(u,p,l)}return h(),l}const l=["mm","cm","in","pt","pc","px"],c={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function h(t){let i,n="px";if("string"==typeof t||t instanceof String)for(let e=0,i=l.length;e<i;e++){const i=l[e];if(t.endsWith(i)){n=i,t=t.substring(0,t.length-i.length);break}}return"px"===n&&"px"!==e.defaultUnit?i=c.in[e.defaultUnit]/e.defaultDPI:(i=c[n][e.defaultUnit],i<0&&(i=c[n].in*e.defaultDPI)),i*parseFloat(t)}function u(t){const e=t.elements;return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function d(t){const e=t.elements;return Math.sqrt(e[3]*e[3]+e[4]*e[4])}const p=[],f={},m=[],g=new n.Vkp,v=new n.Vkp,y=new n.Vkp,_=new n.Vkp,x=new n.FM8,M=new n.Pa4,b=new n.Vkp,w=(new DOMParser).parseFromString(t,"image/svg+xml");!function t(e,r){if(1!==e.nodeType)return;const l=function(t){if(!(t.hasAttribute("transform")||"use"===t.nodeName&&(t.hasAttribute("x")||t.hasAttribute("y"))))return null;const e=function(t){const e=new n.Vkp,i=g;if("use"===t.nodeName&&(t.hasAttribute("x")||t.hasAttribute("y"))){const i=h(t.getAttribute("x")),n=h(t.getAttribute("y"));e.translate(i,n)}if(t.hasAttribute("transform")){const n=t.getAttribute("transform").split(")");for(let t=n.length-1;t>=0;t--){const r=n[t].trim();if(""===r)continue;const s=r.indexOf("("),o=r.length;if(s>0&&s<o){const t=r.slice(0,s),e=a(r.slice(s+1));switch(i.identity(),t){case"translate":if(e.length>=1){const t=e[0];let n=t;e.length>=2&&(n=e[1]),i.translate(t,n)}break;case"rotate":if(e.length>=1){let t=0,n=0,r=0;t=-e[0]*Math.PI/180,e.length>=3&&(n=e[1],r=e[2]),v.identity().translate(-n,-r),y.identity().rotate(t),_.multiplyMatrices(y,v),v.identity().translate(n,r),i.multiplyMatrices(v,_)}break;case"scale":if(e.length>=1){const t=e[0];let n=t;e.length>=2&&(n=e[1]),i.scale(t,n)}break;case"skewX":1===e.length&&i.set(1,Math.tan(e[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===e.length&&i.set(1,0,0,Math.tan(e[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===e.length&&i.set(e[0],e[2],e[4],e[1],e[3],e[5],0,0,1)}}e.premultiply(i)}}return e}(t);m.length>0&&e.premultiply(m[m.length-1]);return b.copy(e),m.push(e),e}(e);let c=!1,w=null;switch(e.nodeName){case"svg":break;case"style":!function(t){if(!t.sheet||!t.sheet.cssRules||!t.sheet.cssRules.length)return;for(let e=0;e<t.sheet.cssRules.length;e++){const i=t.sheet.cssRules[e];if(1!==i.type)continue;const n=i.selectorText.split(/,/gm).filter(Boolean).map((t=>t.trim()));for(let t=0;t<n.length;t++){const e=Object.fromEntries(Object.entries(i.style).filter((([,t])=>""!==t)));f[n[t]]=Object.assign(f[n[t]]||{},e)}}}(e);break;case"g":r=s(e,r);break;case"path":r=s(e,r),e.hasAttribute("d")&&(w=function(t){const e=new n.T_1,r=new n.FM8,s=new n.FM8,l=new n.FM8;let c=!0,h=!1;const u=t.getAttribute("d").match(/[a-df-z][^a-df-z]*/gi);for(let t=0,n=u.length;t<n;t++){const n=u[t],d=n.charAt(0),p=n.slice(1).trim();let f;switch(!0===c&&(h=!0,c=!1),d){case"M":f=a(p);for(let t=0,i=f.length;t<i;t+=2)r.x=f[t+0],r.y=f[t+1],s.x=r.x,s.y=r.y,0===t?e.moveTo(r.x,r.y):e.lineTo(r.x,r.y),0===t&&l.copy(r);break;case"H":f=a(p);for(let t=0,i=f.length;t<i;t++)r.x=f[t],s.x=r.x,s.y=r.y,e.lineTo(r.x,r.y),0===t&&!0===h&&l.copy(r);break;case"V":f=a(p);for(let t=0,i=f.length;t<i;t++)r.y=f[t],s.x=r.x,s.y=r.y,e.lineTo(r.x,r.y),0===t&&!0===h&&l.copy(r);break;case"L":f=a(p);for(let t=0,i=f.length;t<i;t+=2)r.x=f[t+0],r.y=f[t+1],s.x=r.x,s.y=r.y,e.lineTo(r.x,r.y),0===t&&!0===h&&l.copy(r);break;case"C":f=a(p);for(let t=0,i=f.length;t<i;t+=6)e.bezierCurveTo(f[t+0],f[t+1],f[t+2],f[t+3],f[t+4],f[t+5]),s.x=f[t+2],s.y=f[t+3],r.x=f[t+4],r.y=f[t+5],0===t&&!0===h&&l.copy(r);break;case"S":f=a(p);for(let t=0,i=f.length;t<i;t+=4)e.bezierCurveTo(o(r.x,s.x),o(r.y,s.y),f[t+0],f[t+1],f[t+2],f[t+3]),s.x=f[t+0],s.y=f[t+1],r.x=f[t+2],r.y=f[t+3],0===t&&!0===h&&l.copy(r);break;case"Q":f=a(p);for(let t=0,i=f.length;t<i;t+=4)e.quadraticCurveTo(f[t+0],f[t+1],f[t+2],f[t+3]),s.x=f[t+0],s.y=f[t+1],r.x=f[t+2],r.y=f[t+3],0===t&&!0===h&&l.copy(r);break;case"T":f=a(p);for(let t=0,i=f.length;t<i;t+=2){const i=o(r.x,s.x),n=o(r.y,s.y);e.quadraticCurveTo(i,n,f[t+0],f[t+1]),s.x=i,s.y=n,r.x=f[t+0],r.y=f[t+1],0===t&&!0===h&&l.copy(r)}break;case"A":f=a(p,[3,4],7);for(let t=0,n=f.length;t<n;t+=7){if(f[t+5]==r.x&&f[t+6]==r.y)continue;const n=r.clone();r.x=f[t+5],r.y=f[t+6],s.x=r.x,s.y=r.y,i(e,f[t],f[t+1],f[t+2],f[t+3],f[t+4],n,r),0===t&&!0===h&&l.copy(r)}break;case"m":f=a(p);for(let t=0,i=f.length;t<i;t+=2)r.x+=f[t+0],r.y+=f[t+1],s.x=r.x,s.y=r.y,0===t?e.moveTo(r.x,r.y):e.lineTo(r.x,r.y),0===t&&l.copy(r);break;case"h":f=a(p);for(let t=0,i=f.length;t<i;t++)r.x+=f[t],s.x=r.x,s.y=r.y,e.lineTo(r.x,r.y),0===t&&!0===h&&l.copy(r);break;case"v":f=a(p);for(let t=0,i=f.length;t<i;t++)r.y+=f[t],s.x=r.x,s.y=r.y,e.lineTo(r.x,r.y),0===t&&!0===h&&l.copy(r);break;case"l":f=a(p);for(let t=0,i=f.length;t<i;t+=2)r.x+=f[t+0],r.y+=f[t+1],s.x=r.x,s.y=r.y,e.lineTo(r.x,r.y),0===t&&!0===h&&l.copy(r);break;case"c":f=a(p);for(let t=0,i=f.length;t<i;t+=6)e.bezierCurveTo(r.x+f[t+0],r.y+f[t+1],r.x+f[t+2],r.y+f[t+3],r.x+f[t+4],r.y+f[t+5]),s.x=r.x+f[t+2],s.y=r.y+f[t+3],r.x+=f[t+4],r.y+=f[t+5],0===t&&!0===h&&l.copy(r);break;case"s":f=a(p);for(let t=0,i=f.length;t<i;t+=4)e.bezierCurveTo(o(r.x,s.x),o(r.y,s.y),r.x+f[t+0],r.y+f[t+1],r.x+f[t+2],r.y+f[t+3]),s.x=r.x+f[t+0],s.y=r.y+f[t+1],r.x+=f[t+2],r.y+=f[t+3],0===t&&!0===h&&l.copy(r);break;case"q":f=a(p);for(let t=0,i=f.length;t<i;t+=4)e.quadraticCurveTo(r.x+f[t+0],r.y+f[t+1],r.x+f[t+2],r.y+f[t+3]),s.x=r.x+f[t+0],s.y=r.y+f[t+1],r.x+=f[t+2],r.y+=f[t+3],0===t&&!0===h&&l.copy(r);break;case"t":f=a(p);for(let t=0,i=f.length;t<i;t+=2){const i=o(r.x,s.x),n=o(r.y,s.y);e.quadraticCurveTo(i,n,r.x+f[t+0],r.y+f[t+1]),s.x=i,s.y=n,r.x=r.x+f[t+0],r.y=r.y+f[t+1],0===t&&!0===h&&l.copy(r)}break;case"a":f=a(p,[3,4],7);for(let t=0,n=f.length;t<n;t+=7){if(0==f[t+5]&&0==f[t+6])continue;const n=r.clone();r.x+=f[t+5],r.y+=f[t+6],s.x=r.x,s.y=r.y,i(e,f[t],f[t+1],f[t+2],f[t+3],f[t+4],n,r),0===t&&!0===h&&l.copy(r)}break;case"Z":case"z":e.currentPath.autoClose=!0,e.currentPath.curves.length>0&&(r.copy(l),e.currentPath.currentPoint.copy(r),c=!0)}h=!1}return e}(e));break;case"rect":r=s(e,r),w=function(t){const e=h(t.getAttribute("x")||0),i=h(t.getAttribute("y")||0),r=h(t.getAttribute("rx")||t.getAttribute("ry")||0),s=h(t.getAttribute("ry")||t.getAttribute("rx")||0),o=h(t.getAttribute("width")),a=h(t.getAttribute("height")),l=.448084975506,c=new n.T_1;c.moveTo(e+r,i),c.lineTo(e+o-r,i),(0!==r||0!==s)&&c.bezierCurveTo(e+o-r*l,i,e+o,i+s*l,e+o,i+s);c.lineTo(e+o,i+a-s),(0!==r||0!==s)&&c.bezierCurveTo(e+o,i+a-s*l,e+o-r*l,i+a,e+o-r,i+a);c.lineTo(e+r,i+a),(0!==r||0!==s)&&c.bezierCurveTo(e+r*l,i+a,e,i+a-s*l,e,i+a-s);c.lineTo(e,i+s),(0!==r||0!==s)&&c.bezierCurveTo(e,i+s*l,e+r*l,i,e+r,i);return c}(e);break;case"polygon":r=s(e,r),w=function(t){function e(t,e,i){const n=h(e),o=h(i);0===s?r.moveTo(n,o):r.lineTo(n,o),s++}const i=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,r=new n.T_1;let s=0;return t.getAttribute("points").replace(i,e),r.currentPath.autoClose=!0,r}(e);break;case"polyline":r=s(e,r),w=function(t){function e(t,e,i){const n=h(e),o=h(i);0===s?r.moveTo(n,o):r.lineTo(n,o),s++}const i=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,r=new n.T_1;let s=0;return t.getAttribute("points").replace(i,e),r.currentPath.autoClose=!1,r}(e);break;case"circle":r=s(e,r),w=function(t){const e=h(t.getAttribute("cx")||0),i=h(t.getAttribute("cy")||0),r=h(t.getAttribute("r")||0),s=new n.y$t;s.absarc(e,i,r,0,2*Math.PI);const o=new n.T_1;return o.subPaths.push(s),o}(e);break;case"ellipse":r=s(e,r),w=function(t){const e=h(t.getAttribute("cx")||0),i=h(t.getAttribute("cy")||0),r=h(t.getAttribute("rx")||0),s=h(t.getAttribute("ry")||0),o=new n.y$t;o.absellipse(e,i,r,s,0,2*Math.PI);const a=new n.T_1;return a.subPaths.push(o),a}(e);break;case"line":r=s(e,r),w=function(t){const e=h(t.getAttribute("x1")||0),i=h(t.getAttribute("y1")||0),r=h(t.getAttribute("x2")||0),s=h(t.getAttribute("y2")||0),o=new n.T_1;return o.moveTo(e,i),o.lineTo(r,s),o.currentPath.autoClose=!1,o}(e);break;case"defs":c=!0;break;case"use":r=s(e,r);const l=(e.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").substring(1),u=e.viewportElement.getElementById(l);u&&t(u,r)}w&&(void 0!==r.fill&&"none"!==r.fill&&w.color.setStyle(r.fill),function(t,e){function i(t){M.set(t.x,t.y,1).applyMatrix3(e),t.set(M.x,M.y)}!function(t){0!==t.elements[1]||t.elements[3]}(e);const n=t.subPaths;for(let t=0,r=n.length;t<r;t++){const r=n[t].curves;for(let t=0;t<r.length;t++){const n=r[t];n.isLineCurve?(i(n.v1),i(n.v2)):n.isCubicBezierCurve?(i(n.v0),i(n.v1),i(n.v2),i(n.v3)):n.isQuadraticBezierCurve?(i(n.v0),i(n.v1),i(n.v2)):n.isEllipseCurve&&(x.set(n.aX,n.aY),i(x),n.aX=x.x,n.aY=x.y,n.xRadius*=u(e),n.yRadius*=d(e))}}}(w,b),p.push(w),w.userData={node:e,style:r});const S=e.childNodes;for(let e=0;e<S.length;e++){const i=S[e];c&&"style"!==i.nodeName&&"defs"!==i.nodeName||t(i,r)}l&&(m.pop(),m.length>0?b.copy(m[m.length-1]):b.identity())}(w.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4});return{paths:p,xml:w.documentElement}}static createShapes(t){const e=999999999,i=0,r=1,s=2,o=3,a=4,l=5,c=6,h={loc:i,t:0};function u(t,e,n,r){const o=t.x,a=e.x,l=n.x,c=r.x,u=t.y,p=e.y,f=n.y,m=r.y,g=(c-l)*(u-f)-(m-f)*(o-l),v=(m-f)*(a-o)-(c-l)*(p-u),y=g/v,_=((a-o)*(u-f)-(p-u)*(o-l))/v;if(0===v&&0!==g||y<=0||y>=1||_<0||_>1)return null;if(0===g&&0===v){for(let l=0;l<2;l++){if(d(0===l?n:r,t,e),h.loc==i){const t=0===l?n:r;return{x:t.x,y:t.y,t:h.t}}if(h.loc==s){return{x:+(o+h.t*(a-o)).toPrecision(10),y:+(u+h.t*(p-u)).toPrecision(10),t:h.t}}}return null}for(let s=0;s<2;s++)if(d(0===s?n:r,t,e),h.loc==i){const t=0===s?n:r;return{x:t.x,y:t.y,t:h.t}}return{x:+(o+y*(a-o)).toPrecision(10),y:+(u+y*(p-u)).toPrecision(10),t:y}}function d(t,e,n){const u=n.x-e.x,d=n.y-e.y,p=t.x-e.x,f=t.y-e.y,m=u*f-p*d;if(t.x===e.x&&t.y===e.y)return h.loc=i,void(h.t=0);if(t.x===n.x&&t.y===n.y)return h.loc=r,void(h.t=1);if(m<-Number.EPSILON)return void(h.loc=o);if(m>Number.EPSILON)return void(h.loc=a);if(u*p<0||d*f<0)return void(h.loc=l);if(Math.sqrt(u*u+d*d)<Math.sqrt(p*p+f*f))return void(h.loc=c);let g;g=0!==u?p/u:f/d,h.loc=s,h.t=g}function p(t,e,i){const r=new n.FM8;e.getCenter(r);const s=[];return i.forEach((e=>{if(e.boundingBox.containsPoint(r)){(function(t,e){const i=[],r=[];for(let s=1;s<t.length;s++){const o=t[s-1],a=t[s];for(let t=1;t<e.length;t++){const s=u(o,a,e[t-1],e[t]);null!==s&&void 0===i.find((t=>t.t<=s.t+Number.EPSILON&&t.t>=s.t-Number.EPSILON))&&(i.push(s),r.push(new n.FM8(s.x,s.y)))}}return r})(t,e.points).forEach((t=>{s.push({identifier:e.identifier,isCW:e.isCW,point:t})}))}})),s.sort(((t,e)=>t.point.x-e.point.x)),s}let f=0,m=e,g=-999999999,v=t.subPaths.map((t=>{const i=t.getPoints();let r=-999999999,s=e,o=-999999999,a=e;for(let t=0;t<i.length;t++){const e=i[t];e.y>r&&(r=e.y),e.y<s&&(s=e.y),e.x>o&&(o=e.x),e.x<a&&(a=e.x)}return g<=o&&(g=o+1),m>=a&&(m=a-1),{curves:t.curves,points:i,isCW:n.iDF.isClockWise(i),identifier:f++,boundingBox:new n.TUj(new n.FM8(a,s),new n.FM8(o,r))}}));v=v.filter((t=>t.points.length>1));const y=v.map((e=>function(t,e,i,r,s){null!=s&&""!==s||(s="nonzero");const o=new n.FM8;t.boundingBox.getCenter(o);const a=p([new n.FM8(i,o.y),new n.FM8(r,o.y)],t.boundingBox,e);a.sort(((t,e)=>t.point.x-e.point.x));const l=[],c=[];a.forEach((e=>{e.identifier===t.identifier?l.push(e):c.push(e)}));const h=l[0].point.x,u=[];let d=0;for(;d<c.length&&c[d].point.x<h;)u.length>0&&u[u.length-1]===c[d].identifier?u.pop():u.push(c[d].identifier),d++;if(u.push(t.identifier),"evenodd"===s){const e=u.length%2==0,i=u[u.length-2];return{identifier:t.identifier,isHole:e,for:i}}if("nonzero"===s){let i=!0,n=null,r=null;for(let t=0;t<u.length;t++){const s=u[t];i?(r=e[s].isCW,i=!1,n=s):r!==e[s].isCW&&(r=e[s].isCW,i=!0)}return{identifier:t.identifier,isHole:i,for:n}}}(e,v,m,g,t.userData.style.fillRule))),_=[];return v.forEach((t=>{if(!y[t.identifier].isHole){const e=new n.bnF;e.curves=t.curves;y.filter((e=>e.isHole&&e.for===t.identifier)).forEach((t=>{const i=v[t.identifier],r=new n.y$t;r.curves=i.curves,e.holes.push(r)})),_.push(e)}})),_}static getStrokeStyle(t,e,i,n,r){return{strokeColor:e=void 0!==e?e:"#000",strokeWidth:t=void 0!==t?t:1,strokeLineJoin:i=void 0!==i?i:"miter",strokeLineCap:n=void 0!==n?n:"butt",strokeMiterLimit:r=void 0!==r?r:4}}static pointsToStroke(t,e,i,s){const o=[],a=[],l=[];if(0===r.pointsToStrokeWithBuffers(t,e,i,s,o,a,l))return null;const c=new n.u9r;return c.setAttribute("position",new n.a$l(o,3)),c.setAttribute("normal",new n.a$l(a,3)),c.setAttribute("uv",new n.a$l(l,2)),c}static pointsToStrokeWithBuffers(t,e,i,r,s,o,a,l){const c=new n.FM8,h=new n.FM8,u=new n.FM8,d=new n.FM8,p=new n.FM8,f=new n.FM8,m=new n.FM8,g=new n.FM8,v=new n.FM8,y=new n.FM8,_=new n.FM8,x=new n.FM8,M=new n.FM8,b=new n.FM8,w=new n.FM8,S=new n.FM8,T=new n.FM8;i=void 0!==i?i:12,r=void 0!==r?r:.001,l=void 0!==l?l:0;const A=(t=function(t){let e=!1;for(let i=1,n=t.length-1;i<n;i++)if(t[i].distanceTo(t[i+1])<r){e=!0;break}if(!e)return t;const i=[];i.push(t[0]);for(let e=1,n=t.length-1;e<n;e++)t[e].distanceTo(t[e+1])>=r&&i.push(t[e]);return i.push(t[t.length-1]),i}(t)).length;if(A<2)return 0;const E=t[0].equals(t[A-1]);let C,O,P=t[0];const I=e.strokeWidth/2,D=1/(A-1);let L,R,B,N,F=0,U=!1,G=0,z=3*l,k=2*l;j(t[0],t[1],c).multiplyScalar(I),g.copy(t[0]).sub(c),v.copy(t[0]).add(c),y.copy(g),_.copy(v);for(let i=1;i<A;i++){C=t[i],O=i===A-1?E?t[1]:void 0:t[i+1];const n=c;if(j(P,C,n),u.copy(n).multiplyScalar(I),x.copy(C).sub(u),M.copy(C).add(u),L=F+D,R=!1,void 0!==O){j(C,O,h),u.copy(h).multiplyScalar(I),b.copy(C).sub(u),w.copy(C).add(u),B=!0,u.subVectors(O,P),n.dot(u)<0&&(B=!1),1===i&&(U=B),u.subVectors(O,C),u.normalize();const t=Math.abs(n.dot(u));if(0!==t){const i=I/t;u.multiplyScalar(-i),d.subVectors(C,P),p.copy(d).setLength(i).add(u),S.copy(p).negate();const n=p.length(),r=d.length();d.divideScalar(r),f.subVectors(O,C);const s=f.length();switch(f.divideScalar(s),d.dot(S)<r&&f.dot(S)<s&&(R=!0),T.copy(p).add(C),S.add(C),N=!1,R?B?(w.copy(S),M.copy(S)):(b.copy(S),x.copy(S)):W(),e.strokeLineJoin){case"bevel":q(B,R,L);break;case"round":J(B,R),B?V(C,x,b,L,0):V(C,w,M,L,1);break;default:const t=I*e.strokeMiterLimit/n;if(t<1){if("miter-clip"!==e.strokeLineJoin){q(B,R,L);break}J(B,R),B?(f.subVectors(T,x).multiplyScalar(t).add(x),m.subVectors(T,b).multiplyScalar(t).add(b),H(x,L,0),H(f,L,0),H(C,L,.5),H(C,L,.5),H(f,L,0),H(m,L,0),H(C,L,.5),H(m,L,0),H(b,L,0)):(f.subVectors(T,M).multiplyScalar(t).add(M),m.subVectors(T,w).multiplyScalar(t).add(w),H(M,L,1),H(f,L,1),H(C,L,.5),H(C,L,.5),H(f,L,1),H(m,L,1),H(C,L,.5),H(m,L,1),H(w,L,1))}else R?(B?(H(v,F,1),H(g,F,0),H(T,L,0),H(v,F,1),H(T,L,0),H(S,L,1)):(H(v,F,1),H(g,F,0),H(T,L,1),H(g,F,0),H(S,L,0),H(T,L,1)),B?b.copy(T):w.copy(T)):B?(H(x,L,0),H(T,L,0),H(C,L,.5),H(C,L,.5),H(T,L,0),H(b,L,0)):(H(M,L,1),H(T,L,1),H(C,L,.5),H(C,L,.5),H(T,L,1),H(w,L,1)),N=!0}}else W()}else W();E||i!==A-1||X(t[0],y,_,B,!0,F),F=L,P=C,g.copy(b),v.copy(w)}if(E){if(R&&s){let t=T,e=S;U!==B&&(t=S,e=T),B?(N||U)&&(e.toArray(s,0),e.toArray(s,9),N&&t.toArray(s,3)):!N&&U||(e.toArray(s,3),e.toArray(s,9),N&&t.toArray(s,0))}}else X(C,x,M,B,!1,L);return G;function j(t,e,i){return i.subVectors(e,t),i.set(-i.y,i.x).normalize()}function H(t,e,i){s&&(s[z]=t.x,s[z+1]=t.y,s[z+2]=0,o&&(o[z]=0,o[z+1]=0,o[z+2]=1),z+=3,a&&(a[k]=e,a[k+1]=i,k+=2)),G+=3}function V(t,e,n,r,s){c.copy(e).sub(t).normalize(),h.copy(n).sub(t).normalize();let o=Math.PI;const a=c.dot(h);Math.abs(a)<1&&(o=Math.abs(Math.acos(a))),o/=i,u.copy(e);for(let e=0,n=i-1;e<n;e++)d.copy(u).rotateAround(t,o),H(u,r,s),H(d,r,s),H(t,r,.5),u.copy(d);H(d,r,s),H(n,r,s),H(t,r,.5)}function W(){H(v,F,1),H(g,F,0),H(x,L,0),H(v,F,1),H(x,L,1),H(M,L,0)}function q(t,e,i){e?t?(H(v,F,1),H(g,F,0),H(x,L,0),H(v,F,1),H(x,L,0),H(S,L,1),H(x,i,0),H(b,i,0),H(S,i,.5)):(H(v,F,1),H(g,F,0),H(M,L,1),H(g,F,0),H(S,L,0),H(M,L,1),H(M,i,1),H(w,i,0),H(S,i,.5)):t?(H(x,i,0),H(b,i,0),H(C,i,.5)):(H(M,i,1),H(w,i,0),H(C,i,.5))}function J(t,e){e&&(t?(H(v,F,1),H(g,F,0),H(x,L,0),H(v,F,1),H(x,L,0),H(S,L,1),H(x,F,0),H(C,L,.5),H(S,L,1),H(C,L,.5),H(b,F,0),H(S,L,1)):(H(v,F,1),H(g,F,0),H(M,L,1),H(g,F,0),H(S,L,0),H(M,L,1),H(M,F,1),H(S,L,0),H(C,L,.5),H(C,L,.5),H(S,L,0),H(w,F,1)))}function X(t,i,n,r,o,a){switch(e.strokeLineCap){case"round":o?V(t,n,i,a,.5):V(t,i,n,a,.5);break;case"square":if(o)c.subVectors(i,t),h.set(c.y,-c.x),u.addVectors(c,h).add(t),d.subVectors(h,c).add(t),r?(u.toArray(s,3),d.toArray(s,0),d.toArray(s,9)):(u.toArray(s,3),u.toArray(s,9),d.toArray(s,0));else{c.subVectors(n,t),h.set(c.y,-c.x),u.addVectors(c,h).add(t),d.subVectors(h,c).add(t);const e=s.length;r?(u.toArray(s,e-3),d.toArray(s,e-6),d.toArray(s,e-12)):(u.toArray(s,e-6),d.toArray(s,e-3),d.toArray(s,e-12))}}}}}},1764:(t,e,i)=>{"use strict";i.r(e),i.d(e,{CSS2DObject:()=>r,CSS2DRenderer:()=>h});var n=i(9477);class r extends n.Tme{constructor(t=document.createElement("div")){super(),this.element=t,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",(function(){this.traverse((function(t){t.element instanceof Element&&null!==t.element.parentNode&&t.element.parentNode.removeChild(t.element)}))}))}copy(t,e){return super.copy(t,e),this.element=t.element.cloneNode(!0),this}}r.prototype.isCSS2DObject=!0;const s=new n.Pa4,o=new n.yGw,a=new n.yGw,l=new n.Pa4,c=new n.Pa4;class h{constructor(t={}){const e=this;let i,n,r,h;const u={objects:new WeakMap},d=void 0!==t.element?t.element:document.createElement("div");function p(t,i,n){if(t.isCSS2DObject){s.setFromMatrixPosition(t.matrixWorld),s.applyMatrix4(a);const o=!0===t.visible&&s.z>=-1&&s.z<=1&&!0===t.layers.test(n.layers);if(t.element.style.display=!0===o?"":"none",!0===o){t.onBeforeRender(e,i,n);const o=t.element;/apple/i.test(navigator.vendor)?o.style.transform="translate(-50%,-50%) translate("+Math.round(s.x*r+r)+"px,"+Math.round(-s.y*h+h)+"px)":o.style.transform="translate(-50%,-50%) translate("+(s.x*r+r)+"px,"+(-s.y*h+h)+"px)",o.parentNode!==d&&d.appendChild(o),t.onAfterRender(e,i,n)}const l={distanceToCameraSquared:f(n,t)};u.objects.set(t,l)}for(let e=0,r=t.children.length;e<r;e++)p(t.children[e],i,n)}function f(t,e){return l.setFromMatrixPosition(t.matrixWorld),c.setFromMatrixPosition(e.matrixWorld),l.distanceToSquared(c)}d.style.overflow="hidden",this.domElement=d,this.getSize=function(){return{width:i,height:n}},this.render=function(t,e){!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),o.copy(e.matrixWorldInverse),a.multiplyMatrices(e.projectionMatrix,o),p(t,t,e),function(t){const e=function(t){const e=[];return t.traverse((function(t){t.isCSS2DObject&&e.push(t)})),e}(t).sort((function(t,e){if(t.renderOrder!==e.renderOrder)return e.renderOrder-t.renderOrder;return u.objects.get(t).distanceToCameraSquared-u.objects.get(e).distanceToCameraSquared})),i=e.length;for(let t=0,n=e.length;t<n;t++)e[t].element.style.zIndex=i-t}(t)},this.setSize=function(t,e){i=t,n=e,r=i/2,h=n/2,d.style.width=t+"px",d.style.height=e+"px"}}}},140:(t,e,i)=>{"use strict";i.r(e),i.d(e,{computeMorphedAttributes:()=>u,computeTangents:()=>r,estimateBytesUsed:()=>l,interleaveAttributes:()=>a,mergeBufferAttributes:()=>o,mergeBufferGeometries:()=>s,mergeVertices:()=>c,toTrianglesDrawMode:()=>h});var n=i(9477);function r(t){t.computeTangents()}function s(t,e=!1){const i=null!==t[0].index,r=new Set(Object.keys(t[0].attributes)),s=new Set(Object.keys(t[0].morphAttributes)),a={},l={},c=t[0].morphTargetsRelative,h=new n.u9r;let u=0;for(let n=0;n<t.length;++n){const o=t[n];let d=0;if(i!==(null!==o.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+n+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const t in o.attributes){if(!r.has(t))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+n+'. All geometries must have compatible attributes; make sure "'+t+'" attribute exists among all geometries, or in none of them.'),null;void 0===a[t]&&(a[t]=[]),a[t].push(o.attributes[t]),d++}if(d!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+n+". Make sure all geometries have the same number of attributes."),null;if(c!==o.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+n+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const t in o.morphAttributes){if(!s.has(t))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+n+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===l[t]&&(l[t]=[]),l[t].push(o.morphAttributes[t])}if(h.userData.mergedUserData=h.userData.mergedUserData||[],h.userData.mergedUserData.push(o.userData),e){let t;if(i)t=o.index.count;else{if(void 0===o.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+n+". The geometry must have either an index or a position attribute"),null;t=o.attributes.position.count}h.addGroup(u,t,n),u+=t}}if(i){let e=0;const i=[];for(let n=0;n<t.length;++n){const r=t[n].index;for(let t=0;t<r.count;++t)i.push(r.getX(t)+e);e+=t[n].attributes.position.count}h.setIndex(i)}for(const t in a){const e=o(a[t]);if(!e)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+t+" attribute."),null;h.setAttribute(t,e)}for(const t in l){const e=l[t][0].length;if(0===e)break;h.morphAttributes=h.morphAttributes||{},h.morphAttributes[t]=[];for(let i=0;i<e;++i){const e=[];for(let n=0;n<l[t].length;++n)e.push(l[t][n][i]);const n=o(e);if(!n)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+t+" morphAttribute."),null;h.morphAttributes[t].push(n)}}return h}function o(t){let e,i,r,s=0;for(let n=0;n<t.length;++n){const o=t[n];if(o.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===e&&(e=o.array.constructor),e!==o.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===i&&(i=o.itemSize),i!==o.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===r&&(r=o.normalized),r!==o.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;s+=o.array.length}const o=new e(s);let a=0;for(let e=0;e<t.length;++e)o.set(t[e].array,a),a+=t[e].array.length;return new n.TlE(o,i,r)}function a(t){let e,i=0,r=0;for(let n=0,s=t.length;n<s;++n){const s=t[n];if(void 0===e&&(e=s.array.constructor),e!==s.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;i+=s.array.length,r+=s.itemSize}const s=new n.vpT(new e(i),r);let o=0;const a=[],l=["getX","getY","getZ","getW"],c=["setX","setY","setZ","setW"];for(let e=0,i=t.length;e<i;e++){const i=t[e],r=i.itemSize,h=i.count,u=new n.kB5(s,r,o,i.normalized);a.push(u),o+=r;for(let t=0;t<h;t++)for(let e=0;e<r;e++)u[c[e]](t,i[l[e]](t))}return a}function l(t){let e=0;for(const i in t.attributes){const n=t.getAttribute(i);e+=n.count*n.itemSize*n.array.BYTES_PER_ELEMENT}const i=t.getIndex();return e+=i?i.count*i.itemSize*i.array.BYTES_PER_ELEMENT:0,e}function c(t,e=1e-4){e=Math.max(e,Number.EPSILON);const i={},r=t.getIndex(),s=t.getAttribute("position"),o=r?r.count:s.count;let a=0;const l=Object.keys(t.attributes),c={},h={},u=[],d=["getX","getY","getZ","getW"];for(let e=0,i=l.length;e<i;e++){const i=l[e];c[i]=[];const n=t.morphAttributes[i];n&&(h[i]=new Array(n.length).fill().map((()=>[])))}const p=Math.log10(1/e),f=Math.pow(10,p);for(let e=0;e<o;e++){const n=r?r.getX(e):e;let s="";for(let e=0,i=l.length;e<i;e++){const i=l[e],r=t.getAttribute(i),o=r.itemSize;for(let t=0;t<o;t++)s+=~~(r[d[t]](n)*f)+","}if(s in i)u.push(i[s]);else{for(let e=0,i=l.length;e<i;e++){const i=l[e],r=t.getAttribute(i),s=t.morphAttributes[i],o=r.itemSize,a=c[i],u=h[i];for(let t=0;t<o;t++){const e=d[t];if(a.push(r[e](n)),s)for(let t=0,i=s.length;t<i;t++)u[t].push(s[t][e](n))}}i[s]=a,u.push(a),a++}}const m=t.clone();for(let e=0,i=l.length;e<i;e++){const i=l[e],r=t.getAttribute(i),s=new r.array.constructor(c[i]),o=new n.TlE(s,r.itemSize,r.normalized);if(m.setAttribute(i,o),i in h)for(let e=0;e<h[i].length;e++){const r=t.morphAttributes[i][e],s=new r.array.constructor(h[i][e]),o=new n.TlE(s,r.itemSize,r.normalized);m.morphAttributes[i][e]=o}}return m.setIndex(u),m}function h(t,e){if(e===n.WwZ)return t;if(e===n.z$h||e===n.UlW){let i=t.getIndex();if(null===i){const e=[],n=t.getAttribute("position");if(void 0===n)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(let t=0;t<n.count;t++)e.push(t);t.setIndex(e),i=t.getIndex()}const r=i.count-2,s=[];if(e===n.z$h)for(let t=1;t<=r;t++)s.push(i.getX(0)),s.push(i.getX(t)),s.push(i.getX(t+1));else for(let t=0;t<r;t++)t%2==0?(s.push(i.getX(t)),s.push(i.getX(t+1)),s.push(i.getX(t+2))):(s.push(i.getX(t+2)),s.push(i.getX(t+1)),s.push(i.getX(t)));s.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=t.clone();return o.setIndex(s),o.clearGroups(),o}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),t}function u(t){if(!0!==t.geometry.isBufferGeometry)return console.error("THREE.BufferGeometryUtils: Geometry is not of type BufferGeometry."),null;const e=new n.Pa4,i=new n.Pa4,r=new n.Pa4,s=new n.Pa4,o=new n.Pa4,a=new n.Pa4,l=new n.Pa4,c=new n.Pa4,h=new n.Pa4;function u(t,n,u,d,p,f,m,g,v){e.fromBufferAttribute(u,f),i.fromBufferAttribute(u,m),r.fromBufferAttribute(u,g);const y=t.morphTargetInfluences;if(n.morphTargets&&d&&y){l.set(0,0,0),c.set(0,0,0),h.set(0,0,0);for(let t=0,n=d.length;t<n;t++){const n=y[t],u=d[t];0!==n&&(s.fromBufferAttribute(u,f),o.fromBufferAttribute(u,m),a.fromBufferAttribute(u,g),p?(l.addScaledVector(s,n),c.addScaledVector(o,n),h.addScaledVector(a,n)):(l.addScaledVector(s.sub(e),n),c.addScaledVector(o.sub(i),n),h.addScaledVector(a.sub(r),n)))}e.add(l),i.add(c),r.add(h)}t.isSkinnedMesh&&(t.boneTransform(f,e),t.boneTransform(m,i),t.boneTransform(g,r)),v[3*f+0]=e.x,v[3*f+1]=e.y,v[3*f+2]=e.z,v[3*m+0]=i.x,v[3*m+1]=i.y,v[3*m+2]=i.z,v[3*g+0]=r.x,v[3*g+1]=r.y,v[3*g+2]=r.z}const d=t.geometry,p=t.material;let f,m,g;const v=d.index,y=d.attributes.position,_=d.morphAttributes.position,x=d.morphTargetsRelative,M=d.attributes.normal,b=d.morphAttributes.position,w=d.groups,S=d.drawRange;let T,A,E,C,O,P,I,D;const L=new Float32Array(y.count*y.itemSize),R=new Float32Array(M.count*M.itemSize);if(null!==v)if(Array.isArray(p))for(T=0,E=w.length;T<E;T++)for(O=w[T],P=p[O.materialIndex],I=Math.max(O.start,S.start),D=Math.min(O.start+O.count,S.start+S.count),A=I,C=D;A<C;A+=3)f=v.getX(A),m=v.getX(A+1),g=v.getX(A+2),u(t,P,y,_,x,f,m,g,L),u(t,P,M,b,x,f,m,g,R);else for(I=Math.max(0,S.start),D=Math.min(v.count,S.start+S.count),T=I,E=D;T<E;T+=3)f=v.getX(T),m=v.getX(T+1),g=v.getX(T+2),u(t,p,y,_,x,f,m,g,L),u(t,p,M,b,x,f,m,g,R);else if(Array.isArray(p))for(T=0,E=w.length;T<E;T++)for(O=w[T],P=p[O.materialIndex],I=Math.max(O.start,S.start),D=Math.min(O.start+O.count,S.start+S.count),A=I,C=D;A<C;A+=3)f=A,m=A+1,g=A+2,u(t,P,y,_,x,f,m,g,L),u(t,P,M,b,x,f,m,g,R);else for(I=Math.max(0,S.start),D=Math.min(y.count,S.start+S.count),T=I,E=D;T<E;T+=3)f=T,m=T+1,g=T+2,u(t,p,y,_,x,f,m,g,L),u(t,p,M,b,x,f,m,g,R);return{positionAttribute:y,normalAttribute:M,morphedPositionAttribute:new n.a$l(L,3),morphedNormalAttribute:new n.a$l(R,3)}}},4147:t=>{"use strict";t.exports=JSON.parse('{"name":"dabeeomaps","version":"04.36.01","description":"dabeeomaps_library 4.0 project","main":"dist/dabeeomaps.js","typings":"./dist/src/index.d.ts","types":"./dist/src/index.d.ts","files":["dist/src","dist/dabeeomaps.js"],"scripts":{"test":"npx jest","lint":"npx eslint \'./src/**/*.{ts,js}\'","lint:fix":"npx eslint --fix \'./src/**/*.{ts,js}\'","prettier":"npx prettier --check . ","prettier:write":"npx prettier --write . ","dev":"webpack serve --config ./webpack.dev.js","debug":"DEBUG=on webpack serve --config ./webpack.dev.js","watch":"webpack --watch --config ./webpack.production.watch.js","stage":"webpack --config ./webpack.stage.js","deploy:docs":"aws s3 sync ./docs s3://api-cell-api-doc.dabeeomaps.com --delete && npm run nocache:docs","nocache:docs":"aws cloudfront create-invalidation --distribution-id EBV3VIFQ7DNC1 --paths \'/*\'","deploy:stage":"aws s3 cp ./build/dabeeomaps-4.0.0.js s3://api-cell-api-assets.dabeeomaps.com/upload/library/dabeeomaps-4.0-pre-release.js && npm run nocache:stage","nocache:stage":"aws cloudfront create-invalidation --distribution-id E11SSUKP6Y34IJ --paths \'/upload/library/dabeeomaps-4.0-pre-release.js\'","deploy:release":"aws s3 cp ./build/*.js s3://api-cell-api-assets.dabeeomaps.com/upload/library/ && npm run deploy:latest && npm run nocache:release","deploy:latest":"aws s3 cp ./build/*.js s3://api-cell-api-assets.dabeeomaps.com/upload/library/dabeeomaps-4.0-latest.js && npm run nocache:release","nocache:release":"aws cloudfront create-invalidation --distribution-id E11SSUKP6Y34IJ --paths \'/upload/library/*\'","deploy:kiosk":"npm run build && aws s3 cp ./build/*.js s3://api-cell-api-assets.dabeeomaps.com/upload/library/dabeeomaps-4.0-kiosk-latest.js && npm run nocache:kiosk","nocache:kiosk":"aws cloudfront create-invalidation --distribution-id E11SSUKP6Y34IJ --paths \'/upload/library/dabeeomaps-4.0-kiosk-latest.js\'","doc":"npx typedoc --disableSources --excludePrivate --out docs","build":"webpack --config ./webpack.production.js","make":"webpack --config ./webpack.publish.js","loader-install":"npm install --force three-loader-3dtiles"},"repository":{"type":"git","url":"git+https://github.com/dabeeo/dabeeomaps_library.git"},"author":"","license":"Unlicensed","bugs":{"url":"https://github.com/dabeeo/dabeeomaps_library/issues"},"homepage":"https://github.com/dabeeo/dabeeomaps_library#readme","devDependencies":{"@babel/preset-env":"^7.20.2","@babel/preset-typescript":"^7.21.0","@types/jest":"^29.5.0","@types/lodash":"^4.14.191","@types/three":"^0.144.0","@types/three-gif-loader":"^1.1.1","@typescript-eslint/eslint-plugin":"^5.44.0","@typescript-eslint/parser":"^5.44.0","babel-jest":"^29.5.0","clean-webpack-plugin":"^4.0.0","copy-webpack-plugin":"^11.0.0","css-loader":"^6.7.1","dotenv-webpack":"^7.1.0","eslint":"^8.28.0","eslint-config-airbnb-base":"^15.0.0","eslint-config-airbnb-typescript":"^17.0.0","eslint-config-prettier":"^8.5.0","eslint-plugin-ie11":"^1.0.0","eslint-plugin-import":"^2.26.0","eslint-plugin-prettier":"^4.2.1","file-loader":"^6.1.1","html-webpack-plugin":"^4.5.0","jest":"^29.5.0","jest-environment-jsdom":"^29.5.0","jest-html-reporter":"^3.7.1","jest-transform-stub":"^2.0.0","prettier":"2.7.1","style-loader":"^3.3.1","terser-webpack-plugin":"^5.3.6","ts-jest":"^29.0.5","ts-loader":"^9.2.8","typescript":"^4.6.2","webpack":"^5.70.0","webpack-cli":"^4.9.2","webpack-dev-middleware":"^5.3.1","webpack-dev-server":"^4.7.4","webpack-merge":"^5.2.0","whatwg-fetch":"^3.4.1"},"dependencies":{"@tweenjs/tween.js":"^18.6.4","adaptive-bezier-curve":"^1.0.3","airbnb":"0.0.2","axios":"^1.3.4","camera-controls":"^1.37.2","cors":"^2.8.5","dabeeomaps_api4_directions":"^2.0.0","dijkstrajs":"^1.0.2","dotenv":"^16.0.0","ejs":"^3.1.5","express":"^4.17.1","glslify-import-loader":"^0.1.2","glslify-loader":"^2.0.0","html-webpack-plugin":"^5.5.0","lodash":"^4.17.21","node-fetch":"^3.3.1","raw-loader":"^4.0.2","three":"^0.138.3","three-gif-loader":"^1.1.0","three-line-2d":"^1.1.5","three-loader-3dtiles":"^1.1.17","typedoc":"^0.22.13"}}')}},e={};function i(n){var r=e[n];if(void 0!==r)return r.exports;var s=e[n]={id:n,loaded:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.loaded=!0,s.exports}i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.nmd=t=>(t.paths=[],t.children||(t.children=[]),t);var n={};(()=>{"use strict";var t=n;Object.defineProperty(t,"__esModule",{value:!0}),t.DabeeoMapData=t.DabeeoMap=t.SOLID_LINE_CAP_TYPE=t.SOLID_LINE_JOIN_TYPE=t.EVENT_TYPE=t.TRANSPORTATION_RESULT_TYPE=t.TRANSPORTATION_REQUEST_TYPE=t.FOCUS_TYPE=t.WATERMARK_TYPE=t.CAMERA_TYPE=t.LANG_TYPE=t.SERVER_TYPE=t.Maps=void 0;const e=i(13);Object.defineProperty(t,"Maps",{enumerable:!0,get:function(){return e.DabeeoMaps}});const r=i(4147),s=i(5925);Object.defineProperty(t,"SERVER_TYPE",{enumerable:!0,get:function(){return s.SERVER_TYPE}});const o=i(9570);Object.defineProperty(t,"CAMERA_TYPE",{enumerable:!0,get:function(){return o.CAMERA_TYPE}}),Object.defineProperty(t,"LANG_TYPE",{enumerable:!0,get:function(){return o.LANG_TYPE}}),Object.defineProperty(t,"WATERMARK_TYPE",{enumerable:!0,get:function(){return o.WATERMARK_TYPE}});const a=i(1949);Object.defineProperty(t,"FOCUS_TYPE",{enumerable:!0,get:function(){return a.FOCUS_TYPE}});const l=i(6509);Object.defineProperty(t,"TRANSPORTATION_REQUEST_TYPE",{enumerable:!0,get:function(){return l.TRANSPORTATION_REQUEST_TYPE}});const c=i(2626);Object.defineProperty(t,"EVENT_TYPE",{enumerable:!0,get:function(){return c.EVENT_TYPE}});const h=i(6731);Object.defineProperty(t,"TRANSPORTATION_RESULT_TYPE",{enumerable:!0,get:function(){return h.TRANSPORTATION_RESULT_TYPE}});const u=i(9377);Object.defineProperty(t,"SOLID_LINE_CAP_TYPE",{enumerable:!0,get:function(){return u.SOLID_LINE_CAP_TYPE}}),Object.defineProperty(t,"SOLID_LINE_JOIN_TYPE",{enumerable:!0,get:function(){return u.SOLID_LINE_JOIN_TYPE}});const d=i(9718);Object.defineProperty(t,"DabeeoMap",{enumerable:!0,get:function(){return d.DabeeoMap}});const p=i(9720);Object.defineProperty(t,"DabeeoMapData",{enumerable:!0,get:function(){return p.DabeeoMapData}}),r.version})(),window.dabeeo=n})();